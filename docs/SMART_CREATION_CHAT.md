# 🤖 SmartCreationChat - תיעוד מלא

## סקירה כללית

**SmartCreationChat** הוא בוט AI חכם שעוזר למורים ליצור תוכן לימודי בצורה אינטואיטיבית ויעילה. הבוט מבין את כוונת המורה, מציע אפשרויות רלוונטיות, ומנווט אותה דרך תהליך היצירה.

**קבצים עיקריים:**
- Frontend: [`src/components/SmartCreationChat.tsx`](../src/components/SmartCreationChat.tsx)
- Backend Service: [`src/services/ai/smartCreationService.ts`](../src/services/ai/smartCreationService.ts)
- Cloud Functions: [`functions/src/index.ts`](../functions/src/index.ts) (קווים 200-793)

---

## 🎯 יכולות הבוט

### 1. **יצירת תוכן אינטראקטיבי** (דיגיטלי במערכת)
- **שיעורים** (Lessons) - מערך שיעור מלא עם 5 שלבים
- **פעילויות** (Activities) - תרגול אינטראקטיבי עם שאלות מגוונות
- **מבחנים דיגיטליים** (Exams) - הערכה עם ציונים אוטומטיים
- **פודקאסטים** (Podcasts) - פרק אודיו עם 2 מגישים

### 2. **מקורות תוכן**
- **נושא חופשי** (Topic) - AI יוצר מהידע שלו
- **קובץ** (File) - העלאת PDF/תמונה/טקסט
- **טקסט מודבק** (Text) - הדבקה ישירה
- **ספר לימוד** (Textbook) - בחירה מספרים במערכת
- **YouTube** - תמלול ויצירה מסרטון

### 3. **רמות קושי** (הוראה דיפרנציאלית)
- **הבנה** (Support) - לתלמידים מתקשים
- **יישום** (Core) - לרוב הכיתה
- **העמקה** (Enrichment) - למתקדמים

### 4. **פרופילים**
- **Balanced** - מיקס מאוזן
- **Educational** - דגש על הערכה
- **Game** - דגש על משחקיות

### 5. **אורך פעילות**
- **Short** - 3 שאלות (~10 דק')
- **Medium** - 5 שאלות (~15-20 דק')
- **Long** - 7 שאלות (~25-30 דק')

---

## 🧠 תכונות חכמות

### 🔍 **שאילתות תכנית לימודים** (Curriculum Standards)
המערכת מכילה **430+ תקני תוכ"ל** של משרד החינוך הישראלי.

**מתי להשתמש:**
- "מה בתכנית הלימודים במתמטיקה לכיתה ד?"
- "תראה לי תקנים בנושא שברים"
- "יש תוכ"ל על מלחמת העצמאות?"

**איך זה עובד:**
1. הבוט מזהה בקשה לתוכ"ל
2. קורא ל-Cloud Function `queryCurriculumStandards`
3. מציג תקנים רלוונטיים
4. מציע לבסס תוכן על התקנים

**Cloud Function:** `queryCurriculumStandards` (שורות 200-280)

---

### 🔄 **שימוש חוזר בתכנים** (Smart Reuse)
**זו התכונה החשובה ביותר!** הבוט בודק אם המורה יצרה תוכן דומה בעבר.

**מתי פועל:**
- המורה מבקשת ליצור תוכן חדש
- יש נושא + סוג תוכן + כיתה

**תהליך:**
1. הבוט מזהה intent=create
2. קורא ל-Cloud Function `searchUserContent`
3. מחפש בקורסים של המורה
4. מחשב **ציון איכות אוטומטי** (0-100):
   - 40% - Success Rate
   - 30% - Completion Rate
   - 20% - Average Score
   - 10% - Usage Frequency

**תצוגה:**
- תכנים מדורגים לפי ציון
- סטטיסטיקות שימוש (מספר תלמידים, הצלחה, ציון ממוצע)
- תגיות צבע (ירוק 80+, צהוב 60+, אפור <60)
- 3 אפשרויות: "השתמש בזה", "בהשראת זה", "צור חדש"

**Cloud Function:** `searchUserContent` (שורות 380-515)

---

### ⚡ **תבניות מהירות** (Quick Templates)
4 תבניות מערכת מוכנות ליצירה מהירה.

**תבניות זמינות:**
1. **פעילות מהירה** ⚡ - 5 שאלות, מיקס מאוזן
2. **מבחן סיכום** 📊 - 10 שאלות, כל הרמות
3. **משחק למידה** 🎮 - זיכרון והתאמות
4. **שיעור מלא** 📚 - מערך שלם

**מתי להציע:**
- בקשה פשוטה ללא דרישות מיוחדות
- אין בוט/סוגי שאלות ספציפיים
- אין קובץ/יוטיוב כמקור

**Cloud Function:** `getContentTemplates` (שורות 584-615)

---

### 💡 **מאגר פרומפטים** (Prompt Library) - חדש!
מאגר פרומפטים שמורות אחרות יצרו ודירגו - **לתוכן סטטי בלבד**.

**11 קטגוריות:**
1. יצירת מבחנים (מודפסים)
2. הכנת שיעורים
3. משוב לתלמידים
4. משחקים ופעילויות (כיתתיים)
5. התאמות אישיות
6. יצירת תוכן (סיפורים, שירים)
7. ניהול כיתה
8. הערכה חלופית
9. למידה חברתית-רגשית (SEL)
10. תכנון ותכניות עבודה
11. תקשורת אישית

**מתי להציע:**
כשהמורה מבקשת **תוכן סטטי** (להדפסה):
- "דף עבודה על..."
- "מבחן מודפס על..."
- "משוב לתלמיד..."
- "תכנית עבודה ל..."
- "מכתב להורים על..."

**מתי לא להציע:**
- תוכן אינטראקטיבי (פעילות, מבחן דיגיטלי, שיעור, פודקאסט)

**איך זה עובד:**
1. הבוט מזהה תוכן סטטי
2. קורא ל-Cloud Function `searchRelevantPrompts`
3. מחפש לפי קטגוריה + מילות מפתח
4. מדרג לפי:
   - 40% - דירוג ממוצע
   - 30% - מספר שימושים
   - 30% - עדכניות
5. מציג 3 פרומפטים מומלצים
6. המורה בוחרת ומקבלת תבנית למילוי

**Cloud Function:** `searchRelevantPrompts` (שורות 716-793)

---

## 🎯 לוגיקה פרואקטיבית - סדר עדיפויות

הבוט פועל ברמת פרואקטיביות **מאוזנת** (Balanced Proactive) - מציע במקומות הנכונים, לא aggressive מדי.

### תוכן אינטראקטיבי (דיגיטלי)
```
Priority 1: Smart Reuse      (תוכן קיים של המורה)
Priority 2: Curriculum       (תקני תוכ"ל)
Priority 3: Quick Templates  (תבניות מהירות)
Priority 4: Questions        (שאלות לאיסוף מידע)
```

### תוכן סטטי (להדפסה)
```
Priority 1: Prompt Library   (פרומפטים מהמאגר)
Priority 2: Curriculum       (אם רלוונטי)
Priority 3: Questions        (שאלות לאיסוף מידע)
```

### חוקי התנהגות
1. **אחד בכל פעם** - לא להציע 3 דברים ביחד
2. **הכי רלוונטי ראשון** - לפי סדר העדיפויות
3. **פעם אחת לשיחה** - לא לחזור על הצעה
4. **המשתמש שולט** - אם אמרה "לא", לא להציע שוב
5. **Context awareness** - לא להפריע באמצע תהליך

---

## 🤖 זיהוי כוונה (Intent Recognition)

הבוט מזהה 3 כוונות עיקריות:

### 1. **Create** - יצירה
"רוצה פעילות על...", "צריכה מבחן..."

### 2. **Advise** - ייעוץ
"איך אני...", "מה כדאי...", "תני לי רעיון..."

### 3. **Question** - שאלה
"מה זה...", "תסבירי לי...", "איך עובד..."

---

## 🔍 זיהוי סוג תוכן (Content Type Detection)

הבוט מזהה **אוטומטית** אם המורה רוצה תוכן אינטראקטיבי או סטטי:

### תוכן אינטראקטיבי (Interactive)
**מילות מפתח:**
- "פעילות", "תרגול", "משחק דיגיטלי"
- "מבחן" (ללא "מודפס" או "להדפסה")
- "שיעור" (מערך במערכת)
- "פודקאסט"

**פעולה:** Smart Reuse → Curriculum → Templates

---

### תוכן סטטי (Static)
**מילות מפתח:**
- "דף עבודה", "גיליון", "דף תרגול"
- "מבחן מודפס", "בוחן להדפסה"
- "משוב", "מכתב", "הודעה"
- "תכנית עבודה", "רובריקה"
- כל דבר עם "להדפסה", "PDF", "Word"

**פעולה:** Prompt Library → Curriculum

---

### לא בטוח?
הבוט שואל: "פעילות דיגיטלית במערכת או דף עבודה להדפסה?"

---

## 📊 דוגמאות לשיחות

### דוגמה 1: תוכן אינטראקטיבי - יש reuse
```
👩‍🏫: "אני רוצה פעילות על שברים לכיתה ה"
🤖: [מזהה: interactive, topic=שברים, grade=ה]
    "רגע, בודק אם יש לך כבר משהו דומה..."

    [מוצא פעילות קיימת עם ציון 92%]

    "יש לך פעילות מדהימה על שברים!
     👥 15 תלמידים | ✓ 94% הצלחה | ⭐ 92

     רוצה להשתמש בה שוב, לערוך, או ליצור חדשה?"

     [3 כפתורים: "🔄 השתמש בזה", "💡 בהשראת זה", "✨ צור חדש"]
```

---

### דוגמה 2: תוכן אינטראקטיבי - אין reuse
```
👩‍🏫: "אני רוצה פעילות על מחזור המים לכיתה ד"
🤖: [בודק reuse - לא מוצא]

    "מצאתי 5 תקני תוכ"ל על מחזור המים לכיתה ד.
     רוצה שאבסס את הפעילות עליהם?"

     [Priority 2: Curriculum]

👩‍🏫: "כן"
🤖: "מעולה! יש לי תבנית מהירה - 5 שאלות מגוונות.
     רוצה זאת או משהו אחר?"

     [Priority 3: Quick Templates]
```

---

### דוגמה 3: תוכן סטטי - פרומפטים
```
👩‍🏫: "אני צריכה דף עבודה על שברים לכיתה ה"
🤖: [מזהה: static content, type=worksheet]

    "יש לי 3 פרומפטים מומלצים ליצירת דפי עבודה במתמטיקה!
     מורות אחרות דירגו אותם ⭐ 4.8"

     [מציג 3 פרומפטים בעיצוב מוזהב]

     1. 📝 "מחולל דפי עבודה" - ⭐ 4.9 | 🔥 127 שימושים
     2. 📋 "תרגילים מותאמים" - ⭐ 4.7 | 🔥 89 שימושים
     3. 🎯 "דף תרגול ממוקד" - ⭐ 4.6 | 🔥 76 שימושים

     [כפתור: "✨ השתמש בפרומפט הזה"]
     [כפתור: "📝 צור מאפס (בלי פרומפט)"]

👩‍🏫: [לוחצת על פרומפט 1]
🤖: "נהדר! הפרומפט 'מחולל דפי עבודה' נבחר.

     כעת תוכלי למלא את השדות הנדרשים:

     **מקצוע**: מתמטיקה
     **שכבה**: ה׳
     **נושא**: שברים
     **מספר תרגילים**: 10

     **תבנית הפרומפט:**
     ```
     אני מורה למתמטיקה בכיתה {{שכבה}}.
     צור לי דף עבודה על {{נושא}} עם {{מספר_תרגילים}} תרגילים...
     ```

     העתיקי את זה ל-ChatGPT/Claude/Gemini ותקבלי את התוכן!"
```

---

### דוגמה 4: בקשה מעורפלת
```
👩‍🏫: "אני רוצה משהו על שברים"
🤖: [לא יודע אם interactive או static]

    "בטח! מה את מעדיפה:
     📱 פעילות אינטראקטיבית (דיגיטלית במערכת)
     📄 דף עבודה להדפסה
     📝 מבחן (דיגיטלי או מודפס)

     מה מתאים לך?"
```

---

## 🛠️ ארכיטקטורה טכנית

### Cloud Functions

#### `queryCurriculumStandards`
**מיקום:** [`functions/src/index.ts:200-280`](../functions/src/index.ts#L200)
- **קלט:** `subject`, `gradeLevel`, `topic`, `domain`, `bloomLevels`, `limit`
- **פלט:** רשימת תקני תוכ"ל
- **קולקציה:** `curriculum_standards` (430+ מסמכים)

#### `searchUserContent`
**מיקום:** [`functions/src/index.ts:380-515`](../functions/src/index.ts#L380)
- **קלט:** `query`, `blockType`, `gradeLevel`, `limit`
- **פלט:** רשימת תכנים עם ציון איכות
- **קולקציות:** `courses/{courseId}/blocks`, `tasks`
- **חישוב איכות:** `calculateCourseQuality()` (שורות 420-480)

#### `getContentTemplates`
**מיקום:** [`functions/src/index.ts:584-615`](../functions/src/index.ts#L584)
- **קלט:** -
- **פלט:** תבניות מערכת + תבניות משתמש
- **קולקציה:** `content_templates`

#### `searchRelevantPrompts`
**מיקום:** [`functions/src/index.ts:716-793`](../functions/src/index.ts#L716)
- **קלט:** `category`, `keywords`, `limit`
- **פלט:** רשימת פרומפטים מדורגים
- **קולקציה:** `prompts`
- **דירוג:** 40% rating + 30% usage + 30% recency

---

### Frontend Components

#### `SmartCreationChat.tsx`
**מיקום:** [`src/components/SmartCreationChat.tsx`](../src/components/SmartCreationChat.tsx)
- **State Management:** React Hooks
- **Message Types:** ChatMessage interface
- **Handlers:**
  - `handleSend()` - שליחת הודעה
  - `handleQuickReply()` - מענה מהיר
  - `handleOptionSelect()` - בחירת אפשרות
  - `handleReuseAction()` - פעולת reuse
  - `handlePromptAction()` - שימוש בפרומפט
  - `handleTemplateSelect()` - בחירת תבנית

#### UI Components
- **Curriculum Results** - עיצוב ירוק (green theme)
- **Content Search** - עיצוב ציאן (cyan/blue theme)
- **Templates** - עיצוב כתום/צהוב (amber theme)
- **Prompts** - עיצוב מוזהב/כתום (amber/orange theme)

---

### Backend Service

#### `smartCreationService.ts`
**מיקום:** [`src/services/ai/smartCreationService.ts`](../src/services/ai/smartCreationService.ts)
- **AI Integration:** Gemini via ProxyService
- **System Prompt:** 500+ שורות של הנחיות מפורטות
- **Types:**
  - `CollectedData` - נתונים שנאספו
  - `AIResponse` - תשובת הבוט
  - `ContentOption` - אפשרות תוכן
  - `ContentTemplate` - תבנית
  - `ReuseContentSuggestion` - הצעת reuse
  - `PromptSuggestion` - פרומפט מהמאגר

---

## 📈 סטטיסטיקות

### מאגר תוכ"ל
- **430 תקנים** במערכת
- **13 מקצועות**: מתמטיקה, עברית, אנגלית, תנ"ך, היסטוריה, גיאוגרפיה, אזרחות, מדעים, פיזיקה, כימיה, ביולוגיה, מדעי המחשב, ספרות
- **כיתות**: א׳-י״ב
- **איכות נתונים**: 98.1%

### מאגר פרומפטים
- **11 קטגוריות**
- **10+ פרומפטים מוכנים** (ניתן להרחבה)
- **דירוג ושימוש**: נתונים ריאליים מהמערכת

---

## 🚀 שימוש והרחבה

### הוספת קטגוריה חדשה לפרומפטים
1. עדכון `PROMPT_CATEGORIES` ב-[`src/services/promptsService.ts`](../src/services/promptsService.ts)
2. עדכון System Prompt ב-[`smartCreationService.ts`](../src/services/ai/smartCreationService.ts)
3. הוספת פרומפטים לקטגוריה דרך UI או seeding script

### הוספת תבנית חדשה
1. עדכון `SYSTEM_TEMPLATES` ב-[`functions/src/index.ts`](../functions/src/index.ts#L521)
2. הגדרת ערכי ברירת מחדל
3. UI תציג אוטומטית

### התאמת סדר עדיפויות
עדכון System Prompt בקטע "סדר עדיפויות" ב-[`smartCreationService.ts:349-415`](../src/services/ai/smartCreationService.ts#L349)

---

## 🐛 Debug & Troubleshooting

### בעיות נפוצות

**בוט לא מציע פרומפטים:**
- ✅ בדוק שהבקשה מכילה מילות מפתח לתוכן סטטי
- ✅ בדוק logs ב-Cloud Functions Console
- ✅ וודא שיש פרומפטים active בקולקציה `prompts`

**בוט לא מציע reuse:**
- ✅ בדוק שיש נושא + סוג תוכן + intent=create
- ✅ וודא שהמורה יצרה תכנים בעבר
- ✅ בדוק ש-`searchUserContent` מחזיר תוצאות

**תקני תוכ"ל לא מוצגים:**
- ✅ הרץ [`seedCurriculumWithAI.ts`](../functions/src/scripts/seedCurriculumWithAI.ts) לאכלוס
- ✅ וודא שיש `GEMINI_API_KEY` ב-`.env`
- ✅ בדוק שהקולקציה `curriculum_standards` קיימת

---

## 📚 מקורות נוספים

- [System Prompt המלא](../src/services/ai/smartCreationService.ts#L141-L444)
- [PromptsLibrary Component](../src/components/PromptsLibrary.tsx)
- [Prompts Service](../src/services/promptsService.ts)
- [Activity Bank Types](../functions/src/services/activityBank/types.ts)

---

## 🎉 תרומה והרחבה

הבוט מתוכנן להיות **מודולרי וניתן להרחבה**:
- הוסף קטגוריות חדשות
- שפר את לוגיקת הדירוג
- הוסף תכונות AI נוספות
- שפר את זיהוי הכוונה

**נוצר:** ינואר 2026
**גרסה:** 1.0
**מעודכן לאחרונה:** חיבור מאגר הפרומפטים והלוגיקה הפרואקטיבית
