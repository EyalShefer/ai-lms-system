{"version":3,"file":"analyticsService-CDbP7cGH.js","sources":["../../src/services/analyticsService.ts"],"sourcesContent":["/**\r\n * Analytics Service - Real Firestore Integration\r\n *\r\n * Provides student analytics data from actual Firestore collections:\r\n * - Profile data (performance, behavioral metrics)\r\n * - Proficiency vectors (topic mastery)\r\n * - Session history (journey trace)\r\n * - Error fingerprints (mistake patterns)\r\n */\r\n\r\nimport { db } from '../firebase';\r\nimport {\r\n    collection,\r\n    query,\r\n    where,\r\n    getDocs,\r\n    doc,\r\n    getDoc,\r\n    orderBy,\r\n    limit\r\n} from 'firebase/firestore';\r\n\r\nexport interface StudentAnalytics {\r\n    id: string;\r\n    name: string;\r\n    avatar: string;\r\n    email?: string;\r\n    mastery: Record<string, number>; // Topic -> 0.0-1.0\r\n    lastActive: string;\r\n    riskLevel: 'low' | 'medium' | 'high';\r\n    journey: JourneyNode[];\r\n    performance?: {\r\n        accuracy: number;\r\n        avgResponseTime: number;\r\n        totalQuestions: number;\r\n        hintDependency: number;\r\n    };\r\n    errorPatterns?: Record<string, number>;\r\n}\r\n\r\nexport interface JourneyNode {\r\n    id: string;\r\n    type: 'question' | 'content' | '◊î◊ë◊†◊î' | '◊î◊¢◊û◊ß◊î' | 'skipped';  // ◊î◊ë◊†◊î replaces remediation\r\n    status: 'success' | 'failure' | 'skipped' | 'viewed';\r\n    timestamp: number;\r\n    blockId?: string;\r\n    blockType?: string;\r\n    variantUsed?: '◊ô◊ô◊©◊ï◊ù' | '◊î◊ë◊†◊î' | '◊î◊¢◊û◊ß◊î';  // Hebrew: Application, Understanding, Deepening\r\n    metadata?: any;\r\n    connection?: 'direct' | 'branched';\r\n}\r\n\r\n/**\r\n * Calculate risk level based on performance metrics\r\n */\r\nconst calculateRiskLevel = (\r\n    accuracy: number,\r\n    hintDependency: number,\r\n    avgMastery: number\r\n): 'low' | 'medium' | 'high' => {\r\n    // High risk: low accuracy OR high hint dependency OR low mastery\r\n    if (accuracy < 0.4 || hintDependency > 0.7 || avgMastery < 0.3) {\r\n        return 'high';\r\n    }\r\n    // Medium risk: moderate performance\r\n    if (accuracy < 0.7 || hintDependency > 0.4 || avgMastery < 0.6) {\r\n        return 'medium';\r\n    }\r\n    // Low risk: good performance\r\n    return 'low';\r\n};\r\n\r\n/**\r\n * Convert session interactions to journey nodes\r\n */\r\nconst sessionsToJourney = (sessions: any[]): JourneyNode[] => {\r\n    const nodes: JourneyNode[] = [];\r\n\r\n    sessions.forEach(session => {\r\n        if (!session.interactions) return;\r\n\r\n        session.interactions.forEach((interaction: any) => {\r\n            // Determine node type\r\n            let nodeType: JourneyNode['type'] = 'question';\r\n            if (interaction.type === 'text' || interaction.type === 'video' || interaction.type === 'pdf') {\r\n                nodeType = 'content';\r\n            } else if (interaction.isRemediation) {\r\n                nodeType = '◊î◊ë◊†◊î';  // Remediation uses ◊î◊ë◊†◊î (Understanding) variant\r\n            } else if (interaction.wasSkipped) {\r\n                nodeType = 'skipped';\r\n            }\r\n\r\n            // Determine status\r\n            let status: JourneyNode['status'] = 'viewed';\r\n            if (interaction.isCorrect === true) {\r\n                status = 'success';\r\n            } else if (interaction.isCorrect === false) {\r\n                status = 'failure';\r\n            } else if (interaction.wasSkipped) {\r\n                status = 'skipped';\r\n            }\r\n\r\n            nodes.push({\r\n                id: interaction.questionId || `node-${nodes.length}`,\r\n                type: nodeType,\r\n                status,\r\n                timestamp: interaction.timestamp || session.startTime,\r\n                blockId: interaction.questionId,\r\n                blockType: interaction.type,\r\n                variantUsed: interaction.variantUsed,\r\n                connection: interaction.isRemediation ? 'branched' : 'direct',\r\n                metadata: {\r\n                    responseTime: interaction.responseTime,\r\n                    hintsUsed: interaction.hintsUsed,\r\n                    attemptCount: interaction.attemptCount\r\n                }\r\n            });\r\n        });\r\n    });\r\n\r\n    // Sort by timestamp\r\n    return nodes.sort((a, b) => a.timestamp - b.timestamp);\r\n};\r\n\r\n/**\r\n * Get analytics for all students enrolled in a course\r\n */\r\nexport const getCourseAnalytics = async (courseId: string): Promise<StudentAnalytics[]> => {\r\n    try {\r\n        // 1. Get all enrollments for this course\r\n        const enrollmentsRef = collection(db, 'enrollments');\r\n        const enrollmentsQuery = query(\r\n            enrollmentsRef,\r\n            where('courseId', '==', courseId)\r\n        );\r\n        const enrollmentsSnap = await getDocs(enrollmentsQuery);\r\n\r\n        if (enrollmentsSnap.empty) {\r\n            console.log(`No enrollments found for course ${courseId}`);\r\n            return [];\r\n        }\r\n\r\n        const studentIds = enrollmentsSnap.docs.map(doc => doc.data().studentId);\r\n\r\n        // 2. Fetch data for each student in parallel\r\n        const analyticsPromises = studentIds.map(studentId => getStudentAnalytics(studentId, courseId));\r\n        const results = await Promise.all(analyticsPromises);\r\n\r\n        // Filter out null results\r\n        return results.filter((r): r is StudentAnalytics => r !== null);\r\n\r\n    } catch (error) {\r\n        console.error('Error fetching course analytics:', error);\r\n        // Fallback to empty array (or could use mock data for dev)\r\n        return [];\r\n    }\r\n};\r\n\r\n/**\r\n * Get detailed analytics for a single student\r\n */\r\nexport const getStudentAnalytics = async (\r\n    studentId: string,\r\n    courseId?: string\r\n): Promise<StudentAnalytics | null> => {\r\n    try {\r\n        // 1. Get user basic info\r\n        const userRef = doc(db, 'users', studentId);\r\n        const userSnap = await getDoc(userRef);\r\n\r\n        if (!userSnap.exists()) {\r\n            console.warn(`User ${studentId} not found`);\r\n            return null;\r\n        }\r\n\r\n        const userData = userSnap.data();\r\n\r\n        // 2. Get profile stats\r\n        const statsRef = doc(db, 'users', studentId, 'profile', 'stats');\r\n        const statsSnap = await getDoc(statsRef);\r\n        const stats = statsSnap.exists() ? statsSnap.data() : null;\r\n\r\n        // 3. Get proficiency vector\r\n        const proficiencyRef = doc(db, 'users', studentId, 'profile', 'proficiency_vector');\r\n        const proficiencySnap = await getDoc(proficiencyRef);\r\n        const proficiency = proficiencySnap.exists() ? proficiencySnap.data() : null;\r\n\r\n        // 4. Get error fingerprint\r\n        const errorRef = doc(db, 'users', studentId, 'profile', 'error_fingerprint');\r\n        const errorSnap = await getDoc(errorRef);\r\n        const errorFingerprint = errorSnap.exists() ? errorSnap.data() : null;\r\n\r\n        // 5. Get recent sessions (for journey trace)\r\n        const sessionsRef = collection(db, 'users', studentId, 'sessions');\r\n        let sessionsQuery = query(sessionsRef, orderBy('startTime', 'desc'), limit(20));\r\n\r\n        // If courseId provided, filter by it\r\n        if (courseId) {\r\n            sessionsQuery = query(\r\n                sessionsRef,\r\n                where('courseId', '==', courseId),\r\n                orderBy('startTime', 'desc'),\r\n                limit(20)\r\n            );\r\n        }\r\n\r\n        const sessionsSnap = await getDocs(sessionsQuery);\r\n        const sessions = sessionsSnap.docs.map(doc => doc.data());\r\n\r\n        // 6. Calculate derived metrics\r\n        const mastery = proficiency?.topics || {};\r\n        const avgMastery = Object.values(mastery).length > 0\r\n            ? Object.values(mastery as Record<string, number>).reduce((a, b) => a + b, 0) / Object.values(mastery).length\r\n            : 0.5;\r\n\r\n        const accuracy = stats?.performance?.global_accuracy_rate || 0.5;\r\n        const hintDependency = stats?.behavioral?.hint_dependency_score || 0;\r\n\r\n        const riskLevel = calculateRiskLevel(accuracy, hintDependency, avgMastery);\r\n\r\n        // 7. Build journey from sessions\r\n        const journey = sessionsToJourney(sessions);\r\n\r\n        // 8. Construct analytics object\r\n        return {\r\n            id: studentId,\r\n            name: userData.displayName || userData.name || '◊™◊ú◊û◊ô◊ì',\r\n            email: userData.email,\r\n            avatar: userData.photoURL || `https://api.dicebear.com/7.x/avataaars/svg?seed=${studentId}`,\r\n            mastery: mastery as Record<string, number>,\r\n            lastActive: stats?.engagement?.last_active_at?.toDate?.()?.toISOString() ||\r\n                userData.lastLogin?.toDate?.()?.toISOString() ||\r\n                new Date().toISOString(),\r\n            riskLevel,\r\n            journey,\r\n            performance: {\r\n                accuracy,\r\n                avgResponseTime: stats?.performance?.average_response_time_sec || 0,\r\n                totalQuestions: stats?.performance?.total_questions_attempted || 0,\r\n                hintDependency\r\n            },\r\n            errorPatterns: errorFingerprint?.errorTags || {}\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error(`Error fetching analytics for student ${studentId}:`, error);\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * Get class-wide mastery summary for heatmap\r\n */\r\nexport const getClassMasteryHeatmap = async (courseId: string): Promise<{\r\n    students: { id: string; name: string }[];\r\n    topics: string[];\r\n    data: number[][]; // [studentIndex][topicIndex] = mastery\r\n}> => {\r\n    const analytics = await getCourseAnalytics(courseId);\r\n\r\n    if (analytics.length === 0) {\r\n        return { students: [], topics: [], data: [] };\r\n    }\r\n\r\n    // Collect all unique topics\r\n    const topicsSet = new Set<string>();\r\n    analytics.forEach(student => {\r\n        Object.keys(student.mastery).forEach(topic => topicsSet.add(topic));\r\n    });\r\n    const topics = Array.from(topicsSet);\r\n\r\n    // Build data matrix\r\n    const students = analytics.map(s => ({ id: s.id, name: s.name }));\r\n    const data = analytics.map(student =>\r\n        topics.map(topic => student.mastery[topic] || 0)\r\n    );\r\n\r\n    return { students, topics, data };\r\n};\r\n\r\n/**\r\n * Get at-risk students for a course\r\n */\r\nexport const getAtRiskStudents = async (courseId: string): Promise<StudentAnalytics[]> => {\r\n    const analytics = await getCourseAnalytics(courseId);\r\n    return analytics.filter(s => s.riskLevel === 'high' || s.riskLevel === 'medium');\r\n};\r\n\r\n/**\r\n * Get journey trace for visualization\r\n */\r\nexport const getStudentJourneyTrace = async (\r\n    studentId: string,\r\n    courseId?: string\r\n): Promise<JourneyNode[]> => {\r\n    const analytics = await getStudentAnalytics(studentId, courseId);\r\n    return analytics?.journey || [];\r\n};\r\n\r\n// ============================================\r\n// FALLBACK: Mock data for development/testing\r\n// ============================================\r\n\r\nconst MOCK_TOPICS = ['◊©◊ë◊®◊ô◊ù ◊§◊©◊ï◊ò◊ô◊ù', '◊©◊ë◊®◊ô◊ù ◊û◊ï◊®◊õ◊ë◊ô◊ù', '◊¢◊©◊®◊ï◊†◊ô◊ô◊ù', '◊ê◊ó◊ï◊ñ◊ô◊ù', '◊ô◊ó◊° ◊ï◊§◊®◊ï◊§◊ï◊®◊¶◊ô◊î'];\r\n\r\n/**\r\n * 3 Demo Students representing different learner profiles:\r\n * 1. Struggling - needs ◊î◊ë◊†◊î (Understanding), high risk\r\n * 2. Average - uses ◊ô◊ô◊©◊ï◊ù (Application/original), medium risk\r\n * 3. Advanced - gets ◊î◊¢◊û◊ß◊î (Deepening), low risk\r\n */\r\nconst MOCK_STUDENTS = [\r\n    {\r\n        id: 'demo-struggling',\r\n        name: '◊ì◊†◊ô ◊õ◊î◊ü',\r\n        email: 'dani@demo.wizdi.co',\r\n        risk: 'high' as const,\r\n        profile: 'struggling',\r\n        expectedVariant: '◊î◊ë◊†◊î',\r\n        mastery: { base: 0.28, variance: 0.1 },\r\n        performance: {\r\n            accuracy: 0.35,\r\n            avgResponseTime: 38,\r\n            totalQuestions: 42,\r\n            hintDependency: 0.72\r\n        },\r\n        errorPatterns: {\r\n            '◊©◊í◊ô◊ê◊™ ◊ó◊ô◊©◊ï◊ë': 15,\r\n            '◊©◊í◊ô◊ê◊™ ◊°◊ô◊û◊ü': 8,\r\n            '◊ê◊ô ◊î◊ë◊†◊™ ◊û◊ï◊©◊í': 6,\r\n            '◊ó◊ô◊ë◊ï◊® ◊©◊ë◊®◊ô◊ù ◊ú◊ú◊ê ◊û◊õ◊†◊î ◊û◊©◊ï◊™◊£': 4\r\n        }\r\n    },\r\n    {\r\n        id: 'demo-average',\r\n        name: '◊û◊ô◊õ◊ú ◊ú◊ï◊ô',\r\n        email: 'michal@demo.wizdi.co',\r\n        risk: 'medium' as const,\r\n        profile: 'average',\r\n        expectedVariant: '◊ô◊ô◊©◊ï◊ù',\r\n        mastery: { base: 0.58, variance: 0.15 },\r\n        performance: {\r\n            accuracy: 0.67,\r\n            avgResponseTime: 22,\r\n            totalQuestions: 65,\r\n            hintDependency: 0.28\r\n        },\r\n        errorPatterns: {\r\n            '◊©◊í◊ô◊ê◊™ ◊ó◊ô◊©◊ï◊ë': 5,\r\n            '◊©◊í◊ô◊ê◊™ ◊®◊©◊ú◊†◊ï◊™': 3,\r\n            '◊©◊í◊ô◊ê◊™ ◊°◊ô◊û◊ü': 2\r\n        }\r\n    },\r\n    {\r\n        id: 'demo-advanced',\r\n        name: '◊ô◊ï◊°◊ô ◊§◊®◊•',\r\n        email: 'yossi@demo.wizdi.co',\r\n        risk: 'low' as const,\r\n        profile: 'advanced',\r\n        expectedVariant: '◊î◊¢◊û◊ß◊î',\r\n        mastery: { base: 0.91, variance: 0.05 },\r\n        performance: {\r\n            accuracy: 0.94,\r\n            avgResponseTime: 11,\r\n            totalQuestions: 85,\r\n            hintDependency: 0.03\r\n        },\r\n        errorPatterns: {\r\n            '◊©◊í◊ô◊ê◊™ ◊®◊©◊ú◊†◊ï◊™': 2\r\n        }\r\n    }\r\n];\r\n\r\n/**\r\n * Generate mock journey for testing with variant information\r\n * - Struggling students (high risk) ‚Üí get ◊î◊ë◊†◊î (Understanding) variants\r\n * - Average students (medium risk) ‚Üí get ◊ô◊ô◊©◊ï◊ù (Application) variants\r\n * - Advanced students (low risk) ‚Üí get ◊î◊¢◊û◊ß◊î (Deepening) variants\r\n */\r\nconst generateMockJourney = (risk: 'low' | 'medium' | 'high'): JourneyNode[] => {\r\n    const nodes: JourneyNode[] = [];\r\n    const now = Date.now();\r\n    let time = now - 1000 * 60 * 60;\r\n\r\n    // Determine primary variant based on risk level\r\n    const primaryVariant: '◊î◊ë◊†◊î' | '◊ô◊ô◊©◊ï◊ù' | '◊î◊¢◊û◊ß◊î' =\r\n        risk === 'high' ? '◊î◊ë◊†◊î' :\r\n        risk === 'low' ? '◊î◊¢◊û◊ß◊î' : '◊ô◊ô◊©◊ï◊ù';\r\n\r\n    for (let i = 1; i <= 8; i++) {\r\n        const success = risk === 'low' ? Math.random() > 0.1 :\r\n            risk === 'medium' ? Math.random() > 0.4 :\r\n                Math.random() > 0.7;\r\n\r\n        // Add content block first (every other question)\r\n        if (i % 2 === 1) {\r\n            nodes.push({\r\n                id: `content-${i}`,\r\n                type: 'content',\r\n                status: 'viewed',\r\n                timestamp: time,\r\n                connection: 'direct',\r\n                variantUsed: primaryVariant\r\n            });\r\n            time += 1000 * 60 * 2;\r\n        }\r\n\r\n        // Determine variant for this question\r\n        // Sometimes the system adjusts mid-activity based on performance\r\n        let questionVariant = primaryVariant;\r\n        if (risk === 'high' && i > 4 && Math.random() > 0.7) {\r\n            // Struggling student improving - might get ◊ô◊ô◊©◊ï◊ù\r\n            questionVariant = '◊ô◊ô◊©◊ï◊ù';\r\n        } else if (risk === 'low' && !success) {\r\n            // Advanced student struggling on one - might get ◊ô◊ô◊©◊ï◊ù\r\n            questionVariant = '◊ô◊ô◊©◊ï◊ù';\r\n        }\r\n\r\n        nodes.push({\r\n            id: `step-${i}`,\r\n            type: 'question',\r\n            status: success ? 'success' : 'failure',\r\n            timestamp: time,\r\n            connection: 'direct',\r\n            variantUsed: questionVariant\r\n        });\r\n        time += 1000 * 60 * 5;\r\n\r\n        if (!success) {\r\n            // Remediation question - student usually succeeds (80%) on easier reinforcement question\r\n            const remediationSuccess = Math.random() > 0.2;\r\n            nodes.push({\r\n                id: `remedial-${i}`,\r\n                type: '◊î◊ë◊†◊î',  // Remediation uses ◊î◊ë◊†◊î (Understanding) level\r\n                status: remediationSuccess ? 'success' : 'failure',\r\n                timestamp: time,\r\n                connection: 'branched',\r\n                variantUsed: '◊î◊ë◊†◊î' // Remediation is always ◊î◊ë◊†◊î (Understanding)\r\n            });\r\n            time += 1000 * 60 * 3;\r\n        }\r\n    }\r\n    return nodes;\r\n};\r\n\r\n/**\r\n * Get mock data for development (when Firestore is empty)\r\n * Returns 3 students with different profiles for testing adaptive features\r\n */\r\nexport const getMockCourseAnalytics = async (_courseId: string): Promise<StudentAnalytics[]> => {\r\n    await new Promise(r => setTimeout(r, 300));\r\n\r\n    return MOCK_STUDENTS.map(s => {\r\n        // Generate topic mastery based on student profile\r\n        const mastery: Record<string, number> = {};\r\n        MOCK_TOPICS.forEach(t => {\r\n            const variance = (Math.random() - 0.5) * s.mastery.variance * 2;\r\n            mastery[t] = Math.min(1, Math.max(0, s.mastery.base + variance));\r\n        });\r\n\r\n        return {\r\n            id: s.id,\r\n            name: s.name,\r\n            email: s.email,\r\n            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${s.id}`,\r\n            mastery,\r\n            lastActive: new Date().toISOString(),\r\n            riskLevel: s.risk,\r\n            journey: generateMockJourney(s.risk),\r\n            performance: s.performance,\r\n            errorPatterns: s.errorPatterns\r\n        };\r\n    });\r\n};\r\n\r\n/**\r\n * Smart analytics getter - uses real data if available, falls back to mock\r\n */\r\nexport const getSmartCourseAnalytics = async (courseId: string): Promise<StudentAnalytics[]> => {\r\n    const realData = await getCourseAnalytics(courseId);\r\n\r\n    if (realData.length > 0) {\r\n        console.log(`üìä Loaded ${realData.length} real students for course ${courseId}`);\r\n        return realData;\r\n    }\r\n\r\n    console.log(`üìä No real data found, using mock data for course ${courseId}`);\r\n    return getMockCourseAnalytics(courseId);\r\n};\r\n"],"names":["calculateRiskLevel","accuracy","hintDependency","avgMastery","sessionsToJourney","sessions","nodes","session","interaction","nodeType","status","a","b","getCourseAnalytics","courseId","enrollmentsRef","collection","db","enrollmentsQuery","query","where","enrollmentsSnap","getDocs","analyticsPromises","doc","getStudentAnalytics","studentId","r","error","userRef","userSnap","getDoc","userData","statsRef","statsSnap","stats","proficiencyRef","proficiencySnap","proficiency","errorRef","errorSnap","errorFingerprint","sessionsRef","sessionsQuery","orderBy","limit","mastery","_a","_b","riskLevel","journey","_f","_e","_d","_c","_i","_h","_g","_j","_k","MOCK_TOPICS","MOCK_STUDENTS","generateMockJourney","risk","time","primaryVariant","i","success","questionVariant","remediationSuccess","getMockCourseAnalytics","_courseId","s","variance","getSmartCourseAnalytics","realData"],"mappings":"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"}