import{J as xe,b0 as ue,b1 as he,r as i,cb as be,cc as me,bh as ge,j as e,cd as fe,ce as pe,I as ke,k as Z,d as ee,g as ye,h as we,bk as je,cf as ve,bd as Ne,a4 as Se,b6 as Ce,cg as _e,b7 as Ie,b9 as ze,bb as Te,bc as Ae,aY as L}from"./index-1x3sw4DL.js";const Me=({amount:$,onComplete:h})=>(i.useEffect(()=>{const Q=setTimeout(h,1e3);return()=>clearTimeout(Q)},[h]),e.jsx("div",{className:"fixed top-1/3 left-1/2 -translate-x-1/2 pointer-events-none z-50 animate-bounce motion-reduce:animate-none",children:e.jsxs("span",{className:"text-3xl font-black text-yellow-400 drop-shadow-lg",children:["+",$," XP"]})})),Qe=({assignment:$,onExit:h,simulateGuest:Q=!1})=>{const{course:a}=xe(),{currentUser:x}=ue(),N=he(),[S,te]=i.useState([]),[c,q]=i.useState(0),[y,H]=i.useState([]),[w,R]=i.useState("content"),se=!!(a!=null&&a.pdfSource||a!=null&&a.fullBookContent),ae=(a==null?void 0:a.showSourceToStudent)&&se,[j,re]=i.useState({}),[r,v]=i.useState("idle"),[C,g]=i.useState(null),[ne,D]=i.useState({}),[le,Fe]=i.useState({}),[E,G]=i.useState(!1),[_,O]=i.useState(be),[U,V]=i.useState(null),s=S[c],I=c===S.length-1,X=c===0,J=(a==null?void 0:a.mode)==="exam";i.useEffect(()=>{if(a!=null&&a.syllabus){const t=a.syllabus.flatMap(l=>l.learningUnits.flatMap(m=>m.activityBlocks||[]));te(t)}},[a]),i.useEffect(()=>{x!=null&&x.uid&&me(x.uid).then(t=>{O(l=>({...l,currentStreak:t.currentStreak,frozenDays:t.frozenDays}))})},[x]),i.useEffect(()=>{if(!s)return;const t=ne[s.id];t?(v(t==="viewed"?"idle":t),g(null)):(v("idle"),g(null)),R("content")},[c,s==null?void 0:s.id]);const z=i.useCallback(()=>{if(I){h==null||h();return}H(t=>[...t,c]),q(t=>t+1)},[c,I,h]),ie=i.useCallback(()=>{if(y.length>0){const t=y[y.length-1];H(l=>l.slice(0,-1)),q(t)}else c>0&&q(t=>t-1)},[c,y]),Y=t=>{r==="success"||r==="failure"||(re(l=>({...l,[s.id]:t})),v("ready_to_check"))},b=async t=>{D(u=>({...u,[s.id]:t?"success":"failure"}));const l=le[s.id]||0,m=je({isCorrect:t,attempts:1,hintsUsed:l});if(t){v("success"),N("success"),g("××¦×•×™×Ÿ! ×ª×©×•×‘×” × ×›×•× ×”");const u=Math.round(m*.5);O(d=>({...d,xp:d.xp+u,gems:d.gems+1})),V({id:Date.now(),amount:u})}else v("failure"),N("failure"),g("×˜×¢×•×ª, × ×¡×” ×©×•×‘");x!=null&&x.uid&&!Q&&await ve(x.uid,_)},oe=i.useCallback(async()=>{var m,u,d,T,A,n,M,f,p,k;if(["text","video","image","pdf","gem-link","podcast"].includes(s.type)){D(o=>({...o,[s.id]:"viewed"})),z();return}if(r==="success"||r==="failure"){z();return}const l=j[s.id];if(s.type==="multiple-choice"){if(!l)return;const o=l===s.content.correctAnswer;b(o)}else if(s.type==="open-question"){if(!l||l.trim().length<3)return;G(!0);try{const o=((M=(n=(A=(T=(d=(u=(m=a==null?void 0:a.syllabus)==null?void 0:m[0])==null?void 0:u.learningUnits)==null?void 0:d[0])==null?void 0:T.activityBlocks)==null?void 0:A.filter(B=>B.type==="text"))==null?void 0:n.map(B=>B.content))==null?void 0:M.join(`
`))||"",W=((f=s.content)==null?void 0:f.question)||"",F=((p=s.metadata)==null?void 0:p.modelAnswer)||((k=s.content)==null?void 0:k.modelAnswer)||"";console.log("ğŸ“ [Mobile] Checking open question:",{question:W,answer:l,modelAnswer:F==null?void 0:F.substring(0,50),sourceTextLength:o.length});const P=await ge(W,l,F,o,J?"exam":"learning");console.log("âœ… [Mobile] AI Response:",P),P.status==="correct"?(g(P.feedback||"××¦×•×™×Ÿ! ×ª×©×•×‘×” × ×›×•× ×”."),b(!0)):(g(P.feedback||"× ×¡×” ×©×•×‘"),N("failure"))}catch(o){console.error("âŒ [Mobile] Error checking answer:",o),g("×©×’×™××” ×‘×‘×“×™×§×”. "+((o==null?void 0:o.message)||""))}finally{G(!1)}}},[s,j,r,z,a,J,N]),ce=()=>{if(!s)return null;const t=s.content,l=s.type;switch(l){case"text":return e.jsx("div",{className:"prose prose-lg max-w-none text-slate-800 dark:text-slate-200",dangerouslySetInnerHTML:{__html:L(typeof t=="string"?t:"")}});case"video":const m=typeof t=="string"?t:t==null?void 0:t.url;return e.jsx("div",{className:"aspect-video w-full rounded-xl overflow-hidden bg-black",children:e.jsx("iframe",{src:m,className:"w-full h-full",allowFullScreen:!0,title:"×•×™×“××•",loading:"lazy"})});case"image":const u=typeof t=="string"?t:t==null?void 0:t.url;return e.jsx("img",{src:u,alt:s.title||"×ª××•× ×”",className:"max-w-full h-auto rounded-xl",loading:"lazy",decoding:"async"});case"multiple-choice":const d=t,T=j[s.id];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-6",dangerouslySetInnerHTML:{__html:L(d.question||"")}}),e.jsx("div",{className:"space-y-3",role:"radiogroup","aria-label":"××¤×©×¨×•×™×•×ª ×ª×©×•×‘×”",children:d.options.map((n,M)=>{const f=T===n,p=r==="success"||r==="failure",k=n===d.correctAnswer;let o="w-full min-h-[56px] p-4 text-right rounded-xl border-2 transition-all ";return p?k?o+="border-green-500 bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200":f&&!k?o+="border-red-500 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200":o+="border-gray-200 dark:border-slate-600 bg-gray-50 dark:bg-slate-700 opacity-50":o+=f?"border-violet-500 bg-violet-50 dark:bg-violet-900/30 text-violet-800 dark:text-violet-200":"border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-700 hover:border-violet-300 dark:hover:border-violet-500",e.jsxs("button",{onClick:()=>Y(n),disabled:p,role:"radio","aria-checked":f,className:o,children:[e.jsx("span",{className:"font-medium",children:n}),p&&k&&e.jsx(Z,{className:"inline-block mr-2 w-5 h-5 text-green-600","aria-hidden":"true"}),p&&f&&!k&&e.jsx(ee,{className:"inline-block mr-2 w-5 h-5 text-red-600","aria-hidden":"true"})]},M)})})]});case"open-question":const A=t;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4",dangerouslySetInnerHTML:{__html:L(A.question||"")}}),e.jsx("textarea",{value:j[s.id]||"",onChange:n=>Y(n.target.value),disabled:r==="success",placeholder:"×›×ª×•×‘ ××ª ×ª×©×•×‘×ª×š ×›××Ÿ...",className:`w-full min-h-[150px] p-4 text-lg border-2 border-gray-200 dark:border-slate-600 rounded-xl\r
                                     bg-white dark:bg-slate-700 text-slate-800 dark:text-white\r
                                     focus:border-violet-500 focus:ring-2 focus:ring-violet-200 dark:focus:ring-violet-800\r
                                     resize-none transition-colors`,dir:"rtl"})]});case"fill_in_blanks":return e.jsx(Ae,{block:s,onComplete:n=>b(n>=50)});case"ordering":return e.jsx(Te,{block:s,onComplete:n=>b(n>=50)});case"categorization":return e.jsx(ze,{block:s,onComplete:n=>b(n>=50)});case"memory_game":return e.jsx(Ie,{block:s,onComplete:n=>b(n>=50)});case"true_false_speed":return e.jsx(_e,{block:s,onComplete:n=>b(n>=50)});case"matching":return e.jsx(Ce,{block:s,onComplete:n=>b(n>=50)});case"podcast":return e.jsx(Se,{block:s});case"infographic":return e.jsx(Ne,{block:s});default:return e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 p-8",children:["×¡×•×’ ×ª×•×›×Ÿ ×œ× × ×ª××š: ",l]})}},de=()=>a!=null&&a.fullBookContent?e.jsx("div",{className:"p-4 prose max-w-none text-base leading-relaxed",dir:"rtl",children:e.jsx("div",{className:"font-serif text-slate-800 dark:text-slate-200 whitespace-pre-wrap",children:a.fullBookContent})}):a!=null&&a.pdfSource?e.jsxs("div",{className:"h-full flex flex-col min-h-[60vh]",children:[e.jsx("iframe",{src:a.pdfSource,className:"w-full flex-1 border-none rounded-lg",title:"××¡××š ××§×•×¨",loading:"lazy"}),e.jsx("div",{className:"p-3 bg-white dark:bg-slate-800 border-t text-center",children:e.jsx("a",{href:a.pdfSource,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"×¤×ª×— ××ª ×”××¡××š ×‘×—×œ×•×Ÿ ×—×“×© â†—"})})]}):e.jsx("div",{className:"text-center text-gray-500 p-8",children:"××™×Ÿ ××¡××š ××§×•×¨ ×–××™×Ÿ"});if(!a||a.id==="loading")return e.jsx("div",{className:"min-h-screen bg-wizdi-royal flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl font-bold animate-pulse motion-reduce:animate-none",children:"×˜×•×¢×Ÿ ×©×™×¢×•×¨..."})});if(!s)return e.jsx("div",{className:"min-h-screen bg-wizdi-royal flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl font-bold",children:"××™×Ÿ ×ª×•×›×Ÿ ×œ×”×¦×’×”"})});const K=Math.round((c+1)/S.length*100);return e.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-900 flex flex-col",dir:"rtl",children:[U&&e.jsx(Me,{amount:U.amount,onComplete:()=>V(null)}),e.jsx("header",{className:"bg-wizdi-royal dark:bg-slate-800 text-white px-4 py-3 safe-area-inset-top",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:h,className:"min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl bg-white/10 hover:bg-white/20 transition-colors","aria-label":"×™×¦×™××”",children:e.jsx(fe,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 mx-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx("span",{children:c+1}),e.jsx("span",{className:"text-white/60",children:"/"}),e.jsx("span",{children:S.length})]}),e.jsx("div",{className:"h-1.5 bg-white/20 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-wizdi-cyan rounded-full transition-all duration-300",style:{width:`${K}%`},role:"progressbar","aria-valuenow":K,"aria-valuemin":0,"aria-valuemax":100})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ğŸ”¥"}),e.jsx("span",{className:"font-bold text-sm",children:_.currentStreak})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-yellow-500/20 px-2 py-1 rounded-lg",children:[e.jsx(pe,{className:"w-4 h-4 text-yellow-300"}),e.jsx("span",{className:"font-bold text-sm text-yellow-300",children:_.xp})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:"ğŸ’"}),e.jsx("span",{className:"font-bold text-sm text-cyan-300",children:_.gems})]})]})]})}),ae&&e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 px-4",children:e.jsxs("div",{className:"flex",role:"tablist","aria-label":"×ª×¦×•×’×ª ×ª×•×›×Ÿ",children:[e.jsx("button",{onClick:()=>R("content"),role:"tab","aria-selected":w==="content",className:`flex-1 min-h-[48px] py-3 text-center font-bold transition-colors border-b-2 ${w==="content"?"border-wizdi-action text-wizdi-action dark:text-violet-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,children:"ğŸ“ ×ª×•×›×Ÿ"}),e.jsxs("button",{onClick:()=>R("source"),role:"tab","aria-selected":w==="source",className:`flex-1 min-h-[48px] py-3 text-center font-bold transition-colors border-b-2 ${w==="source"?"border-wizdi-action text-wizdi-action dark:text-violet-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,children:[e.jsx(ke,{className:"inline-block w-5 h-5 ml-1"}),"××§×•×¨"]})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-4 pb-32",children:[e.jsx("div",{role:"tabpanel","aria-label":w==="content"?"×ª×•×›×Ÿ ×”×©×™×¢×•×¨":"××¡××š ××§×•×¨",className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-5 min-h-[300px]",children:w==="content"?ce():de()}),C&&e.jsx("div",{role:"alert","aria-live":"polite",className:`mt-4 p-4 rounded-xl text-center font-bold ${r==="success"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-700":r==="failure"?"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-700":"bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 border border-amber-200 dark:border-amber-700"}`,children:e.jsx("span",{className:"flex items-center justify-center gap-2",children:r==="success"?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5","aria-hidden":"true"})," ",C]}):r==="failure"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5","aria-hidden":"true"})," ",C]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg","aria-hidden":"true",children:"ğŸ’­"})," ",C]})})})]}),e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 px-4 py-3 safe-area-inset-bottom",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:ie,disabled:X&&y.length===0,className:`min-w-[56px] min-h-[56px] flex items-center justify-center rounded-xl transition-all ${X&&y.length===0?"bg-gray-100 dark:bg-slate-700 text-gray-300 dark:text-slate-500 cursor-not-allowed":"bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-slate-600 active:scale-95"}`,"aria-label":"×”×§×•×“×",children:e.jsx(ye,{className:"w-7 h-7"})}),!["text","video","image","pdf","gem-link","podcast","activity-intro","scenario-image","infographic"].includes(s.type)&&e.jsx("button",{onClick:oe,disabled:E||r==="ready_to_check"&&!j[s.id],className:`flex-1 min-h-[56px] rounded-xl font-bold text-lg transition-all active:scale-[0.98] ${r==="success"?"bg-green-500 text-white":r==="failure"?"bg-orange-500 text-white":"bg-wizdi-action hover:bg-wizdi-action-hover text-white shadow-lg"} disabled:opacity-50 disabled:cursor-not-allowed`,"aria-label":r==="success"||r==="failure"?"×”××©×š":r==="ready_to_check"?"×‘×“×•×§":"×”××©×š",children:E?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"×‘×•×“×§..."]}):r==="success"||r==="failure"?"×”××©×š â†’":r==="ready_to_check"?"×‘×“×•×§ âœ“":"×‘×“×™×§×”"}),e.jsx("button",{onClick:z,disabled:I,className:`min-w-[56px] min-h-[56px] flex items-center justify-center rounded-xl transition-all ${I?"bg-gray-100 dark:bg-slate-700 text-gray-300 dark:text-slate-500 cursor-not-allowed":"bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-slate-600 active:scale-95"}`,"aria-label":"×”×‘×",children:e.jsx(we,{className:"w-7 h-7"})})]})})]})};export{Qe as default};
//# sourceMappingURL=SequentialCoursePlayerMobile-D_B-IH36.js.map
