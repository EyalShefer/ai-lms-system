const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1x3sw4DL.js","assets/index-D5UJlrDR.css","assets/TeacherDashboard-NaKQzVKi.js","assets/IconBrain-B9doffEc.js","assets/IconChartBar-C9Gh53Hd.js","assets/IconTrendingUp-i0z6cZ8R.js","assets/ShareModal-DLbWhIEc.js","assets/IconCalendar-DSCrS-DW.js","assets/IconUsers-Br9myKfl.js","assets/IconCopy-BTB5ujr3.js","assets/IconMail-BDnpP6ds.js"])))=>i.map(i=>d[i]);
import{r as m,c6 as S,z as O,bl as b,n as v,p as I,j as e,R as N,_,c7 as k,c8 as h,c9 as L}from"./index-1x3sw4DL.js";const D=["https://wizdi.co.il","https://www.wizdi.co.il","https://app.wizdi.co.il","https://staging.wizdi.co.il","http://localhost:3000","http://localhost:5173"];let o=null;function E(s){if(D.includes(s))return!0;try{const t=new URL(s);if(t.hostname.endsWith(".wizdi.co.il")||t.hostname==="wizdi.co.il")return!0}catch{return!1}return!1}function C(){if(o)return o;try{const s=document.referrer;if(s){const t=new URL(s).origin;if(E(t))return o=t,t}}catch{}return console.warn("[Wizdi Security] Could not validate parent origin, using wildcard. Please ensure ALLOWED_WIZDI_ORIGINS is configured correctly."),"*"}function P(){try{return window.self!==window.top}catch{return!0}}function V(){const s=new URLSearchParams(window.location.search);return{userId:s.get("userId"),token:s.get("ctoken"),locale:s.get("locale")||"he"}}function A(s,t){if(!P()){console.log("[Wizdi] Not embedded, skipping postMessage:",s,t);return}const i={source:"ai-lms-system",type:s,payload:t};try{const d=C();window.parent.postMessage(i,d),console.log("[Wizdi] Sent event:",s,"to origin:",d)}catch(d){console.error("[Wizdi] Failed to send event:",d)}}function G(s,t){A("APPLICATION_LOADED",{userId:s,isTeacher:t,timestamp:new Date().toISOString()})}function f(s,t,i){A("ERROR",{code:s,message:t,context:i})}let g=[];function U(s){return g.push(s),()=>{g=g.filter(t=>t!==s)}}function M(){const s=t=>{if(!E(t.origin))return;!o&&t.origin&&(o=t.origin,console.log("[Wizdi] Validated parent origin:",t.origin));const i=t.data;if(!i||typeof i!="object"||!i.type)return;if(["NAVIGATE_TO_TASK","NAVIGATE_TO_COURSE","REFRESH_DATA"].includes(i.type)){if(console.log("[Wizdi] Received command:",i.type,"from:",t.origin),i.type==="NAVIGATE_TO_TASK"&&i.taskId&&!/^[a-zA-Z0-9_-]{1,100}$/.test(i.taskId)){console.warn("[Wizdi Security] Invalid taskId format received");return}if(i.type==="NAVIGATE_TO_COURSE"){if(i.courseId&&!/^[a-zA-Z0-9_-]{1,100}$/.test(i.courseId)){console.warn("[Wizdi Security] Invalid courseId format received");return}if(i.unitId&&!/^[a-zA-Z0-9_-]{1,100}$/.test(i.unitId)){console.warn("[Wizdi Security] Invalid unitId format received");return}}g.forEach(u=>u(i))}};return window.addEventListener("message",s),console.log("[Wizdi] Message listener initialized with origin validation"),()=>{window.removeEventListener("message",s),o=null}}N.lazy(()=>_(()=>import("./index-1x3sw4DL.js").then(s=>s.cE),__vite__mapDeps([0,1])));N.lazy(()=>_(()=>import("./TeacherDashboard-NaKQzVKi.js"),__vite__mapDeps([2,0,1,3,4,5,6,7,8,9,10])));const z=({view:s})=>{const[t,i]=m.useState(!0),[d,u]=m.useState(null),[p,w]=m.useState(null),[y,R]=m.useState(!1);m.useEffect(()=>{const{userId:a,token:l,locale:x}=V();if(!a||!l){u("×—×¡×¨×™× ×¤×¨××˜×¨×™× × ×“×¨×©×™× (userId, ctoken)"),i(!1),f("MISSING_PARAMS","Missing userId or ctoken");return}const r=M(),n=U(j=>{W(j)});return T(l,a,x),()=>{r(),n()}},[]);const T=async(a,l,x)=>{try{await S(O,a);const r=await b(v(I,"wizdi_users",l));if(r.exists()){const n=r.data();w({id:l,isTeacher:n.isTeacher,displayName:n.displayName,locale:n.locale||x,schoolId:n.schoolId,classes:n.classes||[]})}else{const n=await b(v(I,"users",l));if(n.exists()){const j=n.data();w({id:l,isTeacher:s==="teacher",displayName:j.displayName,locale:x,classes:[]})}else w({id:l,isTeacher:s==="teacher",locale:x,classes:[]})}R(!0),i(!1),G(l,s==="teacher")}catch(r){console.error("Wizdi auth error:",r),r.code==="auth/invalid-custom-token"||r.code==="auth/custom-token-mismatch"?(u("×˜×•×§×Ÿ ×œ× ×ª×§×™×Ÿ ××• ×¤×’ ×ª×•×§×£"),f("TOKEN_EXPIRED","Invalid or expired token")):(u("×©×’×™××” ×‘××™××•×ª: "+r.message),f("INTERNAL_ERROR",r.message)),i(!1)}},W=a=>{switch(console.log("[WizdiEmbed] Received command:",a),a.type){case"NAVIGATE_TO_TASK":a.taskId&&(window.location.hash=`#task=${a.taskId}`);break;case"NAVIGATE_TO_COURSE":a.courseId&&(window.location.hash=`#course=${a.courseId}`);break;case"REFRESH_DATA":window.location.reload();break}};return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",dir:"rtl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"×˜×•×¢×Ÿ..."})]})}):d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",dir:"rtl",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md text-center",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"×©×’×™××”"}),e.jsx("p",{className:"text-slate-600 mb-4",children:d}),e.jsx("p",{className:"text-sm text-slate-400",children:"×× × × ×¡×” ×œ×˜×¢×•×Ÿ ××—×“×© ××• ×¤× ×” ×œ×ª××™×›×”"})]})}):!y||!p?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50",dir:"rtl",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md text-center",children:[e.jsx("div",{className:"text-yellow-500 text-5xl mb-4",children:"ğŸ”’"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-2",children:"××™××•×ª × ×“×¨×©"}),e.jsx("p",{className:"text-slate-600",children:"×× × ×”×ª×—×‘×¨ ×“×¨×š Wizdi ×›×“×™ ×œ×’×©×ª ×œ××¢×¨×›×ª"})]})}):e.jsx("div",{className:"wizdi-embed-container",dir:"rtl",children:e.jsx(N.Suspense,{fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:s==="teacher"?e.jsx(Z,{userData:p}):e.jsx($,{userData:p})})})},Z=({userData:s})=>e.jsx("div",{className:"wizdi-teacher-view",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:["×©×œ×•×, ",s.displayName||"××•×¨×”"]}),e.jsx("p",{className:"text-slate-600",children:"×‘×¨×•×›×™× ×”×‘××™× ×œ××¢×¨×›×ª ×”×œ××™×“×” ×”×—×›××”"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{title:"×§×•×¨×¡×™×",value:"-",icon:"ğŸ“š"}),e.jsx(c,{title:"×ª×œ××™×“×™×",value:"-",icon:"ğŸ‘¥"}),e.jsx(c,{title:"××©×™××•×ª ×”×©×‘×•×¢",value:"-",icon:"ğŸ“"}),e.jsx(c,{title:"×”×’×©×•×ª ×××ª×™× ×•×ª",value:"-",icon:"ğŸ“¥"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-blue-700",children:"×”×“×©×‘×•×¨×“ ×”××œ× ×™×•×¦×’ ×›××Ÿ - ×›×•×œ×œ × ×™×”×•×œ ×§×•×¨×¡×™×, ××¢×§×‘ ×ª×œ××™×“×™×, ×•× ×ª×•× ×™× ×¡×˜×˜×™×¡×˜×™×™×"})})]})}),$=({userData:s})=>e.jsx("div",{className:"wizdi-student-view",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 mb-2",children:["×©×œ×•×, ",s.displayName||"×ª×œ××™×“"]}),e.jsx("p",{className:"text-slate-600",children:"×”××©×™××•×ª ×©×œ×š ×××ª×™× ×•×ª ×œ×š"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{title:"××©×™××•×ª ×¤×ª×•×—×•×ª",value:"-",icon:"ğŸ“"}),e.jsx(c,{title:"×¦×™×•×Ÿ ×××•×¦×¢",value:"-",icon:"â­"}),e.jsx(c,{title:"× ×§×•×“×•×ª XP",value:"-",icon:"ğŸ’"}),e.jsx(c,{title:"×™××™ ×¨×¦×£",value:"-",icon:"ğŸ”¥"})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-green-700",children:"×¨×©×™××ª ×”××©×™××•×ª ×©×œ×š ×ª×•×¦×’ ×›××Ÿ - ×›×•×œ×œ ××©×™××•×ª ×¤×ª×•×—×•×ª, ×”×ª×§×“××•×ª, ×•×¦×™×•× ×™×"})})]})}),c=({title:s,value:t,icon:i})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-1",children:i}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:t}),e.jsx("div",{className:"text-sm text-slate-500",children:s})]}),X=()=>e.jsxs(k,{children:[e.jsx(h,{path:"teacher",element:e.jsx(z,{view:"teacher"})}),e.jsx(h,{path:"student",element:e.jsx(z,{view:"student"})}),e.jsx(h,{path:"task/:taskId",element:e.jsx(K,{})}),e.jsx(h,{path:"course/:courseId",element:e.jsx(F,{})}),e.jsx(h,{path:"*",element:e.jsx(L,{to:"student",replace:!0})})]}),K=()=>{const s=window.location.pathname.split("/").pop();return e.jsx("div",{className:"wizdi-task-view",dir:"rtl",children:e.jsx("div",{className:"min-h-screen bg-slate-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:["××©×™××”: ",s]}),e.jsx("p",{className:"text-slate-600",children:"×ª×¦×•×’×ª ×”××©×™××” ×ª×™×˜×¢×Ÿ ×›××Ÿ"})]})})})},F=()=>{const s=window.location.pathname.split("/"),t=s[s.indexOf("course")+1];return e.jsx("div",{className:"wizdi-course-view",dir:"rtl",children:e.jsx("div",{className:"min-h-screen bg-slate-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:["×§×•×¨×¡: ",t]}),e.jsx("p",{className:"text-slate-600",children:"×ª×•×›×Ÿ ×”×§×•×¨×¡ ×™×™×˜×¢×Ÿ ×›××Ÿ"})]})})})};export{X as WizdiRoutes,X as default};
//# sourceMappingURL=WizdiRouter-CAcOvrr7.js.map
