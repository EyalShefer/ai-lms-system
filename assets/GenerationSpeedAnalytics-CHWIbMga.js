import{c as M,b0 as q,r as o,j as e,bs as H,H as A,aw as J,p as V,bz as Z,bA as K,c2 as Q,c1 as W,bZ as X,bJ as ee,bu as te,bN as N,bv as se}from"./index-1x3sw4DL.js";import{I as P}from"./IconChartBar-C9Gh53Hd.js";import{I as ae}from"./IconFilter-DfFt1YBi.js";import{I as le}from"./IconCalendar-DSCrS-DW.js";import{I as C}from"./IconChevronDown-BNmdE9By.js";import{I as S}from"./IconChevronUp-CahN5a1t.js";/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2",key:"svg-0"}],["path",{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z",key:"svg-1"}]],ne=M("outline","clipboard","Clipboard",re);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]],E=M("outline","player-play","PlayerPlay",ce),z={lesson:{label:"מערך שיעור",color:"bg-blue-100 text-blue-700",icon:e.jsx(te,{size:16})},activity:{label:"פעילות לתלמיד",color:"bg-green-100 text-green-700",icon:e.jsx(E,{size:16})},exam:{label:"מבחן",color:"bg-purple-100 text-purple-700",icon:e.jsx(ne,{size:16})},podcast:{label:"פודקאסט",color:"bg-amber-100 text-amber-700",icon:e.jsx(E,{size:16})}},I={text:{label:"טקסט",color:"bg-slate-100 text-slate-700",icon:e.jsx(N,{size:16})},youtube:{label:"YouTube",color:"bg-red-100 text-red-700",icon:e.jsx(se,{size:16})},pdf:{label:"PDF",color:"bg-orange-100 text-orange-700",icon:e.jsx(N,{size:16})},url:{label:"URL",color:"bg-cyan-100 text-cyan-700",icon:e.jsx(N,{size:16})},manual:{label:"ידני",color:"bg-gray-100 text-gray-700",icon:e.jsx(N,{size:16})}},x=p=>{if(p<1e3)return`${p}ms`;const d=p/1e3;if(d<60)return`${d.toFixed(1)}s`;const i=Math.floor(d/60),g=d%60;return`${i}:${g.toFixed(0).padStart(2,"0")}`},ie=(p,d)=>{const i={lesson:{fast:30,medium:60},activity:{fast:25,medium:45},exam:{fast:40,medium:70},podcast:{fast:20,medium:40}},g=i[d]||i.lesson,u=p/1e3;return u<=g.fast?{label:"מהיר",color:"bg-green-100 text-green-700"}:u<=g.medium?{label:"סביר",color:"bg-amber-100 text-amber-700"}:{label:"איטי",color:"bg-red-100 text-red-700"}},ge=({className:p=""})=>{const{isAdmin:d}=q(),[i,g]=o.useState([]),[u,D]=o.useState(!0),[k,$]=o.useState(null),[b,_]=o.useState("all"),[f,G]=o.useState("all"),[v,O]=o.useState(7),[m,L]=o.useState("createdAt"),[j,F]=o.useState("desc"),R=async()=>{if(d){D(!0),$(null);try{const t=J(V,"generationTimings"),a=new Date;a.setDate(a.getDate()-v);const s=Z(t,K("createdAt",">=",Q.fromDate(a)),W("createdAt","desc"),X(500)),n=(await ee(s)).docs.map(c=>({id:c.id,...c.data()}));g(n)}catch(t){console.error("Error fetching timing data:",t),$(t.message||"שגיאה בטעינת נתונים")}finally{D(!1)}}};o.useEffect(()=>{R()},[d,v]);const T=o.useMemo(()=>{let t=[...i];return b!=="all"&&(t=t.filter(a=>a.productType===b)),f!=="all"&&(t=t.filter(a=>a.sourceType===f)),t.sort((a,s)=>{let l=0;return m==="createdAt"?l=a.createdAt.seconds-s.createdAt.seconds:m==="total"?l=a.timings.total-s.timings.total:m==="productType"&&(l=a.productType.localeCompare(s.productType)),j==="desc"?-l:l}),t},[i,b,f,m,j]),U=o.useMemo(()=>{const t={};return["lesson","activity","exam","podcast"].forEach(s=>{const l=i.filter(r=>r.productType===s);if(l.length===0){t[s]={count:0,avgTotal:0,avgSkeleton:0,avgContent:0,minTotal:0,maxTotal:0,successRate:0};return}const n=l.map(r=>r.timings.total),c=l.map(r=>r.timings.skeleton),h=l.map(r=>r.timings.contentGeneration),B=l.filter(r=>r.success).length;t[s]={count:l.length,avgTotal:n.reduce((r,y)=>r+y,0)/n.length,avgSkeleton:c.reduce((r,y)=>r+y,0)/c.length,avgContent:h.reduce((r,y)=>r+y,0)/h.length,minTotal:Math.min(...n),maxTotal:Math.max(...n),successRate:B/l.length*100}}),t},[i]),Y=o.useMemo(()=>{const t={};return["text","youtube","pdf","url","manual"].forEach(s=>{const l=i.filter(c=>c.sourceType===s);if(l.length===0){t[s]={count:0,avgTotal:0};return}const n=l.map(c=>c.timings.total);t[s]={count:l.length,avgTotal:n.reduce((c,h)=>c+h,0)/n.length}}),t},[i]),w=t=>{m===t?F(j==="asc"?"desc":"asc"):(L(t),F("desc"))};return d?e.jsxs("div",{className:`p-6 ${p}`,dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(H,{size:28}),"ניתוח מהירות יצירת תוכן"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"מעקב אחר זמני יצירת תכנים לפי סוג מוצר ומקור"})]}),e.jsxs("button",{onClick:R,disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50",children:[e.jsx(A,{size:18,className:u?"animate-spin":""}),"רענן"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-6 flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:18,className:"text-gray-500"}),e.jsx("span",{className:"text-gray-600 font-medium",children:"סינון:"})]}),e.jsxs("select",{value:b,onChange:t=>_(t.target.value),className:"px-3 py-2 border rounded-lg bg-white text-gray-700",children:[e.jsx("option",{value:"all",children:"כל סוגי התוצרים"}),e.jsx("option",{value:"lesson",children:"מערך שיעור"}),e.jsx("option",{value:"activity",children:"פעילות לתלמיד"}),e.jsx("option",{value:"exam",children:"מבחן"}),e.jsx("option",{value:"podcast",children:"פודקאסט"})]}),e.jsxs("select",{value:f,onChange:t=>G(t.target.value),className:"px-3 py-2 border rounded-lg bg-white text-gray-700",children:[e.jsx("option",{value:"all",children:"כל סוגי המקורות"}),e.jsx("option",{value:"text",children:"טקסט"}),e.jsx("option",{value:"youtube",children:"YouTube"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"url",children:"URL"}),e.jsx("option",{value:"manual",children:"ידני"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{size:18,className:"text-gray-500"}),e.jsxs("select",{value:v,onChange:t=>O(Number(t.target.value)),className:"px-3 py-2 border rounded-lg bg-white text-gray-700",children:[e.jsx("option",{value:1,children:"יום אחרון"}),e.jsx("option",{value:7,children:"7 ימים אחרונים"}),e.jsx("option",{value:30,children:"30 ימים אחרונים"}),e.jsx("option",{value:90,children:"90 ימים אחרונים"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:Object.entries(z).map(([t,a])=>{const s=U[t];return s?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.color}`,children:a.icon}),e.jsx("h3",{className:"font-semibold text-gray-700",children:a.label})]}),s.count>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"כמות:"}),e.jsx("span",{className:"font-medium",children:s.count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"ממוצע:"}),e.jsx("span",{className:"font-medium text-indigo-600",children:x(s.avgTotal)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"טווח:"}),e.jsxs("span",{className:"font-medium text-xs",children:[x(s.minTotal)," - ",x(s.maxTotal)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"הצלחה:"}),e.jsxs("span",{className:`font-medium ${s.successRate>=90?"text-green-600":"text-amber-600"}`,children:[s.successRate.toFixed(0),"%"]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"פירוט זמנים:"}),e.jsxs("div",{className:"h-4 bg-gray-100 rounded-full overflow-hidden flex",children:[e.jsx("div",{className:"bg-blue-500 h-full",style:{width:`${s.avgSkeleton/s.avgTotal*100}%`},title:`שלד: ${x(s.avgSkeleton)}`}),e.jsx("div",{className:"bg-green-500 h-full",style:{width:`${s.avgContent/s.avgTotal*100}%`},title:`תוכן: ${x(s.avgContent)}`})]}),e.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[e.jsx("span",{className:"text-blue-600",children:"שלד"}),e.jsx("span",{className:"text-green-600",children:"תוכן"})]})]})]}):e.jsx("p",{className:"text-gray-400 text-sm",children:"אין נתונים"})]},t):null})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-4",children:"זמנים לפי סוג מקור"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Object.entries(I).map(([t,a])=>{const s=Y[t];return!s||s.count===0?null:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`p-1.5 rounded ${a.color}`,children:a.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:a.label}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.count," יצירות | ממוצע: ",x(s.avgTotal)]})]})]},t)})})]}),k&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6 text-red-700",children:k}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600 cursor-pointer hover:bg-gray-100",onClick:()=>w("createdAt"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["תאריך",m==="createdAt"&&(j==="desc"?e.jsx(C,{size:16}):e.jsx(S,{size:16}))]})}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600 cursor-pointer hover:bg-gray-100",onClick:()=>w("productType"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["סוג תוצר",m==="productType"&&(j==="desc"?e.jsx(C,{size:16}):e.jsx(S,{size:16}))]})}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"מקור"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"שלבים"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600 cursor-pointer hover:bg-gray-100",onClick:()=>w("total"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["זמן כולל",m==="total"&&(j==="desc"?e.jsx(C,{size:16}):e.jsx(S,{size:16}))]})}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"שלד"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"תוכן"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"דירוג"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-600",children:"סטטוס"})]})}),e.jsx("tbody",{children:u?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(A,{size:24,className:"animate-spin mx-auto mb-2"}),"טוען נתונים..."]})}):T.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(P,{size:32,className:"mx-auto mb-2 text-gray-300"}),"אין נתונים להצגה",e.jsx("p",{className:"text-sm mt-1",children:"נתוני הזמנים יתחילו להיאסף לאחר יצירת תכנים חדשים"})]})}):T.map(t=>{var n,c,h;const a=z[t.productType]||z.lesson,s=I[t.sourceType]||I.text,l=ie(t.timings.total,t.productType);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:((h=(c=(n=t.createdAt)==null?void 0:n.toDate)==null?void 0:c.call(n))==null?void 0:h.toLocaleDateString("he-IL",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}))||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:[a.icon,a.label]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[s.icon,s.label]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.stepCount}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-indigo-600",children:x(t.timings.total)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:x(t.timings.skeleton)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:x(t.timings.contentGeneration)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.color}`,children:l.label})}),e.jsx("td",{className:"px-4 py-3",children:t.success?e.jsx("span",{className:"text-green-600",children:"✓"}):e.jsx("span",{className:"text-red-600",title:t.errorMessage,children:"✗"})})]},t.id)})})]})}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t text-sm text-gray-500",children:["מציג ",T.length," מתוך ",i.length," רשומות"]})]}),e.jsxs("div",{className:"mt-6 bg-indigo-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-indigo-800 mb-2",children:"מידע על המודל"}),e.jsxs("p",{className:"text-sm text-indigo-700",children:["המערכת משתמשת ב-",e.jsx("strong",{children:"Gemini 3 Pro"})," (",e.jsx("code",{children:"gemini-3-pro-preview"}),") ליצירת טקסט."]}),e.jsxs("p",{className:"text-sm text-indigo-600 mt-1",children:["תמונות: ",e.jsx("code",{children:"gemini-3-pro-image-preview"})]})]})]}):e.jsxs("div",{className:"p-8 text-center",dir:"rtl",children:[e.jsx(P,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-700",children:"גישה מוגבלת"}),e.jsx("p",{className:"text-gray-500",children:"עמוד זה זמין למנהלי מערכת בלבד"})]})};export{ge as GenerationSpeedAnalytics,ge as default};
//# sourceMappingURL=GenerationSpeedAnalytics-CHWIbMga.js.map
