{"version":3,"file":"SequentialCoursePlayerMobile-D_B-IH36.js","sources":["../../src/components/mobile/SequentialCoursePlayerMobile.tsx"],"sourcesContent":["/**\r\n * SequentialCoursePlayerMobile.tsx\r\n *\r\n * Mobile-optimized course player with:\r\n * - Tab-based switching between content and source (not side-by-side)\r\n * - Forward/back navigation\r\n * - Basic gamification (XP, coins, streak)\r\n * - Full-width content display\r\n * - Touch-optimized controls (44px+ targets)\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useCourseStore } from '../../context/CourseContext';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { useSound } from '../../hooks/useSound';\r\nimport type { ActivityBlock, Assignment, GamificationProfile } from '../../shared/types/courseTypes';\r\nimport {\r\n    IconChevronLeft, IconChevronRight, IconCheck, IconX,\r\n    IconStar, IconBook, IconHome\r\n} from '../../icons';\r\nimport { syncProgress, checkDailyStreak, DEFAULT_GAMIFICATION_PROFILE } from '../../services/gamificationService';\r\nimport { calculateQuestionScore } from '../../utils/scoring';\r\nimport { checkOpenQuestionAnswer } from '../../services/ai/geminiApi';\r\n\r\n// Question Components\r\nimport ClozeQuestion from '../ClozeQuestion';\r\nimport OrderingQuestion from '../OrderingQuestion';\r\nimport CategorizationQuestion from '../CategorizationQuestion';\r\nimport MemoryGameQuestion from '../MemoryGameQuestion';\r\nimport TrueFalseQuestion from '../TrueFalseQuestion';\r\nimport MatchingQuestion from '../questions/MatchingQuestion';\r\nimport { sanitizeHtml, formatTeacherContent, stripAsterisks } from '../../utils/sanitize';\r\nimport { PodcastPlayer } from '../PodcastPlayer';\r\nimport { InfographicViewer } from '../InfographicViewer';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkGfm from 'remark-gfm';\r\n\r\ninterface MobilePlayerProps {\r\n    assignment?: Assignment;\r\n    onExit?: () => void;\r\n    simulateGuest?: boolean;\r\n}\r\n\r\n// Simple XP Animation\r\nconst XpFloater = ({ amount, onComplete }: { amount: number; onComplete: () => void }) => {\r\n    useEffect(() => {\r\n        const timer = setTimeout(onComplete, 1000);\r\n        return () => clearTimeout(timer);\r\n    }, [onComplete]);\r\n\r\n    return (\r\n        <div className=\"fixed top-1/3 left-1/2 -translate-x-1/2 pointer-events-none z-50 animate-bounce motion-reduce:animate-none\">\r\n            <span className=\"text-3xl font-black text-yellow-400 drop-shadow-lg\">\r\n                +{amount} XP\r\n            </span>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Tab type for switching between content and source\r\ntype ActiveTab = 'content' | 'source';\r\n\r\nconst SequentialCoursePlayerMobile: React.FC<MobilePlayerProps> = ({\r\n    assignment,\r\n    onExit,\r\n    simulateGuest = false\r\n}) => {\r\n    const { course } = useCourseStore();\r\n    const { currentUser } = useAuth();\r\n    const playSound = useSound();\r\n\r\n    // --- Core State ---\r\n    const [playbackQueue, setPlaybackQueue] = useState<ActivityBlock[]>([]);\r\n    const [currentIndex, setCurrentIndex] = useState(0);\r\n    const [historyStack, setHistoryStack] = useState<number[]>([]);\r\n\r\n    // --- Tab State (Mobile-specific) ---\r\n    const [activeTab, setActiveTab] = useState<ActiveTab>('content');\r\n    const hasSourceContent = !!(course?.pdfSource || course?.fullBookContent);\r\n    const shouldShowSourceTab = course?.showSourceToStudent && hasSourceContent;\r\n\r\n    // --- Interaction State ---\r\n    const [userAnswers, setUserAnswers] = useState<Record<string, any>>({});\r\n    const [stepStatus, setStepStatus] = useState<'idle' | 'ready_to_check' | 'success' | 'failure'>('idle');\r\n    const [feedbackMsg, setFeedbackMsg] = useState<string | null>(null);\r\n    const [stepResults, setStepResults] = useState<Record<string, 'success' | 'failure' | 'viewed'>>({});\r\n    const [hintsVisible, setHintsVisible] = useState<Record<string, number>>({});\r\n    const [isCheckingAnswer, setIsCheckingAnswer] = useState(false);\r\n\r\n    // --- Gamification (Basic) ---\r\n    const [gamificationProfile, setGamificationProfile] = useState<GamificationProfile>(DEFAULT_GAMIFICATION_PROFILE);\r\n    const [showFloater, setShowFloater] = useState<{ id: number; amount: number } | null>(null);\r\n\r\n    const currentBlock = playbackQueue[currentIndex];\r\n    const isLast = currentIndex === playbackQueue.length - 1;\r\n    const isFirst = currentIndex === 0;\r\n    const isExamMode = course?.mode === 'exam';\r\n\r\n    // Initialize queue\r\n    useEffect(() => {\r\n        if (course?.syllabus) {\r\n            const initialBlocks = course.syllabus.flatMap(m =>\r\n                m.learningUnits.flatMap(u => (u.activityBlocks || []) as ActivityBlock[])\r\n            );\r\n            setPlaybackQueue(initialBlocks);\r\n        }\r\n    }, [course]);\r\n\r\n    // Load streak on mount\r\n    useEffect(() => {\r\n        if (currentUser?.uid) {\r\n            checkDailyStreak(currentUser.uid).then(result => {\r\n                setGamificationProfile(prev => ({\r\n                    ...prev,\r\n                    currentStreak: result.currentStreak,\r\n                    frozenDays: result.frozenDays\r\n                }));\r\n            });\r\n        }\r\n    }, [currentUser]);\r\n\r\n    // Reset status on block change\r\n    useEffect(() => {\r\n        if (!currentBlock) return;\r\n\r\n        const prevResult = stepResults[currentBlock.id];\r\n        if (prevResult) {\r\n            setStepStatus(prevResult === 'viewed' ? 'idle' : prevResult as any);\r\n            setFeedbackMsg(null);\r\n        } else {\r\n            setStepStatus('idle');\r\n            setFeedbackMsg(null);\r\n        }\r\n\r\n        // Always start on content tab when changing blocks\r\n        setActiveTab('content');\r\n    }, [currentIndex, currentBlock?.id]);\r\n\r\n    // --- Navigation ---\r\n    const handleNext = useCallback(() => {\r\n        if (isLast) {\r\n            // Course complete - exit\r\n            onExit?.();\r\n            return;\r\n        }\r\n        setHistoryStack(prev => [...prev, currentIndex]);\r\n        setCurrentIndex(prev => prev + 1);\r\n    }, [currentIndex, isLast, onExit]);\r\n\r\n    const handleBack = useCallback(() => {\r\n        if (historyStack.length > 0) {\r\n            const prevIndex = historyStack[historyStack.length - 1];\r\n            setHistoryStack(prev => prev.slice(0, -1));\r\n            setCurrentIndex(prevIndex);\r\n        } else if (currentIndex > 0) {\r\n            setCurrentIndex(prev => prev - 1);\r\n        }\r\n    }, [currentIndex, historyStack]);\r\n\r\n    // --- Answer Handling ---\r\n    const handleAnswerSelect = (val: any) => {\r\n        if (stepStatus === 'success' || stepStatus === 'failure') return;\r\n        setUserAnswers(prev => ({ ...prev, [currentBlock.id]: val }));\r\n        setStepStatus('ready_to_check');\r\n    };\r\n\r\n    const processResult = async (isCorrect: boolean) => {\r\n        setStepResults(prev => ({ ...prev, [currentBlock.id]: isCorrect ? 'success' : 'failure' }));\r\n\r\n        const hintsUsed = hintsVisible[currentBlock.id] || 0;\r\n        const score = calculateQuestionScore({\r\n            isCorrect,\r\n            attempts: 1,\r\n            hintsUsed,\r\n            responseTimeSec: 0\r\n        });\r\n\r\n        if (isCorrect) {\r\n            setStepStatus('success');\r\n            playSound('success');\r\n            setFeedbackMsg('◊û◊¶◊ï◊ô◊ü! ◊™◊©◊ï◊ë◊î ◊†◊õ◊ï◊†◊î');\r\n\r\n            const xpGain = Math.round(score * 0.5);\r\n            setGamificationProfile(prev => ({\r\n                ...prev,\r\n                xp: prev.xp + xpGain,\r\n                gems: prev.gems + 1\r\n            }));\r\n            setShowFloater({ id: Date.now(), amount: xpGain });\r\n        } else {\r\n            setStepStatus('failure');\r\n            playSound('failure');\r\n            setFeedbackMsg('◊ò◊¢◊ï◊™, ◊†◊°◊î ◊©◊ï◊ë');\r\n        }\r\n\r\n        // Sync to server\r\n        if (currentUser?.uid && !simulateGuest) {\r\n            await syncProgress(currentUser.uid, gamificationProfile);\r\n        }\r\n    };\r\n\r\n    const handleCheck = useCallback(async () => {\r\n        const passiveTypes = ['text', 'video', 'image', 'pdf', 'gem-link', 'podcast'];\r\n\r\n        if (passiveTypes.includes(currentBlock.type)) {\r\n            setStepResults(prev => ({ ...prev, [currentBlock.id]: 'viewed' }));\r\n            handleNext();\r\n            return;\r\n        }\r\n\r\n        if (stepStatus === 'success' || stepStatus === 'failure') {\r\n            handleNext();\r\n            return;\r\n        }\r\n\r\n        const answer = userAnswers[currentBlock.id];\r\n\r\n        if (currentBlock.type === 'multiple-choice') {\r\n            if (!answer) return;\r\n            const isCorrect = answer === currentBlock.content.correctAnswer;\r\n            processResult(isCorrect);\r\n        } else if (currentBlock.type === 'open-question') {\r\n            if (!answer || answer.trim().length < 3) return;\r\n\r\n            setIsCheckingAnswer(true);\r\n            try {\r\n                const sourceText = course?.syllabus?.[0]?.learningUnits?.[0]?.activityBlocks\r\n                    ?.filter((b: any) => b.type === 'text')\r\n                    ?.map((b: any) => b.content)\r\n                    ?.join('\\n') || '';\r\n\r\n                const question = currentBlock.content?.question || '';\r\n                const modelAnswer = currentBlock.metadata?.modelAnswer || currentBlock.content?.modelAnswer || '';\r\n\r\n                console.log('üìù [Mobile] Checking open question:', { question, answer, modelAnswer: modelAnswer?.substring(0, 50), sourceTextLength: sourceText.length });\r\n\r\n                const result = await checkOpenQuestionAnswer(\r\n                    question, answer, modelAnswer, sourceText,\r\n                    isExamMode ? 'exam' : 'learning'\r\n                );\r\n\r\n                console.log('‚úÖ [Mobile] AI Response:', result);\r\n\r\n                if (result.status === 'correct') {\r\n                    setFeedbackMsg(result.feedback || '◊û◊¶◊ï◊ô◊ü! ◊™◊©◊ï◊ë◊î ◊†◊õ◊ï◊†◊î.');\r\n                    processResult(true);\r\n                } else {\r\n                    setFeedbackMsg(result.feedback || '◊†◊°◊î ◊©◊ï◊ë');\r\n                    playSound('failure');\r\n                }\r\n            } catch (error: any) {\r\n                console.error('‚ùå [Mobile] Error checking answer:', error);\r\n                setFeedbackMsg('◊©◊í◊ô◊ê◊î ◊ë◊ë◊ì◊ô◊ß◊î. ' + (error?.message || ''));\r\n            } finally {\r\n                setIsCheckingAnswer(false);\r\n            }\r\n        }\r\n    }, [currentBlock, userAnswers, stepStatus, handleNext, course, isExamMode, playSound]);\r\n\r\n    // --- Block Content Renderer ---\r\n    const renderBlockContent = () => {\r\n        if (!currentBlock) return null;\r\n\r\n        const blockContent = currentBlock.content;\r\n        const blockType = currentBlock.type;\r\n\r\n        switch (blockType) {\r\n            case 'text':\r\n                return (\r\n                    <div\r\n                        className=\"prose prose-lg max-w-none text-slate-800 dark:text-slate-200\"\r\n                        dangerouslySetInnerHTML={{ __html: formatTeacherContent(typeof blockContent === 'string' ? blockContent : '') }}\r\n                    />\r\n                );\r\n\r\n            case 'video':\r\n                const videoUrl = typeof blockContent === 'string' ? blockContent : blockContent?.url;\r\n                return (\r\n                    <div className=\"aspect-video w-full rounded-xl overflow-hidden bg-black\">\r\n                        <iframe\r\n                            src={videoUrl}\r\n                            className=\"w-full h-full\"\r\n                            allowFullScreen\r\n                            title=\"◊ï◊ô◊ì◊ê◊ï\"\r\n                            loading=\"lazy\"\r\n                        />\r\n                    </div>\r\n                );\r\n\r\n            case 'image':\r\n                const imageUrl = typeof blockContent === 'string' ? blockContent : blockContent?.url;\r\n                return (\r\n                    <img\r\n                        src={imageUrl}\r\n                        alt={currentBlock.title || '◊™◊û◊ï◊†◊î'}\r\n                        className=\"max-w-full h-auto rounded-xl\"\r\n                        loading=\"lazy\"\r\n                        decoding=\"async\"\r\n                    />\r\n                );\r\n\r\n            case 'multiple-choice':\r\n                const mcContent = blockContent as { question: string; options: string[]; correctAnswer: string };\r\n                const selectedAnswer = userAnswers[currentBlock.id];\r\n\r\n                return (\r\n                    <div className=\"space-y-4\">\r\n                        <h3\r\n                            className=\"text-xl font-bold text-slate-800 dark:text-white mb-6\"\r\n                            dangerouslySetInnerHTML={{ __html: formatTeacherContent(mcContent.question || '') }}\r\n                        />\r\n                        <div className=\"space-y-3\" role=\"radiogroup\" aria-label=\"◊ê◊§◊©◊®◊ï◊ô◊ï◊™ ◊™◊©◊ï◊ë◊î\">\r\n                            {mcContent.options.map((option, idx) => {\r\n                                const isSelected = selectedAnswer === option;\r\n                                const showResult = stepStatus === 'success' || stepStatus === 'failure';\r\n                                const isCorrect = option === mcContent.correctAnswer;\r\n\r\n                                let buttonClass = 'w-full min-h-[56px] p-4 text-right rounded-xl border-2 transition-all ';\r\n\r\n                                if (showResult) {\r\n                                    if (isCorrect) {\r\n                                        buttonClass += 'border-green-500 bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200';\r\n                                    } else if (isSelected && !isCorrect) {\r\n                                        buttonClass += 'border-red-500 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200';\r\n                                    } else {\r\n                                        buttonClass += 'border-gray-200 dark:border-slate-600 bg-gray-50 dark:bg-slate-700 opacity-50';\r\n                                    }\r\n                                } else {\r\n                                    buttonClass += isSelected\r\n                                        ? 'border-violet-500 bg-violet-50 dark:bg-violet-900/30 text-violet-800 dark:text-violet-200'\r\n                                        : 'border-gray-200 dark:border-slate-600 bg-white dark:bg-slate-700 hover:border-violet-300 dark:hover:border-violet-500';\r\n                                }\r\n\r\n                                return (\r\n                                    <button\r\n                                        key={idx}\r\n                                        onClick={() => handleAnswerSelect(option)}\r\n                                        disabled={showResult}\r\n                                        role=\"radio\"\r\n                                        aria-checked={isSelected}\r\n                                        className={buttonClass}\r\n                                    >\r\n                                        <span className=\"font-medium\">{option}</span>\r\n                                        {showResult && isCorrect && (\r\n                                            <IconCheck className=\"inline-block mr-2 w-5 h-5 text-green-600\" aria-hidden=\"true\" />\r\n                                        )}\r\n                                        {showResult && isSelected && !isCorrect && (\r\n                                            <IconX className=\"inline-block mr-2 w-5 h-5 text-red-600\" aria-hidden=\"true\" />\r\n                                        )}\r\n                                    </button>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                );\r\n\r\n            case 'open-question':\r\n                const oqContent = blockContent as { question: string };\r\n                return (\r\n                    <div className=\"space-y-4\">\r\n                        <h3\r\n                            className=\"text-xl font-bold text-slate-800 dark:text-white mb-4\"\r\n                            dangerouslySetInnerHTML={{ __html: formatTeacherContent(oqContent.question || '') }}\r\n                        />\r\n                        <textarea\r\n                            value={userAnswers[currentBlock.id] || ''}\r\n                            onChange={(e) => handleAnswerSelect(e.target.value)}\r\n                            disabled={stepStatus === 'success'}\r\n                            placeholder=\"◊õ◊™◊ï◊ë ◊ê◊™ ◊™◊©◊ï◊ë◊™◊ö ◊õ◊ê◊ü...\"\r\n                            className=\"w-full min-h-[150px] p-4 text-lg border-2 border-gray-200 dark:border-slate-600 rounded-xl\r\n                                     bg-white dark:bg-slate-700 text-slate-800 dark:text-white\r\n                                     focus:border-violet-500 focus:ring-2 focus:ring-violet-200 dark:focus:ring-violet-800\r\n                                     resize-none transition-colors\"\r\n                            dir=\"rtl\"\r\n                        />\r\n                    </div>\r\n                );\r\n\r\n            case 'fill_in_blanks':\r\n                return <ClozeQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'ordering':\r\n                return <OrderingQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'categorization':\r\n                return <CategorizationQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'memory_game':\r\n                return <MemoryGameQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'true_false_speed':\r\n                return <TrueFalseQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'matching':\r\n                return <MatchingQuestion block={currentBlock} onComplete={(score) => processResult(score >= 50)} />;\r\n\r\n            case 'podcast':\r\n                return <PodcastPlayer block={currentBlock} />;\r\n\r\n            case 'infographic':\r\n                return <InfographicViewer block={currentBlock} />;\r\n\r\n            default:\r\n                return (\r\n                    <div className=\"text-center text-gray-500 dark:text-gray-400 p-8\">\r\n                        ◊°◊ï◊í ◊™◊ï◊õ◊ü ◊ú◊ê ◊†◊™◊û◊ö: {blockType}\r\n                    </div>\r\n                );\r\n        }\r\n    };\r\n\r\n    // --- Source Content Renderer ---\r\n    // Priority: Show fullBookContent if available, fallback to pdfSource\r\n    const renderSourceContent = () => {\r\n        if (course?.fullBookContent) {\r\n            return (\r\n                <div className=\"p-4 prose max-w-none text-base leading-relaxed\" dir=\"rtl\">\r\n                    <div className=\"font-serif text-slate-800 dark:text-slate-200 whitespace-pre-wrap\">\r\n                        {course.fullBookContent}\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (course?.pdfSource) {\r\n            return (\r\n                <div className=\"h-full flex flex-col min-h-[60vh]\">\r\n                    <iframe\r\n                        src={course.pdfSource}\r\n                        className=\"w-full flex-1 border-none rounded-lg\"\r\n                        title=\"◊û◊°◊û◊ö ◊û◊ß◊ï◊®\"\r\n                        loading=\"lazy\"\r\n                    />\r\n                    {/* Fallback link if iframe fails to load */}\r\n                    <div className=\"p-3 bg-white dark:bg-slate-800 border-t text-center\">\r\n                        <a\r\n                            href={course.pdfSource}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-sm text-blue-600 hover:underline\"\r\n                        >\r\n                            ◊§◊™◊ó ◊ê◊™ ◊î◊û◊°◊û◊ö ◊ë◊ó◊ú◊ï◊ü ◊ó◊ì◊© ‚Üó\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className=\"text-center text-gray-500 p-8\">\r\n                ◊ê◊ô◊ü ◊û◊°◊û◊ö ◊û◊ß◊ï◊® ◊ñ◊û◊ô◊ü\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // --- Loading State ---\r\n    if (!course || course.id === 'loading') {\r\n        return (\r\n            <div className=\"min-h-screen bg-wizdi-royal flex items-center justify-center\">\r\n                <div className=\"text-white text-xl font-bold animate-pulse motion-reduce:animate-none\">\r\n                    ◊ò◊ï◊¢◊ü ◊©◊ô◊¢◊ï◊®...\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!currentBlock) {\r\n        return (\r\n            <div className=\"min-h-screen bg-wizdi-royal flex items-center justify-center\">\r\n                <div className=\"text-white text-xl font-bold\">\r\n                    ◊ê◊ô◊ü ◊™◊ï◊õ◊ü ◊ú◊î◊¶◊í◊î\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Progress percentage\r\n    const progressPercent = Math.round(((currentIndex + 1) / playbackQueue.length) * 100);\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-100 dark:bg-slate-900 flex flex-col\" dir=\"rtl\">\r\n            {/* XP Animation */}\r\n            {showFloater && <XpFloater amount={showFloater.amount} onComplete={() => setShowFloater(null)} />}\r\n\r\n            {/* Header - Compact Mobile Version */}\r\n            <header className=\"bg-wizdi-royal dark:bg-slate-800 text-white px-4 py-3 safe-area-inset-top\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    {/* Exit Button */}\r\n                    <button\r\n                        onClick={onExit}\r\n                        className=\"min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl bg-white/10 hover:bg-white/20 transition-colors\"\r\n                        aria-label=\"◊ô◊¶◊ô◊ê◊î\"\r\n                    >\r\n                        <IconHome className=\"w-6 h-6\" />\r\n                    </button>\r\n\r\n                    {/* Progress */}\r\n                    <div className=\"flex-1 mx-4\">\r\n                        <div className=\"flex items-center justify-center gap-2 text-sm font-medium\">\r\n                            <span>{currentIndex + 1}</span>\r\n                            <span className=\"text-white/60\">/</span>\r\n                            <span>{playbackQueue.length}</span>\r\n                        </div>\r\n                        <div className=\"h-1.5 bg-white/20 rounded-full mt-1 overflow-hidden\">\r\n                            <div\r\n                                className=\"h-full bg-wizdi-cyan rounded-full transition-all duration-300\"\r\n                                style={{ width: `${progressPercent}%` }}\r\n                                role=\"progressbar\"\r\n                                aria-valuenow={progressPercent}\r\n                                aria-valuemin={0}\r\n                                aria-valuemax={100}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Gamification Stats */}\r\n                    <div className=\"flex items-center gap-3\">\r\n                        {/* Streak */}\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <span className=\"text-lg\">üî•</span>\r\n                            <span className=\"font-bold text-sm\">{gamificationProfile.currentStreak}</span>\r\n                        </div>\r\n                        {/* XP */}\r\n                        <div className=\"flex items-center gap-1 bg-yellow-500/20 px-2 py-1 rounded-lg\">\r\n                            <IconStar className=\"w-4 h-4 text-yellow-300\" />\r\n                            <span className=\"font-bold text-sm text-yellow-300\">{gamificationProfile.xp}</span>\r\n                        </div>\r\n                        {/* Gems */}\r\n                        <div className=\"flex items-center gap-1\">\r\n                            <span className=\"text-lg\">üíé</span>\r\n                            <span className=\"font-bold text-sm text-cyan-300\">{gamificationProfile.gems}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Tab Switcher (Only if source is available) */}\r\n            {shouldShowSourceTab && (\r\n                <div className=\"bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 px-4\">\r\n                    <div className=\"flex\" role=\"tablist\" aria-label=\"◊™◊¶◊ï◊í◊™ ◊™◊ï◊õ◊ü\">\r\n                        <button\r\n                            onClick={() => setActiveTab('content')}\r\n                            role=\"tab\"\r\n                            aria-selected={activeTab === 'content'}\r\n                            className={`flex-1 min-h-[48px] py-3 text-center font-bold transition-colors border-b-2 ${\r\n                                activeTab === 'content'\r\n                                    ? 'border-wizdi-action text-wizdi-action dark:text-violet-400'\r\n                                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700'\r\n                            }`}\r\n                        >\r\n                            üìù ◊™◊ï◊õ◊ü\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setActiveTab('source')}\r\n                            role=\"tab\"\r\n                            aria-selected={activeTab === 'source'}\r\n                            className={`flex-1 min-h-[48px] py-3 text-center font-bold transition-colors border-b-2 ${\r\n                                activeTab === 'source'\r\n                                    ? 'border-wizdi-action text-wizdi-action dark:text-violet-400'\r\n                                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700'\r\n                            }`}\r\n                        >\r\n                            <IconBook className=\"inline-block w-5 h-5 ml-1\" />\r\n                            ◊û◊ß◊ï◊®\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Main Content Area */}\r\n            <main className=\"flex-1 overflow-y-auto p-4 pb-32\">\r\n                <div\r\n                    role=\"tabpanel\"\r\n                    aria-label={activeTab === 'content' ? '◊™◊ï◊õ◊ü ◊î◊©◊ô◊¢◊ï◊®' : '◊û◊°◊û◊ö ◊û◊ß◊ï◊®'}\r\n                    className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-5 min-h-[300px]\"\r\n                >\r\n                    {activeTab === 'content' ? renderBlockContent() : renderSourceContent()}\r\n                </div>\r\n\r\n                {/* Feedback Message */}\r\n                {feedbackMsg && (\r\n                    <div\r\n                        role=\"alert\"\r\n                        aria-live=\"polite\"\r\n                        className={`mt-4 p-4 rounded-xl text-center font-bold ${\r\n                            stepStatus === 'success'\r\n                                ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-700'\r\n                                : stepStatus === 'failure'\r\n                                    ? 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-700'\r\n                                    : 'bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 border border-amber-200 dark:border-amber-700'\r\n                        }`}\r\n                    >\r\n                        <span className=\"flex items-center justify-center gap-2\">\r\n                            {stepStatus === 'success' ? (\r\n                                <><IconCheck className=\"w-5 h-5\" aria-hidden=\"true\" /> {feedbackMsg}</>\r\n                            ) : stepStatus === 'failure' ? (\r\n                                <><IconX className=\"w-5 h-5\" aria-hidden=\"true\" /> {feedbackMsg}</>\r\n                            ) : (\r\n                                <><span className=\"text-lg\" aria-hidden=\"true\">üí≠</span> {feedbackMsg}</>\r\n                            )}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n            </main>\r\n\r\n            {/* Bottom Navigation Bar */}\r\n            <nav className=\"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-700 px-4 py-3 safe-area-inset-bottom\">\r\n                <div className=\"flex items-center justify-between gap-4\">\r\n                    {/* Back Button */}\r\n                    <button\r\n                        onClick={handleBack}\r\n                        disabled={isFirst && historyStack.length === 0}\r\n                        className={`min-w-[56px] min-h-[56px] flex items-center justify-center rounded-xl transition-all ${\r\n                            isFirst && historyStack.length === 0\r\n                                ? 'bg-gray-100 dark:bg-slate-700 text-gray-300 dark:text-slate-500 cursor-not-allowed'\r\n                                : 'bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-slate-600 active:scale-95'\r\n                        }`}\r\n                        aria-label=\"◊î◊ß◊ï◊ì◊ù\"\r\n                    >\r\n                        <IconChevronRight className=\"w-7 h-7\" />\r\n                    </button>\r\n\r\n                    {/* Main Action Button - Hidden for passive (non-question) blocks */}\r\n                    {!['text', 'video', 'image', 'pdf', 'gem-link', 'podcast', 'activity-intro', 'scenario-image', 'infographic'].includes(currentBlock.type) && (\r\n                        <button\r\n                            onClick={handleCheck}\r\n                            disabled={isCheckingAnswer || (stepStatus === 'ready_to_check' && !userAnswers[currentBlock.id])}\r\n                            className={`flex-1 min-h-[56px] rounded-xl font-bold text-lg transition-all active:scale-[0.98] ${\r\n                                stepStatus === 'success'\r\n                                    ? 'bg-green-500 text-white'\r\n                                    : stepStatus === 'failure'\r\n                                        ? 'bg-orange-500 text-white'\r\n                                        : 'bg-wizdi-action hover:bg-wizdi-action-hover text-white shadow-lg'\r\n                            } disabled:opacity-50 disabled:cursor-not-allowed`}\r\n                            aria-label={\r\n                                stepStatus === 'success' || stepStatus === 'failure'\r\n                                    ? '◊î◊û◊©◊ö'\r\n                                    : stepStatus === 'ready_to_check'\r\n                                        ? '◊ë◊ì◊ï◊ß'\r\n                                        : '◊î◊û◊©◊ö'\r\n                            }\r\n                        >\r\n                            {isCheckingAnswer ? (\r\n                                <span className=\"flex items-center justify-center gap-2\">\r\n                                    <div className=\"w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin\" />\r\n                                    ◊ë◊ï◊ì◊ß...\r\n                                </span>\r\n                            ) : stepStatus === 'success' || stepStatus === 'failure' ? (\r\n                                '◊î◊û◊©◊ö ‚Üí'\r\n                            ) : stepStatus === 'ready_to_check' ? (\r\n                                '◊ë◊ì◊ï◊ß ‚úì'\r\n                            ) : (\r\n                                '◊ë◊ì◊ô◊ß◊î'\r\n                            )}\r\n                        </button>\r\n                    )}\r\n\r\n                    {/* Forward Button */}\r\n                    <button\r\n                        onClick={handleNext}\r\n                        disabled={isLast}\r\n                        className={`min-w-[56px] min-h-[56px] flex items-center justify-center rounded-xl transition-all ${\r\n                            isLast\r\n                                ? 'bg-gray-100 dark:bg-slate-700 text-gray-300 dark:text-slate-500 cursor-not-allowed'\r\n                                : 'bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-white hover:bg-gray-200 dark:hover:bg-slate-600 active:scale-95'\r\n                        }`}\r\n                        aria-label=\"◊î◊ë◊ê\"\r\n                    >\r\n                        <IconChevronLeft className=\"w-7 h-7\" />\r\n                    </button>\r\n                </div>\r\n            </nav>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default SequentialCoursePlayerMobile;\r\n"],"names":["XpFloater","amount","onComplete","useEffect","timer","jsxs","SequentialCoursePlayerMobile","assignment","onExit","simulateGuest","course","useCourseStore","currentUser","useAuth","playSound","useSound","playbackQueue","setPlaybackQueue","useState","currentIndex","setCurrentIndex","historyStack","setHistoryStack","activeTab","setActiveTab","hasSourceContent","shouldShowSourceTab","userAnswers","setUserAnswers","stepStatus","setStepStatus","feedbackMsg","setFeedbackMsg","stepResults","setStepResults","hintsVisible","setHintsVisible","isCheckingAnswer","setIsCheckingAnswer","gamificationProfile","setGamificationProfile","DEFAULT_GAMIFICATION_PROFILE","showFloater","setShowFloater","currentBlock","isLast","isFirst","isExamMode","initialBlocks","m","u","checkDailyStreak","result","prev","prevResult","handleNext","useCallback","handleBack","prevIndex","handleAnswerSelect","val","processResult","isCorrect","hintsUsed","score","calculateQuestionScore","xpGain","syncProgress","handleCheck","answer","sourceText","_g","_f","_e","_d","_c","_b","_a","b","question","_h","modelAnswer","_i","_j","checkOpenQuestionAnswer","error","renderBlockContent","blockContent","blockType","jsx","formatTeacherContent","videoUrl","imageUrl","mcContent","selectedAnswer","option","idx","isSelected","showResult","buttonClass","IconCheck","IconX","oqContent","e","ClozeQuestion","OrderingQuestion","CategorizationQuestion","MemoryGameQuestion","TrueFalseQuestion","MatchingQuestion","PodcastPlayer","InfographicViewer","renderSourceContent","progressPercent","IconHome","IconStar","IconBook","Fragment","IconChevronRight","IconChevronLeft"],"mappings":"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"}