const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pedagogicalTelemetry-DR_rp4p-.js","assets/index-1x3sw4DL.js","assets/index-D5UJlrDR.css"])))=>i.map(i=>d[i]);
import{aX as Qi,R as A,r as v,j as d,k as sn,d as On,a7 as Ji,aY as wo,f as bo,aZ as ea,a_ as vo,a$ as ta,b as Hs,_ as na,J as vs,b0 as sa,b1 as ra,e as vr,aH as oa,P as ia,b2 as Nr,b3 as aa,aI as ca,I as Sr,b4 as No,b5 as la,b6 as ua,b7 as da,b8 as _r,b9 as fa,ba as gt,bb as ha,bc as ma,a5 as ga,am as pa,aF as So,bd as xa,a4 as ya,be as wa,bf as ba,bg as va,bh as Na,bi as us,bj as Er,o as Sa,M as _a,bk as Ea}from"./index-1x3sw4DL.js";function je(e){if(typeof e=="string"||typeof e=="number")return""+e;let t="";if(Array.isArray(e))for(let n=0,s;n<e.length;n++)(s=je(e[n]))!==""&&(t+=(t&&" ")+s);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}const ja={},jr=e=>{let t;const n=new Set,s=(u,f)=>{const h=typeof u=="function"?u(t):u;if(!Object.is(h,t)){const p=t;t=f??(typeof h!="object"||h===null)?h:Object.assign({},t,h),n.forEach(N=>N(t,p))}},r=()=>t,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(n.add(u),()=>n.delete(u)),destroy:()=>{(ja?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},l=t=e(s,r,a);return a},Ca=e=>e?jr(e):jr,{useDebugValue:Aa}=A,{useSyncExternalStoreWithSelector:Ia}=Qi,Ma=e=>e;function _o(e,t=Ma,n){const s=Ia(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Aa(s),s}const Cr=(e,t)=>{const n=Ca(e),s=(r,i=t)=>_o(n,r,i);return Object.assign(s,n),s},Ta=(e,t)=>e?Cr(e,t):Cr;function Ee(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[s,r]of e)if(!Object.is(r,t.get(s)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!Object.is(e[s],t[s]))return!1;return!0}var $a={value:()=>{}};function es(){for(var e=0,t=arguments.length,n={},s;e<t;++e){if(!(s=arguments[e]+"")||s in n||/[\s.]/.test(s))throw new Error("illegal type: "+s);n[s]=[]}return new Ln(n)}function Ln(e){this._=e}function Ra(e,t){return e.trim().split(/^|\s+/).map(function(n){var s="",r=n.indexOf(".");if(r>=0&&(s=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:s}})}Ln.prototype=es.prototype={constructor:Ln,on:function(e,t){var n=this._,s=Ra(e+"",n),r,i=-1,o=s.length;if(arguments.length<2){for(;++i<o;)if((r=(e=s[i]).type)&&(r=za(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<o;)if(r=(e=s[i]).type)n[r]=Ar(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Ar(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ln(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),s=0,r,i;s<r;++s)n[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],s=0,r=i.length;s<r;++s)i[s].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)}};function za(e,t){for(var n=0,s=e.length,r;n<s;++n)if((r=e[n]).name===t)return r.value}function Ar(e,t,n){for(var s=0,r=e.length;s<r;++s)if(e[s].name===t){e[s]=$a,e=e.slice(0,s).concat(e.slice(s+1));break}return n!=null&&e.push({name:t,value:n}),e}var Ns="http://www.w3.org/1999/xhtml";const Ir={svg:"http://www.w3.org/2000/svg",xhtml:Ns,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ts(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Ir.hasOwnProperty(t)?{space:Ir[t],local:e}:e}function Pa(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ns&&t.documentElement.namespaceURI===Ns?t.createElement(e):t.createElementNS(n,e)}}function Da(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Eo(e){var t=ts(e);return(t.local?Da:Pa)(t)}function ka(){}function Ls(e){return e==null?ka:function(){return this.querySelector(e)}}function Ha(e){typeof e!="function"&&(e=Ls(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,c=s[r]=new Array(o),a,l,u=0;u<o;++u)(a=i[u])&&(l=e.call(a,a.__data__,u,i))&&("__data__"in a&&(l.__data__=a.__data__),c[u]=l);return new ke(s,this._parents)}function La(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Ba(){return[]}function jo(e){return e==null?Ba:function(){return this.querySelectorAll(e)}}function Fa(e){return function(){return La(e.apply(this,arguments))}}function Va(e){typeof e=="function"?e=Fa(e):e=jo(e);for(var t=this._groups,n=t.length,s=[],r=[],i=0;i<n;++i)for(var o=t[i],c=o.length,a,l=0;l<c;++l)(a=o[l])&&(s.push(e.call(a,a.__data__,l,o)),r.push(a));return new ke(s,r)}function Co(e){return function(){return this.matches(e)}}function Ao(e){return function(t){return t.matches(e)}}var Oa=Array.prototype.find;function Xa(e){return function(){return Oa.call(this.children,e)}}function Wa(){return this.firstElementChild}function Ya(e){return this.select(e==null?Wa:Xa(typeof e=="function"?e:Ao(e)))}var Ua=Array.prototype.filter;function Ga(){return Array.from(this.children)}function qa(e){return function(){return Ua.call(this.children,e)}}function Za(e){return this.selectAll(e==null?Ga:qa(typeof e=="function"?e:Ao(e)))}function Ka(e){typeof e!="function"&&(e=Co(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,c=s[r]=[],a,l=0;l<o;++l)(a=i[l])&&e.call(a,a.__data__,l,i)&&c.push(a);return new ke(s,this._parents)}function Io(e){return new Array(e.length)}function Qa(){return new ke(this._enter||this._groups.map(Io),this._parents)}function Xn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Xn.prototype={constructor:Xn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ja(e){return function(){return e}}function ec(e,t,n,s,r,i){for(var o=0,c,a=t.length,l=i.length;o<l;++o)(c=t[o])?(c.__data__=i[o],s[o]=c):n[o]=new Xn(e,i[o]);for(;o<a;++o)(c=t[o])&&(r[o]=c)}function tc(e,t,n,s,r,i,o){var c,a,l=new Map,u=t.length,f=i.length,h=new Array(u),p;for(c=0;c<u;++c)(a=t[c])&&(h[c]=p=o.call(a,a.__data__,c,t)+"",l.has(p)?r[c]=a:l.set(p,a));for(c=0;c<f;++c)p=o.call(e,i[c],c,i)+"",(a=l.get(p))?(s[c]=a,a.__data__=i[c],l.delete(p)):n[c]=new Xn(e,i[c]);for(c=0;c<u;++c)(a=t[c])&&l.get(h[c])===a&&(r[c]=a)}function nc(e){return e.__data__}function sc(e,t){if(!arguments.length)return Array.from(this,nc);var n=t?tc:ec,s=this._parents,r=this._groups;typeof e!="function"&&(e=Ja(e));for(var i=r.length,o=new Array(i),c=new Array(i),a=new Array(i),l=0;l<i;++l){var u=s[l],f=r[l],h=f.length,p=rc(e.call(u,u&&u.__data__,l,s)),N=p.length,w=c[l]=new Array(N),y=o[l]=new Array(N),x=a[l]=new Array(h);n(u,f,w,y,x,p,t);for(var _=0,j=0,b,I;_<N;++_)if(b=w[_]){for(_>=j&&(j=_+1);!(I=y[j])&&++j<N;);b._next=I||null}}return o=new ke(o,s),o._enter=c,o._exit=a,o}function rc(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function oc(){return new ke(this._exit||this._groups.map(Io),this._parents)}function ic(e,t,n){var s=this.enter(),r=this,i=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?i.remove():n(i),s&&r?s.merge(r).order():r}function ac(e){for(var t=e.selection?e.selection():e,n=this._groups,s=t._groups,r=n.length,i=s.length,o=Math.min(r,i),c=new Array(r),a=0;a<o;++a)for(var l=n[a],u=s[a],f=l.length,h=c[a]=new Array(f),p,N=0;N<f;++N)(p=l[N]||u[N])&&(h[N]=p);for(;a<r;++a)c[a]=n[a];return new ke(c,this._parents)}function cc(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s=e[t],r=s.length-1,i=s[r],o;--r>=0;)(o=s[r])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function lc(e){e||(e=uc);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,s=n.length,r=new Array(s),i=0;i<s;++i){for(var o=n[i],c=o.length,a=r[i]=new Array(c),l,u=0;u<c;++u)(l=o[u])&&(a[u]=l);a.sort(t)}return new ke(r,this._parents).order()}function uc(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function dc(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function fc(){return Array.from(this)}function hc(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length;r<i;++r){var o=s[r];if(o)return o}return null}function mc(){let e=0;for(const t of this)++e;return e}function gc(){return!this.node()}function pc(e){for(var t=this._groups,n=0,s=t.length;n<s;++n)for(var r=t[n],i=0,o=r.length,c;i<o;++i)(c=r[i])&&e.call(c,c.__data__,i,r);return this}function xc(e){return function(){this.removeAttribute(e)}}function yc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function wc(e,t){return function(){this.setAttribute(e,t)}}function bc(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function vc(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Nc(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Sc(e,t){var n=ts(e);if(arguments.length<2){var s=this.node();return n.local?s.getAttributeNS(n.space,n.local):s.getAttribute(n)}return this.each((t==null?n.local?yc:xc:typeof t=="function"?n.local?Nc:vc:n.local?bc:wc)(n,t))}function Mo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function _c(e){return function(){this.style.removeProperty(e)}}function Ec(e,t,n){return function(){this.style.setProperty(e,t,n)}}function jc(e,t,n){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,n)}}function Cc(e,t,n){return arguments.length>1?this.each((t==null?_c:typeof t=="function"?jc:Ec)(e,t,n??"")):Ot(this.node(),e)}function Ot(e,t){return e.style.getPropertyValue(t)||Mo(e).getComputedStyle(e,null).getPropertyValue(t)}function Ac(e){return function(){delete this[e]}}function Ic(e,t){return function(){this[e]=t}}function Mc(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Tc(e,t){return arguments.length>1?this.each((t==null?Ac:typeof t=="function"?Mc:Ic)(e,t)):this.node()[e]}function To(e){return e.trim().split(/^|\s+/)}function Bs(e){return e.classList||new $o(e)}function $o(e){this._node=e,this._names=To(e.getAttribute("class")||"")}$o.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Ro(e,t){for(var n=Bs(e),s=-1,r=t.length;++s<r;)n.add(t[s])}function zo(e,t){for(var n=Bs(e),s=-1,r=t.length;++s<r;)n.remove(t[s])}function $c(e){return function(){Ro(this,e)}}function Rc(e){return function(){zo(this,e)}}function zc(e,t){return function(){(t.apply(this,arguments)?Ro:zo)(this,e)}}function Pc(e,t){var n=To(e+"");if(arguments.length<2){for(var s=Bs(this.node()),r=-1,i=n.length;++r<i;)if(!s.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?zc:t?$c:Rc)(n,t))}function Dc(){this.textContent=""}function kc(e){return function(){this.textContent=e}}function Hc(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Lc(e){return arguments.length?this.each(e==null?Dc:(typeof e=="function"?Hc:kc)(e)):this.node().textContent}function Bc(){this.innerHTML=""}function Fc(e){return function(){this.innerHTML=e}}function Vc(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Oc(e){return arguments.length?this.each(e==null?Bc:(typeof e=="function"?Vc:Fc)(e)):this.node().innerHTML}function Xc(){this.nextSibling&&this.parentNode.appendChild(this)}function Wc(){return this.each(Xc)}function Yc(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Uc(){return this.each(Yc)}function Gc(e){var t=typeof e=="function"?e:Eo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function qc(){return null}function Zc(e,t){var n=typeof e=="function"?e:Eo(e),s=t==null?qc:typeof t=="function"?t:Ls(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),s.apply(this,arguments)||null)})}function Kc(){var e=this.parentNode;e&&e.removeChild(this)}function Qc(){return this.each(Kc)}function Jc(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function el(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function tl(e){return this.select(e?el:Jc)}function nl(e){return arguments.length?this.property("__data__",e):this.node().__data__}function sl(e){return function(t){e.call(this,t,this.__data__)}}function rl(e){return e.trim().split(/^|\s+/).map(function(t){var n="",s=t.indexOf(".");return s>=0&&(n=t.slice(s+1),t=t.slice(0,s)),{type:t,name:n}})}function ol(e){return function(){var t=this.__on;if(t){for(var n=0,s=-1,r=t.length,i;n<r;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++s]=i;++s?t.length=s:delete this.__on}}}function il(e,t,n){return function(){var s=this.__on,r,i=sl(t);if(s){for(var o=0,c=s.length;o<c;++o)if((r=s[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),r.value=t;return}}this.addEventListener(e.type,i,n),r={type:e.type,name:e.name,value:t,listener:i,options:n},s?s.push(r):this.__on=[r]}}function al(e,t,n){var s=rl(e+""),r,i=s.length,o;if(arguments.length<2){var c=this.node().__on;if(c){for(var a=0,l=c.length,u;a<l;++a)for(r=0,u=c[a];r<i;++r)if((o=s[r]).type===u.type&&o.name===u.name)return u.value}return}for(c=t?il:ol,r=0;r<i;++r)this.each(c(s[r],t,n));return this}function Po(e,t,n){var s=Mo(e),r=s.CustomEvent;typeof r=="function"?r=new r(t,n):(r=s.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function cl(e,t){return function(){return Po(this,e,t)}}function ll(e,t){return function(){return Po(this,e,t.apply(this,arguments))}}function ul(e,t){return this.each((typeof t=="function"?ll:cl)(e,t))}function*dl(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s=e[t],r=0,i=s.length,o;r<i;++r)(o=s[r])&&(yield o)}var Do=[null];function ke(e,t){this._groups=e,this._parents=t}function hn(){return new ke([[document.documentElement]],Do)}function fl(){return this}ke.prototype=hn.prototype={constructor:ke,select:Ha,selectAll:Va,selectChild:Ya,selectChildren:Za,filter:Ka,data:sc,enter:Qa,exit:oc,join:ic,merge:ac,selection:fl,order:cc,sort:lc,call:dc,nodes:fc,node:hc,size:mc,empty:gc,each:pc,attr:Sc,style:Cc,property:Tc,classed:Pc,text:Lc,html:Oc,raise:Wc,lower:Uc,append:Gc,insert:Zc,remove:Qc,clone:tl,datum:nl,on:al,dispatch:ul,[Symbol.iterator]:dl};function He(e){return typeof e=="string"?new ke([[document.querySelector(e)]],[document.documentElement]):new ke([[e]],Do)}function hl(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Ue(e,t){if(e=hl(e),t===void 0&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var s=n.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(t.getScreenCTM().inverse()),[s.x,s.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[e.clientX-r.left-t.clientLeft,e.clientY-r.top-t.clientTop]}}return[e.pageX,e.pageY]}const ml={passive:!1},rn={capture:!0,passive:!1};function ds(e){e.stopImmediatePropagation()}function Bt(e){e.preventDefault(),e.stopImmediatePropagation()}function ko(e){var t=e.document.documentElement,n=He(e).on("dragstart.drag",Bt,rn);"onselectstart"in t?n.on("selectstart.drag",Bt,rn):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ho(e,t){var n=e.document.documentElement,s=He(e).on("dragstart.drag",null);t&&(s.on("click.drag",Bt,rn),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in n?s.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Mn=e=>()=>e;function Ss(e,{sourceEvent:t,subject:n,target:s,identifier:r,active:i,x:o,y:c,dx:a,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:c,enumerable:!0,configurable:!0},dx:{value:a,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}Ss.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function gl(e){return!e.ctrlKey&&!e.button}function pl(){return this.parentNode}function xl(e,t){return t??{x:e.x,y:e.y}}function yl(){return navigator.maxTouchPoints||"ontouchstart"in this}function wl(){var e=gl,t=pl,n=xl,s=yl,r={},i=es("start","drag","end"),o=0,c,a,l,u,f=0;function h(b){b.on("mousedown.drag",p).filter(s).on("touchstart.drag",y).on("touchmove.drag",x,ml).on("touchend.drag touchcancel.drag",_).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(b,I){if(!(u||!e.call(this,b,I))){var T=j(this,t.call(this,b,I),b,I,"mouse");T&&(He(b.view).on("mousemove.drag",N,rn).on("mouseup.drag",w,rn),ko(b.view),ds(b),l=!1,c=b.clientX,a=b.clientY,T("start",b))}}function N(b){if(Bt(b),!l){var I=b.clientX-c,T=b.clientY-a;l=I*I+T*T>f}r.mouse("drag",b)}function w(b){He(b.view).on("mousemove.drag mouseup.drag",null),Ho(b.view,l),Bt(b),r.mouse("end",b)}function y(b,I){if(e.call(this,b,I)){var T=b.changedTouches,P=t.call(this,b,I),D=T.length,M,B;for(M=0;M<D;++M)(B=j(this,P,b,I,T[M].identifier,T[M]))&&(ds(b),B("start",b,T[M]))}}function x(b){var I=b.changedTouches,T=I.length,P,D;for(P=0;P<T;++P)(D=r[I[P].identifier])&&(Bt(b),D("drag",b,I[P]))}function _(b){var I=b.changedTouches,T=I.length,P,D;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),P=0;P<T;++P)(D=r[I[P].identifier])&&(ds(b),D("end",b,I[P]))}function j(b,I,T,P,D,M){var B=i.copy(),F=Ue(M||T,I),O,L,g;if((g=n.call(b,new Ss("beforestart",{sourceEvent:T,target:h,identifier:D,active:o,x:F[0],y:F[1],dx:0,dy:0,dispatch:B}),P))!=null)return O=g.x-F[0]||0,L=g.y-F[1]||0,function C(S,R,k){var E=F,$;switch(S){case"start":r[D]=C,$=o++;break;case"end":delete r[D],--o;case"drag":F=Ue(k||R,I),$=o;break}B.call(S,b,new Ss(S,{sourceEvent:R,subject:g,target:h,identifier:D,active:$,x:F[0]+O,y:F[1]+L,dx:F[0]-E[0],dy:F[1]-E[1],dispatch:B}),P)}}return h.filter=function(b){return arguments.length?(e=typeof b=="function"?b:Mn(!!b),h):e},h.container=function(b){return arguments.length?(t=typeof b=="function"?b:Mn(b),h):t},h.subject=function(b){return arguments.length?(n=typeof b=="function"?b:Mn(b),h):n},h.touchable=function(b){return arguments.length?(s=typeof b=="function"?b:Mn(!!b),h):s},h.on=function(){var b=i.on.apply(i,arguments);return b===i?h:b},h.clickDistance=function(b){return arguments.length?(f=(b=+b)*b,h):Math.sqrt(f)},h}function Fs(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Lo(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function mn(){}var on=.7,Wn=1/on,Ft="\\s*([+-]?\\d+)\\s*",an="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",nt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bl=/^#([0-9a-f]{3,8})$/,vl=new RegExp(`^rgb\\(${Ft},${Ft},${Ft}\\)$`),Nl=new RegExp(`^rgb\\(${nt},${nt},${nt}\\)$`),Sl=new RegExp(`^rgba\\(${Ft},${Ft},${Ft},${an}\\)$`),_l=new RegExp(`^rgba\\(${nt},${nt},${nt},${an}\\)$`),El=new RegExp(`^hsl\\(${an},${nt},${nt}\\)$`),jl=new RegExp(`^hsla\\(${an},${nt},${nt},${an}\\)$`),Mr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fs(mn,cn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Tr,formatHex:Tr,formatHex8:Cl,formatHsl:Al,formatRgb:$r,toString:$r});function Tr(){return this.rgb().formatHex()}function Cl(){return this.rgb().formatHex8()}function Al(){return Bo(this).formatHsl()}function $r(){return this.rgb().formatRgb()}function cn(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=bl.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Rr(t):n===3?new ze(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Tn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Tn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=vl.exec(e))?new ze(t[1],t[2],t[3],1):(t=Nl.exec(e))?new ze(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Sl.exec(e))?Tn(t[1],t[2],t[3],t[4]):(t=_l.exec(e))?Tn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=El.exec(e))?Dr(t[1],t[2]/100,t[3]/100,1):(t=jl.exec(e))?Dr(t[1],t[2]/100,t[3]/100,t[4]):Mr.hasOwnProperty(e)?Rr(Mr[e]):e==="transparent"?new ze(NaN,NaN,NaN,0):null}function Rr(e){return new ze(e>>16&255,e>>8&255,e&255,1)}function Tn(e,t,n,s){return s<=0&&(e=t=n=NaN),new ze(e,t,n,s)}function Il(e){return e instanceof mn||(e=cn(e)),e?(e=e.rgb(),new ze(e.r,e.g,e.b,e.opacity)):new ze}function _s(e,t,n,s){return arguments.length===1?Il(e):new ze(e,t,n,s??1)}function ze(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}Fs(ze,_s,Lo(mn,{brighter(e){return e=e==null?Wn:Math.pow(Wn,e),new ze(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?on:Math.pow(on,e),new ze(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ze(At(this.r),At(this.g),At(this.b),Yn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zr,formatHex:zr,formatHex8:Ml,formatRgb:Pr,toString:Pr}));function zr(){return`#${jt(this.r)}${jt(this.g)}${jt(this.b)}`}function Ml(){return`#${jt(this.r)}${jt(this.g)}${jt(this.b)}${jt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Pr(){const e=Yn(this.opacity);return`${e===1?"rgb(":"rgba("}${At(this.r)}, ${At(this.g)}, ${At(this.b)}${e===1?")":`, ${e})`}`}function Yn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function At(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function jt(e){return e=At(e),(e<16?"0":"")+e.toString(16)}function Dr(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ge(e,t,n,s)}function Bo(e){if(e instanceof Ge)return new Ge(e.h,e.s,e.l,e.opacity);if(e instanceof mn||(e=cn(e)),!e)return new Ge;if(e instanceof Ge)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,r=Math.min(t,n,s),i=Math.max(t,n,s),o=NaN,c=i-r,a=(i+r)/2;return c?(t===i?o=(n-s)/c+(n<s)*6:n===i?o=(s-t)/c+2:o=(t-n)/c+4,c/=a<.5?i+r:2-i-r,o*=60):c=a>0&&a<1?0:o,new Ge(o,c,a,e.opacity)}function Tl(e,t,n,s){return arguments.length===1?Bo(e):new Ge(e,t,n,s??1)}function Ge(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}Fs(Ge,Tl,Lo(mn,{brighter(e){return e=e==null?Wn:Math.pow(Wn,e),new Ge(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?on:Math.pow(on,e),new Ge(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,r=2*n-s;return new ze(fs(e>=240?e-240:e+120,r,s),fs(e,r,s),fs(e<120?e+240:e-120,r,s),this.opacity)},clamp(){return new Ge(kr(this.h),$n(this.s),$n(this.l),Yn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Yn(this.opacity);return`${e===1?"hsl(":"hsla("}${kr(this.h)}, ${$n(this.s)*100}%, ${$n(this.l)*100}%${e===1?")":`, ${e})`}`}}));function kr(e){return e=(e||0)%360,e<0?e+360:e}function $n(e){return Math.max(0,Math.min(1,e||0))}function fs(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Fo=e=>()=>e;function $l(e,t){return function(n){return e+n*t}}function Rl(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function zl(e){return(e=+e)==1?Vo:function(t,n){return n-t?Rl(t,n,e):Fo(isNaN(t)?n:t)}}function Vo(e,t){var n=t-e;return n?$l(e,n):Fo(isNaN(e)?t:e)}const Hr=function e(t){var n=zl(t);function s(r,i){var o=n((r=_s(r)).r,(i=_s(i)).r),c=n(r.g,i.g),a=n(r.b,i.b),l=Vo(r.opacity,i.opacity);return function(u){return r.r=o(u),r.g=c(u),r.b=a(u),r.opacity=l(u),r+""}}return s.gamma=e,s}(1);function xt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Es=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,hs=new RegExp(Es.source,"g");function Pl(e){return function(){return e}}function Dl(e){return function(t){return e(t)+""}}function kl(e,t){var n=Es.lastIndex=hs.lastIndex=0,s,r,i,o=-1,c=[],a=[];for(e=e+"",t=t+"";(s=Es.exec(e))&&(r=hs.exec(t));)(i=r.index)>n&&(i=t.slice(n,i),c[o]?c[o]+=i:c[++o]=i),(s=s[0])===(r=r[0])?c[o]?c[o]+=r:c[++o]=r:(c[++o]=null,a.push({i:o,x:xt(s,r)})),n=hs.lastIndex;return n<t.length&&(i=t.slice(n),c[o]?c[o]+=i:c[++o]=i),c.length<2?a[0]?Dl(a[0].x):Pl(t):(t=a.length,function(l){for(var u=0,f;u<t;++u)c[(f=a[u]).i]=f.x(l);return c.join("")})}var Lr=180/Math.PI,js={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Oo(e,t,n,s,r,i){var o,c,a;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(a=e*n+t*s)&&(n-=e*a,s-=t*a),(c=Math.sqrt(n*n+s*s))&&(n/=c,s/=c,a/=c),e*s<t*n&&(e=-e,t=-t,a=-a,o=-o),{translateX:r,translateY:i,rotate:Math.atan2(t,e)*Lr,skewX:Math.atan(a)*Lr,scaleX:o,scaleY:c}}var Rn;function Hl(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?js:Oo(t.a,t.b,t.c,t.d,t.e,t.f)}function Ll(e){return e==null||(Rn||(Rn=document.createElementNS("http://www.w3.org/2000/svg","g")),Rn.setAttribute("transform",e),!(e=Rn.transform.baseVal.consolidate()))?js:(e=e.matrix,Oo(e.a,e.b,e.c,e.d,e.e,e.f))}function Xo(e,t,n,s){function r(l){return l.length?l.pop()+" ":""}function i(l,u,f,h,p,N){if(l!==f||u!==h){var w=p.push("translate(",null,t,null,n);N.push({i:w-4,x:xt(l,f)},{i:w-2,x:xt(u,h)})}else(f||h)&&p.push("translate("+f+t+h+n)}function o(l,u,f,h){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),h.push({i:f.push(r(f)+"rotate(",null,s)-2,x:xt(l,u)})):u&&f.push(r(f)+"rotate("+u+s)}function c(l,u,f,h){l!==u?h.push({i:f.push(r(f)+"skewX(",null,s)-2,x:xt(l,u)}):u&&f.push(r(f)+"skewX("+u+s)}function a(l,u,f,h,p,N){if(l!==f||u!==h){var w=p.push(r(p)+"scale(",null,",",null,")");N.push({i:w-4,x:xt(l,f)},{i:w-2,x:xt(u,h)})}else(f!==1||h!==1)&&p.push(r(p)+"scale("+f+","+h+")")}return function(l,u){var f=[],h=[];return l=e(l),u=e(u),i(l.translateX,l.translateY,u.translateX,u.translateY,f,h),o(l.rotate,u.rotate,f,h),c(l.skewX,u.skewX,f,h),a(l.scaleX,l.scaleY,u.scaleX,u.scaleY,f,h),l=u=null,function(p){for(var N=-1,w=h.length,y;++N<w;)f[(y=h[N]).i]=y.x(p);return f.join("")}}}var Bl=Xo(Hl,"px, ","px)","deg)"),Fl=Xo(Ll,", ",")",")"),Vl=1e-12;function Br(e){return((e=Math.exp(e))+1/e)/2}function Ol(e){return((e=Math.exp(e))-1/e)/2}function Xl(e){return((e=Math.exp(2*e))-1)/(e+1)}const Wl=function e(t,n,s){function r(i,o){var c=i[0],a=i[1],l=i[2],u=o[0],f=o[1],h=o[2],p=u-c,N=f-a,w=p*p+N*N,y,x;if(w<Vl)x=Math.log(h/l)/t,y=function(P){return[c+P*p,a+P*N,l*Math.exp(t*P*x)]};else{var _=Math.sqrt(w),j=(h*h-l*l+s*w)/(2*l*n*_),b=(h*h-l*l-s*w)/(2*h*n*_),I=Math.log(Math.sqrt(j*j+1)-j),T=Math.log(Math.sqrt(b*b+1)-b);x=(T-I)/t,y=function(P){var D=P*x,M=Br(I),B=l/(n*_)*(M*Xl(t*D+I)-Ol(I));return[c+B*p,a+B*N,l*M/Br(t*D+I)]}}return y.duration=x*1e3*t/Math.SQRT2,y}return r.rho=function(i){var o=Math.max(.001,+i),c=o*o,a=c*c;return e(o,c,a)},r}(Math.SQRT2,2,4);var Xt=0,en=0,Gt=0,Wo=1e3,Un,tn,Gn=0,Mt=0,ns=0,ln=typeof performance=="object"&&performance.now?performance:Date,Yo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Vs(){return Mt||(Yo(Yl),Mt=ln.now()+ns)}function Yl(){Mt=0}function qn(){this._call=this._time=this._next=null}qn.prototype=Uo.prototype={constructor:qn,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Vs():+n)+(t==null?0:+t),!this._next&&tn!==this&&(tn?tn._next=this:Un=this,tn=this),this._call=e,this._time=n,Cs()},stop:function(){this._call&&(this._call=null,this._time=1/0,Cs())}};function Uo(e,t,n){var s=new qn;return s.restart(e,t,n),s}function Ul(){Vs(),++Xt;for(var e=Un,t;e;)(t=Mt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Xt}function Fr(){Mt=(Gn=ln.now())+ns,Xt=en=0;try{Ul()}finally{Xt=0,ql(),Mt=0}}function Gl(){var e=ln.now(),t=e-Gn;t>Wo&&(ns-=t,Gn=e)}function ql(){for(var e,t=Un,n,s=1/0;t;)t._call?(s>t._time&&(s=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Un=n);tn=e,Cs(s)}function Cs(e){if(!Xt){en&&(en=clearTimeout(en));var t=e-Mt;t>24?(e<1/0&&(en=setTimeout(Fr,e-ln.now()-ns)),Gt&&(Gt=clearInterval(Gt))):(Gt||(Gn=ln.now(),Gt=setInterval(Gl,Wo)),Xt=1,Yo(Fr))}}function Vr(e,t,n){var s=new qn;return t=t==null?0:+t,s.restart(r=>{s.stop(),e(r+t)},t,n),s}var Zl=es("start","end","cancel","interrupt"),Kl=[],Go=0,Or=1,As=2,Bn=3,Xr=4,Is=5,Fn=6;function ss(e,t,n,s,r,i){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;Ql(e,n,{name:t,index:s,group:r,on:Zl,tween:Kl,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Go})}function Os(e,t){var n=Ze(e,t);if(n.state>Go)throw new Error("too late; already scheduled");return n}function st(e,t){var n=Ze(e,t);if(n.state>Bn)throw new Error("too late; already running");return n}function Ze(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ql(e,t,n){var s=e.__transition,r;s[t]=n,n.timer=Uo(i,0,n.time);function i(l){n.state=Or,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var u,f,h,p;if(n.state!==Or)return a();for(u in s)if(p=s[u],p.name===n.name){if(p.state===Bn)return Vr(o);p.state===Xr?(p.state=Fn,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete s[u]):+u<t&&(p.state=Fn,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete s[u])}if(Vr(function(){n.state===Bn&&(n.state=Xr,n.timer.restart(c,n.delay,n.time),c(l))}),n.state=As,n.on.call("start",e,e.__data__,n.index,n.group),n.state===As){for(n.state=Bn,r=new Array(h=n.tween.length),u=0,f=-1;u<h;++u)(p=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(r[++f]=p);r.length=f+1}}function c(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(a),n.state=Is,1),f=-1,h=r.length;++f<h;)r[f].call(e,u);n.state===Is&&(n.on.call("end",e,e.__data__,n.index,n.group),a())}function a(){n.state=Fn,n.timer.stop(),delete s[t];for(var l in s)return;delete e.__transition}}function Vn(e,t){var n=e.__transition,s,r,i=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((s=n[o]).name!==t){i=!1;continue}r=s.state>As&&s.state<Is,s.state=Fn,s.timer.stop(),s.on.call(r?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete n[o]}i&&delete e.__transition}}function Jl(e){return this.each(function(){Vn(this,e)})}function eu(e,t){var n,s;return function(){var r=st(this,e),i=r.tween;if(i!==n){s=n=i;for(var o=0,c=s.length;o<c;++o)if(s[o].name===t){s=s.slice(),s.splice(o,1);break}}r.tween=s}}function tu(e,t,n){var s,r;if(typeof n!="function")throw new Error;return function(){var i=st(this,e),o=i.tween;if(o!==s){r=(s=o).slice();for(var c={name:t,value:n},a=0,l=r.length;a<l;++a)if(r[a].name===t){r[a]=c;break}a===l&&r.push(c)}i.tween=r}}function nu(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s=Ze(this.node(),n).tween,r=0,i=s.length,o;r<i;++r)if((o=s[r]).name===e)return o.value;return null}return this.each((t==null?eu:tu)(n,e,t))}function Xs(e,t,n){var s=e._id;return e.each(function(){var r=st(this,s);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return Ze(r,s).value[t]}}function qo(e,t){var n;return(typeof t=="number"?xt:t instanceof cn?Hr:(n=cn(t))?(t=n,Hr):kl)(e,t)}function su(e){return function(){this.removeAttribute(e)}}function ru(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ou(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttribute(e);return o===r?null:o===s?i:i=t(s=o,n)}}function iu(e,t,n){var s,r=n+"",i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===s?i:i=t(s=o,n)}}function au(e,t,n){var s,r,i;return function(){var o,c=n(this),a;return c==null?void this.removeAttribute(e):(o=this.getAttribute(e),a=c+"",o===a?null:o===s&&a===r?i:(r=a,i=t(s=o,c)))}}function cu(e,t,n){var s,r,i;return function(){var o,c=n(this),a;return c==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),a=c+"",o===a?null:o===s&&a===r?i:(r=a,i=t(s=o,c)))}}function lu(e,t){var n=ts(e),s=n==="transform"?Fl:qo;return this.attrTween(e,typeof t=="function"?(n.local?cu:au)(n,s,Xs(this,"attr."+e,t)):t==null?(n.local?ru:su)(n):(n.local?iu:ou)(n,s,t))}function uu(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function du(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function fu(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&du(e,i)),n}return r._value=t,r}function hu(e,t){var n,s;function r(){var i=t.apply(this,arguments);return i!==s&&(n=(s=i)&&uu(e,i)),n}return r._value=t,r}function mu(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var s=ts(e);return this.tween(n,(s.local?fu:hu)(s,t))}function gu(e,t){return function(){Os(this,e).delay=+t.apply(this,arguments)}}function pu(e,t){return t=+t,function(){Os(this,e).delay=t}}function xu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?gu:pu)(t,e)):Ze(this.node(),t).delay}function yu(e,t){return function(){st(this,e).duration=+t.apply(this,arguments)}}function wu(e,t){return t=+t,function(){st(this,e).duration=t}}function bu(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?yu:wu)(t,e)):Ze(this.node(),t).duration}function vu(e,t){if(typeof t!="function")throw new Error;return function(){st(this,e).ease=t}}function Nu(e){var t=this._id;return arguments.length?this.each(vu(t,e)):Ze(this.node(),t).ease}function Su(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;st(this,e).ease=n}}function _u(e){if(typeof e!="function")throw new Error;return this.each(Su(this._id,e))}function Eu(e){typeof e!="function"&&(e=Co(e));for(var t=this._groups,n=t.length,s=new Array(n),r=0;r<n;++r)for(var i=t[r],o=i.length,c=s[r]=[],a,l=0;l<o;++l)(a=i[l])&&e.call(a,a.__data__,l,i)&&c.push(a);return new ft(s,this._parents,this._name,this._id)}function ju(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,s=t.length,r=n.length,i=Math.min(s,r),o=new Array(s),c=0;c<i;++c)for(var a=t[c],l=n[c],u=a.length,f=o[c]=new Array(u),h,p=0;p<u;++p)(h=a[p]||l[p])&&(f[p]=h);for(;c<s;++c)o[c]=t[c];return new ft(o,this._parents,this._name,this._id)}function Cu(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Au(e,t,n){var s,r,i=Cu(t)?Os:st;return function(){var o=i(this,e),c=o.on;c!==s&&(r=(s=c).copy()).on(t,n),o.on=r}}function Iu(e,t){var n=this._id;return arguments.length<2?Ze(this.node(),n).on.on(e):this.each(Au(n,e,t))}function Mu(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Tu(){return this.on("end.remove",Mu(this._id))}function $u(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ls(e));for(var s=this._groups,r=s.length,i=new Array(r),o=0;o<r;++o)for(var c=s[o],a=c.length,l=i[o]=new Array(a),u,f,h=0;h<a;++h)(u=c[h])&&(f=e.call(u,u.__data__,h,c))&&("__data__"in u&&(f.__data__=u.__data__),l[h]=f,ss(l[h],t,n,h,l,Ze(u,n)));return new ft(i,this._parents,t,n)}function Ru(e){var t=this._name,n=this._id;typeof e!="function"&&(e=jo(e));for(var s=this._groups,r=s.length,i=[],o=[],c=0;c<r;++c)for(var a=s[c],l=a.length,u,f=0;f<l;++f)if(u=a[f]){for(var h=e.call(u,u.__data__,f,a),p,N=Ze(u,n),w=0,y=h.length;w<y;++w)(p=h[w])&&ss(p,t,n,w,h,N);i.push(h),o.push(u)}return new ft(i,o,t,n)}var zu=hn.prototype.constructor;function Pu(){return new zu(this._groups,this._parents)}function Du(e,t){var n,s,r;return function(){var i=Ot(this,e),o=(this.style.removeProperty(e),Ot(this,e));return i===o?null:i===n&&o===s?r:r=t(n=i,s=o)}}function Zo(e){return function(){this.style.removeProperty(e)}}function ku(e,t,n){var s,r=n+"",i;return function(){var o=Ot(this,e);return o===r?null:o===s?i:i=t(s=o,n)}}function Hu(e,t,n){var s,r,i;return function(){var o=Ot(this,e),c=n(this),a=c+"";return c==null&&(a=c=(this.style.removeProperty(e),Ot(this,e))),o===a?null:o===s&&a===r?i:(r=a,i=t(s=o,c))}}function Lu(e,t){var n,s,r,i="style."+t,o="end."+i,c;return function(){var a=st(this,e),l=a.on,u=a.value[i]==null?c||(c=Zo(t)):void 0;(l!==n||r!==u)&&(s=(n=l).copy()).on(o,r=u),a.on=s}}function Bu(e,t,n){var s=(e+="")=="transform"?Bl:qo;return t==null?this.styleTween(e,Du(e,s)).on("end.style."+e,Zo(e)):typeof t=="function"?this.styleTween(e,Hu(e,s,Xs(this,"style."+e,t))).each(Lu(this._id,e)):this.styleTween(e,ku(e,s,t),n).on("end.style."+e,null)}function Fu(e,t,n){return function(s){this.style.setProperty(e,t.call(this,s),n)}}function Vu(e,t,n){var s,r;function i(){var o=t.apply(this,arguments);return o!==r&&(s=(r=o)&&Fu(e,o,n)),s}return i._value=t,i}function Ou(e,t,n){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,Vu(e,t,n??""))}function Xu(e){return function(){this.textContent=e}}function Wu(e){return function(){var t=e(this);this.textContent=t??""}}function Yu(e){return this.tween("text",typeof e=="function"?Wu(Xs(this,"text",e)):Xu(e==null?"":e+""))}function Uu(e){return function(t){this.textContent=e.call(this,t)}}function Gu(e){var t,n;function s(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Uu(r)),t}return s._value=e,s}function qu(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Gu(e))}function Zu(){for(var e=this._name,t=this._id,n=Ko(),s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],c=o.length,a,l=0;l<c;++l)if(a=o[l]){var u=Ze(a,t);ss(a,e,n,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ft(s,this._parents,e,n)}function Ku(){var e,t,n=this,s=n._id,r=n.size();return new Promise(function(i,o){var c={value:o},a={value:function(){--r===0&&i()}};n.each(function(){var l=st(this,s),u=l.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(c),t._.interrupt.push(c),t._.end.push(a)),l.on=t}),r===0&&i()})}var Qu=0;function ft(e,t,n,s){this._groups=e,this._parents=t,this._name=n,this._id=s}function Ko(){return++Qu}var lt=hn.prototype;ft.prototype={constructor:ft,select:$u,selectAll:Ru,selectChild:lt.selectChild,selectChildren:lt.selectChildren,filter:Eu,merge:ju,selection:Pu,transition:Zu,call:lt.call,nodes:lt.nodes,node:lt.node,size:lt.size,empty:lt.empty,each:lt.each,on:Iu,attr:lu,attrTween:mu,style:Bu,styleTween:Ou,text:Yu,textTween:qu,remove:Tu,tween:nu,delay:xu,duration:bu,ease:Nu,easeVarying:_u,end:Ku,[Symbol.iterator]:lt[Symbol.iterator]};function Ju(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var ed={time:null,delay:0,duration:250,ease:Ju};function td(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function nd(e){var t,n;e instanceof ft?(t=e._id,e=e._name):(t=Ko(),(n=ed).time=Vs(),e=e==null?null:e+"");for(var s=this._groups,r=s.length,i=0;i<r;++i)for(var o=s[i],c=o.length,a,l=0;l<c;++l)(a=o[l])&&ss(a,e,t,l,o,n||td(a,t));return new ft(s,this._parents,e,t)}hn.prototype.interrupt=Jl;hn.prototype.transition=nd;const zn=e=>()=>e;function sd(e,{sourceEvent:t,target:n,transform:s,dispatch:r}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:r}})}function ut(e,t,n){this.k=e,this.x=t,this.y=n}ut.prototype={constructor:ut,scale:function(e){return e===1?this:new ut(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ut(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var dt=new ut(1,0,0);ut.prototype;function ms(e){e.stopImmediatePropagation()}function qt(e){e.preventDefault(),e.stopImmediatePropagation()}function rd(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function od(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Wr(){return this.__zoom||dt}function id(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function ad(){return navigator.maxTouchPoints||"ontouchstart"in this}function cd(e,t,n){var s=e.invertX(t[0][0])-n[0][0],r=e.invertX(t[1][0])-n[1][0],i=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(r>s?(s+r)/2:Math.min(0,s)||Math.max(0,r),o>i?(i+o)/2:Math.min(0,i)||Math.max(0,o))}function Qo(){var e=rd,t=od,n=cd,s=id,r=ad,i=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],c=250,a=Wl,l=es("start","zoom","end"),u,f,h,p=500,N=150,w=0,y=10;function x(g){g.property("__zoom",Wr).on("wheel.zoom",D,{passive:!1}).on("mousedown.zoom",M).on("dblclick.zoom",B).filter(r).on("touchstart.zoom",F).on("touchmove.zoom",O).on("touchend.zoom touchcancel.zoom",L).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(g,C,S,R){var k=g.selection?g.selection():g;k.property("__zoom",Wr),g!==k?I(g,C,S,R):k.interrupt().each(function(){T(this,arguments).event(R).start().zoom(null,typeof C=="function"?C.apply(this,arguments):C).end()})},x.scaleBy=function(g,C,S,R){x.scaleTo(g,function(){var k=this.__zoom.k,E=typeof C=="function"?C.apply(this,arguments):C;return k*E},S,R)},x.scaleTo=function(g,C,S,R){x.transform(g,function(){var k=t.apply(this,arguments),E=this.__zoom,$=S==null?b(k):typeof S=="function"?S.apply(this,arguments):S,z=E.invert($),H=typeof C=="function"?C.apply(this,arguments):C;return n(j(_(E,H),$,z),k,o)},S,R)},x.translateBy=function(g,C,S,R){x.transform(g,function(){return n(this.__zoom.translate(typeof C=="function"?C.apply(this,arguments):C,typeof S=="function"?S.apply(this,arguments):S),t.apply(this,arguments),o)},null,R)},x.translateTo=function(g,C,S,R,k){x.transform(g,function(){var E=t.apply(this,arguments),$=this.__zoom,z=R==null?b(E):typeof R=="function"?R.apply(this,arguments):R;return n(dt.translate(z[0],z[1]).scale($.k).translate(typeof C=="function"?-C.apply(this,arguments):-C,typeof S=="function"?-S.apply(this,arguments):-S),E,o)},R,k)};function _(g,C){return C=Math.max(i[0],Math.min(i[1],C)),C===g.k?g:new ut(C,g.x,g.y)}function j(g,C,S){var R=C[0]-S[0]*g.k,k=C[1]-S[1]*g.k;return R===g.x&&k===g.y?g:new ut(g.k,R,k)}function b(g){return[(+g[0][0]+ +g[1][0])/2,(+g[0][1]+ +g[1][1])/2]}function I(g,C,S,R){g.on("start.zoom",function(){T(this,arguments).event(R).start()}).on("interrupt.zoom end.zoom",function(){T(this,arguments).event(R).end()}).tween("zoom",function(){var k=this,E=arguments,$=T(k,E).event(R),z=t.apply(k,E),H=S==null?b(z):typeof S=="function"?S.apply(k,E):S,Y=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),W=k.__zoom,U=typeof C=="function"?C.apply(k,E):C,Q=a(W.invert(H).concat(Y/W.k),U.invert(H).concat(Y/U.k));return function(J){if(J===1)J=U;else{var oe=Q(J),ie=Y/oe[2];J=new ut(ie,H[0]-oe[0]*ie,H[1]-oe[1]*ie)}$.zoom(null,J)}})}function T(g,C,S){return!S&&g.__zooming||new P(g,C)}function P(g,C){this.that=g,this.args=C,this.active=0,this.sourceEvent=null,this.extent=t.apply(g,C),this.taps=0}P.prototype={event:function(g){return g&&(this.sourceEvent=g),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(g,C){return this.mouse&&g!=="mouse"&&(this.mouse[1]=C.invert(this.mouse[0])),this.touch0&&g!=="touch"&&(this.touch0[1]=C.invert(this.touch0[0])),this.touch1&&g!=="touch"&&(this.touch1[1]=C.invert(this.touch1[0])),this.that.__zoom=C,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(g){var C=He(this.that).datum();l.call(g,this.that,new sd(g,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:l}),C)}};function D(g,...C){if(!e.apply(this,arguments))return;var S=T(this,C).event(g),R=this.__zoom,k=Math.max(i[0],Math.min(i[1],R.k*Math.pow(2,s.apply(this,arguments)))),E=Ue(g);if(S.wheel)(S.mouse[0][0]!==E[0]||S.mouse[0][1]!==E[1])&&(S.mouse[1]=R.invert(S.mouse[0]=E)),clearTimeout(S.wheel);else{if(R.k===k)return;S.mouse=[E,R.invert(E)],Vn(this),S.start()}qt(g),S.wheel=setTimeout($,N),S.zoom("mouse",n(j(_(R,k),S.mouse[0],S.mouse[1]),S.extent,o));function $(){S.wheel=null,S.end()}}function M(g,...C){if(h||!e.apply(this,arguments))return;var S=g.currentTarget,R=T(this,C,!0).event(g),k=He(g.view).on("mousemove.zoom",H,!0).on("mouseup.zoom",Y,!0),E=Ue(g,S),$=g.clientX,z=g.clientY;ko(g.view),ms(g),R.mouse=[E,this.__zoom.invert(E)],Vn(this),R.start();function H(W){if(qt(W),!R.moved){var U=W.clientX-$,Q=W.clientY-z;R.moved=U*U+Q*Q>w}R.event(W).zoom("mouse",n(j(R.that.__zoom,R.mouse[0]=Ue(W,S),R.mouse[1]),R.extent,o))}function Y(W){k.on("mousemove.zoom mouseup.zoom",null),Ho(W.view,R.moved),qt(W),R.event(W).end()}}function B(g,...C){if(e.apply(this,arguments)){var S=this.__zoom,R=Ue(g.changedTouches?g.changedTouches[0]:g,this),k=S.invert(R),E=S.k*(g.shiftKey?.5:2),$=n(j(_(S,E),R,k),t.apply(this,C),o);qt(g),c>0?He(this).transition().duration(c).call(I,$,R,g):He(this).call(x.transform,$,R,g)}}function F(g,...C){if(e.apply(this,arguments)){var S=g.touches,R=S.length,k=T(this,C,g.changedTouches.length===R).event(g),E,$,z,H;for(ms(g),$=0;$<R;++$)z=S[$],H=Ue(z,this),H=[H,this.__zoom.invert(H),z.identifier],k.touch0?!k.touch1&&k.touch0[2]!==H[2]&&(k.touch1=H,k.taps=0):(k.touch0=H,E=!0,k.taps=1+!!u);u&&(u=clearTimeout(u)),E&&(k.taps<2&&(f=H[0],u=setTimeout(function(){u=null},p)),Vn(this),k.start())}}function O(g,...C){if(this.__zooming){var S=T(this,C).event(g),R=g.changedTouches,k=R.length,E,$,z,H;for(qt(g),E=0;E<k;++E)$=R[E],z=Ue($,this),S.touch0&&S.touch0[2]===$.identifier?S.touch0[0]=z:S.touch1&&S.touch1[2]===$.identifier&&(S.touch1[0]=z);if($=S.that.__zoom,S.touch1){var Y=S.touch0[0],W=S.touch0[1],U=S.touch1[0],Q=S.touch1[1],J=(J=U[0]-Y[0])*J+(J=U[1]-Y[1])*J,oe=(oe=Q[0]-W[0])*oe+(oe=Q[1]-W[1])*oe;$=_($,Math.sqrt(J/oe)),z=[(Y[0]+U[0])/2,(Y[1]+U[1])/2],H=[(W[0]+Q[0])/2,(W[1]+Q[1])/2]}else if(S.touch0)z=S.touch0[0],H=S.touch0[1];else return;S.zoom("touch",n(j($,z,H),S.extent,o))}}function L(g,...C){if(this.__zooming){var S=T(this,C).event(g),R=g.changedTouches,k=R.length,E,$;for(ms(g),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),E=0;E<k;++E)$=R[E],S.touch0&&S.touch0[2]===$.identifier?delete S.touch0:S.touch1&&S.touch1[2]===$.identifier&&delete S.touch1;if(S.touch1&&!S.touch0&&(S.touch0=S.touch1,delete S.touch1),S.touch0)S.touch0[1]=this.__zoom.invert(S.touch0[0]);else if(S.end(),S.taps===2&&($=Ue($,this),Math.hypot(f[0]-$[0],f[1]-$[1])<y)){var z=He(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return x.wheelDelta=function(g){return arguments.length?(s=typeof g=="function"?g:zn(+g),x):s},x.filter=function(g){return arguments.length?(e=typeof g=="function"?g:zn(!!g),x):e},x.touchable=function(g){return arguments.length?(r=typeof g=="function"?g:zn(!!g),x):r},x.extent=function(g){return arguments.length?(t=typeof g=="function"?g:zn([[+g[0][0],+g[0][1]],[+g[1][0],+g[1][1]]]),x):t},x.scaleExtent=function(g){return arguments.length?(i[0]=+g[0],i[1]=+g[1],x):[i[0],i[1]]},x.translateExtent=function(g){return arguments.length?(o[0][0]=+g[0][0],o[1][0]=+g[1][0],o[0][1]=+g[0][1],o[1][1]=+g[1][1],x):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},x.constrain=function(g){return arguments.length?(n=g,x):n},x.duration=function(g){return arguments.length?(c=+g,x):c},x.interpolate=function(g){return arguments.length?(a=g,x):a},x.on=function(){var g=l.on.apply(l,arguments);return g===l?x:g},x.clickDistance=function(g){return arguments.length?(w=(g=+g)*g,x):Math.sqrt(w)},x.tapDistance=function(g){return arguments.length?(y=+g,x):y},x}const rs=v.createContext(null),ld=rs.Provider,ht={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:e=>`Node type "${e}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:e=>`The old edge with id=${e} does not exist.`,error009:e=>`Marker type "${e}" doesn't exist.`,error008:(e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:e=>`Edge type "${e}" not found. Using fallback type "default".`,error012:e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`},Jo=ht.error001();function he(e,t){const n=v.useContext(rs);if(n===null)throw new Error(Jo);return _o(n,e,t)}const Ne=()=>{const e=v.useContext(rs);if(e===null)throw new Error(Jo);return v.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},ud=e=>e.userSelectionActive?"none":"all";function Ws({position:e,children:t,className:n,style:s,...r}){const i=he(ud),o=`${e}`.split("-");return A.createElement("div",{className:je(["react-flow__panel",n,...o]),style:{...s,pointerEvents:i},...r},t)}function dd({proOptions:e,position:t="bottom-right"}){return e!=null&&e.hideAttribution?null:A.createElement(Ws,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},A.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}const fd=({x:e,y:t,label:n,labelStyle:s={},labelShowBg:r=!0,labelBgStyle:i={},labelBgPadding:o=[2,4],labelBgBorderRadius:c=2,children:a,className:l,...u})=>{const f=v.useRef(null),[h,p]=v.useState({x:0,y:0,width:0,height:0}),N=je(["react-flow__edge-textwrapper",l]);return v.useEffect(()=>{if(f.current){const w=f.current.getBBox();p({x:w.x,y:w.y,width:w.width,height:w.height})}},[n]),typeof n>"u"||!n?null:A.createElement("g",{transform:`translate(${e-h.width/2} ${t-h.height/2})`,className:N,visibility:h.width?"visible":"hidden",...u},r&&A.createElement("rect",{width:h.width+2*o[0],x:-o[0],y:-o[1],height:h.height+2*o[1],className:"react-flow__edge-textbg",style:i,rx:c,ry:c}),A.createElement("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:f,style:s},n),a)};var hd=v.memo(fd);const Ys=e=>({width:e.offsetWidth,height:e.offsetHeight}),Wt=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Us=(e={x:0,y:0},t)=>({x:Wt(e.x,t[0][0],t[1][0]),y:Wt(e.y,t[0][1],t[1][1])}),Yr=(e,t,n)=>e<t?Wt(Math.abs(e-t),1,50)/50:e>n?-Wt(Math.abs(e-n),1,50)/50:0,ei=(e,t)=>{const n=Yr(e.x,35,t.width-35)*20,s=Yr(e.y,35,t.height-35)*20;return[n,s]},ti=e=>{var t;return((t=e.getRootNode)==null?void 0:t.call(e))||(window==null?void 0:window.document)},ni=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),un=({x:e,y:t,width:n,height:s})=>({x:e,y:t,x2:e+n,y2:t+s}),si=({x:e,y:t,x2:n,y2:s})=>({x:e,y:t,width:n-e,height:s-t}),Ur=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),md=(e,t)=>si(ni(un(e),un(t))),Ms=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),s=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*s)},gd=e=>Le(e.width)&&Le(e.height)&&Le(e.x)&&Le(e.y),Le=e=>!isNaN(e)&&isFinite(e),pe=Symbol.for("internals"),ri=["Enter"," ","Escape"],pd=(e,t)=>{},xd=e=>"nativeEvent"in e;function Ts(e){var r,i;const t=xd(e)?e.nativeEvent:e,n=((i=(r=t.composedPath)==null?void 0:r.call(t))==null?void 0:i[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(n==null?void 0:n.nodeName)||(n==null?void 0:n.hasAttribute("contenteditable"))||!!(n!=null&&n.closest(".nokey"))}const oi=e=>"clientX"in e,bt=(e,t)=>{var i,o;const n=oi(e),s=n?e.clientX:(i=e.touches)==null?void 0:i[0].clientX,r=n?e.clientY:(o=e.touches)==null?void 0:o[0].clientY;return{x:s-((t==null?void 0:t.left)??0),y:r-((t==null?void 0:t.top)??0)}},Zn=()=>{var e;return typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)==null?void 0:e.indexOf("Mac"))>=0},gn=({id:e,path:t,labelX:n,labelY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l,style:u,markerEnd:f,markerStart:h,interactionWidth:p=20})=>A.createElement(A.Fragment,null,A.createElement("path",{id:e,style:u,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:f,markerStart:h}),p&&A.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:p,className:"react-flow__edge-interaction"}),r&&Le(n)&&Le(s)?A.createElement(hd,{x:n,y:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l}):null);gn.displayName="BaseEdge";function Zt(e,t,n){return n===void 0?n:s=>{const r=t().edges.find(i=>i.id===e);r&&n(s,{...r})}}function ii({sourceX:e,sourceY:t,targetX:n,targetY:s}){const r=Math.abs(n-e)/2,i=n<e?n+r:n-r,o=Math.abs(s-t)/2,c=s<t?s+o:s-o;return[i,c,r,o]}function ai({sourceX:e,sourceY:t,targetX:n,targetY:s,sourceControlX:r,sourceControlY:i,targetControlX:o,targetControlY:c}){const a=e*.125+r*.375+o*.375+n*.125,l=t*.125+i*.375+c*.375+s*.125,u=Math.abs(a-e),f=Math.abs(l-t);return[a,l,u,f]}var Tt;(function(e){e.Strict="strict",e.Loose="loose"})(Tt||(Tt={}));var Ct;(function(e){e.Free="free",e.Vertical="vertical",e.Horizontal="horizontal"})(Ct||(Ct={}));var dn;(function(e){e.Partial="partial",e.Full="full"})(dn||(dn={}));var wt;(function(e){e.Bezier="default",e.Straight="straight",e.Step="step",e.SmoothStep="smoothstep",e.SimpleBezier="simplebezier"})(wt||(wt={}));var Kn;(function(e){e.Arrow="arrow",e.ArrowClosed="arrowclosed"})(Kn||(Kn={}));var Z;(function(e){e.Left="left",e.Top="top",e.Right="right",e.Bottom="bottom"})(Z||(Z={}));function Gr({pos:e,x1:t,y1:n,x2:s,y2:r}){return e===Z.Left||e===Z.Right?[.5*(t+s),n]:[t,.5*(n+r)]}function ci({sourceX:e,sourceY:t,sourcePosition:n=Z.Bottom,targetX:s,targetY:r,targetPosition:i=Z.Top}){const[o,c]=Gr({pos:n,x1:e,y1:t,x2:s,y2:r}),[a,l]=Gr({pos:i,x1:s,y1:r,x2:e,y2:t}),[u,f,h,p]=ai({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:o,sourceControlY:c,targetControlX:a,targetControlY:l});return[`M${e},${t} C${o},${c} ${a},${l} ${s},${r}`,u,f,h,p]}const Gs=v.memo(({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r=Z.Bottom,targetPosition:i=Z.Top,label:o,labelStyle:c,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:f,style:h,markerEnd:p,markerStart:N,interactionWidth:w})=>{const[y,x,_]=ci({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:s,targetPosition:i});return A.createElement(gn,{path:y,labelX:x,labelY:_,label:o,labelStyle:c,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:f,style:h,markerEnd:p,markerStart:N,interactionWidth:w})});Gs.displayName="SimpleBezierEdge";const qr={[Z.Left]:{x:-1,y:0},[Z.Right]:{x:1,y:0},[Z.Top]:{x:0,y:-1},[Z.Bottom]:{x:0,y:1}},yd=({source:e,sourcePosition:t=Z.Bottom,target:n})=>t===Z.Left||t===Z.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1},Zr=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function wd({source:e,sourcePosition:t=Z.Bottom,target:n,targetPosition:s=Z.Top,center:r,offset:i}){const o=qr[t],c=qr[s],a={x:e.x+o.x*i,y:e.y+o.y*i},l={x:n.x+c.x*i,y:n.y+c.y*i},u=yd({source:a,sourcePosition:t,target:l}),f=u.x!==0?"x":"y",h=u[f];let p=[],N,w;const y={x:0,y:0},x={x:0,y:0},[_,j,b,I]=ii({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(o[f]*c[f]===-1){N=r.x??_,w=r.y??j;const P=[{x:N,y:a.y},{x:N,y:l.y}],D=[{x:a.x,y:w},{x:l.x,y:w}];o[f]===h?p=f==="x"?P:D:p=f==="x"?D:P}else{const P=[{x:a.x,y:l.y}],D=[{x:l.x,y:a.y}];if(f==="x"?p=o.x===h?D:P:p=o.y===h?P:D,t===s){const L=Math.abs(e[f]-n[f]);if(L<=i){const g=Math.min(i-1,i-L);o[f]===h?y[f]=(a[f]>e[f]?-1:1)*g:x[f]=(l[f]>n[f]?-1:1)*g}}if(t!==s){const L=f==="x"?"y":"x",g=o[f]===c[L],C=a[L]>l[L],S=a[L]<l[L];(o[f]===1&&(!g&&C||g&&S)||o[f]!==1&&(!g&&S||g&&C))&&(p=f==="x"?P:D)}const M={x:a.x+y.x,y:a.y+y.y},B={x:l.x+x.x,y:l.y+x.y},F=Math.max(Math.abs(M.x-p[0].x),Math.abs(B.x-p[0].x)),O=Math.max(Math.abs(M.y-p[0].y),Math.abs(B.y-p[0].y));F>=O?(N=(M.x+B.x)/2,w=p[0].y):(N=p[0].x,w=(M.y+B.y)/2)}return[[e,{x:a.x+y.x,y:a.y+y.y},...p,{x:l.x+x.x,y:l.y+x.y},n],N,w,b,I]}function bd(e,t,n,s){const r=Math.min(Zr(e,t)/2,Zr(t,n)/2,s),{x:i,y:o}=t;if(e.x===i&&i===n.x||e.y===o&&o===n.y)return`L${i} ${o}`;if(e.y===o){const l=e.x<n.x?-1:1,u=e.y<n.y?1:-1;return`L ${i+r*l},${o}Q ${i},${o} ${i},${o+r*u}`}const c=e.x<n.x?1:-1,a=e.y<n.y?-1:1;return`L ${i},${o+r*a}Q ${i},${o} ${i+r*c},${o}`}function $s({sourceX:e,sourceY:t,sourcePosition:n=Z.Bottom,targetX:s,targetY:r,targetPosition:i=Z.Top,borderRadius:o=5,centerX:c,centerY:a,offset:l=20}){const[u,f,h,p,N]=wd({source:{x:e,y:t},sourcePosition:n,target:{x:s,y:r},targetPosition:i,center:{x:c,y:a},offset:l});return[u.reduce((y,x,_)=>{let j="";return _>0&&_<u.length-1?j=bd(u[_-1],x,u[_+1],o):j=`${_===0?"M":"L"}${x.x} ${x.y}`,y+=j,y},""),f,h,p,N]}const os=v.memo(({sourceX:e,sourceY:t,targetX:n,targetY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l,style:u,sourcePosition:f=Z.Bottom,targetPosition:h=Z.Top,markerEnd:p,markerStart:N,pathOptions:w,interactionWidth:y})=>{const[x,_,j]=$s({sourceX:e,sourceY:t,sourcePosition:f,targetX:n,targetY:s,targetPosition:h,borderRadius:w==null?void 0:w.borderRadius,offset:w==null?void 0:w.offset});return A.createElement(gn,{path:x,labelX:_,labelY:j,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l,style:u,markerEnd:p,markerStart:N,interactionWidth:y})});os.displayName="SmoothStepEdge";const qs=v.memo(e=>{var t;return A.createElement(os,{...e,pathOptions:v.useMemo(()=>{var n;return{borderRadius:0,offset:(n=e.pathOptions)==null?void 0:n.offset}},[(t=e.pathOptions)==null?void 0:t.offset])})});qs.displayName="StepEdge";function vd({sourceX:e,sourceY:t,targetX:n,targetY:s}){const[r,i,o,c]=ii({sourceX:e,sourceY:t,targetX:n,targetY:s});return[`M ${e},${t}L ${n},${s}`,r,i,o,c]}const Zs=v.memo(({sourceX:e,sourceY:t,targetX:n,targetY:s,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l,style:u,markerEnd:f,markerStart:h,interactionWidth:p})=>{const[N,w,y]=vd({sourceX:e,sourceY:t,targetX:n,targetY:s});return A.createElement(gn,{path:N,labelX:w,labelY:y,label:r,labelStyle:i,labelShowBg:o,labelBgStyle:c,labelBgPadding:a,labelBgBorderRadius:l,style:u,markerEnd:f,markerStart:h,interactionWidth:p})});Zs.displayName="StraightEdge";function Pn(e,t){return e>=0?.5*e:t*25*Math.sqrt(-e)}function Kr({pos:e,x1:t,y1:n,x2:s,y2:r,c:i}){switch(e){case Z.Left:return[t-Pn(t-s,i),n];case Z.Right:return[t+Pn(s-t,i),n];case Z.Top:return[t,n-Pn(n-r,i)];case Z.Bottom:return[t,n+Pn(r-n,i)]}}function li({sourceX:e,sourceY:t,sourcePosition:n=Z.Bottom,targetX:s,targetY:r,targetPosition:i=Z.Top,curvature:o=.25}){const[c,a]=Kr({pos:n,x1:e,y1:t,x2:s,y2:r,c:o}),[l,u]=Kr({pos:i,x1:s,y1:r,x2:e,y2:t,c:o}),[f,h,p,N]=ai({sourceX:e,sourceY:t,targetX:s,targetY:r,sourceControlX:c,sourceControlY:a,targetControlX:l,targetControlY:u});return[`M${e},${t} C${c},${a} ${l},${u} ${s},${r}`,f,h,p,N]}const Qn=v.memo(({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r=Z.Bottom,targetPosition:i=Z.Top,label:o,labelStyle:c,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:f,style:h,markerEnd:p,markerStart:N,pathOptions:w,interactionWidth:y})=>{const[x,_,j]=li({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:s,targetPosition:i,curvature:w==null?void 0:w.curvature});return A.createElement(gn,{path:x,labelX:_,labelY:j,label:o,labelStyle:c,labelShowBg:a,labelBgStyle:l,labelBgPadding:u,labelBgBorderRadius:f,style:h,markerEnd:p,markerStart:N,interactionWidth:y})});Qn.displayName="BezierEdge";const Ks=v.createContext(null),Nd=Ks.Provider;Ks.Consumer;const Sd=()=>v.useContext(Ks),_d=e=>"id"in e&&"source"in e&&"target"in e,Ed=({source:e,sourceHandle:t,target:n,targetHandle:s})=>`reactflow__edge-${e}${t||""}-${n}${s||""}`,Rs=(e,t)=>typeof e>"u"?"":typeof e=="string"?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&")}`,jd=(e,t)=>t.some(n=>n.source===e.source&&n.target===e.target&&(n.sourceHandle===e.sourceHandle||!n.sourceHandle&&!e.sourceHandle)&&(n.targetHandle===e.targetHandle||!n.targetHandle&&!e.targetHandle)),Cd=(e,t)=>{if(!e.source||!e.target)return t;let n;return _d(e)?n={...e}:n={...e,id:Ed(e)},jd(n,t)?t:t.concat(n)},zs=({x:e,y:t},[n,s,r],i,[o,c])=>{const a={x:(e-n)/r,y:(t-s)/r};return i?{x:o*Math.round(a.x/o),y:c*Math.round(a.y/c)}:a},ui=({x:e,y:t},[n,s,r])=>({x:e*r+n,y:t*r+s}),It=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],s=(e.height??0)*t[1],r={x:e.position.x-n,y:e.position.y-s};return{...r,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-s}:r}},is=(e,t=[0,0])=>{if(e.length===0)return{x:0,y:0,width:0,height:0};const n=e.reduce((s,r)=>{const{x:i,y:o}=It(r,t).positionAbsolute;return ni(s,un({x:i,y:o,width:r.width||0,height:r.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return si(n)},di=(e,t,[n,s,r]=[0,0,1],i=!1,o=!1,c=[0,0])=>{const a={x:(t.x-n)/r,y:(t.y-s)/r,width:t.width/r,height:t.height/r},l=[];return e.forEach(u=>{const{width:f,height:h,selectable:p=!0,hidden:N=!1}=u;if(o&&!p||N)return!1;const{positionAbsolute:w}=It(u,c),y={x:w.x,y:w.y,width:f||0,height:h||0},x=Ms(a,y),_=typeof f>"u"||typeof h>"u"||f===null||h===null,j=i&&x>0,b=(f||0)*(h||0);(_||j||x>=b||u.dragging)&&l.push(u)}),l},fi=(e,t)=>{const n=e.map(s=>s.id);return t.filter(s=>n.includes(s.source)||n.includes(s.target))},hi=(e,t,n,s,r,i=.1)=>{const o=t/(e.width*(1+i)),c=n/(e.height*(1+i)),a=Math.min(o,c),l=Wt(a,s,r),u=e.x+e.width/2,f=e.y+e.height/2,h=t/2-u*l,p=n/2-f*l;return{x:h,y:p,zoom:l}},Et=(e,t=0)=>e.transition().duration(t);function Qr(e,t,n,s){return(t[n]||[]).reduce((r,i)=>{var o,c;return`${e.id}-${i.id}-${n}`!==s&&r.push({id:i.id||null,type:n,nodeId:e.id,x:(((o=e.positionAbsolute)==null?void 0:o.x)??0)+i.x+i.width/2,y:(((c=e.positionAbsolute)==null?void 0:c.y)??0)+i.y+i.height/2}),r},[])}function Ad(e,t,n,s,r,i){const{x:o,y:c}=bt(e),l=t.elementsFromPoint(o,c).find(N=>N.classList.contains("react-flow__handle"));if(l){const N=l.getAttribute("data-nodeid");if(N){const w=Qs(void 0,l),y=l.getAttribute("data-handleid"),x=i({nodeId:N,id:y,type:w});if(x){const _=r.find(j=>j.nodeId===N&&j.type===w&&j.id===y);return{handle:{id:y,type:w,nodeId:N,x:(_==null?void 0:_.x)||n.x,y:(_==null?void 0:_.y)||n.y},validHandleResult:x}}}}let u=[],f=1/0;if(r.forEach(N=>{const w=Math.sqrt((N.x-n.x)**2+(N.y-n.y)**2);if(w<=s){const y=i(N);w<=f&&(w<f?u=[{handle:N,validHandleResult:y}]:w===f&&u.push({handle:N,validHandleResult:y}),f=w)}}),!u.length)return{handle:null,validHandleResult:mi()};if(u.length===1)return u[0];const h=u.some(({validHandleResult:N})=>N.isValid),p=u.some(({handle:N})=>N.type==="target");return u.find(({handle:N,validHandleResult:w})=>p?N.type==="target":h?w.isValid:!0)||u[0]}const Id={source:null,target:null,sourceHandle:null,targetHandle:null},mi=()=>({handleDomNode:null,isValid:!1,connection:Id,endHandle:null});function gi(e,t,n,s,r,i,o){const c=r==="target",a=o.querySelector(`.react-flow__handle[data-id="${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`),l={...mi(),handleDomNode:a};if(a){const u=Qs(void 0,a),f=a.getAttribute("data-nodeid"),h=a.getAttribute("data-handleid"),p=a.classList.contains("connectable"),N=a.classList.contains("connectableend"),w={source:c?f:n,sourceHandle:c?h:s,target:c?n:f,targetHandle:c?s:h};l.connection=w,p&&N&&(t===Tt.Strict?c&&u==="source"||!c&&u==="target":f!==n||h!==s)&&(l.endHandle={nodeId:f,handleId:h,type:u},l.isValid=i(w))}return l}function Md({nodes:e,nodeId:t,handleId:n,handleType:s}){return e.reduce((r,i)=>{if(i[pe]){const{handleBounds:o}=i[pe];let c=[],a=[];o&&(c=Qr(i,o,"source",`${t}-${n}-${s}`),a=Qr(i,o,"target",`${t}-${n}-${s}`)),r.push(...c,...a)}return r},[])}function Qs(e,t){return e||(t!=null&&t.classList.contains("target")?"target":t!=null&&t.classList.contains("source")?"source":null)}function gs(e){e==null||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function Td(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function pi({event:e,handleId:t,nodeId:n,onConnect:s,isTarget:r,getState:i,setState:o,isValidConnection:c,edgeUpdaterType:a,onReconnectEnd:l}){const u=ti(e.target),{connectionMode:f,domNode:h,autoPanOnConnect:p,connectionRadius:N,onConnectStart:w,panBy:y,getNodes:x,cancelConnection:_}=i();let j=0,b;const{x:I,y:T}=bt(e),P=u==null?void 0:u.elementFromPoint(I,T),D=Qs(a,P),M=h==null?void 0:h.getBoundingClientRect();if(!M||!D)return;let B,F=bt(e,M),O=!1,L=null,g=!1,C=null;const S=Md({nodes:x(),nodeId:n,handleId:t,handleType:D}),R=()=>{if(!p)return;const[$,z]=ei(F,M);y({x:$,y:z}),j=requestAnimationFrame(R)};o({connectionPosition:F,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:D,connectionStartHandle:{nodeId:n,handleId:t,type:D},connectionEndHandle:null}),w==null||w(e,{nodeId:n,handleId:t,handleType:D});function k($){const{transform:z}=i();F=bt($,M);const{handle:H,validHandleResult:Y}=Ad($,u,zs(F,z,!1,[1,1]),N,S,W=>gi(W,f,n,t,r?"target":"source",c,u));if(b=H,O||(R(),O=!0),C=Y.handleDomNode,L=Y.connection,g=Y.isValid,o({connectionPosition:b&&g?ui({x:b.x,y:b.y},z):F,connectionStatus:Td(!!b,g),connectionEndHandle:Y.endHandle}),!b&&!g&&!C)return gs(B);L.source!==L.target&&C&&(gs(B),B=C,C.classList.add("connecting","react-flow__handle-connecting"),C.classList.toggle("valid",g),C.classList.toggle("react-flow__handle-valid",g))}function E($){var z,H;(b||C)&&L&&g&&(s==null||s(L)),(H=(z=i()).onConnectEnd)==null||H.call(z,$),a&&(l==null||l($)),gs(B),_(),cancelAnimationFrame(j),O=!1,g=!1,L=null,C=null,u.removeEventListener("mousemove",k),u.removeEventListener("mouseup",E),u.removeEventListener("touchmove",k),u.removeEventListener("touchend",E)}u.addEventListener("mousemove",k),u.addEventListener("mouseup",E),u.addEventListener("touchmove",k),u.addEventListener("touchend",E)}const Jr=()=>!0,$d=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),Rd=(e,t,n)=>s=>{const{connectionStartHandle:r,connectionEndHandle:i,connectionClickStartHandle:o}=s;return{connecting:(r==null?void 0:r.nodeId)===e&&(r==null?void 0:r.handleId)===t&&(r==null?void 0:r.type)===n||(i==null?void 0:i.nodeId)===e&&(i==null?void 0:i.handleId)===t&&(i==null?void 0:i.type)===n,clickConnecting:(o==null?void 0:o.nodeId)===e&&(o==null?void 0:o.handleId)===t&&(o==null?void 0:o.type)===n}},xi=v.forwardRef(({type:e="source",position:t=Z.Top,isValidConnection:n,isConnectable:s=!0,isConnectableStart:r=!0,isConnectableEnd:i=!0,id:o,onConnect:c,children:a,className:l,onMouseDown:u,onTouchStart:f,...h},p)=>{var M,B;const N=o||null,w=e==="target",y=Ne(),x=Sd(),{connectOnClick:_,noPanClassName:j}=he($d,Ee),{connecting:b,clickConnecting:I}=he(Rd(x,N,e),Ee);x||(B=(M=y.getState()).onError)==null||B.call(M,"010",ht.error010());const T=F=>{const{defaultEdgeOptions:O,onConnect:L,hasDefaultEdges:g}=y.getState(),C={...O,...F};if(g){const{edges:S,setEdges:R}=y.getState();R(Cd(C,S))}L==null||L(C),c==null||c(C)},P=F=>{if(!x)return;const O=oi(F);r&&(O&&F.button===0||!O)&&pi({event:F,handleId:N,nodeId:x,onConnect:T,isTarget:w,getState:y.getState,setState:y.setState,isValidConnection:n||y.getState().isValidConnection||Jr}),O?u==null||u(F):f==null||f(F)},D=F=>{const{onClickConnectStart:O,onClickConnectEnd:L,connectionClickStartHandle:g,connectionMode:C,isValidConnection:S}=y.getState();if(!x||!g&&!r)return;if(!g){O==null||O(F,{nodeId:x,handleId:N,handleType:e}),y.setState({connectionClickStartHandle:{nodeId:x,type:e,handleId:N}});return}const R=ti(F.target),k=n||S||Jr,{connection:E,isValid:$}=gi({nodeId:x,id:N,type:e},C,g.nodeId,g.handleId||null,g.type,k,R);$&&T(E),L==null||L(F),y.setState({connectionClickStartHandle:null})};return A.createElement("div",{"data-handleid":N,"data-nodeid":x,"data-handlepos":t,"data-id":`${x}-${N}-${e}`,className:je(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",j,l,{source:!w,target:w,connectable:s,connectablestart:r,connectableend:i,connecting:I,connectionindicator:s&&(r&&!b||i&&b)}]),onMouseDown:P,onTouchStart:P,onClick:_?D:void 0,ref:p,...h},a)});xi.displayName="Handle";var Jn=v.memo(xi);const yi=({data:e,isConnectable:t,targetPosition:n=Z.Top,sourcePosition:s=Z.Bottom})=>A.createElement(A.Fragment,null,A.createElement(Jn,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label,A.createElement(Jn,{type:"source",position:s,isConnectable:t}));yi.displayName="DefaultNode";var Ps=v.memo(yi);const wi=({data:e,isConnectable:t,sourcePosition:n=Z.Bottom})=>A.createElement(A.Fragment,null,e==null?void 0:e.label,A.createElement(Jn,{type:"source",position:n,isConnectable:t}));wi.displayName="InputNode";var bi=v.memo(wi);const vi=({data:e,isConnectable:t,targetPosition:n=Z.Top})=>A.createElement(A.Fragment,null,A.createElement(Jn,{type:"target",position:n,isConnectable:t}),e==null?void 0:e.label);vi.displayName="OutputNode";var Ni=v.memo(vi);const Js=()=>null;Js.displayName="GroupNode";const zd=e=>({selectedNodes:e.getNodes().filter(t=>t.selected),selectedEdges:e.edges.filter(t=>t.selected).map(t=>({...t}))}),Dn=e=>e.id;function Pd(e,t){return Ee(e.selectedNodes.map(Dn),t.selectedNodes.map(Dn))&&Ee(e.selectedEdges.map(Dn),t.selectedEdges.map(Dn))}const Si=v.memo(({onSelectionChange:e})=>{const t=Ne(),{selectedNodes:n,selectedEdges:s}=he(zd,Pd);return v.useEffect(()=>{const r={nodes:n,edges:s};e==null||e(r),t.getState().onSelectionChange.forEach(i=>i(r))},[n,s,e]),null});Si.displayName="SelectionListener";const Dd=e=>!!e.onSelectionChange;function kd({onSelectionChange:e}){const t=he(Dd);return e||t?A.createElement(Si,{onSelectionChange:e}):null}const Hd=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function Pt(e,t){v.useEffect(()=>{typeof e<"u"&&t(e)},[e])}function ne(e,t,n){v.useEffect(()=>{typeof t<"u"&&n({[e]:t})},[t])}const Ld=({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:r,onConnectStart:i,onConnectEnd:o,onClickConnectStart:c,onClickConnectEnd:a,nodesDraggable:l,nodesConnectable:u,nodesFocusable:f,edgesFocusable:h,edgesUpdatable:p,elevateNodesOnSelect:N,minZoom:w,maxZoom:y,nodeExtent:x,onNodesChange:_,onEdgesChange:j,elementsSelectable:b,connectionMode:I,snapGrid:T,snapToGrid:P,translateExtent:D,connectOnClick:M,defaultEdgeOptions:B,fitView:F,fitViewOptions:O,onNodesDelete:L,onEdgesDelete:g,onNodeDrag:C,onNodeDragStart:S,onNodeDragStop:R,onSelectionDrag:k,onSelectionDragStart:E,onSelectionDragStop:$,noPanClassName:z,nodeOrigin:H,rfId:Y,autoPanOnConnect:W,autoPanOnNodeDrag:U,onError:Q,connectionRadius:J,isValidConnection:oe,nodeDragThreshold:ie})=>{const{setNodes:ee,setEdges:xe,setDefaultNodesAndEdges:fe,setMinZoom:be,setMaxZoom:ye,setTranslateExtent:de,setNodeExtent:Ce,reset:ce}=he(Hd,Ee),G=Ne();return v.useEffect(()=>{const Se=s==null?void 0:s.map(Be=>({...Be,...B}));return fe(n,Se),()=>{ce()}},[]),ne("defaultEdgeOptions",B,G.setState),ne("connectionMode",I,G.setState),ne("onConnect",r,G.setState),ne("onConnectStart",i,G.setState),ne("onConnectEnd",o,G.setState),ne("onClickConnectStart",c,G.setState),ne("onClickConnectEnd",a,G.setState),ne("nodesDraggable",l,G.setState),ne("nodesConnectable",u,G.setState),ne("nodesFocusable",f,G.setState),ne("edgesFocusable",h,G.setState),ne("edgesUpdatable",p,G.setState),ne("elementsSelectable",b,G.setState),ne("elevateNodesOnSelect",N,G.setState),ne("snapToGrid",P,G.setState),ne("snapGrid",T,G.setState),ne("onNodesChange",_,G.setState),ne("onEdgesChange",j,G.setState),ne("connectOnClick",M,G.setState),ne("fitViewOnInit",F,G.setState),ne("fitViewOnInitOptions",O,G.setState),ne("onNodesDelete",L,G.setState),ne("onEdgesDelete",g,G.setState),ne("onNodeDrag",C,G.setState),ne("onNodeDragStart",S,G.setState),ne("onNodeDragStop",R,G.setState),ne("onSelectionDrag",k,G.setState),ne("onSelectionDragStart",E,G.setState),ne("onSelectionDragStop",$,G.setState),ne("noPanClassName",z,G.setState),ne("nodeOrigin",H,G.setState),ne("rfId",Y,G.setState),ne("autoPanOnConnect",W,G.setState),ne("autoPanOnNodeDrag",U,G.setState),ne("onError",Q,G.setState),ne("connectionRadius",J,G.setState),ne("isValidConnection",oe,G.setState),ne("nodeDragThreshold",ie,G.setState),Pt(e,ee),Pt(t,xe),Pt(w,be),Pt(y,ye),Pt(D,de),Pt(x,Ce),null},eo={display:"none"},Bd={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},_i="react-flow__node-desc",Ei="react-flow__edge-desc",Fd="react-flow__aria-live",Vd=e=>e.ariaLiveMessage;function Od({rfId:e}){const t=he(Vd);return A.createElement("div",{id:`${Fd}-${e}`,"aria-live":"assertive","aria-atomic":"true",style:Bd},t)}function Xd({rfId:e,disableKeyboardA11y:t}){return A.createElement(A.Fragment,null,A.createElement("div",{id:`${_i}-${e}`,style:eo},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),A.createElement("div",{id:`${Ei}-${e}`,style:eo},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&A.createElement(Od,{rfId:e}))}var fn=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,s]=v.useState(!1),r=v.useRef(!1),i=v.useRef(new Set([])),[o,c]=v.useMemo(()=>{if(e!==null){const l=(Array.isArray(e)?e:[e]).filter(f=>typeof f=="string").map(f=>f.split("+")),u=l.reduce((f,h)=>f.concat(...h),[]);return[l,u]}return[[],[]]},[e]);return v.useEffect(()=>{const a=typeof document<"u"?document:null,l=(t==null?void 0:t.target)||a;if(e!==null){const u=p=>{if(r.current=p.ctrlKey||p.metaKey||p.shiftKey,(!r.current||r.current&&!t.actInsideInputWithModifier)&&Ts(p))return!1;const w=no(p.code,c);i.current.add(p[w]),to(o,i.current,!1)&&(p.preventDefault(),s(!0))},f=p=>{if((!r.current||r.current&&!t.actInsideInputWithModifier)&&Ts(p))return!1;const w=no(p.code,c);to(o,i.current,!0)?(s(!1),i.current.clear()):i.current.delete(p[w]),p.key==="Meta"&&i.current.clear(),r.current=!1},h=()=>{i.current.clear(),s(!1)};return l==null||l.addEventListener("keydown",u),l==null||l.addEventListener("keyup",f),window.addEventListener("blur",h),()=>{l==null||l.removeEventListener("keydown",u),l==null||l.removeEventListener("keyup",f),window.removeEventListener("blur",h)}}},[e,s]),n};function to(e,t,n){return e.filter(s=>n||s.length===t.size).some(s=>s.every(r=>t.has(r)))}function no(e,t){return t.includes(e)?"code":"key"}function ji(e,t,n,s){var c,a;const r=e.parentNode||e.parentId;if(!r)return n;const i=t.get(r),o=It(i,s);return ji(i,t,{x:(n.x??0)+o.x,y:(n.y??0)+o.y,z:(((c=i[pe])==null?void 0:c.z)??0)>(n.z??0)?((a=i[pe])==null?void 0:a.z)??0:n.z??0},s)}function Ci(e,t,n){e.forEach(s=>{var i;const r=s.parentNode||s.parentId;if(r&&!e.has(r))throw new Error(`Parent node ${r} not found`);if(r||n!=null&&n[s.id]){const{x:o,y:c,z:a}=ji(s,e,{...s.position,z:((i=s[pe])==null?void 0:i.z)??0},t);s.positionAbsolute={x:o,y:c},s[pe].z=a,n!=null&&n[s.id]&&(s[pe].isParent=!0)}})}function ps(e,t,n,s){const r=new Map,i={},o=s?1e3:0;return e.forEach(c=>{var p;const a=(Le(c.zIndex)?c.zIndex:0)+(c.selected?o:0),l=t.get(c.id),u={...c,positionAbsolute:{x:c.position.x,y:c.position.y}},f=c.parentNode||c.parentId;f&&(i[f]=!0);const h=(l==null?void 0:l.type)&&(l==null?void 0:l.type)!==c.type;Object.defineProperty(u,pe,{enumerable:!1,value:{handleBounds:h||(p=l==null?void 0:l[pe])==null?void 0:p.handleBounds,z:a}}),r.set(c.id,u)}),Ci(r,n,i),r}function Ai(e,t={}){const{getNodes:n,width:s,height:r,minZoom:i,maxZoom:o,d3Zoom:c,d3Selection:a,fitViewOnInitDone:l,fitViewOnInit:u,nodeOrigin:f}=e(),h=t.initial&&!l&&u;if(c&&a&&(h||!t.initial)){const N=n().filter(y=>{var _;const x=t.includeHiddenNodes?y.width&&y.height:!y.hidden;return(_=t.nodes)!=null&&_.length?x&&t.nodes.some(j=>j.id===y.id):x}),w=N.every(y=>y.width&&y.height);if(N.length>0&&w){const y=is(N,f),{x,y:_,zoom:j}=hi(y,s,r,t.minZoom??i,t.maxZoom??o,t.padding??.1),b=dt.translate(x,_).scale(j);return typeof t.duration=="number"&&t.duration>0?c.transform(Et(a,t.duration),b):c.transform(a,b),!0}}return!1}function Wd(e,t){return e.forEach(n=>{const s=t.get(n.id);s&&t.set(s.id,{...s,[pe]:s[pe],selected:n.selected})}),new Map(t)}function Yd(e,t){return t.map(n=>{const s=e.find(r=>r.id===n.id);return s&&(n.selected=s.selected),n})}function kn({changedNodes:e,changedEdges:t,get:n,set:s}){const{nodeInternals:r,edges:i,onNodesChange:o,onEdgesChange:c,hasDefaultNodes:a,hasDefaultEdges:l}=n();e!=null&&e.length&&(a&&s({nodeInternals:Wd(e,r)}),o==null||o(e)),t!=null&&t.length&&(l&&s({edges:Yd(t,i)}),c==null||c(t))}const Dt=()=>{},Ud={zoomIn:Dt,zoomOut:Dt,zoomTo:Dt,getZoom:()=>1,setViewport:Dt,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:Dt,fitBounds:Dt,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},Gd=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection}),qd=()=>{const e=Ne(),{d3Zoom:t,d3Selection:n}=he(Gd,Ee);return v.useMemo(()=>n&&t?{zoomIn:r=>t.scaleBy(Et(n,r==null?void 0:r.duration),1.2),zoomOut:r=>t.scaleBy(Et(n,r==null?void 0:r.duration),1/1.2),zoomTo:(r,i)=>t.scaleTo(Et(n,i==null?void 0:i.duration),r),getZoom:()=>e.getState().transform[2],setViewport:(r,i)=>{const[o,c,a]=e.getState().transform,l=dt.translate(r.x??o,r.y??c).scale(r.zoom??a);t.transform(Et(n,i==null?void 0:i.duration),l)},getViewport:()=>{const[r,i,o]=e.getState().transform;return{x:r,y:i,zoom:o}},fitView:r=>Ai(e.getState,r),setCenter:(r,i,o)=>{const{width:c,height:a,maxZoom:l}=e.getState(),u=typeof(o==null?void 0:o.zoom)<"u"?o.zoom:l,f=c/2-r*u,h=a/2-i*u,p=dt.translate(f,h).scale(u);t.transform(Et(n,o==null?void 0:o.duration),p)},fitBounds:(r,i)=>{const{width:o,height:c,minZoom:a,maxZoom:l}=e.getState(),{x:u,y:f,zoom:h}=hi(r,o,c,a,l,(i==null?void 0:i.padding)??.1),p=dt.translate(u,f).scale(h);t.transform(Et(n,i==null?void 0:i.duration),p)},project:r=>{const{transform:i,snapToGrid:o,snapGrid:c}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),zs(r,i,o,c)},screenToFlowPosition:r=>{const{transform:i,snapToGrid:o,snapGrid:c,domNode:a}=e.getState();if(!a)return r;const{x:l,y:u}=a.getBoundingClientRect(),f={x:r.x-l,y:r.y-u};return zs(f,i,o,c)},flowToScreenPosition:r=>{const{transform:i,domNode:o}=e.getState();if(!o)return r;const{x:c,y:a}=o.getBoundingClientRect(),l=ui(r,i);return{x:l.x+c,y:l.y+a}},viewportInitialized:!0}:Ud,[t,n])};function er(){const e=qd(),t=Ne(),n=v.useCallback(()=>t.getState().getNodes().map(w=>({...w})),[]),s=v.useCallback(w=>t.getState().nodeInternals.get(w),[]),r=v.useCallback(()=>{const{edges:w=[]}=t.getState();return w.map(y=>({...y}))},[]),i=v.useCallback(w=>{const{edges:y=[]}=t.getState();return y.find(x=>x.id===w)},[]),o=v.useCallback(w=>{const{getNodes:y,setNodes:x,hasDefaultNodes:_,onNodesChange:j}=t.getState(),b=y(),I=typeof w=="function"?w(b):w;if(_)x(I);else if(j){const T=I.length===0?b.map(P=>({type:"remove",id:P.id})):I.map(P=>({item:P,type:"reset"}));j(T)}},[]),c=v.useCallback(w=>{const{edges:y=[],setEdges:x,hasDefaultEdges:_,onEdgesChange:j}=t.getState(),b=typeof w=="function"?w(y):w;if(_)x(b);else if(j){const I=b.length===0?y.map(T=>({type:"remove",id:T.id})):b.map(T=>({item:T,type:"reset"}));j(I)}},[]),a=v.useCallback(w=>{const y=Array.isArray(w)?w:[w],{getNodes:x,setNodes:_,hasDefaultNodes:j,onNodesChange:b}=t.getState();if(j){const T=[...x(),...y];_(T)}else if(b){const I=y.map(T=>({item:T,type:"add"}));b(I)}},[]),l=v.useCallback(w=>{const y=Array.isArray(w)?w:[w],{edges:x=[],setEdges:_,hasDefaultEdges:j,onEdgesChange:b}=t.getState();if(j)_([...x,...y]);else if(b){const I=y.map(T=>({item:T,type:"add"}));b(I)}},[]),u=v.useCallback(()=>{const{getNodes:w,edges:y=[],transform:x}=t.getState(),[_,j,b]=x;return{nodes:w().map(I=>({...I})),edges:y.map(I=>({...I})),viewport:{x:_,y:j,zoom:b}}},[]),f=v.useCallback(({nodes:w,edges:y})=>{const{nodeInternals:x,getNodes:_,edges:j,hasDefaultNodes:b,hasDefaultEdges:I,onNodesDelete:T,onEdgesDelete:P,onNodesChange:D,onEdgesChange:M}=t.getState(),B=(w||[]).map(C=>C.id),F=(y||[]).map(C=>C.id),O=_().reduce((C,S)=>{const R=S.parentNode||S.parentId,k=!B.includes(S.id)&&R&&C.find($=>$.id===R);return(typeof S.deletable=="boolean"?S.deletable:!0)&&(B.includes(S.id)||k)&&C.push(S),C},[]),L=j.filter(C=>typeof C.deletable=="boolean"?C.deletable:!0),g=L.filter(C=>F.includes(C.id));if(O||g){const C=fi(O,L),S=[...g,...C],R=S.reduce((k,E)=>(k.includes(E.id)||k.push(E.id),k),[]);if((I||b)&&(I&&t.setState({edges:j.filter(k=>!R.includes(k.id))}),b&&(O.forEach(k=>{x.delete(k.id)}),t.setState({nodeInternals:new Map(x)}))),R.length>0&&(P==null||P(S),M&&M(R.map(k=>({id:k,type:"remove"})))),O.length>0&&(T==null||T(O),D)){const k=O.map(E=>({id:E.id,type:"remove"}));D(k)}}},[]),h=v.useCallback(w=>{const y=gd(w),x=y?null:t.getState().nodeInternals.get(w.id);return!y&&!x?[null,null,y]:[y?w:Ur(x),x,y]},[]),p=v.useCallback((w,y=!0,x)=>{const[_,j,b]=h(w);return _?(x||t.getState().getNodes()).filter(I=>{if(!b&&(I.id===j.id||!I.positionAbsolute))return!1;const T=Ur(I),P=Ms(T,_);return y&&P>0||P>=_.width*_.height}):[]},[]),N=v.useCallback((w,y,x=!0)=>{const[_]=h(w);if(!_)return!1;const j=Ms(_,y);return x&&j>0||j>=_.width*_.height},[]);return v.useMemo(()=>({...e,getNodes:n,getNode:s,getEdges:r,getEdge:i,setNodes:o,setEdges:c,addNodes:a,addEdges:l,toObject:u,deleteElements:f,getIntersectingNodes:p,isNodeIntersecting:N}),[e,n,s,r,i,o,c,a,l,u,f,p,N])}const Zd={actInsideInputWithModifier:!1};var Kd=({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=Ne(),{deleteElements:s}=er(),r=fn(e,Zd),i=fn(t);v.useEffect(()=>{if(r){const{edges:o,getNodes:c}=n.getState(),a=c().filter(u=>u.selected),l=o.filter(u=>u.selected);s({nodes:a,edges:l}),n.setState({nodesSelectionActive:!1})}},[r]),v.useEffect(()=>{n.setState({multiSelectionActive:i})},[i])};function Qd(e){const t=Ne();v.useEffect(()=>{let n;const s=()=>{var i,o;if(!e.current)return;const r=Ys(e.current);(r.height===0||r.width===0)&&((o=(i=t.getState()).onError)==null||o.call(i,"004",ht.error004())),t.setState({width:r.width||500,height:r.height||500})};return s(),window.addEventListener("resize",s),e.current&&(n=new ResizeObserver(()=>s()),n.observe(e.current)),()=>{window.removeEventListener("resize",s),n&&e.current&&n.unobserve(e.current)}},[])}const tr={position:"absolute",width:"100%",height:"100%",top:0,left:0},Jd=(e,t)=>e.x!==t.x||e.y!==t.y||e.zoom!==t.k,Hn=e=>({x:e.x,y:e.y,zoom:e.k}),kt=(e,t)=>e.target.closest(`.${t}`),so=(e,t)=>t===2&&Array.isArray(e)&&e.includes(2),ro=e=>{const t=e.ctrlKey&&Zn()?10:1;return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*t},ef=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),tf=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:s,zoomOnScroll:r=!0,zoomOnPinch:i=!0,panOnScroll:o=!1,panOnScrollSpeed:c=.5,panOnScrollMode:a=Ct.Free,zoomOnDoubleClick:l=!0,elementsSelectable:u,panOnDrag:f=!0,defaultViewport:h,translateExtent:p,minZoom:N,maxZoom:w,zoomActivationKeyCode:y,preventScrolling:x=!0,children:_,noWheelClassName:j,noPanClassName:b})=>{const I=v.useRef(),T=Ne(),P=v.useRef(!1),D=v.useRef(!1),M=v.useRef(null),B=v.useRef({x:0,y:0,zoom:0}),{d3Zoom:F,d3Selection:O,d3ZoomHandler:L,userSelectionActive:g}=he(ef,Ee),C=fn(y),S=v.useRef(0),R=v.useRef(!1),k=v.useRef();return Qd(M),v.useEffect(()=>{if(M.current){const E=M.current.getBoundingClientRect(),$=Qo().scaleExtent([N,w]).translateExtent(p),z=He(M.current).call($),H=dt.translate(h.x,h.y).scale(Wt(h.zoom,N,w)),Y=[[0,0],[E.width,E.height]],W=$.constrain()(H,Y,p);$.transform(z,W),$.wheelDelta(ro),T.setState({d3Zoom:$,d3Selection:z,d3ZoomHandler:z.on("wheel.zoom"),transform:[W.x,W.y,W.k],domNode:M.current.closest(".react-flow")})}},[]),v.useEffect(()=>{O&&F&&(o&&!C&&!g?O.on("wheel.zoom",E=>{if(kt(E,j))return!1;E.preventDefault(),E.stopImmediatePropagation();const $=O.property("__zoom").k||1;if(E.ctrlKey&&i){const oe=Ue(E),ie=ro(E),ee=$*Math.pow(2,ie);F.scaleTo(O,ee,oe,E);return}const z=E.deltaMode===1?20:1;let H=a===Ct.Vertical?0:E.deltaX*z,Y=a===Ct.Horizontal?0:E.deltaY*z;!Zn()&&E.shiftKey&&a!==Ct.Vertical&&(H=E.deltaY*z,Y=0),F.translateBy(O,-(H/$)*c,-(Y/$)*c,{internal:!0});const W=Hn(O.property("__zoom")),{onViewportChangeStart:U,onViewportChange:Q,onViewportChangeEnd:J}=T.getState();clearTimeout(k.current),R.current||(R.current=!0,t==null||t(E,W),U==null||U(W)),R.current&&(e==null||e(E,W),Q==null||Q(W),k.current=setTimeout(()=>{n==null||n(E,W),J==null||J(W),R.current=!1},150))},{passive:!1}):typeof L<"u"&&O.on("wheel.zoom",function(E,$){if(!x&&E.type==="wheel"&&!E.ctrlKey||kt(E,j))return null;E.preventDefault(),L.call(this,E,$)},{passive:!1}))},[g,o,a,O,F,L,C,i,x,j,t,e,n]),v.useEffect(()=>{F&&F.on("start",E=>{var H,Y;if(!E.sourceEvent||E.sourceEvent.internal)return null;S.current=(H=E.sourceEvent)==null?void 0:H.button;const{onViewportChangeStart:$}=T.getState(),z=Hn(E.transform);P.current=!0,B.current=z,((Y=E.sourceEvent)==null?void 0:Y.type)==="mousedown"&&T.setState({paneDragging:!0}),$==null||$(z),t==null||t(E.sourceEvent,z)})},[F,t]),v.useEffect(()=>{F&&(g&&!P.current?F.on("zoom",null):g||F.on("zoom",E=>{var z;const{onViewportChange:$}=T.getState();if(T.setState({transform:[E.transform.x,E.transform.y,E.transform.k]}),D.current=!!(s&&so(f,S.current??0)),(e||$)&&!((z=E.sourceEvent)!=null&&z.internal)){const H=Hn(E.transform);$==null||$(H),e==null||e(E.sourceEvent,H)}}))},[g,F,e,f,s]),v.useEffect(()=>{F&&F.on("end",E=>{if(!E.sourceEvent||E.sourceEvent.internal)return null;const{onViewportChangeEnd:$}=T.getState();if(P.current=!1,T.setState({paneDragging:!1}),s&&so(f,S.current??0)&&!D.current&&s(E.sourceEvent),D.current=!1,(n||$)&&Jd(B.current,E.transform)){const z=Hn(E.transform);B.current=z,clearTimeout(I.current),I.current=setTimeout(()=>{$==null||$(z),n==null||n(E.sourceEvent,z)},o?150:0)}})},[F,o,f,n,s]),v.useEffect(()=>{F&&F.filter(E=>{const $=C||r,z=i&&E.ctrlKey;if((f===!0||Array.isArray(f)&&f.includes(1))&&E.button===1&&E.type==="mousedown"&&(kt(E,"react-flow__node")||kt(E,"react-flow__edge")))return!0;if(!f&&!$&&!o&&!l&&!i||g||!l&&E.type==="dblclick"||kt(E,j)&&E.type==="wheel"||kt(E,b)&&(E.type!=="wheel"||o&&E.type==="wheel"&&!C)||!i&&E.ctrlKey&&E.type==="wheel"||!$&&!o&&!z&&E.type==="wheel"||!f&&(E.type==="mousedown"||E.type==="touchstart")||Array.isArray(f)&&!f.includes(E.button)&&E.type==="mousedown")return!1;const H=Array.isArray(f)&&f.includes(E.button)||!E.button||E.button<=1;return(!E.ctrlKey||E.type==="wheel")&&H})},[g,F,r,i,o,l,f,u,C]),A.createElement("div",{className:"react-flow__renderer",ref:M,style:tr},_)},nf=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function sf(){const{userSelectionActive:e,userSelectionRect:t}=he(nf,Ee);return e&&t?A.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function oo(e,t){const n=t.parentNode||t.parentId,s=e.find(r=>r.id===n);if(s){const r=t.position.x+t.width-s.width,i=t.position.y+t.height-s.height;if(r>0||i>0||t.position.x<0||t.position.y<0){if(s.style={...s.style},s.style.width=s.style.width??s.width,s.style.height=s.style.height??s.height,r>0&&(s.style.width+=r),i>0&&(s.style.height+=i),t.position.x<0){const o=Math.abs(t.position.x);s.position.x=s.position.x-o,s.style.width+=o,t.position.x=0}if(t.position.y<0){const o=Math.abs(t.position.y);s.position.y=s.position.y-o,s.style.height+=o,t.position.y=0}s.width=s.style.width,s.height=s.style.height}}}function Ii(e,t){if(e.some(s=>s.type==="reset"))return e.filter(s=>s.type==="reset").map(s=>s.item);const n=e.filter(s=>s.type==="add").map(s=>s.item);return t.reduce((s,r)=>{const i=e.filter(c=>c.id===r.id);if(i.length===0)return s.push(r),s;const o={...r};for(const c of i)if(c)switch(c.type){case"select":{o.selected=c.selected;break}case"position":{typeof c.position<"u"&&(o.position=c.position),typeof c.positionAbsolute<"u"&&(o.positionAbsolute=c.positionAbsolute),typeof c.dragging<"u"&&(o.dragging=c.dragging),o.expandParent&&oo(s,o);break}case"dimensions":{typeof c.dimensions<"u"&&(o.width=c.dimensions.width,o.height=c.dimensions.height),typeof c.updateStyle<"u"&&(o.style={...o.style||{},...c.dimensions}),typeof c.resizing=="boolean"&&(o.resizing=c.resizing),o.expandParent&&oo(s,o);break}case"remove":return s}return s.push(o),s},n)}function Mi(e,t){return Ii(e,t)}function rf(e,t){return Ii(e,t)}const yt=(e,t)=>({id:e,type:"select",selected:t});function Lt(e,t){return e.reduce((n,s)=>{const r=t.includes(s.id);return!s.selected&&r?(s.selected=!0,n.push(yt(s.id,!0))):s.selected&&!r&&(s.selected=!1,n.push(yt(s.id,!1))),n},[])}const xs=(e,t)=>n=>{n.target===t.current&&(e==null||e(n))},of=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),Ti=v.memo(({isSelecting:e,selectionMode:t=dn.Full,panOnDrag:n,onSelectionStart:s,onSelectionEnd:r,onPaneClick:i,onPaneContextMenu:o,onPaneScroll:c,onPaneMouseEnter:a,onPaneMouseMove:l,onPaneMouseLeave:u,children:f})=>{const h=v.useRef(null),p=Ne(),N=v.useRef(0),w=v.useRef(0),y=v.useRef(),{userSelectionActive:x,elementsSelectable:_,dragging:j}=he(of,Ee),b=()=>{p.setState({userSelectionActive:!1,userSelectionRect:null}),N.current=0,w.current=0},I=L=>{i==null||i(L),p.getState().resetSelectedElements(),p.setState({nodesSelectionActive:!1})},T=L=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){L.preventDefault();return}o==null||o(L)},P=c?L=>c(L):void 0,D=L=>{const{resetSelectedElements:g,domNode:C}=p.getState();if(y.current=C==null?void 0:C.getBoundingClientRect(),!_||!e||L.button!==0||L.target!==h.current||!y.current)return;const{x:S,y:R}=bt(L,y.current);g(),p.setState({userSelectionRect:{width:0,height:0,startX:S,startY:R,x:S,y:R}}),s==null||s(L)},M=L=>{const{userSelectionRect:g,nodeInternals:C,edges:S,transform:R,onNodesChange:k,onEdgesChange:E,nodeOrigin:$,getNodes:z}=p.getState();if(!e||!y.current||!g)return;p.setState({userSelectionActive:!0,nodesSelectionActive:!1});const H=bt(L,y.current),Y=g.startX??0,W=g.startY??0,U={...g,x:H.x<Y?H.x:Y,y:H.y<W?H.y:W,width:Math.abs(H.x-Y),height:Math.abs(H.y-W)},Q=z(),J=di(C,U,R,t===dn.Partial,!0,$),oe=fi(J,S).map(ee=>ee.id),ie=J.map(ee=>ee.id);if(N.current!==ie.length){N.current=ie.length;const ee=Lt(Q,ie);ee.length&&(k==null||k(ee))}if(w.current!==oe.length){w.current=oe.length;const ee=Lt(S,oe);ee.length&&(E==null||E(ee))}p.setState({userSelectionRect:U})},B=L=>{if(L.button!==0)return;const{userSelectionRect:g}=p.getState();!x&&g&&L.target===h.current&&(I==null||I(L)),p.setState({nodesSelectionActive:N.current>0}),b(),r==null||r(L)},F=L=>{x&&(p.setState({nodesSelectionActive:N.current>0}),r==null||r(L)),b()},O=_&&(e||x);return A.createElement("div",{className:je(["react-flow__pane",{dragging:j,selection:e}]),onClick:O?void 0:xs(I,h),onContextMenu:xs(T,h),onWheel:xs(P,h),onMouseEnter:O?void 0:a,onMouseDown:O?D:void 0,onMouseMove:O?M:l,onMouseUp:O?B:void 0,onMouseLeave:O?F:u,ref:h,style:tr},f,A.createElement(sf,null))});Ti.displayName="Pane";function $i(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const s=t.get(n);return s?s.selected?!0:$i(s,t):!1}function io(e,t,n){let s=e;do{if(s!=null&&s.matches(t))return!0;if(s===n.current)return!1;s=s.parentElement}while(s);return!1}function af(e,t,n,s){return Array.from(e.values()).filter(r=>(r.selected||r.id===s)&&(!r.parentNode||r.parentId||!$i(r,e))&&(r.draggable||t&&typeof r.draggable>"u")).map(r=>{var i,o;return{id:r.id,position:r.position||{x:0,y:0},positionAbsolute:r.positionAbsolute||{x:0,y:0},distance:{x:n.x-(((i=r.positionAbsolute)==null?void 0:i.x)??0),y:n.y-(((o=r.positionAbsolute)==null?void 0:o.y)??0)},delta:{x:0,y:0},extent:r.extent,parentNode:r.parentNode||r.parentId,parentId:r.parentNode||r.parentId,width:r.width,height:r.height,expandParent:r.expandParent}})}function cf(e,t){return!t||t==="parent"?t:[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]}function Ri(e,t,n,s,r=[0,0],i){const o=cf(e,e.extent||s);let c=o;const a=e.parentNode||e.parentId;if(e.extent==="parent"&&!e.expandParent)if(a&&e.width&&e.height){const f=n.get(a),{x:h,y:p}=It(f,r).positionAbsolute;c=f&&Le(h)&&Le(p)&&Le(f.width)&&Le(f.height)?[[h+e.width*r[0],p+e.height*r[1]],[h+f.width-e.width+e.width*r[0],p+f.height-e.height+e.height*r[1]]]:c}else i==null||i("005",ht.error005()),c=o;else if(e.extent&&a&&e.extent!=="parent"){const f=n.get(a),{x:h,y:p}=It(f,r).positionAbsolute;c=[[e.extent[0][0]+h,e.extent[0][1]+p],[e.extent[1][0]+h,e.extent[1][1]+p]]}let l={x:0,y:0};if(a){const f=n.get(a);l=It(f,r).positionAbsolute}const u=c&&c!=="parent"?Us(t,c):t;return{position:{x:u.x-l.x,y:u.y-l.y},positionAbsolute:u}}function ys({nodeId:e,dragItems:t,nodeInternals:n}){const s=t.map(r=>({...n.get(r.id),position:r.position,positionAbsolute:r.positionAbsolute}));return[e?s.find(r=>r.id===e):s[0],s]}const ao=(e,t,n,s)=>{const r=t.querySelectorAll(e);if(!r||!r.length)return null;const i=Array.from(r),o=t.getBoundingClientRect(),c={x:o.width*s[0],y:o.height*s[1]};return i.map(a=>{const l=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),position:a.getAttribute("data-handlepos"),x:(l.left-o.left-c.x)/n,y:(l.top-o.top-c.y)/n,...Ys(a)}})};function Kt(e,t,n){return n===void 0?n:s=>{const r=t().nodeInternals.get(e);r&&n(s,{...r})}}function Ds({id:e,store:t,unselect:n=!1,nodeRef:s}){const{addSelectedNodes:r,unselectNodesAndEdges:i,multiSelectionActive:o,nodeInternals:c,onError:a}=t.getState(),l=c.get(e);if(!l){a==null||a("012",ht.error012(e));return}t.setState({nodesSelectionActive:!1}),l.selected?(n||l.selected&&o)&&(i({nodes:[l],edges:[]}),requestAnimationFrame(()=>{var u;return(u=s==null?void 0:s.current)==null?void 0:u.blur()})):r([e])}function lf(){const e=Ne();return v.useCallback(({sourceEvent:n})=>{const{transform:s,snapGrid:r,snapToGrid:i}=e.getState(),o=n.touches?n.touches[0].clientX:n.clientX,c=n.touches?n.touches[0].clientY:n.clientY,a={x:(o-s[0])/s[2],y:(c-s[1])/s[2]};return{xSnapped:i?r[0]*Math.round(a.x/r[0]):a.x,ySnapped:i?r[1]*Math.round(a.y/r[1]):a.y,...a}},[])}function ws(e){return(t,n,s)=>e==null?void 0:e(t,s)}function zi({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:s,nodeId:r,isSelectable:i,selectNodesOnDrag:o}){const c=Ne(),[a,l]=v.useState(!1),u=v.useRef([]),f=v.useRef({x:null,y:null}),h=v.useRef(0),p=v.useRef(null),N=v.useRef({x:0,y:0}),w=v.useRef(null),y=v.useRef(!1),x=v.useRef(!1),_=v.useRef(!1),j=lf();return v.useEffect(()=>{if(e!=null&&e.current){const b=He(e.current),I=({x:D,y:M})=>{const{nodeInternals:B,onNodeDrag:F,onSelectionDrag:O,updateNodePositions:L,nodeExtent:g,snapGrid:C,snapToGrid:S,nodeOrigin:R,onError:k}=c.getState();f.current={x:D,y:M};let E=!1,$={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&g){const H=is(u.current,R);$=un(H)}if(u.current=u.current.map(H=>{const Y={x:D-H.distance.x,y:M-H.distance.y};S&&(Y.x=C[0]*Math.round(Y.x/C[0]),Y.y=C[1]*Math.round(Y.y/C[1]));const W=[[g[0][0],g[0][1]],[g[1][0],g[1][1]]];u.current.length>1&&g&&!H.extent&&(W[0][0]=H.positionAbsolute.x-$.x+g[0][0],W[1][0]=H.positionAbsolute.x+(H.width??0)-$.x2+g[1][0],W[0][1]=H.positionAbsolute.y-$.y+g[0][1],W[1][1]=H.positionAbsolute.y+(H.height??0)-$.y2+g[1][1]);const U=Ri(H,Y,B,W,R,k);return E=E||H.position.x!==U.position.x||H.position.y!==U.position.y,H.position=U.position,H.positionAbsolute=U.positionAbsolute,H}),!E)return;L(u.current,!0,!0),l(!0);const z=r?F:ws(O);if(z&&w.current){const[H,Y]=ys({nodeId:r,dragItems:u.current,nodeInternals:B});z(w.current,H,Y)}},T=()=>{if(!p.current)return;const[D,M]=ei(N.current,p.current);if(D!==0||M!==0){const{transform:B,panBy:F}=c.getState();f.current.x=(f.current.x??0)-D/B[2],f.current.y=(f.current.y??0)-M/B[2],F({x:D,y:M})&&I(f.current)}h.current=requestAnimationFrame(T)},P=D=>{var R;const{nodeInternals:M,multiSelectionActive:B,nodesDraggable:F,unselectNodesAndEdges:O,onNodeDragStart:L,onSelectionDragStart:g}=c.getState();x.current=!0;const C=r?L:ws(g);(!o||!i)&&!B&&r&&((R=M.get(r))!=null&&R.selected||O()),r&&i&&o&&Ds({id:r,store:c,nodeRef:e});const S=j(D);if(f.current=S,u.current=af(M,F,S,r),C&&u.current){const[k,E]=ys({nodeId:r,dragItems:u.current,nodeInternals:M});C(D.sourceEvent,k,E)}};if(t)b.on(".drag",null);else{const D=wl().on("start",M=>{const{domNode:B,nodeDragThreshold:F}=c.getState();F===0&&P(M),_.current=!1;const O=j(M);f.current=O,p.current=(B==null?void 0:B.getBoundingClientRect())||null,N.current=bt(M.sourceEvent,p.current)}).on("drag",M=>{var L,g;const B=j(M),{autoPanOnNodeDrag:F,nodeDragThreshold:O}=c.getState();if(M.sourceEvent.type==="touchmove"&&M.sourceEvent.touches.length>1&&(_.current=!0),!_.current){if(!y.current&&x.current&&F&&(y.current=!0,T()),!x.current){const C=B.xSnapped-(((L=f==null?void 0:f.current)==null?void 0:L.x)??0),S=B.ySnapped-(((g=f==null?void 0:f.current)==null?void 0:g.y)??0);Math.sqrt(C*C+S*S)>O&&P(M)}(f.current.x!==B.xSnapped||f.current.y!==B.ySnapped)&&u.current&&x.current&&(w.current=M.sourceEvent,N.current=bt(M.sourceEvent,p.current),I(B))}}).on("end",M=>{if(!(!x.current||_.current)&&(l(!1),y.current=!1,x.current=!1,cancelAnimationFrame(h.current),u.current)){const{updateNodePositions:B,nodeInternals:F,onNodeDragStop:O,onSelectionDragStop:L}=c.getState(),g=r?O:ws(L);if(B(u.current,!1,!1),g){const[C,S]=ys({nodeId:r,dragItems:u.current,nodeInternals:F});g(M.sourceEvent,C,S)}}}).filter(M=>{const B=M.target;return!M.button&&(!n||!io(B,`.${n}`,e))&&(!s||io(B,s,e))});return b.call(D),()=>{b.on(".drag",null)}}}},[e,t,n,s,i,c,r,o,j]),a}function Pi(){const e=Ne();return v.useCallback(n=>{const{nodeInternals:s,nodeExtent:r,updateNodePositions:i,getNodes:o,snapToGrid:c,snapGrid:a,onError:l,nodesDraggable:u}=e.getState(),f=o().filter(_=>_.selected&&(_.draggable||u&&typeof _.draggable>"u")),h=c?a[0]:5,p=c?a[1]:5,N=n.isShiftPressed?4:1,w=n.x*h*N,y=n.y*p*N,x=f.map(_=>{if(_.positionAbsolute){const j={x:_.positionAbsolute.x+w,y:_.positionAbsolute.y+y};c&&(j.x=a[0]*Math.round(j.x/a[0]),j.y=a[1]*Math.round(j.y/a[1]));const{positionAbsolute:b,position:I}=Ri(_,j,s,r,void 0,l);_.position=I,_.positionAbsolute=b}return _});i(x,!0,!1)},[])}const Vt={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var Qt=e=>{const t=({id:n,type:s,data:r,xPos:i,yPos:o,xPosOrigin:c,yPosOrigin:a,selected:l,onClick:u,onMouseEnter:f,onMouseMove:h,onMouseLeave:p,onContextMenu:N,onDoubleClick:w,style:y,className:x,isDraggable:_,isSelectable:j,isConnectable:b,isFocusable:I,selectNodesOnDrag:T,sourcePosition:P,targetPosition:D,hidden:M,resizeObserver:B,dragHandle:F,zIndex:O,isParent:L,noDragClassName:g,noPanClassName:C,initialized:S,disableKeyboardA11y:R,ariaLabel:k,rfId:E,hasHandleBounds:$})=>{const z=Ne(),H=v.useRef(null),Y=v.useRef(null),W=v.useRef(P),U=v.useRef(D),Q=v.useRef(s),J=j||_||u||f||h||p,oe=Pi(),ie=Kt(n,z.getState,f),ee=Kt(n,z.getState,h),xe=Kt(n,z.getState,p),fe=Kt(n,z.getState,N),be=Kt(n,z.getState,w),ye=ce=>{const{nodeDragThreshold:G}=z.getState();if(j&&(!T||!_||G>0)&&Ds({id:n,store:z,nodeRef:H}),u){const Se=z.getState().nodeInternals.get(n);Se&&u(ce,{...Se})}},de=ce=>{if(!Ts(ce)&&!R)if(ri.includes(ce.key)&&j){const G=ce.key==="Escape";Ds({id:n,store:z,unselect:G,nodeRef:H})}else _&&l&&Object.prototype.hasOwnProperty.call(Vt,ce.key)&&(z.setState({ariaLiveMessage:`Moved selected node ${ce.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~o}`}),oe({x:Vt[ce.key].x,y:Vt[ce.key].y,isShiftPressed:ce.shiftKey}))};v.useEffect(()=>()=>{Y.current&&(B==null||B.unobserve(Y.current),Y.current=null)},[]),v.useEffect(()=>{if(H.current&&!M){const ce=H.current;(!S||!$||Y.current!==ce)&&(Y.current&&(B==null||B.unobserve(Y.current)),B==null||B.observe(ce),Y.current=ce)}},[M,S,$]),v.useEffect(()=>{const ce=Q.current!==s,G=W.current!==P,Se=U.current!==D;H.current&&(ce||G||Se)&&(ce&&(Q.current=s),G&&(W.current=P),Se&&(U.current=D),z.getState().updateNodeDimensions([{id:n,nodeElement:H.current,forceUpdate:!0}]))},[n,s,P,D]);const Ce=zi({nodeRef:H,disabled:M||!_,noDragClassName:g,handleSelector:F,nodeId:n,isSelectable:j,selectNodesOnDrag:T});return M?null:A.createElement("div",{className:je(["react-flow__node",`react-flow__node-${s}`,{[C]:_},x,{selected:l,selectable:j,parent:L,dragging:Ce}]),ref:H,style:{zIndex:O,transform:`translate(${c}px,${a}px)`,pointerEvents:J?"all":"none",visibility:S?"visible":"hidden",...y},"data-id":n,"data-testid":`rf__node-${n}`,onMouseEnter:ie,onMouseMove:ee,onMouseLeave:xe,onContextMenu:fe,onClick:ye,onDoubleClick:be,onKeyDown:I?de:void 0,tabIndex:I?0:void 0,role:I?"button":void 0,"aria-describedby":R?void 0:`${_i}-${E}`,"aria-label":k},A.createElement(Nd,{value:n},A.createElement(e,{id:n,data:r,type:s,xPos:i,yPos:o,selected:l,isConnectable:b,sourcePosition:P,targetPosition:D,dragging:Ce,dragHandle:F,zIndex:O})))};return t.displayName="NodeWrapper",v.memo(t)};const uf=e=>{const t=e.getNodes().filter(n=>n.selected);return{...is(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};function df({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const s=Ne(),{width:r,height:i,x:o,y:c,transformString:a,userSelectionActive:l}=he(uf,Ee),u=Pi(),f=v.useRef(null);if(v.useEffect(()=>{var N;n||(N=f.current)==null||N.focus({preventScroll:!0})},[n]),zi({nodeRef:f}),l||!r||!i)return null;const h=e?N=>{const w=s.getState().getNodes().filter(y=>y.selected);e(N,w)}:void 0,p=N=>{Object.prototype.hasOwnProperty.call(Vt,N.key)&&u({x:Vt[N.key].x,y:Vt[N.key].y,isShiftPressed:N.shiftKey})};return A.createElement("div",{className:je(["react-flow__nodesselection","react-flow__container",t]),style:{transform:a}},A.createElement("div",{ref:f,className:"react-flow__nodesselection-rect",onContextMenu:h,tabIndex:n?void 0:-1,onKeyDown:n?void 0:p,style:{width:r,height:i,top:c,left:o}}))}var ff=v.memo(df);const hf=e=>e.nodesSelectionActive,Di=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,deleteKeyCode:c,onMove:a,onMoveStart:l,onMoveEnd:u,selectionKeyCode:f,selectionOnDrag:h,selectionMode:p,onSelectionStart:N,onSelectionEnd:w,multiSelectionKeyCode:y,panActivationKeyCode:x,zoomActivationKeyCode:_,elementsSelectable:j,zoomOnScroll:b,zoomOnPinch:I,panOnScroll:T,panOnScrollSpeed:P,panOnScrollMode:D,zoomOnDoubleClick:M,panOnDrag:B,defaultViewport:F,translateExtent:O,minZoom:L,maxZoom:g,preventScrolling:C,onSelectionContextMenu:S,noWheelClassName:R,noPanClassName:k,disableKeyboardA11y:E})=>{const $=he(hf),z=fn(f),H=fn(x),Y=H||B,W=H||T,U=z||h&&Y!==!0;return Kd({deleteKeyCode:c,multiSelectionKeyCode:y}),A.createElement(tf,{onMove:a,onMoveStart:l,onMoveEnd:u,onPaneContextMenu:i,elementsSelectable:j,zoomOnScroll:b,zoomOnPinch:I,panOnScroll:W,panOnScrollSpeed:P,panOnScrollMode:D,zoomOnDoubleClick:M,panOnDrag:!z&&Y,defaultViewport:F,translateExtent:O,minZoom:L,maxZoom:g,zoomActivationKeyCode:_,preventScrolling:C,noWheelClassName:R,noPanClassName:k},A.createElement(Ti,{onSelectionStart:N,onSelectionEnd:w,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:s,onPaneMouseLeave:r,onPaneContextMenu:i,onPaneScroll:o,panOnDrag:Y,isSelecting:!!U,selectionMode:p},e,$&&A.createElement(ff,{onSelectionContextMenu:S,noPanClassName:k,disableKeyboardA11y:E})))};Di.displayName="FlowRenderer";var mf=v.memo(Di);function gf(e){return he(v.useCallback(n=>e?di(n.nodeInternals,{x:0,y:0,width:n.width,height:n.height},n.transform,!0):n.getNodes(),[e]))}function pf(e){const t={input:Qt(e.input||bi),default:Qt(e.default||Ps),output:Qt(e.output||Ni),group:Qt(e.group||Js)},n={},s=Object.keys(e).filter(r=>!["input","default","output","group"].includes(r)).reduce((r,i)=>(r[i]=Qt(e[i]||Ps),r),n);return{...t,...s}}const xf=({x:e,y:t,width:n,height:s,origin:r})=>!n||!s?{x:e,y:t}:r[0]<0||r[1]<0||r[0]>1||r[1]>1?{x:e,y:t}:{x:e-n*r[0],y:t-s*r[1]},yf=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),ki=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:s,elementsSelectable:r,updateNodeDimensions:i,onError:o}=he(yf,Ee),c=gf(e.onlyRenderVisibleElements),a=v.useRef(),l=v.useMemo(()=>{if(typeof ResizeObserver>"u")return null;const u=new ResizeObserver(f=>{const h=f.map(p=>({id:p.target.getAttribute("data-id"),nodeElement:p.target,forceUpdate:!0}));i(h)});return a.current=u,u},[]);return v.useEffect(()=>()=>{var u;(u=a==null?void 0:a.current)==null||u.disconnect()},[]),A.createElement("div",{className:"react-flow__nodes",style:tr},c.map(u=>{var I,T,P;let f=u.type||"default";e.nodeTypes[f]||(o==null||o("003",ht.error003(f)),f="default");const h=e.nodeTypes[f]||e.nodeTypes.default,p=!!(u.draggable||t&&typeof u.draggable>"u"),N=!!(u.selectable||r&&typeof u.selectable>"u"),w=!!(u.connectable||n&&typeof u.connectable>"u"),y=!!(u.focusable||s&&typeof u.focusable>"u"),x=e.nodeExtent?Us(u.positionAbsolute,e.nodeExtent):u.positionAbsolute,_=(x==null?void 0:x.x)??0,j=(x==null?void 0:x.y)??0,b=xf({x:_,y:j,width:u.width??0,height:u.height??0,origin:e.nodeOrigin});return A.createElement(h,{key:u.id,id:u.id,className:u.className,style:u.style,type:f,data:u.data,sourcePosition:u.sourcePosition||Z.Bottom,targetPosition:u.targetPosition||Z.Top,hidden:u.hidden,xPos:_,yPos:j,xPosOrigin:b.x,yPosOrigin:b.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!u.selected,isDraggable:p,isSelectable:N,isConnectable:w,isFocusable:y,resizeObserver:l,dragHandle:u.dragHandle,zIndex:((I=u[pe])==null?void 0:I.z)??0,isParent:!!((T=u[pe])!=null&&T.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!u.width&&!!u.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:u.ariaLabel,hasHandleBounds:!!((P=u[pe])!=null&&P.handleBounds)})}))};ki.displayName="NodeRenderer";var wf=v.memo(ki);const bf=(e,t,n)=>n===Z.Left?e-t:n===Z.Right?e+t:e,vf=(e,t,n)=>n===Z.Top?e-t:n===Z.Bottom?e+t:e,co="react-flow__edgeupdater",lo=({position:e,centerX:t,centerY:n,radius:s=10,onMouseDown:r,onMouseEnter:i,onMouseOut:o,type:c})=>A.createElement("circle",{onMouseDown:r,onMouseEnter:i,onMouseOut:o,className:je([co,`${co}-${c}`]),cx:bf(t,s,e),cy:vf(n,s,e),r:s,stroke:"transparent",fill:"transparent"}),Nf=()=>!0;var Ht=e=>{const t=({id:n,className:s,type:r,data:i,onClick:o,onEdgeDoubleClick:c,selected:a,animated:l,label:u,labelStyle:f,labelShowBg:h,labelBgStyle:p,labelBgPadding:N,labelBgBorderRadius:w,style:y,source:x,target:_,sourceX:j,sourceY:b,targetX:I,targetY:T,sourcePosition:P,targetPosition:D,elementsSelectable:M,hidden:B,sourceHandleId:F,targetHandleId:O,onContextMenu:L,onMouseEnter:g,onMouseMove:C,onMouseLeave:S,reconnectRadius:R,onReconnect:k,onReconnectStart:E,onReconnectEnd:$,markerEnd:z,markerStart:H,rfId:Y,ariaLabel:W,isFocusable:U,isReconnectable:Q,pathOptions:J,interactionWidth:oe,disableKeyboardA11y:ie})=>{const ee=v.useRef(null),[xe,fe]=v.useState(!1),[be,ye]=v.useState(!1),de=Ne(),Ce=v.useMemo(()=>`url('#${Rs(H,Y)}')`,[H,Y]),ce=v.useMemo(()=>`url('#${Rs(z,Y)}')`,[z,Y]);if(B)return null;const G=_e=>{var Pe;const{edges:Ie,addSelectedEdges:Je,unselectNodesAndEdges:Oe,multiSelectionActive:at}=de.getState(),Me=Ie.find(Nt=>Nt.id===n);Me&&(M&&(de.setState({nodesSelectionActive:!1}),Me.selected&&at?(Oe({nodes:[],edges:[Me]}),(Pe=ee.current)==null||Pe.blur()):Je([n])),o&&o(_e,Me))},Se=Zt(n,de.getState,c),Be=Zt(n,de.getState,L),vt=Zt(n,de.getState,g),rt=Zt(n,de.getState,C),Fe=Zt(n,de.getState,S),Ve=(_e,Ie)=>{if(_e.button!==0)return;const{edges:Je,isValidConnection:Oe}=de.getState(),at=Ie?_:x,Me=(Ie?O:F)||null,Pe=Ie?"target":"source",Nt=Oe||Nf,$t=Ie,St=Je.find(ct=>ct.id===n);ye(!0),E==null||E(_e,St,Pe);const Xe=ct=>{ye(!1),$==null||$(ct,St,Pe)};pi({event:_e,handleId:Me,nodeId:at,onConnect:ct=>k==null?void 0:k(St,ct),isTarget:$t,getState:de.getState,setState:de.setState,isValidConnection:Nt,edgeUpdaterType:Pe,onReconnectEnd:Xe})},Ke=_e=>Ve(_e,!0),Qe=_e=>Ve(_e,!1),ot=()=>fe(!0),it=()=>fe(!1),re=!M&&!o,Ae=_e=>{var Ie;if(!ie&&ri.includes(_e.key)&&M){const{unselectNodesAndEdges:Je,addSelectedEdges:Oe,edges:at}=de.getState();_e.key==="Escape"?((Ie=ee.current)==null||Ie.blur(),Je({edges:[at.find(Pe=>Pe.id===n)]})):Oe([n])}};return A.createElement("g",{className:je(["react-flow__edge",`react-flow__edge-${r}`,s,{selected:a,animated:l,inactive:re,updating:xe}]),onClick:G,onDoubleClick:Se,onContextMenu:Be,onMouseEnter:vt,onMouseMove:rt,onMouseLeave:Fe,onKeyDown:U?Ae:void 0,tabIndex:U?0:void 0,role:U?"button":"img","data-testid":`rf__edge-${n}`,"aria-label":W===null?void 0:W||`Edge from ${x} to ${_}`,"aria-describedby":U?`${Ei}-${Y}`:void 0,ref:ee},!be&&A.createElement(e,{id:n,source:x,target:_,selected:a,animated:l,label:u,labelStyle:f,labelShowBg:h,labelBgStyle:p,labelBgPadding:N,labelBgBorderRadius:w,data:i,style:y,sourceX:j,sourceY:b,targetX:I,targetY:T,sourcePosition:P,targetPosition:D,sourceHandleId:F,targetHandleId:O,markerStart:Ce,markerEnd:ce,pathOptions:J,interactionWidth:oe}),Q&&A.createElement(A.Fragment,null,(Q==="source"||Q===!0)&&A.createElement(lo,{position:P,centerX:j,centerY:b,radius:R,onMouseDown:Ke,onMouseEnter:ot,onMouseOut:it,type:"source"}),(Q==="target"||Q===!0)&&A.createElement(lo,{position:D,centerX:I,centerY:T,radius:R,onMouseDown:Qe,onMouseEnter:ot,onMouseOut:it,type:"target"})))};return t.displayName="EdgeWrapper",v.memo(t)};function Sf(e){const t={default:Ht(e.default||Qn),straight:Ht(e.bezier||Zs),step:Ht(e.step||qs),smoothstep:Ht(e.step||os),simplebezier:Ht(e.simplebezier||Gs)},n={},s=Object.keys(e).filter(r=>!["default","bezier"].includes(r)).reduce((r,i)=>(r[i]=Ht(e[i]||Qn),r),n);return{...t,...s}}function uo(e,t,n=null){const s=((n==null?void 0:n.x)||0)+t.x,r=((n==null?void 0:n.y)||0)+t.y,i=(n==null?void 0:n.width)||t.width,o=(n==null?void 0:n.height)||t.height;switch(e){case Z.Top:return{x:s+i/2,y:r};case Z.Right:return{x:s+i,y:r+o/2};case Z.Bottom:return{x:s+i/2,y:r+o};case Z.Left:return{x:s,y:r+o/2}}}function fo(e,t){return e?e.length===1||!t?e[0]:t&&e.find(n=>n.id===t)||null:null}const _f=(e,t,n,s,r,i)=>{const o=uo(n,e,t),c=uo(i,s,r);return{sourceX:o.x,sourceY:o.y,targetX:c.x,targetY:c.y}};function Ef({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:s,targetWidth:r,targetHeight:i,width:o,height:c,transform:a}){const l={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+r),y2:Math.max(e.y+s,t.y+i)};l.x===l.x2&&(l.x2+=1),l.y===l.y2&&(l.y2+=1);const u=un({x:(0-a[0])/a[2],y:(0-a[1])/a[2],width:o/a[2],height:c/a[2]}),f=Math.max(0,Math.min(u.x2,l.x2)-Math.max(u.x,l.x)),h=Math.max(0,Math.min(u.y2,l.y2)-Math.max(u.y,l.y));return Math.ceil(f*h)>0}function ho(e){var s,r,i,o,c;const t=((s=e==null?void 0:e[pe])==null?void 0:s.handleBounds)||null,n=t&&(e==null?void 0:e.width)&&(e==null?void 0:e.height)&&typeof((r=e==null?void 0:e.positionAbsolute)==null?void 0:r.x)<"u"&&typeof((i=e==null?void 0:e.positionAbsolute)==null?void 0:i.y)<"u";return[{x:((o=e==null?void 0:e.positionAbsolute)==null?void 0:o.x)||0,y:((c=e==null?void 0:e.positionAbsolute)==null?void 0:c.y)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0},t,!!n]}const jf=[{level:0,isMaxLevel:!0,edges:[]}];function Cf(e,t,n=!1){let s=-1;const r=e.reduce((o,c)=>{var u,f;const a=Le(c.zIndex);let l=a?c.zIndex:0;if(n){const h=t.get(c.target),p=t.get(c.source),N=c.selected||(h==null?void 0:h.selected)||(p==null?void 0:p.selected),w=Math.max(((u=p==null?void 0:p[pe])==null?void 0:u.z)||0,((f=h==null?void 0:h[pe])==null?void 0:f.z)||0,1e3);l=(a?c.zIndex:0)+(N?w:0)}return o[l]?o[l].push(c):o[l]=[c],s=l>s?l:s,o},{}),i=Object.entries(r).map(([o,c])=>{const a=+o;return{edges:c,level:a,isMaxLevel:a===s}});return i.length===0?jf:i}function Af(e,t,n){const s=he(v.useCallback(r=>e?r.edges.filter(i=>{const o=t.get(i.source),c=t.get(i.target);return(o==null?void 0:o.width)&&(o==null?void 0:o.height)&&(c==null?void 0:c.width)&&(c==null?void 0:c.height)&&Ef({sourcePos:o.positionAbsolute||{x:0,y:0},targetPos:c.positionAbsolute||{x:0,y:0},sourceWidth:o.width,sourceHeight:o.height,targetWidth:c.width,targetHeight:c.height,width:r.width,height:r.height,transform:r.transform})}):r.edges,[e,t]));return Cf(s,t,n)}const If=({color:e="none",strokeWidth:t=1})=>A.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),Mf=({color:e="none",strokeWidth:t=1})=>A.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"}),mo={[Kn.Arrow]:If,[Kn.ArrowClosed]:Mf};function Tf(e){const t=Ne();return v.useMemo(()=>{var r,i;return Object.prototype.hasOwnProperty.call(mo,e)?mo[e]:((i=(r=t.getState()).onError)==null||i.call(r,"009",ht.error009(e)),null)},[e])}const $f=({id:e,type:t,color:n,width:s=12.5,height:r=12.5,markerUnits:i="strokeWidth",strokeWidth:o,orient:c="auto-start-reverse"})=>{const a=Tf(t);return a?A.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${s}`,markerHeight:`${r}`,viewBox:"-10 -10 20 20",markerUnits:i,orient:c,refX:"0",refY:"0"},A.createElement(a,{color:n,strokeWidth:o})):null},Rf=({defaultColor:e,rfId:t})=>n=>{const s=[];return n.edges.reduce((r,i)=>([i.markerStart,i.markerEnd].forEach(o=>{if(o&&typeof o=="object"){const c=Rs(o,t);s.includes(c)||(r.push({id:c,color:o.color||e,...o}),s.push(c))}}),r),[]).sort((r,i)=>r.id.localeCompare(i.id))},Hi=({defaultColor:e,rfId:t})=>{const n=he(v.useCallback(Rf({defaultColor:e,rfId:t}),[e,t]),(s,r)=>!(s.length!==r.length||s.some((i,o)=>i.id!==r[o].id)));return A.createElement("defs",null,n.map(s=>A.createElement($f,{id:s.id,key:s.id,type:s.type,color:s.color,width:s.width,height:s.height,markerUnits:s.markerUnits,strokeWidth:s.strokeWidth,orient:s.orient})))};Hi.displayName="MarkerDefinitions";var zf=v.memo(Hi);const Pf=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),Li=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:s,edgeTypes:r,noPanClassName:i,onEdgeContextMenu:o,onEdgeMouseEnter:c,onEdgeMouseMove:a,onEdgeMouseLeave:l,onEdgeClick:u,onEdgeDoubleClick:f,onReconnect:h,onReconnectStart:p,onReconnectEnd:N,reconnectRadius:w,children:y,disableKeyboardA11y:x})=>{const{edgesFocusable:_,edgesUpdatable:j,elementsSelectable:b,width:I,height:T,connectionMode:P,nodeInternals:D,onError:M}=he(Pf,Ee),B=Af(t,D,n);return I?A.createElement(A.Fragment,null,B.map(({level:F,edges:O,isMaxLevel:L})=>A.createElement("svg",{key:F,style:{zIndex:F},width:I,height:T,className:"react-flow__edges react-flow__container"},L&&A.createElement(zf,{defaultColor:e,rfId:s}),A.createElement("g",null,O.map(g=>{const[C,S,R]=ho(D.get(g.source)),[k,E,$]=ho(D.get(g.target));if(!R||!$)return null;let z=g.type||"default";r[z]||(M==null||M("011",ht.error011(z)),z="default");const H=r[z]||r.default,Y=P===Tt.Strict?E.target:(E.target??[]).concat(E.source??[]),W=fo(S.source,g.sourceHandle),U=fo(Y,g.targetHandle),Q=(W==null?void 0:W.position)||Z.Bottom,J=(U==null?void 0:U.position)||Z.Top,oe=!!(g.focusable||_&&typeof g.focusable>"u"),ie=g.reconnectable||g.updatable,ee=typeof h<"u"&&(ie||j&&typeof ie>"u");if(!W||!U)return M==null||M("008",ht.error008(W,g)),null;const{sourceX:xe,sourceY:fe,targetX:be,targetY:ye}=_f(C,W,Q,k,U,J);return A.createElement(H,{key:g.id,id:g.id,className:je([g.className,i]),type:z,data:g.data,selected:!!g.selected,animated:!!g.animated,hidden:!!g.hidden,label:g.label,labelStyle:g.labelStyle,labelShowBg:g.labelShowBg,labelBgStyle:g.labelBgStyle,labelBgPadding:g.labelBgPadding,labelBgBorderRadius:g.labelBgBorderRadius,style:g.style,source:g.source,target:g.target,sourceHandleId:g.sourceHandle,targetHandleId:g.targetHandle,markerEnd:g.markerEnd,markerStart:g.markerStart,sourceX:xe,sourceY:fe,targetX:be,targetY:ye,sourcePosition:Q,targetPosition:J,elementsSelectable:b,onContextMenu:o,onMouseEnter:c,onMouseMove:a,onMouseLeave:l,onClick:u,onEdgeDoubleClick:f,onReconnect:h,onReconnectStart:p,onReconnectEnd:N,reconnectRadius:w,rfId:s,ariaLabel:g.ariaLabel,isFocusable:oe,isReconnectable:ee,pathOptions:"pathOptions"in g?g.pathOptions:void 0,interactionWidth:g.interactionWidth,disableKeyboardA11y:x})})))),y):null};Li.displayName="EdgeRenderer";var Df=v.memo(Li);const kf=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Hf({children:e}){const t=he(kf);return A.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}function Lf(e){const t=er(),n=v.useRef(!1);v.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}const Bf={[Z.Left]:Z.Right,[Z.Right]:Z.Left,[Z.Top]:Z.Bottom,[Z.Bottom]:Z.Top},Bi=({nodeId:e,handleType:t,style:n,type:s=wt.Bezier,CustomComponent:r,connectionStatus:i})=>{var T,P,D;const{fromNode:o,handleId:c,toX:a,toY:l,connectionMode:u}=he(v.useCallback(M=>({fromNode:M.nodeInternals.get(e),handleId:M.connectionHandleId,toX:(M.connectionPosition.x-M.transform[0])/M.transform[2],toY:(M.connectionPosition.y-M.transform[1])/M.transform[2],connectionMode:M.connectionMode}),[e]),Ee),f=(T=o==null?void 0:o[pe])==null?void 0:T.handleBounds;let h=f==null?void 0:f[t];if(u===Tt.Loose&&(h=h||(f==null?void 0:f[t==="source"?"target":"source"])),!o||!h)return null;const p=c?h.find(M=>M.id===c):h[0],N=p?p.x+p.width/2:(o.width??0)/2,w=p?p.y+p.height/2:o.height??0,y=(((P=o.positionAbsolute)==null?void 0:P.x)??0)+N,x=(((D=o.positionAbsolute)==null?void 0:D.y)??0)+w,_=p==null?void 0:p.position,j=_?Bf[_]:null;if(!_||!j)return null;if(r)return A.createElement(r,{connectionLineType:s,connectionLineStyle:n,fromNode:o,fromHandle:p,fromX:y,fromY:x,toX:a,toY:l,fromPosition:_,toPosition:j,connectionStatus:i});let b="";const I={sourceX:y,sourceY:x,sourcePosition:_,targetX:a,targetY:l,targetPosition:j};return s===wt.Bezier?[b]=li(I):s===wt.Step?[b]=$s({...I,borderRadius:0}):s===wt.SmoothStep?[b]=$s(I):s===wt.SimpleBezier?[b]=ci(I):b=`M${y},${x} ${a},${l}`,A.createElement("path",{d:b,fill:"none",className:"react-flow__connection-path",style:n})};Bi.displayName="ConnectionLine";const Ff=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function Vf({containerStyle:e,style:t,type:n,component:s}){const{nodeId:r,handleType:i,nodesConnectable:o,width:c,height:a,connectionStatus:l}=he(Ff,Ee);return!(r&&i&&c&&o)?null:A.createElement("svg",{style:e,width:c,height:a,className:"react-flow__edges react-flow__connectionline react-flow__container"},A.createElement("g",{className:je(["react-flow__connection",l])},A.createElement(Bi,{nodeId:r,handleType:i,style:t,type:n,CustomComponent:s,connectionStatus:l})))}function go(e,t){return v.useRef(null),Ne(),v.useMemo(()=>t(e),[e])}const Fi=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:s,onMoveEnd:r,onInit:i,onNodeClick:o,onEdgeClick:c,onNodeDoubleClick:a,onEdgeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:f,onNodeMouseLeave:h,onNodeContextMenu:p,onSelectionContextMenu:N,onSelectionStart:w,onSelectionEnd:y,connectionLineType:x,connectionLineStyle:_,connectionLineComponent:j,connectionLineContainerStyle:b,selectionKeyCode:I,selectionOnDrag:T,selectionMode:P,multiSelectionKeyCode:D,panActivationKeyCode:M,zoomActivationKeyCode:B,deleteKeyCode:F,onlyRenderVisibleElements:O,elementsSelectable:L,selectNodesOnDrag:g,defaultViewport:C,translateExtent:S,minZoom:R,maxZoom:k,preventScrolling:E,defaultMarkerColor:$,zoomOnScroll:z,zoomOnPinch:H,panOnScroll:Y,panOnScrollSpeed:W,panOnScrollMode:U,zoomOnDoubleClick:Q,panOnDrag:J,onPaneClick:oe,onPaneMouseEnter:ie,onPaneMouseMove:ee,onPaneMouseLeave:xe,onPaneScroll:fe,onPaneContextMenu:be,onEdgeContextMenu:ye,onEdgeMouseEnter:de,onEdgeMouseMove:Ce,onEdgeMouseLeave:ce,onReconnect:G,onReconnectStart:Se,onReconnectEnd:Be,reconnectRadius:vt,noDragClassName:rt,noWheelClassName:Fe,noPanClassName:Ve,elevateEdgesOnSelect:Ke,disableKeyboardA11y:Qe,nodeOrigin:ot,nodeExtent:it,rfId:re})=>{const Ae=go(e,pf),_e=go(t,Sf);return Lf(i),A.createElement(mf,{onPaneClick:oe,onPaneMouseEnter:ie,onPaneMouseMove:ee,onPaneMouseLeave:xe,onPaneContextMenu:be,onPaneScroll:fe,deleteKeyCode:F,selectionKeyCode:I,selectionOnDrag:T,selectionMode:P,onSelectionStart:w,onSelectionEnd:y,multiSelectionKeyCode:D,panActivationKeyCode:M,zoomActivationKeyCode:B,elementsSelectable:L,onMove:n,onMoveStart:s,onMoveEnd:r,zoomOnScroll:z,zoomOnPinch:H,zoomOnDoubleClick:Q,panOnScroll:Y,panOnScrollSpeed:W,panOnScrollMode:U,panOnDrag:J,defaultViewport:C,translateExtent:S,minZoom:R,maxZoom:k,onSelectionContextMenu:N,preventScrolling:E,noDragClassName:rt,noWheelClassName:Fe,noPanClassName:Ve,disableKeyboardA11y:Qe},A.createElement(Hf,null,A.createElement(Df,{edgeTypes:_e,onEdgeClick:c,onEdgeDoubleClick:l,onlyRenderVisibleElements:O,onEdgeContextMenu:ye,onEdgeMouseEnter:de,onEdgeMouseMove:Ce,onEdgeMouseLeave:ce,onReconnect:G,onReconnectStart:Se,onReconnectEnd:Be,reconnectRadius:vt,defaultMarkerColor:$,noPanClassName:Ve,elevateEdgesOnSelect:!!Ke,disableKeyboardA11y:Qe,rfId:re},A.createElement(Vf,{style:_,type:x,component:j,containerStyle:b})),A.createElement("div",{className:"react-flow__edgelabel-renderer"}),A.createElement(wf,{nodeTypes:Ae,onNodeClick:o,onNodeDoubleClick:a,onNodeMouseEnter:u,onNodeMouseMove:f,onNodeMouseLeave:h,onNodeContextMenu:p,selectNodesOnDrag:g,onlyRenderVisibleElements:O,noPanClassName:Ve,noDragClassName:rt,disableKeyboardA11y:Qe,nodeOrigin:ot,nodeExtent:it,rfId:re})))};Fi.displayName="GraphView";var Of=v.memo(Fi);const ks=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],pt={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:ks,nodeExtent:ks,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:Tt.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:pd,isValidConnection:void 0},Xf=()=>Ta((e,t)=>({...pt,setNodes:n=>{const{nodeInternals:s,nodeOrigin:r,elevateNodesOnSelect:i}=t();e({nodeInternals:ps(n,s,r,i)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:s={}}=t();e({edges:n.map(r=>({...s,...r}))})},setDefaultNodesAndEdges:(n,s)=>{const r=typeof n<"u",i=typeof s<"u",o=r?ps(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:o,edges:i?s:[],hasDefaultNodes:r,hasDefaultEdges:i})},updateNodeDimensions:n=>{const{onNodesChange:s,nodeInternals:r,fitViewOnInit:i,fitViewOnInitDone:o,fitViewOnInitOptions:c,domNode:a,nodeOrigin:l}=t(),u=a==null?void 0:a.querySelector(".react-flow__viewport");if(!u)return;const f=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(f.transform),p=n.reduce((w,y)=>{const x=r.get(y.id);if(x!=null&&x.hidden)r.set(x.id,{...x,[pe]:{...x[pe],handleBounds:void 0}});else if(x){const _=Ys(y.nodeElement);!!(_.width&&_.height&&(x.width!==_.width||x.height!==_.height||y.forceUpdate))&&(r.set(x.id,{...x,[pe]:{...x[pe],handleBounds:{source:ao(".source",y.nodeElement,h,l),target:ao(".target",y.nodeElement,h,l)}},..._}),w.push({id:x.id,type:"dimensions",dimensions:_}))}return w},[]);Ci(r,l);const N=o||i&&!o&&Ai(t,{initial:!0,...c});e({nodeInternals:new Map(r),fitViewOnInitDone:N}),(p==null?void 0:p.length)>0&&(s==null||s(p))},updateNodePositions:(n,s=!0,r=!1)=>{const{triggerNodeChanges:i}=t(),o=n.map(c=>{const a={id:c.id,type:"position",dragging:r};return s&&(a.positionAbsolute=c.positionAbsolute,a.position=c.position),a});i(o)},triggerNodeChanges:n=>{const{onNodesChange:s,nodeInternals:r,hasDefaultNodes:i,nodeOrigin:o,getNodes:c,elevateNodesOnSelect:a}=t();if(n!=null&&n.length){if(i){const l=Mi(n,c()),u=ps(l,r,o,a);e({nodeInternals:u})}s==null||s(n)}},addSelectedNodes:n=>{const{multiSelectionActive:s,edges:r,getNodes:i}=t();let o,c=null;s?o=n.map(a=>yt(a,!0)):(o=Lt(i(),n),c=Lt(r,[])),kn({changedNodes:o,changedEdges:c,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:s,edges:r,getNodes:i}=t();let o,c=null;s?o=n.map(a=>yt(a,!0)):(o=Lt(r,n),c=Lt(i(),[])),kn({changedNodes:c,changedEdges:o,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:s}={})=>{const{edges:r,getNodes:i}=t(),o=n||i(),c=s||r,a=o.map(u=>(u.selected=!1,yt(u.id,!1))),l=c.map(u=>yt(u.id,!1));kn({changedNodes:a,changedEdges:l,get:t,set:e})},setMinZoom:n=>{const{d3Zoom:s,maxZoom:r}=t();s==null||s.scaleExtent([n,r]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:s,minZoom:r}=t();s==null||s.scaleExtent([r,n]),e({maxZoom:n})},setTranslateExtent:n=>{var s;(s=t().d3Zoom)==null||s.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:s}=t(),i=s().filter(c=>c.selected).map(c=>yt(c.id,!1)),o=n.filter(c=>c.selected).map(c=>yt(c.id,!1));kn({changedNodes:i,changedEdges:o,get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:s}=t();s.forEach(r=>{r.positionAbsolute=Us(r.position,n)}),e({nodeExtent:n,nodeInternals:new Map(s)})},panBy:n=>{const{transform:s,width:r,height:i,d3Zoom:o,d3Selection:c,translateExtent:a}=t();if(!o||!c||!n.x&&!n.y)return!1;const l=dt.translate(s[0]+n.x,s[1]+n.y).scale(s[2]),u=[[0,0],[r,i]],f=o==null?void 0:o.constrain()(l,u,a);return o.transform(c,f),s[0]!==f.x||s[1]!==f.y||s[2]!==f.k},cancelConnection:()=>e({connectionNodeId:pt.connectionNodeId,connectionHandleId:pt.connectionHandleId,connectionHandleType:pt.connectionHandleType,connectionStatus:pt.connectionStatus,connectionStartHandle:pt.connectionStartHandle,connectionEndHandle:pt.connectionEndHandle}),reset:()=>e({...pt})}),Object.is),nr=({children:e})=>{const t=v.useRef(null);return t.current||(t.current=Xf()),A.createElement(ld,{value:t.current},e)};nr.displayName="ReactFlowProvider";const Vi=({children:e})=>v.useContext(rs)?A.createElement(A.Fragment,null,e):A.createElement(nr,null,e);Vi.displayName="ReactFlowWrapper";const Wf={input:bi,default:Ps,output:Ni,group:Js},Yf={default:Qn,straight:Zs,step:qs,smoothstep:os,simplebezier:Gs},Uf=[0,0],Gf=[15,15],qf={x:0,y:0,zoom:1},Zf={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},Oi=v.forwardRef(({nodes:e,edges:t,defaultNodes:n,defaultEdges:s,className:r,nodeTypes:i=Wf,edgeTypes:o=Yf,onNodeClick:c,onEdgeClick:a,onInit:l,onMove:u,onMoveStart:f,onMoveEnd:h,onConnect:p,onConnectStart:N,onConnectEnd:w,onClickConnectStart:y,onClickConnectEnd:x,onNodeMouseEnter:_,onNodeMouseMove:j,onNodeMouseLeave:b,onNodeContextMenu:I,onNodeDoubleClick:T,onNodeDragStart:P,onNodeDrag:D,onNodeDragStop:M,onNodesDelete:B,onEdgesDelete:F,onSelectionChange:O,onSelectionDragStart:L,onSelectionDrag:g,onSelectionDragStop:C,onSelectionContextMenu:S,onSelectionStart:R,onSelectionEnd:k,connectionMode:E=Tt.Strict,connectionLineType:$=wt.Bezier,connectionLineStyle:z,connectionLineComponent:H,connectionLineContainerStyle:Y,deleteKeyCode:W="Backspace",selectionKeyCode:U="Shift",selectionOnDrag:Q=!1,selectionMode:J=dn.Full,panActivationKeyCode:oe="Space",multiSelectionKeyCode:ie=Zn()?"Meta":"Control",zoomActivationKeyCode:ee=Zn()?"Meta":"Control",snapToGrid:xe=!1,snapGrid:fe=Gf,onlyRenderVisibleElements:be=!1,selectNodesOnDrag:ye=!0,nodesDraggable:de,nodesConnectable:Ce,nodesFocusable:ce,nodeOrigin:G=Uf,edgesFocusable:Se,edgesUpdatable:Be,elementsSelectable:vt,defaultViewport:rt=qf,minZoom:Fe=.5,maxZoom:Ve=2,translateExtent:Ke=ks,preventScrolling:Qe=!0,nodeExtent:ot,defaultMarkerColor:it="#b1b1b7",zoomOnScroll:re=!0,zoomOnPinch:Ae=!0,panOnScroll:_e=!1,panOnScrollSpeed:Ie=.5,panOnScrollMode:Je=Ct.Free,zoomOnDoubleClick:Oe=!0,panOnDrag:at=!0,onPaneClick:Me,onPaneMouseEnter:Pe,onPaneMouseMove:Nt,onPaneMouseLeave:$t,onPaneScroll:St,onPaneContextMenu:Xe,children:pn,onEdgeContextMenu:ct,onEdgeDoubleClick:We,onEdgeMouseEnter:te,onEdgeMouseMove:as,onEdgeMouseLeave:sr,onEdgeUpdate:Yt,onEdgeUpdateStart:xn,onEdgeUpdateEnd:yn,onReconnect:wn,onReconnectStart:bn,onReconnectEnd:vn,reconnectRadius:Nn=10,edgeUpdaterRadius:Sn=10,onNodesChange:_n,onEdgesChange:m,noDragClassName:X="nodrag",noWheelClassName:V="nowheel",noPanClassName:K="nopan",fitView:le=!1,fitViewOptions:ae,connectOnClick:ue=!0,attributionPosition:ge,proOptions:we,defaultEdgeOptions:Te,elevateNodesOnSelect:et=!0,elevateEdgesOnSelect:tt=!1,disableKeyboardA11y:se=!1,autoPanOnConnect:$e=!0,autoPanOnNodeDrag:me=!0,connectionRadius:ve=20,isValidConnection:Ye,onError:mt,style:De,id:Ut,nodeDragThreshold:En,...jn},Cn)=>{const Rt=Ut||"1";return A.createElement("div",{...jn,style:{...De,...Zf},ref:Cn,className:je(["react-flow",r]),"data-testid":"rf__wrapper",id:Ut},A.createElement(Vi,null,A.createElement(Of,{onInit:l,onMove:u,onMoveStart:f,onMoveEnd:h,onNodeClick:c,onEdgeClick:a,onNodeMouseEnter:_,onNodeMouseMove:j,onNodeMouseLeave:b,onNodeContextMenu:I,onNodeDoubleClick:T,nodeTypes:i,edgeTypes:o,connectionLineType:$,connectionLineStyle:z,connectionLineComponent:H,connectionLineContainerStyle:Y,selectionKeyCode:U,selectionOnDrag:Q,selectionMode:J,deleteKeyCode:W,multiSelectionKeyCode:ie,panActivationKeyCode:oe,zoomActivationKeyCode:ee,onlyRenderVisibleElements:be,selectNodesOnDrag:ye,defaultViewport:rt,translateExtent:Ke,minZoom:Fe,maxZoom:Ve,preventScrolling:Qe,zoomOnScroll:re,zoomOnPinch:Ae,zoomOnDoubleClick:Oe,panOnScroll:_e,panOnScrollSpeed:Ie,panOnScrollMode:Je,panOnDrag:at,onPaneClick:Me,onPaneMouseEnter:Pe,onPaneMouseMove:Nt,onPaneMouseLeave:$t,onPaneScroll:St,onPaneContextMenu:Xe,onSelectionContextMenu:S,onSelectionStart:R,onSelectionEnd:k,onEdgeContextMenu:ct,onEdgeDoubleClick:We,onEdgeMouseEnter:te,onEdgeMouseMove:as,onEdgeMouseLeave:sr,onReconnect:wn??Yt,onReconnectStart:bn??xn,onReconnectEnd:vn??yn,reconnectRadius:Nn??Sn,defaultMarkerColor:it,noDragClassName:X,noWheelClassName:V,noPanClassName:K,elevateEdgesOnSelect:tt,rfId:Rt,disableKeyboardA11y:se,nodeOrigin:G,nodeExtent:ot}),A.createElement(Ld,{nodes:e,edges:t,defaultNodes:n,defaultEdges:s,onConnect:p,onConnectStart:N,onConnectEnd:w,onClickConnectStart:y,onClickConnectEnd:x,nodesDraggable:de,nodesConnectable:Ce,nodesFocusable:ce,edgesFocusable:Se,edgesUpdatable:Be,elementsSelectable:vt,elevateNodesOnSelect:et,minZoom:Fe,maxZoom:Ve,nodeExtent:ot,onNodesChange:_n,onEdgesChange:m,snapToGrid:xe,snapGrid:fe,connectionMode:E,translateExtent:Ke,connectOnClick:ue,defaultEdgeOptions:Te,fitView:le,fitViewOptions:ae,onNodesDelete:B,onEdgesDelete:F,onNodeDragStart:P,onNodeDrag:D,onNodeDragStop:M,onSelectionDrag:g,onSelectionDragStart:L,onSelectionDragStop:C,noPanClassName:K,nodeOrigin:G,rfId:Rt,autoPanOnConnect:$e,autoPanOnNodeDrag:me,onError:mt,connectionRadius:ve,isValidConnection:Ye,nodeDragThreshold:En}),A.createElement(kd,{onSelectionChange:O}),pn,A.createElement(dd,{proOptions:we,position:ge}),A.createElement(Xd,{rfId:Rt,disableKeyboardA11y:se})))});Oi.displayName="ReactFlow";function Xi(e){return t=>{const[n,s]=v.useState(t),r=v.useCallback(i=>s(o=>e(i,o)),[]);return[n,s,r]}}const Kf=Xi(Mi),Qf=Xi(rf),Wi=({id:e,x:t,y:n,width:s,height:r,style:i,color:o,strokeColor:c,strokeWidth:a,className:l,borderRadius:u,shapeRendering:f,onClick:h,selected:p})=>{const{background:N,backgroundColor:w}=i||{},y=o||N||w;return A.createElement("rect",{className:je(["react-flow__minimap-node",{selected:p},l]),x:t,y:n,rx:u,ry:u,width:s,height:r,fill:y,stroke:c,strokeWidth:a,shapeRendering:f,onClick:h?x=>h(x,e):void 0})};Wi.displayName="MiniMapNode";var Jf=v.memo(Wi);const eh=e=>e.nodeOrigin,th=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),bs=e=>e instanceof Function?e:()=>e;function nh({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r=2,nodeComponent:i=Jf,onClick:o}){const c=he(th,Ee),a=he(eh),l=bs(t),u=bs(e),f=bs(n),h=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return A.createElement(A.Fragment,null,c.map(p=>{const{x:N,y:w}=It(p,a).positionAbsolute;return A.createElement(i,{key:p.id,x:N,y:w,width:p.width,height:p.height,style:p.style,selected:p.selected,className:f(p),color:l(p),borderRadius:s,strokeColor:u(p),strokeWidth:r,shapeRendering:h,onClick:o,id:p.id})}))}var sh=v.memo(nh);const rh=200,oh=150,ih=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?md(is(t,e.nodeOrigin),n):n,rfId:e.rfId}},ah="react-flow__minimap-desc";function Yi({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:s="#e2e2e2",nodeClassName:r="",nodeBorderRadius:i=5,nodeStrokeWidth:o=2,nodeComponent:c,maskColor:a="rgb(240, 240, 240, 0.6)",maskStrokeColor:l="none",maskStrokeWidth:u=1,position:f="bottom-right",onClick:h,onNodeClick:p,pannable:N=!1,zoomable:w=!1,ariaLabel:y="React Flow mini map",inversePan:x=!1,zoomStep:_=10,offsetScale:j=5}){const b=Ne(),I=v.useRef(null),{boundingRect:T,viewBB:P,rfId:D}=he(ih,Ee),M=(e==null?void 0:e.width)??rh,B=(e==null?void 0:e.height)??oh,F=T.width/M,O=T.height/B,L=Math.max(F,O),g=L*M,C=L*B,S=j*L,R=T.x-(g-T.width)/2-S,k=T.y-(C-T.height)/2-S,E=g+S*2,$=C+S*2,z=`${ah}-${D}`,H=v.useRef(0);H.current=L,v.useEffect(()=>{if(I.current){const U=He(I.current),Q=ie=>{const{transform:ee,d3Selection:xe,d3Zoom:fe}=b.getState();if(ie.sourceEvent.type!=="wheel"||!xe||!fe)return;const be=-ie.sourceEvent.deltaY*(ie.sourceEvent.deltaMode===1?.05:ie.sourceEvent.deltaMode?1:.002)*_,ye=ee[2]*Math.pow(2,be);fe.scaleTo(xe,ye)},J=ie=>{const{transform:ee,d3Selection:xe,d3Zoom:fe,translateExtent:be,width:ye,height:de}=b.getState();if(ie.sourceEvent.type!=="mousemove"||!xe||!fe)return;const Ce=H.current*Math.max(1,ee[2])*(x?-1:1),ce={x:ee[0]-ie.sourceEvent.movementX*Ce,y:ee[1]-ie.sourceEvent.movementY*Ce},G=[[0,0],[ye,de]],Se=dt.translate(ce.x,ce.y).scale(ee[2]),Be=fe.constrain()(Se,G,be);fe.transform(xe,Be)},oe=Qo().on("zoom",N?J:null).on("zoom.wheel",w?Q:null);return U.call(oe),()=>{U.on("zoom",null)}}},[N,w,x,_]);const Y=h?U=>{const Q=Ue(U);h(U,{x:Q[0],y:Q[1]})}:void 0,W=p?(U,Q)=>{const J=b.getState().nodeInternals.get(Q);p(U,J)}:void 0;return A.createElement(Ws,{position:f,style:e,className:je(["react-flow__minimap",t]),"data-testid":"rf__minimap"},A.createElement("svg",{width:M,height:B,viewBox:`${R} ${k} ${E} ${$}`,role:"img","aria-labelledby":z,ref:I,onClick:Y},y&&A.createElement("title",{id:z},y),A.createElement(sh,{onClick:W,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:i,nodeClassName:r,nodeStrokeWidth:o,nodeComponent:c}),A.createElement("path",{className:"react-flow__minimap-mask",d:`M${R-S},${k-S}h${E+S*2}v${$+S*2}h${-E-S*2}z
        M${P.x},${P.y}h${P.width}v${P.height}h${-P.width}z`,fill:a,fillRule:"evenodd",stroke:l,strokeWidth:u,pointerEvents:"none"})))}Yi.displayName="MiniMap";var ch=v.memo(Yi);function lh(){return A.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},A.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function uh(){return A.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},A.createElement("path",{d:"M0 0h32v4.2H0z"}))}function dh(){return A.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},A.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function fh(){return A.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},A.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function hh(){return A.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},A.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const nn=({children:e,className:t,...n})=>A.createElement("button",{type:"button",className:je(["react-flow__controls-button",t]),...n},e);nn.displayName="ControlButton";const mh=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),Ui=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:s=!0,fitViewOptions:r,onZoomIn:i,onZoomOut:o,onFitView:c,onInteractiveChange:a,className:l,children:u,position:f="bottom-left"})=>{const h=Ne(),[p,N]=v.useState(!1),{isInteractive:w,minZoomReached:y,maxZoomReached:x}=he(mh,Ee),{zoomIn:_,zoomOut:j,fitView:b}=er();if(v.useEffect(()=>{N(!0)},[]),!p)return null;const I=()=>{_(),i==null||i()},T=()=>{j(),o==null||o()},P=()=>{b(r),c==null||c()},D=()=>{h.setState({nodesDraggable:!w,nodesConnectable:!w,elementsSelectable:!w}),a==null||a(!w)};return A.createElement(Ws,{className:je(["react-flow__controls",l]),position:f,style:e,"data-testid":"rf__controls"},t&&A.createElement(A.Fragment,null,A.createElement(nn,{onClick:I,className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:x},A.createElement(lh,null)),A.createElement(nn,{onClick:T,className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},A.createElement(uh,null))),n&&A.createElement(nn,{className:"react-flow__controls-fitview",onClick:P,title:"fit view","aria-label":"fit view"},A.createElement(dh,null)),s&&A.createElement(nn,{className:"react-flow__controls-interactive",onClick:D,title:"toggle interactivity","aria-label":"toggle interactivity"},w?A.createElement(hh,null):A.createElement(fh,null)),u)};Ui.displayName="Controls";var gh=v.memo(Ui),qe;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(qe||(qe={}));function ph({color:e,dimensions:t,lineWidth:n}){return A.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function xh({color:e,radius:t}){return A.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const yh={[qe.Dots]:"#91919a",[qe.Lines]:"#eee",[qe.Cross]:"#e2e2e2"},wh={[qe.Dots]:1,[qe.Lines]:1,[qe.Cross]:6},bh=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Gi({id:e,variant:t=qe.Dots,gap:n=20,size:s,lineWidth:r=1,offset:i=2,color:o,style:c,className:a}){const l=v.useRef(null),{transform:u,patternId:f}=he(bh,Ee),h=o||yh[t],p=s||wh[t],N=t===qe.Dots,w=t===qe.Cross,y=Array.isArray(n)?n:[n,n],x=[y[0]*u[2]||1,y[1]*u[2]||1],_=p*u[2],j=w?[_,_]:x,b=N?[_/i,_/i]:[j[0]/i,j[1]/i];return A.createElement("svg",{className:je(["react-flow__background",a]),style:{...c,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:l,"data-testid":"rf__background"},A.createElement("pattern",{id:f+e,x:u[0]%x[0],y:u[1]%x[1],width:x[0],height:x[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${b[0]},-${b[1]})`},N?A.createElement(xh,{color:h,radius:_/i}):A.createElement(ph,{dimensions:j,color:h,lineWidth:r})),A.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${f+e})`}))}Gi.displayName="Background";var vh=v.memo(Gi);const Jt=({data:e})=>{const t=e.color||"#fff",s=t.toLowerCase()==="#fff"||t.toLowerCase()==="#ffffff"||t.startsWith("#")&&parseInt(t.slice(1,3),16)>180?"#1f2937":"#ffffff";return d.jsxs("div",{className:"px-4 py-2 rounded-xl shadow-md border-2 min-w-[100px] text-center transition-transform hover:scale-105",style:{backgroundColor:t,borderColor:`${t}80`,direction:"rtl"},children:[d.jsx("div",{className:"font-bold text-sm",style:{color:s},children:e.label}),e.description&&d.jsx("div",{className:"text-xs mt-1 opacity-80",style:{color:s},children:e.description})]})},Nh={default:Jt,topic:Jt,subtopic:Jt,detail:Jt,example:Jt},Sh=e=>{var t;return((t=e.data)==null?void 0:t.color)||"#94a3b8"},_h=({content:e,title:t,className:n})=>{const[s]=Kf(e.nodes),[r]=Qf(e.edges),i=e.viewport||{x:0,y:0,zoom:.8},o=v.useMemo(()=>r.map(c=>({...c,style:{stroke:"#94a3b8",strokeWidth:2},animated:!1})),[r]);return d.jsxs("div",{className:`bg-gradient-to-br from-gray-50 to-blue-50 rounded-2xl border border-gray-200 overflow-hidden ${n||""}`,dir:"rtl",children:[t&&d.jsx("div",{className:"p-4 bg-white/80 border-b border-gray-200",children:d.jsxs("h3",{className:"font-bold text-lg text-gray-800 flex items-center gap-2",children:[d.jsx("span",{className:"text-2xl",children:""}),t]})}),d.jsx("div",{className:"h-[400px]",children:d.jsxs(Oi,{nodes:s,edges:o,nodeTypes:Nh,defaultViewport:i,fitView:!0,fitViewOptions:{padding:.2},panOnDrag:!0,zoomOnScroll:!0,nodesDraggable:!1,nodesConnectable:!1,elementsSelectable:!1,proOptions:{hideAttribution:!0},children:[d.jsx(gh,{showInteractive:!1,position:"bottom-left"}),d.jsx(ch,{nodeColor:Sh,maskColor:"rgba(240, 240, 240, 0.8)",position:"bottom-right",pannable:!0,zoomable:!0}),d.jsx(vh,{color:"#e0e7ff",gap:16})]})})]})},Eh=e=>d.jsx(nr,{children:d.jsx(_h,{...e})}),po={chunkText:e=>{if(!e)return[];const t=e.split(/\n+/).filter(i=>i.trim().length>0);let n=[],s=0,r=1;return t.forEach(i=>{n.push({id:r,text:i.trim(),startChar:s,endChar:s+i.length}),s+=i.length+1,r++}),n},constructSystemPrompt:(e,t)=>{const n=e.map(s=>`[${s.id}] ${s.text}`).join(`

`);return`
${t}

### INSTRUCTIONS FOR GROUNDED ANSWERS (CRITICAL):
1.  **Source Material:** You have been provided with a numbered text below.
2.  **Strict Citation Rule:** Every single claim you make MUST be followed by a citation in the format \`[X]\` where X is the chunk number.
    *   Example: "Napoleon was born in Corsica [1] and rose to power in 1799 [4]."
3.  **No Outside Knowledge:** Answer ONLY based on the text provided. If the answer is not in the text, say "I cannot find the answer in the source material."
4.  **Tone:** Be helpful and pedagogical, but strictly grounded.

### SOURCE TEXT (NUMBERED CHUNKS):
${n}
`}},jh=e=>typeof e=="string"?e:e&&typeof e=="object"&&e.text?e.text:"",xo=({data:e,userAnswer:t,onAnswer:n,onCheck:s,showFeedback:r,isReadOnly:i,isExamMode:o=!1,hints:c=[],hintsVisibleLevel:a=0,onShowHint:l,inspectorMode:u=!1})=>{const{question:f,options:h,correctAnswer:p}=e,N=v.useRef(Date.now()),w=v.useRef(0);v.useEffect(()=>{N.current=Date.now()},[f]);const y=b=>{if(!i&&(!r||o)){const I=(Date.now()-N.current)/1e3,T={timeSeconds:Math.round(I),attempts:w.current,lastAnswer:b,hintsUsed:a};n(b,T)}},x=()=>{s&&(w.current+=1,s())},_=b=>{const I=Ji(b);if(/<(p|div|span|br|strong|em|b|i|u|h[1-6]|ul|ol|li)[^>]*>/i.test(I))return d.jsx("div",{dangerouslySetInnerHTML:{__html:wo(b)}});const P=I.replace(/\[(\d+)\]/g,"[$1](#cit-$1)");return d.jsx(bo,{remarkPlugins:[vo,ta],rehypePlugins:[ea],components:{a:({node:D,href:M,children:B,...F})=>{if(M!=null&&M.startsWith("#cit-")){const O=M.replace("#cit-","");return d.jsx("button",{onClick:L=>{L.preventDefault();const g=document.getElementById(`chunk-${O}`);g&&(g.scrollIntoView({behavior:"smooth",block:"center"}),g.classList.add("bg-yellow-200"),setTimeout(()=>g.classList.remove("bg-yellow-200"),2e3))},className:"inline-flex items-center justify-center w-5 h-5 ml-1 text-[10px] font-bold text-blue-600 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100 hover:scale-110 transition-all align-middle cursor-pointer",children:B})}return d.jsx("a",{href:M,...F,children:B})},p:({children:D})=>d.jsx("p",{className:"mb-2",children:D})},children:P})};if(!h||h.length===0)return null;a>=c.length;const j=!o&&c.length>0;return d.jsxs("div",{className:`w-full ${o?"":"card-glass p-6"} transition-all duration-500`,children:[f&&d.jsx("div",{className:`font-bold text-gray-800 mb-4 text-lg has-text-content ${o?"":"animate-slide-up"}`,children:_(f)}),d.jsx("div",{className:"space-y-3",children:h.map((b,I)=>{const T=jh(b),P=t===T;let D="w-full text-right p-3.5 rounded-xl border text-sm transition-all focus:outline-none focus:ring-2 focus:ring-offset-1 ";return r?T===p?D+=o?"bg-green-50 border-green-400 text-green-900 font-bold focus:ring-green-400 ":"btn-lip-action border-green-600 bg-green-500 text-white ":P?D+="bg-red-50 border-red-300 text-red-900 focus:ring-red-300 ":D+="opacity-50 border-gray-100 bg-gray-50 text-gray-400 ":P?D+=o?"border-blue-500 bg-blue-50 shadow-sm ring-1 ring-blue-200 text-blue-900 font-medium focus:ring-blue-400 ":"btn-lip-primary ring-2 ring-offset-1 ring-blue-500 transform scale-[1.02] ":D+=o?"border-gray-200 bg-white hover:bg-gray-50 text-gray-700 focus:ring-gray-200 ":"bg-white hover:bg-gray-50 border-gray-200 text-gray-700 shadow-sm hover:-translate-y-0.5 transition-transform ",d.jsx("button",{onClick:()=>y(T),disabled:i||r&&!o,className:D,children:d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"flex-1",children:T}),r&&T===p&&d.jsx(sn,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),r&&P&&T!==p&&d.jsx(On,{className:"w-5 h-5 text-red-600 flex-shrink-0"})]})},I)})}),!o&&!r&&!i&&s&&d.jsx("div",{className:"mt-4",children:d.jsx("button",{onClick:x,disabled:!t,className:"text-sm bg-blue-600 text-white px-6 py-2 rounded-full font-bold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm",children:" "})}),j&&a>0&&d.jsx("div",{className:"mt-6 flex flex-col items-start gap-3",children:d.jsx("div",{className:"space-y-2 w-full animate-fade-in",children:c.slice(0,a).map((b,I)=>d.jsxs("div",{className:"relative bg-amber-50 border border-amber-200 p-3 pr-4 rounded-xl text-amber-900 text-sm shadow-sm flex gap-3 items-start",children:[d.jsx("span",{className:"font-bold bg-amber-200 text-amber-800 w-5 h-5 rounded-full flex items-center justify-center text-xs flex-shrink-0 mt-0.5",children:I+1}),d.jsx("span",{className:"flex-1",children:_(b)})]},I))})}),u&&d.jsx("div",{className:"absolute top-0 right-0 -mt-2 -mr-2 pointer-events-none"})]})},qi=(e,t,n=1)=>{var N,w,y,x,_;const s=[];let r=100;if(!e.content)return s.push({id:"struct-content",name:"Struct: No Content",status:"FAIL",message:"Block has no content object",scoreImpact:100}),{score:0,rules:s,blockId:e.id};if(e.type==="text"){if(t==="exam")if(n===0)s.push({id:"exam-intro",name:"Exam: Introduction",status:"PASS",message:"Introduction text allowed.",scoreImpact:0});else return s.push({id:"exam-ban-text",name:"Exam Security: Teaching Content",status:"FAIL",message:"Teaching blocks are FORBIDDEN in Exam Mode (except introduction).",scoreImpact:100}),{score:0,rules:s,blockId:e.id};const j=typeof e.content=="string"?e.content.length:0;return j>1e3?s.push({id:"ped-text-wall",name:"Pedagogy: Wall of Text",status:"WARNING",message:`Text chunk is very long (${j} chars). Consider splitting.`,scoreImpact:10}):s.push({id:"ped-text-wall",name:"Pedagogy: Text Length",status:"PASS",message:"Text length is appropriate",scoreImpact:0}),{score:Math.max(0,r-s.reduce((b,I)=>b+(I.status!=="PASS"?I.scoreImpact:0),0)),rules:s,blockId:e.id}}const i=typeof e.content=="object"&&(e.content.question||e.content.instruction)||"";if(!i||i.length<5?s.push({id:"struct-question",name:"Struct: Missing Question",status:"FAIL",message:"Question text is missing or too short",scoreImpact:20}):s.push({id:"struct-question",name:"Struct: Question Text",status:"PASS",message:"Question text exists",scoreImpact:0}),e.type==="multiple-choice"){const j=e.content.options||[];j.length<2?s.push({id:"struct-options",name:"Struct: Min Options",status:"FAIL",message:`Found only ${j.length} options. Need at least 2.`,scoreImpact:20}):s.push({id:"struct-options",name:"Struct: Options Count",status:"PASS",message:`Found ${j.length} options`,scoreImpact:0})}const o=((N=e.metadata)==null?void 0:N.progressiveHints)||[];t==="learning"?o.length===0?s.push({id:"ped-hints-learning",name:"Pedagogy: Missing Hints",status:"FAIL",message:"Learning Mode requires Progressive Hints (none found).",scoreImpact:15}):o.length<2?s.push({id:"ped-hints-count",name:"Pedagogy: Few Hints",status:"WARNING",message:`Found ${o.length} hints. Recommended: 2-3.`,scoreImpact:5}):s.push({id:"ped-hints",name:"Pedagogy: Hints",status:"PASS",message:`${o.length} hints available`,scoreImpact:0}):t==="exam"&&(o.length>0?s.push({id:"security-hints-exam",name:"Security: Hints in Exam",status:"FAIL",message:`Exam Mode found ${o.length} hints. MUST be empty.`,scoreImpact:30}):s.push({id:"security-hints",name:"Security: No Hints",status:"PASS",message:"No hints present (Correct for Exam)",scoreImpact:0}));const c=((w=e.metadata)==null?void 0:w.feedbackCorrect)||e.content.feedback,a=(y=e.metadata)==null?void 0:y.feedbackIncorrect;if(t==="learning")if(!c&&!a)s.push({id:"ped-feedback",name:"Pedagogy: Score Feedback",status:"FAIL",message:"No feedback found for Learning Mode.",scoreImpact:15});else{const j=(c||"")+(a||"");j.includes(" ")&&j.length<20?s.push({id:"ped-feedback-generic",name:"Pedagogy: Generic Feedback",status:"WARNING",message:'Feedback seems generic (" "). Add specific explanation.',scoreImpact:5}):s.push({id:"ped-feedback-quality",name:"Pedagogy: Feedback Quality",status:"PASS",message:"Feedback present",scoreImpact:0})}else if(t==="exam"){const j=["review chapter","look at section","remember that"],b=((c||"")+(a||"")).toLowerCase();j.some(I=>b.includes(I))&&s.push({id:"security-feedback-leak",name:"Security: Coaching Feedback",status:"WARNING",message:"Feedback contains coaching/teaching language in Exam Mode.",scoreImpact:10})}const l=(i+o.join(" ")).toLowerCase(),u=/\[\d+\]/.test(l);(t==="learning"||t==="exam")&&(u?s.push({id:"ped-grounding",name:"Pedagogy: Grounding",status:"PASS",message:"Content appears grounded (citations found).",scoreImpact:0}):s.push({id:"ped-grounding",name:"Pedagogy: Missing Citations",status:"WARNING",message:"No source citations ([1]) found in text.",scoreImpact:5}));const f=(x=e.metadata)==null?void 0:x.bloomLevel;f?s.push({id:"ped-bloom",name:"Pedagogy: Bloom Level",status:"PASS",message:`Classified as: ${f}`,scoreImpact:0}):s.push({id:"ped-bloom",name:"Pedagogy: Bloom Level",status:"WARNING",message:"No Bloom Level defined (Defaulting to Foundation)",scoreImpact:5});const h=(_=e.metadata)==null?void 0:_.aiValidation;h?s.push({id:"ling-audit",name:"Linguistic: Level",status:"PASS",message:`Verified Level: ${h.cefr_level} (Score: ${h.readability_score})`,scoreImpact:0}):s.push({id:"ling-audit-missing",name:"Linguistic: Missing",status:"WARNING",message:"No linguistic audit data found.",scoreImpact:5}),t==="exam"&&(f&&["knowledge","comprehension","remember","understand"].includes(f.toLowerCase())&&s.push({id:"exam-bloom-low",name:"Exam Quality: Cognitive Load",status:"WARNING",message:"Exam contains low-level questions. Prefer Analysis/Evaluation.",scoreImpact:10}),h!=null&&h.tone_audit&&!["objective","neutral","examiner"].includes(h.tone_audit.toLowerCase())&&s.push({id:"exam-tone",name:"Exam Tone: Subjective",status:"WARNING",message:`Tone detected as '${h.tone_audit}'. Exams must be Objective.`,scoreImpact:5}));const p=s.reduce((j,b)=>j+(b.status!=="PASS"?b.scoreImpact:0),0);return r=Math.max(0,100-p),{score:r,rules:s,blockId:e.id}},Ch=({blocks:e,mode:t,unitTitle:n="Unknown Unit",unitId:s="unknown"})=>{const[r,i]=A.useState(!1);if(!e||e.length===0)return null;const o=e.map((f,h)=>qi(f,t,h)),c=Math.round(o.reduce((f,h)=>f+h.score,0)/o.length),a=o.flatMap(f=>f.rules.filter(h=>h.status==="FAIL").map(h=>({blockId:f.blockId,issue:h.name})));let l="bg-gray-800";c>=90?l="bg-stone-900 border-b-4 border-green-500":c>=70?l="bg-stone-900 border-b-4 border-yellow-500":l="bg-stone-900 border-b-4 border-red-500";const u=async()=>{i(!0);const{PedagogicalTelemetry:f}=await na(async()=>{const{PedagogicalTelemetry:h}=await import("./pedagogicalTelemetry-DR_rp4p-.js");return{PedagogicalTelemetry:h}},__vite__mapDeps([0,1,2]));await f.logAuditSession(s,n,t,o),alert("     !"),i(!1)};return d.jsxs("div",{className:`fixed top-0 left-0 right-0 z-[100] ${l} text-white shadow-2xl p-2 font-mono text-xs flex items-center justify-between px-4 animate-slide-down`,children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-[10px] text-gray-400 uppercase tracking-widest",children:"Wizdi-Monitor Active"}),d.jsxs("span",{className:"font-bold text-lg flex items-center gap-2",children:[d.jsx(Hs,{className:"w-4 h-4 text-purple-400"}),"Global Audit: ",c,"%"]})]}),d.jsx("div",{className:"h-8 w-px bg-gray-700 mx-2"}),d.jsxs("div",{className:"flex gap-4",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-gray-500",children:"Mode"}),d.jsx("span",{className:"font-bold text-blue-300 uppercase",children:t})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-gray-500",children:"Blocks"}),d.jsx("span",{className:"font-bold",children:e.length})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-gray-500",children:"Issues"}),d.jsxs("span",{className:`font-bold ${a.length>0?"text-red-400 animate-pulse":"text-green-400"}`,children:[a.length," Critical"]})]})]})]}),d.jsxs("div",{className:"text-right flex items-center gap-2",children:[a.length>0&&d.jsxs("div",{className:"bg-red-900/50 px-3 py-1 rounded text-red-200 border border-red-800 flex items-center gap-2",children:[d.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),"Failures detected in ",a.length," blocks"]}),d.jsxs("div",{className:"hidden md:flex items-center gap-3 bg-gray-900/50 px-3 py-1 rounded border border-gray-700",children:[d.jsx("span",{className:"text-gray-400 text-[10px] uppercase",children:"Linguistic Audit"}),(()=>{const f=e.filter(w=>{var y;return(y=w.metadata)==null?void 0:y.aiValidation});if(f.length===0)return d.jsx("span",{className:"text-gray-500 italic",children:"No Data"});const h=Math.round(f.reduce((w,y)=>{var x,_;return w+(((_=(x=y.metadata)==null?void 0:x.aiValidation)==null?void 0:_.readability_score)||0)},0)/f.length),p=f.map(w=>{var y,x;return((x=(y=w.metadata)==null?void 0:y.aiValidation)==null?void 0:x.cefr_level)||"?"}),N=p.sort((w,y)=>p.filter(x=>x===w).length-p.filter(x=>x===y).length).pop();return d.jsxs(d.Fragment,{children:[d.jsxs("span",{className:`font-bold ${h>80?"text-green-400":"text-yellow-400"}`,children:["Score: ",h]}),d.jsx("span",{className:"w-px h-3 bg-gray-600"}),d.jsxs("span",{className:"font-bold text-blue-300",children:["Level: ",N]})]})})()]}),d.jsx("button",{onClick:u,disabled:r,className:"bg-purple-700 hover:bg-purple-600 px-3 py-1 rounded text-xs transition-colors flex items-center gap-2 disabled:opacity-50",children:r?"...":"   "}),d.jsx("button",{onClick:()=>{const f=new URL(window.location.href);f.searchParams.delete("inspector"),window.history.pushState({},"",f.toString()),window.location.reload()},className:"bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs transition-colors",children:" Close"})]})]})},Ah=({block:e,mode:t})=>{var o,c;const[n,s]=v.useState(!1),r=qi(e,t);let i="bg-green-500";return r.score<90&&(i="bg-yellow-500"),r.score<70&&(i="bg-red-500"),d.jsxs("div",{className:"relative font-mono z-50",children:[d.jsxs("button",{onClick:()=>s(!n),className:`flex items-center gap-1 px-2 py-1 rounded-full text-white text-[10px] font-bold shadow-lg transition-transform hover:scale-110 ${i}`,title:"Click for Pedagogical Analysis",children:[d.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-pulse"}),(o=e.metadata)!=null&&o.bloomLevel?d.jsx("span",{className:"bg-black/30 px-1.5 py-0.5 rounded text-[9px] mx-1 uppercase tracking-tight",children:e.metadata.bloomLevel.split(" ")[0]}):null,"WIZDI: ",r.score,"%"]}),n&&d.jsxs("div",{className:"absolute top-8 left-0 w-80 bg-gray-900 text-white rounded-xl shadow-2xl border border-gray-700 p-4 animate-fade-in text-xs z-[60]",children:[d.jsxs("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-gray-700",children:[d.jsxs("h4",{className:"font-bold flex items-center gap-2",children:[d.jsx("span",{className:`w-3 h-3 rounded-full ${i}`}),"Pedagogical Audit"]}),d.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-white",children:""})]}),((c=e.metadata)==null?void 0:c.bloomLevel)&&d.jsxs("div",{className:"mb-2 text-[10px] text-purple-300 font-bold bg-purple-900/40 px-2 py-1 rounded w-fit border border-purple-800 flex items-center gap-2",children:[d.jsx("span",{className:"text-sm",children:""}),e.metadata.bloomLevel]}),d.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto custom-scrollbar",children:r.rules.map(a=>d.jsxs("div",{className:`p-2 rounded border ${a.status==="PASS"?"border-green-900 bg-green-900/20":a.status==="WARNING"?"border-yellow-900 bg-yellow-900/20":"border-red-900 bg-red-900/20"}`,children:[d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsxs("span",{className:`font-bold ${a.status==="PASS"?"text-green-400":a.status==="WARNING"?"text-yellow-400":"text-red-400"}`,children:[a.status==="PASS"?d.jsx(sn,{className:"w-3 h-3 inline mr-1"}):d.jsx(On,{className:"w-3 h-3 inline mr-1"}),a.name]}),a.scoreImpact>0&&d.jsxs("span",{className:"text-xs text-red-500 font-bold",children:["-",a.scoreImpact]})]}),d.jsx("div",{className:"mt-1 text-gray-300 opacity-80 leading-tight",children:a.message})]},a.id))}),d.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-700 text-[10px] text-gray-500 flex justify-between",children:[d.jsxs("span",{children:["Block ID: ",e.id.substring(0,6),"..."]}),d.jsxs("span",{children:["Mode: ",t.toUpperCase()]})]})]})]})},Ih=()=>{const{gamificationProfile:e}=vs();if(!e)return null;const{level:t,xp:n,currentStreak:s,gems:r}=e,i=Math.pow(t-1,2)*100,c=Math.pow(t,2)*100-i,a=n-i,l=Math.min(100,Math.max(0,a/c*100));return d.jsx("div",{className:"fixed top-4 left-4 z-50 flex flex-col gap-3 animate-slide-in-left pointer-events-none select-none",children:d.jsxs("div",{className:"bg-white/90 backdrop-blur-md p-3 rounded-2xl shadow-xl border border-indigo-50 flex items-center gap-4 hover:scale-105 transition-transform duration-300 pointer-events-auto",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg transform rotate-3 border-2 border-white",children:t}),d.jsx("div",{className:"absolute -bottom-2 -right-2 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-1.5 py-0.5 rounded-full border border-white shadow-sm",children:"LVL"})]}),d.jsxs("div",{className:"flex flex-col gap-1 min-w-[100px]",children:[d.jsxs("div",{className:"flex justify-between items-center text-xs font-bold text-gray-400",children:[d.jsx("span",{children:"XP"}),d.jsxs("span",{children:[Math.floor(l),"%"]})]}),d.jsx("div",{className:"w-28 h-2.5 bg-gray-100 rounded-full overflow-hidden border border-gray-200",children:d.jsx("div",{className:"h-full bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full transition-all duration-1000 ease-out",style:{width:`${l}%`}})})]}),s>0&&d.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-100 pr-4 mr-1",children:[d.jsx("div",{className:"text-xl animate-bounce-slow",children:""}),d.jsxs("div",{className:"text-xs font-black text-orange-500",children:[s," "]})]}),r>0&&d.jsxs("div",{className:"flex items-center gap-1 bg-indigo-50 px-2 py-1 rounded-lg border border-indigo-100",children:[d.jsx(Hs,{className:"w-3 h-3 text-indigo-400"}),d.jsx("span",{className:"text-xs font-bold text-indigo-700",children:r})]})]})})},yo=e=>typeof e=="string"?e:typeof e=="object"&&(e!=null&&e.answer)?e.answer:"",Mh=({block:e,context:t,forcedHistory:n,readOnly:s=!1})=>{const[r,i]=v.useState([]),[o,c]=v.useState(""),[a,l]=v.useState(!1),u=v.useRef(null);v.useEffect(()=>{var h;if(n&&n.length>0){const p=n.map(N=>({role:N.role,text:N.parts}));i(p)}else(h=e.metadata)!=null&&h.initialMessage&&r.length===0&&i([{role:"model",text:e.metadata.initialMessage}])},[e,n]),v.useEffect(()=>{!s&&u.current&&(u.current.scrollTop=u.current.scrollHeight)},[r,s]);const f=async()=>{var p,N,w;if(!o.trim()||s)return;const h=o;i(y=>[...y,{role:"user",text:h}]),c(""),l(!0);try{const y=" :",x=((p=e.metadata)==null?void 0:p.systemPrompt)||" ",_=po.chunkText(t.unitContent),j=po.constructSystemPrompt(_,x),b=': "'+t.unitTitle+'".',I=[y,j,b].join(`
`),T=r.map(M=>({role:M.role==="model"?"assistant":"user",content:M.text})),D=((w=(N=(await Sa.chat.completions.create({model:_a,messages:[{role:"system",content:I},...T,{role:"user",content:h}]})).choices[0])==null?void 0:N.message)==null?void 0:w.content)||"  (No content).";i(M=>[...M,{role:"model",text:D}])}catch(y){console.error("Bot Communication Error (OpenAI):",y),i(x=>[...x,{role:"model",text:",     .     ."}])}finally{l(!1)}};return d.jsxs("div",{className:"mb-8 glass border border-purple-100/50 rounded-2xl overflow-hidden shadow-sm bg-white/60 backdrop-blur-md",children:[d.jsxs("div",{className:"p-4 text-white flex items-center gap-3 shadow-sm "+(s?"bg-slate-700":"bg-gradient-to-r from-purple-600/90 to-indigo-600/90"),children:[d.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:d.jsx(So,{className:"w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg",children:e.type==="interactive-chat"&&e.content.title||" "}),d.jsx("p",{className:"text-xs opacity-90",children:s?"  ( )":"  "})]})]}),d.jsxs("div",{ref:u,className:"h-96 overflow-y-auto p-4 bg-gray-50/50 space-y-4 scrollbar-thin scrollbar-thumb-gray-300",children:[r.length===0&&s&&d.jsx("div",{className:"text-center text-gray-400 mt-20",children:"  ."}),r.map((h,p)=>d.jsx("div",{className:"flex "+(h.role==="user"?"justify-end":"justify-start"),children:d.jsxs("div",{className:"max-w-[85%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm "+(h.role==="user"?"bg-indigo-600 text-white rounded-br-none":"bg-white border border-gray-100 text-gray-800 rounded-bl-none"),children:[s&&d.jsx("div",{className:"text-[10px] opacity-50 mb-1",children:h.role==="user"?"":""}),d.jsx("div",{className:"prose prose-sm max-w-none prose-p:my-0 prose-ul:my-0 prose-li:my-0 text-inherit",children:d.jsx("div",{className:"prose prose-sm max-w-none prose-p:my-0 prose-ul:my-0 prose-li:my-0 text-inherit",children:d.jsx(bo,{remarkPlugins:[vo],components:{a:({node:N,href:w,children:y,...x})=>{if(w!=null&&w.startsWith("#cit-")){const _=w.replace("#cit-","");return d.jsx("button",{onClick:()=>{const j=document.getElementById(`chunk-${_}`);j?(j.scrollIntoView({behavior:"smooth",block:"center"}),j.classList.add("bg-yellow-200"),setTimeout(()=>j.classList.remove("bg-yellow-200"),2e3)):console.log("Jump to citation:",_)},className:"inline-flex items-center justify-center w-5 h-5 ml-1 text-[10px] font-bold text-blue-600 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100 hover:scale-110 transition-all align-middle",children:y})}return d.jsx("a",{href:w,...x,children:y})}},children:h.text.replace(/\[(\d+)\]/g,"[$1](#cit-$1)")})})})]})},p)),a&&d.jsx("div",{className:"text-xs text-gray-400 animate-pulse mr-2",children:"..."})]}),!s&&d.jsxs("div",{className:"p-3 bg-white/80 border-t flex gap-2 backdrop-blur",children:[d.jsx("input",{type:"text",value:o,onChange:h=>c(h.target.value),onKeyDown:h=>h.key==="Enter"&&f(),placeholder:" ...",className:"flex-1 p-3 border border-gray-200 rounded-full text-sm outline-none focus:border-indigo-500"}),d.jsx("button",{onClick:f,disabled:a||!o.trim(),className:"bg-indigo-600 text-white w-12 h-12 rounded-full flex items-center justify-center hover:bg-indigo-700 shadow-md",children:d.jsx(No,{className:"w-5 h-5 rotate-180"})})]})]})},Th=({assignment:e,reviewMode:t=!1,studentData:n,onExitReview:s,forcedUnitId:r,unitOverride:i,hideReviewHeader:o=!1,simulateGuest:c=!1})=>{var xn,yn,wn,bn,vn,Nn,Sn,_n;const{course:a}=vs(),{currentUser:l}=sa(),[u,f]=v.useState(null),[h,p]=v.useState(r||null),[N,w]=v.useState(!1),[y,x]=v.useState(()=>{var m;return((m=e==null?void 0:e.activeSubmission)==null?void 0:m.answers)||{}}),[_,j]=v.useState({}),[b,I]=v.useState({}),T=v.useRef(e==null?void 0:e.id);v.useEffect(()=>{var m;e!=null&&e.id&&e.id!==T.current&&(x(((m=e==null?void 0:e.activeSubmission)==null?void 0:m.answers)||{}),T.current=e.id)},[e==null?void 0:e.id]),v.useEffect(()=>{if(!a||!y||Object.keys(b).length>0)return;const m={};let X=!1;a.syllabus.forEach(V=>{V.learningUnits.forEach(K=>{var le;(le=K.activityBlocks)==null||le.forEach(ae=>{const ue=y[ae.id];if(ue!=null&&ue!==""){let ge=!1,we=0;const Te=["multiple-choice","cloze","ordering","categorization","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","matrix"].includes(ae.type);ae.type==="open-question"?typeof ue=="object"&&ue.provisional_score!==void 0&&(we=ue.provisional_score,ge=we>0):Te&&(ge=ue===ae.content.correctAnswer,we=ge?Er.CORRECT_FIRST_TRY:0),(we>0||ge||ue)&&(m[ae.id]={attempts:1,hintsUsed:0,isCorrect:ge,responseTimeSec:0,score:we},X=!0)}})})}),X&&I(V=>({...V,...m}))},[a,y,b]);const[P,D]=v.useState({}),[M,B]=v.useState({}),[F,O]=v.useState({}),[L,g]=v.useState({}),[C,S]=v.useState(null),[R,k]=v.useState(null),[E,$]=v.useState(0),z=v.useRef(null),H=v.useRef([]),Y=v.useRef(null),[W,U]=v.useState((l==null?void 0:l.displayName)||""),[Q,J]=v.useState(!!(l!=null&&l.displayName)),[oe,ie]=v.useState(!1),[ee,xe]=v.useState(!1);v.useEffect(()=>{if(!(e!=null&&e.id))return;const m=`wizdi_submitted_${e.id}`,X=sessionStorage.getItem(m);if(X)try{const{submitted:V,score:K,name:le}=JSON.parse(X);V&&xe(!0)}catch(V){console.error("Storage parse error",V)}},[e==null?void 0:e.id]),v.useEffect(()=>{if(ee&&(e!=null&&e.id)){const m=`wizdi_submitted_${e.id}`;sessionStorage.setItem(m,JSON.stringify({submitted:!0,score:Oe(),name:W,timestamp:Date.now()}))}},[ee,e==null?void 0:e.id]);const[fe,be]=v.useState(!1),ye=v.useRef(!1);v.useEffect(()=>(a!=null&&a.id&&(a!=null&&a.showSourceToStudent)&&(a!=null&&a.fullBookContent)&&!ye.current&&(be(!0),ye.current=!0),()=>{a!=null&&a.id&&(ye.current=!1)}),[a==null?void 0:a.id,a==null?void 0:a.showSourceToStudent,!!(a!=null&&a.fullBookContent)]);const[de,Ce]=v.useState(!1),[ce,G]=v.useState(!1);v.useEffect(()=>{const m=new URLSearchParams(window.location.search);m.get("inspector")==="true"&&Ce(!0),m.get("forceExam")==="true"&&(G(!0),console.warn(" Force Exam Mode Active via URL Parameter"))},[]),v.useEffect(()=>{a&&console.log(" Course Data Loaded:",{id:a.id,title:a.title,mode:a.mode,syllabus:a.syllabus})},[a]);const[Se,Be]=v.useState(0),[vt,rt]=v.useState([]),Fe=ra(),{triggerXp:Ve,course:Ke}=vs(),Qe=m=>{rt(V=>[...V,{id:Date.now(),amount:m}]),Be(V=>V+1),setTimeout(()=>rt(V=>V.slice(1)),2e3),((Ke==null?void 0:Ke.mode)||"learning")!=="exam"&&Ve(m,"Activity Completion")};v.useEffect(()=>{var m,X;if(!N&&!h&&((m=a==null?void 0:a.syllabus)==null?void 0:m.length)>0){const V=a.syllabus[0];V&&((X=V.learningUnits)==null?void 0:X.length)>0&&(f(V.id),p(V.learningUnits[0].id),w(!0))}},[a,h,N]),v.useEffect(()=>{e?c?(console.log(" Guest Simulation Active: Ignoring Current User"),J(!1),U("")):l!=null&&l.displayName?(U(l.displayName),J(!0)):(J(!1),U("")):J(!0)},[e==null?void 0:e.id,l,c]),v.useEffect(()=>()=>{Y.current&&clearInterval(Y.current),z.current&&z.current.state==="recording"&&z.current.stop()},[]);const ot=async m=>{try{const X=await navigator.mediaDevices.getUserMedia({audio:!0});z.current=new MediaRecorder(X),H.current=[],z.current.ondataavailable=V=>{H.current.push(V.data)},z.current.onstop=async()=>{k(null),$(0),clearInterval(Y.current);const V=new Blob(H.current,{type:"audio/webm"}),K=yo(y[m]);console.log("Transcribing audio..."),Ae(m,K+(K?`
`:"")+"[ ...]");const le=await va(V),ae=y[m]||"";Ae(m,ue=>{const ge=ue.replace(`
[ ...]`,"").replace("[ ...]","");return le?ge+(ge?" ":"")+le:ge}),le||alert(" .   .")},z.current.start(),k(m),$(0),Y.current=setInterval(()=>{$(V=>V>=60?(it(),60):V+1)},1e3)}catch(X){console.error("Mic Error:",X),alert("   .    .")}},it=()=>{z.current&&z.current.state==="recording"&&z.current.stop()},re=ce||(a==null?void 0:a.mode)==="exam",Ae=(m,X)=>{ee&&re||x(typeof X=="function"?V=>({...V,[m]:X(V[m]||"")}):V=>({...V,[m]:X}))},_e=(m,X,V)=>{Ae(m,X),j(K=>({...K,[m]:V}))},Ie=async m=>{var Te,et,tt;const X=(Te=te==null?void 0:te.activityBlocks)==null?void 0:Te.find(se=>se.id===m);if(!X)return;const K=(b[m]||{attempts:0}).attempts+1,le=M[m]||0;if(X.type==="open-question"){const se=y[m];if(!se||typeof se=="string"&&se.trim().length<2){alert("     .");return}S(m);try{const $e=(a==null?void 0:a.fullBookContent)||"",me=typeof se=="object"?se.answer:se,ve=await Na(X.content.question,me,((et=X.metadata)==null?void 0:et.modelAnswer)||"TBD",$e,re?"exam":"learning");g(De=>({...De,[m]:ve})),D(De=>({...De,[m]:!0}));let Ye=us.INCORRECT;ve.status==="correct"&&(Ye=us.CORRECT),ve.status==="partial"&&(Ye=us.PARTIAL);const mt={attempts:K,hintsUsed:le,isCorrect:ve.status==="correct",responseTimeSec:0,score:Ye};I(De=>({...De,[m]:mt})),Ae(m,{answer:me,provisional_score:Ye,feedback:ve}),!re&&ve.status==="correct"?(Qe(le>0?50:100),Fe("success")):!re&&ve.status}catch($e){console.error("Tutor check failed",$e),D(me=>({...me,[m]:!0}))}finally{S(null)}return}const ae=y[m]===X.content.correctAnswer,ue=Er.MAX_ATTEMPTS,ge=((tt=X.metadata)==null?void 0:tt.progressiveHints)||[];ae||O(se=>({...se,[m]:(se[m]||0)+1}));const we={attempts:K,hintsUsed:le,isCorrect:ae,responseTimeSec:0,score:0};if(we.score=Ea(we),I(se=>({...se,[m]:we})),re)D(se=>({...se,[m]:!0}));else if(ae)D(se=>({...se,[m]:!0})),Qe(le>0?50:100),Fe("success");else if(K>=ue)D(se=>({...se,[m]:!0})),Fe("failure"),ge.length>0&&B(se=>({...se,[m]:ge.length}));else{Fe("failure");const se=M[m]||0;se<ge.length&&B($e=>({...$e,[m]:se+1})),x($e=>({...$e,[m]:void 0}))}},Je=m=>{const X=(M[m]||0)+1;B(V=>({...V,[m]:X})),j(V=>{const K=V[m]||{timeSeconds:0,attempts:0,hintsUsed:0,lastAnswer:null,events:[]};return{...V,[m]:{...K,hintsUsed:X,events:[...K.events||[],{event:"HINT_REVEALED",level:X,timestamp:Date.now()}]}}})},Oe=()=>{if(!a)return 0;let m=0,X=0;return a.syllabus.forEach(V=>{V.learningUnits.forEach(K=>{var le;(le=K.activityBlocks)==null||le.forEach(ae=>{var we,Te,et,tt;if(["multiple-choice","cloze","ordering","categorization","open-question","memory_game","audio-response","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","rating_scale","matrix"].includes(ae.type)||((we=ae.metadata)==null?void 0:we.relatedQuestion)){const se=((Te=ae.metadata)==null?void 0:Te.score)||10;m+=se;const $e=b[ae.id];if($e)X+=$e.score/100*se;else if(re){const me=y[ae.id];ae.type==="multiple-choice"?me===ae.content.correctAnswer&&(X+=se):ae.type==="fill_in_blanks"&&me&&me.score!==void 0&&(X+=me.score/100*se)}else{const me=y[ae.id];if(me&&typeof me=="string"&&me.startsWith("Score: ")){const ve=parseInt(me.replace("Score: ",""))||0;X+=ve/100*se}else if(me&&typeof me=="object"&&typeof me.score=="number"){const ve=me.score;X+=ve/100*se}}if((tt=(et=ae.metadata)==null?void 0:et.relatedQuestion)!=null&&tt.correctAnswer){m+=10;const ve=ae.id+"_related",Ye=y[ve],mt=ae.metadata.relatedQuestion.correctAnswer;if(Ye===mt){const De=b[ve];De?X+=De.score/100*10:X+=10}}}})})}),m===0?0:Math.round(X/m*100)},at=()=>{if(!u||!h||!a)return;const m=a.syllabus.findIndex(K=>K.id===u),X=a.syllabus[m],V=X.learningUnits.findIndex(K=>K.id===h);if(V<X.learningUnits.length-1){p(X.learningUnits[V+1].id),window.scrollTo(0,0);return}if(m<a.syllabus.length-1){const K=a.syllabus[m+1];if(K.learningUnits.length>0){f(K.id),p(K.learningUnits[0].id),window.scrollTo(0,0);return}}p(null)},Me=(m,X,V)=>{x(K=>({...K,[m]:{score:X,completed:!0}})),V&&j(K=>({...K,[m]:V}))};v.useEffect(()=>()=>{},[]);const Pe=async m=>{var ae;if(m&&(m.preventDefault(),m.stopPropagation()),console.log(" handleSubmit CLICKED!"),console.log("Current State:",{assignment:e,studentName:W,isNameConfirmed:Q,userAnswers:y}),!e){console.warn("No assignment found - Preview mode?"),alert("   -    . (  ''   )");return}if(!W||W.trim().length===0){console.warn("Student name missing!",W),alert("  .      ."),J(!1);return}let X=0,V=0;(ae=a==null?void 0:a.syllabus)==null||ae.forEach(ue=>{ue.learningUnits.forEach(ge=>{var we;(we=ge.activityBlocks)==null||we.forEach(Te=>{["multiple-choice","cloze","ordering","categorization","open-question","memory_game","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","rating_scale","matrix"].includes(Te.type)&&(X++,y[Te.id]&&V++)})})}),console.log(" Submission Validation:",{totalQuestions:X,answeredCount:V});const K=V>=X;let le="      ?";if(K?le+=`

     .`:le=`  :    ${V}  ${X} .

     ?`,!!window.confirm(le)){ie(!0);try{const ue=Oe();if(console.log("Calculated Score:",ue),!e.id||!a.id)throw new Error(`Missing IDs: Asst=${e.id}, Course=${a.id}`);const ge=await ba({assignmentId:e.id,courseId:a.id,studentName:W,answers:y,score:ue,courseTopic:a.title,telemetry:_});console.log("Submission Result:",ge),xe(!0)}catch(ue){console.error("Submission Failed:",ue),alert(`  :
`+ue.message),ie(!1)}}},Nt=async()=>{if(t){s&&s();return}at()},$t=(m,X)=>{if(!X||!X.question)return null;const V=m+"_related",K=t||P[V]&&!re;return d.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 bg-blue-50/50 p-4 rounded-xl",children:[d.jsx("div",{className:"text-xs font-bold text-blue-600 mb-2 uppercase tracking-wide",children:" "}),d.jsx("h4",{className:"font-bold text-gray-800 mb-3 text-sm",children:X.question}),X.type==="multiple-choice"&&d.jsx(xo,{data:X,userAnswer:y[V],onAnswer:le=>Ae(V,le),onCheck:()=>Ie(V),showFeedback:K,isReadOnly:t||K&&!re,isExamMode:re,hintsVisibleLevel:M[V]||0}),X.type==="open-question"&&d.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-lg text-sm focus:border-blue-400 outline-none bg-white",value:typeof y[V]=="object"?y[V].answer:y[V]||"",onChange:le=>Ae(V,le.target.value),readOnly:t,placeholder:t?"  ":"   ...",rows:2})]})},St=m=>m.includes("youtube.com")||m.includes("youtu.be")||m.includes("vimeo")||m.includes("/embed/"),Xe=m=>St(m)?d.jsx("iframe",{src:m,className:"w-full h-48 md:h-64 bg-black",title:"Video",allowFullScreen:!0}):d.jsx("video",{src:m,controls:!0,className:"w-full h-48 md:h-64 bg-black"}),pn=m=>{var le;const X=(le=m.metadata)==null?void 0:le.progressiveHints;if(!X||X.length===0||re||t)return null;const V=M[m.id]||0,K=V>=X.length;return d.jsxs("div",{className:"mt-4 flex flex-col items-start gap-2",children:[d.jsxs("button",{onClick:()=>Je(m.id),disabled:K,className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-bold transition-all ${K?"bg-gray-100 text-gray-400 cursor-default":"bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200 shadow-sm"}`,children:[d.jsx(Hs,{className:"w-4 h-4"}),V===0?" ":K?"  ":" "]}),V>0&&d.jsx("div",{className:"space-y-2 w-full max-w-md animate-fade-in mt-2",children:X.slice(0,V).map((ae,ue)=>d.jsxs("div",{className:"relative bg-amber-50 border border-amber-200 p-3 pr-4 rounded-xl text-amber-900 text-sm shadow-sm flex gap-3 items-start",children:[d.jsx("span",{className:"font-bold bg-amber-200 text-amber-800 w-5 h-5 rounded-full flex items-center justify-center text-xs flex-shrink-0 mt-0.5",children:ue+1}),d.jsx("span",{className:"flex-1",children:ae})]},ue))})]})},ct=m=>{var K,le,ae,ue,ge,we,Te,et,tt,se,$e,me,ve,Ye,mt,De,Ut,En,jn,Cn,Rt,rr,or,ir,ar,cr,lr,ur,dr,fr,hr,mr,gr,pr,xr,yr;const X=()=>{var An,In;const zt=m.content;return typeof zt=="string"&&zt.startsWith("http")?zt:(An=m.metadata)!=null&&An.uploadedFileUrl?m.metadata.uploadedFileUrl:(In=m.metadata)!=null&&In.media?m.metadata.media:null},V=X();switch(m.type){case"loading-placeholder":{const q=m.content;return d.jsxs("div",{className:"mb-6 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl border-2 border-dashed border-blue-200 animate-pulse",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center text-blue-600 font-bold",children:(q==null?void 0:q.stepNumber)||"?"}),d.jsx("span",{className:"text-blue-700 font-medium",children:(q==null?void 0:q.title)||"..."})]}),d.jsxs("div",{className:"flex items-center gap-2 text-blue-500",children:[d.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[d.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),d.jsx("span",{children:(q==null?void 0:q.message)||" ..."})]})]},m.id)}case"text":{const q=typeof m.content=="string"?m.content:((K=m.content)==null?void 0:K.teach_content)||((le=m.content)==null?void 0:le.text)||"",Re=/<(div|p|h[1-6]|ul|ol|li|strong|em|span|br|table|tr|td|th)[^>]*>/i.test(q),_t=/\*\*[^*]+\*\*|\*[^*]+\*/.test(q);return Re||_t?d.jsx("div",{className:"prose max-w-none text-gray-800 mb-8 glass bg-white/70 p-6 rounded-2xl teacher-lesson-content",children:d.jsx("div",{dangerouslySetInnerHTML:{__html:wa(q)}})},m.id):d.jsx("div",{className:"prose max-w-none text-gray-800 mb-8 glass bg-white/70 p-6 rounded-2xl",children:q.split(`
`).map((br,Ki)=>br.startsWith("#")?null:d.jsx("p",{className:"mb-2",children:br},Ki))},m.id)}case"image":return V?d.jsxs("div",{className:"mb-8 p-1 bg-white border border-gray-100 rounded-2xl shadow-sm",children:[d.jsx("img",{src:V,className:"w-full rounded-xl",alt:" ",loading:"lazy",decoding:"async"}),((ae=m.metadata)==null?void 0:ae.caption)&&d.jsx("div",{className:"text-center text-sm text-gray-500 mt-2 pb-2 italic font-medium px-4",children:m.metadata.caption}),((ue=m.metadata)==null?void 0:ue.relatedQuestion)&&$t(m.id,m.metadata.relatedQuestion)]},m.id):null;case"video":return V?d.jsxs("div",{className:"mb-8 p-1 bg-white border border-gray-100 rounded-2xl shadow-sm",children:[d.jsx("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:Xe(V)}),((ge=m.metadata)==null?void 0:ge.caption)&&d.jsx("div",{className:"text-center text-sm text-gray-500 mt-2 pb-2 italic font-medium px-4",children:m.metadata.caption}),((we=m.metadata)==null?void 0:we.relatedQuestion)&&$t(m.id,m.metadata.relatedQuestion)]},m.id):null;case"podcast":return d.jsxs("div",{className:"mb-0",children:[d.jsx(ya,{title:m.content.title||"  ",script:m.content.script||null,initialAudioUrl:m.content.audioUrl,onAudioGenerated:q=>{Ae(m.id,{audioUrl:q})}}),!re&&d.jsx("div",{className:"flex justify-start mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id);case"interactive-chat":return d.jsx(Mh,{block:m,context:{unitTitle:(te==null?void 0:te.title)||"",unitContent:""},forcedHistory:t?n==null?void 0:n.chatHistory:void 0,readOnly:t},m.id);case"mindmap":return d.jsxs("div",{className:"mb-8",children:[d.jsx(Eh,{content:m.content,title:m.content.title||" ",className:"shadow-lg"}),!re&&d.jsx("div",{className:"flex justify-start mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id);case"infographic":const zt=typeof m.content=="string"?m.content:((Te=m.content)==null?void 0:Te.imageUrl)||((et=m.metadata)==null?void 0:et.uploadedFileUrl)||"",An=typeof m.content=="object"?(tt=m.content)==null?void 0:tt.title:void 0,In=typeof m.content=="object"?(se=m.content)==null?void 0:se.caption:($e=m.metadata)==null?void 0:$e.caption,Zi=((me=m.metadata)==null?void 0:me.infographicType)||(typeof m.content=="object"?(ve=m.content)==null?void 0:ve.visualType:void 0);return zt?d.jsxs("div",{className:"mb-8",children:[d.jsx(xa,{src:zt,title:An,caption:In,infographicType:Zi}),!re&&d.jsx("div",{className:"flex justify-start mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id):null;case"activity-intro":{const q=m.content;return q!=null&&q.imageUrl?d.jsx("div",{className:"mb-8",children:d.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg bg-gray-50",children:d.jsx("img",{src:q.imageUrl,alt:q.title||" ",className:"w-full max-h-[500px] object-contain",loading:"lazy",decoding:"async"})})},m.id):null}case"scenario-image":{const q=m.content;return q!=null&&q.imageUrl?d.jsx("div",{className:"mb-6",children:d.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 shadow-sm",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3 text-amber-700",children:[d.jsx("span",{className:"text-xl",children:""}),d.jsx("span",{className:"font-medium",children:" :"})]}),d.jsx("img",{src:q.imageUrl,alt:q.caption||" ",className:"w-full max-h-72 object-contain rounded-xl bg-white",loading:"lazy",decoding:"async"}),q.caption&&d.jsx("p",{className:"mt-3 text-center text-amber-800 font-medium",children:q.caption})]})},m.id):null}case"multiple-choice":const cs=X(),wr=t||P[m.id]&&!re;return d.jsxs("div",{className:"mb-8",children:[cs&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden max-w-xl mx-auto",children:((Ye=m.metadata)==null?void 0:Ye.mediaType)==="video"?Xe(cs):d.jsx("img",{src:cs,alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsx(xo,{data:m.content,userAnswer:y[m.id],onAnswer:(q,Re)=>Re&&_e(m.id,q,Re),onCheck:()=>Ie(m.id),showFeedback:wr,isReadOnly:t||wr&&!re,isExamMode:re,hints:(mt=m.metadata)==null?void 0:mt.progressiveHints,hintsVisibleLevel:M[m.id]||0,onShowHint:()=>Je(m.id),inspectorMode:de}),de&&d.jsx(Ah,{block:m,mode:(a==null?void 0:a.mode)||"learning"}),y[m.id]&&!re&&d.jsx("div",{className:"flex justify-start mt-2",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id);case"open-question":return d.jsxs("div",{className:"mb-8 glass bg-indigo-50/50 p-6 rounded-2xl",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"bg-indigo-100 p-2 rounded-lg",children:d.jsx(ga,{className:"w-5 h-5 text-indigo-600"})}),d.jsx("h3",{className:"text-xl font-bold text-gray-800",children:" "})]}),d.jsx("div",{className:"mb-4 text-lg font-medium text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:_r(m.content.question||"")}}),X()&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden",children:((De=m.metadata)==null?void 0:De.mediaType)==="video"?Xe(X()):d.jsx("img",{src:X(),alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsxs("div",{className:"relative",children:[d.jsx("textarea",{value:yo(y[m.id]),onChange:q=>Ae(m.id,q.target.value),placeholder:t?"  ":"   ... (  )",rows:4,className:"w-full p-4 border rounded-xl outline-none transition-colors "+(t||P[m.id]?"bg-gray-50 text-gray-600 border-gray-200":"bg-white focus:border-indigo-300"),disabled:t||P[m.id]}),!t&&!P[m.id]&&d.jsx("div",{className:"absolute bottom-3 left-3 flex items-center gap-2",children:R===m.id?d.jsxs("div",{className:"flex items-center gap-2 bg-red-50 border border-red-200 text-red-600 px-3 py-1.5 rounded-full animate-pulse",children:[d.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full animate-ping"}),d.jsxs("span",{className:"text-xs font-mono font-bold",children:[E,"s / 60s"]}),d.jsx("button",{onClick:it,className:"text-xs font-bold underline hover:text-red-800",children:""})]}):d.jsx("button",{onClick:()=>ot(m.id),className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-all",title:"  ",children:d.jsx(pa,{className:"w-5 h-5"})})})]}),!re&&!t&&d.jsx("div",{className:"mt-4",children:P[m.id]?d.jsxs("div",{className:"p-4 rounded-xl animate-fade-in border "+(((Ut=L[m.id])==null?void 0:Ut.status)==="correct"?"bg-green-50 border-green-200":((En=L[m.id])==null?void 0:En.status)==="partial"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:[d.jsxs("div",{className:"text-xs font-bold mb-1 flex items-center gap-1 "+(((jn=L[m.id])==null?void 0:jn.status)==="correct"?"text-green-700":((Cn=L[m.id])==null?void 0:Cn.status)==="partial"?"text-yellow-700":"text-red-700"),children:[d.jsx(So,{className:"w-4 h-4"}),((Rt=L[m.id])==null?void 0:Rt.status)==="correct"?" !":((rr=L[m.id])==null?void 0:rr.status)==="partial"?" ...":" ..."]}),d.jsx("div",{className:"text-sm text-gray-800 leading-relaxed whitespace-pre-wrap",children:((or=L[m.id])==null?void 0:or.feedback)||" ."}),((ir=L[m.id])==null?void 0:ir.status)!=="correct"&&d.jsx("button",{onClick:()=>D(q=>({...q,[m.id]:!1})),className:"mt-3 text-xs font-bold underline opacity-70 hover:opacity-100",children:"   "})]}):d.jsx("button",{onClick:()=>Ie(m.id),disabled:C===m.id,className:"text-blue-600 font-bold text-sm hover:underline flex items-center gap-2",children:C===m.id?d.jsxs(d.Fragment,{children:[d.jsx(vr,{className:"w-4 h-4 animate-spin"})," ..."]}):" "})}),t&&((ar=m.metadata)==null?void 0:ar.modelAnswer)&&d.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-xl",children:[d.jsxs("div",{className:"text-xs font-bold text-yellow-700 mb-1 flex items-center gap-1",children:[d.jsx(Nr,{className:"w-3 h-3"}),"   /  :"]}),d.jsx("div",{className:"text-sm text-yellow-900 leading-relaxed",dangerouslySetInnerHTML:{__html:wo(m.metadata.modelAnswer)}})]}),pn(m),y[m.id]&&!re&&d.jsx("div",{className:"flex justify-start mt-4 border-t border-indigo-100 pt-2",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id);case"fill_in_blanks":{const q=V;return d.jsxs("div",{className:"mb-8",children:[q&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden max-w-xl mx-auto",children:((cr=m.metadata)==null?void 0:cr.mediaType)==="video"?Xe(q):d.jsx("img",{src:q,alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsx(ma,{block:m,onComplete:(Re,_t)=>Me(m.id,Re,_t)}),(((lr=y[m.id])==null?void 0:lr.completed)||((ur=y[m.id])==null?void 0:ur.score)!==void 0)&&!re&&d.jsx("div",{className:"flex justify-center mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id)}case"ordering":{const q=V;return d.jsxs("div",{className:"mb-8",children:[q&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden max-w-xl mx-auto",children:((dr=m.metadata)==null?void 0:dr.mediaType)==="video"?Xe(q):d.jsx("img",{src:q,alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsx(ha,{block:m,onComplete:(Re,_t)=>Me(m.id,Re,_t)}),(((fr=y[m.id])==null?void 0:fr.completed)||((hr=y[m.id])==null?void 0:hr.score)!==void 0)&&!re&&d.jsx("div",{className:"flex justify-center mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id)}case"categorization":{const q=V;return d.jsxs("div",{className:"mb-4",children:[re&&d.jsx("div",{className:"flex justify-between items-center mb-2",children:d.jsxs("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded",children:[((mr=m.metadata)==null?void 0:mr.score)||10," "]})}),m.content.question&&d.jsx("p",{className:"text-lg text-indigo-800 dark:text-white/90 mb-6 text-right font-bold",dangerouslySetInnerHTML:{__html:_r(m.content.question)}}),q&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden max-w-2xl mx-auto",children:((gr=m.metadata)==null?void 0:gr.mediaType)==="video"?Xe(q):d.jsx("img",{src:q,alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsx(fa,{block:m,onComplete:(Re,_t)=>Me(m.id,Re,_t)}),(((pr=y[m.id])==null?void 0:pr.completed)||((xr=y[m.id])==null?void 0:xr.score)!==void 0)&&!re&&d.jsx("div",{className:"flex justify-center mt-4",children:d.jsx(gt,{courseId:a==null?void 0:a.id,unitId:(te==null?void 0:te.id)||"unknown",blockId:m.id,blockType:m.type,userId:(l==null?void 0:l.uid)||"anonymous"})})]},m.id)}case"memory_game":const ls=V;return d.jsxs("div",{className:"mb-8",children:[ls&&d.jsx("div",{className:"mb-4 rounded-xl overflow-hidden max-w-3xl mx-auto",children:((yr=m.metadata)==null?void 0:yr.mediaType)==="video"?Xe(ls):d.jsx("img",{src:ls,alt:" ",className:"w-full max-h-[300px] object-contain bg-gray-50 rounded-lg",loading:"lazy",decoding:"async"})}),d.jsx(da,{block:m,onComplete:(q,Re)=>Me(m.id,q,Re)})]},m.id);case"matching":return d.jsx("div",{className:"mb-8",children:d.jsx(ua,{block:m,onComplete:(q,Re)=>Me(m.id,q,Re)})},m.id);case"audio-response":return d.jsx("div",{className:"mb-8",children:d.jsx(la,{block:m,onAnswer:q=>Ae(m.id,q),userAnswer:y[m.id],isReadOnly:ee})},m.id);default:return null}},We=(xn=a==null?void 0:a.syllabus)==null?void 0:xn.find(m=>m.id===u),te=i||((yn=We==null?void 0:We.learningUnits)==null?void 0:yn.find(m=>m.id===h)),as=e!=null&&e.score?`: ${e.score}`:"";if(!(i||a&&a.id!=="loading"))return d.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 text-gray-500",children:[d.jsx(vr,{className:"w-12 h-12 animate-spin text-blue-600 mb-4"}),d.jsx("p",{className:"font-bold text-lg animate-pulse",children:"  ..."}),d.jsx("p",{className:"text-sm opacity-70 mt-2",children:"   "})]});const Yt=(bn=(wn=a==null?void 0:a.wizardData)==null?void 0:wn.settings)==null?void 0:bn.productType;if(console.log(" CoursePlayer: Product Type:",Yt),Yt==="lesson"&&!re&&!de&&!c){const m=te||((Sn=(Nn=(vn=a==null?void 0:a.syllabus)==null?void 0:vn[0])==null?void 0:Nn.learningUnits)==null?void 0:Sn[0]);if(m){const X=()=>{console.log(" CoursePlayer TeacherCockpit onExit called"),s?s():window.history.length>1?window.history.back():window.location.href="/"};return d.jsx(oa,{unit:m,courseId:a==null?void 0:a.id,onExit:X,onEdit:()=>{s&&s()}})}}return d.jsxs("div",{className:"min-h-full bg-gray-50 flex flex-col items-center",children:[!de&&!re&&!Yt&&d.jsx(Ih,{}),de&&te&&d.jsx(Ch,{blocks:te.activityBlocks||[],mode:(a==null?void 0:a.mode)||"learning"}),(de||ce)&&d.jsxs("div",{className:`fixed top-20 left-4 z-[9999] px-3 py-1 rounded-full text-xs font-bold border shadow-lg ${re?"bg-red-100 text-red-700 border-red-200":"bg-green-100 text-green-700 border-green-200"}`,children:["DEBUG MODE: ",re?"EXAM":"LEARNING"," ",ce&&"(Forced)"]}),vt.map(m=>d.jsxs("div",{className:"fixed z-[9999] pointer-events-none text-4xl font-black text-yellow-500 flex flex-col items-center animate-bounce duration-1000",style:{left:"50%",top:"40%",transform:"translate(-50%, -50%)",textShadow:"0px 4px 10px rgba(0,0,0,0.2)"},children:[d.jsx("span",{className:"text-6xl drop-shadow-lg",children:""}),d.jsxs("span",{children:["+",m.amount," XP"]})]},m.id)),ee&&d.jsxs("div",{className:"fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center animate-fade-in p-8 text-center",children:[d.jsx(sn,{className:"w-24 h-24 text-green-500 mb-6 animate-bounce"}),d.jsx("h2",{className:"text-4xl font-black text-gray-800 mb-4",children:"  !"}),d.jsxs("p",{className:"text-xl text-gray-600 mb-8 max-w-lg",children:[" , ",d.jsx("strong",{children:W}),".    ."]}),re?d.jsxs("div",{className:"bg-yellow-50 p-6 rounded-2xl border border-yellow-100 max-w-sm w-full mb-8",children:[d.jsx("div",{className:"text-xl font-bold text-yellow-800",children:"  "}),d.jsx("p",{className:"text-sm text-yellow-600 mt-2",children:"    "})]}):d.jsxs("div",{className:"bg-blue-50 p-6 rounded-2xl border border-blue-100 max-w-sm w-full mb-8",children:[d.jsx("div",{className:"text-sm font-bold text-gray-500 uppercase tracking-widest mb-1",children:" "}),d.jsx("div",{className:"text-6xl font-black text-blue-600",children:Oe()})]}),d.jsx("button",{onClick:()=>window.location.replace("/"),className:"bg-gray-800 text-white px-8 py-3 rounded-full font-bold hover:bg-gray-900 transition-all hover:scale-105",children:"  "})]}),t&&n&&!o&&d.jsxs("div",{className:"sticky top-0 w-full h-10 bg-yellow-400 text-yellow-900 font-bold text-center flex items-center justify-center z-[60] shadow-md",children:[d.jsx(ia,{className:"w-5 h-5 ml-2"}),"  : ",n.studentName,d.jsx("button",{onClick:s,className:"mr-4 bg-white/30 px-3 py-0.5 rounded text-sm hover:bg-white/50",children:""})]}),t&&c&&s&&d.jsxs("button",{onClick:s,className:"fixed top-4 left-4 z-[110] bg-white shadow-lg border border-slate-200 px-4 py-2 rounded-full font-bold text-slate-700 hover:bg-slate-50 transition-all flex items-center gap-2 hover:scale-105",children:[d.jsx(On,{className:"w-5 h-5"}),"  "]}),e&&d.jsx("div",{className:"w-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg sticky top-0 z-[50] animate-slide-down mb-6",children:d.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded text-xs font-bold border border-white/20",children:" "}),d.jsx("h2",{className:"font-bold text-lg",children:e.title||" "})]}),e.instructions&&d.jsxs("div",{className:"text-sm text-blue-100 flex items-center gap-1 opacity-90 mt-1",children:[d.jsx(Nr,{className:"w-3 h-3"})," ",e.instructions]})]}),d.jsxs("div",{className:"flex items-center gap-4 bg-white/10 px-4 py-2 rounded-xl backdrop-blur-sm border border-white/10",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("span",{className:"text-xs text-blue-200 block",children:" "}),d.jsxs("div",{className:"font-bold flex items-center gap-1",children:[d.jsx(aa,{className:"w-4 h-4"}),e.dueDate?new Date(e.dueDate).toLocaleDateString("he-IL"):"-"]})]}),d.jsx("div",{className:"w-px h-8 bg-white/20"}),d.jsxs("div",{className:"text-center",children:[d.jsx("span",{className:"text-xs text-blue-200 block",children:""}),d.jsxs("div",{className:"font-bold flex items-center gap-1",children:[d.jsx(ca,{className:"w-4 h-4"}),e.dueDate?new Date(e.dueDate).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}):"-"]})]})]})]})}),(a==null?void 0:a.showSourceToStudent)&&((a==null?void 0:a.fullBookContent)||(a==null?void 0:a.pdfSource))&&d.jsx("div",{className:"fixed left-4 bottom-4 z-50",children:d.jsxs("button",{onClick:()=>be(!fe),className:"shadow-xl flex items-center gap-2 px-5 py-3 rounded-full font-bold transition-all transform hover:scale-105 "+(fe?"bg-gray-800 text-white":"bg-blue-600 text-white"),children:[d.jsx(Sr,{className:"w-5 h-5"}),fe?"  ":"  "]})}),d.jsxs("div",{className:"flex-1 w-full max-w-7xl mx-auto p-4 transition-all duration-500 "+(fe?"flex flex-col md:flex-row gap-6 items-start":""),children:[fe&&d.jsxs("div",{className:"hidden md:flex w-full md:w-1/2 h-[50vh] md:h-[85vh] md:sticky md:top-24 bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden flex-col animate-slide-in-left",children:[d.jsxs("div",{className:"bg-gray-50 border-b p-2 md:p-4 flex justify-between items-center shrink-0",children:[d.jsxs("h3",{className:"font-bold text-gray-700 flex items-center gap-2",children:[d.jsx(Sr,{className:"w-5 h-5 text-blue-500"}),"  "]}),d.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600 p-2",children:d.jsx(On,{className:"w-5 h-5"})})]}),d.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 relative min-h-0",children:a!=null&&a.pdfSource?d.jsxs("div",{className:"h-full flex flex-col",children:[d.jsx("iframe",{src:a.pdfSource,className:"w-full flex-1 border-none",title:" ",onError:()=>console.log("PDF iframe load error")}),d.jsx("div",{className:"p-3 bg-white border-t text-center",children:d.jsx("a",{href:a.pdfSource,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"     "})})]}):d.jsx("div",{className:"p-6 prose max-w-none text-sm leading-relaxed",children:d.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[d.jsx("p",{className:"font-bold",children:"   ."}),d.jsx("p",{className:"text-sm",children:"        ."}),d.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["ID: ",a==null?void 0:a.id]})]})})})]}),d.jsx("main",{className:"transition-all duration-500 "+(fe?"w-full md:w-1/2":"w-full max-w-3xl mx-auto")+" "+(fe?"p-4 md:p-0":"p-4 md:p-10")+" pb-48",children:te?d.jsxs(d.Fragment,{children:[d.jsxs("header",{className:"mb-8 text-center",children:[d.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:te.title}),We&&d.jsx("div",{className:"text-sm text-gray-500 font-medium",children:We.title}),d.jsxs("div",{className:"flex justify-center gap-2 mt-3",children:[d.jsx("span",{className:"text-xs font-bold bg-gray-100 text-gray-600 px-2 py-1 rounded border border-gray-200",children:as}),(a==null?void 0:a.subject)&&d.jsx("span",{className:"text-xs font-bold bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-100",children:a.subject})]}),!re&&Se>0&&d.jsxs("span",{className:"text-xs font-bold bg-orange-50 text-orange-600 px-2 py-1 rounded border border-orange-100 flex items-center gap-1 absolute top-2 left-4",children:[" ",Se]})]}),d.jsx("div",{className:"space-y-6",children:(_n=te.activityBlocks)==null?void 0:_n.map((m,X)=>d.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:`${X*.15}s`,opacity:0},children:ct(m)},`block-wrapper-${m.id}`))}),d.jsx("div",{className:"mt-16 flex justify-center",children:(()=>{const m=a!=null&&a.syllabus?u===a.syllabus[a.syllabus.length-1].id&&h===(We==null?void 0:We.learningUnits[We.learningUnits.length-1].id):!0;return d.jsx("button",{onClick:t&&s?s:m?Pe:Nt,disabled:!t&&m&&oe,className:`${m&&!t?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"} text-white px-10 py-3.5 rounded-full font-bold shadow-xl transition-all hover:scale-105 flex items-center gap-3 text-lg disabled:opacity-50 disabled:cursor-not-allowed`,children:t?"  ":m?d.jsxs(d.Fragment,{children:[oe?"...":" "," ",d.jsx(sn,{className:"w-5 h-5"})]}):d.jsxs(d.Fragment,{children:[" ",d.jsx(No,{className:"w-5 h-5"})]})})})()})]}):d.jsx("div",{className:"text-center mt-20",children:d.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-lg inline-block",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"   ! "}),d.jsx("p",{className:"text-gray-600 mb-8",children:"   ."}),e?d.jsxs("button",{type:"button",onClick:Pe,disabled:oe,className:"bg-green-600 text-white px-12 py-4 rounded-full font-bold shadow-xl hover:bg-green-700 text-xl flex items-center gap-3 transition-transform hover:scale-105 mx-auto",children:[oe?"...":"  ",!oe&&d.jsx(sn,{className:"w-6 h-6"})]}):d.jsx("p",{className:"text-sm text-gray-400",children:"(   -  )"})]})})})]})]})},Rh=Object.freeze(Object.defineProperty({__proto__:null,default:Th},Symbol.toStringTag,{value:"Module"}));export{vh as B,po as C,Jn as H,ch as M,Ws as P,nr as R,Qf as a,Mi as b,rf as c,Cd as d,Oi as e,gh as f,Z as g,Eh as h,Th as i,Rh as j,Kf as u};
//# sourceMappingURL=CoursePlayer-Bq7ZKb2I.js.map
