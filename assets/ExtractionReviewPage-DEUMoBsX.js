import{b0 as K,r as l,A as m,B as h,j as e,q as U,t as I,v as O,u as M}from"./index-1x3sw4DL.js";function X(){const{currentUser:w}=K(),[N,A]=l.useState([]),[B,j]=l.useState(!0),[x,q]=l.useState(!0),[s,g]=l.useState(null),[Q,R]=l.useState(!1),[d,P]=l.useState(0),[F,f]=l.useState(null),[i,b]=l.useState(""),[C,T]=l.useState(!1),[k,S]=l.useState(!1),[$,E]=l.useState(null),[y,D]=l.useState(!1),u=l.useCallback(async()=>{var t;j(!0),E(null);try{console.log("ğŸ“‹ Loading extraction reviews, pendingOnly:",x);const c=await m(h,"getExtractionReviews")({pendingOnly:x});console.log("ğŸ“‹ Raw result:",c);const r=c.data;console.log("ğŸ“‹ Reviews loaded:",((t=r.reviews)==null?void 0:t.length)||0),A(r.reviews||[])}catch(a){console.error("Failed to load reviews:",a),E(a.message||"×©×’×™××” ×œ× ×™×“×•×¢×”")}finally{j(!1)}},[x]);l.useEffect(()=>{u()},[u]);const z=async t=>{R(!0),g(null),f(null);try{const r=(await m(h,"getExtractionReview")({reviewId:t})).data;g(r.review),P(0);const p=r.review.pages[0];if(b(p.correctedText||p.extractedText),r.review.storagePath)try{const o=U(I,r.review.storagePath),L=await O(o);f(L)}catch(o){console.error("Failed to load PDF:",o)}}catch(a){console.error("Failed to load review:",a)}finally{R(!1)}},v=t=>{if(!s)return;P(t);const a=s.pages[t];b(a.correctedText||a.extractedText)},V=async()=>{if(!s)return;const t=s.pages[d];if(i!==(t.correctedText||t.extractedText)){T(!0);try{await m(h,"correctPageExtraction")({reviewId:s.id,pageNumber:t.pageNumber,correctedText:i});const c=[...s.pages];c[d]={...t,correctedText:i,needsReview:!1},g({...s,pages:c,pagesNeedingReview:c.filter(r=>r.needsReview&&!r.correctedText).map(r=>r.pageNumber)})}catch(a){console.error("Failed to save correction:",a),alert("×©×’×™××” ×‘×©××™×¨×”: "+a.message)}finally{T(!1)}}},_=async()=>{if(s&&window.confirm("×”×× ××ª×” ×‘×˜×•×—? ×¤×¢×•×œ×” ×–×• ×ª×¢×“×›×Ÿ ××ª ×›×œ ×”-chunks ×‘×‘×¡×™×¡ ×”×™×“×¢.")){S(!0);try{const c=(await m(h,"approveExtractionReview")({reviewId:s.id})).data;alert(`××•×©×¨ ×‘×”×¦×œ×—×”! ×¢×•×“×›× ×• ${c.chunksUpdated} ×§×˜×¢×™×.`),g(null),u()}catch(t){console.error("Failed to approve:",t),alert("×©×’×™××” ×‘××™×©×•×¨: "+t.message)}finally{S(!1)}}},G=async t=>{var c;const a=(c=t.target.files)==null?void 0:c[0];if(!(!a||!s||!w)){D(!0);try{const r=Date.now(),p=`knowledge-base/${w.uid}/${r}_${a.name}`,o=U(I,p);await M(o,a),await m(h,"updateReviewStoragePath")({reviewId:s.id,storagePath:p});const J=await O(o);f(J),alert("PDF ×”×•×¢×œ×” ×‘×”×¦×œ×—×”!")}catch(r){console.error("Failed to upload PDF:",r),alert("×©×’×™××” ×‘×”×¢×œ××ª PDF: "+r.message)}finally{D(!1)}}},H=t=>{switch(t){case"high":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",dir:"rtl",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"×¡×§×™×¨×ª ×—×™×œ×•×¥ ×˜×§×¡×˜"}),e.jsx("p",{className:"text-gray-600",children:"×‘×“×•×§ ×•×ª×§×Ÿ ×˜×§×¡×˜ ×©×—×•×œ×¥ ××¡×¤×¨×™×"})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:t=>q(t.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"×”×¦×’ ×¨×§ ×××ª×™× ×™× ×œ×¡×§×™×¨×”"})]}),e.jsx("button",{onClick:u,className:"text-blue-600 hover:text-blue-800 text-sm",children:"×¨×¢× ×Ÿ"})]}),B?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"×˜×•×¢×Ÿ..."}):$?e.jsxs("div",{className:"text-center py-8 text-red-600 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:"×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×§×™×¨×•×ª:"}),e.jsx("p",{className:"text-sm mt-2",children:$}),e.jsx("button",{onClick:u,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"× ×¡×” ×©×•×‘"})]}):N.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:x?"××™×Ÿ ×¡×§×™×¨×•×ª ×××ª×™× ×•×ª":"××™×Ÿ ×¡×§×™×¨×•×ª"}):e.jsx("div",{className:"bg-white rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×¡×¤×¨"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×¢××•×“×™×"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×•×“××•×ª"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×œ×‘×“×™×§×”"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×¡×˜×˜×•×¡"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"×¤×¢×•×œ×•×ª"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.volumeType==="teacher"?"××“×¨×™×š ×œ××•×¨×”":"×¡×¤×¨ ×ª×œ××™×“"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["×›×™×ª×” ",t.grade,"' ×›×¨×š ",t.volume]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.totalPages}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.averageConfidence>=.9?"bg-green-500":t.averageConfidence>=.8?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.averageConfidence*100}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(t.averageConfidence*100).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.pagesNeedingReview.length>0?e.jsxs("span",{className:"text-sm text-red-600 font-medium",children:[t.pagesNeedingReview.length," ×¢××•×“×™×"]}):e.jsx("span",{className:"text-sm text-green-600",children:"×ª×§×™×Ÿ"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="reviewed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"××•×©×¨":t.status==="reviewed"?"× ×‘×“×§":"×××ª×™×Ÿ"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>z(t.id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"×¤×ª×—"})})]},t.id))})]})})]})});const n=s.pages[d];return e.jsxs("div",{className:"min-h-screen bg-gray-100",dir:"rtl",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g(null),className:"text-gray-500 hover:text-gray-700",children:"â† ×—×–×¨×”"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold",children:[s.volumeType==="teacher"?"××“×¨×™×š ×œ××•×¨×”":"×¡×¤×¨ ×ª×œ××™×“"," - ×›×™×ª×” ",s.grade,"' ×›×¨×š ",s.volume]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.fileName})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["×•×“××•×ª ×××•×¦×¢×ª: ",(s.averageConfidence*100).toFixed(1),"%"]}),e.jsx("button",{onClick:_,disabled:k,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400",children:k?"×××©×¨...":"××©×¨ ×•×¢×“×›×Ÿ chunks"})]})]})}),e.jsxs("div",{className:"flex h-[calc(100vh-80px)]",children:[e.jsx("div",{className:"w-1/2 bg-gray-800 p-4 overflow-auto",children:F?e.jsx("iframe",{src:`${F}#page=${n.pageNumber}`,className:"w-full h-full bg-white rounded",title:"PDF Viewer"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 gap-4",children:[e.jsx("p",{children:"×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ PDF"}),e.jsx("p",{className:"text-sm",children:"×§×•×‘×¥ ×”-PDF ×œ× × ××¦×. × ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ××ª ×”×§×•×‘×¥:"}),e.jsxs("label",{className:`px-4 py-2 rounded-md cursor-pointer ${y?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[y?"××¢×œ×”...":"ğŸ“ ×”×¢×œ×” PDF",e.jsx("input",{type:"file",accept:".pdf",onChange:G,disabled:y,className:"hidden"})]})]})}),e.jsxs("div",{className:"w-1/2 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(d-1),disabled:d===0,className:"px-3 py-1 border rounded disabled:opacity-50",children:"â† ×”×§×•×“×"}),e.jsxs("span",{className:"px-4 font-medium",children:["×¢××•×“ ",n.pageNumber," ××ª×•×š ",s.totalPages]}),e.jsx("button",{onClick:()=>v(d+1),disabled:d===s.pages.length-1,className:"px-3 py-1 border rounded disabled:opacity-50",children:"×”×‘× â†’"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`px-2 py-1 text-xs rounded ${H(n.confidence)}`,children:[n.confidence==="high"?"×•×“××•×ª ×’×‘×•×”×”":n.confidence==="medium"?"×•×“××•×ª ×‘×™× ×•× ×™×ª":"×•×“××•×ª × ××•×›×”","(",(n.agreementScore*100).toFixed(0),"%)"]}),n.correctedText&&e.jsx("span",{className:"text-xs text-green-600",children:"âœ“ ×ª×•×§×Ÿ"}),n.needsReview&&!n.correctedText&&e.jsx("span",{className:"text-xs text-red-600",children:"âš ï¸ ×“×•×¨×© ×‘×“×™×§×”"})]})]}),e.jsx("div",{className:"bg-gray-100 px-4 py-2 overflow-x-auto flex gap-2",children:s.pages.map((t,a)=>e.jsx("button",{onClick:()=>v(a),className:`flex-shrink-0 w-10 h-10 rounded text-xs font-medium ${a===d?"bg-blue-600 text-white":t.correctedText?"bg-green-100 text-green-800 border border-green-300":t.needsReview?"bg-red-100 text-red-800 border border-red-300":"bg-white text-gray-700 border border-gray-300"}`,children:t.pageNumber},t.pageNumber))}),e.jsx("div",{className:"flex-1 p-4 overflow-auto",children:e.jsx("textarea",{value:i,onChange:t=>b(t.target.value),className:"w-full h-full p-4 border rounded-lg resize-none font-mono text-sm leading-relaxed",placeholder:"×˜×§×¡×˜ ××—×•×œ×¥...",dir:"rtl"})}),e.jsxs("div",{className:"bg-white border-t px-4 py-3 flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:i!==(n.correctedText||n.extractedText)?"×™×© ×©×™× ×•×™×™× ×©×œ× × ×©××¨×•":""}),e.jsx("button",{onClick:V,disabled:C||i===(n.correctedText||n.extractedText),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:C?"×©×•××¨...":"×©××•×¨ ×ª×™×§×•×Ÿ"})]})]})]})]})}export{X as default};
//# sourceMappingURL=ExtractionReviewPage-DEUMoBsX.js.map
