import{bz as j,bZ as B,c1 as Z,aw as P,p as D,bJ as M,n as z,c2 as oe,s as Ee,bA as we,au as Be,as as xe,at as ve,N as be,L as le,aN as $e,aP as He,bk as U,bj as L,c3 as _e,c4 as ie,c5 as qe,ae as Oe,bl as ee,aM as te,b0 as Fe,r as E,j as d}from"./index-1x3sw4DL.js";import{M as Le,T as re}from"./multimodalService-BOWYif01.js";const Ge=[{type:"beginner",correctAnswerRate:.3,useHints:!0,readContent:!0,interactionSpeed:"slow"},{type:"average",correctAnswerRate:.7,useHints:!1,readContent:!0,interactionSpeed:"normal"},{type:"advanced",correctAnswerRate:.95,useHints:!1,readContent:!1,interactionSpeed:"fast"},{type:"struggling",correctAnswerRate:.2,useHints:!0,readContent:!0,interactionSpeed:"slow"}],Qe={sanity:{checkFirebaseConnection:!0,checkAuthService:!0,checkStorageAccess:!0,checkCriticalPages:!0},dataIntegrity:{checkOrphanedCourses:!0,checkEmptyUnits:!0,checkBrokenReferences:!0,maxCoursesToCheck:100},performance:{maxQueryTimeMs:3e3,maxPageLoadTimeMs:5e3},contentQuality:{checkLessonStructure:!0,checkBlockValidity:!0,minBlocksPerUnit:3,maxBlocksPerUnit:20},studentSimulation:{enabled:!0,coursesToTest:"recent",maxCoursesPerRun:5,studentProfiles:Ge,timeout:6e4},aiGeneration:{enabled:!0,testLessonPlanGeneration:!0,testActivityGeneration:!0,testQuizGeneration:!0,maxRetries:2,timeout:3e4}};function I(e,t,n,s,a,i,o,r,c){return{id:`test_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:e,nameHe:t,category:n,status:s,severity:a,message:i,messageHe:o,details:c,duration:r,timestamp:new Date}}function ue(e,t,n,s){const a=s.filter(m=>m.status==="passed").length,i=s.filter(m=>m.status==="failed").length,o=s.filter(m=>m.status==="warning").length,r=s.filter(m=>m.status==="skipped").length,c=s.reduce((m,h)=>m+h.duration,0);let l="passed";return i>0?l="failed":o>0&&(l="warning"),{id:`suite_${n}_${Date.now()}`,name:e,nameHe:t,category:n,tests:s,passedCount:a,failedCount:i,warningCount:o,skippedCount:r,duration:c,status:l}}async function Ue(){const e=[],t=Date.now();try{const i=j(P(D,"courses"),B(1));await M(i),e.push(I("Firebase Connection","×—×™×‘×•×¨ Firebase","sanity","passed","critical","Successfully connected to Firestore","×”×ª×—×‘×¨×•×ª ××•×¦×œ×—×ª ×œ-Firestore",Date.now()-t))}catch(i){e.push(I("Firebase Connection","×—×™×‘×•×¨ Firebase","sanity","failed","critical",`Firebase connection failed: ${i.message}`,`×—×™×‘×•×¨ Firebase × ×›×©×œ: ${i.message}`,Date.now()-t,{error:i.message}))}const n=Date.now();try{const i=j(P(D,"courses"),B(5)),o=await M(i);e.push(I("Courses Collection","××•×¡×£ ×§×•×¨×¡×™×","sanity","passed","high",`Found ${o.size} courses`,`× ××¦××• ${o.size} ×§×•×¨×¡×™×`,Date.now()-n,{courseCount:o.size}))}catch(i){e.push(I("Courses Collection","××•×¡×£ ×§×•×¨×¡×™×","sanity","failed","high",`Cannot access courses: ${i.message}`,`××™×Ÿ ×’×™×©×” ×œ×§×•×¨×¡×™×: ${i.message}`,Date.now()-n))}const s=Date.now();try{const i=j(P(D,"student_tasks"),B(5)),o=await M(i);e.push(I("Assignments Collection","××•×¡×£ ××˜×œ×•×ª","sanity","passed","medium",`Found ${o.size} assignments`,`× ××¦××• ${o.size} ××˜×œ×•×ª`,Date.now()-s))}catch(i){e.push(I("Assignments Collection","××•×¡×£ ××˜×œ×•×ª","sanity","failed","medium",`Cannot access assignments: ${i.message}`,`××™×Ÿ ×’×™×©×” ×œ××˜×œ×•×ª: ${i.message}`,Date.now()-s))}const a=Date.now();try{const i=j(P(D,"users"),B(5)),o=await M(i);e.push(I("Users Collection","××•×¡×£ ××©×ª××©×™×","sanity","passed","medium",`Found ${o.size} users`,`× ××¦××• ${o.size} ××©×ª××©×™×`,Date.now()-a))}catch(i){e.push(I("Users Collection","××•×¡×£ ××©×ª××©×™×","sanity","warning","medium",`Users collection issue: ${i.message}`,`×‘×¢×™×” ×‘××•×¡×£ ××©×ª××©×™×: ${i.message}`,Date.now()-a))}return ue("Sanity Tests","×‘×“×™×§×•×ª ×¡× ×™×˜×™","sanity",e)}async function Ve(e){const t=[],n=Date.now();try{const i=j(P(D,"courses"),B(e.maxCoursesToCheck)),o=await M(i);let r=0,c=0;const l=[];o.forEach(m=>{c++;const p=m.data().syllabus||[];(!p.length||p.every(u=>{var f;return!((f=u.learningUnits)!=null&&f.length)}))&&(r++,l.push(m.id))}),r===0?t.push(I("Empty Courses Check","×‘×“×™×§×ª ×§×•×¨×¡×™× ×¨×™×§×™×","data-integrity","passed","medium",`All ${c} courses have content`,`×›×œ ${c} ×”×§×•×¨×¡×™× ××›×™×œ×™× ×ª×•×›×Ÿ`,Date.now()-n)):t.push(I("Empty Courses Check","×‘×“×™×§×ª ×§×•×¨×¡×™× ×¨×™×§×™×","data-integrity","warning","medium",`Found ${r} courses with no content`,`× ××¦××• ${r} ×§×•×¨×¡×™× ×œ×œ× ×ª×•×›×Ÿ`,Date.now()-n,{emptyCount:r,emptyCourses:l.slice(0,10)}))}catch(i){t.push(I("Empty Courses Check","×‘×“×™×§×ª ×§×•×¨×¡×™× ×¨×™×§×™×","data-integrity","failed","medium",`Check failed: ${i.message}`,`×‘×“×™×§×” × ×›×©×œ×”: ${i.message}`,Date.now()-n))}const s=Date.now();try{const i=j(P(D,"courses"),B(20)),o=await M(i);let r=0;const c=[];o.forEach(l=>{(l.data().syllabus||[]).forEach(p=>{(p.learningUnits||[]).forEach(u=>{(u.activityBlocks||[]).forEach(f=>{if(!f.content&&f.type!=="text"&&(r++,c.push({courseId:l.id,unitId:u.id,blockId:f.id,issue:"missing_content"})),f.type==="multiple-choice"){const y=f.content||{};!y.correctAnswer&&!y.correct_answer&&(r++,c.push({courseId:l.id,unitId:u.id,blockId:f.id,issue:"no_correct_answer"}))}})})})}),r===0?t.push(I("Block Validity Check","×‘×“×™×§×ª ×ª×§×™× ×•×ª ×‘×œ×•×§×™×","data-integrity","passed","high","All activity blocks are valid","×›×œ ×‘×œ×•×§×™ ×”×¤×¢×™×œ×•×ª ×ª×§×™× ×™×",Date.now()-s)):t.push(I("Block Validity Check","×‘×“×™×§×ª ×ª×§×™× ×•×ª ×‘×œ×•×§×™×","data-integrity","warning","high",`Found ${r} blocks with issues`,`× ××¦××• ${r} ×‘×œ×•×§×™× ×¢× ×‘×¢×™×•×ª`,Date.now()-s,{invalidBlocks:r,issues:c.slice(0,20)}))}catch(i){t.push(I("Block Validity Check","×‘×“×™×§×ª ×ª×§×™× ×•×ª ×‘×œ×•×§×™×","data-integrity","failed","high",`Check failed: ${i.message}`,`×‘×“×™×§×” × ×›×©×œ×”: ${i.message}`,Date.now()-s))}const a=Date.now();try{const i=j(P(D,"student_tasks"),B(50)),o=await M(i),r=new Set;o.forEach(l=>{const m=l.data();m.courseId&&r.add(m.courseId)});let c=0;for(const l of r)try{(await M(j(P(D,"courses"),we("__name__","==",l)))).empty&&c++}catch{}c===0?t.push(I("Orphaned Tasks Check","×‘×“×™×§×ª ××˜×œ×•×ª ×™×ª×•××•×ª","data-integrity","passed","medium","All tasks linked to valid courses","×›×œ ×”××˜×œ×•×ª ××§×•×©×¨×•×ª ×œ×§×•×¨×¡×™× ×ª×§×™× ×™×",Date.now()-a)):t.push(I("Orphaned Tasks Check","×‘×“×™×§×ª ××˜×œ×•×ª ×™×ª×•××•×ª","data-integrity","warning","medium",`Found ${c} tasks with missing courses`,`× ××¦××• ${c} ××˜×œ×•×ª ×¢× ×§×•×¨×¡×™× ×—×¡×¨×™×`,Date.now()-a,{orphanedTasks:c}))}catch(i){t.push(I("Orphaned Tasks Check","×‘×“×™×§×ª ××˜×œ×•×ª ×™×ª×•××•×ª","data-integrity","skipped","low",`Check skipped: ${i.message}`,`×‘×“×™×§×” ×“×•×œ×’×”: ${i.message}`,Date.now()-a))}return ue("Data Integrity Tests","×‘×“×™×§×•×ª ×©×œ××•×ª × ×ª×•× ×™×","data-integrity",t)}async function Ke(e){const t=[],n=Date.now();try{const a=j(P(D,"courses"),Z("createdAt","desc"),B(10));await M(a);const i=Date.now()-n;i<e.maxQueryTimeMs?t.push(I("Course Query Performance","×‘×™×¦×•×¢×™ ×©××™×œ×ª×ª ×§×•×¨×¡×™×","performance","passed","medium",`Query completed in ${i}ms (limit: ${e.maxQueryTimeMs}ms)`,`×©××™×œ×ª×” ×”×•×©×œ××” ×‘-${i}ms (×’×‘×•×œ: ${e.maxQueryTimeMs}ms)`,i,{queryTime:i,limit:e.maxQueryTimeMs})):t.push(I("Course Query Performance","×‘×™×¦×•×¢×™ ×©××™×œ×ª×ª ×§×•×¨×¡×™×","performance","warning","medium",`Query took ${i}ms (exceeds ${e.maxQueryTimeMs}ms limit)`,`×©××™×œ×ª×” ×œ×§×—×” ${i}ms (×—×•×¨×’ ××’×‘×•×œ ${e.maxQueryTimeMs}ms)`,i,{queryTime:i,limit:e.maxQueryTimeMs}))}catch(a){t.push(I("Course Query Performance","×‘×™×¦×•×¢×™ ×©××™×œ×ª×ª ×§×•×¨×¡×™×","performance","failed","medium",`Query failed: ${a.message}`,`×©××™×œ×ª×” × ×›×©×œ×”: ${a.message}`,Date.now()-n))}const s=Date.now();try{const a=j(P(D,"student_tasks"),we("status","==","submitted"),B(20));await M(a);const i=Date.now()-s;t.push(I("Task Query Performance","×‘×™×¦×•×¢×™ ×©××™×œ×ª×ª ××˜×œ×•×ª","performance",i<e.maxQueryTimeMs?"passed":"warning","low",`Aggregation query: ${i}ms`,`×©××™×œ×ª×ª ××’×¨×’×¦×™×”: ${i}ms`,i))}catch(a){t.push(I("Task Query Performance","×‘×™×¦×•×¢×™ ×©××™×œ×ª×ª ××˜×œ×•×ª","performance","skipped","low",`Skipped: ${a.message}`,`×“×•×œ×’×”: ${a.message}`,Date.now()-s))}return ue("Performance Tests","×‘×“×™×§×•×ª ×‘×™×¦×•×¢×™×","performance",t)}async function Ye(e=Qe,t="manual",n){const s=Date.now(),a=[];console.log("ğŸ” Starting QA Tests..."),console.log("  â–¶ Running Sanity Tests..."),a.push(await Ue()),console.log("  â–¶ Running Data Integrity Tests..."),a.push(await Ve(e.dataIntegrity)),console.log("  â–¶ Running Performance Tests..."),a.push(await Ke(e.performance));const i=a.flatMap(f=>f.tests),o=i.filter(f=>f.status==="passed").length,r=i.filter(f=>f.status==="failed").length,c=i.filter(f=>f.status==="warning").length,l=i.filter(f=>f.status==="skipped").length,m=i.filter(f=>f.status==="failed"&&f.severity==="critical");let h="passed";r>0?h="failed":c>0&&(h="warning");const p={totalTests:i.length,passed:o,failed:r,warnings:c,skipped:l,passRate:Math.round(o/i.length*100),overallStatus:h,criticalIssues:m,duration:Date.now()-s},u={id:`report_${Date.now()}`,createdAt:new Date(s),completedAt:new Date,triggeredBy:t,triggeredByUserId:n,environment:"production",suites:a,summary:p,metadata:{browserInfo:typeof navigator<"u"?navigator.userAgent:"Node.js"}};return console.log(`âœ… QA Report Complete: ${o}/${i.length} passed (${p.passRate}%)`),u}async function ze(e){var s,a,i;const t=z(P(D,"qa_reports")),n={id:e.id,createdAt:oe.fromDate(e.createdAt),completedAt:oe.fromDate(e.completedAt),triggeredBy:e.triggeredBy,environment:e.environment,summary:e.summary,metadata:{browserInfo:((s=e.metadata)==null?void 0:s.browserInfo)||null,appVersion:((a=e.metadata)==null?void 0:a.appVersion)||null,nodeVersion:((i=e.metadata)==null?void 0:i.nodeVersion)||null},...e.triggeredByUserId&&{triggeredByUserId:e.triggeredByUserId},suites:e.suites.map(o=>({...o,tests:o.tests.map(r=>({...r,timestamp:oe.fromDate(r.timestamp),details:r.details||null}))}))};return await Ee(t,n),t.id}async function We(e=10){const t=j(P(D,"qa_reports"),Z("createdAt","desc"),B(e));return(await M(t)).docs.map(s=>{var i,o,r,c;const a=s.data();return{...a,id:s.id,createdAt:((o=(i=a.createdAt)==null?void 0:i.toDate)==null?void 0:o.call(i))||new Date,completedAt:((c=(r=a.completedAt)==null?void 0:r.toDate)==null?void 0:c.call(r))||new Date}})}function Je(e){const t=[],n=e.content||{};n.question||t.push({type:"missing",field:"question",message:"Multiple choice block missing question",messageHe:"×‘×œ×•×§ ×‘×—×™×¨×” ××¨×•×‘×” ×—×¡×¨ ×©××œ×”",severity:"high",autoFixable:!1});const s=n.options||[];s.length<2&&t.push({type:"incomplete",field:"options",message:`Only ${s.length} options (minimum 2 required)`,messageHe:`×¨×§ ${s.length} ××¤×©×¨×•×™×•×ª (××™× ×™××•× 2 × ×“×¨×©×•×ª)`,severity:"high",autoFixable:!1}),s.length>6&&t.push({type:"quality",field:"options",message:"Too many options (max 6 recommended)",messageHe:"×™×•×ª×¨ ××“×™ ××¤×©×¨×•×™×•×ª (××§×¡×™××•× 6 ××•××œ×¥)",severity:"low",autoFixable:!1}),!n.correctAnswer&&!n.correct_answer&&t.push({type:"missing",field:"correctAnswer",message:"No correct answer specified",messageHe:"×œ× ×¦×•×™× ×” ×ª×©×•×‘×” × ×›×•× ×”",severity:"critical",autoFixable:!1});const a=n.correctAnswer||n.correct_answer;a&&s.length>0&&(s.map(r=>typeof r=="string"?r:r.text||r.label).includes(a)||t.push({type:"invalid",field:"correctAnswer",message:"Correct answer not found in options",messageHe:"×”×ª×©×•×‘×” ×”× ×›×•× ×” ×œ× × ××¦××ª ×‘××¤×©×¨×•×™×•×ª",severity:"critical",autoFixable:!1}));const i=Math.max(0,100-t.length*20);return{valid:t.length===0,issues:t,score:i}}function Xe(e){var a;const t=[];(e.content||{}).question||t.push({type:"missing",field:"question",message:"Open question missing question text",messageHe:"×©××œ×” ×¤×ª×•×—×” ×—×¡×¨×” ×˜×§×¡×˜ ×©××œ×”",severity:"high",autoFixable:!1}),(a=e.metadata)!=null&&a.modelAnswer||t.push({type:"quality",field:"modelAnswer",message:"No model answer provided (recommended for grading)",messageHe:"×œ× ×¡×•×¤×§×” ×ª×©×•×‘×ª ××•×“×œ (××•××œ×¥ ×œ×¦×•×¨×›×™ ×¦×™×•×Ÿ)",severity:"low",autoFixable:!1});const s=Math.max(0,100-t.length*15);return{valid:t.filter(i=>i.severity!=="low").length===0,issues:t,score:s}}function Ze(e){const t=[],n=e.content||{};n.instruction||t.push({type:"missing",field:"instruction",message:"Ordering block missing instruction",messageHe:"×‘×œ×•×§ ×¡×™×“×•×¨ ×—×¡×¨ ×”× ×—×™×”",severity:"medium",autoFixable:!1});const s=n.correct_order||n.correctOrder||[];s.length<2&&t.push({type:"incomplete",field:"correct_order",message:`Only ${s.length} items to order (minimum 2)`,messageHe:`×¨×§ ${s.length} ×¤×¨×™×˜×™× ×œ×¡×™×“×•×¨ (××™× ×™××•× 2)`,severity:"high",autoFixable:!1});const a=Math.max(0,100-t.length*20);return{valid:t.length===0,issues:t,score:a}}function et(e){const t=[],n=e.content||{},s=n.categories||[],a=n.items||[];s.length<2&&t.push({type:"incomplete",field:"categories",message:`Only ${s.length} categories (minimum 2)`,messageHe:`×¨×§ ${s.length} ×§×˜×’×•×¨×™×•×ª (××™× ×™××•× 2)`,severity:"high",autoFixable:!1}),a.length<s.length&&t.push({type:"incomplete",field:"items",message:"Fewer items than categories",messageHe:"×¤×—×•×ª ×¤×¨×™×˜×™× ××§×˜×’×•×¨×™×•×ª",severity:"medium",autoFixable:!1}),a.forEach((o,r)=>{o.category&&!s.includes(o.category)&&t.push({type:"invalid",field:`items[${r}].category`,message:`Item assigned to non-existent category: ${o.category}`,messageHe:`×¤×¨×™×˜ ××•×§×¦×” ×œ×§×˜×’×•×¨×™×” ×©×œ× ×§×™×™××ª: ${o.category}`,severity:"high",autoFixable:!1})});const i=Math.max(0,100-t.length*15);return{valid:t.filter(o=>o.severity==="critical"||o.severity==="high").length===0,issues:t,score:i}}function tt(e){const t=[],n=e.content;(!n||typeof n=="string"&&n.trim().length===0)&&t.push({type:"missing",field:"content",message:"Text block is empty",messageHe:"×‘×œ×•×§ ×˜×§×¡×˜ ×¨×™×§",severity:"medium",autoFixable:!1}),typeof n=="string"&&n.length<20&&t.push({type:"quality",field:"content",message:"Text content is very short",messageHe:"×ª×•×›×Ÿ ×”×˜×§×¡×˜ ×§×¦×¨ ×××•×“",severity:"low",autoFixable:!1});const s=Math.max(0,100-t.length*20);return{valid:t.filter(a=>a.severity!=="low").length===0,issues:t,score:s}}function st(e){const t=[],n=e.content||{},s=n.pairs||n.cards||[];s.length<3&&t.push({type:"incomplete",field:"pairs",message:`Only ${s.length} pairs (minimum 3 recommended)`,messageHe:`×¨×§ ${s.length} ×–×•×’×•×ª (××™× ×™××•× 3 ××•××œ×¥)`,severity:"medium",autoFixable:!1}),s.length>12&&t.push({type:"quality",field:"pairs",message:"Too many pairs (max 12 recommended for playability)",messageHe:"×™×•×ª×¨ ××“×™ ×–×•×’×•×ª (××§×¡×™××•× 12 ××•××œ×¥ ×œ×©×—×™×§×•×ª)",severity:"low",autoFixable:!1});const a=Math.max(0,100-t.length*15);return{valid:t.filter(i=>i.severity==="critical"||i.severity==="high").length===0,issues:t,score:a}}function nt(e){switch(e.type){case"multiple-choice":return Je(e);case"open-question":return Xe(e);case"ordering":return Ze(e);case"categorization":return et(e);case"text":return tt(e);case"memory_game":return st(e);case"video":case"image":case"pdf":return e.content?{valid:!0,issues:[],score:100}:{valid:!1,issues:[{type:"missing",field:"content",message:`${e.type} block missing content/URL`,messageHe:`×‘×œ×•×§ ${e.type} ×—×¡×¨ ×ª×•×›×Ÿ/×§×™×©×•×¨`,severity:"high",autoFixable:!1}],score:0};default:return{valid:!0,issues:[],score:80}}}function at(e){const t=[],n=[],s=e.activityBlocks||[];s.length===0&&t.push({type:"missing",field:"activityBlocks",message:"Unit has no activity blocks",messageHe:"×œ×™×—×™×“×” ××™×Ÿ ×‘×œ×•×§×™ ×¤×¢×™×œ×•×ª",severity:"high",autoFixable:!1});let a=0,i=0;s.forEach(c=>{const l=nt(c);n.push({blockId:c.id,type:c.type,score:l.score}),i+=l.score,l.valid?a++:t.push(...l.issues)});const o=new Set(s.map(c=>c.type));s.length>3&&o.size===1&&t.push({type:"quality",field:"diversity",message:"Unit uses only one block type - consider adding variety",messageHe:"×”×™×—×™×“×” ××©×ª××©×ª ×¨×§ ×‘×¡×•×’ ×‘×œ×•×§ ××—×“ - ×©×§×•×œ ×œ×”×•×¡×™×£ ××’×•×•×Ÿ",severity:"low",autoFixable:!1}),(!e.baseContent||e.baseContent.trim().length<50)&&t.push({type:"incomplete",field:"baseContent",message:"Unit base content is missing or too short",messageHe:"×ª×•×›×Ÿ ×”×‘×¡×™×¡ ×©×œ ×”×™×—×™×“×” ×—×¡×¨ ××• ×§×¦×¨ ××“×™",severity:"medium",autoFixable:!1});const r=s.length>0?Math.round(i/s.length):0;return{unitId:e.id,unitTitle:e.title,valid:t.filter(c=>c.severity==="critical"||c.severity==="high").length===0,blockCount:s.length,validBlocks:a,invalidBlocks:s.length-a,issues:t,score:r,blockScores:n}}function it(e){const t=[],n=[],s=e.syllabus||[];let a=0,i=0,o=0,r=0;e.title||t.push({type:"missing",field:"title",message:"Course has no title",messageHe:"×œ×§×•×¨×¡ ××™×Ÿ ×›×•×ª×¨×ª",severity:"high",autoFixable:!1}),e.targetAudience||t.push({type:"missing",field:"targetAudience",message:"Course has no target audience defined",messageHe:"×œ× ×”×•×’×“×¨ ×§×”×œ ×™×¢×“ ×œ×§×•×¨×¡",severity:"medium",autoFixable:!1}),s.length===0&&t.push({type:"missing",field:"syllabus",message:"Course has no modules",messageHe:"×œ×§×•×¨×¡ ××™×Ÿ ××•×“×•×œ×™×",severity:"critical",autoFixable:!1}),s.forEach(l=>{const m=l.learningUnits||[];a+=m.length,m.length===0&&t.push({type:"incomplete",field:`module_${l.id}`,message:`Module "${l.title}" has no units`,messageHe:`×œ××•×“×•×œ "${l.title}" ××™×Ÿ ×™×—×™×“×•×ª`,severity:"medium",autoFixable:!1}),m.forEach(h=>{const p=at(h);n.push(p),i+=p.blockCount,o+=p.score,r++,p.valid||t.push(...p.issues.filter(u=>u.severity==="critical"||u.severity==="high"))})});const c=r>0?Math.round(o/r):0;return{courseId:e.id,courseTitle:e.title,valid:t.filter(l=>l.severity==="critical").length===0,moduleCount:s.length,unitCount:a,blockCount:i,issues:t,unitResults:n,overallScore:c}}async function Te(e=10){const t=Date.now(),n=[];console.log("ğŸ” Content Quality Agent starting...");try{const s=j(P(D,"courses"),Z("createdAt","desc"),B(e)),a=await M(s);let i=0,o=0,r=0;const c=[];for(const l of a.docs){const m={id:l.id,...l.data()},h=it(m);i++;const p={id:`content_${m.id}`,name:`Course: ${m.title||m.id}`,nameHe:`×§×•×¨×¡: ${m.title||m.id}`,category:"content-quality",status:h.valid?"passed":h.issues.some(u=>u.severity==="critical")?"failed":"warning",severity:h.issues.some(u=>u.severity==="critical")?"critical":h.issues.some(u=>u.severity==="high")?"high":"medium",message:`Score: ${h.overallScore}% | ${h.unitCount} units, ${h.blockCount} blocks | ${h.issues.length} issues`,messageHe:`×¦×™×•×Ÿ: ${h.overallScore}% | ${h.unitCount} ×™×—×™×“×•×ª, ${h.blockCount} ×‘×œ×•×§×™× | ${h.issues.length} ×‘×¢×™×•×ª`,details:{courseId:m.id,score:h.overallScore,moduleCount:h.moduleCount,unitCount:h.unitCount,blockCount:h.blockCount,issues:h.issues,unitResults:h.unitResults.map(u=>({unitId:u.unitId,title:u.unitTitle,score:u.score,blockCount:u.blockCount,issueCount:u.issues.length}))},duration:0,timestamp:new Date};n.push(p),p.status==="passed"?o++:(r++,p.severity==="critical"&&c.push(p))}return console.log(`âœ… Content Quality Agent completed: ${o}/${i} courses passed`),{agentType:"content-quality",success:r===0,duration:Date.now()-t,testsRun:i,testsPassed:o,testsFailed:r,criticalIssues:c,allResults:n}}catch(s){return console.error("âŒ Content Quality Agent failed:",s),{agentType:"content-quality",success:!1,duration:Date.now()-t,testsRun:0,testsPassed:0,testsFailed:1,criticalIssues:[{id:"agent_error",name:"Content Quality Agent Error",nameHe:"×©×’×™××ª ×¡×•×›×Ÿ ××™×›×•×ª ×ª×•×›×Ÿ",category:"content-quality",status:"failed",severity:"critical",message:s.message,messageHe:s.message,duration:Date.now()-t,timestamp:new Date}],allResults:[]}}}function ot(e,t){var p,u;const n=Date.now(),s=[],a=e.content||{},i=a.options||[],o=a.correctAnswer||a.correct_answer;if(i.length===0)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"No options available"},actions:[],timeSpent:Date.now()-n};if(!o)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"no_correct_option",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"No correct answer defined"},actions:[],timeSpent:Date.now()-n};const r=t.readContent?t.interactionSpeed==="slow"?5e3:t.interactionSpeed==="fast"?1e3:2500:500;s.push({type:"view",blockId:e.id,timeSpent:r});const c=Math.random()<t.correctAnswerRate;!c&&t.useHints&&((u=(p=e.metadata)==null?void 0:p.progressiveHints)!=null&&u.length)&&s.push({type:"hint",blockId:e.id,timeSpent:1500});const l=c?o:i[Math.floor(Math.random()*i.length)],m=l===o;s.push({type:"answer",blockId:e.id,answer:l,correct:m,timeSpent:t.interactionSpeed==="slow"?3e3:t.interactionSpeed==="fast"?800:1500}),!m&&t.type==="struggling"&&(s.push({type:"retry",blockId:e.id,timeSpent:1e3}),s.push({type:"answer",blockId:e.id,answer:o,correct:!0,timeSpent:2e3}));const h=s.reduce((f,y)=>f+y.timeSpent,0);return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:h}}function rt(e,t){const n=Date.now(),s=[];if(!(e.content||{}).question)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"No question text"},actions:[],timeSpent:Date.now()-n};const i=t.readContent?3e3:1e3;s.push({type:"view",blockId:e.id,timeSpent:i});const o=t.interactionSpeed==="slow"?15e3:t.interactionSpeed==="fast"?5e3:8e3;s.push({type:"answer",blockId:e.id,answer:"[Simulated open answer]",timeSpent:o});const r=s.reduce((c,l)=>c+l.timeSpent,0);return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:r}}function ct(e,t){const n=Date.now(),s=[],a=e.content||{},i=a.correct_order||a.correctOrder||[];if(i.length<2)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"Not enough items to order"},actions:[],timeSpent:Date.now()-n};s.push({type:"view",blockId:e.id,timeSpent:t.readContent?2e3:500});const o=i.length*(t.interactionSpeed==="slow"?2e3:1e3);s.push({type:"answer",blockId:e.id,answer:i,correct:Math.random()<t.correctAnswerRate,timeSpent:o});const r=s.reduce((c,l)=>c+l.timeSpent,0);return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:r}}function lt(e,t){const n=Date.now(),s=[],a=e.content||{},i=a.categories||[],o=a.items||[];if(i.length<2||o.length===0)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"Missing categories or items"},actions:[],timeSpent:Date.now()-n};s.push({type:"view",blockId:e.id,timeSpent:t.readContent?3e3:1e3});const r=o.length*(t.interactionSpeed==="slow"?1500:800);s.push({type:"answer",blockId:e.id,correct:Math.random()<t.correctAnswerRate,timeSpent:r});const c=s.reduce((l,m)=>l+m.timeSpent,0);return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:c}}function ut(e,t){const n=Date.now(),s=[],a=e.content||{},i=a.pairs||a.cards||[];if(i.length<2)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"Not enough pairs for memory game"},actions:[],timeSpent:Date.now()-n};s.push({type:"view",blockId:e.id,timeSpent:1e3});const o=i.length*3e3,r=t.type==="advanced"?.6:t.type==="struggling"?1.5:1,c=Math.round(o*r);s.push({type:"answer",blockId:e.id,correct:!0,timeSpent:c});const l=s.reduce((m,h)=>m+h.timeSpent,0);return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:l}}function dt(e,t){const n=Date.now(),s=[];if(!e.content)return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"missing_content",error:{blockId:e.id,blockType:e.type,errorType:"missing_data",errorMessage:"No media content/URL"},actions:[],timeSpent:Date.now()-n};const a=e.type==="video"?3e4:e.type==="text"?5e3:e.type==="image"?3e3:1e4,i=t.readContent?a:Math.round(a*.3);return s.push({type:"view",blockId:e.id,timeSpent:i}),{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:s,timeSpent:i}}function mt(e,t){try{switch(e.type){case"multiple-choice":return ot(e,t);case"open-question":return rt(e,t);case"ordering":return ct(e,t);case"categorization":return lt(e,t);case"memory_game":return ut(e,t);case"text":case"video":case"image":case"pdf":return dt(e,t);default:return{blockId:e.id,blockType:e.type,completed:!0,stuck:!1,actions:[{type:"view",blockId:e.id,timeSpent:2e3}],timeSpent:2e3}}}catch(n){return{blockId:e.id,blockType:e.type,completed:!1,stuck:!0,stuckReason:"error_thrown",error:{blockId:e.id,blockType:e.type,errorType:"crash",errorMessage:n.message,stackTrace:n.stack},actions:[],timeSpent:0}}}function pt(e,t){var c;const n=e.activityBlocks||[],s=[],a=[],i=[];let o=0,r=0;for(const l of n){const m=mt(l,t);s.push(m),r+=m.timeSpent,m.completed&&o++,m.stuck&&m.stuckReason&&a.push({blockId:l.id,blockType:l.type,reason:m.stuckReason,errorMessage:(c=m.error)==null?void 0:c.errorMessage}),m.error&&i.push(m.error)}return{unitId:e.id,unitTitle:e.title,completed:o===n.length&&n.length>0,blocksAttempted:n.length,blocksCompleted:o,blocksStuck:a,contentErrors:i,totalTime:r,blockResults:s}}function gt(e,t){const n=new Date,s=e.syllabus||[];let a=0,i=0,o=0,r=0;const c=[],l=[],m=[],h=[];let p=0;s.length===0&&m.push({location:`course_${e.id}`,problemType:"confusing_ui",description:"Course has no modules to navigate",severity:"high"});for(const g of s){const x=g.learningUnits||[];if(x.length===0){m.push({location:`module_${g.id}`,problemType:"confusing_ui",description:`Module "${g.title}" has no units`,severity:"medium"});continue}for(let b=0;b<x.length;b++){const _=x[b];a++;const $=pt(_,t);o+=$.blocksAttempted,r+=$.blocksCompleted,p+=$.totalTime,$.completed&&i++,c.push(...$.blocksStuck),l.push(...$.contentErrors),b<x.length-1&&$.blocksStuck.length>0&&h.push({fromUnit:_.id,toUnit:x[b+1].id,issue:"progress_not_saved",details:"Student got stuck but progress may not be saved correctly"})}}const u=o>0?Math.round(p/o):0,f=o>0?Math.round(c.length/o*100):0,y=o>0?Math.round(r/o*100):0;return{id:`sim_${e.id}_${Date.now()}`,courseId:e.id,simulationType:"full_course",studentProfile:t,startedAt:n,completedAt:new Date,status:c.length>0?"stuck":"completed",unitsAttempted:a,unitsCompleted:i,blocksAttempted:o,blocksCompleted:r,blocksStuck:c,navigationIssues:h,contentErrors:l,uxProblems:m,averageTimePerBlock:u,errorRate:f,completionRate:y}}async function ke(e=5,t=[{type:"average",correctAnswerRate:.7,useHints:!1,readContent:!0,interactionSpeed:"normal"}]){const n=Date.now(),s=[];console.log("ğŸ“ Student Simulation Agent starting..."),console.log(`   Testing with ${t.length} student profile(s)...`);try{const a=j(P(D,"courses"),Z("createdAt","desc"),B(e)),i=await M(a);let o=0,r=0,c=0;const l=[];for(const m of i.docs){const h={id:m.id,...m.data()};for(const p of t){o++;const u=gt(h,p),f=u.contentErrors.length>0||u.blocksStuck.some(b=>b.reason==="error_thrown"),y=u.blocksStuck.length>0||u.uxProblems.length>0,g=f?"failed":y?"warning":"passed",x={id:`sim_${h.id}_${p.type}`,name:`[${p.type}] ${h.title||h.id}`,nameHe:`[${p.type}] ${h.title||h.id}`,category:"student-simulation",status:g,severity:f?"critical":y?"medium":"low",message:`Completion: ${u.completionRate}% | Stuck: ${u.blocksStuck.length} | Errors: ${u.contentErrors.length}`,messageHe:`×”×©×œ××”: ${u.completionRate}% | ×ª×§×•×¢: ${u.blocksStuck.length} | ×©×’×™××•×ª: ${u.contentErrors.length}`,details:{courseId:h.id,profile:p.type,unitsAttempted:u.unitsAttempted,unitsCompleted:u.unitsCompleted,blocksAttempted:u.blocksAttempted,blocksCompleted:u.blocksCompleted,completionRate:u.completionRate,errorRate:u.errorRate,avgTimePerBlock:u.averageTimePerBlock,blocksStuck:u.blocksStuck,contentErrors:u.contentErrors,uxProblems:u.uxProblems,navigationIssues:u.navigationIssues},duration:u.completedAt?u.completedAt.getTime()-u.startedAt.getTime():0,timestamp:new Date};s.push(x),g==="passed"?r++:(c++,f&&l.push(x))}}return console.log(`âœ… Student Simulation completed: ${r}/${o} passed`),{agentType:"student-simulation",success:l.length===0,duration:Date.now()-n,testsRun:o,testsPassed:r,testsFailed:c,criticalIssues:l,allResults:s}}catch(a){return console.error("âŒ Student Simulation Agent failed:",a),{agentType:"student-simulation",success:!1,duration:Date.now()-n,testsRun:0,testsPassed:0,testsFailed:1,criticalIssues:[{id:"sim_agent_error",name:"Student Simulation Error",nameHe:"×©×’×™××ª ×¡×™××•×œ×¦×™×™×ª ×ª×œ××™×“",category:"student-simulation",status:"failed",severity:"critical",message:a.message,messageHe:a.message,duration:Date.now()-n,timestamp:new Date}],allResults:[]}}}const ht=[{topic:"××œ×—××ª ×”×¢×•×œ× ×”×©× ×™×™×”",gradeLevel:"×˜",subject:"×”×™×¡×˜×•×¨×™×”"},{topic:"×¤×•×˜×•×¡×™× ×ª×–×”",gradeLevel:"×–",subject:"××“×¢×™×"},{topic:"××©×•×•××•×ª ×¨×™×‘×•×¢×™×•×ª",gradeLevel:"×™",subject:"××ª××˜×™×§×”"}],G=`
×¤×•×˜×•×¡×™× ×ª×–×” ×”×™× ×ª×”×œ×™×š ×‘×™×•×›×™××™ ×©×‘×• ×¦××—×™×, ××¦×•×ª ×•×—×™×™×“×§×™× ××¡×•×™××™× ×”×•×¤×›×™× ××•×¨ ×©××© ×œ×× ×¨×’×™×” ×›×™××™×ª.
×”×ª×”×œ×™×š ××ª×¨×—×© ×‘×›×œ×•×¨×•×¤×œ×¡×˜×™× ×©×œ ×”×ª× ×”×¦××—×™, ×©× ×§×™×™× ×”×¤×™×’×× ×˜ ×”×™×¨×•×§ ×›×œ×•×¨×•×¤×™×œ.
×‘××”×œ×š ×”×¤×•×˜×•×¡×™× ×ª×–×”, ×”×¦××— ×§×•×œ×˜ ×¤×—××Ÿ ×“×•-×—××¦× ×™ ××”××•×•×™×¨ ×•××™× ××”××“××”, ×•×‘×¢×–×¨×ª ×× ×¨×’×™×™×ª ××•×¨
××™×™×¦×¨ ×’×œ×•×§×•×– ×•×—××¦×Ÿ. ×”×’×œ×•×§×•×– ××©××© ×œ×‘× ×™×™×ª ×¨×§××•×ª ×”×¦××— ×•×œ×™×™×¦×•×¨ ×× ×¨×’×™×”, ×•××™×œ×• ×”×—××¦×Ÿ ××©×ª×—×¨×¨ ×œ××˜××•×¡×¤×™×¨×”.
`;function yt(e){var o,r,c,l;const t=[];if(!e)return t.push({type:"invalid_json",message:"No output returned"}),{valid:!1,issues:t};!e.question&&!((o=e.content)!=null&&o.question)&&t.push({type:"empty_field",field:"question",message:"Missing question text"});const n=e.options||((r=e.content)==null?void 0:r.options)||[];n.length<2&&t.push({type:"schema_mismatch",field:"options",expected:"2-4 options",actual:`${n.length} options`,message:"Not enough options"}),e.correctAnswer||e.correct_answer||((c=e.content)==null?void 0:c.correctAnswer)||t.push({type:"empty_field",field:"correctAnswer",message:"Missing correct answer"});const a=e.question||((l=e.content)==null?void 0:l.question)||"",i=/[\u0590-\u05FF]/.test(a);return a&&!i&&t.push({type:"wrong_language",expected:"Hebrew",actual:"Non-Hebrew",message:"Question not in Hebrew"}),{valid:t.length===0,issues:t}}function ft(e){var a;const t=[];if(!e)return t.push({type:"invalid_json",message:"No output returned"}),{valid:!1,issues:t};const n=e.question||((a=e.content)==null?void 0:a.question)||"";(!n||n.length<10)&&t.push({type:"content_too_short",field:"question",message:"Question too short or missing"});const s=/[\u0590-\u05FF]/.test(n);return n&&!s&&t.push({type:"wrong_language",expected:"Hebrew",message:"Question not in Hebrew"}),{valid:t.length===0,issues:t}}function wt(e){const t=[];if(!e)return t.push({type:"invalid_json",message:"No output returned"}),{valid:!1,issues:t};const n=e.content||e,s=n.categories||[],a=n.items||[];s.length<2&&t.push({type:"schema_mismatch",field:"categories",expected:"2+ categories",actual:`${s.length}`,message:"Not enough categories"}),a.length<s.length&&t.push({type:"schema_mismatch",field:"items",message:"Fewer items than categories"});const i=a.filter(o=>!o.category||!s.includes(o.category));return i.length>0&&t.push({type:"schema_mismatch",field:"items",message:`${i.length} items with invalid category assignment`}),{valid:t.length===0,issues:t}}function xt(e){const t=[];if(!e)return t.push({type:"invalid_json",message:"No output returned"}),{valid:!1,issues:t};const n=e.content||e,s=n.correct_order||n.correctOrder||[];return s.length<3&&t.push({type:"schema_mismatch",field:"correct_order",expected:"3+ items",actual:`${s.length}`,message:"Not enough items to order"}),n.instruction||t.push({type:"empty_field",field:"instruction",message:"Missing instruction"}),{valid:t.length===0,issues:t}}function vt(e){const t=[];if(!e)return t.push({type:"invalid_json",message:"No output returned"}),{valid:!1,issues:t};const n=e.content||e,s=n.pairs||n.cards||[];s.length<4&&t.push({type:"schema_mismatch",field:"pairs",expected:"4+ pairs",actual:`${s.length}`,message:"Not enough pairs for memory game"});const a=s.filter(i=>!(i.left&&i.right)&&!(i.card_a&&i.card_b)&&!(i.term&&i.definition));return a.length>0&&t.push({type:"schema_mismatch",field:"pairs",message:`${a.length} pairs with invalid structure`}),{valid:t.length===0,issues:t}}async function bt(e,t,n,s=3e4){const a=Date.now(),i=`mc_${Date.now()}`;try{const o=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),s)),r=await Promise.race([le(e,t,null,n||G),o]),c=Date.now()-a,l=yt(r);return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"multiple-choice"},startedAt:new Date(a),completedAt:new Date,status:"completed",duration:c,retryCount:0,outputValid:l.valid,schemaMatch:l.valid,contentQualityScore:l.valid?100:Math.max(0,100-l.issues.length*25),issues:l.issues,generatedContent:r}}catch(o){const r=Date.now()-a,c=o.message==="Timeout";return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"multiple-choice"},startedAt:new Date(a),completedAt:new Date,status:c?"timeout":"failed",duration:r,retryCount:0,outputValid:!1,schemaMatch:!1,contentQualityScore:0,issues:[{type:c?"timeout":"invalid_json",message:o.message}]}}}async function $t(e,t,n,s=3e4){const a=Date.now(),i=`oq_${Date.now()}`;try{const o=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),s)),r=await Promise.race([be(e,t,null,n||G),o]),c=Date.now()-a,l=ft(r);return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"open-question"},startedAt:new Date(a),completedAt:new Date,status:"completed",duration:c,retryCount:0,outputValid:l.valid,schemaMatch:l.valid,contentQualityScore:l.valid?100:Math.max(0,100-l.issues.length*25),issues:l.issues,generatedContent:r}}catch(o){const r=Date.now()-a,c=o.message==="Timeout";return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"open-question"},startedAt:new Date(a),completedAt:new Date,status:c?"timeout":"failed",duration:r,retryCount:0,outputValid:!1,schemaMatch:!1,contentQualityScore:0,issues:[{type:c?"timeout":"invalid_json",message:o.message}]}}}async function _t(e,t,n,s=3e4){const a=Date.now(),i=`cat_${Date.now()}`;try{const o=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),s)),r=await Promise.race([ve(e,t,n||G),o]),c=Date.now()-a,l=wt(r);return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"categorization"},startedAt:new Date(a),completedAt:new Date,status:"completed",duration:c,retryCount:0,outputValid:l.valid,schemaMatch:l.valid,contentQualityScore:l.valid?100:Math.max(0,100-l.issues.length*25),issues:l.issues,generatedContent:r}}catch(o){const r=Date.now()-a;return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"categorization"},startedAt:new Date(a),completedAt:new Date,status:o.message==="Timeout"?"timeout":"failed",duration:r,retryCount:0,outputValid:!1,schemaMatch:!1,contentQualityScore:0,issues:[{type:o.message==="Timeout"?"timeout":"invalid_json",message:o.message}]}}}async function Tt(e,t,n,s=3e4){const a=Date.now(),i=`ord_${Date.now()}`;try{const o=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),s)),r=await Promise.race([xe(e,t,n||G),o]),c=Date.now()-a,l=xt(r);return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"ordering"},startedAt:new Date(a),completedAt:new Date,status:"completed",duration:c,retryCount:0,outputValid:l.valid,schemaMatch:l.valid,contentQualityScore:l.valid?100:Math.max(0,100-l.issues.length*25),issues:l.issues,generatedContent:r}}catch(o){const r=Date.now()-a;return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"ordering"},startedAt:new Date(a),completedAt:new Date,status:o.message==="Timeout"?"timeout":"failed",duration:r,retryCount:0,outputValid:!1,schemaMatch:!1,contentQualityScore:0,issues:[{type:o.message==="Timeout"?"timeout":"invalid_json",message:o.message}]}}}async function kt(e,t,n,s=3e4){const a=Date.now(),i=`mem_${Date.now()}`;try{const o=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),s)),r=await Promise.race([Be(e,t,n||G),o]),c=Date.now()-a,l=vt(r);return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"memory_game"},startedAt:new Date(a),completedAt:new Date,status:"completed",duration:c,retryCount:0,outputValid:l.valid,schemaMatch:l.valid,contentQualityScore:l.valid?100:Math.max(0,100-l.issues.length*25),issues:l.issues,generatedContent:r}}catch(o){const r=Date.now()-a;return{id:i,testType:"activity_generation",inputParams:{topic:e,gradeLevel:t,type:"memory_game"},startedAt:new Date(a),completedAt:new Date,status:o.message==="Timeout"?"timeout":"failed",duration:r,retryCount:0,outputValid:!1,schemaMatch:!1,contentQualityScore:0,issues:[{type:o.message==="Timeout"?"timeout":"invalid_json",message:o.message}]}}}async function Ce(e=["multiple-choice","open-question"],t=3e4){const n=Date.now(),s=[],a=[];console.log("ğŸ¤– AI Generation Agent starting..."),console.log(`   Testing types: ${e.join(", ")}`);let i=0,o=0,r=0;const c=[];for(const h of ht){const{topic:p,gradeLevel:u}=h;for(const f of e){i++;let y;switch(f){case"multiple-choice":y=await bt(p,u,G,t);break;case"open-question":y=await $t(p,u,G,t);break;case"categorization":y=await _t(p,u,G,t);break;case"ordering":y=await Tt(p,u,G,t);break;case"memory_game":y=await kt(p,u,G,t);break;default:continue}a.push(y);const g=y.status==="completed"&&y.outputValid,x=g?"passed":y.status==="timeout"?"warning":"failed",b={id:y.id,name:`[${f}] ${p}`,nameHe:`[${f}] ${p}`,category:"ai-generation",status:x,severity:y.status==="failed"?"high":y.status==="timeout"?"medium":"low",message:`Duration: ${y.duration}ms | Quality: ${y.contentQualityScore}% | Issues: ${y.issues.length}`,messageHe:`××©×š: ${y.duration}ms | ××™×›×•×ª: ${y.contentQualityScore}% | ×‘×¢×™×•×ª: ${y.issues.length}`,details:{testType:f,topic:p,gradeLevel:u,duration:y.duration,qualityScore:y.contentQualityScore,outputValid:y.outputValid,issues:y.issues,generatedContentPreview:y.generatedContent?JSON.stringify(y.generatedContent).substring(0,200)+"...":null},duration:y.duration,timestamp:new Date};s.push(b),g?o++:(r++,y.status==="failed"&&c.push(b)),await new Promise(_=>setTimeout(_,500))}}const l=a.length>0?Math.round(a.reduce((h,p)=>h+p.duration,0)/a.length):0,m=a.length>0?Math.round(a.reduce((h,p)=>h+p.contentQualityScore,0)/a.length):0;return console.log("âœ… AI Generation Agent completed:"),console.log(`   Passed: ${o}/${i}`),console.log(`   Avg Duration: ${l}ms`),console.log(`   Avg Quality: ${m}%`),s.push({id:"ai_gen_summary",name:"AI Generation Summary",nameHe:"×¡×™×›×•× ×™×¦×™×¨×ª AI",category:"ai-generation",status:r===0?"passed":r>i/2?"failed":"warning",severity:"info",message:`Avg Duration: ${l}ms | Avg Quality: ${m}% | Pass Rate: ${Math.round(o/i*100)}%`,messageHe:`××©×š ×××•×¦×¢: ${l}ms | ××™×›×•×ª ×××•×¦×¢×ª: ${m}% | ××—×•×– ×”×¦×œ×—×”: ${Math.round(o/i*100)}%`,details:{avgDuration:l,avgQuality:m,passRate:Math.round(o/i*100),testsPerType:e.map(h=>({type:h,count:a.filter(p=>p.inputParams.type===h).length}))},duration:Date.now()-n,timestamp:new Date}),{agentType:"ai-generation",success:r===0,duration:Date.now()-n,testsRun:i,testsPassed:o,testsFailed:r,criticalIssues:c,allResults:s}}const F={history:{topic:"××œ×—××ª ×”×¢×•×œ× ×”×©× ×™×™×”",gradeLevel:"×˜",subject:"×”×™×¡×˜×•×¨×™×”",text:`
××œ×—××ª ×”×¢×•×œ× ×”×©× ×™×™×” ×”×™×™×ª×” ×”×¡×›×¡×•×š ×”×¦×‘××™ ×”×’×“×•×œ ×•×”×§×˜×œ× ×™ ×‘×™×•×ª×¨ ×‘×”×™×¡×˜×•×¨×™×” ×”×× ×•×©×™×ª.
×”××œ×—××” ×”×ª× ×”×œ×” ×‘×™×Ÿ ×©×ª×™ ×‘×¨×™×ª ×¦×‘××™×•×ª: ××¢×¦××•×ª ×”×¦×™×¨ (×’×¨×× ×™×”, ××™×˜×œ×™×” ×•×™×¤×Ÿ) ×•×‘×¢×œ×•×ª ×”×‘×¨×™×ª (×‘×¨×™×˜× ×™×”, ×‘×¨×™×ª ×”××•×¢×¦×•×ª, ××¨×¦×•×ª ×”×‘×¨×™×ª ×•×¦×¨×¤×ª).
×”××œ×—××” ×”×—×œ×” ×‘-1 ×‘×¡×¤×˜××‘×¨ 1939 ×¢× ×¤×œ×™×©×ª ×’×¨×× ×™×” ×”× ××¦×™×ª ×œ×¤×•×œ×™×Ÿ ×•×”×¡×ª×™×™××” ×‘-2 ×‘×¡×¤×˜××‘×¨ 1945 ×¢× ×›× ×™×¢×ª ×™×¤×Ÿ.
×‘××”×œ×š ×”××œ×—××” ×”×ª×¨×—×©×” ×”×©×•××” - ×¨×¦×— ×©×™×˜×ª×™ ×©×œ ×©×™×©×” ××™×œ×™×•×Ÿ ×™×”×•×“×™× ×¢×œ ×™×“×™ ×”× ××¦×™×.
×”××œ×—××” ×”×‘×™××” ×œ×©×™× ×•×™×™× ×’×™××•×¤×•×œ×™×˜×™×™× ×¢×¦×•××™× ×•×”×•×‘×™×œ×” ×œ×”×§××ª ×”××•"× ×•×œ××œ×—××” ×”×§×¨×”.
    `.trim()},science:{topic:"×¤×•×˜×•×¡×™× ×ª×–×”",gradeLevel:"×–",subject:"××“×¢×™×",text:`
×¤×•×˜×•×¡×™× ×ª×–×” ×”×™× ×ª×”×œ×™×š ×‘×™×•×›×™××™ ×©×‘×• ×¦××—×™×, ××¦×•×ª ×•×—×™×™×“×§×™× ××¡×•×™××™× ×”×•×¤×›×™× ××•×¨ ×©××© ×œ×× ×¨×’×™×” ×›×™××™×ª.
×”×ª×”×œ×™×š ××ª×¨×—×© ×‘×›×œ×•×¨×•×¤×œ×¡×˜×™× ×©×œ ×”×ª× ×”×¦××—×™, ×©× ×§×™×™× ×”×¤×™×’×× ×˜ ×”×™×¨×•×§ ×›×œ×•×¨×•×¤×™×œ.
×‘××”×œ×š ×”×¤×•×˜×•×¡×™× ×ª×–×”, ×”×¦××— ×§×•×œ×˜ ×¤×—××Ÿ ×“×•-×—××¦× ×™ ××”××•×•×™×¨ ×•××™× ××”××“××”, ×•×‘×¢×–×¨×ª ×× ×¨×’×™×™×ª ××•×¨
××™×™×¦×¨ ×’×œ×•×§×•×– ×•×—××¦×Ÿ. ×”×’×œ×•×§×•×– ××©××© ×œ×‘× ×™×™×ª ×¨×§××•×ª ×”×¦××— ×•×œ×™×™×¦×•×¨ ×× ×¨×’×™×”.
×”×—××¦×Ÿ ××©×ª×—×¨×¨ ×œ××˜××•×¡×¤×™×¨×” ×•××©××© ×œ× ×©×™××” ×©×œ ×‘×¢×œ×™ ×—×™×™× ×•×‘× ×™ ××“×.
×”××©×•×•××” ×”×›×œ×œ×™×ª: 6CO2 + 6H2O + ××•×¨ â†’ C6H12O6 + 6O2
    `.trim()},math:{topic:"××©×•×•××•×ª ×¨×™×‘×•×¢×™×•×ª",gradeLevel:"×™",subject:"××ª××˜×™×§×”",text:`
××©×•×•××” ×¨×™×‘×•×¢×™×ª ×”×™× ××©×•×•××” ××”×¦×•×¨×” axÂ² + bx + c = 0, ×›××©×¨ a â‰  0.
×”×¤×ª×¨×•× ×•×ª ×©×œ ×”××©×•×•××” × ×§×¨××™× ×©×•×¨×©×™× ×•××¡×•×× ×™× xâ‚ ×•-xâ‚‚.
× ×•×¡×—×ª ×”×©×•×¨×©×™×: x = (-b Â± âˆš(bÂ²-4ac)) / 2a
×”×‘×™×˜×•×™ Î” = bÂ² - 4ac × ×§×¨× ×“×™×¡×§×¨×™××™× × ×˜×” ×•×§×•×‘×¢ ××ª ××¡×¤×¨ ×”×¤×ª×¨×•× ×•×ª:
- ×× Î” > 0: ×©× ×™ ×¤×ª×¨×•× ×•×ª ×©×•× ×™×
- ×× Î” = 0: ×¤×ª×¨×•×Ÿ ×™×—×™×“ (×©×•×¨×© ×›×¤×•×œ)
- ×× Î” < 0: ××™×Ÿ ×¤×ª×¨×•× ×•×ª ×××©×™×™×
××©×•×•××•×ª ×¨×™×‘×•×¢×™×•×ª ××•×¤×™×¢×•×ª ×‘×‘×¢×™×•×ª ×¤×™×–×™×§×œ×™×•×ª ×¨×‘×•×ª ×›××• ×ª× ×•×¢×” ×‘×›×•×— ×”×›×‘×™×“×”.
    `.trim()},literature:{topic:"×©×™×¨×ª ×‘×™××œ×™×§",gradeLevel:"×—",subject:"×¡×¤×¨×•×ª",text:`
×—×™×™× × ×—××Ÿ ×‘×™××œ×™×§ (1873-1934) × ×—×©×‘ ×œ××©×•×¨×¨ ×”×œ××•××™ ×©×œ ×”×¢× ×”×™×”×•×“×™.
×©×™×¨×ª×• ××©×œ×‘×ª ××•×˜×™×‘×™× ××”××¡×•×¨×ª ×”×™×”×•×“×™×ª ×¢× ×¨×’×©×•×ª ××™×©×™×™× ×•×œ××•××™×™×.
×”×©×™×¨ "××œ ×”×¦×™×¤×•×¨" ××‘×™×¢ ×’×¢×’×•×¢×™× ×œ××¨×¥ ×™×©×¨××œ ×•×ª×§×•×•×” ×œ×©×™×‘×ª ×¦×™×•×Ÿ.
×‘×©×™×¨ "×‘×¢×™×¨ ×”×”×¨×’×”" ××ª××¨ ×‘×™××œ×™×§ ××ª ×¤×¨×¢×•×ª ×§×™×©×™× ×‘ ×•××‘×§×¨ ××ª ×”×¤×¡×™×‘×™×•×ª ×”×™×”×•×“×™×ª.
×‘×™××œ×™×§ ×›×ª×‘ ×’× ×©×™×¨×™ ×™×œ×“×™× ×›××• "×¦×¤ ×¦×¤ ×¦×¤×¨×“×¢×™×" ×”××ª××¨ ×¡×™×¤×•×¨ ××”×’×“×” ×©×œ ×¤×¡×—.
×©×¤×ª×• ×¢×©×™×¨×” ×•××œ×™×¦×™×ª, ××©×œ×‘×ª ×¢×‘×¨×™×ª ××§×¨××™×ª ×¢× ×¢×‘×¨×™×ª ××•×“×¨× ×™×ª.
    `.trim()}},ce={math:{url:"https://www.youtube.com/watch?v=NybHckSEQBI",topic:"××©×•×•××•×ª",gradeLevel:"×—",subject:"××ª××˜×™×§×”",expectedMinLength:100}};function Se(e){const t=[];let n=100;if(!e)return t.push({type:"empty_content",message:"Syllabus is null or undefined",severity:"critical"}),{valid:!1,issues:t,score:0};if(!Array.isArray(e)||e.length===0)return t.push({type:"empty_content",message:"Syllabus has no modules",severity:"critical"}),{valid:!1,issues:t,score:0};let s=0,a=0,i=0;return e.forEach((o,r)=>{o.title||(t.push({type:"invalid_structure",message:`Module ${r} has no title`,severity:"medium"}),n-=5);const c=o.learningUnits||o.units||[];s+=c.length,c.length===0&&(t.push({type:"missing_blocks",message:`Module "${o.title||r}" has no units`,severity:"high"}),n-=10),c.forEach((l,m)=>{l.title||(t.push({type:"invalid_structure",message:`Unit ${r}.${m} has no title`,severity:"medium"}),n-=3);const h=l.activityBlocks||l.blocks||[];a+=h.length,h.length===0&&i++})}),s>0&&i/s>.3&&(t.push({type:"quality_issue",message:`${i}/${s} units have no blocks (${Math.round(i/s*100)}%)`,severity:"medium"}),n-=15),{valid:t.filter(o=>o.severity==="critical").length===0,issues:t,score:Math.max(0,n)}}function Ct(e){const t=[];let n=100;if(!e)return t.push({type:"empty_content",message:"Podcast script is null",severity:"critical"}),{valid:!1,issues:t,score:0};const s=e.dialogue||e.turns||e.script||[];(!Array.isArray(s)||s.length<4)&&(t.push({type:"quality_issue",message:`Script too short: ${s.length} turns`,severity:"high"}),n-=30);const a=JSON.stringify(e);return(a.match(/[\u0590-\u05FF]/g)||[]).length/a.length<.3&&(t.push({type:"quality_issue",message:"Script has insufficient Hebrew content",severity:"medium"}),n-=20),new Set(s.map(r=>r.speaker||r.name||r.host)).size<2&&(t.push({type:"quality_issue",message:"Script should have 2 speakers/hosts",severity:"medium"}),n-=15),{valid:t.filter(r=>r.severity==="critical").length===0,issues:t,score:Math.max(0,n)}}function St(e){const t=[];let n=100;if(!e||e.length===0)return t.push({type:"empty_content",message:"No interactive blocks generated",severity:"critical"}),{valid:!1,issues:t,score:0};let s=0;return e.forEach((a,i)=>{if(!a.type){t.push({type:"invalid_structure",message:`Block ${i} has no type`,severity:"high"}),n-=10;return}if(a.type==="multiple-choice"){const o=a.content||{};o.question?!o.options||o.options.length<2?(t.push({type:"invalid_structure",message:`MC block ${i} has insufficient options`,severity:"high"}),n-=10):o.correctAnswer?o.options.map(c=>typeof c=="string"?c:c.text||c.label).includes(o.correctAnswer)?s++:(t.push({type:"quality_issue",message:`MC block ${i}: correct answer not in options`,severity:"medium"}),n-=5):(t.push({type:"invalid_structure",message:`MC block ${i} has no correct answer`,severity:"high"}),n-=10):(t.push({type:"invalid_structure",message:`MC block ${i} has no question`,severity:"high"}),n-=10)}else if(a.type==="open-question"){const o=a.content||{};!o.question||o.question.length<10?(t.push({type:"invalid_structure",message:`Open question ${i} too short`,severity:"medium"}),n-=5):s++}else s++}),{valid:s>0,issues:t,score:Math.max(0,n)}}async function he(e,t=6e4){const n=Date.now(),s=[];try{const a=new Promise((m,h)=>setTimeout(()=>h(new Error("Timeout")),t)),i=await Promise.race([$e(e.text,e.topic,e.gradeLevel,e.subject),a]);if(!i)return{testType:"lesson_from_text",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:"empty_content",message:"generateCourseSyllabus returned null",severity:"critical"}],outputPreview:null};const o=Se(i);s.push(...o.issues);let r=0,c=0;return(Array.isArray(i)?i:[i]).forEach(m=>{const h=m.learningUnits||m.units||[];r+=h.length,h.forEach(p=>{c+=(p.activityBlocks||p.blocks||[]).length})}),{testType:"lesson_from_text",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:o.valid?o.score>=70?"passed":"warning":"failed",syllabusGenerated:!0,unitsGenerated:r,blocksGenerated:c,qualityScore:o.score,issues:s,outputPreview:JSON.stringify(i).substring(0,500)}}catch(a){return{testType:"lesson_from_text",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:a.message==="Timeout"?"timeout":"api_error",message:a.message,severity:"critical"}],outputPreview:null}}}async function At(e,t=6e4){const n=Date.now(),s=[];try{const a=new Promise((c,l)=>setTimeout(()=>l(new Error("Timeout")),t)),i=await Promise.race([He(e.text,e.topic,e.gradeLevel,"medium"),a]);if(!i)return{testType:"podcast",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:"empty_content",message:"generatePodcastScript returned null",severity:"critical"}],outputPreview:null};const o=Ct(i);s.push(...o.issues);const r=i.dialogue||i.turns||i.script||[];return{testType:"podcast",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:o.valid?o.score>=70?"passed":"warning":"failed",syllabusGenerated:!0,unitsGenerated:1,blocksGenerated:r.length,qualityScore:o.score,issues:s,outputPreview:JSON.stringify(i).substring(0,500)}}catch(a){return{testType:"podcast",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:a.message==="Timeout"?"timeout":"api_error",message:a.message,severity:"critical"}],outputPreview:null}}}async function It(e,t=6e4){const n=Date.now(),s=[],a=[];try{const i=[le(e.topic,e.gradeLevel,null,e.text),be(e.topic,e.gradeLevel,null,e.text),ve(e.topic,e.gradeLevel,e.text),xe(e.topic,e.gradeLevel,e.text)],o=new Promise((l,m)=>setTimeout(()=>m(new Error("Timeout")),t)),r=await Promise.race([Promise.all(i),o]);r&&a.push(...r.filter(Boolean));const c=St(a);return s.push(...c.issues),{testType:"activity",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:c.valid?c.score>=70?"passed":"warning":"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:a.length,qualityScore:c.score,issues:s,outputPreview:JSON.stringify(a).substring(0,500)}}catch(i){return{testType:"activity",sourceType:"text",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:a.length,qualityScore:0,issues:[{type:i.message==="Timeout"?"timeout":"api_error",message:i.message,severity:"critical"}],outputPreview:null}}}async function Dt(e,t=12e4){var a;const n=Date.now(),s=[];try{console.log(`   ğŸ“¹ Transcribing YouTube video: ${e.url}`);const i=new Promise((u,f)=>setTimeout(()=>f(new Error("Timeout")),t));let o;try{const u=await Promise.race([Le.processYoutubeUrl(e.url),i]);if(!u||!u.text)return{testType:"lesson_from_youtube",sourceType:"youtube",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:"empty_content",message:"YouTube transcription returned empty",severity:"critical"}],outputPreview:null};o=u.text,console.log(`   âœ… Transcription successful: ${o.length} characters`),o.length<e.expectedMinLength&&s.push({type:"quality_issue",message:`Transcript too short: ${o.length} chars (expected ${e.expectedMinLength}+)`,severity:"medium"})}catch(u){const f=u==null?void 0:u.code;let y="api_error",g=u.message||"Unknown transcription error";return f===re.NO_CAPTIONS?(y="quality_issue",g="Video has no captions available"):f===re.PRIVATE_VIDEO?(y="api_error",g="Video is private or restricted"):f===re.VIDEO_NOT_FOUND&&(y="api_error",g="Video not found"),{testType:"lesson_from_youtube",sourceType:"youtube",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"warning",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:y,message:g,severity:"high"}],outputPreview:`Transcription error: ${g}`}}console.log("   ğŸ“ Generating syllabus from transcript...");const r=await Promise.race([$e(o,e.topic,e.gradeLevel,e.subject),new Promise((u,f)=>setTimeout(()=>f(new Error("Syllabus generation timeout")),6e4))]);if(!r)return{testType:"lesson_from_youtube",sourceType:"youtube",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:30,issues:[...s,{type:"empty_content",message:"Syllabus generation returned null",severity:"critical"}],outputPreview:`Transcript: ${o.substring(0,200)}...`};const c=Se(r);s.push(...c.issues);let l=0,m=0;(Array.isArray(r)?r:[r]).forEach(u=>{const f=u.learningUnits||u.units||[];l+=f.length,f.forEach(y=>{m+=(y.activityBlocks||y.blocks||[]).length})});const p=Math.min(100,c.score+10);return{testType:"lesson_from_youtube",sourceType:"youtube",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:c.valid?p>=70?"passed":"warning":"failed",syllabusGenerated:!0,unitsGenerated:l,blocksGenerated:m,qualityScore:p,issues:s,outputPreview:JSON.stringify(r).substring(0,500)}}catch(i){return{testType:"lesson_from_youtube",sourceType:"youtube",subject:e.subject,gradeLevel:e.gradeLevel,startedAt:new Date(n),completedAt:new Date,duration:Date.now()-n,status:"failed",syllabusGenerated:!1,unitsGenerated:0,blocksGenerated:0,qualityScore:0,issues:[{type:(a=i.message)!=null&&a.includes("Timeout")?"timeout":"api_error",message:i.message||"Unknown error",severity:"critical"}],outputPreview:null}}}async function Ae(){const e=Date.now(),t=[],n=[];console.log("ğŸš€ Starting E2E Generation Agent..."),console.log("ğŸ“ Testing: Lesson from Text (History)...");const s=await he(F.history);n.push(s),t.push({id:`e2e_lesson_history_${Date.now()}`,name:`[lesson] ${F.history.topic}`,nameHe:`[××¢×¨×š ×©×™×¢×•×¨] ${F.history.topic}`,category:"e2e-generation",status:s.status,severity:"high",message:`Duration: ${s.duration}ms | Units: ${s.unitsGenerated} | Quality: ${s.qualityScore}%`,messageHe:`××©×š: ${s.duration}ms | ×™×—×™×“×•×ª: ${s.unitsGenerated} | ××™×›×•×ª: ${s.qualityScore}%`,details:s,duration:s.duration,timestamp:new Date}),console.log("ğŸ“ Testing: Lesson from Text (Science)...");const a=await he(F.science);n.push(a),t.push({id:`e2e_lesson_science_${Date.now()}`,name:`[lesson] ${F.science.topic}`,nameHe:`[××¢×¨×š ×©×™×¢×•×¨] ${F.science.topic}`,category:"e2e-generation",status:a.status,severity:"high",message:`Duration: ${a.duration}ms | Units: ${a.unitsGenerated} | Quality: ${a.qualityScore}%`,messageHe:`××©×š: ${a.duration}ms | ×™×—×™×“×•×ª: ${a.unitsGenerated} | ××™×›×•×ª: ${a.qualityScore}%`,details:a,duration:a.duration,timestamp:new Date}),console.log("ğŸ™ï¸ Testing: Podcast Generation...");const i=await At(F.literature);n.push(i),t.push({id:`e2e_podcast_${Date.now()}`,name:`[podcast] ${F.literature.topic}`,nameHe:`[×¤×•×“×§××¡×˜] ${F.literature.topic}`,category:"e2e-generation",status:i.status,severity:"high",message:`Duration: ${i.duration}ms | Turns: ${i.blocksGenerated} | Quality: ${i.qualityScore}%`,messageHe:`××©×š: ${i.duration}ms | ×ª×•×¨×•×ª: ${i.blocksGenerated} | ××™×›×•×ª: ${i.qualityScore}%`,details:i,duration:i.duration,timestamp:new Date}),console.log("ğŸ® Testing: Interactive Blocks Generation...");const o=await It(F.math);n.push(o),t.push({id:`e2e_game_${Date.now()}`,name:`[activity] ${F.math.topic}`,nameHe:`[×¤×¢×™×œ×•×ª] ${F.math.topic}`,category:"e2e-generation",status:o.status,severity:"high",message:`Duration: ${o.duration}ms | Blocks: ${o.blocksGenerated} | Quality: ${o.qualityScore}%`,messageHe:`××©×š: ${o.duration}ms | ×‘×œ×•×§×™×: ${o.blocksGenerated} | ××™×›×•×ª: ${o.qualityScore}%`,details:o,duration:o.duration,timestamp:new Date}),console.log("ğŸ“¹ Testing: Lesson from YouTube...");const r=await Dt(ce.math);n.push(r),t.push({id:`e2e_youtube_${Date.now()}`,name:`[youtubeâ†’lesson] ${ce.math.topic}`,nameHe:`[×™×•×˜×™×•×‘â†’××¢×¨×š ×©×™×¢×•×¨] ${ce.math.topic}`,category:"e2e-generation",status:r.status,severity:"high",message:`Duration: ${r.duration}ms | Units: ${r.unitsGenerated} | Quality: ${r.qualityScore}%`,messageHe:`××©×š: ${r.duration}ms | ×™×—×™×“×•×ª: ${r.unitsGenerated} | ××™×›×•×ª: ${r.qualityScore}%`,details:r,duration:r.duration,timestamp:new Date});const c=n.filter(u=>u.status==="passed").length,l=n.filter(u=>u.status==="failed").length,m=n.filter(u=>u.status==="warning").length,h=Math.round(n.reduce((u,f)=>u+f.qualityScore,0)/n.length),p=Math.round(n.reduce((u,f)=>u+f.duration,0)/n.length);return t.push({id:`e2e_summary_${Date.now()}`,name:"E2E Generation Summary",nameHe:"×¡×™×›×•× ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××§×¦×” ×œ×§×¦×”",category:"e2e-generation",status:l===0?m===0?"passed":"warning":"failed",severity:"critical",message:`Passed: ${c}/${n.length} | Avg Quality: ${h}% | Avg Duration: ${p}ms`,messageHe:`×¢×‘×¨×•: ${c}/${n.length} | ××™×›×•×ª ×××•×¦×¢×ª: ${h}% | ××©×š ×××•×¦×¢: ${p}ms`,details:{totalTests:n.length,passed:c,failed:l,warnings:m,avgQuality:h,avgDuration:p,byType:{lesson:n.filter(u=>u.testType==="lesson_from_text").length,youtube:n.filter(u=>u.testType==="lesson_from_youtube").length,podcast:n.filter(u=>u.testType==="podcast").length,activity:n.filter(u=>u.testType==="activity").length}},duration:Date.now()-e,timestamp:new Date}),console.log(`âœ… E2E Generation Agent completed: ${c}/${n.length} passed`),{agentName:"E2E Generation Agent",agentNameHe:"×¡×•×›×Ÿ ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××§×¦×” ×œ×§×¦×”",status:l===0?"passed":"failed",tests:t,summary:{totalTests:t.length,passed:c+(l===0?1:0),failed:l,warnings:m,duration:Date.now()-e}}}function Ie(e,t,n){let s=0,a=0,i=0;return e&&(t===1?n>0?s=Math.max(0,L.CORRECT_FIRST_TRY-n*L.HINT_PENALTY):s=L.CORRECT_FIRST_TRY:s=L.RETRY_PARTIAL,a=s,i=1,s===100&&(i=2)),{score:s,xp:a,gems:i}}function se(e,t,n){var g;const s=e.content||{},a=s.options||[],i=s.correctAnswer||s.correct_answer,o=((g=e.metadata)==null?void 0:g.progressiveHints)||[],r=[];if(a.length===0&&r.push({type:"invalid_options",severity:"critical",message:"Multiple choice has no options",messageHe:"×©××œ×ª ×‘×—×™×¨×” ×œ×œ× ××¤×©×¨×•×™×•×ª"}),i||r.push({type:"no_correct_answer",severity:"critical",message:"No correct answer defined",messageHe:"×œ× ××•×’×“×¨×ª ×ª×©×•×‘×” × ×›×•× ×”"}),i&&a.length>0){const x=a.map(b=>typeof b=="string"?b:b.text||b.label||b.value||"");x.includes(i)||r.push({type:"answer_not_in_options",severity:"critical",message:`Correct answer "${i}" not found in options`,messageHe:`×”×ª×©×•×‘×” ×”× ×›×•× ×” "${i}" ×œ× × ××¦××ª ×‘××¤×©×¨×•×™×•×ª`,expected:i,actual:x})}let c=1,l=0,m=!1,h=a[0];switch(n){case"correct_first":c=1,l=0,m=!0,h=i;break;case"correct_with_hints":c=1,l=Math.min(2,o.length),m=!0,h=i,t&&l>0&&r.push({type:"exam_hint_allowed",severity:"critical",message:"Hints should be disabled in exam mode",messageHe:"×¨××–×™× ×¦×¨×™×›×™× ×œ×”×™×•×ª ×—×¡×•××™× ×‘××¦×‘ ××‘×—×Ÿ"});break;case"correct_after_retry":c=2,l=0,m=!0,h=i;break;case"incorrect":c=1,l=0,m=!1,h=a.find(x=>x!==i)||a[0];break}const{score:p,xp:u,gems:f}=Ie(m,c,l),y=U({isCorrect:m,attempts:c,hintsUsed:l});return y!==p&&r.push({type:"scoring_mismatch",severity:"critical",message:`Scoring function returned ${y}, expected ${p}`,messageHe:`×¤×•× ×§×¦×™×™×ª ×”× ×™×§×•×“ ×”×—×–×™×¨×” ${y}, ×¦×¤×•×™ ${p}`,expected:p,actual:y}),{blockId:e.id,blockType:e.type,questionText:s.question,attempts:c,hintsUsed:l,responseTimeSec:5,selectedAnswer:h,correctAnswer:i,isCorrect:m,expectedScore:p,actualScore:y,scoreMatch:y===p,expectedXP:u,expectedGems:f,issues:r}}function Rt(e,t){var a;const n=e.content||{},s=[];return n.question||s.push({type:"invalid_options",severity:"high",message:"Open question has no question text",messageHe:"×©××œ×” ×¤×ª×•×—×” ×œ×œ× ×˜×§×¡×˜ ×©××œ×”"}),{blockId:e.id,blockType:e.type,questionText:n.question,attempts:1,hintsUsed:0,responseTimeSec:30,selectedAnswer:"[Simulated open answer]",correctAnswer:n.modelAnswer||((a=e.metadata)==null?void 0:a.modelAnswer),isCorrect:!0,expectedScore:100,scoreMatch:!0,expectedXP:100,expectedGems:2,issues:s}}function Nt(e,t){const n=e.content||{},s=n.correct_order||n.correctOrder||[],a=[];s.length<2&&a.push({type:"invalid_options",severity:"critical",message:"Ordering activity has less than 2 items",messageHe:"×¤×¢×™×œ×•×ª ×¡×™×“×•×¨ ×¢× ×¤×—×•×ª ×-2 ×¤×¨×™×˜×™×"});const i=t==="correct",{score:o,xp:r,gems:c}=Ie(i,1,0);return{blockId:e.id,blockType:e.type,questionText:n.instruction||n.question,attempts:1,hintsUsed:0,responseTimeSec:15,selectedAnswer:i?s:[...s].reverse(),correctAnswer:s,isCorrect:i,expectedScore:o,scoreMatch:!0,expectedXP:r,expectedGems:c,issues:a}}function ye(e,t){const n=Date.now(),s=[],a=[],i=e.syllabus||[];let o=0,r=0,c=0,l=0,m=0,h=0,p=0,u=0;for(const f of i)for(const y of f.learningUnits||[])for(const g of y.activityBlocks||[])["multiple-choice","open-question","ordering","categorization","fill-in-blanks","true-false"].includes(g.type)&&o++;for(const f of i)for(const y of f.learningUnits||[])for(const g of y.activityBlocks||[]){let x=null;switch(g.type){case"multiple-choice":case"true-false":if(r===0)x=se(g,t,"correct_first"),c++;else if(r===1)x=se(g,t,"correct_with_hints"),l++;else if(r===2)x=se(g,t,"correct_after_retry"),m++;else if(r===3)x=se(g,t,"incorrect"),h++;else{const b=["correct_first","correct_with_hints","correct_after_retry","incorrect"],_=b[Math.floor(Math.random()*b.length)];x=se(g,t,_),_==="correct_first"?c++:_==="correct_with_hints"?l++:_==="correct_after_retry"?m++:h++}break;case"open-question":x=Rt(g),c++;break;case"ordering":x=Nt(g,r%2===0?"correct":"incorrect"),x.isCorrect?c++:h++;break}x&&(s.push(x),a.push(...x.issues),r++,p+=x.expectedScore,u+=x.actualScore||x.expectedScore)}return{sessionId:`activity_${e.id}_${Date.now()}`,courseId:e.id,courseTitle:e.title||e.id,isExamMode:t,totalBlocks:o,blocksAttempted:r,blocksCorrectFirstTry:c,blocksCorrectWithHints:l,blocksCorrectAfterRetry:m,blocksIncorrect:h,totalExpectedScore:p,totalActualScore:u,scoringAccurate:p===u,issues:a,attempts:s,totalTime:Date.now()-n}}async function De(e=5,t=!0){const n=Date.now(),s=[];console.log("ğŸ“ Student Activity Agent starting..."),console.log(`   Testing activities and scoring on ${e} courses...`);try{const a=j(P(D,"courses"),Z("createdAt","desc"),B(e)),i=await M(a);let o=0,r=0,c=0;const l=[];for(const h of i.docs){const p={id:h.id,...h.data()},u=ye(p,!1);o++;const f=u.issues.filter($=>$.severity==="critical"),y=u.issues.filter($=>$.severity==="high"),g=f.length>0,x=y.length>0||!u.scoringAccurate,b=g?"failed":x?"warning":"passed",_={id:`activity_learning_${p.id}`,name:`[Learning Mode] ${p.title||p.id}`,nameHe:`[××¦×‘ ×œ××™×“×”] ${p.title||p.id}`,category:"student-activity",status:b,severity:g?"critical":x?"high":"low",message:`Blocks: ${u.blocksAttempted}/${u.totalBlocks} | Score: ${u.totalActualScore}/${u.totalExpectedScore} | Issues: ${u.issues.length}`,messageHe:`×‘×œ×•×§×™×: ${u.blocksAttempted}/${u.totalBlocks} | × ×™×§×•×“: ${u.totalActualScore}/${u.totalExpectedScore} | ×‘×¢×™×•×ª: ${u.issues.length}`,details:{courseId:p.id,mode:"learning",...u,issuesSummary:{critical:f.length,high:y.length,medium:u.issues.filter($=>$.severity==="medium").length,low:u.issues.filter($=>$.severity==="low").length}},duration:u.totalTime,timestamp:new Date};if(s.push(_),b==="passed"?r++:(c++,g&&l.push(_)),t){const $=ye(p,!0);o++;const N=$.issues.filter(q=>q.severity==="critical"),Q=$.issues.filter(q=>q.severity==="high"),V=N.length>0,T=Q.length>0,R=$.attempts.filter(q=>q.hintsUsed>0&&q.issues.some(ae=>ae.type==="exam_hint_allowed"));R.length>0&&$.issues.push({type:"exam_hint_allowed",severity:"critical",message:`${R.length} blocks allowed hints in exam mode`,messageHe:`${R.length} ×‘×œ×•×§×™× ××¤×©×¨×• ×¨××–×™× ×‘××¦×‘ ××‘×—×Ÿ`});const A=V||R.length>0?"failed":T?"warning":"passed",H={id:`activity_exam_${p.id}`,name:`[Exam Mode] ${p.title||p.id}`,nameHe:`[××¦×‘ ××‘×—×Ÿ] ${p.title||p.id}`,category:"student-activity",status:A,severity:V?"critical":T?"high":"low",message:`Blocks: ${$.blocksAttempted}/${$.totalBlocks} | Hints blocked: ${R.length===0?"Yes":"NO!"} | Issues: ${$.issues.length}`,messageHe:`×‘×œ×•×§×™×: ${$.blocksAttempted}/${$.totalBlocks} | ×¨××–×™× ×—×¡×•××™×: ${R.length===0?"×›×Ÿ":"×œ×!"} | ×‘×¢×™×•×ª: ${$.issues.length}`,details:{courseId:p.id,mode:"exam",hintsBlockedCorrectly:R.length===0,...$},duration:$.totalTime,timestamp:new Date};s.push(H),A==="passed"?r++:(c++,(V||R.length>0)&&l.push(H))}}o++;const m=Pt();return s.push(m),m.status==="passed"?r++:(c++,m.severity==="critical"&&l.push(m)),console.log(`âœ… Student Activity Agent completed: ${r}/${o} passed`),{agentType:"student-activity",success:l.length===0,duration:Date.now()-n,testsRun:o,testsPassed:r,testsFailed:c,criticalIssues:l,allResults:s}}catch(a){return console.error("âŒ Student Activity Agent failed:",a),{agentType:"student-activity",success:!1,duration:Date.now()-n,testsRun:0,testsPassed:0,testsFailed:1,criticalIssues:[{id:"activity_agent_error",name:"Student Activity Error",nameHe:"×©×’×™××ª ×¤×¢×™×œ×•×ª ×ª×œ××™×“",category:"student-activity",status:"failed",severity:"critical",message:a.message,messageHe:a.message,duration:Date.now()-n,timestamp:new Date}],allResults:[]}}}function Pt(){const e=[],t=U({isCorrect:!0,attempts:1,hintsUsed:0});t!==100&&e.push(`Correct first try should be 100, got ${t}`);const n=U({isCorrect:!0,attempts:1,hintsUsed:1}),s=100-L.HINT_PENALTY;n!==s&&e.push(`Correct with 1 hint should be ${s}, got ${n}`);const a=U({isCorrect:!0,attempts:1,hintsUsed:3}),i=100-3*L.HINT_PENALTY;a!==i&&e.push(`Correct with 3 hints should be ${i}, got ${a}`);const o=U({isCorrect:!0,attempts:2,hintsUsed:0});o!==L.RETRY_PARTIAL&&e.push(`Correct on retry should be ${L.RETRY_PARTIAL}, got ${o}`);const r=U({isCorrect:!1,attempts:1,hintsUsed:0});r!==0&&e.push(`Incorrect should be 0, got ${r}`);const c=U({isCorrect:!0,attempts:1,hintsUsed:100});c<0&&e.push(`Score should not be negative, got ${c}`);const l=e.length>0;return{id:"scoring_policy_validation",name:"Scoring Policy Validation",nameHe:"×‘×“×™×§×ª ××“×™× ×™×•×ª × ×™×§×•×“",category:"student-activity",status:l?"failed":"passed",severity:l?"critical":"low",message:l?`${e.length} scoring policy violations`:"All scoring rules validated correctly",messageHe:l?`${e.length} ×”×¤×¨×•×ª ××“×™× ×™×•×ª × ×™×§×•×“`:"×›×œ ×›×œ×œ×™ ×”× ×™×§×•×“ ×ª×§×™× ×™×",details:{testedRules:["Correct first try = 100",`Hint penalty = ${L.HINT_PENALTY} per hint`,`Retry partial = ${L.RETRY_PARTIAL}`,"Incorrect = 0","Score >= 0 always"],issues:e,config:L},duration:0,timestamp:new Date}}const S={scoring:{CORRECT_FIRST_TRY:100,HINT_PENALTY:2,RETRY_PARTIAL:50,INCORRECT:0,MIN_SCORE:0},examMode:{HINTS_FORBIDDEN:!0,TEACHING_CONTENT_FORBIDDEN:!0,PROGRESSIVE_HINTS_FORBIDDEN:!0,FRIENDLY_TONE_FORBIDDEN:!0},gamification:{XP_EQUALS_SCORE:!0,GEMS_ON_CORRECT:1,GEMS_ON_PERFECT:2,GEMS_ON_INCORRECT:0},contentRequirements:{MC_MIN_OPTIONS:3,MC_MAX_OPTIONS:5,ORDERING_MIN_ITEMS:3,OPEN_QUESTION_NEEDS_RUBRIC:!0,OPEN_QUESTION_NEEDS_MODEL_ANSWER:!1},bloomMultipliers:{remember:1,understand:1.2,apply:1.5,analyze:1.7,evaluate:2,create:2.2}};function jt(e,t,n,s){const a=[],i=e.content||{},o=e.metadata||{},r=`${t}/${n}/${e.id}`,c=i.options||[],l=i.correctAnswer||i.correct_answer,m=o.progressiveHints||[],h=o.teach_content||o.teachContent,p=o.bloomLevel||o.bloom_level,u=!!l;u||a.push({type:"content",rule:"MC must have correctAnswer",ruleHe:"×©××œ×ª ×‘×—×™×¨×” ×—×™×™×‘×ª ×ª×©×•×‘×” × ×›×•× ×”",severity:"critical",location:r,message:"Multiple choice block has no correct answer defined",messageHe:"×‘×œ×•×§ ×‘×—×™×¨×” ××¨×•×‘×” ×œ×œ× ×ª×©×•×‘×” × ×›×•× ×” ××•×’×“×¨×ª"});let f=!1;if(l&&c.length>0){const _=c.map($=>typeof $=="string"?$:$.text||$.label||$.value||$.answer||"");f=_.includes(l),f||a.push({type:"answer_mismatch",rule:"correctAnswer must match an option",ruleHe:"×”×ª×©×•×‘×” ×”× ×›×•× ×” ×—×™×™×‘×ª ×œ×”×ª××™× ×œ××—×ª ×”××¤×©×¨×•×™×•×ª",severity:"critical",location:r,message:`Correct answer "${l}" not found in options`,messageHe:`×”×ª×©×•×‘×” ×”× ×›×•× ×” "${l}" ×œ× × ××¦××ª ×‘××¤×©×¨×•×™×•×ª`,expected:l,actual:_})}const y=c.length>=S.contentRequirements.MC_MIN_OPTIONS;!y&&c.length>0&&a.push({type:"content",rule:`MC needs at least ${S.contentRequirements.MC_MIN_OPTIONS} options`,ruleHe:`×©××œ×ª ×‘×—×™×¨×” ×¦×¨×™×›×” ×œ×¤×—×•×ª ${S.contentRequirements.MC_MIN_OPTIONS} ××¤×©×¨×•×™×•×ª`,severity:"medium",location:r,message:`Only ${c.length} options, need at least ${S.contentRequirements.MC_MIN_OPTIONS}`,messageHe:`×¨×§ ${c.length} ××¤×©×¨×•×™×•×ª, ×¦×¨×™×š ×œ×¤×—×•×ª ${S.contentRequirements.MC_MIN_OPTIONS}`,expected:S.contentRequirements.MC_MIN_OPTIONS,actual:c.length});let g=!0;s&&m.length>0&&(g=!1,a.push({type:"exam_mode",rule:"No hints in exam mode",ruleHe:"××™×Ÿ ×¨××–×™× ×‘××¦×‘ ××‘×—×Ÿ",severity:"critical",location:r,message:`Exam block has ${m.length} hints which should be forbidden`,messageHe:`×‘×œ×•×§ ××‘×—×Ÿ ××›×™×œ ${m.length} ×¨××–×™× ×©×¦×¨×™×›×™× ×œ×”×™×•×ª ×—×¡×•××™×`,expected:0,actual:m.length}));let x=!0;s&&h&&(x=!1,a.push({type:"exam_mode",rule:"No teaching content in exam mode",ruleHe:"××™×Ÿ ×ª×•×›×Ÿ ×œ×™××•×“×™ ×‘××¦×‘ ××‘×—×Ÿ",severity:"high",location:r,message:"Exam block contains teaching content which reveals answers",messageHe:"×‘×œ×•×§ ××‘×—×Ÿ ××›×™×œ ×ª×•×›×Ÿ ×œ×™××•×“×™ ×©×—×•×©×£ ×ª×©×•×‘×•×ª"}));const b=!!p;return!b&&s&&a.push({type:"bloom",rule:"Exam questions should have Bloom level",ruleHe:"×©××œ×•×ª ××‘×—×Ÿ ×¦×¨×™×›×•×ª ×¨××ª ×‘×œ×•×",severity:"low",location:r,message:"Exam block missing Bloom taxonomy level for proper scoring",messageHe:"×‘×œ×•×§ ××‘×—×Ÿ ×—×¡×¨ ×¨××ª ×‘×œ×•× ×œ× ×™×§×•×“ ×ª×§×™×Ÿ"}),{blockId:e.id,blockType:e.type,courseId:t,unitId:n,isExamContent:s,violations:a,checks:{hasCorrectAnswer:u,correctAnswerInOptions:f,hasEnoughOptions:y,hasRubric:!1,hasModelAnswer:!1,hasBloomLevel:b,noHintsInExam:g,noTeachingInExam:x}}}function Mt(e,t,n,s){const a=[],i=e.content||{},o=e.metadata||{},r=`${t}/${n}/${e.id}`,c=o.rubric||o.analytic_rubric,l=o.modelAnswer||o.model_answer||i.modelAnswer,m=o.bloomLevel||o.bloom_level,h=o.progressiveHints||[],p=!!c;!p&&s&&S.contentRequirements.OPEN_QUESTION_NEEDS_RUBRIC&&a.push({type:"rubric",rule:"Open questions in exams need rubric",ruleHe:"×©××œ×•×ª ×¤×ª×•×—×•×ª ×‘××‘×—×Ÿ ×¦×¨×™×›×•×ª ×¨×•×‘×¨×™×§×”",severity:"high",location:r,message:"Exam open question missing grading rubric",messageHe:"×©××œ×” ×¤×ª×•×—×” ×‘××‘×—×Ÿ ×—×¡×¨×” ×¨×•×‘×¨×™×§×ª ×”×¢×¨×›×”"});const u=!!l;!u&&s&&a.push({type:"content",rule:"Open questions should have model answer",ruleHe:"×©××œ×•×ª ×¤×ª×•×—×•×ª ×¦×¨×™×›×•×ª ×ª×©×•×‘×” ×œ×“×•×’××”",severity:"low",location:r,message:"Open question missing model answer for AI grading",messageHe:"×©××œ×” ×¤×ª×•×—×” ×—×¡×¨×” ×ª×©×•×‘×” ×œ×“×•×’××” ×œ×¦×™×•×Ÿ AI"});let f=!0;s&&h.length>0&&(f=!1,a.push({type:"exam_mode",rule:"No hints in exam mode",ruleHe:"××™×Ÿ ×¨××–×™× ×‘××¦×‘ ××‘×—×Ÿ",severity:"critical",location:r,message:`Exam open question has ${h.length} hints`,messageHe:`×©××œ×” ×¤×ª×•×—×” ×‘××‘×—×Ÿ ××›×™×œ×” ${h.length} ×¨××–×™×`,expected:0,actual:h.length}));const y=!!m;return{blockId:e.id,blockType:e.type,courseId:t,unitId:n,isExamContent:s,violations:a,checks:{hasCorrectAnswer:!0,correctAnswerInOptions:!0,hasEnoughOptions:!0,hasRubric:p,hasModelAnswer:u,hasBloomLevel:y,noHintsInExam:f,noTeachingInExam:!0}}}function Et(e,t,n,s){const a=[],i=e.content||{},o=e.metadata||{},r=`${t}/${n}/${e.id}`,c=i.correct_order||i.correctOrder||[],l=o.progressiveHints||[],m=c.length>=S.contentRequirements.ORDERING_MIN_ITEMS;m||a.push({type:"content",rule:`Ordering needs at least ${S.contentRequirements.ORDERING_MIN_ITEMS} items`,ruleHe:`×¡×™×“×•×¨ ×¦×¨×™×š ×œ×¤×—×•×ª ${S.contentRequirements.ORDERING_MIN_ITEMS} ×¤×¨×™×˜×™×`,severity:"high",location:r,message:`Ordering has ${c.length} items, need at least ${S.contentRequirements.ORDERING_MIN_ITEMS}`,messageHe:`×œ×¡×™×“×•×¨ ×™×© ${c.length} ×¤×¨×™×˜×™×, ×¦×¨×™×š ×œ×¤×—×•×ª ${S.contentRequirements.ORDERING_MIN_ITEMS}`,expected:S.contentRequirements.ORDERING_MIN_ITEMS,actual:c.length});let h=!0;return s&&l.length>0&&(h=!1,a.push({type:"exam_mode",rule:"No hints in exam mode",ruleHe:"××™×Ÿ ×¨××–×™× ×‘××¦×‘ ××‘×—×Ÿ",severity:"critical",location:r,message:`Exam ordering has ${l.length} hints`,messageHe:`×¡×™×“×•×¨ ×‘××‘×—×Ÿ ××›×™×œ ${l.length} ×¨××–×™×`})),{blockId:e.id,blockType:e.type,courseId:t,unitId:n,isExamContent:s,violations:a,checks:{hasCorrectAnswer:m,correctAnswerInOptions:!0,hasEnoughOptions:!0,hasRubric:!1,hasModelAnswer:!1,hasBloomLevel:!!o.bloomLevel,noHintsInExam:h,noTeachingInExam:!0}}}function Bt(e,t,n,s){switch(e.type){case"multiple-choice":case"true-false":return jt(e,t,n,s);case"open-question":return Mt(e,t,n,s);case"ordering":return Et(e,t,n,s);default:return null}}function Ht(){const e=[],t=[{isCorrect:!0,attempts:1,hintsUsed:0,expected:S.scoring.CORRECT_FIRST_TRY},{isCorrect:!0,attempts:1,hintsUsed:1,expected:S.scoring.CORRECT_FIRST_TRY-S.scoring.HINT_PENALTY},{isCorrect:!0,attempts:1,hintsUsed:5,expected:S.scoring.CORRECT_FIRST_TRY-5*S.scoring.HINT_PENALTY},{isCorrect:!0,attempts:2,hintsUsed:0,expected:S.scoring.RETRY_PARTIAL},{isCorrect:!0,attempts:3,hintsUsed:0,expected:S.scoring.RETRY_PARTIAL},{isCorrect:!1,attempts:1,hintsUsed:0,expected:S.scoring.INCORRECT},{isCorrect:!1,attempts:5,hintsUsed:10,expected:S.scoring.INCORRECT}];for(const s of t){const a=U({isCorrect:s.isCorrect,attempts:s.attempts,hintsUsed:s.hintsUsed});a!==s.expected&&e.push({type:"scoring",rule:"Scoring function must match policy",ruleHe:"×¤×•× ×§×¦×™×™×ª × ×™×§×•×“ ×—×™×™×‘×ª ×œ×”×ª××™× ×œ××“×™× ×™×•×ª",severity:"critical",location:"scoring.ts",message:`Score mismatch: correct=${s.isCorrect}, attempts=${s.attempts}, hints=${s.hintsUsed} â†’ expected ${s.expected}, got ${a}`,messageHe:`××™-×”×ª×××ª × ×™×§×•×“: × ×›×•×Ÿ=${s.isCorrect}, × ×™×¡×™×•× ×•×ª=${s.attempts}, ×¨××–×™×=${s.hintsUsed} â†’ ×¦×¤×•×™ ${s.expected}, ×”×ª×§×‘×œ ${a}`,expected:s.expected,actual:a})}const n=U({isCorrect:!0,attempts:1,hintsUsed:1e3});return n<S.scoring.MIN_SCORE&&e.push({type:"scoring",rule:"Score cannot be negative",ruleHe:"× ×™×§×•×“ ×œ× ×™×›×•×œ ×œ×”×™×•×ª ×©×œ×™×œ×™",severity:"critical",location:"scoring.ts",message:`Score went below ${S.scoring.MIN_SCORE} with many hints: ${n}`,messageHe:`×”× ×™×§×•×“ ×™×¨×“ ××ª×—×ª ×œ-${S.scoring.MIN_SCORE} ×¢× ×”×¨×‘×” ×¨××–×™×: ${n}`,expected:`>= ${S.scoring.MIN_SCORE}`,actual:n}),e}function qt(e){var l,m,h,p,u,f;const t=[],n=[],s=e.syllabus||[];let a=0,i=0,o=0;const r=e.contentType==="exam"||((l=e.title)==null?void 0:l.toLowerCase().includes("××‘×—×Ÿ"))||((m=e.title)==null?void 0:m.toLowerCase().includes("exam"));for(const y of s)for(const g of y.learningUnits||[]){const x=((h=g.title)==null?void 0:h.toLowerCase().includes("××‘×—×Ÿ"))||((p=g.title)==null?void 0:p.toLowerCase().includes("exam"))||g.isExam===!0;for(const b of g.activityBlocks||[])if(a++,["multiple-choice","true-false","open-question","ordering","categorization","fill-in-blanks"].includes(b.type)){i++;const $=r||x||((u=b.metadata)==null?void 0:u.isExam)===!0||((f=b.metadata)==null?void 0:f.mode)==="exam";$&&o++;const N=Bt(b,e.id,g.id,$);N&&(n.push(N),t.push(...N.violations))}}const c={critical:t.filter(y=>y.severity==="critical").length,high:t.filter(y=>y.severity==="high").length,medium:t.filter(y=>y.severity==="medium").length,low:t.filter(y=>y.severity==="low").length};return{courseId:e.id,courseTitle:e.title||e.id,totalBlocks:a,interactiveBlocks:i,examBlocks:o,violations:t,blockResults:n,summary:c}}async function Re(e=10){const t=Date.now(),n=[];console.log("âš–ï¸ Assessment Integrity Agent starting..."),console.log(`   Validating scoring policy and assessment integrity on ${e} courses...`);try{const s=Ht(),a={id:"scoring_rules_validation",name:"Scoring Rules Validation",nameHe:"×‘×“×™×§×ª ×›×œ×œ×™ × ×™×§×•×“",category:"assessment-integrity",status:s.length===0?"passed":"failed",severity:s.length>0?"critical":"low",message:s.length===0?"All scoring rules follow policy correctly":`${s.length} scoring policy violations found`,messageHe:s.length===0?"×›×œ ×›×œ×œ×™ ×”× ×™×§×•×“ ×ª×•×××™× ×œ××“×™× ×™×•×ª":`× ××¦××• ${s.length} ×”×¤×¨×•×ª ××“×™× ×™×•×ª × ×™×§×•×“`,details:{policy:S.scoring,violations:s},duration:0,timestamp:new Date};n.push(a);const i=j(P(D,"courses"),Z("createdAt","desc"),B(e)),o=await M(i);let r=1,c=s.length===0?1:0,l=s.length>0?1:0;const m=[];s.length>0&&m.push(a);for(const u of o.docs){const f={id:u.id,...u.data()};r++;const y=qt(f),g=y.summary.critical>0,x=y.summary.high>0,b=g?"failed":x?"warning":"passed",_={id:`assessment_${f.id}`,name:`Assessment Integrity: ${f.title||f.id}`,nameHe:`××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”: ${f.title||f.id}`,category:"assessment-integrity",status:b,severity:g?"critical":x?"high":"low",message:`Blocks: ${y.interactiveBlocks}/${y.totalBlocks} | Exam: ${y.examBlocks} | Violations: ${y.violations.length} (${y.summary.critical} critical)`,messageHe:`×‘×œ×•×§×™×: ${y.interactiveBlocks}/${y.totalBlocks} | ××‘×—×Ÿ: ${y.examBlocks} | ×”×¤×¨×•×ª: ${y.violations.length} (${y.summary.critical} ×§×¨×™×˜×™×•×ª)`,details:{courseId:f.id,courseTitle:f.title,statistics:{totalBlocks:y.totalBlocks,interactiveBlocks:y.interactiveBlocks,examBlocks:y.examBlocks},summary:y.summary,violations:y.violations,blockResults:y.blockResults.filter($=>$.violations.length>0)},duration:0,timestamp:new Date};n.push(_),b==="passed"?c++:(l++,g&&m.push(_))}r++;const h=n.reduce((u,f)=>{var g;const y=f.details;return u+(((g=y==null?void 0:y.violations)==null?void 0:g.length)||0)},0),p={id:"assessment_summary",name:"Assessment Integrity Summary",nameHe:"×¡×™×›×•× ××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”",category:"assessment-integrity",status:m.length===0?"passed":"failed",severity:m.length>0?"critical":"low",message:`Total violations: ${h} across ${o.size} courses`,messageHe:`×¡×”"×› ×”×¤×¨×•×ª: ${h} ×‘-${o.size} ×§×•×¨×¡×™×`,details:{coursesChecked:o.size,totalViolations:h,criticalCount:m.length,policy:S},duration:Date.now()-t,timestamp:new Date};return n.push(p),p.status==="passed"?c++:l++,console.log(`âœ… Assessment Integrity Agent completed: ${c}/${r} passed`),console.log(`   Total violations found: ${h}`),{agentType:"assessment-integrity",success:m.length===0,duration:Date.now()-t,testsRun:r,testsPassed:c,testsFailed:l,criticalIssues:m,allResults:n}}catch(s){return console.error("âŒ Assessment Integrity Agent failed:",s),{agentType:"assessment-integrity",success:!1,duration:Date.now()-t,testsRun:0,testsPassed:0,testsFailed:1,criticalIssues:[{id:"assessment_agent_error",name:"Assessment Integrity Error",nameHe:"×©×’×™××ª ××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”",category:"assessment-integrity",status:"failed",severity:"critical",message:s.message,messageHe:s.message,duration:Date.now()-t,timestamp:new Date}],allResults:[]}}}const Ot=[{topic:"××¡×¤×¨×™×",grade:"×",description:"Numbers for grade 1"},{topic:"××¡×¤×¨×™×",grade:"×‘",description:"Numbers for grade 2"},{topic:"×ª×¨×’×™×œ×™×",grade:"×",description:"Exercises for grade 1"},{topic:"×ª×¨×’×™×œ×™×",grade:"×‘",description:"Exercises for grade 2"},{topic:"×—×™×‘×•×¨ ×•×—×™×¡×•×¨",grade:"×",description:"Addition and subtraction grade 1"},{topic:"×—×™×‘×•×¨ ×•×—×™×¡×•×¨",grade:"×‘",description:"Addition and subtraction grade 2"}];function K(e,t,n,s,a,i,o,r,c){return{id:e,name:t,nameHe:n,category:"knowledge-base",status:s,severity:a,message:i,messageHe:o,details:c,duration:r,timestamp:new Date}}async function Ft(e,t){const n=Date.now();try{const s=await _e(e,{grade:t},5),a=Date.now()-n,i=s.length>0?s.reduce((o,r)=>o+r.similarity,0)/s.length:0;return{success:s.length>0,resultsCount:s.length,avgSimilarity:Math.round(i*100),duration:a}}catch(s){return{success:!1,resultsCount:0,avgSimilarity:0,duration:Date.now()-n,error:s.message}}}async function Lt(e,t){const n=Date.now();try{const s=await ie(e,t),a=Date.now()-n,i={exercises:s.exercises.length,commonMistakes:s.commonMistakes.length,progressionLevels:s.progressionLevels.length,mathLanguage:s.mathLanguage.length,examples:s.examples.length,questionPhrasing:s.questionPhrasing.length,studentAddressing:s.studentAddressing.length,explanationPatterns:s.explanationPatterns.length};return{success:Object.values(i).reduce((r,c)=>r+c,0)>0,extractedCounts:i,hasRawContext:s.rawContext.length>0,rawContextLength:s.rawContext.length,duration:a,sampleExtractions:{exercises:s.exercises.slice(0,2),questionPhrasing:s.questionPhrasing.slice(0,2),studentAddressing:s.studentAddressing.slice(0,2)}}}catch(s){return{success:!1,extractedCounts:{exercises:0,commonMistakes:0,progressionLevels:0,mathLanguage:0,examples:0,questionPhrasing:0,studentAddressing:0,explanationPatterns:0},hasRawContext:!1,rawContextLength:0,duration:Date.now()-n,sampleExtractions:{exercises:[],questionPhrasing:[],studentAddressing:[]},error:s.message}}}async function Gt(e,t){const n=Date.now();try{const s=await ie(e,t),a=qe(s),i=Date.now()-n,o={studentAddressing:a.includes("×¡×’× ×•×Ÿ ×”×¤× ×™×™×” ×œ×ª×œ××™×“"),questionPhrasing:a.includes("× ×™×¡×•×— ×©××œ×•×ª"),explanationPatterns:a.includes("×ª×‘× ×™×•×ª ×œ×”×¡×‘×¨"),exercises:a.includes("×“×•×’×××•×ª ×œ×ª×¨×’×™×œ×™×"),commonMistakes:a.includes("×˜×¢×•×™×•×ª × ×¤×•×¦×•×ª"),criticalInstructions:a.includes("×”×•×¨××•×ª ×§×¨×™×˜×™×•×ª")},r=Object.values(o).filter(Boolean).length;return{success:a.length>100&&r>=3,promptLength:a.length,hasSections:o,duration:i,formattedPromptPreview:a.substring(0,500)+"..."}}catch{return{success:!1,promptLength:0,hasSections:{studentAddressing:!1,questionPhrasing:!1,explanationPatterns:!1,exercises:!1,commonMistakes:!1,criticalInstructions:!1},duration:Date.now()-n,formattedPromptPreview:""}}}async function Qt(e,t,n=6e4){const s=Date.now();try{const a=await ie(e,t),i=a.rawContext.length>0,o=new Promise((p,u)=>setTimeout(()=>u(new Error("Timeout")),n)),r=`×›×™×ª×” ${t}`,c=await Promise.race([le(e,r,null,void 0),o]),l=Date.now()-s,m=JSON.stringify(c||{}),h=Ut(m,a,t);return{success:c!==null&&h.issues.length<3,hasKBContext:i,generationDuration:l,generatedContent:c,languageAnalysis:h}}catch(a){return{success:!1,hasKBContext:!1,generationDuration:Date.now()-s,generatedContent:null,languageAnalysis:{usesHebrewTextbookStyle:!1,hasAppropriateAddressing:!1,matchesGradeLevel:!1,issues:[a.message]},error:a.message}}}function Ut(e,t,n){const s=[],a=/[\u0590-\u05FF]/.test(e);a||s.push("Content not in Hebrew");const o=["× ×—×©×‘","×‘×•××•","× ××¦×","×©×™× ×œ×‘","×–×›×•×¨","× ×¡×ª×›×œ"].some(m=>e.includes(m));!o&&t.studentAddressing.length>0&&s.push("Missing textbook-style student addressing");const c=["××™× ×˜×’×¨×œ","×“×™×¤×¨× ×¦×™××œ","×œ×•×’×¨×™×ª×","×˜×¨×™×’×•× ×•××˜×¨×™×”"].some(m=>e.includes(m)),l=["×","×‘","×’"].includes(n);return l&&c&&s.push("Content too complex for grade level"),t.questionPhrasing.some(m=>e.toLowerCase().includes(m.toLowerCase().substring(0,10))),{usesHebrewTextbookStyle:a,hasAppropriateAddressing:o,matchesGradeLevel:!(l&&c),issues:s}}async function Vt(e,t,n=9e4){const s=Date.now(),a=[],i=[];try{const o=await ie(e,t),r={step_number:1,title:e,bloom_level:"Understand",suggested_interaction_type:"Multiple Choice",narrative_focus:e,forbidden_topics:[],key_learning_points:[e]},c=new Promise((w,v)=>setTimeout(()=>v(new Error("Timeout")),n)),l=`×›×™×ª×” ${t}`,m=await Promise.race([Oe(e,r,l,void 0,void 0,"learning","math",5),c]),h=Date.now()-s;if(!m)return{success:!1,generatedContent:null,qualityChecks:{hasTextbookStyleAddressing:!1,hasContextualQuestion:!1,hasHebrewContent:!1,hasAppropriateComplexity:!1,usesKBPatterns:!1},matchedPatterns:[],issues:["Generation returned null"],duration:h,error:"Generation failed"};const p=JSON.stringify(m),u=m.teach_content||"",y=(m.data||{}).question||"",g=["× ×—×©×‘","× ×—×©×•×‘","×‘×•××• × ","× ××¦×","× ×¡×ª×›×œ","×©×™× ×œ×‘","×–×›×•×¨","×”×× ×–×›×•×¨","×›××• ×©×œ××“× ×•"],x=g.some(w=>p.includes(w));if(x){const w=g.filter(v=>p.includes(v));i.push(...w.map(v=>`×¤× ×™×™×”: "${v}"`))}else a.push("×—×¡×¨ ×¡×’× ×•×Ÿ ×¤× ×™×™×” ×œ×¡×¤×¨ ×œ×™××•×“ (× ×—×©×‘, ×‘×•××• × ×¨××”, ×•×›×•')");const _=[/\b×œ?\w+\s+(×§× ×”|××¡×£|×™×©|×§×™×‘×œ|× ×ª×Ÿ|×”×œ×š|×‘×|×©×|×œ×§×—)/,/×›××”\s+\w+\s+(×™×©|× ×©××¨|×§×™×‘×œ|×™×”×™×•)/,/×¡×™×¤×•×¨|×“×•×’××”|×‘×¢×™×”/].some(w=>w.test(y)||w.test(u));_?i.push("×©××œ×” ×”×§×©×¨×™×ª ×¢× ×¡×™×¤×•×¨"):/^[×—×©×‘|××¦×|×¤×ª×•×¨]\s*:?\s*\d+\s*[+\-Ã—Ã·]\s*\d+/.test(y)&&a.push("×©××œ×” ×’× ×¨×™×ª ×œ×œ× ×”×§×©×¨ ×™×•××™×•××™");const N=(p.match(/[\u0590-\u05FF]/g)||[]).length>50;N||a.push("×ª×•×›×Ÿ ×œ× ×‘×¢×‘×¨×™×ª ××• ××¢×˜ ×××•×“ ×¢×‘×¨×™×ª");const Q=["××™× ×˜×’×¨×œ","× ×’×–×¨×ª","×œ×•×’×¨×™×ª×","×—×–×§×”","×©×•×¨×©","××©×•×•××”"],V=["×","×‘"],T=Q.some(w=>p.includes(w)),R=!(V.includes(t)&&T);R||a.push("×¨××ª ×§×•×©×™ ×œ× ××ª××™××” ×œ×›×™×ª×”");let A=!1;if(o.studentAddressing.length>0||o.questionPhrasing.length>0){const w=[...o.studentAddressing,...o.questionPhrasing.slice(0,3)];for(const v of w){const k=v.split(/\s+/).slice(0,3).join(" ");if(k.length>5&&p.includes(k.substring(0,10))){A=!0,i.push(`×“×¤×•×¡ KB: "${k.substring(0,20)}..."`);break}}}!A&&o.studentAddressing.length>0&&a.push("×œ× ××©×ª××© ×‘×“×¤×•×¡×™× ××¡×¤×¨ ×”×œ×™××•×“");const H={hasTextbookStyleAddressing:x,hasContextualQuestion:_,hasHebrewContent:N,hasAppropriateComplexity:R,usesKBPatterns:A};return{success:Object.values(H).filter(Boolean).length>=4&&a.length<=1,generatedContent:{teach_content_preview:u.substring(0,200),question_preview:y.substring(0,200),interaction_type:m.selected_interaction},qualityChecks:H,matchedPatterns:i,issues:a,duration:h}}catch(o){return{success:!1,generatedContent:null,qualityChecks:{hasTextbookStyleAddressing:!1,hasContextualQuestion:!1,hasHebrewContent:!1,hasAppropriateComplexity:!1,usesKBPatterns:!1},matchedPatterns:[],issues:[o.message],duration:Date.now()-s,error:o.message}}}async function Kt(){const e=["×","×‘","×’","×“","×”","×•"],t=[],n=[],s=[],a=["××¡×¤×¨×™×","×ª×¨×’×™×œ","×—×©×‘×•×Ÿ","×¤×¨×§"];for(const o of e)for(const r of a)try{const c=await _e(r,{grade:o},3);if(c.length>0){t.includes(o)||t.push(o);for(const l of c){const m=`${o}-${l.chunk.volume}-${l.chunk.volumeType}`;n.includes(m)||(n.push(m),s.push({grade:o,chapter:l.chunk.chapter||"×œ× ×™×“×•×¢",contentPreview:l.chunk.content.substring(0,150)+"..."}))}break}}catch{}const i=e.filter(o=>!t.includes(o));return{totalBooks:n.length,booksWithContent:n,gradesWithContent:t,coveragePercentage:Math.round(t.length/e.length*100),missingGrades:i,sampleContent:s.slice(0,5)}}async function Ne(e=3){console.log("ğŸ” Starting Knowledge Base QA Agent...");const t=Date.now(),n=[];let s=0,a=0;const i=[];console.log("ğŸ“Š Testing KB coverage...");const o=await Kt(),r=[];if(o.gradesWithContent.length>0)for(const p of o.gradesWithContent)r.push({topic:"××¡×¤×¨×™×",grade:p,description:`Numbers for grade ${p}`}),r.push({topic:"×ª×¨×’×™×œ×™×",grade:p,description:`Exercises for grade ${p}`});else r.push(...Ot);const c=r.slice(0,e),l=K("kb_coverage","Knowledge Base Coverage","×›×™×¡×•×™ ×‘×¡×™×¡ ×”×™×“×¢",o.coveragePercentage>=50?"passed":o.coveragePercentage>0?"warning":"failed",o.coveragePercentage===0?"critical":"medium",`Coverage: ${o.coveragePercentage}% | Books: ${o.totalBooks} | Grades: ${o.gradesWithContent.join(", ")||"None"}`,`×›×™×¡×•×™: ${o.coveragePercentage}% | ×¡×¤×¨×™×: ${o.totalBooks} | ×›×™×ª×•×ª: ${o.gradesWithContent.join(", ")||"××™×Ÿ"}`,Date.now()-t,{coverage:o,missingGrades:o.missingGrades,sampleContent:o.sampleContent,topicsToTest:c.map(p=>`${p.topic} (×›×™×ª×” ${p.grade})`)});if(n.push(l),l.status==="passed"?s++:(a++,o.coveragePercentage===0&&i.push(l)),o.coveragePercentage===0)return console.log("âš ï¸ KB is empty, skipping detailed tests"),n.push(K("kb_empty_warning","KB Empty - Tests Skipped","×‘×¡×™×¡ ×™×“×¢ ×¨×™×§ - ×‘×“×™×§×•×ª ×“×•×œ×’×•","warning","high","Knowledge base has no content. Upload textbooks to enable testing.","×‘×¡×™×¡ ×”×™×“×¢ ×¨×™×§. ×”×¢×œ×” ×¡×¤×¨×™ ×œ×™××•×“ ×›×“×™ ×œ××¤×©×¨ ×‘×“×™×§×•×ª.",0,{})),{agentType:"knowledge-base",success:!1,duration:Date.now()-t,testsRun:n.length,testsPassed:s,testsFailed:a,criticalIssues:i,allResults:n};for(const{topic:p,grade:u,description:f}of c){console.log(`
ğŸ“š Testing topic: ${p} (${u})`);const y=await Ft(p,u),g=K(`kb_search_${p}_${u}`,`KB Search: ${p}`,`×—×™×¤×•×© KB: ${p}`,y.success?"passed":"failed",y.success?"low":"high",`Results: ${y.resultsCount} | Similarity: ${y.avgSimilarity}% | Duration: ${y.duration}ms`,`×ª×•×¦××•×ª: ${y.resultsCount} | ×“××™×•×Ÿ: ${y.avgSimilarity}% | ××©×š: ${y.duration}ms`,y.duration,{searchResult:y});n.push(g),g.status==="passed"?s++:a++;const x=await Lt(p,u),b=Object.values(x.extractedCounts).reduce((T,R)=>T+R,0),_=K(`kb_extraction_${p}_${u}`,`Pedagogical Extraction: ${p}`,`×—×™×œ×•×¥ ×¤×“×’×•×’×™: ${p}`,x.success?"passed":b>0?"warning":"failed",x.success?"low":"medium",`Extracted: ${b} elements | Exercises: ${x.extractedCounts.exercises} | Questions: ${x.extractedCounts.questionPhrasing} | Addressing: ${x.extractedCounts.studentAddressing}`,`×—×•×œ×¦×•: ${b} ××œ×× ×˜×™× | ×ª×¨×’×™×œ×™×: ${x.extractedCounts.exercises} | ×©××œ×•×ª: ${x.extractedCounts.questionPhrasing} | ×¤× ×™×™×”: ${x.extractedCounts.studentAddressing}`,x.duration,{extractedCounts:x.extractedCounts,samples:x.sampleExtractions,rawContextLength:x.rawContextLength});n.push(_),_.status==="passed"?s++:a++;const $=await Gt(p,u),N=Object.values($.hasSections).filter(Boolean).length,Q=K(`kb_formatting_${p}_${u}`,`Prompt Formatting: ${p}`,`×¢×™×¦×•×‘ ×¤×¨×•××¤×˜: ${p}`,$.success?"passed":N>=2?"warning":"failed",$.success?"low":"medium",`Sections: ${N}/6 | Length: ${$.promptLength} chars`,`×¡×¢×™×¤×™×: ${N}/6 | ××•×¨×š: ${$.promptLength} ×ª×•×•×™×`,$.duration,{hasSections:$.hasSections,promptPreview:$.formattedPromptPreview.substring(0,200)});if(n.push(Q),Q.status==="passed"?s++:a++,c.findIndex(T=>T.topic===p&&T.grade===u)===0){console.log("ğŸ¤– Testing content generation with KB context...");const T=await Qt(p,u),R=K(`kb_generation_${p}_${u}`,`AI Generation with KB: ${p}`,`×™×¦×™×¨×ª AI ×¢× KB: ${p}`,T.success?"passed":T.languageAnalysis.issues.length<2?"warning":"failed",T.success?"low":"high",`KB Context: ${T.hasKBContext?"Yes":"No"} | Hebrew Style: ${T.languageAnalysis.usesHebrewTextbookStyle?"Yes":"No"} | Issues: ${T.languageAnalysis.issues.length}`,`×”×§×©×¨ KB: ${T.hasKBContext?"×›×Ÿ":"×œ×"} | ×¡×’× ×•×Ÿ ×¢×‘×¨×™: ${T.languageAnalysis.usesHebrewTextbookStyle?"×›×Ÿ":"×œ×"} | ×‘×¢×™×•×ª: ${T.languageAnalysis.issues.length}`,T.generationDuration,{hasKBContext:T.hasKBContext,languageAnalysis:T.languageAnalysis,generatedContentPreview:JSON.stringify(T.generatedContent).substring(0,300)});n.push(R),R.status==="passed"?s++:(a++,T.success||i.push(R)),console.log("ğŸ“ Testing ACTUAL output quality (student-facing content)...");const A=await Vt(p,u),H=Object.values(A.qualityChecks).filter(Boolean).length,q=K(`kb_output_quality_${p}_${u}`,`Output Quality Check: ${p}`,`×‘×“×™×§×ª ××™×›×•×ª ×¤×œ×˜: ${p}`,A.success?"passed":H>=3?"warning":"failed",A.success?"low":"critical",`Quality: ${H}/5 checks | Textbook Style: ${A.qualityChecks.hasTextbookStyleAddressing?"Yes":"No"} | Issues: ${A.issues.length}`,`××™×›×•×ª: ${H}/5 ×‘×“×™×§×•×ª | ×¡×’× ×•×Ÿ ×¡×¤×¨: ${A.qualityChecks.hasTextbookStyleAddressing?"×›×Ÿ":"×œ×"} | ×‘×¢×™×•×ª: ${A.issues.length}`,A.duration,{qualityChecks:A.qualityChecks,matchedPatterns:A.matchedPatterns,issues:A.issues,generatedContent:A.generatedContent});n.push(q),q.status==="passed"?s++:(a++,A.success||i.push(q))}await new Promise(T=>setTimeout(T,300))}const m=Date.now()-t,h=Math.round(s/n.length*100);return console.log(`
âœ… Knowledge Base QA completed:`),console.log(`   Passed: ${s}/${n.length} (${h}%)`),console.log(`   Duration: ${m}ms`),n.push(K("kb_summary","Knowledge Base Integration Summary","×¡×™×›×•× ××™× ×˜×’×¨×¦×™×™×ª ×‘×¡×™×¡ ×”×™×“×¢",h>=80?"passed":h>=50?"warning":"failed","info",`Pass Rate: ${h}% | Tests: ${n.length} | Coverage: ${o.coveragePercentage}%`,`××—×•×– ×”×¦×œ×—×”: ${h}% | ×‘×“×™×§×•×ª: ${n.length} | ×›×™×¡×•×™: ${o.coveragePercentage}%`,m,{passRate:h,coverage:o.coveragePercentage,testedTopics:c.map(p=>`${p.topic} (×›×™×ª×” ${p.grade})`)})),{agentType:"knowledge-base",success:a===0,duration:m,testsRun:n.length,testsPassed:s,testsFailed:a,criticalIssues:i,allResults:n}}function ne(e){const t=[],n=e.details||{};switch(Yt(e)){case"missing_question":t.push(zt(e,n));break;case"missing_options":case"insufficient_options":t.push(Wt(e,n));break;case"no_correct_answer":t.push(Jt(e,n));break;case"empty_content":t.push(Xt(e,n));break;case"invalid_block_structure":t.push(Zt(e,n));break;case"missing_feedback":t.push(es(e,n,"feedback"));break;case"orphaned_reference":t.push(ts(e,n));break;default:t.push(ss(e,n))}return t}function Yt(e){const t=e.message.toLowerCase(),n=e.messageHe;return t.includes("missing question")||n.includes("×—×¡×¨ ×©××œ×”")?"missing_question":t.includes("no options")||t.includes("insufficient options")||n.includes("××¤×©×¨×•×™×•×ª")?"missing_options":t.includes("no correct")||n.includes("×ª×©×•×‘×” × ×›×•× ×”")?"no_correct_answer":t.includes("empty")||n.includes("×¨×™×§")?"empty_content":t.includes("invalid structure")||n.includes("××‘× ×”")?"invalid_block_structure":t.includes("feedback")||n.includes("××©×•×‘")?"missing_feedback":t.includes("orphan")||t.includes("reference")||n.includes("×”×¤× ×™×”")?"orphaned_reference":"unknown"}function zt(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"regenerate_block",description:"Regenerate the entire block using AI",descriptionHe:"×™×¦×™×¨×” ××—×“×© ×©×œ ×”×‘×œ×•×§ ×‘×××¦×¢×•×ª AI",autoFixable:!0,estimatedDuration:15,riskLevel:"medium",targetPath:{collection:"courses",documentId:t.courseId||"",field:"units",blockId:t.blockId||""},requiresAI:!0,aiPrompt:`Regenerate ${t.blockType||"activity"} block for topic: ${t.topic||"unknown"}`}}function Wt(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"fix_options",description:"Add or fix answer options",descriptionHe:"×”×•×¡×¤×” ××• ×ª×™×§×•×Ÿ ××¤×©×¨×•×™×•×ª ×ª×©×•×‘×”",autoFixable:!0,estimatedDuration:10,riskLevel:"low",targetPath:{collection:"courses",documentId:t.courseId||"",field:"content.options",blockId:t.blockId||""},requiresAI:!0,aiPrompt:`Generate 4 answer options for question: ${t.question||"unknown"}`}}function Jt(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"add_correct_answer",description:"Mark one option as correct answer",descriptionHe:"×¡×™××•×Ÿ ×ª×©×•×‘×” × ×›×•× ×”",autoFixable:!0,estimatedDuration:5,riskLevel:"low",targetPath:{collection:"courses",documentId:t.courseId||"",field:"content.correctAnswer",blockId:t.blockId||""},requiresAI:!1,fixData:{action:"set_first_as_correct"}}}function Xt(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"regenerate_content",description:"Regenerate content using AI",descriptionHe:"×™×¦×™×¨×ª ×ª×•×›×Ÿ ××—×“×© ×‘×××¦×¢×•×ª AI",autoFixable:!0,estimatedDuration:20,riskLevel:"medium",targetPath:{collection:"courses",documentId:t.courseId||"",field:"content",blockId:t.blockId||""},requiresAI:!0}}function Zt(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"fix_structure",description:"Fix block structure to match schema",descriptionHe:"×ª×™×§×•×Ÿ ××‘× ×” ×”×‘×œ×•×§",autoFixable:!0,estimatedDuration:5,riskLevel:"low",targetPath:{collection:"courses",documentId:t.courseId||"",blockId:t.blockId||""},requiresAI:!1}}function es(e,t,n){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"add_missing_field",description:`Add missing ${n} field`,descriptionHe:`×”×•×¡×¤×ª ×©×“×” ${n} ×—×¡×¨`,autoFixable:!0,estimatedDuration:10,riskLevel:"low",targetPath:{collection:"courses",documentId:t.courseId||"",field:`content.${n}`,blockId:t.blockId||""},requiresAI:n==="feedback"}}function ts(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"remove_invalid",description:"Remove invalid or orphaned reference",descriptionHe:"×”×¡×¨×ª ×”×¤× ×™×” ×œ× ×ª×§×™× ×”",autoFixable:!0,estimatedDuration:3,riskLevel:"medium",targetPath:{collection:"courses",documentId:t.courseId||"",blockId:t.blockId||""},requiresAI:!1}}function ss(e,t){return{id:`fix_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,testResultId:e.id,fixType:"manual_review",description:"This issue requires manual review",descriptionHe:"×‘×¢×™×” ×–×• ×“×•×¨×©×ª ×‘×“×™×§×” ×™×“× ×™×ª",autoFixable:!1,estimatedDuration:0,riskLevel:"high",targetPath:{collection:t.collection||"courses",documentId:t.documentId||t.courseId||""},requiresAI:!1}}async function fe(e,t){try{let n;switch(e.fixType){case"regenerate_block":n=await Pe(e);break;case"fix_options":n=await ns(e);break;case"add_correct_answer":n=await as(e);break;case"regenerate_content":n=await is(e);break;case"fix_structure":n=await os(e);break;case"add_missing_field":n=await cs(e);break;case"remove_invalid":n=await ls(e);break;case"manual_review":default:n={id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,appliedBy:t,errorMessage:"Manual review required - cannot auto-fix"}}return n.appliedBy=t,n}catch(n){return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,appliedBy:t,errorMessage:n.message||"Unknown error during fix execution"}}}async function Pe(e){var m;const{targetPath:t,aiPrompt:n}=e,s=z(D,"courses",t.documentId),a=await ee(s);if(!a.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const i=a.data();let o=!1,r,c;const l=(m=i.units)==null?void 0:m.map(h=>{var u;const p=(u=h.activityBlocks)==null?void 0:u.map(f=>{if(f.id===t.blockId){o=!0,r={...f};const y={...f,content:{...f.content,_needsRegeneration:!0,_regenerationPrompt:n}};return c=y,y}return f});return{...h,activityBlocks:p}});return o?(await te(s,{units:l}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,previousValue:r,newValue:c}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Block not found in course"}}async function ns(e){var l;const{targetPath:t}=e,n=z(D,"courses",t.documentId),s=await ee(n);if(!s.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const a=s.data();let i,o,r=!1;const c=(l=a.units)==null?void 0:l.map(m=>{var p;const h=(p=m.activityBlocks)==null?void 0:p.map(u=>{var f,y,g;if(u.id===t.blockId&&u.type==="multiple-choice"){i=(f=u.content)==null?void 0:f.options;const x=((y=u.content)==null?void 0:y.options)||[];if((g=u.content)!=null&&g.question,x.length<4){const b=[...x];for(;b.length<4;)b.push({id:`opt_${Date.now()}_${b.length}`,text:`[×“×•×¨×© ×™×¦×™×¨×” ××—×“×© - ××¤×©×¨×•×ª ${b.length+1}]`,isCorrect:!1});return b.some(_=>_.isCorrect)||(b[0].isCorrect=!0),o=b,r=!0,{...u,content:{...u.content,options:b}}}}return u});return{...m,activityBlocks:h}});return r?(await te(n,{units:c}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,previousValue:i,newValue:o}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,errorMessage:"Block not found or already has enough options"}}async function as(e){var l;const{targetPath:t}=e,n=z(D,"courses",t.documentId),s=await ee(n);if(!s.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const a=s.data();let i,o,r=!1;const c=(l=a.units)==null?void 0:l.map(m=>{var p;const h=(p=m.activityBlocks)==null?void 0:p.map(u=>{var f;if(u.id===t.blockId&&u.type==="multiple-choice"){const y=((f=u.content)==null?void 0:f.options)||[];if(i=y.map(g=>({...g})),!y.some(g=>g.isCorrect)){const g=y.map((x,b)=>({...x,isCorrect:b===0}));return o=g,r=!0,{...u,content:{...u.content,options:g}}}}return u});return{...m,activityBlocks:h}});return r?(await te(n,{units:c}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,previousValue:i,newValue:o}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,errorMessage:"Block not found or already has correct answer"}}async function is(e){return Pe(e)}async function os(e){var l;const{targetPath:t}=e,n=z(D,"courses",t.documentId),s=await ee(n);if(!s.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const a=s.data();let i,o,r=!1;const c=(l=a.units)==null?void 0:l.map(m=>{var p;const h=(p=m.activityBlocks)==null?void 0:p.map(u=>{if(u.id===t.blockId){i={...u};const f=rs(u);return o=f,r=!0,f}return u});return{...m,activityBlocks:h}});return r?(await te(n,{units:c}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,previousValue:i,newValue:o}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,errorMessage:"Block not found"}}function rs(e){const t=e.content||{};switch(e.type){case"multiple-choice":return{...e,content:{question:t.question||"[×©××œ×” ×—×¡×¨×”]",options:t.options||[],feedback:t.feedback||{correct:"× ×›×•×Ÿ!",incorrect:"×œ× × ×›×•×Ÿ, × ×¡×” ×©×•×‘"},...t}};case"open-question":return{...e,content:{question:t.question||"[×©××œ×” ×—×¡×¨×”]",sampleAnswer:t.sampleAnswer||"",rubric:t.rubric||[],...t}};case"fill-in-blanks":return{...e,content:{text:t.text||"[×˜×§×¡×˜ ×—×¡×¨]",blanks:t.blanks||[],...t}};default:return e}}async function cs(e){var l,m;const{targetPath:t}=e,n=((l=t.field)==null?void 0:l.split(".").pop())||"",s=z(D,"courses",t.documentId),a=await ee(s);if(!a.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const i=a.data();let o=!1,r;const c=(m=i.units)==null?void 0:m.map(h=>{var u;const p=(u=h.activityBlocks)==null?void 0:u.map(f=>{if(f.id===t.blockId){const y=f.content||{};let g;switch(n){case"feedback":g={correct:"×›×œ ×”×›×‘×•×“!",incorrect:"× ×¡×” ×©×•×‘"};break;case"hint":g="×—×©×•×‘ ×¢×œ ×”×ª×©×•×‘×” ×©×•×‘";break;default:g=""}return r=g,o=!0,{...f,content:{...y,[n]:g}}}return f});return{...h,activityBlocks:p}});return o?(await te(s,{units:c}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,newValue:r}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,errorMessage:"Block not found"}}async function ls(e){var c;const{targetPath:t}=e,n=z(D,"courses",t.documentId),s=await ee(n);if(!s.exists())return{id:`result_${Date.now()}`,suggestionId:e.id,status:"failed",appliedAt:new Date,errorMessage:"Course not found"};const a=s.data();let i,o=!1;const r=(c=a.units)==null?void 0:c.map(l=>{var h;const m=(h=l.activityBlocks)==null?void 0:h.filter(p=>p.id===t.blockId?(i=p,o=!0,!1):!0);return{...l,activityBlocks:m}});return o?(await te(n,{units:r}),{id:`result_${Date.now()}`,suggestionId:e.id,status:"success",appliedAt:new Date,previousValue:i}):{id:`result_${Date.now()}`,suggestionId:e.id,status:"skipped",appliedAt:new Date,errorMessage:"Block not found"}}async function us(e={}){const{includeContentQuality:t=!0,includeStudentSimulation:n=!0,includeAIGeneration:s=!1,includeE2EGeneration:a=!1,includeStudentActivity:i=!1,includeAssessmentIntegrity:o=!1,includeKnowledgeBase:r=!1,maxCourses:c=10,saveReport:l=!0,userId:m}=e;console.log("ğŸš€ Starting Comprehensive QA Run...");const h=Date.now(),p=await Ye(void 0,"manual",m),u=[];if(t){console.log(`
ğŸ“ Running Content Quality Agent...`);const g=await Te(c);u.push(g);const x={id:"suite_content_quality",name:"Content Quality Tests",nameHe:"×‘×“×™×§×•×ª ××™×›×•×ª ×ª×•×›×Ÿ",category:"content-quality",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}if(n){console.log(`
ğŸ“ Running Student Simulation Agent...`);const g=await ke(Math.min(c,5));u.push(g);const x={id:"suite_student_simulation",name:"Student Simulation Tests",nameHe:"×‘×“×™×§×•×ª ×¡×™××•×œ×¦×™×™×ª ×ª×œ××™×“",category:"student-simulation",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}if(s){console.log(`
ğŸ¤– Running AI Generation Agent...`);const g=await Ce(["multiple-choice","open-question"]);u.push(g);const x={id:"suite_ai_generation",name:"AI Generation Tests",nameHe:"×‘×“×™×§×•×ª ×™×¦×™×¨×ª AI",category:"ai-generation",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}if(a){console.log(`
ğŸ­ Running E2E Generation Agent...`);const g=await Ae();u.push(g);const x={id:"suite_e2e_generation",name:"E2E Content Generation Tests",nameHe:"×‘×“×™×§×•×ª ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××§×¦×” ×œ×§×¦×”",category:"e2e-generation",tests:g.tests,passedCount:g.summary.passed,failedCount:g.summary.failed,warningCount:g.summary.warnings,skippedCount:0,duration:g.summary.duration,status:g.status};p.suites.push(x)}if(i){console.log(`
ğŸ“ Running Student Activity Agent...`);const g=await De(Math.min(c,5),!0);u.push(g);const x={id:"suite_student_activity",name:"Student Activity Tests",nameHe:"×‘×“×™×§×•×ª ×¤×¢×™×œ×•×ª ×ª×œ××™×“",category:"student-activity",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}if(o){console.log(`
âš–ï¸ Running Assessment Integrity Agent...`);const g=await Re(c);u.push(g);const x={id:"suite_assessment_integrity",name:"Assessment Integrity Tests",nameHe:"×‘×“×™×§×•×ª ××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”",category:"assessment-integrity",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}if(r){console.log(`
ğŸ“š Running Knowledge Base QA Agent...`);const g=await Ne(3);u.push(g);const x={id:"suite_knowledge_base",name:"Knowledge Base Integration Tests",nameHe:"×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×™×ª ×‘×¡×™×¡ ×™×“×¢",category:"knowledge-base",tests:g.allResults,passedCount:g.testsPassed,failedCount:g.testsFailed,warningCount:g.allResults.filter(b=>b.status==="warning").length,skippedCount:0,duration:g.duration,status:g.success?"passed":"failed"};p.suites.push(x)}const f=p.suites.flatMap(g=>g.tests);p.summary={totalTests:f.length,passed:f.filter(g=>g.status==="passed").length,failed:f.filter(g=>g.status==="failed").length,warnings:f.filter(g=>g.status==="warning").length,skipped:f.filter(g=>g.status==="skipped").length,passRate:Math.round(f.filter(g=>g.status==="passed").length/f.length*100),overallStatus:f.some(g=>g.status==="failed"&&g.severity==="critical")?"failed":f.some(g=>g.status==="failed")?"warning":"passed",criticalIssues:f.filter(g=>g.status==="failed"&&g.severity==="critical"),duration:Date.now()-h},p.completedAt=new Date;let y;if(l)try{y=await ze(p),console.log(`
ğŸ’¾ Report saved with ID: ${y}`)}catch(g){console.error("Failed to save report:",g)}return console.log(`
âœ… Comprehensive QA Complete!`),console.log(`   Total Tests: ${p.summary.totalTests}`),console.log(`   Passed: ${p.summary.passed} (${p.summary.passRate}%)`),console.log(`   Failed: ${p.summary.failed}`),console.log(`   Warnings: ${p.summary.warnings}`),console.log(`   Duration: ${Math.round(p.summary.duration/1e3)}s`),{report:p,agentResults:u,reportId:y}}const ds=()=>d.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("polyline",{points:"23 4 23 10 17 10"}),d.jsx("polyline",{points:"1 20 1 14 7 14"}),d.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),de=({className:e="w-4 h-4"})=>d.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("polyline",{points:"20 6 9 17 4 12"})}),je=({className:e="w-4 h-4"})=>d.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),d.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),ms=({className:e="w-4 h-4"})=>d.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),d.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),d.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),X=({className:e="w-5 h-5"})=>d.jsx("svg",{className:`${e} animate-spin`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),ps=()=>d.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("polyline",{points:"6 9 12 15 18 9"})}),gs=()=>d.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("polyline",{points:"18 15 12 9 6 15"})}),hs=()=>d.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),d.jsx("polyline",{points:"12 19 5 12 12 5"})]}),me=({className:e="w-4 h-4"})=>d.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),pe=({className:e="w-4 h-4"})=>d.jsx("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),ys=({className:e="w-4 h-4"})=>d.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),d.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),ge=({status:e})=>{const t=()=>{switch(e){case"passed":return"bg-green-500 text-white";case"failed":return"bg-red-500 text-white";case"warning":return"bg-yellow-500 text-white";case"running":return"bg-blue-500 text-white";case"fixed":return"bg-purple-500 text-white";default:return"bg-gray-500 text-white"}},n=()=>{switch(e){case"passed":return d.jsx(de,{className:"w-3 h-3"});case"failed":return d.jsx(je,{className:"w-3 h-3"});case"warning":return d.jsx(ms,{className:"w-3 h-3"});case"running":return d.jsx(X,{className:"w-3 h-3"});case"fixed":return d.jsx(me,{className:"w-3 h-3"});default:return null}},s=()=>{switch(e){case"passed":return"×¢×‘×¨";case"failed":return"× ×›×©×œ";case"warning":return"××–×”×¨×”";case"running":return"×¨×¥...";case"fixed":return"×ª×•×§×Ÿ";default:return e}};return d.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t()}`,children:[n(),s()]})},Y=({value:e,label:t,color:n})=>d.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 text-center border border-slate-700",children:[d.jsx("div",{className:"text-3xl font-bold",style:{color:n||"white"},children:e}),d.jsx("div",{className:"text-sm text-slate-400 mt-1",children:t})]}),fs=({suggestion:e,onFix:t,isFixing:n,fixResult:s})=>{const a=()=>{switch(e.riskLevel){case"low":return"text-green-400";case"medium":return"text-yellow-400";case"high":return"text-red-400"}},i=()=>{switch(e.riskLevel){case"low":return"×¡×™×›×•×Ÿ × ××•×š";case"medium":return"×¡×™×›×•×Ÿ ×‘×™× ×•× ×™";case"high":return"×¡×™×›×•×Ÿ ×’×‘×•×”"}};return d.jsx("div",{className:"bg-slate-800 rounded-lg p-3 border border-slate-600 mt-2",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(me,{className:"w-4 h-4 text-purple-400"}),d.jsx("span",{className:"text-slate-200",children:e.descriptionHe})]}),d.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-400",children:[d.jsx("span",{className:a(),children:i()}),d.jsxs("span",{children:["~",e.estimatedDuration," ×©× ×™×•×ª"]}),e.requiresAI&&d.jsx("span",{className:"text-purple-400",children:"×“×•×¨×© AI"})]})]}),s?d.jsx("div",{className:"flex items-center gap-2",children:s.status==="success"?d.jsxs("span",{className:"text-green-400 text-xs flex items-center gap-1",children:[d.jsx(de,{className:"w-4 h-4"})," ×ª×•×§×Ÿ"]}):s.status==="failed"?d.jsxs("span",{className:"text-red-400 text-xs flex items-center gap-1",children:[d.jsx(je,{className:"w-4 h-4"})," × ×›×©×œ"]}):d.jsx("span",{className:"text-yellow-400 text-xs",children:s.status})}):e.autoFixable?d.jsx("button",{onClick:()=>t(e),disabled:n,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition ${n?"bg-purple-600/50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:n?d.jsxs(d.Fragment,{children:[d.jsx(X,{className:"w-3 h-3"}),"××ª×§×Ÿ..."]}):d.jsxs(d.Fragment,{children:[d.jsx(pe,{className:"w-3 h-3"}),"×ª×§×Ÿ"]})}):d.jsx("span",{className:"text-xs text-slate-500",children:"×“×•×¨×© ×‘×“×™×§×” ×™×“× ×™×ª"})]})})},Me=({test:e,onFixTest:t,fixingTestId:n,fixResults:s})=>{var h,p;const[a,i]=E.useState(!1),[o,r]=E.useState(!1),c=e.status==="failed"||e.status==="warning"?ne(e):[],l=c.some(u=>u.autoFixable),m=n===e.id;return d.jsxs("div",{className:`bg-slate-900 rounded-lg p-3 border ${s!=null&&s.has(e.id)&&((h=s.get(e.id))==null?void 0:h.status)==="success"?"border-green-600":"border-slate-700"}`,children:[d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx(ge,{status:s!=null&&s.has(e.id)&&((p=s.get(e.id))==null?void 0:p.status)==="success"?"fixed":e.status}),d.jsx("span",{className:"font-medium text-sm",children:e.nameHe})]}),d.jsx("div",{className:"text-xs text-slate-400",children:e.messageHe}),e.duration>0&&d.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["â±ï¸ ",e.duration,"ms"]})]}),l&&t&&!(s!=null&&s.has(e.id))&&d.jsxs("button",{onClick:()=>r(!o),className:"flex items-center gap-1 px-2 py-1 text-xs rounded bg-purple-600/20 text-purple-400 hover:bg-purple-600/30 transition",children:[d.jsx(me,{className:"w-3 h-3"}),c.length," ×ª×™×§×•× ×™×"]})]}),o&&c.length>0&&d.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700",children:[d.jsx("div",{className:"text-xs text-slate-400 mb-2",children:"×”×¦×¢×•×ª ×ª×™×§×•×Ÿ:"}),c.map(u=>d.jsx(fs,{suggestion:u,onFix:async f=>t&&await t(e,f),isFixing:m,fixResult:s==null?void 0:s.get(u.id)},u.id))]}),e.details&&d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>i(!a),className:"text-purple-400 text-xs mt-2 hover:underline",children:a?"×”×¡×ª×¨ ×¤×¨×˜×™×":"×”×¦×’ ×¤×¨×˜×™×"}),a&&d.jsx("pre",{className:"mt-2 p-2 bg-slate-950 rounded text-xs overflow-auto max-h-40 text-slate-300",children:JSON.stringify(e.details,null,2)})]})]})},ws=({suite:e,defaultExpanded:t=!1,onFixTest:n,onFixAll:s,fixingTestId:a,fixResults:i,isFixingAll:o})=>{const[r,c]=E.useState(t),l=e.tests.filter(m=>(m.status==="failed"||m.status==="warning")&&ne(m).some(h=>h.autoFixable)).length;return d.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 mb-4 border border-slate-700",children:[d.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>c(!r),children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-lg",children:"ğŸ“Š"}),d.jsx("span",{className:"font-semibold",children:e.nameHe}),d.jsx(ge,{status:e.status})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("span",{className:"text-green-400",children:["âœ“ ",e.passedCount]}),d.jsxs("span",{className:"text-red-400",children:["âœ— ",e.failedCount]}),d.jsxs("span",{className:"text-yellow-400",children:["âš  ",e.warningCount]}),r?d.jsx(gs,{}):d.jsx(ps,{})]})]}),r&&d.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[l>0&&s&&d.jsx("div",{className:"mb-4 flex justify-end",children:d.jsx("button",{onClick:m=>{m.stopPropagation(),s(e)},disabled:o,className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition ${o?"bg-purple-600/50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:o?d.jsxs(d.Fragment,{children:[d.jsx(X,{className:"w-4 h-4"}),"××ª×§×Ÿ ×”×›×œ..."]}):d.jsxs(d.Fragment,{children:[d.jsx(pe,{className:"w-4 h-4"}),"×ª×§×Ÿ ×”×›×œ (",l,")"]})})}),d.jsx("div",{className:"space-y-2",children:e.tests.map(m=>d.jsx(Me,{test:m,onFixTest:n,fixingTestId:a,fixResults:i},m.id))})]})]})},bs=({onBack:e})=>{const{currentUser:t}=Fe(),[n,s]=E.useState(!1),[a,i]=E.useState(null),[o,r]=E.useState([]),[c,l]=E.useState(""),[m,h]=E.useState({contentQuality:!0,studentSimulation:!0,aiGeneration:!1,e2eGeneration:!1,studentActivity:!1,assessmentIntegrity:!1,knowledgeBase:!1}),[p,u]=E.useState(),[f,y]=E.useState(!1),[g,x]=E.useState(new Map),[b,_]=E.useState(""),[$,N]=E.useState(!1);E.useEffect(()=>{Q()},[]);const Q=async()=>{try{const w=await We(5);r(w)}catch(w){console.error("Failed to load reports:",w)}},V=async()=>{s(!0),l("××ª×—×™×œ ×‘×“×™×§×•×ª..."),x(new Map);try{const{report:w}=await us({includeContentQuality:m.contentQuality,includeStudentSimulation:m.studentSimulation,includeAIGeneration:m.aiGeneration,includeE2EGeneration:m.e2eGeneration,includeStudentActivity:m.studentActivity,includeAssessmentIntegrity:m.assessmentIntegrity,includeKnowledgeBase:m.knowledgeBase,maxCourses:10,saveReport:!0,userId:t==null?void 0:t.uid});i(w),await Q(),l("")}catch(w){console.error("QA run failed:",w),l(`×©×’×™××”: ${w.message}`)}finally{s(!1)}},T=async w=>{s(!0),l("××¨×™×¥ ×¡×•×›×Ÿ..."),x(new Map);try{let v,k,C;switch(w){case"content":v=await Te(10),k="××™×›×•×ª ×ª×•×›×Ÿ",C="content-quality";break;case"simulation":v=await ke(5),k="×¡×™××•×œ×¦×™×™×ª ×ª×œ××™×“",C="student-simulation";break;case"ai":v=await Ce(["multiple-choice","open-question"]),k="×™×¦×™×¨×ª AI",C="ai-generation";break;case"e2e":v=await Ae(),k="×™×¦×™×¨×ª ×ª×•×›×Ÿ ××§×¦×” ×œ×§×¦×”",C="e2e-generation";break;case"activity":v=await De(5,!0),k="×¤×¢×™×œ×•×ª ×ª×œ××™×“",C="student-activity";break;case"integrity":v=await Re(10),k="××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”",C="assessment-integrity";break;case"knowledge-base":v=await Ne(3),k="××™× ×˜×’×¨×¦×™×™×ª ×‘×¡×™×¡ ×™×“×¢",C="knowledge-base";break}const W={id:`single_${Date.now()}`,createdAt:new Date,completedAt:new Date,triggeredBy:"manual",triggeredByUserId:t==null?void 0:t.uid,environment:"development",suites:[{id:`suite_${w}`,name:w,nameHe:k,category:C,tests:v.allResults,passedCount:v.testsPassed,failedCount:v.testsFailed,warningCount:v.allResults.filter(O=>O.status==="warning").length,skippedCount:0,duration:v.duration,status:v.success?"passed":"failed"}],summary:{totalTests:v.testsRun,passed:v.testsPassed,failed:v.testsFailed,warnings:v.allResults.filter(O=>O.status==="warning").length,skipped:0,passRate:v.testsRun>0?Math.round(v.testsPassed/v.testsRun*100):0,overallStatus:v.success?"passed":"failed",criticalIssues:v.criticalIssues,duration:v.duration},metadata:{}};i(W),l("")}catch(v){console.error("Agent run failed:",v),l(`×©×’×™××”: ${v.message}`)}finally{s(!1)}},R=async(w,v)=>{u(w.id),_(`××ª×§×Ÿ: ${v.descriptionHe}`);try{const k=await fe(v,t==null?void 0:t.uid);x(C=>new Map(C).set(w.id,k)),k.status==="success"?_("âœ… ×ª×•×§×Ÿ ×‘×”×¦×œ×—×”!"):_(`âŒ ×ª×™×§×•×Ÿ × ×›×©×œ: ${k.errorMessage}`)}catch(k){_(`âŒ ×©×’×™××”: ${k.message}`)}finally{u(void 0),setTimeout(()=>_(""),3e3)}},A=async w=>{y(!0);const v=[];for(const C of w.tests)if(C.status==="failed"||C.status==="warning"){const O=ne(C).filter(J=>J.autoFixable);O.length>0&&v.push({test:C,suggestion:O[0]})}_(`××ª×§×Ÿ ${v.length} ×‘×¢×™×•×ª...`);let k=0;for(const{test:C,suggestion:W}of v)try{const O=await fe(W,t==null?void 0:t.uid);x(J=>new Map(J).set(C.id,O)),k++,_(`××ª×§×Ÿ ${k}/${v.length}...`)}catch(O){console.error("Fix failed:",O)}_(`âœ… ×”×•×©×œ×! ${k}/${v.length} ×ª×•×§× ×•`),y(!1),setTimeout(()=>_(""),5e3)},H=(a==null?void 0:a.suites.reduce((w,v)=>w+v.tests.filter(k=>(k.status==="failed"||k.status==="warning")&&ne(k).some(C=>C.autoFixable)).length,0))||0,q=()=>{if(!a)return"";const w=[];return w.push("# ğŸ“Š ×“×•×— QA ××œ×"),w.push(`×ª××¨×™×š: ${new Date(a.createdAt).toLocaleString("he-IL")}`),w.push(`×¡×‘×™×‘×”: ${a.environment}`),w.push(""),w.push("## ğŸ“ˆ ×¡×™×›×•×"),w.push(`- ×¡×”"×› ×‘×“×™×§×•×ª: ${a.summary.totalTests}`),w.push(`- ×¢×‘×¨×•: ${a.summary.passed} (${a.summary.passRate}%)`),w.push(`- × ×›×©×œ×•: ${a.summary.failed}`),w.push(`- ××–×”×¨×•×ª: ${a.summary.warnings}`),w.push(`- ×–××Ÿ ×¨×™×¦×”: ${Math.round(a.summary.duration/1e3)} ×©× ×™×•×ª`),w.push(""),a.summary.criticalIssues.length>0&&(w.push("## ğŸ”´ ×‘×¢×™×•×ª ×§×¨×™×˜×™×•×ª"),a.summary.criticalIssues.forEach(v=>{w.push(`### âŒ ${v.nameHe}`),w.push(`- ×”×•×“×¢×”: ${v.messageHe}`),v.details&&(w.push("- ×¤×¨×˜×™×:"),w.push("```json"),w.push(JSON.stringify(v.details,null,2)),w.push("```")),w.push("")})),w.push("## ğŸ“‹ ×ª×•×¦××•×ª ××¤×•×¨×˜×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”"),w.push(""),a.suites.forEach(v=>{const k=v.status==="passed"?"âœ…":v.status==="failed"?"âŒ":"âš ï¸";w.push(`### ${k} ${v.nameHe}`),w.push(`- ×¢×‘×¨×•: ${v.passedCount} | × ×›×©×œ×•: ${v.failedCount} | ××–×”×¨×•×ª: ${v.warningCount}`),w.push(""),v.tests.forEach(C=>{const W=C.status==="passed"?"âœ…":C.status==="failed"?"âŒ":"âš ï¸";if(w.push(`#### ${W} ${C.nameHe}`),w.push(`- ×¡×˜×˜×•×¡: ${C.status}`),w.push(`- ×”×•×“×¢×”: ${C.messageHe}`),C.duration>0&&w.push(`- ×–××Ÿ: ${C.duration}ms`),C.details&&(w.push("- **×¤×¨×˜×™× ××œ××™×:**"),w.push("```json"),w.push(JSON.stringify(C.details,null,2)),w.push("```")),C.status==="failed"||C.status==="warning"){const O=ne(C);O.length>0&&(w.push("- **×”×¦×¢×•×ª ×ª×™×§×•×Ÿ:**"),O.forEach(J=>{w.push(`  - ${J.descriptionHe} (${J.autoFixable?"××•×˜×•××˜×™":"×™×“× ×™"})`)}))}w.push("")})}),w.push("---"),w.push("## ğŸ“„ JSON ××œ× (×œ× ×™×ª×•×— ×˜×›× ×™)"),w.push("```json"),w.push(JSON.stringify(a,null,2)),w.push("```"),w.join(`
`)},ae=async()=>{const w=q();try{await navigator.clipboard.writeText(w),N(!0),setTimeout(()=>N(!1),3e3)}catch(v){console.error("Failed to copy:",v);const k=document.createElement("textarea");k.value=w,document.body.appendChild(k),k.select(),document.execCommand("copy"),document.body.removeChild(k),N(!0),setTimeout(()=>N(!1),3e3)}};return d.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-6",dir:"rtl",children:[d.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[e&&d.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-700 hover:bg-slate-800 transition",children:[d.jsx(hs,{}),"×—×–×¨×”"]}),d.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",children:["ğŸ§  ××¢×¨×›×ª ×‘×“×™×§×•×ª ××™×›×•×ª",d.jsx("span",{className:"text-xs bg-purple-600 px-2 py-1 rounded-full",children:"Admin"})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:ae,disabled:!a,className:`flex items-center gap-2 px-4 py-2.5 rounded-lg font-medium transition ${$?"bg-green-600 text-white":a?"bg-slate-700 hover:bg-slate-600 border border-slate-600":"bg-slate-800 text-slate-500 cursor-not-allowed border border-slate-700"}`,title:a?"×”×¢×ª×§ ×“×•×— ××œ× ×œ×œ×•×—":"×”×¨×¥ ×‘×“×™×§×•×ª ×›×“×™ ×œ×™×¦×•×¨ ×“×•×—",children:$?d.jsxs(d.Fragment,{children:[d.jsx(de,{className:"w-4 h-4"}),"×”×•×¢×ª×§!"]}):d.jsxs(d.Fragment,{children:[d.jsx(ys,{className:"w-4 h-4"}),"×”×¢×ª×§ ×“×•×— ××œ×"]})}),d.jsxs("button",{onClick:V,disabled:n||f,className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition ${n||f?"bg-purple-600/50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:[n?d.jsx(X,{}):d.jsx(ds,{}),n?"×¨×¥...":"×”×¨×¥ ×‘×“×™×§×•×ª"]})]})]}),d.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 mb-6 border border-slate-700",children:[d.jsx("h3",{className:"font-semibold mb-3",children:"×‘×—×¨ ×¡×•×›× ×™× ×œ×”×¨×¦×”:"}),d.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.contentQuality,onChange:w=>h(v=>({...v,contentQuality:w.target.checked})),className:"w-4 h-4"}),"ğŸ“ ×‘×“×™×§×ª ××™×›×•×ª ×ª×•×›×Ÿ"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.studentSimulation,onChange:w=>h(v=>({...v,studentSimulation:w.target.checked})),className:"w-4 h-4"}),"ğŸ“ ×¡×™××•×œ×¦×™×™×ª ×ª×œ××™×“"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.aiGeneration,onChange:w=>h(v=>({...v,aiGeneration:w.target.checked})),className:"w-4 h-4"}),"âœ¨ ×‘×“×™×§×ª ×™×¦×™×¨×ª AI (×¢×œ×•×ª API)"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.e2eGeneration,onChange:w=>h(v=>({...v,e2eGeneration:w.target.checked})),className:"w-4 h-4"}),"ğŸ­ ×™×¦×™×¨×ª ×ª×•×›×Ÿ ××§×¦×” ×œ×§×¦×” (×¢×œ×•×ª API)"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.studentActivity,onChange:w=>h(v=>({...v,studentActivity:w.target.checked})),className:"w-4 h-4"}),"ğŸ“ ×¤×¢×™×œ×•×ª ×ª×œ××™×“ (× ×™×§×•×“)"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.assessmentIntegrity,onChange:w=>h(v=>({...v,assessmentIntegrity:w.target.checked})),className:"w-4 h-4"}),"âš–ï¸ ××™× ×˜×’×¨×™×˜×™ ×”×¢×¨×›×”"]}),d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:m.knowledgeBase,onChange:w=>h(v=>({...v,knowledgeBase:w.target.checked})),className:"w-4 h-4"}),"ğŸ“š ××™× ×˜×’×¨×¦×™×™×ª ×‘×¡×™×¡ ×™×“×¢"]})]}),d.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.jsx("span",{className:"text-slate-400 text-sm",children:"×”×¨×¦×” ××”×™×¨×”:"}),d.jsx("button",{onClick:()=>T("content"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"ğŸ“ ××™×›×•×ª ×ª×•×›×Ÿ"}),d.jsx("button",{onClick:()=>T("simulation"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"ğŸ“ ×¡×™××•×œ×¦×™×”"}),d.jsx("button",{onClick:()=>T("ai"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"âœ¨ ×™×¦×™×¨×ª AI"}),d.jsx("button",{onClick:()=>T("e2e"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"ğŸ­ E2E ×™×¦×™×¨×ª ×ª×•×›×Ÿ"}),d.jsx("button",{onClick:()=>T("activity"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"ğŸ“ ×¤×¢×™×œ×•×ª ×ª×œ××™×“"}),d.jsx("button",{onClick:()=>T("integrity"),disabled:n,className:"px-3 py-1 text-xs rounded bg-slate-700 hover:bg-slate-600 transition disabled:opacity-50",children:"âš–ï¸ ××™× ×˜×’×¨×™×˜×™"}),d.jsx("button",{onClick:()=>T("knowledge-base"),disabled:n,className:"px-3 py-1 text-xs rounded bg-purple-700 hover:bg-purple-600 transition disabled:opacity-50",children:"ğŸ“š ×‘×¡×™×¡ ×™×“×¢"})]})]}),(c||b)&&d.jsxs("div",{className:`rounded-xl p-4 mb-6 flex items-center gap-3 ${b.includes("âœ…")?"bg-green-900/50 border border-green-700":b.includes("âŒ")?"bg-red-900/50 border border-red-700":"bg-blue-900/50 border border-blue-700"}`,children:[!b.includes("âœ…")&&!b.includes("âŒ")&&d.jsx(X,{}),d.jsx("span",{children:b||c})]}),a&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-4 mb-6",children:[d.jsx(Y,{value:a.summary.totalTests,label:"×¡×”×´×› ×‘×“×™×§×•×ª"}),d.jsx(Y,{value:a.summary.passed,label:"×¢×‘×¨×•",color:"#10b981"}),d.jsx(Y,{value:a.summary.failed,label:"× ×›×©×œ×•",color:"#ef4444"}),d.jsx(Y,{value:a.summary.warnings,label:"××–×”×¨×•×ª",color:"#f59e0b"}),d.jsx(Y,{value:H,label:"× ×™×ª×Ÿ ×œ×ª×™×§×•×Ÿ",color:"#a855f7"}),d.jsx(Y,{value:`${a.summary.passRate}%`,label:"××—×•×– ×”×¦×œ×—×”",color:a.summary.passRate>=80?"#10b981":a.summary.passRate>=50?"#f59e0b":"#ef4444"}),d.jsx(Y,{value:`${Math.round(a.summary.duration/1e3)}s`,label:"×–××Ÿ ×¨×™×¦×”"})]}),d.jsxs("div",{className:`rounded-xl p-4 mb-6 flex items-center justify-between ${a.summary.overallStatus==="passed"?"bg-green-900/50 border border-green-700":a.summary.overallStatus==="failed"?"bg-red-900/50 border border-red-700":"bg-yellow-900/50 border border-yellow-700"}`,children:[d.jsxs("div",{className:"flex items-center gap-3 text-lg font-semibold",children:[a.summary.overallStatus==="passed"?"âœ…":a.summary.overallStatus==="failed"?"âŒ":"âš ï¸",d.jsx("span",{children:a.summary.overallStatus==="passed"?"×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”!":a.summary.overallStatus==="failed"?"× ××¦××• ×‘×¢×™×•×ª ×§×¨×™×˜×™×•×ª":"× ××¦××• ××–×”×¨×•×ª"})]}),H>0&&d.jsx("button",{onClick:()=>{a.suites.forEach(w=>A(w))},disabled:f,className:`flex items-center gap-2 px-5 py-2.5 rounded-lg font-medium transition ${f?"bg-purple-600/50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:f?d.jsxs(d.Fragment,{children:[d.jsx(X,{}),"××ª×§×Ÿ..."]}):d.jsxs(d.Fragment,{children:[d.jsx(pe,{}),"×ª×§×Ÿ ×”×›×œ (",H,")"]})})]}),a.summary.criticalIssues.length>0&&d.jsxs("div",{className:"bg-red-900/30 border border-red-700 rounded-xl p-4 mb-6",children:[d.jsxs("h3",{className:"text-red-400 font-semibold mb-3 flex items-center gap-2",children:["âš ï¸ ×‘×¢×™×•×ª ×§×¨×™×˜×™×•×ª (",a.summary.criticalIssues.length,")"]}),d.jsx("div",{className:"space-y-2",children:a.summary.criticalIssues.map(w=>d.jsx(Me,{test:w,onFixTest:R,fixingTestId:p,fixResults:g},w.id))})]}),d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"×ª×•×¦××•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”"}),a.suites.map(w=>d.jsx(ws,{suite:w,defaultExpanded:w.status==="failed",onFixTest:R,onFixAll:A,fixingTestId:p,fixResults:g,isFixingAll:f},w.id))]}),o.length>0&&!a&&d.jsxs("div",{className:"bg-slate-800 rounded-xl p-4 border border-slate-700",children:[d.jsx("h3",{className:"font-semibold mb-4",children:"×“×•×—×•×ª ××—×¨×•× ×™×"}),d.jsx("div",{className:"space-y-2",children:o.map(w=>d.jsxs("div",{onClick:()=>i(w),className:"flex justify-between items-center p-3 bg-slate-900 rounded-lg border border-slate-700 cursor-pointer hover:bg-slate-800 transition",children:[d.jsxs("div",{children:[d.jsx("div",{className:"font-medium",children:new Date(w.createdAt).toLocaleString("he-IL")}),d.jsxs("div",{className:"text-sm text-slate-400",children:[w.summary.totalTests," ×‘×“×™×§×•×ª | ",w.summary.passRate,"% ×”×¦×œ×—×”"]})]}),d.jsx(ge,{status:w.summary.overallStatus})]},w.id))})]}),!a&&o.length===0&&!n&&d.jsxs("div",{className:"bg-slate-800 rounded-xl p-12 text-center border border-slate-700",children:[d.jsx("div",{className:"text-5xl mb-4 opacity-50",children:"ğŸ§ "}),d.jsx("h3",{className:"text-lg font-semibold mb-2",children:"××™×Ÿ ×“×•×—×•×ª ×‘×“×™×§×•×ª"}),d.jsx("p",{className:"text-slate-400",children:'×œ×—×¥ ×¢×œ "×”×¨×¥ ×‘×“×™×§×•×ª" ×›×“×™ ×œ×”×ª×—×™×œ'})]})]})};export{bs as default};
//# sourceMappingURL=QADashboard-BkCVd0t5.js.map
