var a=Object.defineProperty;var T=(e,t,o)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var i=(e,t,o)=>T(e,typeof t!="symbol"?t+"":t,o);import{z as d,aw as u,p as y,av as f,c2 as k}from"./index-1x3sw4DL.js";const C=e=>{var o,n;const t=e==null?void 0:e.wizardData;return t!=null&&t.youtubeUrl||t!=null&&t.youtubeVideoId?"youtube":(o=t==null?void 0:t.uploadedFileName)!=null&&o.toLowerCase().endsWith(".pdf")||(n=e==null?void 0:e.sourceFileName)!=null&&n.toLowerCase().endsWith(".pdf")?"pdf":t!=null&&t.sourceUrl||t!=null&&t.webUrl?"url":t!=null&&t.pastedText||e!=null&&e.fullBookContent?"text":"manual"},$=e=>{const t=e==null?void 0:e.wizardData;return t!=null&&t.videoDuration?t.videoDuration:((e==null?void 0:e.fullBookContent)||(t==null?void 0:t.pastedText)||"").length},x=async e=>{try{const t=u(y,"generationTimings");await f(t,{...e,createdAt:k.now(),model:e.model||"gemini-3-pro-preview"}),console.log("⏱️ [Timing] Saved generation timing:",{productType:e.productType,total:`${(e.timings.total/1e3).toFixed(1)}s`,skeleton:`${(e.timings.skeleton/1e3).toFixed(1)}s`,content:`${(e.timings.contentGeneration/1e3).toFixed(1)}s`})}catch(t){console.warn("⏱️ [Timing] Failed to save timing data:",t)}};class S{constructor(t,o,n,m){i(this,"startTime");i(this,"marks",{});i(this,"courseId");i(this,"unitId");i(this,"productType");i(this,"sourceType");i(this,"sourceLength");i(this,"stepCount",0);this.startTime=performance.now(),this.courseId=t,this.unitId=o,this.productType=n,this.sourceType=C(m),this.sourceLength=$(m),console.log(`⏱️ [Timing] Started timer for ${n} generation`)}mark(t){this.marks[t]=performance.now();const o=this.marks[t]-this.startTime;console.log(`⏱️ [Timing] ${t}: ${(o/1e3).toFixed(2)}s`)}getDuration(t,o){const n=t?this.marks[t]:this.startTime;return(o?this.marks[o]:performance.now())-n}setStepCount(t){this.stepCount=t}async finish(t,o){const n=performance.now(),m=n-this.startTime,l=this.marks.skeleton_complete||this.marks.placeholders_ready||this.startTime,h=this.marks.content_complete||n,g=l-this.startTime,c=h-l,r=this.marks.image_complete?this.marks.image_complete-(this.marks.image_start||l):void 0,s=d.currentUser,p={userId:(s==null?void 0:s.uid)||"anonymous",...(s==null?void 0:s.email)&&{userEmail:s.email},courseId:this.courseId,unitId:this.unitId,productType:this.productType,sourceType:this.sourceType,sourceLength:this.sourceLength,stepCount:this.stepCount,timings:{total:m,skeleton:g,contentGeneration:c,perStepAverage:this.stepCount>0?c/this.stepCount:0,...r!==void 0&&{imageGeneration:r}},success:t,...o&&{errorMessage:o}};console.log("⏱️ [Timing] === Generation Complete ==="),console.log(`⏱️ [Timing] Product: ${this.productType}`),console.log(`⏱️ [Timing] Source: ${this.sourceType} (${this.sourceLength} chars)`),console.log(`⏱️ [Timing] Steps: ${this.stepCount}`),console.log(`⏱️ [Timing] Total: ${(m/1e3).toFixed(2)}s`),console.log(`⏱️ [Timing] - Skeleton: ${(g/1e3).toFixed(2)}s`),console.log(`⏱️ [Timing] - Content: ${(c/1e3).toFixed(2)}s`),r&&console.log(`⏱️ [Timing] - Images: ${(r/1e3).toFixed(2)}s`),console.log(`⏱️ [Timing] - Per Step Avg: ${(p.timings.perStepAverage/1e3).toFixed(2)}s`),console.log(`⏱️ [Timing] Success: ${t}`),console.log("⏱️ [Timing] ========================"),await x(p)}}export{S as GenerationTimer,C as detectSourceType,$ as getSourceLength,x as saveGenerationTiming};
//# sourceMappingURL=generationTimingService-B4dIuwqG.js.map
