{"version":3,"mappings":"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","names":["__iconNode","IconBolt","createReactComponent","IconBrandGoogle","IconBroadcast","IconMailOff","GamificationService","userId","userRef","doc","db","userSnap","getDoc","data","today","lastLearnDate","yesterday","yesterdayStr","newStreak","message","updateDoc","serverTimestamp","amount","increment","snap","enabled","generateGroupConfig","topic","groupType","assignLessonToGroup","teacherId","classId","studentIds","config","docRef","addDoc","collection","error","SmartGroupingPanel","students","onAssignmentCreated","Group","s","Group","Group","groups","IconHavana","IconYisum","IconHaamaka","activeGroup","setActiveGroup","useState","setTopic","loading","setLoading","handleAssignClick","handleSubmit","targetStudents","_a","g","jsxs","jsx","IconBrain","group","IconSparkles","i","createPortal","IconX","e","StudentLearningProfile","studentId","studentName","onClose","profile","setProfile","errorFingerprint","setErrorFingerprint","proficiencyVector","setProficiencyVector","adaptiveStats","setAdaptiveStats","setError","useEffect","statsRef","statsSnap","errorRef","errorSnap","profRef","profSnap","stats","getAdaptiveStats","err","IconAlertTriangle","performance","behavioral","engagement","mediaPrefs","totalPref","preferredStyle","IconChartBar","MetricCard","IconTarget","IconClock","IconBulb","IconBook","IconTrendingUp","StyleChip","IconVideo","IconDeviceGamepad2","a","b","tag","count","translateErrorTag","mastery","t","displayName","IconRefresh","StatBadge","formatDate","label","value","color","icon","colorClasses","percentage","date","ClassroomConnectButton","googleClassroomToken","connectClassroom","useAuth","BASE_URL","googleClassroomService","accessToken","response","courseId","assignment","courseWorkId","submissionId","grade","ClassroomAssignmentModal","isOpen","examTitle","examId","courses","setCourses","selectedCourseId","setSelectedCourseId","isAssigning","setIsAssigning","loadCourses","list","handleAssign","link","course","Fragment","IconCheck","CoursePlayer","React","__vitePreload","n","m","TaskDetailDashboard","GRADE_ORDER","normalizeText","text","StudentInsightsModal","student","analytics","activeTab","setActiveTab","IconFlag","w","getProductTypeDisplay","productType","mode","actualType","labels","colors","headerColors","cardColors","TeacherDashboard","onEditCourse","onViewInsights","onNavigateToAnalytics","currentUser","usageStats","rawStudents","setRawStudents","rawSubmissions","setRawSubmissions","safetyAlerts","setSafetyAlerts","coursesMap","setCoursesMap","isCoursesLoaded","setIsCoursesLoaded","copiedId","setCopiedId","deleteConfirmation","setDeleteConfirmation","assignmentModalOpen","setAssignmentModalOpen","assignmentData","setAssignmentData","defaultDate","createdAssignmentLink","setCreatedAssignmentLink","shareModalCourse","setShareModalCourse","filterSubject","setFilterSubject","filterGrade","setFilterGrade","filterType","setFilterType","searchTerm","setSearchTerm","viewMode","setViewMode","sortConfig","setSortConfig","selectedStudentIds","setSelectedStudentIds","viewingTestStudent","setViewingTestStudent","reportStudent","setReportStudent","viewingInsightStudent","setViewingInsightStudent","viewingLessonPlan","setViewingLessonPlan","viewingControlCenter","setViewingControlCenter","aiInsight","setAiInsight","aiLoading","setAiLoading","groupAnalysis","setGroupAnalysis","feedbackText","setFeedbackText","isSavingFeedback","setIsSavingFeedback","showOnlyAlerts","setShowOnlyAlerts","courseFeedbackStats","setCourseFeedbackStats","isFeedbackLoading","setIsFeedbackLoading","showMobileFilters","setShowMobileFilters","emailReportsEnabled","setEmailReportsEnabled","isEmailSettingLoading","setIsEmailSettingLoading","showUsageModal","setShowUsageModal","handleToggleEmailReports","feedbackService","assignmentsMap","setAssignmentsMap","q","query","where","unsubCourses","onSnapshot","snapshot","map","rawSubject","rawGrade","getDocs","qSub","unsubSub","subs","unsubscribe","raw","qAlerts","unsubAlerts","alerts","allData","useMemo","studentsMap","courseMeta","subject","gradeLevel","courseTitle","id","currentName","hasAlert","_b","sub","key","score","_c","_d","availableSubjects","subjects","c","availableGrades","grades","normA","normB","indexA","indexB","aggregatedCourses","grouped","meta","normMetaSubject","normMetaGrade","normFilterSubject","normFilterGrade","isLesson","isExam","matchType","matchSubject","matchGrade","matchSearch","upcoming","nextDue","studentProgress","result","direction","valA","valB","getTime","d","currentCourseStudents","sum","acc","curr","dist","risk","handleClassAnalysis","insight","generateClassAnalysis","handleGroupAnalysis","selectedGroup","avg","toggleSelection","newSet","handleCopyLink","handleCreateAssignment","combinedDate","handleCopyCreatedLink","handleCloseAssignmentModal","handleEditClick","handleDeleteCourse","deleteDoc","handleSaveFeedback","subId","display","IconLayer","IconTrash","IconEye","IconArrowBack","IconList","IconMail","IconSearch","IconEdit","IconLink","IconShare","IconStudent","IconArrowUp","IconArrowDown","_f","_g","_h","_i","fb","_l","IconLoader","generateStudentReport","r","IconCopy","prev","ShareModal","AIStarsSpinner","type","IconPhoto","IconMicrophone"],"ignoreList":[0,1,2,3],"sources":["../../node_modules/@tabler/icons-react/dist/esm/icons/IconBolt.mjs","../../node_modules/@tabler/icons-react/dist/esm/icons/IconBrandGoogle.mjs","../../node_modules/@tabler/icons-react/dist/esm/icons/IconBroadcast.mjs","../../node_modules/@tabler/icons-react/dist/esm/icons/IconMailOff.mjs","../../src/services/telemetry.ts","../../src/services/LessonDistributor.ts","../../src/components/SmartGroupingPanel.tsx","../../src/components/dashboard/StudentLearningProfile.tsx","../../src/components/teacher/ClassroomConnectButton.tsx","../../src/services/googleClassroom.ts","../../src/components/teacher/ClassroomAssignmentModal.tsx","../../src/components/TeacherDashboard.tsx"],"sourcesContent":["/**\n * @license @tabler/icons-react v3.36.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11\", \"key\": \"svg-0\" }]];\nconst IconBolt = createReactComponent(\"outline\", \"bolt\", \"Bolt\", __iconNode);\n\nexport { __iconNode, IconBolt as default };\n//# sourceMappingURL=IconBolt.mjs.map\n","/**\n * @license @tabler/icons-react v3.36.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M20.945 11a9 9 0 1 1 -3.284 -5.997l-2.655 2.392a5.5 5.5 0 1 0 2.119 6.605h-4.125v-3h7.945z\", \"key\": \"svg-0\" }]];\nconst IconBrandGoogle = createReactComponent(\"outline\", \"brand-google\", \"BrandGoogle\", __iconNode);\n\nexport { __iconNode, IconBrandGoogle as default };\n//# sourceMappingURL=IconBrandGoogle.mjs.map\n","/**\n * @license @tabler/icons-react v3.36.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M18.364 19.364a9 9 0 1 0 -12.728 0\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M15.536 16.536a5 5 0 1 0 -7.072 0\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M12 13m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0\", \"key\": \"svg-2\" }]];\nconst IconBroadcast = createReactComponent(\"outline\", \"broadcast\", \"Broadcast\", __iconNode);\n\nexport { __iconNode, IconBroadcast as default };\n//# sourceMappingURL=IconBroadcast.mjs.map\n","/**\n * @license @tabler/icons-react v3.36.0 - MIT\n *\n * This source code is licensed under the MIT license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createReactComponent from '../createReactComponent.mjs';\n\nconst __iconNode = [[\"path\", { \"d\": \"M9 5h10a2 2 0 0 1 2 2v10m-2 2h-14a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2\", \"key\": \"svg-0\" }], [\"path\", { \"d\": \"M3 7l9 6l.565 -.377m2.435 -1.623l6 -4\", \"key\": \"svg-1\" }], [\"path\", { \"d\": \"M3 3l18 18\", \"key\": \"svg-2\" }]];\nconst IconMailOff = createReactComponent(\"outline\", \"mail-off\", \"MailOff\", __iconNode);\n\nexport { __iconNode, IconMailOff as default };\n//# sourceMappingURL=IconMailOff.mjs.map\n","import { db } from '../firebase';\r\nimport { doc, getDoc, updateDoc, setDoc, increment, serverTimestamp } from 'firebase/firestore';\r\nimport type { UserProfile } from '../types/user';\r\n\r\nexport const GamificationService = {\r\n    /**\r\n     * Updates the user's streak based on their last learning date.\r\n     * Should be called when a user starts or completes a significant learning action.\r\n     */\r\n    updateStreak: async (userId: string): Promise<{ streak: number, message?: string }> => {\r\n        if (!userId) return { streak: 0 };\r\n\r\n        const userRef = doc(db, 'users', userId);\r\n        const userSnap = await getDoc(userRef);\r\n\r\n        if (!userSnap.exists()) {\r\n            return { streak: 0 };\r\n        }\r\n\r\n        const data = userSnap.data() as UserProfile;\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const lastLearnDate = data.lastLearnDate || '';\r\n\r\n        if (lastLearnDate === today) {\r\n            // Already learned today, no streak change\r\n            return { streak: data.streak || 0 };\r\n        }\r\n\r\n        // Calculate difference in days\r\n        const yesterday = new Date();\r\n        yesterday.setDate(yesterday.getDate() - 1);\r\n        const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n        let newStreak = data.streak || 0;\r\n        let message = '';\r\n\r\n        if (lastLearnDate === yesterdayStr) {\r\n            // Continued streak\r\n            newStreak += 1;\r\n            message = 'Streak Increased! ';\r\n        } else {\r\n            // Broken streak (or first time)\r\n            newStreak = 1;\r\n            // Only show broken message if they had a streak before\r\n            if ((data.streak || 0) > 0) message = 'Streak Reset ';\r\n            else message = 'First Day! ';\r\n        }\r\n\r\n        await updateDoc(userRef, {\r\n            streak: newStreak,\r\n            lastLearnDate: today,\r\n            lastActive: serverTimestamp()\r\n        });\r\n\r\n        return { streak: newStreak, message };\r\n    },\r\n\r\n    /**\r\n     * Adds XP to the user account\r\n     */\r\n    addXP: async (userId: string, amount: number) => {\r\n        if (!userId || amount <= 0) return;\r\n\r\n        const userRef = doc(db, 'users', userId);\r\n\r\n        // Use atomic increment\r\n        await updateDoc(userRef, {\r\n            xp: increment(amount),\r\n            lastActive: serverTimestamp()\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Get user profile\r\n     */\r\n    getUserProfile: async (userId: string): Promise<UserProfile | null> => {\r\n        if (!userId) return null;\r\n        const snap = await getDoc(doc(db, 'users', userId));\r\n        if (snap.exists()) return snap.data() as UserProfile;\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * Update email reports setting for teacher\r\n     */\r\n    updateEmailReportsSetting: async (userId: string, enabled: boolean): Promise<void> => {\r\n        if (!userId) return;\r\n        const userRef = doc(db, 'users', userId);\r\n        await updateDoc(userRef, {\r\n            emailReportsEnabled: enabled\r\n        });\r\n    }\r\n};\r\n","import { db } from '../firebase';\r\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\r\n\r\n/**\r\n * Group types for adaptive content delivery:\r\n * -  (Understanding) - for struggling students\r\n * -  (Application) - for standard students\r\n * -  (Deepening) - for advanced students\r\n */\r\nexport type GroupType = '' | '' | '';\r\n\r\ninterface AIConfig {\r\n    bloom_level: string;\r\n    system_instruction: string;\r\n    preferred_modules: string[];\r\n    difficulty: string;\r\n    tone: string;\r\n    focus?: string;\r\n    format?: string;\r\n    extra?: string;\r\n}\r\n\r\n/**\r\n * Generates the specific AI configuration based on the group type.\r\n * Acts as a \"Prompt Modifier\" logic layer.\r\n */\r\nexport const generateGroupConfig = (topic: string, groupType: GroupType): AIConfig => {\r\n    switch (groupType) {\r\n        case '': // Understanding - for struggling students\r\n            return {\r\n                difficulty: \"Easy\",\r\n                bloom_level: \"Remember/Understand\",\r\n                system_instruction: `Topic: ${topic}. Break down complex terms. Use simple language. Provide immediate positive feedback.`,\r\n                tone: \"Encouraging\",\r\n                preferred_modules: [\"memory_game\", \"sorting\", \"simple_quiz\"],\r\n                focus: \"Core Concepts & Visuals\"\r\n            };\r\n        case '': // Deepening - for advanced students\r\n            return {\r\n                difficulty: \"Hard\",\r\n                bloom_level: \"Analyze/Evaluate\",\r\n                system_instruction: `Topic: ${topic}. Ask open-ended questions that require synthesis. Reduce hints.`,\r\n                tone: \"Intellectual\",\r\n                preferred_modules: [\"open_question\", \"logic_ordering\", \"case_study\"],\r\n                format: \"Escape Room / Riddle\",\r\n                extra: \"Critical Thinking Questions\"\r\n            };\r\n        case '': // Application - standard level\r\n        default:\r\n            return {\r\n                difficulty: \"Medium\",\r\n                bloom_level: \"Apply/Analyze\",\r\n                system_instruction: `Topic: ${topic}. Standard Curriculum. Balanced approach.`,\r\n                tone: \"Balanced\",\r\n                preferred_modules: [\"multiple_choice\", \"matching\", \"short_answer\"]\r\n            };\r\n    }\r\n};\r\n\r\n/**\r\n * Pushes a new job to the Firestore Queue for the AI Worker to pick up.\r\n */\r\nexport const assignLessonToGroup = async (\r\n    teacherId: string,\r\n    classId: string,\r\n    topic: string,\r\n    groupType: GroupType,\r\n    studentIds: string[]\r\n) => {\r\n    if (!topic || studentIds.length === 0) {\r\n        throw new Error(\"Missing topic or students.\");\r\n    }\r\n\r\n    const config = generateGroupConfig(topic, groupType);\r\n\r\n    try {\r\n        const docRef = await addDoc(collection(db, 'lesson_generation_queue'), {\r\n            status: 'pending',\r\n            createdAt: serverTimestamp(),\r\n            teacherId,\r\n            classId,\r\n            topic,\r\n            groupType,\r\n            config, // The \"Prompt Engineering\" payload\r\n            studentIds, // The auto-assignment target\r\n            priority: groupType === '' ? 'high' : 'normal' // Prioritize help for strugglers\r\n        });\r\n\r\n        console.log(`Job enqueued: ${docRef.id} for ${groupType} group.`);\r\n        return docRef.id;\r\n    } catch (error) {\r\n        console.error(\"Error queueing lesson generation:\", error);\r\n        throw error;\r\n    }\r\n};\r\n","import React, { useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { IconSparkles, IconBrain, IconX, IconHavana, IconYisum, IconHaamaka } from '../icons';\r\nimport { assignLessonToGroup, type GroupType } from '../services/LessonDistributor';\r\n\r\ninterface SmartGroupingPanelProps {\r\n    classId: string;\r\n    teacherId: string;\r\n    students: any[]; // Assuming student object has score/id/name etc.\r\n    onAssignmentCreated?: () => void;\r\n}\r\n\r\nexport const SmartGroupingPanel: React.FC<SmartGroupingPanelProps> = ({ classId, teacherId, students, onAssignmentCreated }) => {\r\n    // 1. Logic to segment students (Simplified for UI demo, real logic might be more complex)\r\n    // Using Hebrew level names:  (Understanding),  (Application),  (Deepening)\r\n    const Group = students.filter(s => s.score < 60);\r\n    const Group = students.filter(s => s.score >= 60 && s.score < 90);\r\n    const Group = students.filter(s => s.score >= 90);\r\n\r\n    const groups: { type: GroupType; label: string; icon: React.FC<{ className?: string }>; data: any[], color: string, description: string }[] = [\r\n        { type: '', label: '', icon: IconHavana, data: Group, color: \"bg-blue-50 border-blue-200 text-blue-700\", description: \" ,    .\" },\r\n        { type: '', label: '', icon: IconYisum, data: Group, color: \"bg-amber-50 border-amber-200 text-amber-700\", description: \" ,   .\" },\r\n        { type: '', label: '', icon: IconHaamaka, data: Group, color: \"bg-purple-50 border-purple-200 text-purple-700\", description: \",    .\" }\r\n    ];\r\n\r\n    // Modal State\r\n    const [activeGroup, setActiveGroup] = useState<GroupType | null>(null);\r\n    const [topic, setTopic] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleAssignClick = (groupType: GroupType) => {\r\n        setActiveGroup(groupType);\r\n        setTopic(\"\"); // Reset topic\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!activeGroup || !topic) return;\r\n\r\n        const targetStudents = groups.find(g => g.type === activeGroup)?.data.map(s => s.id) || [];\r\n        if (targetStudents.length === 0) return alert(\"   .\");\r\n\r\n        setLoading(true);\r\n        try {\r\n            await assignLessonToGroup(teacherId, classId, topic, activeGroup, targetStudents);\r\n            alert(` '${topic}'     ${activeGroup}!`);\r\n            if (onAssignmentCreated) onAssignmentCreated();\r\n            setActiveGroup(null);\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert(\"  .\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h3 className=\"text-xl font-bold flex items-center gap-2 text-slate-800\">\r\n                <IconBrain className=\"w-6 h-6 text-indigo-600\" />\r\n                  \r\n            </h3>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {groups.map((group) => (\r\n                    <div key={group.type} className={`p-6 rounded-2xl border ${group.color} relative overflow-hidden transition-all hover:shadow-md`}>\r\n                        <div className=\"absolute top-0 right-0 p-4 opacity-10\">\r\n                            <group.icon className=\"w-24 h-24\" />\r\n                        </div>\r\n\r\n                        <div className=\"relative z-10\">\r\n                            <div className=\"flex justify-between items-start mb-4\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <group.icon className=\"w-6 h-6\" />\r\n                                    <h4 className=\"text-lg font-black\">{group.label}</h4>\r\n                                </div>\r\n                                <span className=\"bg-white/50 px-3 py-1 rounded-full text-xs font-bold shadow-sm backdrop-blur-sm\">\r\n                                    {group.data.length} \r\n                                </span>\r\n                            </div>\r\n\r\n                            <p className=\"text-sm opacity-80 mb-6 font-medium leading-relaxed\">\r\n                                {group.description}\r\n                            </p>\r\n\r\n                            <button\r\n                                onClick={() => handleAssignClick(group.type)}\r\n                                disabled={group.data.length === 0}\r\n                                className=\"w-full py-3 bg-white/80 hover:bg-white text-slate-800 font-bold rounded-xl shadow-sm hover:shadow-md transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                <IconSparkles className=\"w-4 h-4\" />\r\n                                  \r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Student Avatars Preview (Optional) */}\r\n                        <div className=\"flex -space-x-2 space-x-reverse mt-4 relative z-10\">\r\n                            {group.data.slice(0, 5).map((s, i) => (\r\n                                <div key={i} className=\"w-8 h-8 rounded-full bg-slate-200 border-2 border-white flex items-center justify-center text-xs font-bold text-slate-500\" title={s.name}>\r\n                                    {s.name.charAt(0)}\r\n                                </div>\r\n                            ))}\r\n                            {group.data.length > 5 && (\r\n                                <div className=\"w-8 h-8 rounded-full bg-slate-100 border-2 border-white flex items-center justify-center text-xs font-bold text-slate-500\">\r\n                                    +{group.data.length - 5}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Modal */}\r\n            {activeGroup && createPortal(\r\n                <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4\" dir=\"rtl\">\r\n                    <div className=\"bg-white w-full max-w-md rounded-3xl shadow-2xl p-6 animate-scale-in\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <h3 className=\"text-xl font-black text-slate-800\">  </h3>\r\n                            <button onClick={() => setActiveGroup(null)} className=\"p-2 hover:bg-slate-100 rounded-full transition-colors\"><IconX className=\"w-5 h-5 text-slate-500\" /></button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-indigo-50 p-4 rounded-xl text-indigo-900 text-sm\">\r\n                                <span className=\"font-bold block mb-1\"> : {activeGroup === '' ? '' : activeGroup === '' ? '' : ''}</span>\r\n                                     ,      .\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2\">   ?</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full border border-slate-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-indigo-500 outline-none transition-all\"\r\n                                    placeholder=\":  ,  ...\"\r\n                                    value={topic}\r\n                                    onChange={(e) => setTopic(e.target.value)}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleSubmit}\r\n                                disabled={loading || !topic}\r\n                                className=\"w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg shadow-indigo-200 transition-all flex justify-center items-center gap-2 mt-4 disabled:opacity-50\"\r\n                            >\r\n                                {loading ? <span className=\"animate-spin\"></span> : <IconSparkles className=\"w-5 h-5\" />}\r\n                                 -AI  \r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>,\r\n                document.body\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","/**\r\n * StudentLearningProfile - Display adaptive learning profile for teachers\r\n *\r\n * Shows:\r\n * - Performance metrics (accuracy, response time)\r\n * - Behavioral patterns (hint dependency, retry persistence)\r\n * - Learning style preferences (text/video/gamified)\r\n * - Error fingerprint (common mistake patterns)\r\n * - Adaptive stats (variants used, challenge modes, etc.)\r\n */\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { db } from '../../firebase';\r\nimport {\r\n    IconBrain,\r\n    IconBulb,\r\n    IconTarget,\r\n    IconTrendingUp,\r\n    IconClock,\r\n    IconBook,\r\n    IconVideo,\r\n    IconDeviceGamepad2,\r\n    IconAlertTriangle,\r\n    IconSparkles,\r\n    IconChartBar,\r\n    IconRefresh\r\n} from '@tabler/icons-react';\r\nimport type { StudentProfile } from '../../types/studentProfile';\r\nimport { getAdaptiveStats, type AdaptiveEventType } from '../../services/adaptiveLoggingService';\r\n\r\ninterface StudentLearningProfileProps {\r\n    studentId: string;\r\n    studentName?: string;\r\n    onClose?: () => void;\r\n}\r\n\r\ninterface AdaptiveStats {\r\n    counts: Record<AdaptiveEventType, number>;\r\n    lastUpdated: Date | null;\r\n}\r\n\r\nexport const StudentLearningProfile: React.FC<StudentLearningProfileProps> = ({\r\n    studentId,\r\n    studentName,\r\n    onClose\r\n}) => {\r\n    const [profile, setProfile] = useState<StudentProfile | null>(null);\r\n    const [errorFingerprint, setErrorFingerprint] = useState<Record<string, number> | null>(null);\r\n    const [proficiencyVector, setProficiencyVector] = useState<Record<string, number> | null>(null);\r\n    const [adaptiveStats, setAdaptiveStats] = useState<AdaptiveStats | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const fetchProfile = async () => {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            try {\r\n                // Fetch profile stats\r\n                const statsRef = doc(db, 'users', studentId, 'profile', 'stats');\r\n                const statsSnap = await getDoc(statsRef);\r\n\r\n                if (statsSnap.exists()) {\r\n                    setProfile(statsSnap.data() as StudentProfile);\r\n                }\r\n\r\n                // Fetch error fingerprint\r\n                const errorRef = doc(db, 'users', studentId, 'profile', 'error_fingerprint');\r\n                const errorSnap = await getDoc(errorRef);\r\n                if (errorSnap.exists()) {\r\n                    setErrorFingerprint(errorSnap.data().errorTags || {});\r\n                }\r\n\r\n                // Fetch proficiency vector\r\n                const profRef = doc(db, 'users', studentId, 'profile', 'proficiency_vector');\r\n                const profSnap = await getDoc(profRef);\r\n                if (profSnap.exists()) {\r\n                    setProficiencyVector(profSnap.data().topics || {});\r\n                }\r\n\r\n                // Fetch adaptive stats\r\n                const stats = await getAdaptiveStats(studentId);\r\n                setAdaptiveStats(stats);\r\n\r\n            } catch (err) {\r\n                console.error('Failed to fetch student profile:', err);\r\n                setError('   ');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        if (studentId) {\r\n            fetchProfile();\r\n        }\r\n    }, [studentId]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"p-6 text-center\">\r\n                <div className=\"animate-spin w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full mx-auto mb-2\" />\r\n                <p className=\"text-slate-500\"> ...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"p-6 text-center text-red-500\">\r\n                <IconAlertTriangle className=\"w-8 h-8 mx-auto mb-2\" />\r\n                <p>{error}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!profile) {\r\n        return (\r\n            <div className=\"p-6 text-center text-slate-500\">\r\n                <IconBrain className=\"w-12 h-12 mx-auto mb-3 opacity-30\" />\r\n                <p className=\"font-bold\">  </p>\r\n                <p className=\"text-sm mt-1\">   </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const { performance, behavioral, engagement } = profile;\r\n\r\n    // Calculate learning style preference\r\n    const mediaPrefs = behavioral?.media_preference || { text: 0, video: 0, gamified: 0 };\r\n    const totalPref = mediaPrefs.text + mediaPrefs.video + mediaPrefs.gamified || 1;\r\n    const preferredStyle =\r\n        mediaPrefs.video > mediaPrefs.text && mediaPrefs.video > mediaPrefs.gamified ? '' :\r\n            mediaPrefs.gamified > mediaPrefs.text ? '' : '';\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-2xl shadow-xl overflow-hidden\" dir=\"rtl\">\r\n            {/* Header */}\r\n            <div className=\"bg-gradient-to-l from-indigo-600 to-purple-600 p-5 text-white\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\r\n                            <IconBrain className=\"w-6 h-6\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"text-xl font-bold\">  </h3>\r\n                            {studentName && <p className=\"text-white/80 text-sm\">{studentName}</p>}\r\n                        </div>\r\n                    </div>\r\n                    {onClose && (\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/20 rounded-lg transition\">\r\n                            \r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"p-5 space-y-6 max-h-[70vh] overflow-y-auto\">\r\n                {/* Performance Metrics */}\r\n                <section>\r\n                    <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                        <IconChartBar className=\"w-5 h-5 text-indigo-500\" />\r\n                         \r\n                    </h4>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                        <MetricCard\r\n                            label=\" \"\r\n                            value={`${Math.round((performance?.global_accuracy_rate || 0) * 100)}%`}\r\n                            color={performance?.global_accuracy_rate > 0.7 ? 'green' : performance?.global_accuracy_rate > 0.5 ? 'yellow' : 'red'}\r\n                            icon={<IconTarget className=\"w-5 h-5\" />}\r\n                        />\r\n                        <MetricCard\r\n                            label=\" \"\r\n                            value={`${Math.round(performance?.average_response_time_sec || 0)}s`}\r\n                            color=\"blue\"\r\n                            icon={<IconClock className=\"w-5 h-5\" />}\r\n                        />\r\n                        <MetricCard\r\n                            label=\"\"\r\n                            value={performance?.total_questions_attempted || 0}\r\n                            color=\"purple\"\r\n                            icon={<IconBulb className=\"w-5 h-5\" />}\r\n                        />\r\n                        <MetricCard\r\n                            label=\"\"\r\n                            value={engagement?.completed_lessons_count || 0}\r\n                            color=\"indigo\"\r\n                            icon={<IconBook className=\"w-5 h-5\" />}\r\n                        />\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Behavioral Patterns */}\r\n                <section>\r\n                    <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                        <IconTrendingUp className=\"w-5 h-5 text-green-500\" />\r\n                         \r\n                    </h4>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                        {/* Hint Dependency */}\r\n                        <div className=\"bg-slate-50 rounded-xl p-4\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <span className=\"text-sm font-medium text-slate-600\"> </span>\r\n                                <span className={`text-sm font-bold ${(behavioral?.hint_dependency_score || 0) > 0.5 ? 'text-amber-600' : 'text-green-600'}`}>\r\n                                    {Math.round((behavioral?.hint_dependency_score || 0) * 100)}%\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"w-full bg-slate-200 rounded-full h-2\">\r\n                                <div\r\n                                    className={`h-2 rounded-full transition-all ${(behavioral?.hint_dependency_score || 0) > 0.5 ? 'bg-amber-500' : 'bg-green-500'}`}\r\n                                    style={{ width: `${(behavioral?.hint_dependency_score || 0) * 100}%` }}\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-slate-500 mt-1\">\r\n                                {(behavioral?.hint_dependency_score || 0) > 0.5\r\n                                    ? '   -   '\r\n                                    : '   -   '}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Retry Persistence */}\r\n                        <div className=\"bg-slate-50 rounded-xl p-4\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <span className=\"text-sm font-medium text-slate-600\"> </span>\r\n                                <span className={`text-sm font-bold ${(behavioral?.retry_persistence || 0) > 0.5 ? 'text-green-600' : 'text-amber-600'}`}>\r\n                                    {Math.round((behavioral?.retry_persistence || 0) * 100)}%\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"w-full bg-slate-200 rounded-full h-2\">\r\n                                <div\r\n                                    className={`h-2 rounded-full transition-all ${(behavioral?.retry_persistence || 0) > 0.5 ? 'bg-green-500' : 'bg-amber-500'}`}\r\n                                    style={{ width: `${(behavioral?.retry_persistence || 0) * 100}%` }}\r\n                                />\r\n                            </div>\r\n                            <p className=\"text-xs text-slate-500 mt-1\">\r\n                                {(behavioral?.retry_persistence || 0) > 0.5\r\n                                    ? '   -   '\r\n                                    : '   -  '}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Learning Style */}\r\n                <section>\r\n                    <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                        <IconSparkles className=\"w-5 h-5 text-amber-500\" />\r\n                          : <span className=\"text-indigo-600\">{preferredStyle}</span>\r\n                    </h4>\r\n                    <div className=\"flex gap-2\">\r\n                        <StyleChip\r\n                            label=\"\"\r\n                            value={mediaPrefs.text / totalPref}\r\n                            icon={<IconBook className=\"w-4 h-4\" />}\r\n                            color=\"blue\"\r\n                        />\r\n                        <StyleChip\r\n                            label=\"\"\r\n                            value={mediaPrefs.video / totalPref}\r\n                            icon={<IconVideo className=\"w-4 h-4\" />}\r\n                            color=\"red\"\r\n                        />\r\n                        <StyleChip\r\n                            label=\"\"\r\n                            value={mediaPrefs.gamified / totalPref}\r\n                            icon={<IconDeviceGamepad2 className=\"w-4 h-4\" />}\r\n                            color=\"green\"\r\n                        />\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Error Fingerprint */}\r\n                {errorFingerprint && Object.keys(errorFingerprint).length > 0 && (\r\n                    <section>\r\n                        <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                            <IconAlertTriangle className=\"w-5 h-5 text-red-500\" />\r\n                              \r\n                        </h4>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {Object.entries(errorFingerprint)\r\n                                .sort(([, a], [, b]) => b - a)\r\n                                .slice(0, 5)\r\n                                .map(([tag, count]) => (\r\n                                    <span\r\n                                        key={tag}\r\n                                        className=\"px-3 py-1 bg-red-50 text-red-700 rounded-full text-sm font-medium border border-red-200\"\r\n                                    >\r\n                                        {translateErrorTag(tag)} ({count})\r\n                                    </span>\r\n                                ))}\r\n                        </div>\r\n                    </section>\r\n                )}\r\n\r\n                {/* Proficiency Vector - Curriculum Topics */}\r\n                {proficiencyVector && Object.keys(proficiencyVector).length > 0 && (\r\n                    <section>\r\n                        <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                            <IconBook className=\"w-5 h-5 text-purple-500\" />\r\n                                \r\n                        </h4>\r\n                        <div className=\"space-y-3\">\r\n                            {/* Curriculum topics (not bloom_ or general) */}\r\n                            {Object.entries(proficiencyVector)\r\n                                .filter(([topic]) => !topic.startsWith('bloom_') && topic !== 'general')\r\n                                .sort(([, a], [, b]) => b - a)\r\n                                .slice(0, 8)\r\n                                .map(([topic, mastery]) => (\r\n                                    <div key={topic} className=\"flex items-center gap-3\">\r\n                                        <span className=\"text-sm text-slate-600 w-36 truncate\" title={topic}>\r\n                                            {topic}\r\n                                        </span>\r\n                                        <div className=\"flex-1 bg-slate-200 rounded-full h-2.5\">\r\n                                            <div\r\n                                                className={`h-2.5 rounded-full transition-all ${mastery > 0.8 ? 'bg-green-500' :\r\n                                                    mastery > 0.5 ? 'bg-yellow-500' : 'bg-red-400'\r\n                                                    }`}\r\n                                                style={{ width: `${Math.round(mastery * 100)}%` }}\r\n                                            />\r\n                                        </div>\r\n                                        <span className={`text-sm font-bold w-12 text-right ${\r\n                                            mastery > 0.8 ? 'text-green-600' :\r\n                                            mastery > 0.5 ? 'text-yellow-600' : 'text-red-500'\r\n                                        }`}>\r\n                                            {Math.round(mastery * 100)}%\r\n                                        </span>\r\n                                    </div>\r\n                                ))}\r\n                        </div>\r\n\r\n                        {/* Bloom fallback section (for blocks without curriculum topic mapping) */}\r\n                        {Object.entries(proficiencyVector).some(([t]) => t.startsWith('bloom_') || t === 'general') && (\r\n                            <div className=\"mt-4 pt-3 border-t border-slate-100\">\r\n                                <p className=\"text-xs text-slate-400 mb-2 flex items-center gap-1\">\r\n                                    <IconTarget className=\"w-3 h-3\" />\r\n                                      (   )\r\n                                </p>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {Object.entries(proficiencyVector)\r\n                                        .filter(([topic]) => topic.startsWith('bloom_') || topic === 'general')\r\n                                        .map(([topic, mastery]) => {\r\n                                            const displayName = topic === 'general' ? '' :\r\n                                                topic.replace('bloom_', '').replace('knowledge', '')\r\n                                                .replace('comprehension', '').replace('application', '')\r\n                                                .replace('analysis', '').replace('synthesis', '')\r\n                                                .replace('evaluation', '');\r\n                                            return (\r\n                                                <span key={topic} className=\"text-xs px-2 py-1 bg-slate-100 rounded-full text-slate-500\">\r\n                                                    {displayName}: {Math.round(mastery * 100)}%\r\n                                                </span>\r\n                                            );\r\n                                        })}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n                )}\r\n\r\n                {/* Adaptive Stats */}\r\n                {adaptiveStats && adaptiveStats.counts && (\r\n                    <section>\r\n                        <h4 className=\"font-bold text-slate-700 mb-3 flex items-center gap-2\">\r\n                            <IconRefresh className=\"w-5 h-5 text-cyan-500\" />\r\n                             \r\n                        </h4>\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-center\">\r\n                            <StatBadge label=\" BKT\" value={adaptiveStats.counts.bkt_update || 0} />\r\n                            <StatBadge label=\"\" value={adaptiveStats.counts.variant_selected || 0} />\r\n                            <StatBadge label=\"Challenge Mode\" value={adaptiveStats.counts.challenge_mode || 0} />\r\n                            <StatBadge label=\"\" value={adaptiveStats.counts.remediation_injected || 0} />\r\n                        </div>\r\n                    </section>\r\n                )}\r\n\r\n                {/* Last Active */}\r\n                {engagement?.last_active_at && (\r\n                    <p className=\"text-xs text-slate-400 text-center pt-2 border-t\">\r\n                         : {formatDate(engagement.last_active_at)}\r\n                    </p>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Helper Components\r\n\r\nconst MetricCard: React.FC<{\r\n    label: string;\r\n    value: string | number;\r\n    color: 'green' | 'yellow' | 'red' | 'blue' | 'purple' | 'indigo';\r\n    icon: React.ReactNode;\r\n}> = ({ label, value, color, icon }) => {\r\n    const colorClasses = {\r\n        green: 'bg-green-50 text-green-700 border-green-200',\r\n        yellow: 'bg-yellow-50 text-yellow-700 border-yellow-200',\r\n        red: 'bg-red-50 text-red-700 border-red-200',\r\n        blue: 'bg-blue-50 text-blue-700 border-blue-200',\r\n        purple: 'bg-purple-50 text-purple-700 border-purple-200',\r\n        indigo: 'bg-indigo-50 text-indigo-700 border-indigo-200'\r\n    };\r\n\r\n    return (\r\n        <div className={`p-3 rounded-xl border ${colorClasses[color]}`}>\r\n            <div className=\"flex items-center gap-2 mb-1 opacity-70\">\r\n                {icon}\r\n                <span className=\"text-xs font-medium\">{label}</span>\r\n            </div>\r\n            <div className=\"text-2xl font-black\">{value}</div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst StyleChip: React.FC<{\r\n    label: string;\r\n    value: number;\r\n    icon: React.ReactNode;\r\n    color: 'blue' | 'red' | 'green';\r\n}> = ({ label, value, icon, color }) => {\r\n    const colorClasses = {\r\n        blue: 'bg-blue-100 text-blue-700',\r\n        red: 'bg-red-100 text-red-700',\r\n        green: 'bg-green-100 text-green-700'\r\n    };\r\n\r\n    const percentage = Math.round(value * 100);\r\n\r\n    return (\r\n        <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${colorClasses[color]}`}>\r\n            {icon}\r\n            <span className=\"text-sm font-medium\">{label}</span>\r\n            <span className=\"font-bold\">{percentage}%</span>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst StatBadge: React.FC<{ label: string; value: number }> = ({ label, value }) => (\r\n    <div className=\"bg-slate-100 rounded-lg p-2\">\r\n        <div className=\"text-lg font-black text-slate-700\">{value}</div>\r\n        <div className=\"text-xs text-slate-500\">{label}</div>\r\n    </div>\r\n);\r\n\r\n// Helpers\r\n\r\nconst translateErrorTag = (tag: string): string => {\r\n    const translations: Record<string, string> = {\r\n        'calculation_error': ' ',\r\n        'sign_error': ' ',\r\n        'conceptual_error': ' ',\r\n        'order_error': ' ',\r\n        'reading_error': ' ',\r\n        'careless_error': '   '\r\n    };\r\n    return translations[tag] || tag;\r\n};\r\n\r\nconst formatDate = (date: any): string => {\r\n    if (!date) return ' ';\r\n    const d = date.toDate ? date.toDate() : new Date(date);\r\n    return d.toLocaleDateString('he-IL', {\r\n        day: 'numeric',\r\n        month: 'short',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    });\r\n};\r\n\r\nexport default StudentLearningProfile;\r\n","\r\nimport React from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { IconBrandGoogle } from '@tabler/icons-react';\r\n\r\nexport const ClassroomConnectButton: React.FC = () => {\r\n    const { googleClassroomToken, connectClassroom } = useAuth();\r\n\r\n    if (googleClassroomToken) {\r\n        return (\r\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 rounded-lg border border-green-200\">\r\n                <IconBrandGoogle className=\"w-5 h-5\" />\r\n                <span className=\"text-sm font-bold\">  </span>\r\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <button\r\n            onClick={connectClassroom}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-white text-gray-700 rounded-lg border border-gray-200 hover:bg-gray-50 transition-all shadow-sm group\"\r\n        >\r\n            <IconBrandGoogle className=\"w-5 h-5 text-gray-500 group-hover:text-amber-500 transition-colors\" />\r\n            <span className=\"text-sm font-bold\">  Google Classroom</span>\r\n        </button>\r\n    );\r\n};\r\n","\r\nconst BASE_URL = 'https://classroom.googleapis.com/v1';\r\n\r\nexport interface ClassroomCourse {\r\n    id: string;\r\n    name: string;\r\n    section?: string;\r\n    descriptionHeading?: string;\r\n    alternateLink: string;\r\n    courseState: string;\r\n}\r\n\r\nexport interface ClassroomAssignment {\r\n    title: string;\r\n    description: string;\r\n    workType: 'ASSIGNMENT';\r\n    state: 'PUBLISHED' | 'DRAFT';\r\n    maxPoints: number;\r\n    materials?: Array<{\r\n        link: {\r\n            url: string;\r\n            title: string;\r\n        }\r\n    }>;\r\n}\r\n\r\nexport const googleClassroomService = {\r\n    /**\r\n     * Lists all active courses for the teacher\r\n     */\r\n    async listCourses(accessToken: string): Promise<ClassroomCourse[]> {\r\n        const response = await fetch(`${BASE_URL}/courses?courseStates=ACTIVE`, {\r\n            headers: {\r\n                'Authorization': `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json'\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to list courses: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return data.courses || [];\r\n    },\r\n\r\n    /**\r\n     * Creates a new assignment in a specific course\r\n     */\r\n    async createAssignment(accessToken: string, courseId: string, assignment: ClassroomAssignment) {\r\n        const response = await fetch(`${BASE_URL}/courses/${courseId}/courseWork`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Authorization': `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify(assignment)\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to create assignment: ${response.statusText}`);\r\n        }\r\n\r\n        return await response.json();\r\n    },\r\n\r\n    /**\r\n     * Lists all submissions for a specific assignment\r\n     */\r\n    async listSubmissions(accessToken: string, courseId: string, courseWorkId: string) {\r\n        const response = await fetch(`${BASE_URL}/courses/${courseId}/courseWork/${courseWorkId}/studentSubmissions`, {\r\n            headers: {\r\n                'Authorization': `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json'\r\n            }\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to list submissions: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return data.studentSubmissions || [];\r\n    },\r\n\r\n    /**\r\n     * Updates a student's grade\r\n     */\r\n    async patchGrade(accessToken: string, courseId: string, courseWorkId: string, submissionId: string, grade: number) {\r\n        const response = await fetch(\r\n            `${BASE_URL}/courses/${courseId}/courseWork/${courseWorkId}/studentSubmissions/${submissionId}?updateMask=assignedGrade,draftGrade`,\r\n            {\r\n                method: 'PATCH',\r\n                headers: {\r\n                    'Authorization': `Bearer ${accessToken}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    assignedGrade: grade,\r\n                    draftGrade: grade\r\n                })\r\n            }\r\n        );\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to update grade: ${response.statusText}`);\r\n        }\r\n\r\n        return await response.json();\r\n    }\r\n};\r\n","\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { googleClassroomService } from '../../services/googleClassroom';\r\nimport type { ClassroomCourse } from '../../services/googleClassroom';\r\nimport { IconBrandGoogle, IconX, IconCheck } from '@tabler/icons-react';\r\n\r\ninterface ClassroomAssignmentModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    examTitle: string;\r\n    examId: string;\r\n}\r\n\r\nexport const ClassroomAssignmentModal: React.FC<ClassroomAssignmentModalProps> = ({ isOpen, onClose, examTitle, examId }) => {\r\n    const { googleClassroomToken } = useAuth();\r\n    const [courses, setCourses] = useState<ClassroomCourse[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [selectedCourseId, setSelectedCourseId] = useState<string>('');\r\n    const [isAssigning, setIsAssigning] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (isOpen && googleClassroomToken) {\r\n            loadCourses();\r\n        }\r\n    }, [isOpen, googleClassroomToken]);\r\n\r\n    const loadCourses = async () => {\r\n        if (!googleClassroomToken) return;\r\n        setLoading(true);\r\n        try {\r\n            const list = await googleClassroomService.listCourses(googleClassroomToken);\r\n            setCourses(list);\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert(\"   \");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAssign = async () => {\r\n        if (!selectedCourseId || !googleClassroomToken) return;\r\n        setIsAssigning(true);\r\n        try {\r\n            // Construct assignment link\r\n            // For now assuming localhost/prod distinction, but let's use window.location.origin\r\n            const link = `${window.location.origin}/student?exam=${examId}`;\r\n\r\n            await googleClassroomService.createAssignment(googleClassroomToken, selectedCourseId, {\r\n                title: examTitle,\r\n                description: \"       . !\",\r\n                workType: \"ASSIGNMENT\",\r\n                state: \"PUBLISHED\",\r\n                maxPoints: 100,\r\n                materials: [\r\n                    {\r\n                        link: {\r\n                            url: link,\r\n                            title: `: ${examTitle}`\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n            alert(\"   -Google Classroom!\");\r\n            onClose();\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert(\"  \");\r\n        } finally {\r\n            setIsAssigning(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-scale-in\">\r\n                <div className=\"bg-green-50 p-4 border-b border-green-100 flex justify-between items-center\">\r\n                    <div className=\"flex items-center gap-2 text-green-800\">\r\n                        <IconBrandGoogle className=\"w-6 h-6\" />\r\n                        <h2 className=\"font-bold text-lg\"> -Google Classroom</h2>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-1 hover:bg-green-100 rounded-full text-green-700 transition-colors\">\r\n                        <IconX className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                    <div className=\"mb-4\">\r\n                        <h3 className=\"font-bold text-gray-700 mb-1\"> :</h3>\r\n                        <p className=\"text-gray-600 bg-gray-50 p-2 rounded-lg border\">{examTitle}</p>\r\n                    </div>\r\n\r\n                    {!googleClassroomToken ? (\r\n                        <div className=\"text-center py-6 text-gray-500\">\r\n                                  .\r\n                        </div>\r\n                    ) : loading ? (\r\n                        <div className=\"flex justify-center py-8\">\r\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600\"></div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-gray-700 mb-2\">  (Course):</label>\r\n                                <select\r\n                                    className=\"w-full p-3 border border-gray-300 rounded-xl outline-none focus:border-green-500 bg-white\"\r\n                                    value={selectedCourseId}\r\n                                    onChange={(e) => setSelectedCourseId(e.target.value)}\r\n                                >\r\n                                    <option value=\"\">--   --</option>\r\n                                    {courses.map(course => (\r\n                                        <option key={course.id} value={course.id}>\r\n                                            {course.name} {course.section ? `- ${course.section}` : ''}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleAssign}\r\n                                disabled={!selectedCourseId || isAssigning}\r\n                                className={`w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${!selectedCourseId || isAssigning\r\n                                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed'\r\n                                    : 'bg-green-600 text-white hover:bg-green-700 shadow-lg hover:shadow-xl'\r\n                                    }`}\r\n                            >\r\n                                {isAssigning ? (\r\n                                    <>\r\n                                        <span className=\"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white\"></span>\r\n                                         ...\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <IconCheck className=\"w-5 h-5\" />\r\n                                          \r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { generateClassAnalysis, generateStudentReport } from '../services/ai/geminiApi';\r\n// type SubmissionData unused removed\r\n// gradeBatch removed\r\nimport { collection, query, onSnapshot, getDocs, addDoc, serverTimestamp, deleteDoc, doc, updateDoc, where } from 'firebase/firestore'; // Added deleteDoc, doc, updateDoc\r\nimport { feedbackService } from '../services/feedbackService';\r\nimport { GamificationService } from '../services/telemetry';\r\nimport type { StudentAnalyticsProfile } from '../shared/types/courseTypes';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { AIStarsSpinner } from './ui/Loading/AIStarsSpinner';\r\n\r\nimport { db } from '../firebase';\r\nimport {\r\n    IconBrain, IconX, IconSparkles, IconEdit, IconTrash,\r\n    IconEye, IconSearch, IconLayer, IconBook, IconArrowBack,\r\n    IconLink, IconCheck, IconStudent, IconList,\r\n    IconArrowUp, IconArrowDown, IconLoader, IconFlag, IconAlertTriangle, IconCopy\r\n} from '../icons';\r\n\r\n// --- Lazy Load CoursePlayer ---\r\nconst CoursePlayer = React.lazy(() => import('./CoursePlayer'));\r\nconst TeacherControlCenter = React.lazy(() => import('./dashboard/TeacherControlCenter').then(m => ({ default: m.TeacherControlCenter })));\r\nconst TaskDetailDashboard = React.lazy(() => import('./dashboard/TaskDetailDashboard').then(m => ({ default: m.TaskDetailDashboard })));\r\nimport { SmartGroupingPanel } from './SmartGroupingPanel';\r\nimport { StudentLearningProfile } from './dashboard/StudentLearningProfile';\r\nimport { ClassroomConnectButton } from './teacher/ClassroomConnectButton';\r\nimport { ClassroomAssignmentModal } from './teacher/ClassroomAssignmentModal';\r\nimport { ShareModal } from './ShareModal';\r\nimport { IconBrandGoogle, IconShare, IconMail, IconMailOff, IconChartBar, IconBolt, IconPhoto, IconMicrophone, IconBroadcast } from '@tabler/icons-react';\r\n\r\n// --- CONSTANTS ---\r\nconst GRADE_ORDER = [\r\n    \" \", \" \", \" \", \" \", \" \", \" \",\r\n    \" \", \" \", \" \", \" \", \" \", \" \",\r\n    \"\", \"\"\r\n];\r\n\r\n// ... (normalizeText function) ... \r\nconst normalizeText = (text: string) => {\r\n    if (!text) return \"\";\r\n    return text.trim().replace(/[`]/g, \"'\");\r\n};\r\n\r\n// ... (Interfaces remain the same) ...\r\ninterface StudentStat {\r\n    id: string;\r\n    name: string;\r\n    score: number;\r\n    progress: number;\r\n    lastActive: string;\r\n    answers?: any;\r\n    chatHistory?: { role: string, parts: string }[];\r\n    subject: string;\r\n    gradeLevel: string;\r\n    courseTitle: string;\r\n    courseId: string;\r\n    hasAlert?: boolean; // New Field\r\n    analytics?: StudentAnalyticsProfile; // New Field\r\n}\r\n\r\ninterface CourseAggregation {\r\n    courseId: string;\r\n    title: string;\r\n    subject: string;\r\n    grade: string;\r\n    studentCount: number;\r\n    avgScore: number;\r\n    completionRate: number; //   \r\n    atRiskCount: number;\r\n    createdAt?: any;\r\n    productType: 'lesson' | 'activity' | 'exam' | 'podcast' | null; // Product type from wizard\r\n    mode?: 'learning' | 'exam' | 'lesson'; // Added mode\r\n    submittedCount: number; // New field for submitted count\r\n    parentLesson?: { courseId: string; title: string }; // If extracted from lesson plan\r\n}\r\n\r\ninterface TeacherDashboardProps {\r\n    onEditCourse?: (courseId: string) => void;\r\n    onViewInsights?: () => void;\r\n    onNavigateToAnalytics?: () => void; // New Prop\r\n}\r\n\r\nconst StudentInsightsModal = ({ student, onClose }: { student: StudentStat, onClose: () => void }) => {\r\n    const analytics = student.analytics;\r\n    const [activeTab, setActiveTab] = useState<'ai' | 'adaptive'>('ai');\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in\" dir=\"rtl\">\r\n            <div className=\"bg-white w-full max-w-3xl rounded-3xl shadow-2xl overflow-hidden animate-scale-in\">\r\n                <div className=\"bg-gradient-to-l from-wizdi-royal to-wizdi-cyan p-6 text-white flex justify-between items-center\">\r\n                    <div>\r\n                        <h3 className=\"text-2xl font-bold flex items-center gap-2\">\r\n                            <IconBrain className=\"w-8 h-8 opacity-80\" />  \r\n                        </h3>\r\n                        <p className=\"opacity-80 text-sm mt-1\"> : {student.name}</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"hover:bg-white/20 p-2 rounded-full transition-colors\"><IconX className=\"w-6 h-6\" /></button>\r\n                </div>\r\n\r\n                {/* Tab Switcher */}\r\n                <div className=\"flex border-b border-slate-200\">\r\n                    <button\r\n                        onClick={() => setActiveTab('ai')}\r\n                        className={`flex-1 py-3 px-4 text-sm font-bold transition-colors ${activeTab === 'ai'\r\n                            ? 'text-wizdi-royal border-b-2 border-wizdi-royal bg-wizdi-royal/5'\r\n                            : 'text-slate-500 hover:text-slate-700'\r\n                            }`}\r\n                    >\r\n                        <IconSparkles className=\"w-4 h-4 inline ml-2\" />\r\n                         AI\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setActiveTab('adaptive')}\r\n                        className={`flex-1 py-3 px-4 text-sm font-bold transition-colors ${activeTab === 'adaptive'\r\n                            ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50'\r\n                            : 'text-slate-500 hover:text-slate-700'\r\n                            }`}\r\n                    >\r\n                        <IconBrain className=\"w-4 h-4 inline ml-2\" />\r\n                         \r\n                    </button>\r\n                </div>\r\n\r\n                {activeTab === 'ai' && analytics ? (\r\n                    <div className=\"p-4 md:p-8 max-h-[70vh] overflow-y-auto\">\r\n                        {/* Header Chips - Learning Metrics */}\r\n                        <div className=\"flex gap-4 mb-8 flex-wrap\">\r\n                            <div className=\"bg-wizdi-royal/10 text-wizdi-royal px-4 py-2 rounded-xl font-bold border border-wizdi-royal/20 flex items-center gap-2\">\r\n                                : {analytics.engagementScore}%\r\n                            </div>\r\n                            {analytics.learningMetrics && (\r\n                                <>\r\n                                    <div className=\"bg-slate-100 text-slate-700 px-4 py-2 rounded-xl font-bold border border-slate-200 flex items-center gap-2\">\r\n                                         : {Math.round((analytics.learningMetrics.hintUsageRate || 0) * 100)}%\r\n                                    </div>\r\n                                    <div className=\"bg-slate-100 text-slate-700 px-4 py-2 rounded-xl font-bold border border-slate-200 flex items-center gap-2\">\r\n                                        : {Math.round((analytics.learningMetrics.completionRate || 0) * 100)}%\r\n                                    </div>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\r\n                            {/* Strengths */}\r\n                            <div className=\"bg-wizdi-lime/10 p-6 rounded-3xl border border-wizdi-lime/20\">\r\n                                <h4 className=\"text-wizdi-lime font-bold mb-4 flex items-center gap-2 text-lg\">\r\n                                    <IconCheck className=\"w-5 h-5\" />  \r\n                                </h4>\r\n                                <ul className=\"space-y-3\">\r\n                                    {analytics.strengths.map((s, i) => (\r\n                                        <li key={i} className=\"flex gap-3 text-slate-700 leading-relaxed font-bold opacity-80 text-sm\">\r\n                                            <div className=\"w-1.5 h-1.5 bg-wizdi-lime rounded-full mt-2 shrink-0\" />\r\n                                            {s}\r\n                                        </li>\r\n                                    ))}\r\n                                </ul>\r\n                            </div>\r\n\r\n                            {/* Weaknesses */}\r\n                            <div className=\"bg-amber-50 p-6 rounded-3xl border border-amber-100\">\r\n                                <h4 className=\"text-amber-600 font-bold mb-4 flex items-center gap-2 text-lg\">\r\n                                    <IconFlag className=\"w-5 h-5\" />  \r\n                                </h4>\r\n                                <ul className=\"space-y-3\">\r\n                                    {analytics.weaknesses.map((w, i) => (\r\n                                        <li key={i} className=\"flex gap-3 text-slate-700 leading-relaxed font-bold opacity-80 text-sm\">\r\n                                            <div className=\"w-1.5 h-1.5 bg-amber-500 rounded-full mt-2 shrink-0\" />\r\n                                            {w}\r\n                                        </li>\r\n                                    ))}\r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Recommendation */}\r\n                        <div className=\"bg-wizdi-gold/10 p-6 rounded-3xl border border-wizdi-gold/20 flex gap-4 items-start\">\r\n                            <div className=\"bg-white p-3 rounded-full shadow-lg text-wizdi-gold shrink-0\">\r\n                                <IconSparkles className=\"w-6 h-6\" />\r\n                            </div>\r\n                            <div>\r\n                                <h4 className=\"text-wizdi-royal font-bold text-lg mb-1\">  </h4>\r\n                                <p className=\"text-slate-700 leading-relaxed opacity-90\">\r\n                                    {analytics.recommendedFocus}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ) : activeTab === 'ai' && !analytics ? (\r\n                    <div className=\"p-8 text-center text-slate-500\">\r\n                        <IconSparkles className=\"w-12 h-12 mx-auto mb-3 opacity-30\" />\r\n                        <p>  AI </p>\r\n                    </div>\r\n                ) : (\r\n                    /* Adaptive Profile Tab */\r\n                    <StudentLearningProfile\r\n                        studentId={student.id}\r\n                        studentName={student.name}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Helper function to get product type label and color\r\nconst getProductTypeDisplay = (productType: string | null | undefined, mode?: string) => {\r\n    // Determine the actual type based on productType or mode fallback\r\n    const actualType = productType || (mode === 'lesson' ? 'lesson' : mode === 'exam' ? 'exam' : 'activity');\r\n\r\n    const labels: Record<string, string> = {\r\n        'lesson': ' ',\r\n        'exam': '',\r\n        'activity': '',\r\n        'podcast': ''\r\n    };\r\n\r\n    const colors: Record<string, string> = {\r\n        'lesson': 'bg-emerald-100 text-emerald-700',\r\n        'exam': 'bg-wizdi-cyan/20 text-wizdi-cyan',\r\n        'activity': 'bg-wizdi-royal/10 text-wizdi-royal',\r\n        'podcast': 'bg-orange-100 text-orange-700'\r\n    };\r\n\r\n    const headerColors: Record<string, string> = {\r\n        'lesson': 'text-emerald-600 bg-emerald-50 border-emerald-200',\r\n        'exam': 'text-wizdi-cyan bg-wizdi-cyan/10 border-wizdi-cyan/20',\r\n        'activity': 'text-wizdi-royal bg-wizdi-royal/10 border-wizdi-royal/20',\r\n        'podcast': 'text-orange-600 bg-orange-50 border-orange-200'\r\n    };\r\n\r\n    const cardColors: Record<string, string> = {\r\n        'lesson': 'bg-wizdi-lime text-green-900 border-wizdi-lime/50',\r\n        'exam': 'bg-wizdi-cyan/80 text-white border-wizdi-cyan/50',\r\n        'activity': 'bg-wizdi-gold text-amber-900 border-wizdi-gold/50',\r\n        'podcast': 'bg-orange-400 text-white border-orange-500/50'\r\n    };\r\n\r\n    return {\r\n        label: labels[actualType] || '',\r\n        color: colors[actualType] || colors['activity'],\r\n        headerColor: headerColors[actualType] || headerColors['activity'],\r\n        cardColor: cardColors[actualType] || cardColors['activity']\r\n    };\r\n};\r\n\r\nconst TeacherDashboard: React.FC<TeacherDashboardProps> = ({ onEditCourse, onViewInsights, onNavigateToAnalytics }) => {\r\n    // --- Auth ---\r\n    const { currentUser, usageStats } = useAuth();\r\n\r\n    // --- State ---\r\n    const [rawStudents, setRawStudents] = useState<any[]>([]);\r\n    const [rawSubmissions, setRawSubmissions] = useState<any[]>([]);\r\n    const [safetyAlerts, setSafetyAlerts] = useState<any[]>([]); // New State\r\n    const [coursesMap, setCoursesMap] = useState<Record<string, { subject: string, grade: string, title: string, createdAt?: any, mode?: string, syllabus?: any[], wizardData?: any }>>({});\r\n    const [isCoursesLoaded, setIsCoursesLoaded] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [copiedId, setCopiedId] = useState<string | null>(null);\r\n    const [deleteConfirmation, setDeleteConfirmation] = useState<{ step: 'none' | 'first' | 'second', courseId: string | null }>({ step: 'none', courseId: null });\r\n\r\n    // Assignment Modal State\r\n    const [assignmentModalOpen, setAssignmentModalOpen] = useState(false);\r\n    const [assignmentData, setAssignmentData] = useState(() => {\r\n        const defaultDate = new Date();\r\n        defaultDate.setDate(defaultDate.getDate() + 3);\r\n        return {\r\n            courseId: '',\r\n            courseTitle: '',\r\n            title: '',\r\n            dueDate: defaultDate.toISOString().split('T')[0],\r\n            dueTime: '23:59',\r\n            instructions: ''\r\n        };\r\n    });\r\n    const [createdAssignmentLink, setCreatedAssignmentLink] = useState<string | null>(null);\r\n\r\n    // Share Modal State\r\n    const [shareModalCourse, setShareModalCourse] = useState<{ id: string; title: string } | null>(null);\r\n\r\n    // Navigation\r\n    const [selectedCourseId, setSelectedCourseId] = useState<string | null>(null);\r\n\r\n    // Filters\r\n    const [filterSubject, setFilterSubject] = useState<string>('all');\r\n    const [filterGrade, setFilterGrade] = useState<string>('all');\r\n    const [filterType, setFilterType] = useState<string>('all'); // Added Type Filter\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n    // View State\r\n    const [viewMode, setViewMode] = useState<'grid' | 'list' | 'feedback'>('list'); // Added 'feedback' mode\r\n    const [sortConfig, setSortConfig] = useState<{ key: string, direction: 'asc' | 'desc' }>({ key: 'createdAt', direction: 'desc' });\r\n\r\n    // Detail View State\r\n    const [selectedStudentIds, setSelectedStudentIds] = useState<Set<string>>(new Set());\r\n    const [viewingTestStudent, setViewingTestStudent] = useState<StudentStat | null>(null);\r\n    const [reportStudent, setReportStudent] = useState<any>(null);\r\n    const [viewingInsightStudent, setViewingInsightStudent] = useState<StudentStat | null>(null); // New State\r\n    const [viewingLessonPlan, setViewingLessonPlan] = useState<string | null>(null); // View lesson plan modal\r\n    const [viewingControlCenter, setViewingControlCenter] = useState<string | null>(null); // Teacher Control Center\r\n    const [aiInsight, setAiInsight] = useState<any>(null);\r\n    const [aiLoading, setAiLoading] = useState(false);\r\n    const [groupAnalysis, setGroupAnalysis] = useState<string | null>(null);\r\n\r\n    // Feedback State\r\n    const [feedbackText, setFeedbackText] = useState(\"\");\r\n    const [isSavingFeedback, setIsSavingFeedback] = useState(false);\r\n    // isGrading removed\r\n    const [showOnlyAlerts, setShowOnlyAlerts] = useState(false); // New Filter State\r\n\r\n    // Feedback View State\r\n    const [courseFeedbackStats, setCourseFeedbackStats] = useState<any>(null);\r\n    const [isFeedbackLoading, setIsFeedbackLoading] = useState(false);\r\n    const [showMobileFilters, setShowMobileFilters] = useState(false); // Mobile Filter State\r\n\r\n    // Email Reports Settings\r\n    const [emailReportsEnabled, setEmailReportsEnabled] = useState(false);\r\n    const [isEmailSettingLoading, setIsEmailSettingLoading] = useState(false);\r\n\r\n    // Usage Stats Modal\r\n    const [showUsageModal, setShowUsageModal] = useState(false);\r\n\r\n    // Load email reports setting\r\n    useEffect(() => {\r\n        if (!currentUser) return;\r\n        GamificationService.getUserProfile(currentUser.uid).then(profile => {\r\n            if (profile) {\r\n                setEmailReportsEnabled(profile.emailReportsEnabled ?? false);\r\n            }\r\n        });\r\n    }, [currentUser]);\r\n\r\n    // Handler to toggle email reports\r\n    const handleToggleEmailReports = async (enabled: boolean) => {\r\n        if (!currentUser) return;\r\n        setIsEmailSettingLoading(true);\r\n        try {\r\n            await GamificationService.updateEmailReportsSetting(currentUser.uid, enabled);\r\n            setEmailReportsEnabled(enabled);\r\n        } catch (error) {\r\n            console.error('Failed to update email setting:', error);\r\n        } finally {\r\n            setIsEmailSettingLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (viewMode === 'feedback' && selectedCourseId) {\r\n            setIsFeedbackLoading(true);\r\n            feedbackService.getFeedbackStats(selectedCourseId)\r\n                .then(stats => setCourseFeedbackStats(stats))\r\n                .catch(err => console.error(err))\r\n                .finally(() => setIsFeedbackLoading(false));\r\n        }\r\n    }, [viewMode, selectedCourseId]);\r\n\r\n    useEffect(() => {\r\n        if (viewingTestStudent) {\r\n            setFeedbackText((viewingTestStudent as any).rawSubmission?.feedback || \"\");\r\n        }\r\n    }, [viewingTestStudent]);\r\n\r\n    const [assignmentsMap, setAssignmentsMap] = useState<Record<string, any[]>>({});\r\n\r\n    // --- 1. Fetch Courses Metadata (Realtime) ---\r\n    useEffect(() => {\r\n        if (!currentUser) return;\r\n\r\n        const q = query(collection(db, \"courses\"), where(\"teacherId\", \"==\", currentUser.uid));\r\n        const unsubCourses = onSnapshot(q, (snapshot) => {\r\n            // Updated mapped type to include syllabus for type detection\r\n            const map: Record<string, { subject: string, grade: string, title: string, createdAt?: any, syllabus?: any[], parentLesson?: any }> = {};\r\n\r\n            snapshot.forEach(doc => {\r\n                const data = doc.data();\r\n                const rawSubject = data.subject || data.topic || \"\";\r\n                const rawGrade = data.gradeLevel || data.grade || data.classLevel || \"\";\r\n\r\n                map[doc.id] = {\r\n                    subject: rawSubject,\r\n                    grade: rawGrade,\r\n                    title: data.title || \" \",\r\n                    createdAt: data.createdAt,\r\n                    mode: data.mode, // Store mode\r\n                    syllabus: data.syllabus, // Store syllabus\r\n                    wizardData: data.wizardData, // Store wizardData for productType\r\n                    parentLesson: data.parentLesson // Track if extracted from lesson plan\r\n                };\r\n            });\r\n            setCoursesMap(map);\r\n            setIsCoursesLoaded(true);\r\n        }, (error) => {\r\n            console.error(\"Error fetching courses:\", error);\r\n        });\r\n\r\n        return () => unsubCourses();\r\n    }, [currentUser]);\r\n\r\n    // --- 1.5 Fetch Assignments for Due Dates ---\r\n    useEffect(() => {\r\n        if (!currentUser) return;\r\n\r\n        const fetchAssignments = async () => {\r\n            try {\r\n                const q = query(collection(db, \"assignments\"), where(\"teacherId\", \"==\", currentUser.uid));\r\n                const snapshot = await getDocs(q);\r\n                const map: Record<string, any[]> = {};\r\n\r\n                snapshot.forEach(doc => {\r\n                    const data = doc.data();\r\n                    if (!map[data.courseId]) map[data.courseId] = [];\r\n                    map[data.courseId].push({\r\n                        id: doc.id,\r\n                        dueDate: data.dueDate,\r\n                        title: data.title\r\n                    });\r\n                });\r\n                setAssignmentsMap(map);\r\n            } catch (error) {\r\n                console.error(\"Error fetching assignments:\", error);\r\n            }\r\n        };\r\n        fetchAssignments();\r\n    }, [currentUser]);\r\n\r\n\r\n    // --- 2. Fetch Students & Submissions ---\r\n    useEffect(() => {\r\n        if (!currentUser) return;\r\n\r\n        // Fetch Submissions - filter by teacherId\r\n        const qSub = query(collection(db, \"submissions\"), where(\"teacherId\", \"==\", currentUser.uid));\r\n        const unsubSub = onSnapshot(qSub, (snapshot) => {\r\n            const subs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setRawSubmissions(subs);\r\n        }, (error) => {\r\n            console.error(\"Error fetching submissions:\", error);\r\n        });\r\n\r\n        // Legend: We might still need student_progress for older data, but for now we focus on submissions for the new flow.\r\n        // If you want to keep 'student_progress' for \"Registered\" students who haven't submitted, keep this.\r\n        const q = query(collection(db, \"student_progress\"), where(\"teacherId\", \"==\", currentUser.uid));\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const raw = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            }));\r\n            setRawStudents(raw);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching student progress:\", error);\r\n            setLoading(false);\r\n        });\r\n\r\n        // Safety Alerts Listener - filter by teacherId\r\n        const qAlerts = query(\r\n            collection(db, \"safety_alerts\"),\r\n            where(\"teacherId\", \"==\", currentUser.uid),\r\n            where(\"isHandled\", \"==\", false)\r\n        );\r\n        const unsubAlerts = onSnapshot(qAlerts, (snapshot) => {\r\n            const alerts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setSafetyAlerts(alerts);\r\n        }, (error) => {\r\n            console.error(\"Error fetching safety alerts:\", error);\r\n        });\r\n\r\n        return () => { unsubscribe(); unsubSub(); unsubAlerts(); };\r\n    }, [currentUser]);\r\n\r\n    // --- 3. Merge Data ---\r\n    const allData: StudentStat[] = useMemo(() => {\r\n        if (!isCoursesLoaded) return [];\r\n\r\n        const studentsMap: Record<string, StudentStat> = {};\r\n\r\n        // 1. Process \"In Progress\" students (rawStudents)\r\n        rawStudents.forEach((data: any) => {\r\n            const courseMeta = coursesMap[data.courseId];\r\n            const subject = courseMeta?.subject || \"\";\r\n            const gradeLevel = courseMeta?.grade || \"\";\r\n            const courseTitle = courseMeta?.title || \"  \";\r\n\r\n            // Normalize ID if email exists\r\n            const id = data.studentEmail || data.id;\r\n\r\n            // Check for alerts\r\n            // Fix: Use data directly as studentsMap[id] is not yet assigned\r\n            const currentName = data.studentEmail?.split('@')[0] || \"\";\r\n            const hasAlert = safetyAlerts.some((a: any) => a.studentId === data.id || a.studentName === currentName);\r\n\r\n            studentsMap[id] = {\r\n                id: data.id,\r\n                name: data.studentEmail?.split('@')[0] || \"\",\r\n                score: data.finalScore || 0,\r\n                progress: data.answers ? Math.min(Object.keys(data.answers).length * 10, 90) : 0, // Estimate percentage (10% per answer, max 90% until submit)\r\n                lastActive: data.lastActive ? new Date(data.lastActive).toLocaleDateString('he-IL') : '-',\r\n                answers: data.answers || {},\r\n                chatHistory: data.chatHistory || [],\r\n                courseId: data.courseId,\r\n                subject,\r\n                gradeLevel,\r\n                courseTitle,\r\n                isSubmitted: false, // Mark as not submitted initially\r\n                hasAlert\r\n            } as any;\r\n        });\r\n\r\n        // 2. Process \"Submitted\" students (rawSubmissions) - Overwrite or Add\r\n        rawSubmissions.forEach((sub: any) => {\r\n            const courseMeta = coursesMap[sub.courseId];\r\n            // Simple unique key strategy: use studentName if no email/ID available\r\n            const key = sub.studentEmail || sub.studentName || sub.id;\r\n\r\n            let score = sub.score || 0;\r\n            // Logic to use existing score if higher? For now, submission overrides.\r\n\r\n            // Check for alerts\r\n            const hasAlert = safetyAlerts.some((a: any) => a.studentId === sub.id || a.studentName === sub.studentName);\r\n\r\n            studentsMap[key] = {\r\n                ...studentsMap[key], // Keep existing metadata if any\r\n                id: sub.id, // Use submission ID as primary for viewing\r\n                name: sub.studentName || studentsMap[key]?.name || \"\",\r\n                score: score,\r\n                progress: 100,\r\n                lastActive: sub.submittedAt?.toDate ? sub.submittedAt.toDate().toLocaleDateString('he-IL') : (studentsMap[key]?.lastActive || ''),\r\n                answers: sub.answers || {},\r\n                courseId: sub.courseId,\r\n                subject: courseMeta?.subject || \"\",\r\n                gradeLevel: courseMeta?.grade || \"\",\r\n                courseTitle: courseMeta?.title || \"\",\r\n                source: 'submission',\r\n                rawSubmission: sub,\r\n                isSubmitted: true, // Mark as submitted\r\n                hasAlert: studentsMap[key]?.hasAlert || hasAlert,\r\n                analytics: sub.analytics || undefined\r\n            } as any;\r\n        });\r\n\r\n        return Object.values(studentsMap);\r\n    }, [rawSubmissions, rawStudents, coursesMap, isCoursesLoaded, safetyAlerts]);\r\n\r\n    // --- 4. Dynamic Filter Lists ---\r\n    const availableSubjects = useMemo(() => {\r\n        const subjects = new Set<string>();\r\n        Object.values(coursesMap).forEach(c => {\r\n            if (c.subject && c.subject !== \"\") subjects.add(c.subject);\r\n        });\r\n        return Array.from(subjects).sort();\r\n    }, [coursesMap]);\r\n\r\n    const availableGrades = useMemo(() => {\r\n        const grades = new Set<string>();\r\n        Object.values(coursesMap).forEach(c => {\r\n            if (c.grade && c.grade !== \"\") grades.add(c.grade);\r\n        });\r\n        return Array.from(grades).sort((a, b) => {\r\n            const normA = normalizeText(a);\r\n            const normB = normalizeText(b);\r\n            const indexA = GRADE_ORDER.findIndex(g => normalizeText(g).includes(normA) || normA.includes(normalizeText(g)));\r\n            const indexB = GRADE_ORDER.findIndex(g => normalizeText(g).includes(normB) || normB.includes(normalizeText(g)));\r\n            if (indexA !== -1 && indexB !== -1) return indexA - indexB;\r\n            if (indexA !== -1) return -1;\r\n            if (indexB !== -1) return 1;\r\n            return a.localeCompare(b);\r\n        });\r\n    }, [coursesMap]);\r\n\r\n    // --- Aggregation Logic (Now includes Next Due Date & Sorting) ---\r\n    const aggregatedCourses = useMemo(() => {\r\n        const grouped: Record<string, CourseAggregation & { totalProgress: number, nextDueDate?: string }> = {};\r\n        const today = new Date().toISOString();\r\n\r\n        Object.entries(coursesMap).forEach(([id, meta]) => {\r\n            const normMetaSubject = normalizeText(meta.subject);\r\n            const normMetaGrade = normalizeText(meta.grade);\r\n            const normFilterSubject = normalizeText(filterSubject);\r\n            const normFilterGrade = normalizeText(filterGrade);\r\n\r\n            // Type Filtering Logic - based on productType from wizardData\r\n            const productType = meta.wizardData?.settings?.productType || null;\r\n            const isLesson = productType === 'lesson' || meta.mode === 'lesson';\r\n            const isExam = productType === 'exam' || meta.mode === 'exam';\r\n            const isActivity = productType === 'activity' || (!isLesson && !isExam && productType !== 'podcast');\r\n            const isPodcast = productType === 'podcast';\r\n\r\n            const matchType = filterType === 'all' ||\r\n                (filterType === 'lesson' && isLesson) ||\r\n                (filterType === 'test' && isExam) ||\r\n                (filterType === 'activity' && isActivity);\r\n\r\n            const matchSubject = filterSubject === 'all' || normMetaSubject.includes(normFilterSubject);\r\n            const matchGrade = filterGrade === 'all' || normMetaGrade.includes(normFilterGrade);\r\n            const matchSearch = searchTerm === \"\" || meta.title.toLowerCase().includes(searchTerm.toLowerCase());\r\n\r\n            if (matchSubject && matchGrade && matchSearch && matchType) {\r\n                // Calculate next due date\r\n                const courseAssignments = assignmentsMap[id] || [];\r\n                const upcoming = courseAssignments\r\n                    .filter(a => a.dueDate >= today)\r\n                    .sort((a, b) => a.dueDate.localeCompare(b.dueDate));\r\n                const nextDue = upcoming.length > 0 ? upcoming[0].dueDate : null;\r\n\r\n                grouped[id] = {\r\n                    courseId: id,\r\n                    title: meta.title,\r\n                    subject: meta.subject,\r\n                    grade: meta.grade,\r\n                    studentCount: 0,\r\n                    avgScore: 0,\r\n                    totalProgress: 0,\r\n                    completionRate: 0,\r\n                    atRiskCount: 0,\r\n                    createdAt: meta.createdAt,\r\n                    nextDueDate: nextDue, // New Field\r\n                    productType: productType,\r\n                    mode: meta.mode as any,\r\n                    submittedCount: 0,\r\n                    parentLesson: (meta as any).parentLesson // Track if extracted from lesson plan\r\n                };\r\n            }\r\n        });\r\n\r\n        allData.forEach(student => {\r\n            if (grouped[student.courseId]) {\r\n                grouped[student.courseId].studentCount++;\r\n                if ((student as any).isSubmitted) {\r\n                    grouped[student.courseId].submittedCount++;\r\n                }\r\n\r\n                grouped[student.courseId].avgScore += student.score;\r\n                const studentProgress = student.progress > 0 ? 100 : 0;\r\n                grouped[student.courseId].totalProgress += studentProgress;\r\n\r\n                if (student.score < 60) grouped[student.courseId].atRiskCount++;\r\n                if (student.hasAlert) grouped[student.courseId].atRiskCount++; // Increase risk count if safety alert\r\n            }\r\n        });\r\n\r\n        let result = Object.values(grouped)\r\n            .map(c => ({\r\n                ...c,\r\n                avgScore: c.studentCount > 0 ? Math.round(c.avgScore / c.studentCount) : 0,\r\n                completionRate: c.studentCount > 0 ? Math.round(c.totalProgress / c.studentCount) : 0\r\n            }));\r\n\r\n        // Sorting Logic\r\n        const { key, direction } = sortConfig;\r\n        result.sort((a, b) => {\r\n            let valA = (a as any)[key];\r\n            let valB = (b as any)[key];\r\n\r\n            // Handle specific types\r\n            if (key === 'createdAt') {\r\n                const getTime = (d: any) => (d?.seconds ? d.seconds : d instanceof Date ? d.getTime() / 1000 : 0);\r\n                valA = getTime(valA);\r\n                valB = getTime(valB);\r\n            }\r\n            if (key === 'nextDueDate') {\r\n                // Empty dates last\r\n                if (!valA) return 1;\r\n                if (!valB) return -1;\r\n            }\r\n            if (key === 'type') {\r\n                // Sort by type text\r\n                return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);\r\n            }\r\n\r\n            if (valA < valB) return direction === 'asc' ? -1 : 1;\r\n            if (valA > valB) return direction === 'asc' ? 1 : -1;\r\n            return 0;\r\n        });\r\n\r\n        return result;\r\n    }, [allData, coursesMap, assignmentsMap, filterSubject, filterGrade, searchTerm, sortConfig]);\r\n\r\n    const currentCourseStudents = useMemo(() => {\r\n        if (!selectedCourseId) return [];\r\n        let students = allData.filter(s => s.courseId === selectedCourseId && s.name.toLowerCase().includes(searchTerm.toLowerCase()));\r\n        if (showOnlyAlerts) {\r\n            students = students.filter(s => s.hasAlert);\r\n        }\r\n        return students;\r\n    }, [allData, selectedCourseId, searchTerm, showOnlyAlerts]);\r\n\r\n    const stats = useMemo(() => {\r\n        if (currentCourseStudents.length === 0) return { avg: 0, high: 0, low: 0, risk: 0, distribution: [0, 0, 0, 0] };\r\n        const sum = currentCourseStudents.reduce((acc, curr) => acc + curr.score, 0);\r\n        const dist = [0, 0, 0, 0];\r\n        let risk = 0;\r\n        currentCourseStudents.forEach(s => {\r\n            if (s.score < 60) { dist[0]++; risk++; }\r\n            else if (s.score < 80) dist[1]++;\r\n            else if (s.score < 90) dist[2]++;\r\n            else dist[3]++;\r\n        });\r\n        return { avg: Math.round(sum / currentCourseStudents.length), high: dist[3], low: dist[0], risk, distribution: dist };\r\n    }, [currentCourseStudents]);\r\n\r\n    // --- Helpers ---\r\n    // getScoreColor removed\r\n\r\n    // --- Handlers ---\r\n    const handleClassAnalysis = async () => {\r\n        if (currentCourseStudents.length < 3) return alert(\"  3  .\");\r\n        setAiLoading(true);\r\n        try {\r\n            const insight = await generateClassAnalysis(currentCourseStudents);\r\n            setAiInsight(insight);\r\n        } catch (e) { alert(\" \"); }\r\n        finally { setAiLoading(false); }\r\n    };\r\n\r\n    const handleGroupAnalysis = () => {\r\n        setAiLoading(true);\r\n        const selectedGroup = currentCourseStudents.filter(s => selectedStudentIds.has(s.id));\r\n        setTimeout(() => {\r\n            const avg = selectedGroup.length > 0 ? Math.round(selectedGroup.reduce((a, b) => a + b.score, 0) / selectedGroup.length) : 0;\r\n            setGroupAnalysis(`**  (${selectedGroup.length} ):**  ${avg}.`);\r\n            setAiLoading(false);\r\n        }, 2000);\r\n    };\r\n\r\n    const toggleSelection = (id: string) => {\r\n        const newSet = new Set(selectedStudentIds);\r\n        if (newSet.has(id)) newSet.delete(id); else newSet.add(id);\r\n        setSelectedStudentIds(newSet);\r\n    };\r\n\r\n    const handleCopyLink = (e: React.MouseEvent, courseId: string) => {\r\n        try {\r\n            console.log(\"handleCopyLink clicked for:\", courseId);\r\n            e.stopPropagation();\r\n            const course = coursesMap[courseId];\r\n            console.log(\"Found course:\", course);\r\n\r\n            setAssignmentData({\r\n                courseId,\r\n                courseTitle: course ? course.title : \"\",\r\n                title: course ? `: ${course.title}` : \"\",\r\n                dueDate: new Date().toISOString().split('T')[0],\r\n                dueTime: '23:59',\r\n                instructions: ''\r\n            });\r\n            console.log(\"Setting modal open\");\r\n            setAssignmentModalOpen(true);\r\n        } catch (error) {\r\n            console.error(\"Error in handleCopyLink:\", error);\r\n            alert(\"  \");\r\n        }\r\n    };\r\n\r\n    const handleCreateAssignment = async () => {\r\n        if (!assignmentData.title || !assignmentData.dueDate) return alert(\" \");\r\n\r\n        try {\r\n            const combinedDate = new Date(`${assignmentData.dueDate}T${assignmentData.dueTime}`);\r\n\r\n            const docRef = await addDoc(collection(db, \"assignments\"), {\r\n                courseId: assignmentData.courseId,\r\n                title: assignmentData.title,\r\n                dueDate: combinedDate.toISOString(),\r\n                instructions: assignmentData.instructions,\r\n                createdAt: serverTimestamp(),\r\n                teacherId: \"TODO_USER_ID\" // Ideally from context\r\n            });\r\n\r\n            const link = `${window.location.origin}/?assignmentId=${docRef.id}`;\r\n            setCreatedAssignmentLink(link);\r\n            setCopiedId(assignmentData.courseId);\r\n            setTimeout(() => setCopiedId(null), 2000);\r\n        } catch (e) {\r\n            console.error(\"Error creating assignment\", e);\r\n            alert(\"  \");\r\n        }\r\n    };\r\n\r\n    const handleCopyCreatedLink = () => {\r\n        if (createdAssignmentLink) {\r\n            navigator.clipboard.writeText(createdAssignmentLink);\r\n        }\r\n    };\r\n\r\n    const handleCloseAssignmentModal = () => {\r\n        setAssignmentModalOpen(false);\r\n        setCreatedAssignmentLink(null);\r\n    };\r\n\r\n    const handleEditClick = (e: React.MouseEvent, courseId: string) => {\r\n        e.stopPropagation();\r\n        console.log('[TeacherDashboard] handleEditClick called with courseId:', courseId);\r\n        if (onEditCourse) {\r\n            onEditCourse(courseId);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const handleDeleteCourse = async () => {\r\n        if (!deleteConfirmation.courseId) return;\r\n\r\n        try {\r\n            await deleteDoc(doc(db, \"courses\", deleteConfirmation.courseId));\r\n            // We rely on onSnapshot to update the list, but we should clear selection\r\n            setSelectedCourseId(null);\r\n            setDeleteConfirmation({ step: 'none', courseId: null });\r\n            alert(\"  .\");\r\n        } catch (error) {\r\n            console.error(\"Error deleting course:\", error);\r\n            alert(\"  .\");\r\n        }\r\n    };\r\n\r\n    const handleSaveFeedback = async () => {\r\n        if (!viewingTestStudent) return;\r\n        const subId = (viewingTestStudent as any).rawSubmission?.id;\r\n        if (!subId) return alert(\"   \");\r\n\r\n        setIsSavingFeedback(true);\r\n        try {\r\n            await updateDoc(doc(db, \"submissions\", subId), {\r\n                feedback: feedbackText,\r\n                gradedAt: serverTimestamp()\r\n            });\r\n            alert(\"  !\");\r\n        } catch (error) {\r\n            console.error(\"Error saving feedback:\", error);\r\n            alert(\"  \");\r\n        } finally {\r\n            setIsSavingFeedback(false);\r\n        }\r\n    };\r\n\r\n    if (loading || !isCoursesLoaded) return <div className=\"h-screen flex items-center justify-center text-wizdi-royal font-bold\"> ...</div>;\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-50 p-6 font-sans pb-24 text-right\" dir=\"rtl\">\r\n            <div className=\"max-w-7xl mx-auto space-y-8\">\r\n\r\n                {/* 1. TOP BAR */}\r\n                {/* 1. TOP BAR */}\r\n                <header className=\"card-glass p-0 sticky top-4 z-40 overflow-hidden shadow-glass ring-1 ring-white/40\">\r\n                    <div className=\"p-4 flex flex-col xl:flex-row justify-between items-center gap-4 bg-white/40\">\r\n\r\n                        {/* RIGHT SIDE (RTL Start) - Title Area */}\r\n                        <div className=\"flex items-center gap-3 w-full xl:w-auto\">\r\n                            {selectedCourseId ? (\r\n                                <div className=\"flex items-center gap-3 animate-slide-in-right\">\r\n                                    <h2 className=\"text-3xl font-black text-wizdi-royal tracking-tight text-right line-clamp-1 max-w-[600px] drop-shadow-sm\" title={aggregatedCourses.find(c => c.courseId === selectedCourseId)?.title}>\r\n                                        {(() => {\r\n                                            const course = aggregatedCourses.find(c => c.courseId === selectedCourseId);\r\n                                            const display = getProductTypeDisplay(course?.productType, course?.mode);\r\n                                            return (\r\n                                                <span className={`font-bold ml-2 text-lg uppercase tracking-wider px-2 py-1 rounded-lg border ${display.headerColor}`}>\r\n                                                    {display.label}\r\n                                                </span>\r\n                                            );\r\n                                        })()}\r\n                                        {aggregatedCourses.find(c => c.courseId === selectedCourseId)?.title || \" \"}\r\n                                    </h2>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"flex items-center gap-4\">\r\n                                    <div className=\"bg-gradient-to-br from-wizdi-royal to-wizdi-cyan p-3 rounded-2xl text-white shadow-lg shadow-wizdi-royal/20 transform hover:scale-110 transition-transform duration-300\">\r\n                                        <IconLayer className=\"w-8 h-8\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h1 className=\"text-3xl font-black text-wizdi-royal tracking-tight\"> </h1>\r\n                                        <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500/80\">\r\n                                            <span className=\"w-2 h-2 rounded-full bg-wizdi-lime animate-pulse\"></span>\r\n                                              \r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* LEFT SIDE (RTL End) - Actions / Filters */}\r\n                        <div className=\"flex items-center gap-3 w-full xl:w-auto justify-end\">\r\n                            {selectedCourseId ? (\r\n                                <div className=\"flex items-center gap-3 animate-fade-in\">\r\n                                    <button\r\n                                        onClick={() => setDeleteConfirmation({ step: 'first', courseId: selectedCourseId })}\r\n                                        className=\"px-5 py-2.5 text-red-500 hover:bg-red-50 hover:text-red-600 rounded-2xl transition-all font-bold flex items-center gap-2 text-sm border border-transparent hover:border-red-100\"\r\n                                        title=\" /\"\r\n                                    >\r\n                                        <IconTrash className=\"w-5 h-5 opacity-70 group-hover:opacity-100\" /> \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setViewingControlCenter(selectedCourseId)}\r\n                                        className=\"px-5 py-2.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-600 rounded-2xl transition-all font-bold flex items-center gap-2 text-sm border border-indigo-200\"\r\n                                        title=\"   -   \"\r\n                                    >\r\n                                        <IconChartBar className=\"w-5 h-5\" />  \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setViewingLessonPlan(selectedCourseId)}\r\n                                        className=\"px-5 py-2.5 bg-wizdi-cyan/10 hover:bg-wizdi-cyan/20 text-wizdi-cyan rounded-2xl transition-all font-bold flex items-center gap-2 text-sm border border-wizdi-cyan/30\"\r\n                                        title=\"  \"\r\n                                    >\r\n                                        <IconEye className=\"w-5 h-5\" />  \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => { setSelectedCourseId(null); setAiInsight(null); setSearchTerm(''); setFilterSubject('all'); setFilterGrade('all'); setShowOnlyAlerts(false); }}\r\n                                        className=\"btn-lip-primary px-6 py-2.5 text-sm flex items-center gap-2 shadow-lg shadow-wizdi-royal/20\"\r\n                                    >\r\n                                        <IconArrowBack className=\"w-5 h-5 rotate-180\" />  \r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"card-glass flex flex-wrap items-center gap-3 w-full xl:w-auto p-2 border border-white/50 shadow-sm backdrop-blur-md\">\r\n                                    {/* View Toggle */}\r\n                                    <div className=\"flex bg-slate-100/80 rounded-xl p-1 gap-1\">\r\n                                        <button onClick={() => setViewMode('grid')} className={`p-2 rounded-lg transition-all duration-300 ${viewMode === 'grid' ? 'bg-white shadow-sm text-wizdi-royal scale-105 font-bold' : 'text-slate-400 hover:text-slate-600'}`} title=\" \"><IconLayer className=\"w-5 h-5\" /></button>\r\n                                        <button onClick={() => setViewMode('list')} className={`p-2 rounded-lg transition-all duration-300 ${viewMode === 'list' ? 'bg-white shadow-sm text-wizdi-royal scale-105 font-bold' : 'text-slate-400 hover:text-slate-600'}`} title=\" \"><IconList className=\"w-5 h-5\" /></button>\r\n                                        <button onClick={() => setViewMode('feedback')} className={`p-2 rounded-lg transition-all duration-300 ${viewMode === 'feedback' ? 'bg-white shadow-sm text-wizdi-royal scale-105 font-bold' : 'text-slate-400 hover:text-slate-600'}`} title=\" \"><IconFlag className=\"w-5 h-5\" /></button>\r\n                                    </div>\r\n\r\n                                    <div className=\"w-px h-8 bg-slate-200 mx-1\"></div>\r\n\r\n                                    {/* Email Reports Toggle */}\r\n                                    <button\r\n                                        onClick={() => handleToggleEmailReports(!emailReportsEnabled)}\r\n                                        disabled={isEmailSettingLoading}\r\n                                        className={`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-bold transition-all ${\r\n                                            emailReportsEnabled\r\n                                                ? 'bg-wizdi-cyan/20 text-wizdi-cyan border border-wizdi-cyan/30'\r\n                                                : 'bg-slate-100 text-slate-500 hover:bg-slate-200'\r\n                                        } ${isEmailSettingLoading ? 'opacity-50' : ''}`}\r\n                                        title={emailReportsEnabled ? '  ' : '  '}\r\n                                    >\r\n                                        {emailReportsEnabled ? <IconMail className=\"w-4 h-4\" /> : <IconMailOff className=\"w-4 h-4\" />}\r\n                                        <span className=\"hidden sm:inline\"> </span>\r\n                                    </button>\r\n\r\n                                    <div className=\"w-px h-8 bg-slate-200 mx-1\"></div>\r\n\r\n                                    {/* Filters Group */}\r\n                                    {/* Filters Group - Mobile Optimized */}\r\n                                    <div className=\"flex flex-col md:flex-row gap-2 w-full md:w-auto transition-all duration-300\">\r\n                                        <div className=\"flex gap-2 w-full md:w-auto\">\r\n                                            <div className=\"relative group flex-1 md:flex-none\">\r\n                                                <div className=\"absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-400 group-hover:text-wizdi-royal transition-colors\">\r\n                                                    <IconSparkles className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <select\r\n                                                    className=\"w-full md:w-auto bg-white/50 border border-transparent hover:border-slate-200 hover:bg-white text-sm py-2 pr-9 pl-4 rounded-xl focus:ring-2 focus:ring-wizdi-cyan/20 outline-none text-slate-600 font-bold transition-all cursor-pointer appearance-none\"\r\n                                                    value={filterType}\r\n                                                    onChange={(e) => setFilterType(e.target.value)}\r\n                                                >\r\n                                                    <option value=\"all\">: </option>\r\n                                                    <option value=\"test\"></option>\r\n                                                    <option value=\"activity\"></option>\r\n                                                    <option value=\"lesson\"> </option>\r\n                                                </select>\r\n                                            </div>\r\n\r\n                                            {/* Mobile Filter Toggle */}\r\n                                            <button\r\n                                                onClick={() => setShowMobileFilters(!showMobileFilters)}\r\n                                                className={`md:hidden p-2 rounded-xl border transition-colors ${showMobileFilters ? 'bg-wizdi-royal/10 border-wizdi-royal/20 text-wizdi-royal' : 'bg-white border-transparent text-slate-400'}`}\r\n                                            >\r\n                                                <IconList className=\"w-5 h-5\" />\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        {/* Collapsible Filters */}\r\n                                        <div className={`${showMobileFilters ? 'flex' : 'hidden'} md:flex flex-col md:flex-row gap-2 animate-fade-in origin-top`}>\r\n                                            <div className=\"relative group\">\r\n                                                <div className=\"absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-400 group-hover:text-wizdi-royal transition-colors\">\r\n                                                    <IconBook className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <select\r\n                                                    className=\"w-full md:w-auto bg-white/50 border border-transparent hover:border-slate-200 hover:bg-white text-sm py-2 pr-9 pl-4 rounded-xl focus:ring-2 focus:ring-wizdi-cyan/20 outline-none text-slate-600 font-bold transition-all cursor-pointer appearance-none max-w-none md:max-w-[150px]\"\r\n                                                    value={filterSubject}\r\n                                                    onChange={(e) => setFilterSubject(e.target.value)}\r\n                                                >\r\n                                                    <option value=\"all\">: </option>\r\n                                                    {availableSubjects.map((s, i) => <option key={i} value={s}>{s}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n\r\n                                            <div className=\"relative group\">\r\n                                                <div className=\"absolute inset-y-0 right-3 flex items-center pointer-events-none text-slate-400 group-hover:text-wizdi-royal transition-colors\">\r\n                                                    <IconLayer className=\"w-4 h-4\" />\r\n                                                </div>\r\n                                                <select\r\n                                                    className=\"w-full md:w-auto bg-white/50 border border-transparent hover:border-slate-200 hover:bg-white text-sm py-2 pr-9 pl-4 rounded-xl focus:ring-2 focus:ring-wizdi-cyan/20 outline-none text-slate-600 font-bold transition-all cursor-pointer appearance-none max-w-none md:max-w-[150px]\"\r\n                                                    value={filterGrade}\r\n                                                    onChange={(e) => setFilterGrade(e.target.value)}\r\n                                                >\r\n                                                    <option value=\"all\">: </option>\r\n                                                    {availableGrades.map((g, i) => <option key={i} value={g}>{g}</option>)}\r\n                                                </select>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div className=\"w-px h-8 bg-slate-200 mx-1 hidden md:block\"></div>\r\n\r\n                                    <div className=\"relative flex-1 min-w-[180px]\">\r\n                                        <IconSearch className=\"w-4 h-4 text-slate-400 absolute right-3 top-3 group-focus-within:text-wizdi-royal transition-colors\" />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"...\"\r\n                                            className=\"w-full pr-10 pl-4 py-2 bg-white/50 border border-transparent hover:bg-white hover:border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-wizdi-cyan/20 text-slate-700 font-medium transition-all placeholder:text-slate-400\"\r\n                                            value={searchTerm}\r\n                                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className=\"w-px h-8 bg-slate-200 mx-1\"></div>\r\n\r\n                                    {/* Usage Stats Button */}\r\n                                    <button\r\n                                        onClick={() => setShowUsageModal(true)}\r\n                                        className={`px-3 py-2 rounded-xl text-sm font-bold flex items-center gap-2 transition-all transform hover:-translate-y-0.5 shadow-md ${\r\n                                            usageStats && usageStats.usage.textTokens.percent >= 80\r\n                                                ? 'bg-amber-100 text-amber-700 border border-amber-300 hover:bg-amber-200'\r\n                                                : 'bg-white text-slate-600 border border-slate-200 hover:bg-slate-50'\r\n                                        }`}\r\n                                        title=\" \"\r\n                                    >\r\n                                        <IconChartBar className=\"w-4 h-4\" />\r\n                                        <span className=\"hidden lg:inline\"></span>\r\n                                        {usageStats && (\r\n                                            <span className={`px-1.5 py-0.5 rounded-full text-xs ${\r\n                                                usageStats.usage.textTokens.percent >= 80\r\n                                                    ? 'bg-amber-500 text-white'\r\n                                                    : 'bg-slate-200 text-slate-600'\r\n                                            }`}>\r\n                                                {usageStats.usage.textTokens.percent}%\r\n                                            </span>\r\n                                        )}\r\n                                    </button>\r\n\r\n                                    <div className=\"w-px h-8 bg-slate-200 mx-1\"></div>\r\n                                    <ClassroomConnectButton />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n\r\n                {!selectedCourseId && (\r\n                    <div className=\"animate-fade-in relative z-10\">\r\n                        {aggregatedCourses.length === 0 ? (\r\n                            <div className=\"text-center py-24 card-glass rounded-[3rem] shadow-xl flex flex-col items-center justify-center gap-6 group\">\r\n                                <div className=\"bg-wizdi-cloud p-6 rounded-full group-hover:scale-110 transition-transform duration-500\">\r\n                                    <IconBook className=\"w-20 h-20 text-wizdi-royal/30 group-hover:text-wizdi-royal/50 transition-colors\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h3 className=\"text-2xl font-black text-wizdi-royal/60 mb-2\">  </h3>\r\n                                    <p className=\"text-slate-500/80 text-lg font-medium\">      !</p>\r\n                                </div>\r\n                                <button onClick={() => { setFilterSubject('all'); setFilterGrade('all'); setSearchTerm(''); }} className=\"btn-lip-primary px-6 py-2 text-sm\"> </button>\r\n                            </div>\r\n                        ) : (\r\n                            <>\r\n                                {viewMode === 'grid' ? (\r\n                                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n                                        {aggregatedCourses.map(c => (\r\n                                            <div\r\n                                                key={c.courseId}\r\n                                                onClick={() => setViewingControlCenter(c.courseId)}\r\n                                                className=\"card-glass p-0 cursor-pointer group flex flex-col h-[280px] relative overflow-hidden hover:-translate-y-2 hover:shadow-2xl transition-all duration-300 ring-1 ring-white/60 border-0\"\r\n                                            >\r\n                                                {/* Header Color Splash */}\r\n                                                <div className={`h-32 p-6 relative overflow-hidden transition-colors duration-500\r\n                                                    ${c.productType === 'exam'\r\n                                                        ? 'bg-gradient-to-br from-wizdi-cyan to-wizdi-royal'\r\n                                                        : c.productType === 'lesson'\r\n                                                            ? 'bg-gradient-to-br from-emerald-500 to-emerald-700'\r\n                                                            : c.productType === 'podcast'\r\n                                                                ? 'bg-gradient-to-br from-orange-400 to-orange-600'\r\n                                                                : 'bg-gradient-to-br from-wizdi-royal to-wizdi-cyan'}\r\n                                                `}>\r\n                                                    {/* Background Pattern */}\r\n                                                    <div className=\"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] mix-blend-overlay\"></div>\r\n                                                    <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full blur-3xl group-hover:scale-150 transition-transform duration-700\"></div>\r\n\r\n                                                    <div className=\"relative z-10 flex justify-between items-start\">\r\n                                                        <div className=\"flex flex-col gap-1\">\r\n                                                            <span className={`px-3 py-1 rounded-full text-xs font-black uppercase tracking-wider backdrop-blur-md border shadow-sm ${getProductTypeDisplay(c.productType, c.mode).cardColor}`}>\r\n                                                                {getProductTypeDisplay(c.productType, c.mode).label}\r\n                                                            </span>\r\n                                                            {c.parentLesson && (\r\n                                                                <span className=\"px-2 py-0.5 rounded-full text-[10px] font-bold bg-white/20 text-white backdrop-blur-md border border-white/30\">\r\n                                                                     \r\n                                                                </span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                        <div className=\"p-2 bg-white/10 rounded-xl backdrop-blur-md opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0\">\r\n                                                            <IconArrowBack className=\"w-5 h-5 text-white rotate-180\" />\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <h3 className=\"text-2xl font-black text-white mt-4 leading-tight line-clamp-2 drop-shadow-md\">\r\n                                                        {c.title}\r\n                                                    </h3>\r\n                                                </div>\r\n\r\n                                                {/* Actions Overlay (Top Left) */}\r\n                                                <div className=\"absolute top-4 left-4 flex gap-2 z-20 opacity-0 group-hover:opacity-100 transition-all duration-300 transform -translate-y-2 group-hover:translate-y-0\">\r\n                                                    <button\r\n                                                        onClick={(e) => handleEditClick(e, c.courseId)}\r\n                                                        className=\"p-2.5 bg-white text-wizdi-royal hover:bg-blue-50 rounded-xl shadow-lg hover:scale-110 transition-all\"\r\n                                                        title=\" \"\r\n                                                    >\r\n                                                        <IconEdit className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={(e) => handleCopyLink(e, c.courseId)}\r\n                                                        className=\"p-2.5 bg-wizdi-lime text-green-900 hover:bg-lime-400 rounded-xl shadow-lg hover:scale-110 transition-all font-bold\"\r\n                                                        title=\"  \"\r\n                                                    >\r\n                                                        {copiedId === c.courseId ? <IconCheck className=\"w-4 h-4 text-green-700\" /> : <IconLink className=\"w-4 h-4\" />}\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={(e) => {\r\n                                                            e.stopPropagation();\r\n                                                            setAssignmentData({\r\n                                                                ...assignmentData,\r\n                                                                courseId: c.courseId,\r\n                                                                courseTitle: c.title,\r\n                                                                title: c.title\r\n                                                            });\r\n                                                            setAssignmentModalOpen(true);\r\n                                                        }}\r\n                                                        className=\"p-2.5 bg-white text-slate-600 hover:text-wizdi-lime hover:bg-wizdi-lime/10 rounded-xl shadow-lg hover:scale-110 transition-all\"\r\n                                                        title=\" -Google Classroom\"\r\n                                                    >\r\n                                                        <IconBrandGoogle className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={(e) => { e.stopPropagation(); setShareModalCourse({ id: c.courseId, title: c.title }); }}\r\n                                                        className=\"p-2.5 bg-white text-slate-600 hover:text-wizdi-royal hover:bg-wizdi-royal/10 rounded-xl shadow-lg hover:scale-110 transition-all\"\r\n                                                        title=\" /\"\r\n                                                    >\r\n                                                        <IconShare className=\"w-4 h-4\" />\r\n                                                    </button>\r\n                                                </div>\r\n\r\n                                                {/* Body Content */}\r\n                                                < div className=\"p-6 flex-1 flex flex-col justify-between bg-gradient-to-b from-white to-blue-50/30\" >\r\n                                                    <div className=\"space-y-3\">\r\n                                                        <div className=\"flex items-center gap-4 text-xs font-bold text-slate-400 uppercase tracking-wide\">\r\n                                                            <span className=\"flex items-center gap-1\"><IconBook className=\"w-3 h-3\" /> {c.subject}</span>\r\n                                                            <span className=\"w-1 h-1 bg-slate-300 rounded-full\"></span>\r\n                                                            <span className=\"flex items-center gap-1\"><IconStudent className=\"w-3 h-3\" /> {c.grade}</span>\r\n                                                        </div>\r\n\r\n                                                        {/* Progress Bar */}\r\n                                                        <div className=\"space-y-1\">\r\n                                                            <div className=\"flex justify-between text-xs font-bold\">\r\n                                                                <span className=\"text-slate-600\"> </span>\r\n                                                                <span className=\"text-wizdi-royal\">{c.completionRate}%</span>\r\n                                                            </div>\r\n                                                            <div className=\"h-2 w-full bg-slate-100 rounded-full overflow-hidden shadow-inner\">\r\n                                                                <div\r\n                                                                    className={`h-full rounded-full transition-all duration-1000 ease-out group-hover:brightness-110 ${c.completionRate > 80 ? 'bg-gradient-to-r from-teal-400 to-emerald-500' : 'bg-gradient-to-r from-wizdi-royal to-cyan-400'}`}\r\n                                                                    style={{ width: `${c.completionRate}%` }}\r\n                                                                ></div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n\r\n                                                    <div className=\"pt-4 border-t border-slate-100 flex justify-between items-end\">\r\n                                                        <div>\r\n                                                            <div className=\"text-3xl font-black text-slate-800\">{c.studentCount}</div>\r\n                                                            <div className=\"text-xs text-slate-400 font-bold uppercase\"></div>\r\n                                                        </div>\r\n\r\n                                                        {c.atRiskCount > 0 && (\r\n                                                            <div className=\"flex items-center gap-1.5 bg-red-50 text-red-600 px-3 py-1.5 rounded-lg border border-red-100 animate-pulse\">\r\n                                                                <IconAlertTriangle className=\"w-4 h-4\" />\r\n                                                                <span className=\"text-xs font-black\">{c.atRiskCount} </span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                ) : viewMode === 'list' ? (\r\n                                    /* --- LIST VIEW --- */\r\n                                    <div className=\"card-glass rounded-3xl shadow-xl overflow-hidden\">\r\n                                        <div className=\"overflow-x-auto\">\r\n                                            <table className=\"w-full text-sm text-right\">\r\n                                                <thead className=\"bg-wizdi-cloud text-slate-500 font-medium border-b border-slate-100\">\r\n                                                    <tr>\r\n                                                        <th onClick={() => setSortConfig({ key: 'title', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 w-1/4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\">  {sortConfig.key === 'title' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'type', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\"> {sortConfig.key === 'type' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'subject', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\">  {sortConfig.key === 'subject' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'grade', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\">/ {sortConfig.key === 'grade' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'nextDueDate', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\">  {sortConfig.key === 'nextDueDate' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'submittedCount', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\"> (/ ) {sortConfig.key === 'submittedCount' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'completionRate', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\"> {sortConfig.key === 'completionRate' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th onClick={() => setSortConfig({ key: 'avgScore', direction: sortConfig.direction === 'asc' ? 'desc' : 'asc' })} className=\"p-4 cursor-pointer hover:bg-slate-100 transition-colors\">\r\n                                                            <div className=\"flex items-center gap-1\"> {sortConfig.key === 'avgScore' && (sortConfig.direction === 'asc' ? <IconArrowUp className=\"w-3 h-3\" /> : <IconArrowDown className=\"w-3 h-3\" />)}</div>\r\n                                                        </th>\r\n                                                        <th className=\"p-4 w-32\"></th>\r\n                                                    </tr>\r\n                                                </thead>\r\n                                                <tbody className=\"divide-y divide-slate-100\">\r\n                                                    {aggregatedCourses.map(c => (\r\n                                                        <tr key={c.courseId} onClick={() => setViewingControlCenter(c.courseId)} className=\"hover:bg-wizdi-cloud/50 cursor-pointer transition-colors group\">\r\n                                                            <td className=\"p-4\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    {/* Red dot for alerts - show if atRiskCount > 0 OR demo on first item */}\r\n                                                                    {(c.atRiskCount > 0 || aggregatedCourses.indexOf(c) === 0) && (\r\n                                                                        <div className=\"w-2.5 h-2.5 bg-red-500 rounded-full flex-shrink-0\" title={`${c.atRiskCount || 1}    `}></div>\r\n                                                                    )}\r\n                                                                    <div className=\"font-bold text-slate-800 text-base group-hover:text-wizdi-royal transition-colors\">{c.title}</div>\r\n                                                                </div>\r\n                                                                <div className=\"text-xs text-slate-400 mt-1\"> : {\r\n                                                                    c.createdAt?.toDate ? c.createdAt.toDate().toLocaleDateString('he-IL') :\r\n                                                                    c.createdAt?.seconds ? new Date(c.createdAt.seconds * 1000).toLocaleDateString('he-IL') :\r\n                                                                    c.createdAt instanceof Date ? c.createdAt.toLocaleDateString('he-IL') :\r\n                                                                    typeof c.createdAt === 'string' ? new Date(c.createdAt).toLocaleDateString('he-IL') :\r\n                                                                    '-'\r\n                                                                }</div>\r\n                                                            </td>\r\n                                                            <td className=\"p-4\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${getProductTypeDisplay(c.productType, c.mode).color}`}>\r\n                                                                        {getProductTypeDisplay(c.productType, c.mode).label}\r\n                                                                    </span>\r\n                                                                    {c.parentLesson && (\r\n                                                                        <span className=\"px-1.5 py-0.5 rounded text-[10px] font-bold bg-indigo-100 text-indigo-600\" title={`: ${c.parentLesson.title}`}>\r\n                                                                            \r\n                                                                        </span>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td className=\"p-4\"><span className=\"bg-wizdi-cloud text-slate-600 px-2 py-1 rounded text-xs font-bold\">{c.subject}</span></td>\r\n                                                            <td className=\"p-4\"><span className=\"bg-wizdi-cloud text-slate-600 px-2 py-1 rounded text-xs font-bold\">{c.grade}</span></td>\r\n                                                            <td className=\"p-4\">\r\n                                                                {c.nextDueDate ? (\r\n                                                                    <span className=\"font-bold bg-wizdi-gold/20 text-wizdi-gold px-2 py-1 rounded-md text-xs\">\r\n                                                                        {new Date(c.nextDueDate).toLocaleDateString('he-IL')}\r\n                                                                    </span>\r\n                                                                ) : (\r\n                                                                    <span className=\"text-slate-400 text-xs\">-</span>\r\n                                                                )}\r\n                                                            </td>\r\n                                                            <td className=\"p-4 font-bold text-slate-700\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <IconStudent className=\"w-4 h-4 text-slate-400\" />\r\n                                                                    <span>{c.submittedCount} / <span className=\"text-slate-400\">{c.studentCount}</span></span>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td className=\"p-4\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <div className=\"w-16 h-1.5 bg-slate-100 rounded-full overflow-hidden\">\r\n                                                                        <div className=\"h-full bg-gradient-to-l from-wizdi-royal to-wizdi-cyan\" style={{ width: `${c.completionRate}%` }}></div>\r\n                                                                    </div>\r\n                                                                    <span className=\"text-xs font-bold\">{c.completionRate}%</span>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                            <td className=\"p-4 font-black text-lg text-wizdi-royal\">{c.avgScore}</td>\r\n                                                            <td className=\"p-4\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                    <button onClick={(e) => handleEditClick(e, c.courseId)} className=\"p-2 hover:bg-white text-slate-400 hover:text-wizdi-royal rounded-lg transition-colors border border-transparent hover:border-slate-200 shadow-sm\" title=\"\"><IconEdit className=\"w-4 h-4\" /></button>\r\n                                                                    <button onClick={(e) => handleCopyLink(e, c.courseId)} className=\"p-2 hover:bg-white text-slate-400 hover:text-wizdi-lime rounded-lg transition-colors border border-transparent hover:border-slate-200 shadow-sm\" title=\" \"><IconLink className=\"w-4 h-4\" /></button>\r\n\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    ))}\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : viewMode === 'feedback' ? (\r\n                                    <div className=\"space-y-6 animate-fade-in\">\r\n                                        {/* Stats Cards */}\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                                            {/* Positive/Negative Ratio */}\r\n                                            <div className=\"card-glass p-6 rounded-3xl shadow-xl flex items-center justify-between\">\r\n                                                <div>\r\n                                                    <div className=\"text-sm font-bold text-slate-500 mb-1\"> </div>\r\n                                                    <div className=\"text-3xl font-black text-slate-800 flex items-center gap-2\">\r\n                                                        <span className=\"text-wizdi-lime\">{courseFeedbackStats?.stats?.positive || 0}</span>\r\n                                                        <span className=\"text-slate-300 text-lg\">/</span>\r\n                                                        <span className=\"text-red-500\">{courseFeedbackStats?.stats?.negative || 0}</span>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className=\"w-16 h-16 rounded-full bg-wizdi-cloud flex items-center justify-center\">\r\n                                                    {(courseFeedbackStats?.stats?.positive || 0) > (courseFeedbackStats?.stats?.negative || 0) ?\r\n                                                        <IconCheck className=\"w-8 h-8 text-wizdi-lime\" /> :\r\n                                                        <IconAlertTriangle className=\"w-8 h-8 text-red-500\" />\r\n                                                    }\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            {/* Top Pain Points */}\r\n                                            <div className=\"card-glass p-6 rounded-3xl shadow-xl col-span-2\">\r\n                                                <div className=\"text-sm font-bold text-wizdi-royal mb-4\">  ( )</div>\r\n                                                <div className=\"flex gap-3 flex-wrap\">\r\n                                                    {Object.entries(courseFeedbackStats?.stats?.tags || {}).map(([tag, count]: any) => (\r\n                                                        <div key={tag} className=\"bg-red-50 border border-red-100 text-red-700 px-4 py-2 rounded-xl flex items-center gap-2 font-bold\">\r\n                                                            <span>{tag === 'confusing' ? ' ' : tag === 'boring' ? '' : tag === 'too_hard' ? ' ' : tag === 'bug' ? '' : tag}</span>\r\n                                                            <span className=\"bg-red-200 text-red-800 text-xs px-2 py-0.5 rounded-full\">{count}</span>\r\n                                                        </div>\r\n                                                    ))}\r\n                                                    {Object.keys(courseFeedbackStats?.stats?.tags || {}).length === 0 && (\r\n                                                        <div className=\"text-slate-400 text-sm italic\">   </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Recent Feedback List */}\r\n                                        <div className=\"card-glass rounded-3xl shadow-xl overflow-hidden min-h-[400px]\">\r\n                                            <div className=\"p-6 border-b border-slate-100 bg-wizdi-cloud/50\">\r\n                                                <h3 className=\"font-bold text-wizdi-royal\"> </h3>\r\n                                            </div>\r\n                                            <div className=\"divide-y divide-slate-100\">\r\n                                                {isFeedbackLoading ? (\r\n                                                    <div className=\"p-12 text-center text-wizdi-royal font-bold animate-pulse\"> ...</div>\r\n                                                ) : courseFeedbackStats?.recent?.length > 0 ? (\r\n                                                    courseFeedbackStats.recent.map((fb: any) => (\r\n                                                        <div key={fb.id} className=\"p-6 hover:bg-wizdi-cloud/30 transition-colors flex gap-4\">\r\n                                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${fb.type === 'positive' ? 'bg-wizdi-lime/20 text-wizdi-lime' : 'bg-red-100 text-red-600'}`}>\r\n                                                                {fb.type === 'positive' ? <IconCheck className=\"w-5 h-5\" /> : <IconFlag className=\"w-5 h-5\" />}\r\n                                                            </div>\r\n                                                            <div className=\"flex-1\">\r\n                                                                <div className=\"flex justify-between items-start mb-1\">\r\n                                                                    <div className=\"font-bold text-slate-800 text-sm\">\r\n                                                                        {/* We might want to resolve student name here later, for now showing context/id */}\r\n                                                                         (ID: {fb.userId.substring(0, 6)}...)\r\n                                                                    </div>\r\n                                                                    <div className=\"text-xs text-slate-400\">{fb.timestamp?.toDate ? fb.timestamp.toDate().toLocaleDateString('he-IL') : ''}</div>\r\n                                                                </div>\r\n\r\n                                                                {fb.tags && fb.tags.length > 0 && (\r\n                                                                    <div className=\"flex gap-2 mb-2\">\r\n                                                                        {fb.tags.map((t: string) => (\r\n                                                                            <span key={t} className=\"text-xs bg-wizdi-cloud text-slate-600 px-2 py-0.5 rounded border border-slate-200\">{t}</span>\r\n                                                                        ))}\r\n                                                                    </div>\r\n                                                                )}\r\n\r\n                                                                {fb.comment && <div className=\"text-slate-600 text-sm bg-wizdi-cloud p-3 rounded-xl\">{fb.comment}</div>}\r\n                                                                <div className=\"text-xs text-slate-400 mt-2\">: {fb.context?.blockType || ''}</div>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    ))\r\n                                                ) : (\r\n                                                    <div className=\"p-12 text-center text-slate-400\">  </div>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : null}\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                )\r\n                }\r\n\r\n                {/* Selected View... ( ) */}\r\n                {\r\n                    selectedCourseId && (\r\n                        <div className=\"space-y-6 animate-fade-in\">\r\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                                <div className=\"card-glass p-4 rounded-3xl shadow-xl text-center\">\r\n                                    <span className=\"text-xs text-slate-400 font-bold\"> </span>\r\n                                    <div className=\"text-2xl font-black text-wizdi-royal mt-1\">{stats.avg}</div>\r\n                                </div>\r\n                                <div className=\"card-glass p-4 rounded-3xl shadow-xl text-center\">\r\n                                    <span className=\"text-xs text-slate-400 font-bold\"></span>\r\n                                    <div className=\"text-2xl font-black text-wizdi-lime mt-1\">{stats.high}</div>\r\n                                </div>\r\n                                <div className=\"card-glass p-4 rounded-3xl shadow-xl text-center border border-red-100\">\r\n                                    <span className=\"text-xs text-red-400 font-bold\"> </span>\r\n                                    <div className=\"text-2xl font-black text-red-500 mt-1\">{stats.risk}</div>\r\n                                </div>\r\n                                <div onClick={handleClassAnalysis} className=\"bg-gradient-to-br from-wizdi-royal to-wizdi-cyan p-4 rounded-3xl shadow-xl shadow-wizdi-royal/20 text-white flex flex-col justify-center items-center cursor-pointer hover:scale-105 transition-all\">\r\n                                    {aiLoading ? <div className=\"animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full\"></div> : <IconBrain className=\"w-6 h-6\" />}\r\n                                    <span className=\"font-bold text-sm\">  (AI)</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {(aiInsight || groupAnalysis) && (\r\n                                <div className=\"card-glass p-6 rounded-3xl shadow-xl relative\">\r\n                                    <button onClick={() => { setAiInsight(null); setGroupAnalysis(null) }} className=\"absolute top-4 left-4 p-1 hover:bg-slate-100 rounded-full\"><IconX className=\"w-4 h-4 text-slate-400\" /></button>\r\n                                    <h3 className=\"font-bold text-wizdi-royal flex items-center gap-2 mb-4\"><IconSparkles className=\"w-5 h-5 text-wizdi-cyan\" />{groupAnalysis ? '  ' : ' '}</h3>\r\n                                    {groupAnalysis ? <div className=\"bg-wizdi-cloud p-4 rounded-xl text-slate-700 whitespace-pre-line leading-relaxed\">{groupAnalysis}</div> : (\r\n                                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n                                            <div className=\"bg-wizdi-lime/10 p-4 rounded-xl border border-wizdi-lime/20\"><span className=\"text-wizdi-lime font-bold block mb-2 border-b border-wizdi-lime/20 pb-1\">:</span><ul className=\"list-disc list-inside text-slate-600 space-y-1\">{aiInsight.strongSkills?.map((s: string, i: number) => <li key={i}>{s}</li>)}</ul></div>\r\n                                            <div className=\"bg-red-50 p-4 rounded-xl border border-red-100\"><span className=\"text-red-500 font-bold block mb-2 border-b border-red-100 pb-1\">:</span><ul className=\"list-disc list-inside text-slate-600 space-y-1\">{aiInsight.weakSkills?.map((s: string, i: number) => <li key={i}>{s}</li>)}</ul></div>\r\n                                            <div className=\"col-span-full bg-wizdi-royal/10 p-4 rounded-xl border border-wizdi-royal/20 text-wizdi-royal font-medium\"> : {aiInsight.actionItems?.[0]}</div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Google Classroom Modal */}\r\n                            <ClassroomAssignmentModal\r\n                                isOpen={assignmentModalOpen}\r\n                                onClose={() => setAssignmentModalOpen(false)}\r\n                                examTitle={assignmentData.title}\r\n                                examId={assignmentData.courseId}\r\n                            />\r\n\r\n                            {/* Smart Grouping Panel */}\r\n                            <SmartGroupingPanel\r\n                                classId={selectedCourseId}\r\n                                teacherId=\"TEACHER_123\" // Placeholder or from context\r\n                                students={currentCourseStudents}\r\n                            />\r\n\r\n                            <div className=\"card-glass rounded-3xl shadow-xl overflow-hidden min-h-[400px]\">\r\n                                <div className=\"p-4 border-b border-slate-100 bg-wizdi-cloud/50 flex justify-between items-center\">\r\n                                    <div className=\"font-bold text-wizdi-royal text-sm\">  ({currentCourseStudents.length})</div>\r\n                                    {selectedStudentIds.size > 0 && (\r\n                                        <button onClick={handleGroupAnalysis} className=\"btn-lip-primary text-xs px-3 py-1 flex items-center gap-1\"><IconBrain className=\"w-3 h-3\" />   ({selectedStudentIds.size})</button>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"overflow-x-auto\">\r\n                                    <table className=\"w-full text-sm text-right\">\r\n                                        <thead className=\"bg-wizdi-cloud text-slate-500 font-medium\">\r\n                                            <tr>\r\n                                                <th className=\"p-4 w-10\"></th>\r\n                                                <th className=\"p-4\"> </th>\r\n                                                <th className=\"p-4\"></th>\r\n                                                <th className=\"p-4\"> </th>\r\n                                                <th className=\"p-4\"></th>\r\n                                                <th className=\"p-4\"></th>\r\n                                                <th className=\"p-4\"></th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody className=\"divide-y divide-slate-100\">\r\n                                            {currentCourseStudents.map(student => (\r\n                                                <tr key={student.id} className={`hover:bg-wizdi-cloud/50 transition-colors ${selectedStudentIds.has(student.id) ? 'bg-wizdi-royal/5' : ''}`}>\r\n                                                    <td className=\"p-4\">\r\n                                                        <input type=\"checkbox\" className=\"rounded border-slate-300 text-wizdi-royal focus:ring-wizdi-cyan\" checked={selectedStudentIds.has(student.id)} onChange={() => toggleSelection(student.id)} />\r\n                                                    </td>\r\n                                                    <td className=\"p-4 font-bold text-slate-800 flex items-center gap-2\">\r\n                                                        {student.name}\r\n                                                        {student.hasAlert && (\r\n                                                            <span className=\"bg-red-100 text-red-600 p-1 rounded-full animate-pulse\" title=\" \">\r\n                                                                <IconFlag className=\"w-3 h-3\" />\r\n                                                            </span>\r\n                                                        )}\r\n                                                    </td>\r\n                                                    <td className=\"p-4\">\r\n                                                        {(student as any).isSubmitted ? (\r\n                                                            <span className=\"bg-wizdi-lime/20 text-wizdi-lime px-2 py-1 rounded-lg text-xs font-bold flex items-center w-fit gap-1\">\r\n                                                                <IconCheck className=\"w-3 h-3\" /> \r\n                                                            </span>\r\n                                                        ) : (\r\n                                                            <span className=\"bg-wizdi-gold/20 text-wizdi-gold px-2 py-1 rounded-lg text-xs font-bold flex items-center w-fit gap-1\">\r\n                                                                <IconLoader className=\"w-3 h-3\" /> \r\n                                                            </span>\r\n                                                        )}\r\n                                                    </td>\r\n                                                    <td className=\"p-4 text-slate-500\">{student.lastActive}</td>\r\n                                                    <td className=\"p-4\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            <div className=\"w-24 h-1.5 bg-slate-100 rounded-full overflow-hidden\">\r\n                                                                <div className=\"h-full bg-gradient-to-l from-wizdi-royal to-wizdi-cyan\" style={{ width: `${student.progress}%` }}></div>\r\n                                                            </div>\r\n                                                            <span className=\"text-xs font-bold text-slate-500\">{student.progress}%</span>\r\n                                                        </div>\r\n                                                    </td>\r\n                                                    <td className=\"p-4\">\r\n                                                        <span className={`px-2 py-1 rounded font-bold text-xs ${student.score < 60 ? 'bg-red-100 text-red-600' : 'bg-wizdi-lime/20 text-wizdi-lime'}`}>{student.score}</span>\r\n                                                    </td>\r\n                                                    <td className=\"p-4 flex gap-2\">\r\n                                                        <button onClick={() => setViewingTestStudent(student)} className=\"p-1.5 text-wizdi-royal hover:bg-wizdi-royal/10 rounded transition-colors\" title=\"\"><IconEye className=\"w-4 h-4\" /></button>\r\n                                                        {student.analytics && (\r\n                                                            <button onClick={() => setViewingInsightStudent(student)} className=\"p-1.5 text-wizdi-cyan hover:bg-wizdi-cyan/10 rounded transition-colors\" title=\" AI\">\r\n                                                                <IconBrain className=\"w-4 h-4\" />\r\n                                                            </button>\r\n                                                        )}\r\n                                                        <button onClick={() => { setReportStudent(student); generateStudentReport(student).then(r => setReportStudent({ ...student, report: r })); }} className=\"p-1.5 text-wizdi-lime hover:bg-wizdi-lime/10 rounded transition-colors\" title=\"\"><IconEdit className=\"w-4 h-4\" /></button>\r\n                                                    </td>\r\n                                                </tr>\r\n                                            ))}\r\n                                        </tbody>\r\n                                    </table>\r\n                                    {currentCourseStudents.length === 0 && <div className=\"text-center py-10 text-slate-400\">    </div>}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n                {/* Modals */}\r\n                {\r\n                    viewingTestStudent && (\r\n                        <div className=\"fixed inset-0 bg-white z-[100] animate-fade-in flex flex-col\">\r\n                            <React.Suspense fallback={<div className=\"flex-1 flex items-center justify-center text-wizdi-royal font-bold\">   ...</div>}>\r\n                                <CoursePlayer\r\n                                    reviewMode={true}\r\n                                    assignment={{\r\n                                        ...coursesMap[viewingTestStudent.courseId],\r\n                                        id: viewingTestStudent.courseId,\r\n                                        courseId: viewingTestStudent.courseId,\r\n                                        activeSubmission: (viewingTestStudent as any).rawSubmission\r\n                                    }}\r\n                                    onExitReview={() => setViewingTestStudent(null)}\r\n                                />\r\n                            </React.Suspense>\r\n\r\n                            {/* Feedback Footer */}\r\n                            <div className=\"bg-white border-t border-wizdi-cloud p-4 shadow-2xl flex flex-col md:flex-row gap-4 items-center\">\r\n                                <div className=\"flex-1 w-full\">\r\n                                    <label className=\"text-xs font-bold text-slate-500 mb-1 block\">  :</label>\r\n                                    <textarea\r\n                                        className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:border-wizdi-cyan outline-none h-16 resize-none\"\r\n                                        placeholder=\"   ...\"\r\n                                        value={feedbackText}\r\n                                        onChange={(e) => setFeedbackText(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex gap-2 w-full md:w-auto\">\r\n                                    <button\r\n                                        onClick={handleSaveFeedback}\r\n                                        disabled={isSavingFeedback}\r\n                                        className=\"flex-1 md:flex-none btn-lip-action px-6 py-3 flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        {isSavingFeedback ? <span className=\"animate-spin\"></span> : <IconCheck className=\"w-5 h-5\" />}\r\n                                         \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setViewingTestStudent(null)}\r\n                                        className=\"flex-1 md:flex-none px-6 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-full transition-colors\"\r\n                                    >\r\n                                        \r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n                {/* Assignment Creation Modal */}\r\n                {\r\n                    assignmentModalOpen && createPortal(\r\n                        <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 text-right\" dir=\"rtl\">\r\n                            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in\">\r\n                                <div className=\"bg-gradient-to-l from-wizdi-royal to-wizdi-cyan p-4 text-white flex justify-between items-center\">\r\n                                    <h3 className=\"font-bold text-lg flex items-center gap-2\"><IconLink className=\"w-5 h-5\" /> {createdAssignmentLink ? ' !' : '  '}</h3>\r\n                                    <button onClick={handleCloseAssignmentModal} className=\"hover:bg-white/20 p-1 rounded-full\"><IconX className=\"w-5 h-5\" /></button>\r\n                                </div>\r\n                                <div className=\"p-6 space-y-4\">\r\n                                    {createdAssignmentLink ? (\r\n                                        <>\r\n                                            <div className=\"text-center py-4\">\r\n                                                <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                                    <IconCheck className=\"w-8 h-8 text-green-600\" />\r\n                                                </div>\r\n                                                <p className=\"text-lg font-bold text-slate-700 mb-2\">  !</p>\r\n                                                <p className=\"text-sm text-slate-500\">   </p>\r\n                                            </div>\r\n                                            <div className=\"bg-slate-50 border border-slate-200 rounded-xl p-3\">\r\n                                                <label className=\"block text-xs font-bold text-slate-500 mb-2\"> :</label>\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <input\r\n                                                        type=\"text\"\r\n                                                        readOnly\r\n                                                        value={createdAssignmentLink}\r\n                                                        className=\"flex-1 bg-white border border-slate-300 rounded-lg px-3 py-2 text-sm text-slate-600 select-all\"\r\n                                                        onClick={e => (e.target as HTMLInputElement).select()}\r\n                                                    />\r\n                                                    <button\r\n                                                        onClick={handleCopyCreatedLink}\r\n                                                        className=\"px-4 py-2 bg-wizdi-royal text-white rounded-lg font-bold hover:bg-wizdi-royal/90 transition-colors flex items-center gap-1 text-sm\"\r\n                                                    >\r\n                                                        <IconCopy className=\"w-4 h-4\" /> \r\n                                                    </button>\r\n                                                </div>\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={handleCloseAssignmentModal}\r\n                                                className=\"w-full bg-slate-100 text-slate-700 py-3 rounded-xl font-bold hover:bg-slate-200 transition-colors mt-2\"\r\n                                            >\r\n                                                \r\n                                            </button>\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-wizdi-royal mb-1\">  / </label>\r\n                                                <input type=\"text\" className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:border-wizdi-cyan focus:ring-1 focus:ring-wizdi-cyan outline-none\"\r\n                                                    value={assignmentData.title} onChange={e => setAssignmentData({ ...assignmentData, title: e.target.value })}\r\n                                                    placeholder=\":    -  \"\r\n                                                />\r\n                                            </div>\r\n                                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-bold text-wizdi-royal mb-1\"> </label>\r\n                                                    <input type=\"date\" className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:border-wizdi-cyan outline-none\"\r\n                                                        value={assignmentData.dueDate} onChange={e => setAssignmentData({ ...assignmentData, dueDate: e.target.value })}\r\n                                                    />\r\n                                                </div>\r\n                                                <div>\r\n                                                    <label className=\"block text-sm font-bold text-wizdi-royal mb-1\"></label>\r\n                                                    <input type=\"time\" className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:border-wizdi-cyan outline-none\"\r\n                                                        value={assignmentData.dueTime} onChange={e => setAssignmentData({ ...assignmentData, dueTime: e.target.value })}\r\n                                                    />\r\n                                                </div>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label className=\"block text-sm font-bold text-wizdi-royal mb-1\">  ()</label>\r\n                                                <textarea className=\"w-full border border-slate-300 rounded-xl px-3 py-2 text-sm focus:border-wizdi-cyan outline-none h-20 resize-none\"\r\n                                                    value={assignmentData.instructions} onChange={e => setAssignmentData({ ...assignmentData, instructions: e.target.value })}\r\n                                                    placeholder=\" ,  , '...\"\r\n                                                />\r\n                                            </div>\r\n\r\n                                            <button onClick={handleCreateAssignment} className=\"w-full btn-lip-action py-3 flex justify-center items-center gap-2 mt-2\">\r\n                                                <IconLink className=\"w-5 h-5\" />  \r\n                                            </button>\r\n                                            <p className=\"text-xs text-center text-slate-400\">     </p>\r\n                                        </>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        , document.body)\r\n                }\r\n\r\n                {\r\n                    reportStudent && reportStudent.report && (\r\n                        <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4 backdrop-blur-sm animate-fade-in\">\r\n                            <div className=\"bg-white rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6\">\r\n                                <div className=\"flex justify-between items-center mb-6\">\r\n                                    <h3 className=\"text-xl font-bold text-wizdi-royal\"> : {reportStudent.name}</h3>\r\n                                    <button onClick={() => setReportStudent(null)}><IconX className=\"w-6 h-6 text-slate-400 hover:text-red-500\" /></button>\r\n                                </div>\r\n                                <div className=\"bg-wizdi-cloud p-4 rounded-xl text-wizdi-royal text-sm leading-relaxed mb-6\">{reportStudent.report.summary}</div>\r\n                                <button onClick={() => window.print()} className=\"w-full btn-lip-primary py-3\"> </button>\r\n                            </div>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n\r\n                {/* Insights Modal */}\r\n                {\r\n                    viewingInsightStudent && (\r\n                        <StudentInsightsModal student={viewingInsightStudent} onClose={() => setViewingInsightStudent(null)} />\r\n                    )\r\n                }\r\n\r\n                {/* Lesson Plan Viewer Modal */}\r\n                {\r\n                    viewingLessonPlan && (\r\n                        <div className=\"fixed inset-0 bg-white z-[100] animate-fade-in flex flex-col\">\r\n                            <React.Suspense fallback={<div className=\"flex-1 flex items-center justify-center text-wizdi-royal font-bold\">  ...</div>}>\r\n                                <CoursePlayer\r\n                                    reviewMode={true}\r\n                                    hideReviewHeader={true}\r\n                                    assignment={{\r\n                                        ...coursesMap[viewingLessonPlan],\r\n                                        id: viewingLessonPlan,\r\n                                        courseId: viewingLessonPlan\r\n                                    }}\r\n                                    onExitReview={() => setViewingLessonPlan(null)}\r\n                                />\r\n                            </React.Suspense>\r\n                        </div>\r\n                    )\r\n                }\r\n\r\n            </div >\r\n            {/* ---    -  1 --- */}\r\n            {\r\n                deleteConfirmation.step === 'first' && createPortal(\r\n                    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in\" dir=\"rtl\">\r\n                        <div className=\"bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-scale-in\">\r\n                            <div className=\"p-8 text-center\">\r\n                                <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600\">\r\n                                    <IconTrash className=\"w-8 h-8\" />\r\n                                </div>\r\n                                <h3 className=\"text-2xl font-black text-gray-800 mb-2\"> </h3>\r\n                                <p className=\"text-gray-500 mb-6 leading-relaxed\">\r\n                                          ?\r\n                                    <br />\r\n                                    <span className=\"font-bold text-red-500\">          .</span>\r\n                                </p>\r\n                                <div className=\"flex gap-3\">\r\n                                    <button\r\n                                        onClick={() => setDeleteConfirmation({ step: 'none', courseId: null })}\r\n                                        className=\"flex-1 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-xl transition-colors\"\r\n                                    >\r\n                                        \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setDeleteConfirmation(prev => ({ ...prev, step: 'second' }))}\r\n                                        className=\"flex-1 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg shadow-red-200 transition-colors\"\r\n                                    >\r\n                                         \r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>,\r\n                    document.body\r\n                )\r\n            }\r\n\r\n            {/* ---    -  2 () --- */}\r\n            {\r\n                deleteConfirmation.step === 'second' && createPortal(\r\n                    <div className=\"fixed inset-0 bg-red-900/80 backdrop-blur-md z-[70] flex items-center justify-center p-4 animate-fade-in\" dir=\"rtl\">\r\n                        <div className=\"bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-shake border-4 border-red-500\">\r\n                            <div className=\"p-8 text-center\">\r\n                                <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-600 border-4 border-red-50 animate-pulse\">\r\n                                    <IconTrash className=\"w-10 h-10\" />\r\n                                </div>\r\n                                <h3 className=\"text-3xl font-black text-red-600 mb-2 uppercase tracking-tight\"> !</h3>\r\n                                <p className=\"text-gray-600 mb-8 font-bold text-lg\">\r\n                                        .\r\n                                    <br />\r\n                                       .\r\n                                </p>\r\n                                <div className=\"flex gap-3 flex-col\">\r\n                                    <button\r\n                                        onClick={handleDeleteCourse}\r\n                                        className=\"w-full py-4 bg-red-600 hover:bg-red-700 text-white font-black text-xl rounded-2xl shadow-xl shadow-red-200 transition-transform transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        <IconTrash className=\"w-6 h-6\" /> ,    \r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setDeleteConfirmation({ step: 'none', courseId: null })}\r\n                                        className=\"w-full py-3 text-gray-500 font-bold hover:text-gray-800 hover:bg-gray-50 rounded-xl transition-colors\"\r\n                                    >\r\n                                        ,  \r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>,\r\n                    document.body\r\n                )\r\n            }\r\n\r\n            {/* Share Modal */}\r\n            {shareModalCourse && (\r\n                <ShareModal\r\n                    isOpen={!!shareModalCourse}\r\n                    onClose={() => setShareModalCourse(null)}\r\n                    courseId={shareModalCourse.id}\r\n                    courseTitle={shareModalCourse.title}\r\n                    initialTab=\"assign\"\r\n                />\r\n            )}\r\n\r\n            {/* Adaptive Task Detail Dashboard */}\r\n            {viewingControlCenter && (\r\n                <div className=\"fixed inset-0 z-[100] bg-slate-50 overflow-auto\">\r\n                    <React.Suspense fallback={\r\n                        <div className=\"h-full flex items-center justify-center\">\r\n                            <div className=\"text-center\">\r\n                                <AIStarsSpinner size=\"xl\" color=\"primary\" className=\"mx-auto mb-4\" />\r\n                                <p className=\"text-slate-500\">   ...</p>\r\n                            </div>\r\n                        </div>\r\n                    }>\r\n                        <TaskDetailDashboard\r\n                            courseId={viewingControlCenter}\r\n                            onBack={() => setViewingControlCenter(null)}\r\n                            onViewStudent={(studentId) => {\r\n                                // Find student and open their submission\r\n                                const student = allData.find(s => s.id === studentId);\r\n                                if (student) setViewingTestStudent(student);\r\n                            }}\r\n                            onViewLessonPlan={(courseId) => {\r\n                                setViewingControlCenter(null);\r\n                                setViewingLessonPlan(courseId);\r\n                            }}\r\n                            onEditCourse={(courseId) => {\r\n                                setViewingControlCenter(null);\r\n                                if (onEditCourse) onEditCourse(courseId);\r\n                            }}\r\n                            onCreateRemediation={(studentId, type) => {\r\n                                // TODO: Integrate with remediation unit creation\r\n                                console.log('Create remediation:', { studentId, type });\r\n                                alert(`  ${type || ''} ${studentId ? '' : ''} -  `);\r\n                            }}\r\n                        />\r\n                    </React.Suspense>\r\n                </div>\r\n            )}\r\n\r\n            {/* Usage Stats Modal */}\r\n            {showUsageModal && createPortal(\r\n                <div\r\n                    className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4 animate-fade-in\"\r\n                    dir=\"rtl\"\r\n                    onClick={() => setShowUsageModal(false)}\r\n                >\r\n                    <div\r\n                        className=\"bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden animate-scale-in\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                        <div className=\"bg-gradient-to-l from-wizdi-royal to-wizdi-cyan p-5 text-white flex justify-between items-center\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <IconChartBar className=\"w-7 h-7 opacity-90\" />\r\n                                <div>\r\n                                    <h3 className=\"text-xl font-bold\"> </h3>\r\n                                    {usageStats && (\r\n                                        <p className=\"text-sm opacity-80\">\r\n                                              {Math.ceil((new Date(usageStats.resetDate).getTime() - Date.now()) / (1000 * 60 * 60 * 24))} \r\n                                        </p>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setShowUsageModal(false)}\r\n                                className=\"hover:bg-white/20 p-2 rounded-full transition-colors\"\r\n                            >\r\n                                <IconX className=\"w-5 h-5\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"p-6\">\r\n                            {usageStats ? (\r\n                                <div className=\"space-y-5\">\r\n                                    {/* Tier Badge */}\r\n                                    <div className=\"flex justify-center\">\r\n                                        <span className={`px-4 py-1.5 rounded-full text-sm font-bold ${\r\n                                            usageStats.tier === 'free' ? 'bg-slate-100 text-slate-700' :\r\n                                            usageStats.tier === 'basic' ? 'bg-blue-100 text-blue-700' :\r\n                                            usageStats.tier === 'pro' ? 'bg-purple-100 text-purple-700' :\r\n                                            'bg-amber-100 text-amber-700'\r\n                                        }`}>\r\n                                            {usageStats.tier === 'free' ? '' :\r\n                                             usageStats.tier === 'basic' ? '' :\r\n                                             usageStats.tier === 'pro' ? '' : ''}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {/* Usage Bars */}\r\n                                    <div className=\"space-y-4\">\r\n                                        {/* Tokens */}\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <div className=\"flex items-center justify-between text-sm\">\r\n                                                <div className=\"flex items-center gap-2 text-slate-700 font-medium\">\r\n                                                    <IconBolt className=\"w-4 h-4 text-blue-500\" />\r\n                                                    <span></span>\r\n                                                </div>\r\n                                                <span className=\"text-slate-500\">\r\n                                                    {usageStats.usage.textTokens.used.toLocaleString()} / {usageStats.usage.textTokens.limit === Number.MAX_SAFE_INTEGER ? '' : usageStats.usage.textTokens.limit.toLocaleString()}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"w-full h-2.5 bg-slate-200 rounded-full overflow-hidden\">\r\n                                                <div\r\n                                                    className={`h-full rounded-full transition-all duration-300 ${\r\n                                                        usageStats.usage.textTokens.percent >= 95 ? 'bg-red-500' :\r\n                                                        usageStats.usage.textTokens.percent >= 80 ? 'bg-amber-500' : 'bg-blue-500'\r\n                                                    }`}\r\n                                                    style={{ width: `${Math.min(usageStats.usage.textTokens.percent, 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Images */}\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <div className=\"flex items-center justify-between text-sm\">\r\n                                                <div className=\"flex items-center gap-2 text-slate-700 font-medium\">\r\n                                                    <IconPhoto className=\"w-4 h-4 text-green-500\" />\r\n                                                    <span></span>\r\n                                                </div>\r\n                                                <span className=\"text-slate-500\">\r\n                                                    {usageStats.usage.images.used.toLocaleString()} / {usageStats.usage.images.limit === Number.MAX_SAFE_INTEGER ? '' : usageStats.usage.images.limit.toLocaleString()}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"w-full h-2.5 bg-slate-200 rounded-full overflow-hidden\">\r\n                                                <div\r\n                                                    className={`h-full rounded-full transition-all duration-300 ${\r\n                                                        usageStats.usage.images.percent >= 95 ? 'bg-red-500' :\r\n                                                        usageStats.usage.images.percent >= 80 ? 'bg-amber-500' : 'bg-green-500'\r\n                                                    }`}\r\n                                                    style={{ width: `${Math.min(usageStats.usage.images.percent, 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Audio */}\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <div className=\"flex items-center justify-between text-sm\">\r\n                                                <div className=\"flex items-center gap-2 text-slate-700 font-medium\">\r\n                                                    <IconMicrophone className=\"w-4 h-4 text-purple-500\" />\r\n                                                    <span> </span>\r\n                                                </div>\r\n                                                <span className=\"text-slate-500\">\r\n                                                    {usageStats.usage.audio.used.toFixed(1)} / {usageStats.usage.audio.limit === Number.MAX_SAFE_INTEGER ? '' : usageStats.usage.audio.limit.toFixed(1)}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"w-full h-2.5 bg-slate-200 rounded-full overflow-hidden\">\r\n                                                <div\r\n                                                    className={`h-full rounded-full transition-all duration-300 ${\r\n                                                        usageStats.usage.audio.percent >= 95 ? 'bg-red-500' :\r\n                                                        usageStats.usage.audio.percent >= 80 ? 'bg-amber-500' : 'bg-purple-500'\r\n                                                    }`}\r\n                                                    style={{ width: `${Math.min(usageStats.usage.audio.percent, 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Podcasts */}\r\n                                        <div className=\"space-y-1.5\">\r\n                                            <div className=\"flex items-center justify-between text-sm\">\r\n                                                <div className=\"flex items-center gap-2 text-slate-700 font-medium\">\r\n                                                    <IconBroadcast className=\"w-4 h-4 text-amber-500\" />\r\n                                                    <span></span>\r\n                                                </div>\r\n                                                <span className=\"text-slate-500\">\r\n                                                    {usageStats.usage.podcasts.used.toLocaleString()} / {usageStats.usage.podcasts.limit === Number.MAX_SAFE_INTEGER ? '' : usageStats.usage.podcasts.limit.toLocaleString()}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"w-full h-2.5 bg-slate-200 rounded-full overflow-hidden\">\r\n                                                <div\r\n                                                    className={`h-full rounded-full transition-all duration-300 ${\r\n                                                        usageStats.usage.podcasts.percent >= 95 ? 'bg-red-500' :\r\n                                                        usageStats.usage.podcasts.percent >= 80 ? 'bg-amber-500' : 'bg-amber-500'\r\n                                                    }`}\r\n                                                    style={{ width: `${Math.min(usageStats.usage.podcasts.percent, 100)}%` }}\r\n                                                />\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Warning */}\r\n                                    {(usageStats.usage.textTokens.percent >= 80 || usageStats.usage.images.percent >= 80 || usageStats.usage.audio.percent >= 80) && (\r\n                                        <div className=\"p-3 bg-amber-50 border border-amber-200 rounded-xl\">\r\n                                            <div className=\"flex items-start gap-2\">\r\n                                                <IconAlertTriangle className=\"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5\" />\r\n                                                <div>\r\n                                                    <p className=\"text-sm font-medium text-amber-800\"> </p>\r\n                                                    <p className=\"text-xs text-amber-600\">\r\n                                                            .    .\r\n                                                    </p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n\r\n                                    {/* Upgrade Button */}\r\n                                    {usageStats.tier !== 'enterprise' && (\r\n                                        <button className=\"w-full py-3 bg-gradient-to-l from-wizdi-royal to-wizdi-cyan text-white font-bold rounded-xl hover:opacity-90 transition-opacity flex items-center justify-center gap-2\">\r\n                                            <IconSparkles className=\"w-5 h-5\" />\r\n                                             \r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"animate-pulse space-y-4\">\r\n                                    <div className=\"h-6 bg-slate-200 rounded w-1/3 mx-auto\" />\r\n                                    <div className=\"h-3 bg-slate-200 rounded\" />\r\n                                    <div className=\"h-3 bg-slate-200 rounded\" />\r\n                                    <div className=\"h-3 bg-slate-200 rounded\" />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>,\r\n                document.body\r\n            )}\r\n\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default TeacherDashboard;"],"file":"assets/TeacherDashboard-NaKQzVKi.js"}