{"version":3,"file":"ExtractionReviewPage-DEUMoBsX.js","sources":["../../src/components/ExtractionReviewPage.tsx"],"sourcesContent":["// ExtractionReviewPage.tsx - Review and correct PDF text extraction\r\n// Allows admin to see original PDF pages alongside extracted text and make corrections\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { httpsCallable } from 'firebase/functions';\r\nimport { ref, getDownloadURL, uploadBytes } from 'firebase/storage';\r\nimport { functions, storage } from '../firebase';\r\nimport { useAuth } from '../context/AuthContext';\r\n\r\ninterface ExtractionReviewPage {\r\n  pageNumber: number;\r\n  extractedText: string;\r\n  verificationText?: string;\r\n  confidence: 'high' | 'medium' | 'low';\r\n  agreementScore: number;\r\n  needsReview: boolean;\r\n  correctedText?: string;\r\n  correctedBy?: string;\r\n}\r\n\r\ninterface ExtractionReview {\r\n  id: string;\r\n  documentId: string;\r\n  fileName: string;\r\n  storagePath: string;\r\n  grade: string;\r\n  volume: number;\r\n  volumeType: 'student' | 'teacher';\r\n  totalPages: number;\r\n  averageConfidence: number;\r\n  pagesNeedingReview: number[];\r\n  status: 'pending_review' | 'reviewed' | 'approved';\r\n  pages: ExtractionReviewPage[];\r\n}\r\n\r\ninterface ReviewSummary {\r\n  id: string;\r\n  fileName: string;\r\n  grade: string;\r\n  volume: number;\r\n  volumeType: string;\r\n  totalPages: number;\r\n  averageConfidence: number;\r\n  pagesNeedingReview: number[];\r\n  status: string;\r\n}\r\n\r\nexport default function ExtractionReviewPage() {\r\n  const { currentUser } = useAuth();\r\n\r\n  // List state\r\n  const [reviews, setReviews] = useState<ReviewSummary[]>([]);\r\n  const [loadingList, setLoadingList] = useState(true);\r\n  const [showPendingOnly, setShowPendingOnly] = useState(true);\r\n\r\n  // Detail state\r\n  const [selectedReview, setSelectedReview] = useState<ExtractionReview | null>(null);\r\n  const [loadingReview, setLoadingReview] = useState(false);\r\n  const [currentPageIndex, setCurrentPageIndex] = useState(0);\r\n\r\n  // PDF viewer state\r\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\r\n\r\n  // Edit state\r\n  const [editedText, setEditedText] = useState('');\r\n  const [saving, setSaving] = useState(false);\r\n  const [approving, setApproving] = useState(false);\r\n\r\n  // Error state\r\n  const [loadError, setLoadError] = useState<string | null>(null);\r\n\r\n  // PDF fix state\r\n  const [uploadingPdf, setUploadingPdf] = useState(false);\r\n\r\n  // Load reviews list\r\n  const loadReviews = useCallback(async () => {\r\n    setLoadingList(true);\r\n    setLoadError(null);\r\n    try {\r\n      console.log('ğŸ“‹ Loading extraction reviews, pendingOnly:', showPendingOnly);\r\n      const getReviewsFunc = httpsCallable(functions, 'getExtractionReviews');\r\n      const result = await getReviewsFunc({ pendingOnly: showPendingOnly });\r\n      console.log('ğŸ“‹ Raw result:', result);\r\n      const data = result.data as { reviews: ReviewSummary[] };\r\n      console.log('ğŸ“‹ Reviews loaded:', data.reviews?.length || 0);\r\n      setReviews(data.reviews || []);\r\n    } catch (error: any) {\r\n      console.error('Failed to load reviews:', error);\r\n      setLoadError(error.message || '×©×’×™××” ×œ× ×™×“×•×¢×”');\r\n    } finally {\r\n      setLoadingList(false);\r\n    }\r\n  }, [showPendingOnly]);\r\n\r\n  useEffect(() => {\r\n    loadReviews();\r\n  }, [loadReviews]);\r\n\r\n  // Load specific review\r\n  const loadReview = async (reviewId: string) => {\r\n    setLoadingReview(true);\r\n    setSelectedReview(null);\r\n    setPdfUrl(null);\r\n\r\n    try {\r\n      const getReviewFunc = httpsCallable(functions, 'getExtractionReview');\r\n      const result = await getReviewFunc({ reviewId });\r\n      const data = result.data as { review: ExtractionReview };\r\n\r\n      setSelectedReview(data.review);\r\n      setCurrentPageIndex(0);\r\n\r\n      // Set initial edited text\r\n      const firstPage = data.review.pages[0];\r\n      setEditedText(firstPage.correctedText || firstPage.extractedText);\r\n\r\n      // Load PDF URL\r\n      if (data.review.storagePath) {\r\n        try {\r\n          const storageRef = ref(storage, data.review.storagePath);\r\n          const url = await getDownloadURL(storageRef);\r\n          setPdfUrl(url);\r\n        } catch (e) {\r\n          console.error('Failed to load PDF:', e);\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Failed to load review:', error);\r\n    } finally {\r\n      setLoadingReview(false);\r\n    }\r\n  };\r\n\r\n  // Navigate pages\r\n  const goToPage = (index: number) => {\r\n    if (!selectedReview) return;\r\n    setCurrentPageIndex(index);\r\n    const page = selectedReview.pages[index];\r\n    setEditedText(page.correctedText || page.extractedText);\r\n  };\r\n\r\n  // Save correction\r\n  const saveCorrection = async () => {\r\n    if (!selectedReview) return;\r\n\r\n    const currentPage = selectedReview.pages[currentPageIndex];\r\n    if (editedText === (currentPage.correctedText || currentPage.extractedText)) {\r\n      return; // No changes\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n      const correctFunc = httpsCallable(functions, 'correctPageExtraction');\r\n      await correctFunc({\r\n        reviewId: selectedReview.id,\r\n        pageNumber: currentPage.pageNumber,\r\n        correctedText: editedText,\r\n      });\r\n\r\n      // Update local state\r\n      const updatedPages = [...selectedReview.pages];\r\n      updatedPages[currentPageIndex] = {\r\n        ...currentPage,\r\n        correctedText: editedText,\r\n        needsReview: false,\r\n      };\r\n\r\n      setSelectedReview({\r\n        ...selectedReview,\r\n        pages: updatedPages,\r\n        pagesNeedingReview: updatedPages\r\n          .filter(p => p.needsReview && !p.correctedText)\r\n          .map(p => p.pageNumber),\r\n      });\r\n\r\n    } catch (error: any) {\r\n      console.error('Failed to save correction:', error);\r\n      alert('×©×’×™××” ×‘×©××™×¨×”: ' + error.message);\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Approve review\r\n  const approveReview = async () => {\r\n    if (!selectedReview) return;\r\n\r\n    if (!window.confirm('×”×× ××ª×” ×‘×˜×•×—? ×¤×¢×•×œ×” ×–×• ×ª×¢×“×›×Ÿ ××ª ×›×œ ×”-chunks ×‘×‘×¡×™×¡ ×”×™×“×¢.')) {\r\n      return;\r\n    }\r\n\r\n    setApproving(true);\r\n    try {\r\n      const approveFunc = httpsCallable(functions, 'approveExtractionReview');\r\n      const result = await approveFunc({ reviewId: selectedReview.id });\r\n      const data = result.data as { chunksUpdated: number };\r\n\r\n      alert(`××•×©×¨ ×‘×”×¦×œ×—×”! ×¢×•×“×›× ×• ${data.chunksUpdated} ×§×˜×¢×™×.`);\r\n\r\n      // Go back to list\r\n      setSelectedReview(null);\r\n      loadReviews();\r\n    } catch (error: any) {\r\n      console.error('Failed to approve:', error);\r\n      alert('×©×’×™××” ×‘××™×©×•×¨: ' + error.message);\r\n    } finally {\r\n      setApproving(false);\r\n    }\r\n  };\r\n\r\n  // Upload PDF to fix broken path\r\n  const handleUploadPdf = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file || !selectedReview || !currentUser) return;\r\n\r\n    setUploadingPdf(true);\r\n    try {\r\n      // Upload to storage\r\n      const timestamp = Date.now();\r\n      const storagePath = `knowledge-base/${currentUser.uid}/${timestamp}_${file.name}`;\r\n      const storageRef = ref(storage, storagePath);\r\n      await uploadBytes(storageRef, file);\r\n\r\n      // Update review with new path\r\n      const updateFunc = httpsCallable(functions, 'updateReviewStoragePath');\r\n      await updateFunc({\r\n        reviewId: selectedReview.id,\r\n        storagePath,\r\n      });\r\n\r\n      // Reload PDF\r\n      const url = await getDownloadURL(storageRef);\r\n      setPdfUrl(url);\r\n\r\n      alert('PDF ×”×•×¢×œ×” ×‘×”×¦×œ×—×”!');\r\n    } catch (error: any) {\r\n      console.error('Failed to upload PDF:', error);\r\n      alert('×©×’×™××” ×‘×”×¢×œ××ª PDF: ' + error.message);\r\n    } finally {\r\n      setUploadingPdf(false);\r\n    }\r\n  };\r\n\r\n  // Get confidence color\r\n  const getConfidenceColor = (confidence: string) => {\r\n    switch (confidence) {\r\n      case 'high': return 'bg-green-100 text-green-800';\r\n      case 'medium': return 'bg-yellow-100 text-yellow-800';\r\n      case 'low': return 'bg-red-100 text-red-800';\r\n      default: return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  // Render list view\r\n  if (!selectedReview) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 p-6\" dir=\"rtl\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">×¡×§×™×¨×ª ×—×™×œ×•×¥ ×˜×§×¡×˜</h1>\r\n            <p className=\"text-gray-600\">×‘×“×•×§ ×•×ª×§×Ÿ ×˜×§×¡×˜ ×©×—×•×œ×¥ ××¡×¤×¨×™×</p>\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <div className=\"mb-4 flex items-center gap-4\">\r\n            <label className=\"flex items-center gap-2\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={showPendingOnly}\r\n                onChange={(e) => setShowPendingOnly(e.target.checked)}\r\n                className=\"rounded\"\r\n              />\r\n              <span className=\"text-sm\">×”×¦×’ ×¨×§ ×××ª×™× ×™× ×œ×¡×§×™×¨×”</span>\r\n            </label>\r\n            <button\r\n              onClick={loadReviews}\r\n              className=\"text-blue-600 hover:text-blue-800 text-sm\"\r\n            >\r\n              ×¨×¢× ×Ÿ\r\n            </button>\r\n          </div>\r\n\r\n          {/* Reviews List */}\r\n          {loadingList ? (\r\n            <div className=\"text-center py-8 text-gray-500\">×˜×•×¢×Ÿ...</div>\r\n          ) : loadError ? (\r\n            <div className=\"text-center py-8 text-red-600 bg-red-50 rounded-lg\">\r\n              <p className=\"font-medium\">×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×§×™×¨×•×ª:</p>\r\n              <p className=\"text-sm mt-2\">{loadError}</p>\r\n              <button\r\n                onClick={loadReviews}\r\n                className=\"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700\"\r\n              >\r\n                × ×¡×” ×©×•×‘\r\n              </button>\r\n            </div>\r\n          ) : reviews.length === 0 ? (\r\n            <div className=\"text-center py-8 text-gray-500\">\r\n              {showPendingOnly ? '××™×Ÿ ×¡×§×™×¨×•×ª ×××ª×™× ×•×ª' : '××™×Ÿ ×¡×§×™×¨×•×ª'}\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-white rounded-lg shadow\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×¡×¤×¨</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×¢××•×“×™×</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×•×“××•×ª</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×œ×‘×“×™×§×”</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×¡×˜×˜×•×¡</th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase\">×¤×¢×•×œ×•×ª</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {reviews.map((review) => (\r\n                    <tr key={review.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"font-medium text-gray-900\">\r\n                          {review.volumeType === 'teacher' ? '××“×¨×™×š ×œ××•×¨×”' : '×¡×¤×¨ ×ª×œ××™×“'}\r\n                        </div>\r\n                        <div className=\"text-sm text-gray-500\">\r\n                          ×›×™×ª×” {review.grade}' ×›×¨×š {review.volume}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                        {review.totalPages}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"w-16 h-2 bg-gray-200 rounded-full overflow-hidden\">\r\n                            <div\r\n                              className={`h-full rounded-full ${\r\n                                review.averageConfidence >= 0.9 ? 'bg-green-500' :\r\n                                review.averageConfidence >= 0.8 ? 'bg-yellow-500' : 'bg-red-500'\r\n                              }`}\r\n                              style={{ width: `${review.averageConfidence * 100}%` }}\r\n                            />\r\n                          </div>\r\n                          <span className=\"text-sm text-gray-600\">\r\n                            {(review.averageConfidence * 100).toFixed(0)}%\r\n                          </span>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        {review.pagesNeedingReview.length > 0 ? (\r\n                          <span className=\"text-sm text-red-600 font-medium\">\r\n                            {review.pagesNeedingReview.length} ×¢××•×“×™×\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"text-sm text-green-600\">×ª×§×™×Ÿ</span>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <span className={`px-2 py-1 text-xs rounded-full ${\r\n                          review.status === 'approved' ? 'bg-green-100 text-green-800' :\r\n                          review.status === 'reviewed' ? 'bg-blue-100 text-blue-800' :\r\n                          'bg-yellow-100 text-yellow-800'\r\n                        }`}>\r\n                          {review.status === 'approved' ? '××•×©×¨' :\r\n                           review.status === 'reviewed' ? '× ×‘×“×§' : '×××ª×™×Ÿ'}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <button\r\n                          onClick={() => loadReview(review.id)}\r\n                          className=\"text-blue-600 hover:text-blue-800 font-medium\"\r\n                        >\r\n                          ×¤×ª×—\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Render review detail view\r\n  const currentPage = selectedReview.pages[currentPageIndex];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100\" dir=\"rtl\">\r\n      {/* Header */}\r\n      <div className=\"bg-white border-b px-6 py-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <button\r\n              onClick={() => setSelectedReview(null)}\r\n              className=\"text-gray-500 hover:text-gray-700\"\r\n            >\r\n              â† ×—×–×¨×”\r\n            </button>\r\n            <div>\r\n              <h1 className=\"text-lg font-bold\">\r\n                {selectedReview.volumeType === 'teacher' ? '××“×¨×™×š ×œ××•×¨×”' : '×¡×¤×¨ ×ª×œ××™×“'} -\r\n                ×›×™×ª×” {selectedReview.grade}' ×›×¨×š {selectedReview.volume}\r\n              </h1>\r\n              <p className=\"text-sm text-gray-500\">{selectedReview.fileName}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-4\">\r\n            <span className=\"text-sm text-gray-500\">\r\n              ×•×“××•×ª ×××•×¦×¢×ª: {(selectedReview.averageConfidence * 100).toFixed(1)}%\r\n            </span>\r\n            <button\r\n              onClick={approveReview}\r\n              disabled={approving}\r\n              className=\"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-400\"\r\n            >\r\n              {approving ? '×××©×¨...' : '××©×¨ ×•×¢×“×›×Ÿ chunks'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main content */}\r\n      <div className=\"flex h-[calc(100vh-80px)]\">\r\n        {/* PDF Viewer (Left side) */}\r\n        <div className=\"w-1/2 bg-gray-800 p-4 overflow-auto\">\r\n          {pdfUrl ? (\r\n            <iframe\r\n              src={`${pdfUrl}#page=${currentPage.pageNumber}`}\r\n              className=\"w-full h-full bg-white rounded\"\r\n              title=\"PDF Viewer\"\r\n            />\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center h-full text-gray-400 gap-4\">\r\n              <p>×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ PDF</p>\r\n              <p className=\"text-sm\">×§×•×‘×¥ ×”-PDF ×œ× × ××¦×. × ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ××ª ×”×§×•×‘×¥:</p>\r\n              <label className={`px-4 py-2 rounded-md cursor-pointer ${\r\n                uploadingPdf\r\n                  ? 'bg-gray-500 cursor-not-allowed'\r\n                  : 'bg-blue-600 hover:bg-blue-700 text-white'\r\n              }`}>\r\n                {uploadingPdf ? '××¢×œ×”...' : 'ğŸ“ ×”×¢×œ×” PDF'}\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\".pdf\"\r\n                  onChange={handleUploadPdf}\r\n                  disabled={uploadingPdf}\r\n                  className=\"hidden\"\r\n                />\r\n              </label>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Text Editor (Right side) */}\r\n        <div className=\"w-1/2 flex flex-col\">\r\n          {/* Page navigation */}\r\n          <div className=\"bg-white border-b px-4 py-3 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <button\r\n                onClick={() => goToPage(currentPageIndex - 1)}\r\n                disabled={currentPageIndex === 0}\r\n                className=\"px-3 py-1 border rounded disabled:opacity-50\"\r\n              >\r\n                â† ×”×§×•×“×\r\n              </button>\r\n\r\n              <span className=\"px-4 font-medium\">\r\n                ×¢××•×“ {currentPage.pageNumber} ××ª×•×š {selectedReview.totalPages}\r\n              </span>\r\n\r\n              <button\r\n                onClick={() => goToPage(currentPageIndex + 1)}\r\n                disabled={currentPageIndex === selectedReview.pages.length - 1}\r\n                className=\"px-3 py-1 border rounded disabled:opacity-50\"\r\n              >\r\n                ×”×‘× â†’\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-4\">\r\n              <span className={`px-2 py-1 text-xs rounded ${getConfidenceColor(currentPage.confidence)}`}>\r\n                {currentPage.confidence === 'high' ? '×•×“××•×ª ×’×‘×•×”×”' :\r\n                 currentPage.confidence === 'medium' ? '×•×“××•×ª ×‘×™× ×•× ×™×ª' : '×•×“××•×ª × ××•×›×”'}\r\n                ({(currentPage.agreementScore * 100).toFixed(0)}%)\r\n              </span>\r\n\r\n              {currentPage.correctedText && (\r\n                <span className=\"text-xs text-green-600\">âœ“ ×ª×•×§×Ÿ</span>\r\n              )}\r\n\r\n              {currentPage.needsReview && !currentPage.correctedText && (\r\n                <span className=\"text-xs text-red-600\">âš ï¸ ×“×•×¨×© ×‘×“×™×§×”</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Page thumbnails */}\r\n          <div className=\"bg-gray-100 px-4 py-2 overflow-x-auto flex gap-2\">\r\n            {selectedReview.pages.map((page, idx) => (\r\n              <button\r\n                key={page.pageNumber}\r\n                onClick={() => goToPage(idx)}\r\n                className={`flex-shrink-0 w-10 h-10 rounded text-xs font-medium ${\r\n                  idx === currentPageIndex\r\n                    ? 'bg-blue-600 text-white'\r\n                    : page.correctedText\r\n                    ? 'bg-green-100 text-green-800 border border-green-300'\r\n                    : page.needsReview\r\n                    ? 'bg-red-100 text-red-800 border border-red-300'\r\n                    : 'bg-white text-gray-700 border border-gray-300'\r\n                }`}\r\n              >\r\n                {page.pageNumber}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Text editor */}\r\n          <div className=\"flex-1 p-4 overflow-auto\">\r\n            <textarea\r\n              value={editedText}\r\n              onChange={(e) => setEditedText(e.target.value)}\r\n              className=\"w-full h-full p-4 border rounded-lg resize-none font-mono text-sm leading-relaxed\"\r\n              placeholder=\"×˜×§×¡×˜ ××—×•×œ×¥...\"\r\n              dir=\"rtl\"\r\n            />\r\n          </div>\r\n\r\n          {/* Save button */}\r\n          <div className=\"bg-white border-t px-4 py-3 flex justify-between items-center\">\r\n            <div className=\"text-sm text-gray-500\">\r\n              {editedText !== (currentPage.correctedText || currentPage.extractedText)\r\n                ? '×™×© ×©×™× ×•×™×™× ×©×œ× × ×©××¨×•'\r\n                : ''}\r\n            </div>\r\n            <button\r\n              onClick={saveCorrection}\r\n              disabled={saving || editedText === (currentPage.correctedText || currentPage.extractedText)}\r\n              className=\"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400\"\r\n            >\r\n              {saving ? '×©×•××¨...' : '×©××•×¨ ×ª×™×§×•×Ÿ'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ExtractionReviewPage","currentUser","useAuth","reviews","setReviews","useState","loadingList","setLoadingList","showPendingOnly","setShowPendingOnly","selectedReview","setSelectedReview","loadingReview","setLoadingReview","currentPageIndex","setCurrentPageIndex","pdfUrl","setPdfUrl","editedText","setEditedText","saving","setSaving","approving","setApproving","loadError","setLoadError","uploadingPdf","setUploadingPdf","loadReviews","useCallback","result","httpsCallable","functions","data","_a","error","useEffect","loadReview","reviewId","firstPage","storageRef","ref","storage","url","getDownloadURL","e","goToPage","index","page","saveCorrection","currentPage","updatedPages","p","approveReview","handleUploadPdf","event","file","timestamp","storagePath","uploadBytes","getConfidenceColor","confidence","jsx","jsxs","review","idx"],"mappings":"iGA+CA,SAAwBA,GAAuB,CAC7C,KAAM,CAAE,YAAAC,CAAA,EAAgBC,EAAA,EAGlB,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAA0B,CAAA,CAAE,EACpD,CAACC,EAAaC,CAAc,EAAIF,EAAAA,SAAS,EAAI,EAC7C,CAACG,EAAiBC,CAAkB,EAAIJ,EAAAA,SAAS,EAAI,EAGrD,CAACK,EAAgBC,CAAiB,EAAIN,EAAAA,SAAkC,IAAI,EAC5E,CAACO,EAAeC,CAAgB,EAAIR,EAAAA,SAAS,EAAK,EAClD,CAACS,EAAkBC,CAAmB,EAAIV,EAAAA,SAAS,CAAC,EAGpD,CAACW,EAAQC,CAAS,EAAIZ,EAAAA,SAAwB,IAAI,EAGlD,CAACa,EAAYC,CAAa,EAAId,EAAAA,SAAS,EAAE,EACzC,CAACe,EAAQC,CAAS,EAAIhB,EAAAA,SAAS,EAAK,EACpC,CAACiB,EAAWC,CAAY,EAAIlB,EAAAA,SAAS,EAAK,EAG1C,CAACmB,EAAWC,CAAY,EAAIpB,EAAAA,SAAwB,IAAI,EAGxD,CAACqB,EAAcC,CAAe,EAAItB,EAAAA,SAAS,EAAK,EAGhDuB,EAAcC,EAAAA,YAAY,SAAY,OAC1CtB,EAAe,EAAI,EACnBkB,EAAa,IAAI,EACjB,GAAI,CACF,QAAQ,IAAI,8CAA+CjB,CAAe,EAE1E,MAAMsB,EAAS,MADQC,EAAcC,EAAW,sBAAsB,EAClC,CAAE,YAAaxB,EAAiB,EACpE,QAAQ,IAAI,iBAAkBsB,CAAM,EACpC,MAAMG,EAAOH,EAAO,KACpB,QAAQ,IAAI,uBAAsBI,EAAAD,EAAK,UAAL,YAAAC,EAAc,SAAU,CAAC,EAC3D9B,EAAW6B,EAAK,SAAW,EAAE,CAC/B,OAASE,EAAY,CACnB,QAAQ,MAAM,0BAA2BA,CAAK,EAC9CV,EAAaU,EAAM,SAAW,gBAAgB,CAChD,QAAA,CACE5B,EAAe,EAAK,CACtB,CACF,EAAG,CAACC,CAAe,CAAC,EAEpB4B,EAAAA,UAAU,IAAM,CACdR,EAAA,CACF,EAAG,CAACA,CAAW,CAAC,EAGhB,MAAMS,EAAa,MAAOC,GAAqB,CAC7CzB,EAAiB,EAAI,EACrBF,EAAkB,IAAI,EACtBM,EAAU,IAAI,EAEd,GAAI,CAGF,MAAMgB,GADS,MADOF,EAAcC,EAAW,qBAAqB,EACjC,CAAE,SAAAM,EAAU,GAC3B,KAEpB3B,EAAkBsB,EAAK,MAAM,EAC7BlB,EAAoB,CAAC,EAGrB,MAAMwB,EAAYN,EAAK,OAAO,MAAM,CAAC,EAIrC,GAHAd,EAAcoB,EAAU,eAAiBA,EAAU,aAAa,EAG5DN,EAAK,OAAO,YACd,GAAI,CACF,MAAMO,EAAaC,EAAIC,EAAST,EAAK,OAAO,WAAW,EACjDU,EAAM,MAAMC,EAAeJ,CAAU,EAC3CvB,EAAU0B,CAAG,CACf,OAASE,EAAG,CACV,QAAQ,MAAM,sBAAuBA,CAAC,CACxC,CAEJ,OAASV,EAAY,CACnB,QAAQ,MAAM,yBAA0BA,CAAK,CAC/C,QAAA,CACEtB,EAAiB,EAAK,CACxB,CACF,EAGMiC,EAAYC,GAAkB,CAClC,GAAI,CAACrC,EAAgB,OACrBK,EAAoBgC,CAAK,EACzB,MAAMC,EAAOtC,EAAe,MAAMqC,CAAK,EACvC5B,EAAc6B,EAAK,eAAiBA,EAAK,aAAa,CACxD,EAGMC,EAAiB,SAAY,CACjC,GAAI,CAACvC,EAAgB,OAErB,MAAMwC,EAAcxC,EAAe,MAAMI,CAAgB,EACzD,GAAII,KAAgBgC,EAAY,eAAiBA,EAAY,eAI7D,CAAA7B,EAAU,EAAI,EACd,GAAI,CAEF,MADoBU,EAAcC,EAAW,uBAAuB,EAClD,CAChB,SAAUtB,EAAe,GACzB,WAAYwC,EAAY,WACxB,cAAehC,CAAA,CAChB,EAGD,MAAMiC,EAAe,CAAC,GAAGzC,EAAe,KAAK,EAC7CyC,EAAarC,CAAgB,EAAI,CAC/B,GAAGoC,EACH,cAAehC,EACf,YAAa,EAAA,EAGfP,EAAkB,CAChB,GAAGD,EACH,MAAOyC,EACP,mBAAoBA,EACjB,OAAOC,GAAKA,EAAE,aAAe,CAACA,EAAE,aAAa,EAC7C,IAAIA,GAAKA,EAAE,UAAU,CAAA,CACzB,CAEH,OAASjB,EAAY,CACnB,QAAQ,MAAM,6BAA8BA,CAAK,EACjD,MAAM,iBAAmBA,EAAM,OAAO,CACxC,QAAA,CACEd,EAAU,EAAK,CACjB,EACF,EAGMgC,EAAgB,SAAY,CAChC,GAAK3C,GAEA,OAAO,QAAQ,yDAAyD,EAI7E,CAAAa,EAAa,EAAI,EACjB,GAAI,CAGF,MAAMU,GADS,MADKF,EAAcC,EAAW,yBAAyB,EACrC,CAAE,SAAUtB,EAAe,GAAI,GAC5C,KAEpB,MAAM,uBAAuBuB,EAAK,aAAa,SAAS,EAGxDtB,EAAkB,IAAI,EACtBiB,EAAA,CACF,OAASO,EAAY,CACnB,QAAQ,MAAM,qBAAsBA,CAAK,EACzC,MAAM,iBAAmBA,EAAM,OAAO,CACxC,QAAA,CACEZ,EAAa,EAAK,CACpB,EACF,EAGM+B,EAAkB,MAAOC,GAA+C,OAC5E,MAAMC,GAAOtB,EAAAqB,EAAM,OAAO,QAAb,YAAArB,EAAqB,GAClC,GAAI,GAACsB,GAAQ,CAAC9C,GAAkB,CAACT,GAEjC,CAAA0B,EAAgB,EAAI,EACpB,GAAI,CAEF,MAAM8B,EAAY,KAAK,IAAA,EACjBC,EAAc,kBAAkBzD,EAAY,GAAG,IAAIwD,CAAS,IAAID,EAAK,IAAI,GACzEhB,EAAaC,EAAIC,EAASgB,CAAW,EAC3C,MAAMC,EAAYnB,EAAYgB,CAAI,EAIlC,MADmBzB,EAAcC,EAAW,yBAAyB,EACpD,CACf,SAAUtB,EAAe,GACzB,YAAAgD,CAAA,CACD,EAGD,MAAMf,EAAM,MAAMC,EAAeJ,CAAU,EAC3CvB,EAAU0B,CAAG,EAEb,MAAM,mBAAmB,CAC3B,OAASR,EAAY,CACnB,QAAQ,MAAM,wBAAyBA,CAAK,EAC5C,MAAM,qBAAuBA,EAAM,OAAO,CAC5C,QAAA,CACER,EAAgB,EAAK,CACvB,EACF,EAGMiC,EAAsBC,GAAuB,CACjD,OAAQA,EAAA,CACN,IAAK,OAAQ,MAAO,8BACpB,IAAK,SAAU,MAAO,gCACtB,IAAK,MAAO,MAAO,0BACnB,QAAS,MAAO,2BAAA,CAEpB,EAGA,GAAI,CAACnD,EACH,OACEoD,EAAAA,IAAC,OAAI,UAAU,8BAA8B,IAAI,MAC/C,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,OACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,mCAAmC,SAAA,mBAAgB,EACjEA,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,6BAAA,CAA2B,CAAA,EAC1D,EAGAC,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAA,EAAAA,KAAC,QAAA,CAAM,UAAU,0BACf,SAAA,CAAAD,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,QAAStD,EACT,SAAWqC,GAAMpC,EAAmBoC,EAAE,OAAO,OAAO,EACpD,UAAU,SAAA,CAAA,EAEZiB,EAAAA,IAAC,OAAA,CAAK,UAAU,UAAU,SAAA,uBAAA,CAAqB,CAAA,EACjD,EACAA,EAAAA,IAAC,SAAA,CACC,QAASlC,EACT,UAAU,4CACX,SAAA,MAAA,CAAA,CAED,EACF,EAGCtB,EACCwD,EAAAA,IAAC,MAAA,CAAI,UAAU,iCAAiC,SAAA,SAAA,CAAO,EACrDtC,EACFuC,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACb,SAAA,CAAAD,EAAAA,IAAC,IAAA,CAAE,UAAU,cAAc,SAAA,uBAAoB,EAC/CA,EAAAA,IAAC,IAAA,CAAE,UAAU,eAAgB,SAAAtC,EAAU,EACvCsC,EAAAA,IAAC,SAAA,CACC,QAASlC,EACT,UAAU,gEACX,SAAA,SAAA,CAAA,CAED,CAAA,CACF,EACEzB,EAAQ,SAAW,EACrB2D,EAAAA,IAAC,MAAA,CAAI,UAAU,iCACZ,SAAAtD,EAAkB,qBAAuB,YAAA,CAC5C,QAEC,MAAA,CAAI,UAAU,6BACb,SAAAuD,EAAAA,KAAC,QAAA,CAAM,UAAU,sCACf,SAAA,CAAAD,MAAC,QAAA,CAAM,UAAU,aACf,SAAAC,EAAAA,KAAC,KAAA,CACC,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,MAAG,EACpFA,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,SAAM,EACvFA,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,QAAK,EACtFA,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,SAAM,EACvFA,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,QAAK,EACtFA,EAAAA,IAAC,KAAA,CAAG,UAAU,mEAAmE,SAAA,QAAA,CAAM,CAAA,CAAA,CACzF,CAAA,CACF,EACAA,EAAAA,IAAC,QAAA,CAAM,UAAU,oCACd,SAAA3D,EAAQ,IAAK6D,GACZD,EAAAA,KAAC,KAAA,CAAmB,UAAU,mBAC5B,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,8BACZ,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,4BACZ,WAAO,aAAe,UAAY,cAAgB,WAAA,CACrD,EACAC,EAAAA,KAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,CAAA,QAC/BC,EAAO,MAAM,SAAOA,EAAO,MAAA,CAAA,CACnC,CAAA,EACF,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,oDACX,WAAO,WACV,QACC,KAAA,CAAG,UAAU,8BACZ,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAW,uBACTE,EAAO,mBAAqB,GAAM,eAClCA,EAAO,mBAAqB,GAAM,gBAAkB,YACtD,GACA,MAAO,CAAE,MAAO,GAAGA,EAAO,kBAAoB,GAAG,GAAA,CAAI,CAAA,EAEzD,EACAD,EAAAA,KAAC,OAAA,CAAK,UAAU,wBACZ,SAAA,EAAAC,EAAO,kBAAoB,KAAK,QAAQ,CAAC,EAAE,GAAA,CAAA,CAC/C,CAAA,CAAA,CACF,CAAA,CACF,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,8BACX,SAAAE,EAAO,mBAAmB,OAAS,EAClCD,EAAAA,KAAC,OAAA,CAAK,UAAU,mCACb,SAAA,CAAAC,EAAO,mBAAmB,OAAO,SAAA,EACpC,EAEAF,MAAC,OAAA,CAAK,UAAU,yBAAyB,gBAAI,EAEjD,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,8BACZ,SAAAA,EAAAA,IAAC,OAAA,CAAK,UAAW,kCACfE,EAAO,SAAW,WAAa,8BAC/BA,EAAO,SAAW,WAAa,4BAC/B,+BACF,GACG,SAAAA,EAAO,SAAW,WAAa,OAC/BA,EAAO,SAAW,WAAa,OAAS,OAAA,CAC3C,EACF,EACAF,EAAAA,IAAC,KAAA,CAAG,UAAU,8BACZ,SAAAA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMzB,EAAW2B,EAAO,EAAE,EACnC,UAAU,gDACX,SAAA,KAAA,CAAA,CAED,CACF,CAAA,GAtDOA,EAAO,EAuDhB,CACD,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,EAKJ,MAAMd,EAAcxC,EAAe,MAAMI,CAAgB,EAEzD,OACEiD,EAAAA,KAAC,MAAA,CAAI,UAAU,2BAA2B,IAAI,MAE5C,SAAA,CAAAD,EAAAA,IAAC,OAAI,UAAU,8BACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMnD,EAAkB,IAAI,EACrC,UAAU,oCACX,SAAA,QAAA,CAAA,SAGA,MAAA,CACC,SAAA,CAAAoD,EAAAA,KAAC,KAAA,CAAG,UAAU,oBACX,SAAA,CAAArD,EAAe,aAAe,UAAY,cAAgB,YAAY,WACjEA,EAAe,MAAM,SAAOA,EAAe,MAAA,EACnD,EACAoD,EAAAA,IAAC,IAAA,CAAE,UAAU,wBAAyB,WAAe,QAAA,CAAS,CAAA,CAAA,CAChE,CAAA,EACF,EAEAC,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAU,wBAAwB,SAAA,CAAA,kBACtBrD,EAAe,kBAAoB,KAAK,QAAQ,CAAC,EAAE,GAAA,EACrE,EACAoD,EAAAA,IAAC,SAAA,CACC,QAAST,EACT,SAAU/B,EACV,UAAU,uFAET,WAAY,UAAY,kBAAA,CAAA,CAC3B,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAGAyC,EAAAA,KAAC,MAAA,CAAI,UAAU,4BAEb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,sCACZ,SAAA9C,EACC8C,EAAAA,IAAC,SAAA,CACC,IAAK,GAAG9C,CAAM,SAASkC,EAAY,UAAU,GAC7C,UAAU,iCACV,MAAM,YAAA,CAAA,EAGRa,EAAAA,KAAC,MAAA,CAAI,UAAU,uEACb,SAAA,CAAAD,EAAAA,IAAC,KAAE,SAAA,mBAAA,CAAiB,EACpBA,EAAAA,IAAC,IAAA,CAAE,UAAU,UAAU,SAAA,4CAAyC,SAC/D,QAAA,CAAM,UAAW,uCAChBpC,EACI,iCACA,0CACN,GACG,SAAA,CAAAA,EAAe,UAAY,cAC5BoC,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,OAAO,OACP,SAAUR,EACV,SAAU5B,EACV,UAAU,QAAA,CAAA,CACZ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAEJ,EAGAqC,EAAAA,KAAC,MAAA,CAAI,UAAU,sBAEb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,gEACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhB,EAAShC,EAAmB,CAAC,EAC5C,SAAUA,IAAqB,EAC/B,UAAU,+CACX,SAAA,SAAA,CAAA,EAIDiD,EAAAA,KAAC,OAAA,CAAK,UAAU,mBAAmB,SAAA,CAAA,QAC3Bb,EAAY,WAAW,SAAOxC,EAAe,UAAA,EACrD,EAEAoD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMhB,EAAShC,EAAmB,CAAC,EAC5C,SAAUA,IAAqBJ,EAAe,MAAM,OAAS,EAC7D,UAAU,+CACX,SAAA,OAAA,CAAA,CAED,EACF,EAEAqD,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,QAAK,UAAW,6BAA6BH,EAAmBV,EAAY,UAAU,CAAC,GACrF,SAAA,CAAAA,EAAY,aAAe,OAAS,cACpCA,EAAY,aAAe,SAAW,gBAAkB,cAAc,KACpEA,EAAY,eAAiB,KAAK,QAAQ,CAAC,EAAE,IAAA,EAClD,EAECA,EAAY,eACXY,EAAAA,IAAC,OAAA,CAAK,UAAU,yBAAyB,SAAA,SAAM,EAGhDZ,EAAY,aAAe,CAACA,EAAY,eACvCY,EAAAA,IAAC,OAAA,CAAK,UAAU,uBAAuB,SAAA,eAAA,CAAa,CAAA,CAAA,CAExD,CAAA,EACF,EAGAA,EAAAA,IAAC,OAAI,UAAU,mDACZ,WAAe,MAAM,IAAI,CAACd,EAAMiB,IAC/BH,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMhB,EAASmB,CAAG,EAC3B,UAAW,uDACTA,IAAQnD,EACJ,yBACAkC,EAAK,cACL,sDACAA,EAAK,YACL,gDACA,+CACN,GAEC,SAAAA,EAAK,UAAA,EAZDA,EAAK,UAAA,CAcb,EACH,EAGAc,EAAAA,IAAC,MAAA,CAAI,UAAU,2BACb,SAAAA,EAAAA,IAAC,WAAA,CACC,MAAO5C,EACP,SAAW2B,GAAM1B,EAAc0B,EAAE,OAAO,KAAK,EAC7C,UAAU,oFACV,YAAY,gBACZ,IAAI,KAAA,CAAA,EAER,EAGAkB,EAAAA,KAAC,MAAA,CAAI,UAAU,gEACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,wBACZ,SAAA5C,KAAgBgC,EAAY,eAAiBA,EAAY,eACtD,uBACA,EAAA,CACN,EACAY,EAAAA,IAAC,SAAA,CACC,QAASb,EACT,SAAU7B,GAAUF,KAAgBgC,EAAY,eAAiBA,EAAY,eAC7E,UAAU,qFAET,WAAS,UAAY,YAAA,CAAA,CACxB,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAEJ"}