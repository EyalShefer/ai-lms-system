const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CoursePlayer-Bq7ZKb2I.js","assets/CoursePlayer-Fd0xVSp_.css","assets/SendActivitiesModal-B0HEUCEv.js","assets/IconCopy-BTB5ujr3.js","assets/IconMail-BDnpP6ds.js","assets/HomePageRedesignMobile-BfUQLeUG.js","assets/IconWand-BbKpjbTr.js","assets/IconPlus-h8B_XGoY.js","assets/IconHome-4CYExOvd.js","assets/StudentHomeMobile-DwRh8Vxq.js","assets/CourseEditor-DgLQTIpt.js","assets/multimodalService-BOWYif01.js","assets/imagenService-D9X-XJ8a.js","assets/IconTrash-CoaUmbon.js","assets/IconBrain-B9doffEc.js","assets/IngestionWizard-C4rhXKDf.js","assets/IconLoader-C6Kee0ah.js","assets/ShareModal-DLbWhIEc.js","assets/IconCalendar-DSCrS-DW.js","assets/IconUsers-Br9myKfl.js","assets/TeacherDashboard-NaKQzVKi.js","assets/IconChartBar-C9Gh53Hd.js","assets/IconTrendingUp-i0z6cZ8R.js","assets/PedagogicalInsights-CgB1JRC6.js","assets/pedagogicalTelemetry-DR_rp4p-.js","assets/AdaptiveDashboard-fDA1_U-J.js","assets/analyticsService-CDbP7cGH.js","assets/IconActivity-BxB4o3hw.js","assets/TeacherControlCenter-D8q0RWs-.js","assets/IconArrowRight-j5ND1Yvb.js","assets/IconTrendingDown-CUFgg3Ua.js","assets/PromptsLibrary-ClpZ_wwd.js","assets/IconUser-D5NvVB3k.js","assets/IconChevronDown-BNmdE9By.js","assets/IconChevronUp-CahN5a1t.js","assets/IconSearch-CbVRN7gy.js","assets/IconFilter-DfFt1YBi.js","assets/QADashboard-BkCVd0t5.js","assets/TeachingAgentsLibrary-BSCv6770.js","assets/IconMessageCircle-CLkSXjte.js","assets/UsageDashboard-vI6NjYLJ.js","assets/GenerationSpeedAnalytics-CHWIbMga.js"])))=>i.map(i=>d[i]);
var hZ=Object.defineProperty;var VM=n=>{throw TypeError(n)};var fZ=(n,e,t)=>e in n?hZ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ct=(n,e,t)=>fZ(n,typeof e!="symbol"?e+"":e,t),qS=(n,e,t)=>e.has(n)||VM("Cannot "+t);var m=(n,e,t)=>(qS(n,e,"read from private field"),t?t.call(n):e.get(n)),z=(n,e,t)=>e.has(n)?VM("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),L=(n,e,t,r)=>(qS(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),B=(n,e,t)=>(qS(n,e,"access private method"),t);var Pi=(n,e,t,r)=>({set _(s){L(n,e,s,t)},get _(){return m(n,e,r)}});function pZ(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Pk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Kz={exports:{}},i3={},Yz={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bw=Symbol.for("react.element"),mZ=Symbol.for("react.portal"),gZ=Symbol.for("react.fragment"),yZ=Symbol.for("react.strict_mode"),xZ=Symbol.for("react.profiler"),bZ=Symbol.for("react.provider"),vZ=Symbol.for("react.context"),wZ=Symbol.for("react.forward_ref"),kZ=Symbol.for("react.suspense"),_Z=Symbol.for("react.memo"),SZ=Symbol.for("react.lazy"),UM=Symbol.iterator;function TZ(n){return n===null||typeof n!="object"?null:(n=UM&&n[UM]||n["@@iterator"],typeof n=="function"?n:null)}var Xz={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jz=Object.assign,Qz={};function H1(n,e,t){this.props=n,this.context=e,this.refs=Qz,this.updater=t||Xz}H1.prototype.isReactComponent={};H1.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};H1.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Zz(){}Zz.prototype=H1.prototype;function xI(n,e,t){this.props=n,this.context=e,this.refs=Qz,this.updater=t||Xz}var bI=xI.prototype=new Zz;bI.constructor=xI;Jz(bI,H1.prototype);bI.isPureReactComponent=!0;var HM=Array.isArray,eB=Object.prototype.hasOwnProperty,vI={current:null},tB={key:!0,ref:!0,__self:!0,__source:!0};function nB(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)eB.call(e,r)&&!tB.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:bw,type:n,key:i,ref:o,props:s,_owner:vI.current}}function AZ(n,e){return{$$typeof:bw,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function wI(n){return typeof n=="object"&&n!==null&&n.$$typeof===bw}function EZ(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var qM=/\/+/g;function GS(n,e){return typeof n=="object"&&n!==null&&n.key!=null?EZ(""+n.key):e.toString(36)}function _4(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case bw:case mZ:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+GS(o,0):r,HM(s)?(t="",n!=null&&(t=n.replace(qM,"$&/")+"/"),_4(s,e,t,"",function(c){return c})):s!=null&&(wI(s)&&(s=AZ(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(qM,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",HM(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+GS(i,a);o+=_4(i,e,t,l,s)}else if(l=TZ(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+GS(i,a++),o+=_4(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function x2(n,e,t){if(n==null)return n;var r=[],s=0;return _4(n,r,"","",function(i){return e.call(t,i,s++)}),r}function CZ(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var io={current:null},S4={transition:null},NZ={ReactCurrentDispatcher:io,ReactCurrentBatchConfig:S4,ReactCurrentOwner:vI};function rB(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:x2,forEach:function(n,e,t){x2(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return x2(n,function(){e++}),e},toArray:function(n){return x2(n,function(e){return e})||[]},only:function(n){if(!wI(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Yt.Component=H1;Yt.Fragment=gZ;Yt.Profiler=xZ;Yt.PureComponent=xI;Yt.StrictMode=yZ;Yt.Suspense=kZ;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NZ;Yt.act=rB;Yt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Jz({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=vI.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)eB.call(e,l)&&!tB.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:bw,type:n.type,key:s,ref:i,props:r,_owner:o}};Yt.createContext=function(n){return n={$$typeof:vZ,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:bZ,_context:n},n.Consumer=n};Yt.createElement=nB;Yt.createFactory=function(n){var e=nB.bind(null,n);return e.type=n,e};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(n){return{$$typeof:wZ,render:n}};Yt.isValidElement=wI;Yt.lazy=function(n){return{$$typeof:SZ,_payload:{_status:-1,_result:n},_init:CZ}};Yt.memo=function(n,e){return{$$typeof:_Z,type:n,compare:e===void 0?null:e}};Yt.startTransition=function(n){var e=S4.transition;S4.transition={};try{n()}finally{S4.transition=e}};Yt.unstable_act=rB;Yt.useCallback=function(n,e){return io.current.useCallback(n,e)};Yt.useContext=function(n){return io.current.useContext(n)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(n){return io.current.useDeferredValue(n)};Yt.useEffect=function(n,e){return io.current.useEffect(n,e)};Yt.useId=function(){return io.current.useId()};Yt.useImperativeHandle=function(n,e,t){return io.current.useImperativeHandle(n,e,t)};Yt.useInsertionEffect=function(n,e){return io.current.useInsertionEffect(n,e)};Yt.useLayoutEffect=function(n,e){return io.current.useLayoutEffect(n,e)};Yt.useMemo=function(n,e){return io.current.useMemo(n,e)};Yt.useReducer=function(n,e,t){return io.current.useReducer(n,e,t)};Yt.useRef=function(n){return io.current.useRef(n)};Yt.useState=function(n){return io.current.useState(n)};Yt.useSyncExternalStore=function(n,e,t){return io.current.useSyncExternalStore(n,e,t)};Yt.useTransition=function(){return io.current.useTransition()};Yt.version="18.3.1";Yz.exports=Yt;var V=Yz.exports;const nt=xw(V),IZ=pZ({__proto__:null,default:nt},[V]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RZ=V,MZ=Symbol.for("react.element"),PZ=Symbol.for("react.fragment"),LZ=Object.prototype.hasOwnProperty,DZ=RZ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jZ={key:!0,ref:!0,__self:!0,__source:!0};function sB(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)LZ.call(e,r)&&!jZ.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:MZ,type:n,key:i,ref:o,props:s,_owner:DZ.current}}i3.Fragment=PZ;i3.jsx=sB;i3.jsxs=sB;Kz.exports=i3;var d=Kz.exports,pE={},iB={exports:{}},ga={},oB={exports:{}},aB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ne,te){var H=ne.length;ne.push(te);e:for(;0<H;){var ce=H-1>>>1,xe=ne[ce];if(0<s(xe,te))ne[ce]=te,ne[H]=xe,H=ce;else break e}}function t(ne){return ne.length===0?null:ne[0]}function r(ne){if(ne.length===0)return null;var te=ne[0],H=ne.pop();if(H!==te){ne[0]=H;e:for(var ce=0,xe=ne.length,W=xe>>>1;ce<W;){var dt=2*(ce+1)-1,Me=ne[dt],Fe=dt+1,Ae=ne[Fe];if(0>s(Me,H))Fe<xe&&0>s(Ae,Me)?(ne[ce]=Ae,ne[Fe]=H,ce=Fe):(ne[ce]=Me,ne[dt]=H,ce=dt);else if(Fe<xe&&0>s(Ae,H))ne[ce]=Ae,ne[Fe]=H,ce=Fe;else break e}}return te}function s(ne,te){var H=ne.sortIndex-te.sortIndex;return H!==0?H:ne.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,p=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ne){for(var te=t(c);te!==null;){if(te.callback===null)r(c);else if(te.startTime<=ne)r(c),te.sortIndex=te.expirationTime,e(l,te);else break;te=t(c)}}function T(ne){if(y=!1,k(ne),!g)if(t(l)!==null)g=!0,Q(R);else{var te=t(c);te!==null&&re(T,te.startTime-ne)}}function R(ne,te){g=!1,y&&(y=!1,b(I),I=-1),p=!0;var H=f;try{for(k(te),h=t(l);h!==null&&(!(h.expirationTime>te)||ne&&!P());){var ce=h.callback;if(typeof ce=="function"){h.callback=null,f=h.priorityLevel;var xe=ce(h.expirationTime<=te);te=n.unstable_now(),typeof xe=="function"?h.callback=xe:h===t(l)&&r(l),k(te)}else r(l);h=t(l)}if(h!==null)var W=!0;else{var dt=t(c);dt!==null&&re(T,dt.startTime-te),W=!1}return W}finally{h=null,f=H,p=!1}}var M=!1,E=null,I=-1,S=5,N=-1;function P(){return!(n.unstable_now()-N<S)}function O(){if(E!==null){var ne=n.unstable_now();N=ne;var te=!0;try{te=E(!0,ne)}finally{te?D():(M=!1,E=null)}}else M=!1}var D;if(typeof w=="function")D=function(){w(O)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,J=G.port2;G.port1.onmessage=O,D=function(){J.postMessage(null)}}else D=function(){v(O,0)};function Q(ne){E=ne,M||(M=!0,D())}function re(ne,te){I=v(function(){ne(n.unstable_now())},te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ne){ne.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,Q(R))},n.unstable_forceFrameRate=function(ne){0>ne||125<ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<ne?Math.floor(1e3/ne):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(ne){switch(f){case 1:case 2:case 3:var te=3;break;default:te=f}var H=f;f=te;try{return ne()}finally{f=H}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ne,te){switch(ne){case 1:case 2:case 3:case 4:case 5:break;default:ne=3}var H=f;f=ne;try{return te()}finally{f=H}},n.unstable_scheduleCallback=function(ne,te,H){var ce=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?ce+H:ce):H=ce,ne){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=H+xe,ne={id:u++,callback:te,priorityLevel:ne,startTime:H,expirationTime:xe,sortIndex:-1},H>ce?(ne.sortIndex=H,e(c,ne),t(l)===null&&ne===t(c)&&(y?(b(I),I=-1):y=!0,re(T,H-ce))):(ne.sortIndex=xe,e(l,ne),g||p||(g=!0,Q(R))),ne},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(ne){var te=f;return function(){var H=f;f=te;try{return ne.apply(this,arguments)}finally{f=H}}}})(aB);oB.exports=aB;var OZ=oB.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FZ=V,pa=OZ;function Se(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lB=new Set,Xx={};function $0(n,e){m1(n,e),m1(n+"Capture",e)}function m1(n,e){for(Xx[n]=e,n=0;n<e.length;n++)lB.add(e[n])}var Xu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),mE=Object.prototype.hasOwnProperty,zZ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,GM={},WM={};function BZ(n){return mE.call(WM,n)?!0:mE.call(GM,n)?!1:zZ.test(n)?WM[n]=!0:(GM[n]=!0,!1)}function $Z(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function VZ(n,e,t,r){if(e===null||typeof e>"u"||$Z(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function oo(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ei[n]=new oo(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];ei[e]=new oo(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ei[n]=new oo(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ei[n]=new oo(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ei[n]=new oo(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ei[n]=new oo(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ei[n]=new oo(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ei[n]=new oo(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ei[n]=new oo(n,5,!1,n.toLowerCase(),null,!1,!1)});var kI=/[\-:]([a-z])/g;function _I(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(kI,_I);ei[e]=new oo(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(kI,_I);ei[e]=new oo(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(kI,_I);ei[e]=new oo(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ei[n]=new oo(n,1,!1,n.toLowerCase(),null,!1,!1)});ei.xlinkHref=new oo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ei[n]=new oo(n,1,!1,n.toLowerCase(),null,!0,!0)});function SI(n,e,t,r){var s=ei.hasOwnProperty(e)?ei[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(VZ(e,t,s,r)&&(t=null),r||s===null?BZ(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var dd=FZ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b2=Symbol.for("react.element"),Nm=Symbol.for("react.portal"),Im=Symbol.for("react.fragment"),TI=Symbol.for("react.strict_mode"),gE=Symbol.for("react.profiler"),cB=Symbol.for("react.provider"),uB=Symbol.for("react.context"),AI=Symbol.for("react.forward_ref"),yE=Symbol.for("react.suspense"),xE=Symbol.for("react.suspense_list"),EI=Symbol.for("react.memo"),Pd=Symbol.for("react.lazy"),dB=Symbol.for("react.offscreen"),KM=Symbol.iterator;function uy(n){return n===null||typeof n!="object"?null:(n=KM&&n[KM]||n["@@iterator"],typeof n=="function"?n:null)}var wr=Object.assign,WS;function Dy(n){if(WS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);WS=e&&e[1]||""}return`
`+WS+n}var KS=!1;function YS(n,e){if(!n||KS)return"";KS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{KS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Dy(n):""}function UZ(n){switch(n.tag){case 5:return Dy(n.type);case 16:return Dy("Lazy");case 13:return Dy("Suspense");case 19:return Dy("SuspenseList");case 0:case 2:case 15:return n=YS(n.type,!1),n;case 11:return n=YS(n.type.render,!1),n;case 1:return n=YS(n.type,!0),n;default:return""}}function bE(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Im:return"Fragment";case Nm:return"Portal";case gE:return"Profiler";case TI:return"StrictMode";case yE:return"Suspense";case xE:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case uB:return(n.displayName||"Context")+".Consumer";case cB:return(n._context.displayName||"Context")+".Provider";case AI:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case EI:return e=n.displayName||null,e!==null?e:bE(n.type)||"Memo";case Pd:e=n._payload,n=n._init;try{return bE(n(e))}catch{}}return null}function HZ(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return bE(e);case 8:return e===TI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Jh(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function hB(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function qZ(n){var e=hB(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function v2(n){n._valueTracker||(n._valueTracker=qZ(n))}function fB(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=hB(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Lk(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vE(n,e){var t=e.checked;return wr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function YM(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Jh(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function pB(n,e){e=e.checked,e!=null&&SI(n,"checked",e,!1)}function wE(n,e){pB(n,e);var t=Jh(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?kE(n,e.type,t):e.hasOwnProperty("defaultValue")&&kE(n,e.type,Jh(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function XM(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function kE(n,e,t){(e!=="number"||Lk(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var jy=Array.isArray;function qm(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Jh(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function _E(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Se(91));return wr({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function JM(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Se(92));if(jy(t)){if(1<t.length)throw Error(Se(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Jh(t)}}function mB(n,e){var t=Jh(e.value),r=Jh(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function QM(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function gB(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function SE(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?gB(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var w2,yB=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(w2=w2||document.createElement("div"),w2.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=w2.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Jx(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var mx={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GZ=["Webkit","ms","Moz","O"];Object.keys(mx).forEach(function(n){GZ.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),mx[e]=mx[n]})});function xB(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||mx.hasOwnProperty(n)&&mx[n]?(""+e).trim():e+"px"}function bB(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=xB(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var WZ=wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function TE(n,e){if(e){if(WZ[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Se(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Se(62))}}function AE(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var EE=null;function CI(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var CE=null,Gm=null,Wm=null;function ZM(n){if(n=kw(n)){if(typeof CE!="function")throw Error(Se(280));var e=n.stateNode;e&&(e=u3(e),CE(n.stateNode,n.type,e))}}function vB(n){Gm?Wm?Wm.push(n):Wm=[n]:Gm=n}function wB(){if(Gm){var n=Gm,e=Wm;if(Wm=Gm=null,ZM(n),e)for(n=0;n<e.length;n++)ZM(e[n])}}function kB(n,e){return n(e)}function _B(){}var XS=!1;function SB(n,e,t){if(XS)return n(e,t);XS=!0;try{return kB(n,e,t)}finally{XS=!1,(Gm!==null||Wm!==null)&&(_B(),wB())}}function Qx(n,e){var t=n.stateNode;if(t===null)return null;var r=u3(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Se(231,e,typeof t));return t}var NE=!1;if(Xu)try{var dy={};Object.defineProperty(dy,"passive",{get:function(){NE=!0}}),window.addEventListener("test",dy,dy),window.removeEventListener("test",dy,dy)}catch{NE=!1}function KZ(n,e,t,r,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var gx=!1,Dk=null,jk=!1,IE=null,YZ={onError:function(n){gx=!0,Dk=n}};function XZ(n,e,t,r,s,i,o,a,l){gx=!1,Dk=null,KZ.apply(YZ,arguments)}function JZ(n,e,t,r,s,i,o,a,l){if(XZ.apply(this,arguments),gx){if(gx){var c=Dk;gx=!1,Dk=null}else throw Error(Se(198));jk||(jk=!0,IE=c)}}function V0(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function TB(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function e9(n){if(V0(n)!==n)throw Error(Se(188))}function QZ(n){var e=n.alternate;if(!e){if(e=V0(n),e===null)throw Error(Se(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return e9(s),n;if(i===r)return e9(s),e;i=i.sibling}throw Error(Se(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(Se(189))}}if(t.alternate!==r)throw Error(Se(190))}if(t.tag!==3)throw Error(Se(188));return t.stateNode.current===t?n:e}function AB(n){return n=QZ(n),n!==null?EB(n):null}function EB(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=EB(n);if(e!==null)return e;n=n.sibling}return null}var CB=pa.unstable_scheduleCallback,t9=pa.unstable_cancelCallback,ZZ=pa.unstable_shouldYield,eee=pa.unstable_requestPaint,Vr=pa.unstable_now,tee=pa.unstable_getCurrentPriorityLevel,NI=pa.unstable_ImmediatePriority,NB=pa.unstable_UserBlockingPriority,Ok=pa.unstable_NormalPriority,nee=pa.unstable_LowPriority,IB=pa.unstable_IdlePriority,o3=null,Ec=null;function ree(n){if(Ec&&typeof Ec.onCommitFiberRoot=="function")try{Ec.onCommitFiberRoot(o3,n,void 0,(n.current.flags&128)===128)}catch{}}var Ll=Math.clz32?Math.clz32:oee,see=Math.log,iee=Math.LN2;function oee(n){return n>>>=0,n===0?32:31-(see(n)/iee|0)|0}var k2=64,_2=4194304;function Oy(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Fk(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Oy(a):(i&=o,i!==0&&(r=Oy(i)))}else o=t&~s,o!==0?r=Oy(o):i!==0&&(r=Oy(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Ll(e),s=1<<t,r|=n[t],e&=~s;return r}function aee(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lee(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Ll(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=aee(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function RE(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function RB(){var n=k2;return k2<<=1,!(k2&4194240)&&(k2=64),n}function JS(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function vw(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ll(e),n[e]=t}function cee(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Ll(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function II(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Ll(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var In=0;function MB(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var PB,RI,LB,DB,jB,ME=!1,S2=[],Rh=null,Mh=null,Ph=null,Zx=new Map,eb=new Map,Fd=[],uee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function n9(n,e){switch(n){case"focusin":case"focusout":Rh=null;break;case"dragenter":case"dragleave":Mh=null;break;case"mouseover":case"mouseout":Ph=null;break;case"pointerover":case"pointerout":Zx.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":eb.delete(e.pointerId)}}function hy(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=kw(e),e!==null&&RI(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function dee(n,e,t,r,s){switch(e){case"focusin":return Rh=hy(Rh,n,e,t,r,s),!0;case"dragenter":return Mh=hy(Mh,n,e,t,r,s),!0;case"mouseover":return Ph=hy(Ph,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Zx.set(i,hy(Zx.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,eb.set(i,hy(eb.get(i)||null,n,e,t,r,s)),!0}return!1}function OB(n){var e=Kf(n.target);if(e!==null){var t=V0(e);if(t!==null){if(e=t.tag,e===13){if(e=TB(t),e!==null){n.blockedOn=e,jB(n.priority,function(){LB(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function T4(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=PE(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);EE=r,t.target.dispatchEvent(r),EE=null}else return e=kw(t),e!==null&&RI(e),n.blockedOn=t,!1;e.shift()}return!0}function r9(n,e,t){T4(n)&&t.delete(e)}function hee(){ME=!1,Rh!==null&&T4(Rh)&&(Rh=null),Mh!==null&&T4(Mh)&&(Mh=null),Ph!==null&&T4(Ph)&&(Ph=null),Zx.forEach(r9),eb.forEach(r9)}function fy(n,e){n.blockedOn===e&&(n.blockedOn=null,ME||(ME=!0,pa.unstable_scheduleCallback(pa.unstable_NormalPriority,hee)))}function tb(n){function e(s){return fy(s,n)}if(0<S2.length){fy(S2[0],n);for(var t=1;t<S2.length;t++){var r=S2[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Rh!==null&&fy(Rh,n),Mh!==null&&fy(Mh,n),Ph!==null&&fy(Ph,n),Zx.forEach(e),eb.forEach(e),t=0;t<Fd.length;t++)r=Fd[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Fd.length&&(t=Fd[0],t.blockedOn===null);)OB(t),t.blockedOn===null&&Fd.shift()}var Km=dd.ReactCurrentBatchConfig,zk=!0;function fee(n,e,t,r){var s=In,i=Km.transition;Km.transition=null;try{In=1,MI(n,e,t,r)}finally{In=s,Km.transition=i}}function pee(n,e,t,r){var s=In,i=Km.transition;Km.transition=null;try{In=4,MI(n,e,t,r)}finally{In=s,Km.transition=i}}function MI(n,e,t,r){if(zk){var s=PE(n,e,t,r);if(s===null)aT(n,e,r,Bk,t),n9(n,r);else if(dee(s,n,e,t,r))r.stopPropagation();else if(n9(n,r),e&4&&-1<uee.indexOf(n)){for(;s!==null;){var i=kw(s);if(i!==null&&PB(i),i=PE(n,e,t,r),i===null&&aT(n,e,r,Bk,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else aT(n,e,r,null,t)}}var Bk=null;function PE(n,e,t,r){if(Bk=null,n=CI(r),n=Kf(n),n!==null)if(e=V0(n),e===null)n=null;else if(t=e.tag,t===13){if(n=TB(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Bk=n,null}function FB(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tee()){case NI:return 1;case NB:return 4;case Ok:case nee:return 16;case IB:return 536870912;default:return 16}default:return 16}}var _h=null,PI=null,A4=null;function zB(){if(A4)return A4;var n,e=PI,t=e.length,r,s="value"in _h?_h.value:_h.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return A4=s.slice(n,1<r?1-r:void 0)}function E4(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function T2(){return!0}function s9(){return!1}function ya(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?T2:s9,this.isPropagationStopped=s9,this}return wr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=T2)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=T2)},persist:function(){},isPersistent:T2}),e}var q1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},LI=ya(q1),ww=wr({},q1,{view:0,detail:0}),mee=ya(ww),QS,ZS,py,a3=wr({},ww,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:DI,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==py&&(py&&n.type==="mousemove"?(QS=n.screenX-py.screenX,ZS=n.screenY-py.screenY):ZS=QS=0,py=n),QS)},movementY:function(n){return"movementY"in n?n.movementY:ZS}}),i9=ya(a3),gee=wr({},a3,{dataTransfer:0}),yee=ya(gee),xee=wr({},ww,{relatedTarget:0}),eT=ya(xee),bee=wr({},q1,{animationName:0,elapsedTime:0,pseudoElement:0}),vee=ya(bee),wee=wr({},q1,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),kee=ya(wee),_ee=wr({},q1,{data:0}),o9=ya(_ee),See={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Aee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eee(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Aee[n])?!!e[n]:!1}function DI(){return Eee}var Cee=wr({},ww,{key:function(n){if(n.key){var e=See[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=E4(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Tee[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:DI,charCode:function(n){return n.type==="keypress"?E4(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?E4(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Nee=ya(Cee),Iee=wr({},a3,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),a9=ya(Iee),Ree=wr({},ww,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:DI}),Mee=ya(Ree),Pee=wr({},q1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Lee=ya(Pee),Dee=wr({},a3,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),jee=ya(Dee),Oee=[9,13,27,32],jI=Xu&&"CompositionEvent"in window,yx=null;Xu&&"documentMode"in document&&(yx=document.documentMode);var Fee=Xu&&"TextEvent"in window&&!yx,BB=Xu&&(!jI||yx&&8<yx&&11>=yx),l9=" ",c9=!1;function $B(n,e){switch(n){case"keyup":return Oee.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function VB(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Rm=!1;function zee(n,e){switch(n){case"compositionend":return VB(e);case"keypress":return e.which!==32?null:(c9=!0,l9);case"textInput":return n=e.data,n===l9&&c9?null:n;default:return null}}function Bee(n,e){if(Rm)return n==="compositionend"||!jI&&$B(n,e)?(n=zB(),A4=PI=_h=null,Rm=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return BB&&e.locale!=="ko"?null:e.data;default:return null}}var $ee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u9(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!$ee[n.type]:e==="textarea"}function UB(n,e,t,r){vB(r),e=$k(e,"onChange"),0<e.length&&(t=new LI("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var xx=null,nb=null;function Vee(n){e$(n,0)}function l3(n){var e=Lm(n);if(fB(e))return n}function Uee(n,e){if(n==="change")return e}var HB=!1;if(Xu){var tT;if(Xu){var nT="oninput"in document;if(!nT){var d9=document.createElement("div");d9.setAttribute("oninput","return;"),nT=typeof d9.oninput=="function"}tT=nT}else tT=!1;HB=tT&&(!document.documentMode||9<document.documentMode)}function h9(){xx&&(xx.detachEvent("onpropertychange",qB),nb=xx=null)}function qB(n){if(n.propertyName==="value"&&l3(nb)){var e=[];UB(e,nb,n,CI(n)),SB(Vee,e)}}function Hee(n,e,t){n==="focusin"?(h9(),xx=e,nb=t,xx.attachEvent("onpropertychange",qB)):n==="focusout"&&h9()}function qee(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return l3(nb)}function Gee(n,e){if(n==="click")return l3(e)}function Wee(n,e){if(n==="input"||n==="change")return l3(e)}function Kee(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Fl=typeof Object.is=="function"?Object.is:Kee;function rb(n,e){if(Fl(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!mE.call(e,s)||!Fl(n[s],e[s]))return!1}return!0}function f9(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function p9(n,e){var t=f9(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=f9(t)}}function GB(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?GB(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function WB(){for(var n=window,e=Lk();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Lk(n.document)}return e}function OI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Yee(n){var e=WB(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&GB(t.ownerDocument.documentElement,t)){if(r!==null&&OI(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=p9(t,i);var o=p9(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Xee=Xu&&"documentMode"in document&&11>=document.documentMode,Mm=null,LE=null,bx=null,DE=!1;function m9(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;DE||Mm==null||Mm!==Lk(r)||(r=Mm,"selectionStart"in r&&OI(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bx&&rb(bx,r)||(bx=r,r=$k(LE,"onSelect"),0<r.length&&(e=new LI("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Mm)))}function A2(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Pm={animationend:A2("Animation","AnimationEnd"),animationiteration:A2("Animation","AnimationIteration"),animationstart:A2("Animation","AnimationStart"),transitionend:A2("Transition","TransitionEnd")},rT={},KB={};Xu&&(KB=document.createElement("div").style,"AnimationEvent"in window||(delete Pm.animationend.animation,delete Pm.animationiteration.animation,delete Pm.animationstart.animation),"TransitionEvent"in window||delete Pm.transitionend.transition);function c3(n){if(rT[n])return rT[n];if(!Pm[n])return n;var e=Pm[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in KB)return rT[n]=e[t];return n}var YB=c3("animationend"),XB=c3("animationiteration"),JB=c3("animationstart"),QB=c3("transitionend"),ZB=new Map,g9="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gf(n,e){ZB.set(n,e),$0(e,[n])}for(var sT=0;sT<g9.length;sT++){var iT=g9[sT],Jee=iT.toLowerCase(),Qee=iT[0].toUpperCase()+iT.slice(1);gf(Jee,"on"+Qee)}gf(YB,"onAnimationEnd");gf(XB,"onAnimationIteration");gf(JB,"onAnimationStart");gf("dblclick","onDoubleClick");gf("focusin","onFocus");gf("focusout","onBlur");gf(QB,"onTransitionEnd");m1("onMouseEnter",["mouseout","mouseover"]);m1("onMouseLeave",["mouseout","mouseover"]);m1("onPointerEnter",["pointerout","pointerover"]);m1("onPointerLeave",["pointerout","pointerover"]);$0("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$0("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$0("onBeforeInput",["compositionend","keypress","textInput","paste"]);$0("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$0("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$0("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zee=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fy));function y9(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,JZ(r,e,void 0,n),n.currentTarget=null}function e$(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;y9(s,a,c),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;y9(s,a,c),i=l}}}if(jk)throw n=IE,jk=!1,IE=null,n}function Xn(n,e){var t=e[BE];t===void 0&&(t=e[BE]=new Set);var r=n+"__bubble";t.has(r)||(t$(e,n,2,!1),t.add(r))}function oT(n,e,t){var r=0;e&&(r|=4),t$(t,n,r,e)}var E2="_reactListening"+Math.random().toString(36).slice(2);function sb(n){if(!n[E2]){n[E2]=!0,lB.forEach(function(t){t!=="selectionchange"&&(Zee.has(t)||oT(t,!1,n),oT(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[E2]||(e[E2]=!0,oT("selectionchange",!1,e))}}function t$(n,e,t,r){switch(FB(e)){case 1:var s=fee;break;case 4:s=pee;break;default:s=MI}t=s.bind(null,e,t,n),s=void 0,!NE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function aT(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Kf(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}SB(function(){var c=i,u=CI(t),h=[];e:{var f=ZB.get(n);if(f!==void 0){var p=LI,g=n;switch(n){case"keypress":if(E4(t)===0)break e;case"keydown":case"keyup":p=Nee;break;case"focusin":g="focus",p=eT;break;case"focusout":g="blur",p=eT;break;case"beforeblur":case"afterblur":p=eT;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=i9;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=yee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Mee;break;case YB:case XB:case JB:p=vee;break;case QB:p=Lee;break;case"scroll":p=mee;break;case"wheel":p=jee;break;case"copy":case"cut":case"paste":p=kee;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=a9}var y=(e&4)!==0,v=!y&&n==="scroll",b=y?f!==null?f+"Capture":null:f;y=[];for(var w=c,k;w!==null;){k=w;var T=k.stateNode;if(k.tag===5&&T!==null&&(k=T,b!==null&&(T=Qx(w,b),T!=null&&y.push(ib(w,T,k)))),v)break;w=w.return}0<y.length&&(f=new p(f,g,null,t,u),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",f&&t!==EE&&(g=t.relatedTarget||t.fromElement)&&(Kf(g)||g[Ju]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=c,g=g?Kf(g):null,g!==null&&(v=V0(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(y=i9,T="onMouseLeave",b="onMouseEnter",w="mouse",(n==="pointerout"||n==="pointerover")&&(y=a9,T="onPointerLeave",b="onPointerEnter",w="pointer"),v=p==null?f:Lm(p),k=g==null?f:Lm(g),f=new y(T,w+"leave",p,t,u),f.target=v,f.relatedTarget=k,T=null,Kf(u)===c&&(y=new y(b,w+"enter",g,t,u),y.target=k,y.relatedTarget=v,T=y),v=T,p&&g)t:{for(y=p,b=g,w=0,k=y;k;k=am(k))w++;for(k=0,T=b;T;T=am(T))k++;for(;0<w-k;)y=am(y),w--;for(;0<k-w;)b=am(b),k--;for(;w--;){if(y===b||b!==null&&y===b.alternate)break t;y=am(y),b=am(b)}y=null}else y=null;p!==null&&x9(h,f,p,y,!1),g!==null&&v!==null&&x9(h,v,g,y,!0)}}e:{if(f=c?Lm(c):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var R=Uee;else if(u9(f))if(HB)R=Wee;else{R=qee;var M=Hee}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=Gee);if(R&&(R=R(n,c))){UB(h,R,t,u);break e}M&&M(n,f,c),n==="focusout"&&(M=f._wrapperState)&&M.controlled&&f.type==="number"&&kE(f,"number",f.value)}switch(M=c?Lm(c):window,n){case"focusin":(u9(M)||M.contentEditable==="true")&&(Mm=M,LE=c,bx=null);break;case"focusout":bx=LE=Mm=null;break;case"mousedown":DE=!0;break;case"contextmenu":case"mouseup":case"dragend":DE=!1,m9(h,t,u);break;case"selectionchange":if(Xee)break;case"keydown":case"keyup":m9(h,t,u)}var E;if(jI)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Rm?$B(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(BB&&t.locale!=="ko"&&(Rm||I!=="onCompositionStart"?I==="onCompositionEnd"&&Rm&&(E=zB()):(_h=u,PI="value"in _h?_h.value:_h.textContent,Rm=!0)),M=$k(c,I),0<M.length&&(I=new o9(I,n,null,t,u),h.push({event:I,listeners:M}),E?I.data=E:(E=VB(t),E!==null&&(I.data=E)))),(E=Fee?zee(n,t):Bee(n,t))&&(c=$k(c,"onBeforeInput"),0<c.length&&(u=new o9("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=E))}e$(h,e)})}function ib(n,e,t){return{instance:n,listener:e,currentTarget:t}}function $k(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Qx(n,t),i!=null&&r.unshift(ib(n,i,s)),i=Qx(n,e),i!=null&&r.push(ib(n,i,s))),n=n.return}return r}function am(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function x9(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,s?(l=Qx(t,i),l!=null&&o.unshift(ib(t,l,a))):s||(l=Qx(t,i),l!=null&&o.push(ib(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var ete=/\r\n?/g,tte=/\u0000|\uFFFD/g;function b9(n){return(typeof n=="string"?n:""+n).replace(ete,`
`).replace(tte,"")}function C2(n,e,t){if(e=b9(e),b9(n)!==e&&t)throw Error(Se(425))}function Vk(){}var jE=null,OE=null;function FE(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zE=typeof setTimeout=="function"?setTimeout:void 0,nte=typeof clearTimeout=="function"?clearTimeout:void 0,v9=typeof Promise=="function"?Promise:void 0,rte=typeof queueMicrotask=="function"?queueMicrotask:typeof v9<"u"?function(n){return v9.resolve(null).then(n).catch(ste)}:zE;function ste(n){setTimeout(function(){throw n})}function lT(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),tb(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);tb(e)}function Lh(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function w9(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var G1=Math.random().toString(36).slice(2),_c="__reactFiber$"+G1,ob="__reactProps$"+G1,Ju="__reactContainer$"+G1,BE="__reactEvents$"+G1,ite="__reactListeners$"+G1,ote="__reactHandles$"+G1;function Kf(n){var e=n[_c];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ju]||t[_c]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=w9(n);n!==null;){if(t=n[_c])return t;n=w9(n)}return e}n=t,t=n.parentNode}return null}function kw(n){return n=n[_c]||n[Ju],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Lm(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Se(33))}function u3(n){return n[ob]||null}var $E=[],Dm=-1;function yf(n){return{current:n}}function Zn(n){0>Dm||(n.current=$E[Dm],$E[Dm]=null,Dm--)}function Wn(n,e){Dm++,$E[Dm]=n.current,n.current=e}var Qh={},Ti=yf(Qh),Io=yf(!1),v0=Qh;function g1(n,e){var t=n.type.contextTypes;if(!t)return Qh;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function Ro(n){return n=n.childContextTypes,n!=null}function Uk(){Zn(Io),Zn(Ti)}function k9(n,e,t){if(Ti.current!==Qh)throw Error(Se(168));Wn(Ti,e),Wn(Io,t)}function n$(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Se(108,HZ(n)||"Unknown",s));return wr({},t,r)}function Hk(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Qh,v0=Ti.current,Wn(Ti,n),Wn(Io,Io.current),!0}function _9(n,e,t){var r=n.stateNode;if(!r)throw Error(Se(169));t?(n=n$(n,e,v0),r.__reactInternalMemoizedMergedChildContext=n,Zn(Io),Zn(Ti),Wn(Ti,n)):Zn(Io),Wn(Io,t)}var cu=null,d3=!1,cT=!1;function r$(n){cu===null?cu=[n]:cu.push(n)}function ate(n){d3=!0,r$(n)}function xf(){if(!cT&&cu!==null){cT=!0;var n=0,e=In;try{var t=cu;for(In=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}cu=null,d3=!1}catch(s){throw cu!==null&&(cu=cu.slice(n+1)),CB(NI,xf),s}finally{In=e,cT=!1}}return null}var jm=[],Om=0,qk=null,Gk=0,Fa=[],za=0,w0=null,Ou=1,Fu="";function Of(n,e){jm[Om++]=Gk,jm[Om++]=qk,qk=n,Gk=e}function s$(n,e,t){Fa[za++]=Ou,Fa[za++]=Fu,Fa[za++]=w0,w0=n;var r=Ou;n=Fu;var s=32-Ll(r)-1;r&=~(1<<s),t+=1;var i=32-Ll(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ou=1<<32-Ll(e)+s|t<<s|r,Fu=i+n}else Ou=1<<i|t<<s|r,Fu=n}function FI(n){n.return!==null&&(Of(n,1),s$(n,1,0))}function zI(n){for(;n===qk;)qk=jm[--Om],jm[Om]=null,Gk=jm[--Om],jm[Om]=null;for(;n===w0;)w0=Fa[--za],Fa[za]=null,Fu=Fa[--za],Fa[za]=null,Ou=Fa[--za],Fa[za]=null}var la=null,ia=null,ir=!1,Cl=null;function i$(n,e){var t=qa(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function S9(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,la=n,ia=Lh(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,la=n,ia=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=w0!==null?{id:Ou,overflow:Fu}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=qa(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,la=n,ia=null,!0):!1;default:return!1}}function VE(n){return(n.mode&1)!==0&&(n.flags&128)===0}function UE(n){if(ir){var e=ia;if(e){var t=e;if(!S9(n,e)){if(VE(n))throw Error(Se(418));e=Lh(t.nextSibling);var r=la;e&&S9(n,e)?i$(r,t):(n.flags=n.flags&-4097|2,ir=!1,la=n)}}else{if(VE(n))throw Error(Se(418));n.flags=n.flags&-4097|2,ir=!1,la=n}}}function T9(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;la=n}function N2(n){if(n!==la)return!1;if(!ir)return T9(n),ir=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!FE(n.type,n.memoizedProps)),e&&(e=ia)){if(VE(n))throw o$(),Error(Se(418));for(;e;)i$(n,e),e=Lh(e.nextSibling)}if(T9(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Se(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ia=Lh(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ia=null}}else ia=la?Lh(n.stateNode.nextSibling):null;return!0}function o$(){for(var n=ia;n;)n=Lh(n.nextSibling)}function y1(){ia=la=null,ir=!1}function BI(n){Cl===null?Cl=[n]:Cl.push(n)}var lte=dd.ReactCurrentBatchConfig;function my(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Se(309));var r=t.stateNode}if(!r)throw Error(Se(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(Se(284));if(!t._owner)throw Error(Se(290,n))}return n}function I2(n,e){throw n=Object.prototype.toString.call(e),Error(Se(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function A9(n){var e=n._init;return e(n._payload)}function a$(n){function e(b,w){if(n){var k=b.deletions;k===null?(b.deletions=[w],b.flags|=16):k.push(w)}}function t(b,w){if(!n)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function r(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function s(b,w){return b=Fh(b,w),b.index=0,b.sibling=null,b}function i(b,w,k){return b.index=k,n?(k=b.alternate,k!==null?(k=k.index,k<w?(b.flags|=2,w):k):(b.flags|=2,w)):(b.flags|=1048576,w)}function o(b){return n&&b.alternate===null&&(b.flags|=2),b}function a(b,w,k,T){return w===null||w.tag!==6?(w=gT(k,b.mode,T),w.return=b,w):(w=s(w,k),w.return=b,w)}function l(b,w,k,T){var R=k.type;return R===Im?u(b,w,k.props.children,T,k.key):w!==null&&(w.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Pd&&A9(R)===w.type)?(T=s(w,k.props),T.ref=my(b,w,k),T.return=b,T):(T=L4(k.type,k.key,k.props,null,b.mode,T),T.ref=my(b,w,k),T.return=b,T)}function c(b,w,k,T){return w===null||w.tag!==4||w.stateNode.containerInfo!==k.containerInfo||w.stateNode.implementation!==k.implementation?(w=yT(k,b.mode,T),w.return=b,w):(w=s(w,k.children||[]),w.return=b,w)}function u(b,w,k,T,R){return w===null||w.tag!==7?(w=c0(k,b.mode,T,R),w.return=b,w):(w=s(w,k),w.return=b,w)}function h(b,w,k){if(typeof w=="string"&&w!==""||typeof w=="number")return w=gT(""+w,b.mode,k),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case b2:return k=L4(w.type,w.key,w.props,null,b.mode,k),k.ref=my(b,null,w),k.return=b,k;case Nm:return w=yT(w,b.mode,k),w.return=b,w;case Pd:var T=w._init;return h(b,T(w._payload),k)}if(jy(w)||uy(w))return w=c0(w,b.mode,k,null),w.return=b,w;I2(b,w)}return null}function f(b,w,k,T){var R=w!==null?w.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return R!==null?null:a(b,w,""+k,T);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case b2:return k.key===R?l(b,w,k,T):null;case Nm:return k.key===R?c(b,w,k,T):null;case Pd:return R=k._init,f(b,w,R(k._payload),T)}if(jy(k)||uy(k))return R!==null?null:u(b,w,k,T,null);I2(b,k)}return null}function p(b,w,k,T,R){if(typeof T=="string"&&T!==""||typeof T=="number")return b=b.get(k)||null,a(w,b,""+T,R);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case b2:return b=b.get(T.key===null?k:T.key)||null,l(w,b,T,R);case Nm:return b=b.get(T.key===null?k:T.key)||null,c(w,b,T,R);case Pd:var M=T._init;return p(b,w,k,M(T._payload),R)}if(jy(T)||uy(T))return b=b.get(k)||null,u(w,b,T,R,null);I2(w,T)}return null}function g(b,w,k,T){for(var R=null,M=null,E=w,I=w=0,S=null;E!==null&&I<k.length;I++){E.index>I?(S=E,E=null):S=E.sibling;var N=f(b,E,k[I],T);if(N===null){E===null&&(E=S);break}n&&E&&N.alternate===null&&e(b,E),w=i(N,w,I),M===null?R=N:M.sibling=N,M=N,E=S}if(I===k.length)return t(b,E),ir&&Of(b,I),R;if(E===null){for(;I<k.length;I++)E=h(b,k[I],T),E!==null&&(w=i(E,w,I),M===null?R=E:M.sibling=E,M=E);return ir&&Of(b,I),R}for(E=r(b,E);I<k.length;I++)S=p(E,b,I,k[I],T),S!==null&&(n&&S.alternate!==null&&E.delete(S.key===null?I:S.key),w=i(S,w,I),M===null?R=S:M.sibling=S,M=S);return n&&E.forEach(function(P){return e(b,P)}),ir&&Of(b,I),R}function y(b,w,k,T){var R=uy(k);if(typeof R!="function")throw Error(Se(150));if(k=R.call(k),k==null)throw Error(Se(151));for(var M=R=null,E=w,I=w=0,S=null,N=k.next();E!==null&&!N.done;I++,N=k.next()){E.index>I?(S=E,E=null):S=E.sibling;var P=f(b,E,N.value,T);if(P===null){E===null&&(E=S);break}n&&E&&P.alternate===null&&e(b,E),w=i(P,w,I),M===null?R=P:M.sibling=P,M=P,E=S}if(N.done)return t(b,E),ir&&Of(b,I),R;if(E===null){for(;!N.done;I++,N=k.next())N=h(b,N.value,T),N!==null&&(w=i(N,w,I),M===null?R=N:M.sibling=N,M=N);return ir&&Of(b,I),R}for(E=r(b,E);!N.done;I++,N=k.next())N=p(E,b,I,N.value,T),N!==null&&(n&&N.alternate!==null&&E.delete(N.key===null?I:N.key),w=i(N,w,I),M===null?R=N:M.sibling=N,M=N);return n&&E.forEach(function(O){return e(b,O)}),ir&&Of(b,I),R}function v(b,w,k,T){if(typeof k=="object"&&k!==null&&k.type===Im&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case b2:e:{for(var R=k.key,M=w;M!==null;){if(M.key===R){if(R=k.type,R===Im){if(M.tag===7){t(b,M.sibling),w=s(M,k.props.children),w.return=b,b=w;break e}}else if(M.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Pd&&A9(R)===M.type){t(b,M.sibling),w=s(M,k.props),w.ref=my(b,M,k),w.return=b,b=w;break e}t(b,M);break}else e(b,M);M=M.sibling}k.type===Im?(w=c0(k.props.children,b.mode,T,k.key),w.return=b,b=w):(T=L4(k.type,k.key,k.props,null,b.mode,T),T.ref=my(b,w,k),T.return=b,b=T)}return o(b);case Nm:e:{for(M=k.key;w!==null;){if(w.key===M)if(w.tag===4&&w.stateNode.containerInfo===k.containerInfo&&w.stateNode.implementation===k.implementation){t(b,w.sibling),w=s(w,k.children||[]),w.return=b,b=w;break e}else{t(b,w);break}else e(b,w);w=w.sibling}w=yT(k,b.mode,T),w.return=b,b=w}return o(b);case Pd:return M=k._init,v(b,w,M(k._payload),T)}if(jy(k))return g(b,w,k,T);if(uy(k))return y(b,w,k,T);I2(b,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,w!==null&&w.tag===6?(t(b,w.sibling),w=s(w,k),w.return=b,b=w):(t(b,w),w=gT(k,b.mode,T),w.return=b,b=w),o(b)):t(b,w)}return v}var x1=a$(!0),l$=a$(!1),Wk=yf(null),Kk=null,Fm=null,$I=null;function VI(){$I=Fm=Kk=null}function UI(n){var e=Wk.current;Zn(Wk),n._currentValue=e}function HE(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ym(n,e){Kk=n,$I=Fm=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Eo=!0),n.firstContext=null)}function Qa(n){var e=n._currentValue;if($I!==n)if(n={context:n,memoizedValue:e,next:null},Fm===null){if(Kk===null)throw Error(Se(308));Fm=n,Kk.dependencies={lanes:0,firstContext:n}}else Fm=Fm.next=n;return e}var Yf=null;function HI(n){Yf===null?Yf=[n]:Yf.push(n)}function c$(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,HI(e)):(t.next=s.next,s.next=t),e.interleaved=t,Qu(n,r)}function Qu(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ld=!1;function qI(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u$(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Vu(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Dh(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,hn&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Qu(n,t)}return s=r.interleaved,s===null?(e.next=e,HI(r)):(e.next=s.next,s.next=e),r.interleaved=e,Qu(n,t)}function C4(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,II(n,t)}}function E9(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Yk(n,e,t,r){var s=n.updateQueue;Ld=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,u=c=l=null,a=i;do{var f=a.lane,p=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,y=a;switch(f=e,p=t,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(p,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,f=typeof g=="function"?g.call(p,h,f):g,f==null)break e;h=wr({},h,f);break e;case 2:Ld=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);_0|=o,n.lanes=o,n.memoizedState=h}}function C9(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(Se(191,s));s.call(r)}}}var _w={},Cc=yf(_w),ab=yf(_w),lb=yf(_w);function Xf(n){if(n===_w)throw Error(Se(174));return n}function GI(n,e){switch(Wn(lb,e),Wn(ab,n),Wn(Cc,_w),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:SE(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=SE(e,n)}Zn(Cc),Wn(Cc,e)}function b1(){Zn(Cc),Zn(ab),Zn(lb)}function d$(n){Xf(lb.current);var e=Xf(Cc.current),t=SE(e,n.type);e!==t&&(Wn(ab,n),Wn(Cc,t))}function WI(n){ab.current===n&&(Zn(Cc),Zn(ab))}var mr=yf(0);function Xk(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var uT=[];function KI(){for(var n=0;n<uT.length;n++)uT[n]._workInProgressVersionPrimary=null;uT.length=0}var N4=dd.ReactCurrentDispatcher,dT=dd.ReactCurrentBatchConfig,k0=0,vr=null,ps=null,Is=null,Jk=!1,vx=!1,cb=0,cte=0;function oi(){throw Error(Se(321))}function YI(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Fl(n[t],e[t]))return!1;return!0}function XI(n,e,t,r,s,i){if(k0=i,vr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,N4.current=n===null||n.memoizedState===null?fte:pte,n=t(r,s),vx){i=0;do{if(vx=!1,cb=0,25<=i)throw Error(Se(301));i+=1,Is=ps=null,e.updateQueue=null,N4.current=mte,n=t(r,s)}while(vx)}if(N4.current=Qk,e=ps!==null&&ps.next!==null,k0=0,Is=ps=vr=null,Jk=!1,e)throw Error(Se(300));return n}function JI(){var n=cb!==0;return cb=0,n}function Ql(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Is===null?vr.memoizedState=Is=n:Is=Is.next=n,Is}function Za(){if(ps===null){var n=vr.alternate;n=n!==null?n.memoizedState:null}else n=ps.next;var e=Is===null?vr.memoizedState:Is.next;if(e!==null)Is=e,ps=n;else{if(n===null)throw Error(Se(310));ps=n,n={memoizedState:ps.memoizedState,baseState:ps.baseState,baseQueue:ps.baseQueue,queue:ps.queue,next:null},Is===null?vr.memoizedState=Is=n:Is=Is.next=n}return Is}function ub(n,e){return typeof e=="function"?e(n):e}function hT(n){var e=Za(),t=e.queue;if(t===null)throw Error(Se(311));t.lastRenderedReducer=n;var r=ps,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((k0&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,vr.lanes|=u,_0|=u}c=c.next}while(c!==null&&c!==i);l===null?o=r:l.next=a,Fl(r,e.memoizedState)||(Eo=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,vr.lanes|=i,_0|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function fT(n){var e=Za(),t=e.queue;if(t===null)throw Error(Se(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Fl(i,e.memoizedState)||(Eo=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function h$(){}function f$(n,e){var t=vr,r=Za(),s=e(),i=!Fl(r.memoizedState,s);if(i&&(r.memoizedState=s,Eo=!0),r=r.queue,QI(g$.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Is!==null&&Is.memoizedState.tag&1){if(t.flags|=2048,db(9,m$.bind(null,t,r,s,e),void 0,null),Ps===null)throw Error(Se(349));k0&30||p$(t,e,s)}return s}function p$(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=vr.updateQueue,e===null?(e={lastEffect:null,stores:null},vr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function m$(n,e,t,r){e.value=t,e.getSnapshot=r,y$(e)&&x$(n)}function g$(n,e,t){return t(function(){y$(e)&&x$(n)})}function y$(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Fl(n,t)}catch{return!0}}function x$(n){var e=Qu(n,1);e!==null&&Dl(e,n,1,-1)}function N9(n){var e=Ql();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ub,lastRenderedState:n},e.queue=n,n=n.dispatch=hte.bind(null,vr,n),[e.memoizedState,n]}function db(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=vr.updateQueue,e===null?(e={lastEffect:null,stores:null},vr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function b$(){return Za().memoizedState}function I4(n,e,t,r){var s=Ql();vr.flags|=n,s.memoizedState=db(1|e,t,void 0,r===void 0?null:r)}function h3(n,e,t,r){var s=Za();r=r===void 0?null:r;var i=void 0;if(ps!==null){var o=ps.memoizedState;if(i=o.destroy,r!==null&&YI(r,o.deps)){s.memoizedState=db(e,t,i,r);return}}vr.flags|=n,s.memoizedState=db(1|e,t,i,r)}function I9(n,e){return I4(8390656,8,n,e)}function QI(n,e){return h3(2048,8,n,e)}function v$(n,e){return h3(4,2,n,e)}function w$(n,e){return h3(4,4,n,e)}function k$(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function _$(n,e,t){return t=t!=null?t.concat([n]):null,h3(4,4,k$.bind(null,e,n),t)}function ZI(){}function S$(n,e){var t=Za();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&YI(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function T$(n,e){var t=Za();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&YI(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function A$(n,e,t){return k0&21?(Fl(t,e)||(t=RB(),vr.lanes|=t,_0|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Eo=!0),n.memoizedState=t)}function ute(n,e){var t=In;In=t!==0&&4>t?t:4,n(!0);var r=dT.transition;dT.transition={};try{n(!1),e()}finally{In=t,dT.transition=r}}function E$(){return Za().memoizedState}function dte(n,e,t){var r=Oh(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},C$(n))N$(e,t);else if(t=c$(n,e,t,r),t!==null){var s=Ki();Dl(t,n,r,s),I$(t,e,r)}}function hte(n,e,t){var r=Oh(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(C$(n))N$(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Fl(a,o)){var l=e.interleaved;l===null?(s.next=s,HI(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=c$(n,e,s,r),t!==null&&(s=Ki(),Dl(t,n,r,s),I$(t,e,r))}}function C$(n){var e=n.alternate;return n===vr||e!==null&&e===vr}function N$(n,e){vx=Jk=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function I$(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,II(n,t)}}var Qk={readContext:Qa,useCallback:oi,useContext:oi,useEffect:oi,useImperativeHandle:oi,useInsertionEffect:oi,useLayoutEffect:oi,useMemo:oi,useReducer:oi,useRef:oi,useState:oi,useDebugValue:oi,useDeferredValue:oi,useTransition:oi,useMutableSource:oi,useSyncExternalStore:oi,useId:oi,unstable_isNewReconciler:!1},fte={readContext:Qa,useCallback:function(n,e){return Ql().memoizedState=[n,e===void 0?null:e],n},useContext:Qa,useEffect:I9,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,I4(4194308,4,k$.bind(null,e,n),t)},useLayoutEffect:function(n,e){return I4(4194308,4,n,e)},useInsertionEffect:function(n,e){return I4(4,2,n,e)},useMemo:function(n,e){var t=Ql();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ql();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=dte.bind(null,vr,n),[r.memoizedState,n]},useRef:function(n){var e=Ql();return n={current:n},e.memoizedState=n},useState:N9,useDebugValue:ZI,useDeferredValue:function(n){return Ql().memoizedState=n},useTransition:function(){var n=N9(!1),e=n[0];return n=ute.bind(null,n[1]),Ql().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=vr,s=Ql();if(ir){if(t===void 0)throw Error(Se(407));t=t()}else{if(t=e(),Ps===null)throw Error(Se(349));k0&30||p$(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,I9(g$.bind(null,r,i,n),[n]),r.flags|=2048,db(9,m$.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ql(),e=Ps.identifierPrefix;if(ir){var t=Fu,r=Ou;t=(r&~(1<<32-Ll(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=cb++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=cte++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},pte={readContext:Qa,useCallback:S$,useContext:Qa,useEffect:QI,useImperativeHandle:_$,useInsertionEffect:v$,useLayoutEffect:w$,useMemo:T$,useReducer:hT,useRef:b$,useState:function(){return hT(ub)},useDebugValue:ZI,useDeferredValue:function(n){var e=Za();return A$(e,ps.memoizedState,n)},useTransition:function(){var n=hT(ub)[0],e=Za().memoizedState;return[n,e]},useMutableSource:h$,useSyncExternalStore:f$,useId:E$,unstable_isNewReconciler:!1},mte={readContext:Qa,useCallback:S$,useContext:Qa,useEffect:QI,useImperativeHandle:_$,useInsertionEffect:v$,useLayoutEffect:w$,useMemo:T$,useReducer:fT,useRef:b$,useState:function(){return fT(ub)},useDebugValue:ZI,useDeferredValue:function(n){var e=Za();return ps===null?e.memoizedState=n:A$(e,ps.memoizedState,n)},useTransition:function(){var n=fT(ub)[0],e=Za().memoizedState;return[n,e]},useMutableSource:h$,useSyncExternalStore:f$,useId:E$,unstable_isNewReconciler:!1};function hl(n,e){if(n&&n.defaultProps){e=wr({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function qE(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:wr({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var f3={isMounted:function(n){return(n=n._reactInternals)?V0(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Ki(),s=Oh(n),i=Vu(r,s);i.payload=e,t!=null&&(i.callback=t),e=Dh(n,i,s),e!==null&&(Dl(e,n,s,r),C4(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Ki(),s=Oh(n),i=Vu(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Dh(n,i,s),e!==null&&(Dl(e,n,s,r),C4(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ki(),r=Oh(n),s=Vu(t,r);s.tag=2,e!=null&&(s.callback=e),e=Dh(n,s,r),e!==null&&(Dl(e,n,r,t),C4(e,n,r))}};function R9(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!rb(t,r)||!rb(s,i):!0}function R$(n,e,t){var r=!1,s=Qh,i=e.contextType;return typeof i=="object"&&i!==null?i=Qa(i):(s=Ro(e)?v0:Ti.current,r=e.contextTypes,i=(r=r!=null)?g1(n,s):Qh),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=f3,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function M9(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&f3.enqueueReplaceState(e,e.state,null)}function GE(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},qI(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Qa(i):(i=Ro(e)?v0:Ti.current,s.context=g1(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qE(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&f3.enqueueReplaceState(s,s.state,null),Yk(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function v1(n,e){try{var t="",r=e;do t+=UZ(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function pT(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function WE(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gte=typeof WeakMap=="function"?WeakMap:Map;function M$(n,e,t){t=Vu(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){e_||(e_=!0,r6=r),WE(n,e)},t}function P$(n,e,t){t=Vu(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){WE(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){WE(n,e),typeof r!="function"&&(jh===null?jh=new Set([this]):jh.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function P9(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new gte;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=Ite.bind(null,n,e,t),e.then(n,n))}function L9(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function D9(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Vu(-1,1),e.tag=2,Dh(t,e,1))),t.lanes|=1),n)}var yte=dd.ReactCurrentOwner,Eo=!1;function Vi(n,e,t,r){e.child=n===null?l$(e,null,t,r):x1(e,n.child,t,r)}function j9(n,e,t,r,s){t=t.render;var i=e.ref;return Ym(e,s),r=XI(n,e,t,r,i,s),t=JI(),n!==null&&!Eo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Zu(n,e,s)):(ir&&t&&FI(e),e.flags|=1,Vi(n,e,r,s),e.child)}function O9(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!a7(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,L$(n,e,i,r,s)):(n=L4(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:rb,t(o,r)&&n.ref===e.ref)return Zu(n,e,s)}return e.flags|=1,n=Fh(i,r),n.ref=e.ref,n.return=e,e.child=n}function L$(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(rb(i,r)&&n.ref===e.ref)if(Eo=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Eo=!0);else return e.lanes=n.lanes,Zu(n,e,s)}return KE(n,e,t,r,s)}function D$(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Wn(Bm,ea),ea|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Wn(Bm,ea),ea|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Wn(Bm,ea),ea|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Wn(Bm,ea),ea|=r;return Vi(n,e,s,t),e.child}function j$(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function KE(n,e,t,r,s){var i=Ro(t)?v0:Ti.current;return i=g1(e,i),Ym(e,s),t=XI(n,e,t,r,i,s),r=JI(),n!==null&&!Eo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Zu(n,e,s)):(ir&&r&&FI(e),e.flags|=1,Vi(n,e,t,s),e.child)}function F9(n,e,t,r,s){if(Ro(t)){var i=!0;Hk(e)}else i=!1;if(Ym(e,s),e.stateNode===null)R4(n,e),R$(e,t,r),GE(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Qa(c):(c=Ro(t)?v0:Ti.current,c=g1(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&M9(e,o,r,c),Ld=!1;var f=e.memoizedState;o.state=f,Yk(e,r,o,s),l=e.memoizedState,a!==r||f!==l||Io.current||Ld?(typeof u=="function"&&(qE(e,t,u,r),l=e.memoizedState),(a=Ld||R9(e,t,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,u$(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:hl(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Qa(l):(l=Ro(t)?v0:Ti.current,l=g1(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&M9(e,o,r,l),Ld=!1,f=e.memoizedState,o.state=f,Yk(e,r,o,s);var g=e.memoizedState;a!==h||f!==g||Io.current||Ld?(typeof p=="function"&&(qE(e,t,p,r),g=e.memoizedState),(c=Ld||R9(e,t,c,r,f,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return YE(n,e,t,r,i,s)}function YE(n,e,t,r,s,i){j$(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&_9(e,t,!1),Zu(n,e,i);r=e.stateNode,yte.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=x1(e,n.child,null,i),e.child=x1(e,null,a,i)):Vi(n,e,a,i),e.memoizedState=r.state,s&&_9(e,t,!0),e.child}function O$(n){var e=n.stateNode;e.pendingContext?k9(n,e.pendingContext,e.pendingContext!==e.context):e.context&&k9(n,e.context,!1),GI(n,e.containerInfo)}function z9(n,e,t,r,s){return y1(),BI(s),e.flags|=256,Vi(n,e,t,r),e.child}var XE={dehydrated:null,treeContext:null,retryLane:0};function JE(n){return{baseLanes:n,cachePool:null,transitions:null}}function F$(n,e,t){var r=e.pendingProps,s=mr.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Wn(mr,s&1),n===null)return UE(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=g3(o,r,0,null),n=c0(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=JE(t),e.memoizedState=XE,n):e7(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return xte(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Fh(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Fh(a,i):(i=c0(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?JE(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=XE,r}return i=n.child,n=i.sibling,r=Fh(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function e7(n,e){return e=g3({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function R2(n,e,t,r){return r!==null&&BI(r),x1(e,n.child,null,t),n=e7(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function xte(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=pT(Error(Se(422))),R2(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=g3({mode:"visible",children:r.children},s,0,null),i=c0(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&x1(e,n.child,null,o),e.child.memoizedState=JE(o),e.memoizedState=XE,i);if(!(e.mode&1))return R2(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Se(419)),r=pT(i,r,void 0),R2(n,e,o,r)}if(a=(o&n.childLanes)!==0,Eo||a){if(r=Ps,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Qu(n,s),Dl(r,n,s,-1))}return o7(),r=pT(Error(Se(421))),R2(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Rte.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,ia=Lh(s.nextSibling),la=e,ir=!0,Cl=null,n!==null&&(Fa[za++]=Ou,Fa[za++]=Fu,Fa[za++]=w0,Ou=n.id,Fu=n.overflow,w0=e),e=e7(e,r.children),e.flags|=4096,e)}function B9(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),HE(n.return,e,t)}function mT(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function z$(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Vi(n,e,r.children,t),r=mr.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&B9(n,t,e);else if(n.tag===19)B9(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Wn(mr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Xk(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),mT(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Xk(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}mT(e,!0,t,null,i);break;case"together":mT(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function R4(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Zu(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),_0|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Se(153));if(e.child!==null){for(n=e.child,t=Fh(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Fh(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function bte(n,e,t){switch(e.tag){case 3:O$(e),y1();break;case 5:d$(e);break;case 1:Ro(e.type)&&Hk(e);break;case 4:GI(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Wn(Wk,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Wn(mr,mr.current&1),e.flags|=128,null):t&e.child.childLanes?F$(n,e,t):(Wn(mr,mr.current&1),n=Zu(n,e,t),n!==null?n.sibling:null);Wn(mr,mr.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return z$(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Wn(mr,mr.current),r)break;return null;case 22:case 23:return e.lanes=0,D$(n,e,t)}return Zu(n,e,t)}var B$,QE,$$,V$;B$=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};QE=function(){};$$=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Xf(Cc.current);var i=null;switch(t){case"input":s=vE(n,s),r=vE(n,r),i=[];break;case"select":s=wr({},s,{value:void 0}),r=wr({},r,{value:void 0}),i=[];break;case"textarea":s=_E(n,s),r=_E(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Vk)}TE(t,r);var o;t=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Xx.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Xx.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Xn("scroll",n),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};V$=function(n,e,t,r){t!==r&&(e.flags|=4)};function gy(n,e){if(!ir)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function ai(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function vte(n,e,t){var r=e.pendingProps;switch(zI(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ai(e),null;case 1:return Ro(e.type)&&Uk(),ai(e),null;case 3:return r=e.stateNode,b1(),Zn(Io),Zn(Ti),KI(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(N2(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Cl!==null&&(o6(Cl),Cl=null))),QE(n,e),ai(e),null;case 5:WI(e);var s=Xf(lb.current);if(t=e.type,n!==null&&e.stateNode!=null)$$(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Se(166));return ai(e),null}if(n=Xf(Cc.current),N2(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[_c]=e,r[ob]=i,n=(e.mode&1)!==0,t){case"dialog":Xn("cancel",r),Xn("close",r);break;case"iframe":case"object":case"embed":Xn("load",r);break;case"video":case"audio":for(s=0;s<Fy.length;s++)Xn(Fy[s],r);break;case"source":Xn("error",r);break;case"img":case"image":case"link":Xn("error",r),Xn("load",r);break;case"details":Xn("toggle",r);break;case"input":YM(r,i),Xn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Xn("invalid",r);break;case"textarea":JM(r,i),Xn("invalid",r)}TE(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&C2(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&C2(r.textContent,a,n),s=["children",""+a]):Xx.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Xn("scroll",r)}switch(t){case"input":v2(r),XM(r,i,!0);break;case"textarea":v2(r),QM(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Vk)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=gB(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[_c]=e,n[ob]=r,B$(n,e,!1,!1),e.stateNode=n;e:{switch(o=AE(t,r),t){case"dialog":Xn("cancel",n),Xn("close",n),s=r;break;case"iframe":case"object":case"embed":Xn("load",n),s=r;break;case"video":case"audio":for(s=0;s<Fy.length;s++)Xn(Fy[s],n);s=r;break;case"source":Xn("error",n),s=r;break;case"img":case"image":case"link":Xn("error",n),Xn("load",n),s=r;break;case"details":Xn("toggle",n),s=r;break;case"input":YM(n,r),s=vE(n,r),Xn("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=wr({},r,{value:void 0}),Xn("invalid",n);break;case"textarea":JM(n,r),s=_E(n,r),Xn("invalid",n);break;default:s=r}TE(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?bB(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&yB(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Jx(n,l):typeof l=="number"&&Jx(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Xx.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Xn("scroll",n):l!=null&&SI(n,i,l,o))}switch(t){case"input":v2(n),XM(n,r,!1);break;case"textarea":v2(n),QM(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Jh(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?qm(n,!!r.multiple,i,!1):r.defaultValue!=null&&qm(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Vk)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ai(e),null;case 6:if(n&&e.stateNode!=null)V$(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Se(166));if(t=Xf(lb.current),Xf(Cc.current),N2(e)){if(r=e.stateNode,t=e.memoizedProps,r[_c]=e,(i=r.nodeValue!==t)&&(n=la,n!==null))switch(n.tag){case 3:C2(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&C2(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[_c]=e,e.stateNode=r}return ai(e),null;case 13:if(Zn(mr),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ir&&ia!==null&&e.mode&1&&!(e.flags&128))o$(),y1(),e.flags|=98560,i=!1;else if(i=N2(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(Se(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Se(317));i[_c]=e}else y1(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ai(e),i=!1}else Cl!==null&&(o6(Cl),Cl=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||mr.current&1?ms===0&&(ms=3):o7())),e.updateQueue!==null&&(e.flags|=4),ai(e),null);case 4:return b1(),QE(n,e),n===null&&sb(e.stateNode.containerInfo),ai(e),null;case 10:return UI(e.type._context),ai(e),null;case 17:return Ro(e.type)&&Uk(),ai(e),null;case 19:if(Zn(mr),i=e.memoizedState,i===null)return ai(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)gy(i,!1);else{if(ms!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Xk(n),o!==null){for(e.flags|=128,gy(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Wn(mr,mr.current&1|2),e.child}n=n.sibling}i.tail!==null&&Vr()>w1&&(e.flags|=128,r=!0,gy(i,!1),e.lanes=4194304)}else{if(!r)if(n=Xk(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),gy(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ir)return ai(e),null}else 2*Vr()-i.renderingStartTime>w1&&t!==1073741824&&(e.flags|=128,r=!0,gy(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Vr(),e.sibling=null,t=mr.current,Wn(mr,r?t&1|2:t&1),e):(ai(e),null);case 22:case 23:return i7(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ea&1073741824&&(ai(e),e.subtreeFlags&6&&(e.flags|=8192)):ai(e),null;case 24:return null;case 25:return null}throw Error(Se(156,e.tag))}function wte(n,e){switch(zI(e),e.tag){case 1:return Ro(e.type)&&Uk(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return b1(),Zn(Io),Zn(Ti),KI(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return WI(e),null;case 13:if(Zn(mr),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Se(340));y1()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Zn(mr),null;case 4:return b1(),null;case 10:return UI(e.type._context),null;case 22:case 23:return i7(),null;case 24:return null;default:return null}}var M2=!1,bi=!1,kte=typeof WeakSet=="function"?WeakSet:Set,Ue=null;function zm(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Rr(n,e,r)}else t.current=null}function ZE(n,e,t){try{t()}catch(r){Rr(n,e,r)}}var $9=!1;function _te(n,e){if(jE=zk,n=WB(),OI(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=n,f=null;t:for(;;){for(var p;h!==t||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===n)break t;if(f===t&&++c===s&&(a=o),f===i&&++u===r&&(l=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(OE={focusedElem:n,selectionRange:t},zk=!1,Ue=e;Ue!==null;)if(e=Ue,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ue=n;else for(;Ue!==null;){e=Ue;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,v=g.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?y:hl(e.type,y),v);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(T){Rr(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,Ue=n;break}Ue=e.return}return g=$9,$9=!1,g}function wx(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&ZE(e,t,i)}s=s.next}while(s!==r)}}function p3(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function e6(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function U$(n){var e=n.alternate;e!==null&&(n.alternate=null,U$(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[_c],delete e[ob],delete e[BE],delete e[ite],delete e[ote])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function H$(n){return n.tag===5||n.tag===3||n.tag===4}function V9(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||H$(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function t6(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Vk));else if(r!==4&&(n=n.child,n!==null))for(t6(n,e,t),n=n.sibling;n!==null;)t6(n,e,t),n=n.sibling}function n6(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(n6(n,e,t),n=n.sibling;n!==null;)n6(n,e,t),n=n.sibling}var qs=null,Al=!1;function Td(n,e,t){for(t=t.child;t!==null;)q$(n,e,t),t=t.sibling}function q$(n,e,t){if(Ec&&typeof Ec.onCommitFiberUnmount=="function")try{Ec.onCommitFiberUnmount(o3,t)}catch{}switch(t.tag){case 5:bi||zm(t,e);case 6:var r=qs,s=Al;qs=null,Td(n,e,t),qs=r,Al=s,qs!==null&&(Al?(n=qs,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):qs.removeChild(t.stateNode));break;case 18:qs!==null&&(Al?(n=qs,t=t.stateNode,n.nodeType===8?lT(n.parentNode,t):n.nodeType===1&&lT(n,t),tb(n)):lT(qs,t.stateNode));break;case 4:r=qs,s=Al,qs=t.stateNode.containerInfo,Al=!0,Td(n,e,t),qs=r,Al=s;break;case 0:case 11:case 14:case 15:if(!bi&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&ZE(t,e,o),s=s.next}while(s!==r)}Td(n,e,t);break;case 1:if(!bi&&(zm(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Rr(t,e,a)}Td(n,e,t);break;case 21:Td(n,e,t);break;case 22:t.mode&1?(bi=(r=bi)||t.memoizedState!==null,Td(n,e,t),bi=r):Td(n,e,t);break;default:Td(n,e,t)}}function U9(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new kte),e.forEach(function(r){var s=Mte.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function cl(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:qs=a.stateNode,Al=!1;break e;case 3:qs=a.stateNode.containerInfo,Al=!0;break e;case 4:qs=a.stateNode.containerInfo,Al=!0;break e}a=a.return}if(qs===null)throw Error(Se(160));q$(i,o,s),qs=null,Al=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){Rr(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)G$(e,n),e=e.sibling}function G$(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(cl(e,n),Gl(n),r&4){try{wx(3,n,n.return),p3(3,n)}catch(y){Rr(n,n.return,y)}try{wx(5,n,n.return)}catch(y){Rr(n,n.return,y)}}break;case 1:cl(e,n),Gl(n),r&512&&t!==null&&zm(t,t.return);break;case 5:if(cl(e,n),Gl(n),r&512&&t!==null&&zm(t,t.return),n.flags&32){var s=n.stateNode;try{Jx(s,"")}catch(y){Rr(n,n.return,y)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&pB(s,i),AE(a,o);var c=AE(a,i);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?bB(s,h):u==="dangerouslySetInnerHTML"?yB(s,h):u==="children"?Jx(s,h):SI(s,u,h,c)}switch(a){case"input":wE(s,i);break;case"textarea":mB(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?qm(s,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?qm(s,!!i.multiple,i.defaultValue,!0):qm(s,!!i.multiple,i.multiple?[]:"",!1))}s[ob]=i}catch(y){Rr(n,n.return,y)}}break;case 6:if(cl(e,n),Gl(n),r&4){if(n.stateNode===null)throw Error(Se(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(y){Rr(n,n.return,y)}}break;case 3:if(cl(e,n),Gl(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{tb(e.containerInfo)}catch(y){Rr(n,n.return,y)}break;case 4:cl(e,n),Gl(n);break;case 13:cl(e,n),Gl(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(r7=Vr())),r&4&&U9(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(bi=(c=bi)||u,cl(e,n),bi=c):cl(e,n),Gl(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Ue=n,u=n.child;u!==null;){for(h=Ue=u;Ue!==null;){switch(f=Ue,p=f.child,f.tag){case 0:case 11:case 14:case 15:wx(4,f,f.return);break;case 1:zm(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){Rr(r,t,y)}}break;case 5:zm(f,f.return);break;case 22:if(f.memoizedState!==null){q9(h);continue}}p!==null?(p.return=f,Ue=p):q9(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=xB("display",o))}catch(y){Rr(n,n.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Rr(n,n.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:cl(e,n),Gl(n),r&4&&U9(n);break;case 21:break;default:cl(e,n),Gl(n)}}function Gl(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(H$(t)){var r=t;break e}t=t.return}throw Error(Se(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Jx(s,""),r.flags&=-33);var i=V9(n);n6(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=V9(n);t6(n,a,o);break;default:throw Error(Se(161))}}catch(l){Rr(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Ste(n,e,t){Ue=n,W$(n)}function W$(n,e,t){for(var r=(n.mode&1)!==0;Ue!==null;){var s=Ue,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||M2;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||bi;a=M2;var c=bi;if(M2=o,(bi=l)&&!c)for(Ue=s;Ue!==null;)o=Ue,l=o.child,o.tag===22&&o.memoizedState!==null?G9(s):l!==null?(l.return=o,Ue=l):G9(s);for(;i!==null;)Ue=i,W$(i),i=i.sibling;Ue=s,M2=a,bi=c}H9(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ue=i):H9(n)}}function H9(n){for(;Ue!==null;){var e=Ue;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bi||p3(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bi)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:hl(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&C9(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}C9(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&tb(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}bi||e.flags&512&&e6(e)}catch(f){Rr(e,e.return,f)}}if(e===n){Ue=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ue=t;break}Ue=e.return}}function q9(n){for(;Ue!==null;){var e=Ue;if(e===n){Ue=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ue=t;break}Ue=e.return}}function G9(n){for(;Ue!==null;){var e=Ue;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{p3(4,e)}catch(l){Rr(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Rr(e,s,l)}}var i=e.return;try{e6(e)}catch(l){Rr(e,i,l)}break;case 5:var o=e.return;try{e6(e)}catch(l){Rr(e,o,l)}}}catch(l){Rr(e,e.return,l)}if(e===n){Ue=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ue=a;break}Ue=e.return}}var Tte=Math.ceil,Zk=dd.ReactCurrentDispatcher,t7=dd.ReactCurrentOwner,Wa=dd.ReactCurrentBatchConfig,hn=0,Ps=null,Kr=null,Qs=0,ea=0,Bm=yf(0),ms=0,hb=null,_0=0,m3=0,n7=0,kx=null,So=null,r7=0,w1=1/0,iu=null,e_=!1,r6=null,jh=null,P2=!1,Sh=null,t_=0,_x=0,s6=null,M4=-1,P4=0;function Ki(){return hn&6?Vr():M4!==-1?M4:M4=Vr()}function Oh(n){return n.mode&1?hn&2&&Qs!==0?Qs&-Qs:lte.transition!==null?(P4===0&&(P4=RB()),P4):(n=In,n!==0||(n=window.event,n=n===void 0?16:FB(n.type)),n):1}function Dl(n,e,t,r){if(50<_x)throw _x=0,s6=null,Error(Se(185));vw(n,t,r),(!(hn&2)||n!==Ps)&&(n===Ps&&(!(hn&2)&&(m3|=t),ms===4&&zd(n,Qs)),Mo(n,r),t===1&&hn===0&&!(e.mode&1)&&(w1=Vr()+500,d3&&xf()))}function Mo(n,e){var t=n.callbackNode;lee(n,e);var r=Fk(n,n===Ps?Qs:0);if(r===0)t!==null&&t9(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&t9(t),e===1)n.tag===0?ate(W9.bind(null,n)):r$(W9.bind(null,n)),rte(function(){!(hn&6)&&xf()}),t=null;else{switch(MB(r)){case 1:t=NI;break;case 4:t=NB;break;case 16:t=Ok;break;case 536870912:t=IB;break;default:t=Ok}t=tV(t,K$.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function K$(n,e){if(M4=-1,P4=0,hn&6)throw Error(Se(327));var t=n.callbackNode;if(Xm()&&n.callbackNode!==t)return null;var r=Fk(n,n===Ps?Qs:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=n_(n,r);else{e=r;var s=hn;hn|=2;var i=X$();(Ps!==n||Qs!==e)&&(iu=null,w1=Vr()+500,l0(n,e));do try{Cte();break}catch(a){Y$(n,a)}while(!0);VI(),Zk.current=i,hn=s,Kr!==null?e=0:(Ps=null,Qs=0,e=ms)}if(e!==0){if(e===2&&(s=RE(n),s!==0&&(r=s,e=i6(n,s))),e===1)throw t=hb,l0(n,0),zd(n,r),Mo(n,Vr()),t;if(e===6)zd(n,r);else{if(s=n.current.alternate,!(r&30)&&!Ate(s)&&(e=n_(n,r),e===2&&(i=RE(n),i!==0&&(r=i,e=i6(n,i))),e===1))throw t=hb,l0(n,0),zd(n,r),Mo(n,Vr()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(Se(345));case 2:Ff(n,So,iu);break;case 3:if(zd(n,r),(r&130023424)===r&&(e=r7+500-Vr(),10<e)){if(Fk(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Ki(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=zE(Ff.bind(null,n,So,iu),e);break}Ff(n,So,iu);break;case 4:if(zd(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-Ll(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Vr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tte(r/1960))-r,10<r){n.timeoutHandle=zE(Ff.bind(null,n,So,iu),r);break}Ff(n,So,iu);break;case 5:Ff(n,So,iu);break;default:throw Error(Se(329))}}}return Mo(n,Vr()),n.callbackNode===t?K$.bind(null,n):null}function i6(n,e){var t=kx;return n.current.memoizedState.isDehydrated&&(l0(n,e).flags|=256),n=n_(n,e),n!==2&&(e=So,So=t,e!==null&&o6(e)),n}function o6(n){So===null?So=n:So.push.apply(So,n)}function Ate(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Fl(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zd(n,e){for(e&=~n7,e&=~m3,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Ll(e),r=1<<t;n[t]=-1,e&=~r}}function W9(n){if(hn&6)throw Error(Se(327));Xm();var e=Fk(n,0);if(!(e&1))return Mo(n,Vr()),null;var t=n_(n,e);if(n.tag!==0&&t===2){var r=RE(n);r!==0&&(e=r,t=i6(n,r))}if(t===1)throw t=hb,l0(n,0),zd(n,e),Mo(n,Vr()),t;if(t===6)throw Error(Se(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ff(n,So,iu),Mo(n,Vr()),null}function s7(n,e){var t=hn;hn|=1;try{return n(e)}finally{hn=t,hn===0&&(w1=Vr()+500,d3&&xf())}}function S0(n){Sh!==null&&Sh.tag===0&&!(hn&6)&&Xm();var e=hn;hn|=1;var t=Wa.transition,r=In;try{if(Wa.transition=null,In=1,n)return n()}finally{In=r,Wa.transition=t,hn=e,!(hn&6)&&xf()}}function i7(){ea=Bm.current,Zn(Bm)}function l0(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,nte(t)),Kr!==null)for(t=Kr.return;t!==null;){var r=t;switch(zI(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Uk();break;case 3:b1(),Zn(Io),Zn(Ti),KI();break;case 5:WI(r);break;case 4:b1();break;case 13:Zn(mr);break;case 19:Zn(mr);break;case 10:UI(r.type._context);break;case 22:case 23:i7()}t=t.return}if(Ps=n,Kr=n=Fh(n.current,null),Qs=ea=e,ms=0,hb=null,n7=m3=_0=0,So=kx=null,Yf!==null){for(e=0;e<Yf.length;e++)if(t=Yf[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Yf=null}return n}function Y$(n,e){do{var t=Kr;try{if(VI(),N4.current=Qk,Jk){for(var r=vr.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Jk=!1}if(k0=0,Is=ps=vr=null,vx=!1,cb=0,t7.current=null,t===null||t.return===null){ms=1,hb=e,Kr=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Qs,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=L9(o);if(p!==null){p.flags&=-257,D9(p,o,a,i,e),p.mode&1&&P9(i,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){P9(i,c,e),o7();break e}l=Error(Se(426))}}else if(ir&&a.mode&1){var v=L9(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),D9(v,o,a,i,e),BI(v1(l,a));break e}}i=l=v1(l,a),ms!==4&&(ms=2),kx===null?kx=[i]:kx.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=M$(i,l,e);E9(i,b);break e;case 1:a=l;var w=i.type,k=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(jh===null||!jh.has(k)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=P$(i,a,e);E9(i,T);break e}}i=i.return}while(i!==null)}Q$(t)}catch(R){e=R,Kr===t&&t!==null&&(Kr=t=t.return);continue}break}while(!0)}function X$(){var n=Zk.current;return Zk.current=Qk,n===null?Qk:n}function o7(){(ms===0||ms===3||ms===2)&&(ms=4),Ps===null||!(_0&268435455)&&!(m3&268435455)||zd(Ps,Qs)}function n_(n,e){var t=hn;hn|=2;var r=X$();(Ps!==n||Qs!==e)&&(iu=null,l0(n,e));do try{Ete();break}catch(s){Y$(n,s)}while(!0);if(VI(),hn=t,Zk.current=r,Kr!==null)throw Error(Se(261));return Ps=null,Qs=0,ms}function Ete(){for(;Kr!==null;)J$(Kr)}function Cte(){for(;Kr!==null&&!ZZ();)J$(Kr)}function J$(n){var e=eV(n.alternate,n,ea);n.memoizedProps=n.pendingProps,e===null?Q$(n):Kr=e,t7.current=null}function Q$(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=wte(t,e),t!==null){t.flags&=32767,Kr=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ms=6,Kr=null;return}}else if(t=vte(t,e,ea),t!==null){Kr=t;return}if(e=e.sibling,e!==null){Kr=e;return}Kr=e=n}while(e!==null);ms===0&&(ms=5)}function Ff(n,e,t){var r=In,s=Wa.transition;try{Wa.transition=null,In=1,Nte(n,e,t,r)}finally{Wa.transition=s,In=r}return null}function Nte(n,e,t,r){do Xm();while(Sh!==null);if(hn&6)throw Error(Se(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Se(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(cee(n,i),n===Ps&&(Kr=Ps=null,Qs=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||P2||(P2=!0,tV(Ok,function(){return Xm(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Wa.transition,Wa.transition=null;var o=In;In=1;var a=hn;hn|=4,t7.current=null,_te(n,t),G$(t,n),Yee(OE),zk=!!jE,OE=jE=null,n.current=t,Ste(t),eee(),hn=a,In=o,Wa.transition=i}else n.current=t;if(P2&&(P2=!1,Sh=n,t_=s),i=n.pendingLanes,i===0&&(jh=null),ree(t.stateNode),Mo(n,Vr()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(e_)throw e_=!1,n=r6,r6=null,n;return t_&1&&n.tag!==0&&Xm(),i=n.pendingLanes,i&1?n===s6?_x++:(_x=0,s6=n):_x=0,xf(),null}function Xm(){if(Sh!==null){var n=MB(t_),e=Wa.transition,t=In;try{if(Wa.transition=null,In=16>n?16:n,Sh===null)var r=!1;else{if(n=Sh,Sh=null,t_=0,hn&6)throw Error(Se(331));var s=hn;for(hn|=4,Ue=n.current;Ue!==null;){var i=Ue,o=i.child;if(Ue.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Ue=c;Ue!==null;){var u=Ue;switch(u.tag){case 0:case 11:case 15:wx(8,u,i)}var h=u.child;if(h!==null)h.return=u,Ue=h;else for(;Ue!==null;){u=Ue;var f=u.sibling,p=u.return;if(U$(u),u===c){Ue=null;break}if(f!==null){f.return=p,Ue=f;break}Ue=p}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}Ue=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ue=o;else e:for(;Ue!==null;){if(i=Ue,i.flags&2048)switch(i.tag){case 0:case 11:case 15:wx(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,Ue=b;break e}Ue=i.return}}var w=n.current;for(Ue=w;Ue!==null;){o=Ue;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,Ue=k;else e:for(o=w;Ue!==null;){if(a=Ue,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:p3(9,a)}}catch(R){Rr(a,a.return,R)}if(a===o){Ue=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,Ue=T;break e}Ue=a.return}}if(hn=s,xf(),Ec&&typeof Ec.onPostCommitFiberRoot=="function")try{Ec.onPostCommitFiberRoot(o3,n)}catch{}r=!0}return r}finally{In=t,Wa.transition=e}}return!1}function K9(n,e,t){e=v1(t,e),e=M$(n,e,1),n=Dh(n,e,1),e=Ki(),n!==null&&(vw(n,1,e),Mo(n,e))}function Rr(n,e,t){if(n.tag===3)K9(n,n,t);else for(;e!==null;){if(e.tag===3){K9(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(jh===null||!jh.has(r))){n=v1(t,n),n=P$(e,n,1),e=Dh(e,n,1),n=Ki(),e!==null&&(vw(e,1,n),Mo(e,n));break}}e=e.return}}function Ite(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Ki(),n.pingedLanes|=n.suspendedLanes&t,Ps===n&&(Qs&t)===t&&(ms===4||ms===3&&(Qs&130023424)===Qs&&500>Vr()-r7?l0(n,0):n7|=t),Mo(n,e)}function Z$(n,e){e===0&&(n.mode&1?(e=_2,_2<<=1,!(_2&130023424)&&(_2=4194304)):e=1);var t=Ki();n=Qu(n,e),n!==null&&(vw(n,e,t),Mo(n,t))}function Rte(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Z$(n,t)}function Mte(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Se(314))}r!==null&&r.delete(e),Z$(n,t)}var eV;eV=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Io.current)Eo=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Eo=!1,bte(n,e,t);Eo=!!(n.flags&131072)}else Eo=!1,ir&&e.flags&1048576&&s$(e,Gk,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;R4(n,e),n=e.pendingProps;var s=g1(e,Ti.current);Ym(e,t),s=XI(null,e,r,n,s,t);var i=JI();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ro(r)?(i=!0,Hk(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,qI(e),s.updater=f3,e.stateNode=s,s._reactInternals=e,GE(e,r,n,t),e=YE(null,e,r,!0,i,t)):(e.tag=0,ir&&i&&FI(e),Vi(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(R4(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Lte(r),n=hl(r,n),s){case 0:e=KE(null,e,r,n,t);break e;case 1:e=F9(null,e,r,n,t);break e;case 11:e=j9(null,e,r,n,t);break e;case 14:e=O9(null,e,r,hl(r.type,n),t);break e}throw Error(Se(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hl(r,s),KE(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hl(r,s),F9(n,e,r,s,t);case 3:e:{if(O$(e),n===null)throw Error(Se(387));r=e.pendingProps,i=e.memoizedState,s=i.element,u$(n,e),Yk(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=v1(Error(Se(423)),e),e=z9(n,e,r,t,s);break e}else if(r!==s){s=v1(Error(Se(424)),e),e=z9(n,e,r,t,s);break e}else for(ia=Lh(e.stateNode.containerInfo.firstChild),la=e,ir=!0,Cl=null,t=l$(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(y1(),r===s){e=Zu(n,e,t);break e}Vi(n,e,r,t)}e=e.child}return e;case 5:return d$(e),n===null&&UE(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,FE(r,s)?o=null:i!==null&&FE(r,i)&&(e.flags|=32),j$(n,e),Vi(n,e,o,t),e.child;case 6:return n===null&&UE(e),null;case 13:return F$(n,e,t);case 4:return GI(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=x1(e,null,r,t):Vi(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hl(r,s),j9(n,e,r,s,t);case 7:return Vi(n,e,e.pendingProps,t),e.child;case 8:return Vi(n,e,e.pendingProps.children,t),e.child;case 12:return Vi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Wn(Wk,r._currentValue),r._currentValue=o,i!==null)if(Fl(i.value,o)){if(i.children===s.children&&!Io.current){e=Zu(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Vu(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),HE(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Se(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),HE(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Vi(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Ym(e,t),s=Qa(s),r=r(s),e.flags|=1,Vi(n,e,r,t),e.child;case 14:return r=e.type,s=hl(r,e.pendingProps),s=hl(r.type,s),O9(n,e,r,s,t);case 15:return L$(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hl(r,s),R4(n,e),e.tag=1,Ro(r)?(n=!0,Hk(e)):n=!1,Ym(e,t),R$(e,r,s),GE(e,r,s,t),YE(null,e,r,!0,n,t);case 19:return z$(n,e,t);case 22:return D$(n,e,t)}throw Error(Se(156,e.tag))};function tV(n,e){return CB(n,e)}function Pte(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qa(n,e,t,r){return new Pte(n,e,t,r)}function a7(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Lte(n){if(typeof n=="function")return a7(n)?1:0;if(n!=null){if(n=n.$$typeof,n===AI)return 11;if(n===EI)return 14}return 2}function Fh(n,e){var t=n.alternate;return t===null?(t=qa(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function L4(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")a7(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Im:return c0(t.children,s,i,e);case TI:o=8,s|=8;break;case gE:return n=qa(12,t,e,s|2),n.elementType=gE,n.lanes=i,n;case yE:return n=qa(13,t,e,s),n.elementType=yE,n.lanes=i,n;case xE:return n=qa(19,t,e,s),n.elementType=xE,n.lanes=i,n;case dB:return g3(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case cB:o=10;break e;case uB:o=9;break e;case AI:o=11;break e;case EI:o=14;break e;case Pd:o=16,r=null;break e}throw Error(Se(130,n==null?n:typeof n,""))}return e=qa(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function c0(n,e,t,r){return n=qa(7,n,r,e),n.lanes=t,n}function g3(n,e,t,r){return n=qa(22,n,r,e),n.elementType=dB,n.lanes=t,n.stateNode={isHidden:!1},n}function gT(n,e,t){return n=qa(6,n,null,e),n.lanes=t,n}function yT(n,e,t){return e=qa(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Dte(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=JS(0),this.expirationTimes=JS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=JS(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function l7(n,e,t,r,s,i,o,a,l){return n=new Dte(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=qa(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},qI(i),n}function jte(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nm,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function nV(n){if(!n)return Qh;n=n._reactInternals;e:{if(V0(n)!==n||n.tag!==1)throw Error(Se(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ro(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Se(171))}if(n.tag===1){var t=n.type;if(Ro(t))return n$(n,t,e)}return e}function rV(n,e,t,r,s,i,o,a,l){return n=l7(t,r,!0,n,s,i,o,a,l),n.context=nV(null),t=n.current,r=Ki(),s=Oh(t),i=Vu(r,s),i.callback=e??null,Dh(t,i,s),n.current.lanes=s,vw(n,s,r),Mo(n,r),n}function y3(n,e,t,r){var s=e.current,i=Ki(),o=Oh(s);return t=nV(t),e.context===null?e.context=t:e.pendingContext=t,e=Vu(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Dh(s,e,o),n!==null&&(Dl(n,s,o,i),C4(n,s,o)),o}function r_(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Y9(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function c7(n,e){Y9(n,e),(n=n.alternate)&&Y9(n,e)}function Ote(){return null}var sV=typeof reportError=="function"?reportError:function(n){console.error(n)};function u7(n){this._internalRoot=n}x3.prototype.render=u7.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Se(409));y3(n,e,null,null)};x3.prototype.unmount=u7.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;S0(function(){y3(null,n,null,null)}),e[Ju]=null}};function x3(n){this._internalRoot=n}x3.prototype.unstable_scheduleHydration=function(n){if(n){var e=DB();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Fd.length&&e!==0&&e<Fd[t].priority;t++);Fd.splice(t,0,n),t===0&&OB(n)}};function d7(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function b3(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function X9(){}function Fte(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=r_(o);i.call(c)}}var o=rV(e,r,n,0,null,!1,!1,"",X9);return n._reactRootContainer=o,n[Ju]=o.current,sb(n.nodeType===8?n.parentNode:n),S0(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=r_(l);a.call(c)}}var l=l7(n,0,!1,null,null,!1,!1,"",X9);return n._reactRootContainer=l,n[Ju]=l.current,sb(n.nodeType===8?n.parentNode:n),S0(function(){y3(e,l,t,r)}),l}function v3(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=r_(o);a.call(l)}}y3(e,o,n,s)}else o=Fte(t,e,n,s,r);return r_(o)}PB=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Oy(e.pendingLanes);t!==0&&(II(e,t|1),Mo(e,Vr()),!(hn&6)&&(w1=Vr()+500,xf()))}break;case 13:S0(function(){var r=Qu(n,1);if(r!==null){var s=Ki();Dl(r,n,1,s)}}),c7(n,1)}};RI=function(n){if(n.tag===13){var e=Qu(n,134217728);if(e!==null){var t=Ki();Dl(e,n,134217728,t)}c7(n,134217728)}};LB=function(n){if(n.tag===13){var e=Oh(n),t=Qu(n,e);if(t!==null){var r=Ki();Dl(t,n,e,r)}c7(n,e)}};DB=function(){return In};jB=function(n,e){var t=In;try{return In=n,e()}finally{In=t}};CE=function(n,e,t){switch(e){case"input":if(wE(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=u3(r);if(!s)throw Error(Se(90));fB(r),wE(r,s)}}}break;case"textarea":mB(n,t);break;case"select":e=t.value,e!=null&&qm(n,!!t.multiple,e,!1)}};kB=s7;_B=S0;var zte={usingClientEntryPoint:!1,Events:[kw,Lm,u3,vB,wB,s7]},yy={findFiberByHostInstance:Kf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Bte={bundleType:yy.bundleType,version:yy.version,rendererPackageName:yy.rendererPackageName,rendererConfig:yy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dd.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=AB(n),n===null?null:n.stateNode},findFiberByHostInstance:yy.findFiberByHostInstance||Ote,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var L2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!L2.isDisabled&&L2.supportsFiber)try{o3=L2.inject(Bte),Ec=L2}catch{}}ga.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zte;ga.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d7(e))throw Error(Se(200));return jte(n,e,null,t)};ga.createRoot=function(n,e){if(!d7(n))throw Error(Se(299));var t=!1,r="",s=sV;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=l7(n,1,!1,null,null,t,!1,r,s),n[Ju]=e.current,sb(n.nodeType===8?n.parentNode:n),new u7(e)};ga.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Se(188)):(n=Object.keys(n).join(","),Error(Se(268,n)));return n=AB(e),n=n===null?null:n.stateNode,n};ga.flushSync=function(n){return S0(n)};ga.hydrate=function(n,e,t){if(!b3(e))throw Error(Se(200));return v3(null,n,e,!0,t)};ga.hydrateRoot=function(n,e,t){if(!d7(n))throw Error(Se(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=sV;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=rV(e,null,n,1,t??null,s,!1,i,o),n[Ju]=e.current,sb(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new x3(e)};ga.render=function(n,e,t){if(!b3(e))throw Error(Se(200));return v3(null,n,e,!1,t)};ga.unmountComponentAtNode=function(n){if(!b3(n))throw Error(Se(40));return n._reactRootContainer?(S0(function(){v3(null,null,n,!1,function(){n._reactRootContainer=null,n[Ju]=null})}),!0):!1};ga.unstable_batchedUpdates=s7;ga.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!b3(t))throw Error(Se(200));if(n==null||n._reactInternals===void 0)throw Error(Se(38));return v3(n,e,t,!1,r)};ga.version="18.3.1-next-f1338f8080-20240426";function iV(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(iV)}catch(n){console.error(n)}}iV(),iB.exports=ga;var oV=iB.exports;const $te=xw(oV);var J9=oV;pE.createRoot=J9.createRoot,pE.hydrateRoot=J9.hydrateRoot;const Vte="modulepreload",Ute=function(n){return"/"+n},Q9={},Ln=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=Ute(l),l in Q9)return;Q9[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":Vte,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fb(){return fb=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},fb.apply(this,arguments)}var Th;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Th||(Th={}));const Z9="popstate";function Hte(n){n===void 0&&(n={});function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return a6("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:aV(s)}return Gte(e,t,null,n)}function Zr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function h7(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qte(){return Math.random().toString(36).substr(2,8)}function eP(n,e){return{usr:n.state,key:n.key,idx:e}}function a6(n,e,t,r){return t===void 0&&(t=null),fb({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?W1(e):e,{state:t,key:e&&e.key||r||qte()})}function aV(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function W1(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function Gte(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a=Th.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(fb({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=Th.Pop;let v=u(),b=v==null?null:v-c;c=v,l&&l({action:a,location:y.location,delta:b})}function f(v,b){a=Th.Push;let w=a6(y.location,v,b);c=u()+1;let k=eP(w,c),T=y.createHref(w);try{o.pushState(k,"",T)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;s.location.assign(T)}i&&l&&l({action:a,location:y.location,delta:1})}function p(v,b){a=Th.Replace;let w=a6(y.location,v,b);c=u();let k=eP(w,c),T=y.createHref(w);o.replaceState(k,"",T),i&&l&&l({action:a,location:y.location,delta:0})}function g(v){let b=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof v=="string"?v:aV(v);return w=w.replace(/ $/,"%20"),Zr(b,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,b)}let y={get action(){return a},get location(){return n(s,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(Z9,h),l=v,()=>{s.removeEventListener(Z9,h),l=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let b=g(v);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:f,replace:p,go(v){return o.go(v)}};return y}var tP;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(tP||(tP={}));function Wte(n,e,t){return t===void 0&&(t="/"),Kte(n,e,t)}function Kte(n,e,t,r){let s=typeof e=="string"?W1(e):e,i=uV(s.pathname||"/",t);if(i==null)return null;let o=lV(n);Yte(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=ane(i);a=sne(o[l],c)}return a}function lV(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(i,o,a)=>{let l={relativePath:a===void 0?i.path||"":a,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};l.relativePath.startsWith("/")&&(Zr(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=u0([r,l.relativePath]),u=t.concat(l);i.children&&i.children.length>0&&(Zr(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),lV(i.children,e,u,c)),!(i.path==null&&!i.index)&&e.push({path:c,score:nne(c,i.index),routesMeta:u})};return n.forEach((i,o)=>{var a;if(i.path===""||!((a=i.path)!=null&&a.includes("?")))s(i,o);else for(let l of cV(i.path))s(i,o,l)}),e}function cV(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),i=t.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=cV(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function Yte(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:rne(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const Xte=/^:[\w-]+$/,Jte=3,Qte=2,Zte=1,ene=10,tne=-2,nP=n=>n==="*";function nne(n,e){let t=n.split("/"),r=t.length;return t.some(nP)&&(r+=tne),e&&(r+=Qte),t.filter(s=>!nP(s)).reduce((s,i)=>s+(Xte.test(i)?Jte:i===""?Zte:ene),r)}function rne(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function sne(n,e,t){let{routesMeta:r}=n,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",h=ine({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:u0([i,h.pathname]),pathnameBase:hne(u0([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=u0([i,h.pathnameBase]))}return o}function ine(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=one(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:f,isOptional:p}=u;if(f==="*"){let y=a[h]||"";o=i.slice(0,i.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[h];return p&&!g?c[f]=void 0:c[f]=(g||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:n}}function one(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),h7(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function ane(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return h7(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function uV(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}const lne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cne=n=>lne.test(n);function une(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?W1(n):n,i;if(t)if(cne(t))i=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),h7(!1,"Pathnames cannot have embedded double slashes - normalizing "+(o+" -> "+t))}t.startsWith("/")?i=rP(t.substring(1),"/"):i=rP(t,e)}else i=e;return{pathname:i,search:fne(r),hash:pne(s)}}function rP(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function xT(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function dne(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function dV(n,e){let t=dne(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function hV(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=W1(n):(s=fb({},n),Zr(!s.pathname||!s.pathname.includes("?"),xT("?","pathname","search",s)),Zr(!s.pathname||!s.pathname.includes("#"),xT("#","pathname","hash",s)),Zr(!s.search||!s.search.includes("#"),xT("#","search","hash",s)));let i=n===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;s.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=une(s,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const u0=n=>n.join("/").replace(/\/\/+/g,"/"),hne=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),fne=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,pne=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function mne(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const fV=["post","put","patch","delete"];new Set(fV);const gne=["get",...fV];new Set(gne);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pb(){return pb=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},pb.apply(this,arguments)}const f7=V.createContext(null),yne=V.createContext(null),Sw=V.createContext(null),w3=V.createContext(null),U0=V.createContext({outlet:null,matches:[],isDataRoute:!1}),pV=V.createContext(null);function Tw(){return V.useContext(w3)!=null}function k3(){return Tw()||Zr(!1),V.useContext(w3).location}function mV(n){V.useContext(Sw).static||V.useLayoutEffect(n)}function xne(){let{isDataRoute:n}=V.useContext(U0);return n?Rne():bne()}function bne(){Tw()||Zr(!1);let n=V.useContext(f7),{basename:e,future:t,navigator:r}=V.useContext(Sw),{matches:s}=V.useContext(U0),{pathname:i}=k3(),o=JSON.stringify(dV(s,t.v7_relativeSplatPath)),a=V.useRef(!1);return mV(()=>{a.current=!0}),V.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let h=hV(c,JSON.parse(o),i,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:u0([e,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[e,r,o,i,n])}function vne(n,e){return wne(n,e)}function wne(n,e,t,r){Tw()||Zr(!1);let{navigator:s}=V.useContext(Sw),{matches:i}=V.useContext(U0),o=i[i.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=k3(),u;if(e){var h;let v=typeof e=="string"?W1(e):e;l==="/"||(h=v.pathname)!=null&&h.startsWith(l)||Zr(!1),u=v}else u=c;let f=u.pathname||"/",p=f;if(l!=="/"){let v=l.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(v.length).join("/")}let g=Wte(n,{pathname:p}),y=Ane(g&&g.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:u0([l,s.encodeLocation?s.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?l:u0([l,s.encodeLocation?s.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),i,t,r);return e&&y?V.createElement(w3.Provider,{value:{location:pb({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Th.Pop}},y):y}function kne(){let n=Ine(),e=mne(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),t?V.createElement("pre",{style:s},t):null,null)}const _ne=V.createElement(kne,null);class Sne extends V.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?V.createElement(U0.Provider,{value:this.props.routeContext},V.createElement(pV.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Tne(n){let{routeContext:e,match:t,children:r}=n,s=V.useContext(f7);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),V.createElement(U0.Provider,{value:e},r)}function Ane(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var i;if(!t)return null;if(t.errors)n=t.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||Zr(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:f,errors:p}=t,g=h.route.loader&&f[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||g){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,h,f)=>{let p,g=!1,y=null,v=null;t&&(p=a&&h.route.id?a[h.route.id]:void 0,y=h.route.errorElement||_ne,l&&(c<0&&f===0?(Mne("route-fallback"),g=!0,v=null):c===f&&(g=!0,v=h.route.hydrateFallbackElement||null)));let b=e.concat(o.slice(0,f+1)),w=()=>{let k;return p?k=y:g?k=v:h.route.Component?k=V.createElement(h.route.Component,null):h.route.element?k=h.route.element:k=u,V.createElement(Tne,{match:h,routeContext:{outlet:u,matches:b,isDataRoute:t!=null},children:k})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?V.createElement(Sne,{location:t.location,revalidation:t.revalidation,component:y,error:p,children:w(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):w()},null)}var gV=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(gV||{}),yV=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(yV||{});function Ene(n){let e=V.useContext(f7);return e||Zr(!1),e}function Cne(n){let e=V.useContext(yne);return e||Zr(!1),e}function Nne(n){let e=V.useContext(U0);return e||Zr(!1),e}function xV(n){let e=Nne(),t=e.matches[e.matches.length-1];return t.route.id||Zr(!1),t.route.id}function Ine(){var n;let e=V.useContext(pV),t=Cne(),r=xV();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function Rne(){let{router:n}=Ene(gV.UseNavigateStable),e=xV(yV.UseNavigateStable),t=V.useRef(!1);return mV(()=>{t.current=!0}),V.useCallback(function(s,i){i===void 0&&(i={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,pb({fromRouteId:e},i)))},[n,e])}const sP={};function Mne(n,e,t){sP[n]||(sP[n]=!0)}function Pne(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function o7e(n){let{to:e,replace:t,state:r,relative:s}=n;Tw()||Zr(!1);let{future:i,static:o}=V.useContext(Sw),{matches:a}=V.useContext(U0),{pathname:l}=k3(),c=xne(),u=hV(e,dV(a,i.v7_relativeSplatPath),l,s==="path"),h=JSON.stringify(u);return V.useEffect(()=>c(JSON.parse(h),{replace:t,state:r,relative:s}),[c,h,s,t,r]),null}function l6(n){Zr(!1)}function Lne(n){let{basename:e="/",children:t=null,location:r,navigationType:s=Th.Pop,navigator:i,static:o=!1,future:a}=n;Tw()&&Zr(!1);let l=e.replace(/^\/*/,"/"),c=V.useMemo(()=>({basename:l,navigator:i,static:o,future:pb({v7_relativeSplatPath:!1},a)}),[l,a,i,o]);typeof r=="string"&&(r=W1(r));let{pathname:u="/",search:h="",hash:f="",state:p=null,key:g="default"}=r,y=V.useMemo(()=>{let v=uV(u,l);return v==null?null:{location:{pathname:v,search:h,hash:f,state:p,key:g},navigationType:s}},[l,u,h,f,p,g,s]);return y==null?null:V.createElement(Sw.Provider,{value:c},V.createElement(w3.Provider,{children:t,value:y}))}function iP(n){let{children:e,location:t}=n;return vne(c6(e),t)}new Promise(()=>{});function c6(n,e){e===void 0&&(e=[]);let t=[];return V.Children.forEach(n,(r,s)=>{if(!V.isValidElement(r))return;let i=[...e,s];if(r.type===V.Fragment){t.push.apply(t,c6(r.props.children,i));return}r.type!==l6&&Zr(!1),!r.props.index||!r.props.children||Zr(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=c6(r.props.children,i)),t.push(o)}),t}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Dne="6";try{window.__reactRouterVersion=Dne}catch{}const jne="startTransition",oP=IZ[jne];function One(n){let{basename:e,children:t,future:r,window:s}=n,i=V.useRef();i.current==null&&(i.current=Hte({window:s,v5Compat:!0}));let o=i.current,[a,l]=V.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},u=V.useCallback(h=>{c&&oP?oP(()=>l(h)):l(h)},[l,c]);return V.useLayoutEffect(()=>o.listen(u),[o,u]),V.useEffect(()=>Pne(r),[r]),V.createElement(Lne,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}var aP;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(aP||(aP={}));var lP;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(lP||(lP={}));const Fne=()=>{};var cP={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bV=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},zne=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},vV={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,u=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(f=64)),r.push(t[u],t[h],t[f],t[p])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(bV(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):zne(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||h==null)throw new Bne;const f=i<<2|a>>4;if(r.push(f),c!==64){const p=a<<4&240|c>>2;if(r.push(p),h!==64){const g=c<<6&192|h;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Bne extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $ne=function(n){const e=bV(n);return vV.encodeByteArray(e,!0)},s_=function(n){return $ne(n).replace(/\./g,"")},wV=function(n){try{return vV.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vne(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Une=()=>Vne().__FIREBASE_DEFAULTS__,Hne=()=>{if(typeof process>"u"||typeof cP>"u")return;const n=cP.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},qne=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&wV(n[1]);return e&&JSON.parse(e)},_3=()=>{try{return Fne()||Une()||Hne()||qne()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},kV=n=>{var e,t;return(t=(e=_3())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},p7=n=>{const e=kV(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},_V=()=>{var n;return(n=_3())==null?void 0:n.config},SV=n=>{var e;return(e=_3())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gne{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function S3(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TV(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[s_(JSON.stringify(t)),s_(JSON.stringify(o)),""].join(".")}const Sx={};function Wne(){const n={prod:[],emulator:[]};for(const e of Object.keys(Sx))Sx[e]?n.emulator.push(e):n.prod.push(e);return n}function Kne(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let uP=!1;function T3(n,e){if(typeof window>"u"||typeof document>"u"||!Uc(window.location.host)||Sx[n]===e||Sx[n]||uP)return;Sx[n]=e;function t(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=Wne().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,p){f.setAttribute("width","24"),f.setAttribute("id",p),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function c(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{uP=!0,o()},f}function u(f,p){f.setAttribute("id",p),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=Kne(r),p=t("text"),g=document.getElementById(p)||document.createElement("span"),y=t("learnmore"),v=document.getElementById(y)||document.createElement("a"),b=t("preprendIcon"),w=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const k=f.element;a(k),u(v,y);const T=c();l(w,b),k.append(w,g,v,T),document.body.appendChild(k)}i?(g.innerText="Preview backend disconnected.",w.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(w.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ai(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Yne(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ai())}function Xne(){var e;const n=(e=_3())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Jne(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function m7(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Qne(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zne(){const n=Ai();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ere(){return!Xne()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function g7(){try{return typeof indexedDB=="object"}catch{return!1}}function y7(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function AV(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tre="FirebaseError";class xa extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=tre,Object.setPrototypeOf(this,xa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,H0.prototype.create)}}class H0{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?nre(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new xa(s,a,r)}}function nre(n,e){return n.replace(rre,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const rre=/\{\$([^}]+)}/g;function sre(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zh(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(dP(i)&&dP(o)){if(!Zh(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function dP(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aw(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zy(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function By(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function ire(n,e){const t=new ore(n,e);return t.subscribe.bind(t)}class ore{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");are(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=bT),s.error===void 0&&(s.error=bT),s.complete===void 0&&(s.complete=bT);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function are(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function bT(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lre=1e3,cre=2,ure=4*60*60*1e3,dre=.5;function hP(n,e=lre,t=cre){const r=e*Math.pow(t,n),s=Math.round(dre*r*(Math.random()-.5)*2);return Math.min(ure,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(n){return n&&n._delegate?n._delegate:n}class ma{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zf="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hre{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Gne;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pre(e))try{this.getOrInitializeService({instanceIdentifier:zf})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=zf){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zf){return this.instances.has(e)}getOptions(e=zf){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:fre(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=zf){return this.component?this.component.multipleInstances?e:zf:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function fre(n){return n===zf?void 0:n}function pre(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mre{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new hre(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Qt||(Qt={}));const gre={debug:Qt.DEBUG,verbose:Qt.VERBOSE,info:Qt.INFO,warn:Qt.WARN,error:Qt.ERROR,silent:Qt.SILENT},yre=Qt.INFO,xre={[Qt.DEBUG]:"log",[Qt.VERBOSE]:"log",[Qt.INFO]:"info",[Qt.WARN]:"warn",[Qt.ERROR]:"error"},bre=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=xre[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class A3{constructor(e){this.name=e,this._logLevel=yre,this._logHandler=bre,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Qt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?gre[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Qt.DEBUG,...e),this._logHandler(this,Qt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Qt.VERBOSE,...e),this._logHandler(this,Qt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Qt.INFO,...e),this._logHandler(this,Qt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Qt.WARN,...e),this._logHandler(this,Qt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Qt.ERROR,...e),this._logHandler(this,Qt.ERROR,...e)}}const vre=(n,e)=>e.some(t=>n instanceof t);let fP,pP;function wre(){return fP||(fP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function kre(){return pP||(pP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const EV=new WeakMap,u6=new WeakMap,CV=new WeakMap,vT=new WeakMap,x7=new WeakMap;function _re(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(zh(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&EV.set(t,n)}).catch(()=>{}),x7.set(e,n),e}function Sre(n){if(u6.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});u6.set(n,e)}let d6={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return u6.get(n);if(e==="objectStoreNames")return n.objectStoreNames||CV.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return zh(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Tre(n){d6=n(d6)}function Are(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(wT(this),e,...t);return CV.set(r,e.sort?e.sort():[e]),zh(r)}:kre().includes(n)?function(...e){return n.apply(wT(this),e),zh(EV.get(this))}:function(...e){return zh(n.apply(wT(this),e))}}function Ere(n){return typeof n=="function"?Are(n):(n instanceof IDBTransaction&&Sre(n),vre(n,wre())?new Proxy(n,d6):n)}function zh(n){if(n instanceof IDBRequest)return _re(n);if(vT.has(n))return vT.get(n);const e=Ere(n);return e!==n&&(vT.set(n,e),x7.set(e,n)),e}const wT=n=>x7.get(n);function Cre(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=zh(o);return r&&o.addEventListener("upgradeneeded",l=>{r(zh(o.result),l.oldVersion,l.newVersion,zh(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Nre=["get","getKey","getAll","getAllKeys","count"],Ire=["put","add","delete","clear"],kT=new Map;function mP(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(kT.get(e))return kT.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Ire.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Nre.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return kT.set(e,i),i}Tre(n=>({...n,get:(e,t,r)=>mP(e,t)||n.get(e,t,r),has:(e,t)=>!!mP(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rre{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mre(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Mre(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const h6="@firebase/app",gP="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ed=new A3("@firebase/app"),Pre="@firebase/app-compat",Lre="@firebase/analytics-compat",Dre="@firebase/analytics",jre="@firebase/app-check-compat",Ore="@firebase/app-check",Fre="@firebase/auth",zre="@firebase/auth-compat",Bre="@firebase/database",$re="@firebase/data-connect",Vre="@firebase/database-compat",Ure="@firebase/functions",Hre="@firebase/functions-compat",qre="@firebase/installations",Gre="@firebase/installations-compat",Wre="@firebase/messaging",Kre="@firebase/messaging-compat",Yre="@firebase/performance",Xre="@firebase/performance-compat",Jre="@firebase/remote-config",Qre="@firebase/remote-config-compat",Zre="@firebase/storage",ese="@firebase/storage-compat",tse="@firebase/firestore",nse="@firebase/ai",rse="@firebase/firestore-compat",sse="firebase",ise="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f6="[DEFAULT]",ose={[h6]:"fire-core",[Pre]:"fire-core-compat",[Dre]:"fire-analytics",[Lre]:"fire-analytics-compat",[Ore]:"fire-app-check",[jre]:"fire-app-check-compat",[Fre]:"fire-auth",[zre]:"fire-auth-compat",[Bre]:"fire-rtdb",[$re]:"fire-data-connect",[Vre]:"fire-rtdb-compat",[Ure]:"fire-fn",[Hre]:"fire-fn-compat",[qre]:"fire-iid",[Gre]:"fire-iid-compat",[Wre]:"fire-fcm",[Kre]:"fire-fcm-compat",[Yre]:"fire-perf",[Xre]:"fire-perf-compat",[Jre]:"fire-rc",[Qre]:"fire-rc-compat",[Zre]:"fire-gcs",[ese]:"fire-gcs-compat",[tse]:"fire-fst",[rse]:"fire-fst-compat",[nse]:"fire-vertex","fire-js":"fire-js",[sse]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i_=new Map,ase=new Map,p6=new Map;function yP(n,e){try{n.container.addComponent(e)}catch(t){ed.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function el(n){const e=n.name;if(p6.has(e))return ed.debug(`There were multiple attempts to register component ${e}.`),!1;p6.set(e,n);for(const t of i_.values())yP(t,n);for(const t of ase.values())yP(t,n);return!0}function hd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function wi(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lse={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bh=new H0("app","Firebase",lse);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cse{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ma("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0=ise;function NV(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:f6,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Bh.create("bad-app-name",{appName:String(s)});if(t||(t=_V()),!t)throw Bh.create("no-options");const i=i_.get(s);if(i){if(Zh(t,i.options)&&Zh(r,i.config))return i;throw Bh.create("duplicate-app",{appName:s})}const o=new mre(s);for(const l of p6.values())o.addComponent(l);const a=new cse(t,r,o);return i_.set(s,a),a}function G0(n=f6){const e=i_.get(n);if(!e&&n===f6&&_V())return NV();if(!e)throw Bh.create("no-app",{appName:n});return e}function Si(n,e,t){let r=ose[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ed.warn(o.join(" "));return}el(new ma(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const use="firebase-heartbeat-database",dse=1,mb="firebase-heartbeat-store";let _T=null;function IV(){return _T||(_T=Cre(use,dse,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(mb)}catch(t){console.warn(t)}}}}).catch(n=>{throw Bh.create("idb-open",{originalErrorMessage:n.message})})),_T}async function hse(n){try{const t=(await IV()).transaction(mb),r=await t.objectStore(mb).get(RV(n));return await t.done,r}catch(e){if(e instanceof xa)ed.warn(e.message);else{const t=Bh.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ed.warn(t.message)}}}async function xP(n,e){try{const r=(await IV()).transaction(mb,"readwrite");await r.objectStore(mb).put(e,RV(n)),await r.done}catch(t){if(t instanceof xa)ed.warn(t.message);else{const r=Bh.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ed.warn(r.message)}}}function RV(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fse=1024,pse=30;class mse{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new yse(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=bP();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>pse){const o=xse(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ed.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=bP(),{heartbeatsToSend:r,unsentEntries:s}=gse(this._heartbeatsCache.heartbeats),i=s_(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ed.warn(t),""}}}function bP(){return new Date().toISOString().substring(0,10)}function gse(n,e=fse){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),vP(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),vP(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class yse{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return g7()?y7().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await hse(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xP(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xP(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function vP(n){return s_(JSON.stringify({version:2,heartbeats:n})).length}function xse(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bse(n){el(new ma("platform-logger",e=>new Rre(e),"PRIVATE")),el(new ma("heartbeat",e=>new mse(e),"PRIVATE")),Si(h6,gP,n),Si(h6,gP,"esm2020"),Si("fire-js","")}bse("");var vse="firebase",wse="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Si(vse,wse,"app");var wP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $h,MV;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,I){function S(){}S.prototype=I.prototype,E.F=I.prototype,E.prototype=new S,E.prototype.constructor=E,E.D=function(N,P,O){for(var D=Array(arguments.length-2),G=2;G<arguments.length;G++)D[G-2]=arguments[G];return I.prototype[P].apply(N,D)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,I,S){S||(S=0);const N=Array(16);if(typeof I=="string")for(var P=0;P<16;++P)N[P]=I.charCodeAt(S++)|I.charCodeAt(S++)<<8|I.charCodeAt(S++)<<16|I.charCodeAt(S++)<<24;else for(P=0;P<16;++P)N[P]=I[S++]|I[S++]<<8|I[S++]<<16|I[S++]<<24;I=E.g[0],S=E.g[1],P=E.g[2];let O=E.g[3],D;D=I+(O^S&(P^O))+N[0]+3614090360&4294967295,I=S+(D<<7&4294967295|D>>>25),D=O+(P^I&(S^P))+N[1]+3905402710&4294967295,O=I+(D<<12&4294967295|D>>>20),D=P+(S^O&(I^S))+N[2]+606105819&4294967295,P=O+(D<<17&4294967295|D>>>15),D=S+(I^P&(O^I))+N[3]+3250441966&4294967295,S=P+(D<<22&4294967295|D>>>10),D=I+(O^S&(P^O))+N[4]+4118548399&4294967295,I=S+(D<<7&4294967295|D>>>25),D=O+(P^I&(S^P))+N[5]+1200080426&4294967295,O=I+(D<<12&4294967295|D>>>20),D=P+(S^O&(I^S))+N[6]+2821735955&4294967295,P=O+(D<<17&4294967295|D>>>15),D=S+(I^P&(O^I))+N[7]+4249261313&4294967295,S=P+(D<<22&4294967295|D>>>10),D=I+(O^S&(P^O))+N[8]+1770035416&4294967295,I=S+(D<<7&4294967295|D>>>25),D=O+(P^I&(S^P))+N[9]+2336552879&4294967295,O=I+(D<<12&4294967295|D>>>20),D=P+(S^O&(I^S))+N[10]+4294925233&4294967295,P=O+(D<<17&4294967295|D>>>15),D=S+(I^P&(O^I))+N[11]+2304563134&4294967295,S=P+(D<<22&4294967295|D>>>10),D=I+(O^S&(P^O))+N[12]+1804603682&4294967295,I=S+(D<<7&4294967295|D>>>25),D=O+(P^I&(S^P))+N[13]+4254626195&4294967295,O=I+(D<<12&4294967295|D>>>20),D=P+(S^O&(I^S))+N[14]+2792965006&4294967295,P=O+(D<<17&4294967295|D>>>15),D=S+(I^P&(O^I))+N[15]+1236535329&4294967295,S=P+(D<<22&4294967295|D>>>10),D=I+(P^O&(S^P))+N[1]+4129170786&4294967295,I=S+(D<<5&4294967295|D>>>27),D=O+(S^P&(I^S))+N[6]+3225465664&4294967295,O=I+(D<<9&4294967295|D>>>23),D=P+(I^S&(O^I))+N[11]+643717713&4294967295,P=O+(D<<14&4294967295|D>>>18),D=S+(O^I&(P^O))+N[0]+3921069994&4294967295,S=P+(D<<20&4294967295|D>>>12),D=I+(P^O&(S^P))+N[5]+3593408605&4294967295,I=S+(D<<5&4294967295|D>>>27),D=O+(S^P&(I^S))+N[10]+38016083&4294967295,O=I+(D<<9&4294967295|D>>>23),D=P+(I^S&(O^I))+N[15]+3634488961&4294967295,P=O+(D<<14&4294967295|D>>>18),D=S+(O^I&(P^O))+N[4]+3889429448&4294967295,S=P+(D<<20&4294967295|D>>>12),D=I+(P^O&(S^P))+N[9]+568446438&4294967295,I=S+(D<<5&4294967295|D>>>27),D=O+(S^P&(I^S))+N[14]+3275163606&4294967295,O=I+(D<<9&4294967295|D>>>23),D=P+(I^S&(O^I))+N[3]+4107603335&4294967295,P=O+(D<<14&4294967295|D>>>18),D=S+(O^I&(P^O))+N[8]+1163531501&4294967295,S=P+(D<<20&4294967295|D>>>12),D=I+(P^O&(S^P))+N[13]+2850285829&4294967295,I=S+(D<<5&4294967295|D>>>27),D=O+(S^P&(I^S))+N[2]+4243563512&4294967295,O=I+(D<<9&4294967295|D>>>23),D=P+(I^S&(O^I))+N[7]+1735328473&4294967295,P=O+(D<<14&4294967295|D>>>18),D=S+(O^I&(P^O))+N[12]+2368359562&4294967295,S=P+(D<<20&4294967295|D>>>12),D=I+(S^P^O)+N[5]+4294588738&4294967295,I=S+(D<<4&4294967295|D>>>28),D=O+(I^S^P)+N[8]+2272392833&4294967295,O=I+(D<<11&4294967295|D>>>21),D=P+(O^I^S)+N[11]+1839030562&4294967295,P=O+(D<<16&4294967295|D>>>16),D=S+(P^O^I)+N[14]+4259657740&4294967295,S=P+(D<<23&4294967295|D>>>9),D=I+(S^P^O)+N[1]+2763975236&4294967295,I=S+(D<<4&4294967295|D>>>28),D=O+(I^S^P)+N[4]+1272893353&4294967295,O=I+(D<<11&4294967295|D>>>21),D=P+(O^I^S)+N[7]+4139469664&4294967295,P=O+(D<<16&4294967295|D>>>16),D=S+(P^O^I)+N[10]+3200236656&4294967295,S=P+(D<<23&4294967295|D>>>9),D=I+(S^P^O)+N[13]+681279174&4294967295,I=S+(D<<4&4294967295|D>>>28),D=O+(I^S^P)+N[0]+3936430074&4294967295,O=I+(D<<11&4294967295|D>>>21),D=P+(O^I^S)+N[3]+3572445317&4294967295,P=O+(D<<16&4294967295|D>>>16),D=S+(P^O^I)+N[6]+76029189&4294967295,S=P+(D<<23&4294967295|D>>>9),D=I+(S^P^O)+N[9]+3654602809&4294967295,I=S+(D<<4&4294967295|D>>>28),D=O+(I^S^P)+N[12]+3873151461&4294967295,O=I+(D<<11&4294967295|D>>>21),D=P+(O^I^S)+N[15]+530742520&4294967295,P=O+(D<<16&4294967295|D>>>16),D=S+(P^O^I)+N[2]+3299628645&4294967295,S=P+(D<<23&4294967295|D>>>9),D=I+(P^(S|~O))+N[0]+4096336452&4294967295,I=S+(D<<6&4294967295|D>>>26),D=O+(S^(I|~P))+N[7]+1126891415&4294967295,O=I+(D<<10&4294967295|D>>>22),D=P+(I^(O|~S))+N[14]+2878612391&4294967295,P=O+(D<<15&4294967295|D>>>17),D=S+(O^(P|~I))+N[5]+4237533241&4294967295,S=P+(D<<21&4294967295|D>>>11),D=I+(P^(S|~O))+N[12]+1700485571&4294967295,I=S+(D<<6&4294967295|D>>>26),D=O+(S^(I|~P))+N[3]+2399980690&4294967295,O=I+(D<<10&4294967295|D>>>22),D=P+(I^(O|~S))+N[10]+4293915773&4294967295,P=O+(D<<15&4294967295|D>>>17),D=S+(O^(P|~I))+N[1]+2240044497&4294967295,S=P+(D<<21&4294967295|D>>>11),D=I+(P^(S|~O))+N[8]+1873313359&4294967295,I=S+(D<<6&4294967295|D>>>26),D=O+(S^(I|~P))+N[15]+4264355552&4294967295,O=I+(D<<10&4294967295|D>>>22),D=P+(I^(O|~S))+N[6]+2734768916&4294967295,P=O+(D<<15&4294967295|D>>>17),D=S+(O^(P|~I))+N[13]+1309151649&4294967295,S=P+(D<<21&4294967295|D>>>11),D=I+(P^(S|~O))+N[4]+4149444226&4294967295,I=S+(D<<6&4294967295|D>>>26),D=O+(S^(I|~P))+N[11]+3174756917&4294967295,O=I+(D<<10&4294967295|D>>>22),D=P+(I^(O|~S))+N[2]+718787259&4294967295,P=O+(D<<15&4294967295|D>>>17),D=S+(O^(P|~I))+N[9]+3951481745&4294967295,E.g[0]=E.g[0]+I&4294967295,E.g[1]=E.g[1]+(P+(D<<21&4294967295|D>>>11))&4294967295,E.g[2]=E.g[2]+P&4294967295,E.g[3]=E.g[3]+O&4294967295}r.prototype.v=function(E,I){I===void 0&&(I=E.length);const S=I-this.blockSize,N=this.C;let P=this.h,O=0;for(;O<I;){if(P==0)for(;O<=S;)s(this,E,O),O+=this.blockSize;if(typeof E=="string"){for(;O<I;)if(N[P++]=E.charCodeAt(O++),P==this.blockSize){s(this,N),P=0;break}}else for(;O<I;)if(N[P++]=E[O++],P==this.blockSize){s(this,N),P=0;break}}this.h=P,this.o+=I},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var I=1;I<E.length-8;++I)E[I]=0;I=this.o*8;for(var S=E.length-8;S<E.length;++S)E[S]=I&255,I/=256;for(this.v(E),E=Array(16),I=0,S=0;S<4;++S)for(let N=0;N<32;N+=8)E[I++]=this.g[S]>>>N&255;return E};function i(E,I){var S=a;return Object.prototype.hasOwnProperty.call(S,E)?S[E]:S[E]=I(E)}function o(E,I){this.h=I;const S=[];let N=!0;for(let P=E.length-1;P>=0;P--){const O=E[P]|0;N&&O==I||(S[P]=O,N=!1)}this.g=S}var a={};function l(E){return-128<=E&&E<128?i(E,function(I){return new o([I|0],I<0?-1:0)}):new o([E|0],E<0?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return h;if(E<0)return v(c(-E));const I=[];let S=1;for(let N=0;E>=S;N++)I[N]=E/S|0,S*=4294967296;return new o(I,0)}function u(E,I){if(E.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(E.charAt(0)=="-")return v(u(E.substring(1),I));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const S=c(Math.pow(I,8));let N=h;for(let O=0;O<E.length;O+=8){var P=Math.min(8,E.length-O);const D=parseInt(E.substring(O,O+P),I);P<8?(P=c(Math.pow(I,P)),N=N.j(P).add(c(D))):(N=N.j(S),N=N.add(c(D)))}return N}var h=l(0),f=l(1),p=l(16777216);n=o.prototype,n.m=function(){if(y(this))return-v(this).m();let E=0,I=1;for(let S=0;S<this.g.length;S++){const N=this.i(S);E+=(N>=0?N:4294967296+N)*I,I*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(g(this))return"0";if(y(this))return"-"+v(this).toString(E);const I=c(Math.pow(E,6));var S=this;let N="";for(;;){const P=T(S,I).g;S=b(S,P.j(I));let O=((S.g.length>0?S.g[0]:S.h)>>>0).toString(E);if(S=P,g(S))return O+N;for(;O.length<6;)O="0"+O;N=O+N}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function g(E){if(E.h!=0)return!1;for(let I=0;I<E.g.length;I++)if(E.g[I]!=0)return!1;return!0}function y(E){return E.h==-1}n.l=function(E){return E=b(this,E),y(E)?-1:g(E)?0:1};function v(E){const I=E.g.length,S=[];for(let N=0;N<I;N++)S[N]=~E.g[N];return new o(S,~E.h).add(f)}n.abs=function(){return y(this)?v(this):this},n.add=function(E){const I=Math.max(this.g.length,E.g.length),S=[];let N=0;for(let P=0;P<=I;P++){let O=N+(this.i(P)&65535)+(E.i(P)&65535),D=(O>>>16)+(this.i(P)>>>16)+(E.i(P)>>>16);N=D>>>16,O&=65535,D&=65535,S[P]=D<<16|O}return new o(S,S[S.length-1]&-2147483648?-1:0)};function b(E,I){return E.add(v(I))}n.j=function(E){if(g(this)||g(E))return h;if(y(this))return y(E)?v(this).j(v(E)):v(v(this).j(E));if(y(E))return v(this.j(v(E)));if(this.l(p)<0&&E.l(p)<0)return c(this.m()*E.m());const I=this.g.length+E.g.length,S=[];for(var N=0;N<2*I;N++)S[N]=0;for(N=0;N<this.g.length;N++)for(let P=0;P<E.g.length;P++){const O=this.i(N)>>>16,D=this.i(N)&65535,G=E.i(P)>>>16,J=E.i(P)&65535;S[2*N+2*P]+=D*J,w(S,2*N+2*P),S[2*N+2*P+1]+=O*J,w(S,2*N+2*P+1),S[2*N+2*P+1]+=D*G,w(S,2*N+2*P+1),S[2*N+2*P+2]+=O*G,w(S,2*N+2*P+2)}for(E=0;E<I;E++)S[E]=S[2*E+1]<<16|S[2*E];for(E=I;E<2*I;E++)S[E]=0;return new o(S,0)};function w(E,I){for(;(E[I]&65535)!=E[I];)E[I+1]+=E[I]>>>16,E[I]&=65535,I++}function k(E,I){this.g=E,this.h=I}function T(E,I){if(g(I))throw Error("division by zero");if(g(E))return new k(h,h);if(y(E))return I=T(v(E),I),new k(v(I.g),v(I.h));if(y(I))return I=T(E,v(I)),new k(v(I.g),I.h);if(E.g.length>30){if(y(E)||y(I))throw Error("slowDivide_ only works with positive integers.");for(var S=f,N=I;N.l(E)<=0;)S=R(S),N=R(N);var P=M(S,1),O=M(N,1);for(N=M(N,2),S=M(S,2);!g(N);){var D=O.add(N);D.l(E)<=0&&(P=P.add(S),O=D),N=M(N,1),S=M(S,1)}return I=b(E,P.j(I)),new k(P,I)}for(P=h;E.l(I)>=0;){for(S=Math.max(1,Math.floor(E.m()/I.m())),N=Math.ceil(Math.log(S)/Math.LN2),N=N<=48?1:Math.pow(2,N-48),O=c(S),D=O.j(I);y(D)||D.l(E)>0;)S-=N,O=c(S),D=O.j(I);g(O)&&(O=f),P=P.add(O),E=b(E,D)}return new k(P,E)}n.B=function(E){return T(this,E).h},n.and=function(E){const I=Math.max(this.g.length,E.g.length),S=[];for(let N=0;N<I;N++)S[N]=this.i(N)&E.i(N);return new o(S,this.h&E.h)},n.or=function(E){const I=Math.max(this.g.length,E.g.length),S=[];for(let N=0;N<I;N++)S[N]=this.i(N)|E.i(N);return new o(S,this.h|E.h)},n.xor=function(E){const I=Math.max(this.g.length,E.g.length),S=[];for(let N=0;N<I;N++)S[N]=this.i(N)^E.i(N);return new o(S,this.h^E.h)};function R(E){const I=E.g.length+1,S=[];for(let N=0;N<I;N++)S[N]=E.i(N)<<1|E.i(N-1)>>>31;return new o(S,E.h)}function M(E,I){const S=I>>5;I%=32;const N=E.g.length-S,P=[];for(let O=0;O<N;O++)P[O]=I>0?E.i(O+S)>>>I|E.i(O+S+1)<<32-I:E.i(O+S);return new o(P,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,MV=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,$h=o}).apply(typeof wP<"u"?wP:typeof self<"u"?self:typeof window<"u"?window:{});var D2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var PV,$y,LV,D4,m6,DV,jV,OV;(function(){var n,e=Object.defineProperty;function t(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof D2=="object"&&D2];for(var A=0;A<x.length;++A){var j=x[A];if(j&&j.Math==Math)return j}throw Error("Cannot find global object")}var r=t(this);function s(x,A){if(A)e:{var j=r;x=x.split(".");for(var q=0;q<x.length-1;q++){var se=x[q];if(!(se in j))break e;j=j[se]}x=x[x.length-1],q=j[x],A=A(q),A!=q&&A!=null&&e(j,x,{configurable:!0,writable:!0,value:A})}}s("Symbol.dispose",function(x){return x||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(x){return x||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(x){return x||function(A){var j=[],q;for(q in A)Object.prototype.hasOwnProperty.call(A,q)&&j.push([q,A[q]]);return j}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(x){var A=typeof x;return A=="object"&&x!=null||A=="function"}function l(x,A,j){return x.call.apply(x.bind,arguments)}function c(x,A,j){return c=l,c.apply(null,arguments)}function u(x,A){var j=Array.prototype.slice.call(arguments,1);return function(){var q=j.slice();return q.push.apply(q,arguments),x.apply(this,q)}}function h(x,A){function j(){}j.prototype=A.prototype,x.Z=A.prototype,x.prototype=new j,x.prototype.constructor=x,x.Ob=function(q,se,ae){for(var Ce=Array(arguments.length-2),Ot=2;Ot<arguments.length;Ot++)Ce[Ot-2]=arguments[Ot];return A.prototype[se].apply(q,Ce)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?x=>x&&AsyncContext.Snapshot.wrap(x):x=>x;function p(x){const A=x.length;if(A>0){const j=Array(A);for(let q=0;q<A;q++)j[q]=x[q];return j}return[]}function g(x,A){for(let q=1;q<arguments.length;q++){const se=arguments[q];var j=typeof se;if(j=j!="object"?j:se?Array.isArray(se)?"array":j:"null",j=="array"||j=="object"&&typeof se.length=="number"){j=x.length||0;const ae=se.length||0;x.length=j+ae;for(let Ce=0;Ce<ae;Ce++)x[j+Ce]=se[Ce]}else x.push(se)}}class y{constructor(A,j){this.i=A,this.j=j,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function v(x){o.setTimeout(()=>{throw x},0)}function b(){var x=E;let A=null;return x.g&&(A=x.g,x.g=x.g.next,x.g||(x.h=null),A.next=null),A}class w{constructor(){this.h=this.g=null}add(A,j){const q=k.get();q.set(A,j),this.h?this.h.next=q:this.g=q,this.h=q}}var k=new y(()=>new T,x=>x.reset());class T{constructor(){this.next=this.g=this.h=null}set(A,j){this.h=A,this.g=j,this.next=null}reset(){this.next=this.g=this.h=null}}let R,M=!1,E=new w,I=()=>{const x=Promise.resolve(void 0);R=()=>{x.then(S)}};function S(){for(var x;x=b();){try{x.h.call(x.g)}catch(j){v(j)}var A=k;A.j(x),A.h<100&&(A.h++,x.next=A.g,A.g=x)}M=!1}function N(){this.u=this.u,this.C=this.C}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function P(x,A){this.type=x,this.g=this.target=A,this.defaultPrevented=!1}P.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var x=!1,A=Object.defineProperty({},"passive",{get:function(){x=!0}});try{const j=()=>{};o.addEventListener("test",j,A),o.removeEventListener("test",j,A)}catch{}return x}();function D(x){return/^[\s\xa0]*$/.test(x)}function G(x,A){P.call(this,x?x.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,x&&this.init(x,A)}h(G,P),G.prototype.init=function(x,A){const j=this.type=x.type,q=x.changedTouches&&x.changedTouches.length?x.changedTouches[0]:null;this.target=x.target||x.srcElement,this.g=A,A=x.relatedTarget,A||(j=="mouseover"?A=x.fromElement:j=="mouseout"&&(A=x.toElement)),this.relatedTarget=A,q?(this.clientX=q.clientX!==void 0?q.clientX:q.pageX,this.clientY=q.clientY!==void 0?q.clientY:q.pageY,this.screenX=q.screenX||0,this.screenY=q.screenY||0):(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0),this.button=x.button,this.key=x.key||"",this.ctrlKey=x.ctrlKey,this.altKey=x.altKey,this.shiftKey=x.shiftKey,this.metaKey=x.metaKey,this.pointerId=x.pointerId||0,this.pointerType=x.pointerType,this.state=x.state,this.i=x,x.defaultPrevented&&G.Z.h.call(this)},G.prototype.h=function(){G.Z.h.call(this);const x=this.i;x.preventDefault?x.preventDefault():x.returnValue=!1};var J="closure_listenable_"+(Math.random()*1e6|0),Q=0;function re(x,A,j,q,se){this.listener=x,this.proxy=null,this.src=A,this.type=j,this.capture=!!q,this.ha=se,this.key=++Q,this.da=this.fa=!1}function ne(x){x.da=!0,x.listener=null,x.proxy=null,x.src=null,x.ha=null}function te(x,A,j){for(const q in x)A.call(j,x[q],q,x)}function H(x,A){for(const j in x)A.call(void 0,x[j],j,x)}function ce(x){const A={};for(const j in x)A[j]=x[j];return A}const xe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function W(x,A){let j,q;for(let se=1;se<arguments.length;se++){q=arguments[se];for(j in q)x[j]=q[j];for(let ae=0;ae<xe.length;ae++)j=xe[ae],Object.prototype.hasOwnProperty.call(q,j)&&(x[j]=q[j])}}function dt(x){this.src=x,this.g={},this.h=0}dt.prototype.add=function(x,A,j,q,se){const ae=x.toString();x=this.g[ae],x||(x=this.g[ae]=[],this.h++);const Ce=Fe(x,A,q,se);return Ce>-1?(A=x[Ce],j||(A.fa=!1)):(A=new re(A,this.src,ae,!!q,se),A.fa=j,x.push(A)),A};function Me(x,A){const j=A.type;if(j in x.g){var q=x.g[j],se=Array.prototype.indexOf.call(q,A,void 0),ae;(ae=se>=0)&&Array.prototype.splice.call(q,se,1),ae&&(ne(A),x.g[j].length==0&&(delete x.g[j],x.h--))}}function Fe(x,A,j,q){for(let se=0;se<x.length;++se){const ae=x[se];if(!ae.da&&ae.listener==A&&ae.capture==!!j&&ae.ha==q)return se}return-1}var Ae="closure_lm_"+(Math.random()*1e6|0),lt={};function sn(x,A,j,q,se){if(Array.isArray(A)){for(let ae=0;ae<A.length;ae++)sn(x,A[ae],j,q,se);return null}return j=Dn(j),x&&x[J]?x.J(A,j,a(q)?!!q.capture:!1,se):un(x,A,j,!1,q,se)}function un(x,A,j,q,se,ae){if(!A)throw Error("Invalid event type");const Ce=a(se)?!!se.capture:!!se;let Ot=Tn(x);if(Ot||(x[Ae]=Ot=new dt(x)),j=Ot.add(A,j,q,Ce,ae),j.proxy)return j;if(q=Sr(),j.proxy=q,q.src=x,q.listener=j,x.addEventListener)O||(se=Ce),se===void 0&&(se=!1),x.addEventListener(A.toString(),q,se);else if(x.attachEvent)x.attachEvent(Or(A.toString()),q);else if(x.addListener&&x.removeListener)x.addListener(q);else throw Error("addEventListener and attachEvent are unavailable.");return j}function Sr(){function x(j){return A.call(x.src,x.listener,j)}const A=ht;return x}function ri(x,A,j,q,se){if(Array.isArray(A))for(var ae=0;ae<A.length;ae++)ri(x,A[ae],j,q,se);else q=a(q)?!!q.capture:!!q,j=Dn(j),x&&x[J]?(x=x.i,ae=String(A).toString(),ae in x.g&&(A=x.g[ae],j=Fe(A,j,q,se),j>-1&&(ne(A[j]),Array.prototype.splice.call(A,j,1),A.length==0&&(delete x.g[ae],x.h--)))):x&&(x=Tn(x))&&(A=x.g[A.toString()],x=-1,A&&(x=Fe(A,j,q,se)),(j=x>-1?A[x]:null)&&Yn(j))}function Yn(x){if(typeof x!="number"&&x&&!x.da){var A=x.src;if(A&&A[J])Me(A.i,x);else{var j=x.type,q=x.proxy;A.removeEventListener?A.removeEventListener(j,q,x.capture):A.detachEvent?A.detachEvent(Or(j),q):A.addListener&&A.removeListener&&A.removeListener(q),(j=Tn(A))?(Me(j,x),j.h==0&&(j.src=null,A[Ae]=null)):ne(x)}}}function Or(x){return x in lt?lt[x]:lt[x]="on"+x}function ht(x,A){if(x.da)x=!0;else{A=new G(A,this);const j=x.listener,q=x.ha||x.src;x.fa&&Yn(x),x=j.call(q,A)}return x}function Tn(x){return x=x[Ae],x instanceof dt?x:null}var Gt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Dn(x){return typeof x=="function"?x:(x[Gt]||(x[Gt]=function(A){return x.handleEvent(A)}),x[Gt])}function bt(){N.call(this),this.i=new dt(this),this.M=this,this.G=null}h(bt,N),bt.prototype[J]=!0,bt.prototype.removeEventListener=function(x,A,j,q){ri(this,x,A,j,q)};function $t(x,A){var j,q=x.G;if(q)for(j=[];q;q=q.G)j.push(q);if(x=x.M,q=A.type||A,typeof A=="string")A=new P(A,x);else if(A instanceof P)A.target=A.target||x;else{var se=A;A=new P(q,x),W(A,se)}se=!0;let ae,Ce;if(j)for(Ce=j.length-1;Ce>=0;Ce--)ae=A.g=j[Ce],se=er(ae,q,!0,A)&&se;if(ae=A.g=x,se=er(ae,q,!0,A)&&se,se=er(ae,q,!1,A)&&se,j)for(Ce=0;Ce<j.length;Ce++)ae=A.g=j[Ce],se=er(ae,q,!1,A)&&se}bt.prototype.N=function(){if(bt.Z.N.call(this),this.i){var x=this.i;for(const A in x.g){const j=x.g[A];for(let q=0;q<j.length;q++)ne(j[q]);delete x.g[A],x.h--}}this.G=null},bt.prototype.J=function(x,A,j,q){return this.i.add(String(x),A,!1,j,q)},bt.prototype.K=function(x,A,j,q){return this.i.add(String(x),A,!0,j,q)};function er(x,A,j,q){if(A=x.i.g[String(A)],!A)return!0;A=A.concat();let se=!0;for(let ae=0;ae<A.length;++ae){const Ce=A[ae];if(Ce&&!Ce.da&&Ce.capture==j){const Ot=Ce.listener,cs=Ce.ha||Ce.src;Ce.fa&&Me(x.i,Ce),se=Ot.call(cs,q)!==!1&&se}}return se&&!q.defaultPrevented}function js(x,A){if(typeof x!="function")if(x&&typeof x.handleEvent=="function")x=c(x.handleEvent,x);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:o.setTimeout(x,A||0)}function co(x){x.g=js(()=>{x.g=null,x.i&&(x.i=!1,co(x))},x.l);const A=x.h;x.h=null,x.m.apply(null,A)}class Rn extends N{constructor(A,j){super(),this.m=A,this.l=j,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:co(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ct(x){N.call(this),this.h=x,this.g={}}h(Ct,N);var oe=[];function pe(x){te(x.g,function(A,j){this.g.hasOwnProperty(j)&&Yn(A)},x),x.g={}}Ct.prototype.N=function(){Ct.Z.N.call(this),pe(this)},Ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ge=o.JSON.stringify,ft=o.JSON.parse,Ye=class{stringify(x){return o.JSON.stringify(x,void 0)}parse(x){return o.JSON.parse(x,void 0)}};function tt(){}function bn(){}var vn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function wn(){P.call(this,"d")}h(wn,P);function tr(){P.call(this,"c")}h(tr,P);var Xt={},ss=null;function mn(){return ss=ss||new bt}Xt.Ia="serverreachability";function il(x){P.call(this,Xt.Ia,x)}h(il,P);function uo(x){const A=mn();$t(A,new il(A))}Xt.STAT_EVENT="statevent";function jo(x,A){P.call(this,Xt.STAT_EVENT,x),this.stat=A}h(jo,P);function lr(x){const A=mn();$t(A,new jo(A,x))}Xt.Ja="timingevent";function wa(x,A){P.call(this,Xt.Ja,x),this.size=A}h(wa,P);function ol(x,A){if(typeof x!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){x()},A)}function al(){this.g=!0}al.prototype.ua=function(){this.g=!1};function Vn(x,A,j,q,se,ae){x.info(function(){if(x.g)if(ae){var Ce="",Ot=ae.split("&");for(let On=0;On<Ot.length;On++){var cs=Ot[On].split("=");if(cs.length>1){const ws=cs[0];cs=cs[1];const ql=ws.split("_");Ce=ql.length>=2&&ql[1]=="type"?Ce+(ws+"="+cs+"&"):Ce+(ws+"=redacted&")}}}else Ce=null;else Ce=ae;return"XMLHTTP REQ ("+q+") [attempt "+se+"]: "+A+`
`+j+`
`+Ce})}function Oo(x,A,j,q,se,ae,Ce){x.info(function(){return"XMLHTTP RESP ("+q+") [ attempt "+se+"]: "+A+`
`+j+`
`+ae+" "+Ce})}function Ri(x,A,j,q){x.info(function(){return"XMLHTTP TEXT ("+A+"): "+Ul(x,j)+(q?" "+q:"")})}function Kc(x,A){x.info(function(){return"TIMEOUT: "+A})}al.prototype.info=function(){};function Ul(x,A){if(!x.g)return A;if(!A)return null;try{const ae=JSON.parse(A);if(ae){for(x=0;x<ae.length;x++)if(Array.isArray(ae[x])){var j=ae[x];if(!(j.length<2)){var q=j[1];if(Array.isArray(q)&&!(q.length<1)){var se=q[0];if(se!="noop"&&se!="stop"&&se!="close")for(let Ce=1;Ce<q.length;Ce++)q[Ce]=""}}}}return Ge(ae)}catch{return A}}var ka={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},_a={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Hl;function Tr(){}h(Tr,tt),Tr.prototype.g=function(){return new XMLHttpRequest},Hl=new Tr;function vs(x){return encodeURIComponent(String(x))}function Yc(x){var A=1;x=x.split(":");const j=[];for(;A>0&&x.length;)j.push(x.shift()),A--;return x.length&&j.push(x.join(":")),j}function Os(x,A,j,q){this.j=x,this.i=A,this.l=j,this.S=q||1,this.V=new Ct(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Sa}function Sa(){this.i=null,this.g="",this.h=!1}var ll={},is={};function ve(x,A,j){x.M=1,x.A=wt($(A)),x.u=j,x.R=!0,Ne(x,null)}function Ne(x,A){x.F=Date.now(),we(x),x.B=$(x.A);var j=x.B,q=x.S;Array.isArray(q)||(q=[String(q)]),Nf(j.i,"t",q),x.C=0,j=x.j.L,x.h=new Sa,x.g=FM(x.j,j?A:null,!x.u),x.P>0&&(x.O=new Rn(c(x.Y,x,x.g),x.P)),A=x.V,j=x.g,q=x.ba;var se="readystatechange";Array.isArray(se)||(se&&(oe[0]=se.toString()),se=oe);for(let ae=0;ae<se.length;ae++){const Ce=sn(j,se[ae],q||A.handleEvent,!1,A.h||A);if(!Ce)break;A.g[Ce.key]=Ce}A=x.J?ce(x.J):{},x.u?(x.v||(x.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",x.g.ea(x.B,x.v,x.u,A)):(x.v="GET",x.g.ea(x.B,x.v,null,A)),uo(),Vn(x.i,x.v,x.B,x.l,x.S,x.u)}Os.prototype.ba=function(x){x=x.target;const A=this.O;A&&kd(x)==3?A.j():this.Y(x)},Os.prototype.Y=function(x){try{if(x==this.g)e:{const Ot=kd(this.g),cs=this.g.ya(),On=this.g.ca();if(!(Ot<3)&&(Ot!=3||this.g&&(this.h.h||this.g.la()||EM(this.g)))){this.K||Ot!=4||cs==7||(cs==8||On<=0?uo(3):uo(2)),le(this);var A=this.g.ca();this.X=A;var j=Qe(this);if(this.o=A==200,Oo(this.i,this.v,this.B,this.l,this.S,Ot,A),this.o){if(this.U&&!this.L){t:{if(this.g){var q,se=this.g;if((q=se.g?se.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(q)){var ae=q;break t}}ae=null}if(x=ae)Ri(this.i,this.l,x,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,jt(this,x);else{this.o=!1,this.m=3,lr(12),qe(this),he(this);break e}}if(this.R){x=!0;let ws;for(;!this.K&&this.C<j.length;)if(ws=Nt(this,j),ws==is){Ot==4&&(this.m=4,lr(14),x=!1),Ri(this.i,this.l,null,"[Incomplete Response]");break}else if(ws==ll){this.m=4,lr(15),Ri(this.i,this.l,j,"[Invalid Chunk]"),x=!1;break}else Ri(this.i,this.l,ws,null),jt(this,ws);if(it(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ot!=4||j.length!=0||this.h.h||(this.m=1,lr(16),x=!1),this.o=this.o&&x,!x)Ri(this.i,this.l,j,"[Invalid Chunked Response]"),qe(this),he(this);else if(j.length>0&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.aa&&!Ce.P&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),US(Ce),Ce.P=!0,lr(11))}}else Ri(this.i,this.l,j,null),jt(this,j);Ot==4&&qe(this),this.o&&!this.K&&(Ot==4?LM(this.j,this):(this.o=!1,we(this)))}else uZ(this.g),A==400&&j.indexOf("Unknown SID")>0?(this.m=3,lr(12)):(this.m=0,lr(13)),qe(this),he(this)}}}catch{}finally{}};function Qe(x){if(!it(x))return x.g.la();const A=EM(x.g);if(A==="")return"";let j="";const q=A.length,se=kd(x.g)==4;if(!x.h.i){if(typeof TextDecoder>"u")return qe(x),he(x),"";x.h.i=new o.TextDecoder}for(let ae=0;ae<q;ae++)x.h.h=!0,j+=x.h.i.decode(A[ae],{stream:!(se&&ae==q-1)});return A.length=0,x.h.g+=j,x.C=0,x.h.g}function it(x){return x.g?x.v=="GET"&&x.M!=2&&x.j.Aa:!1}function Nt(x,A){var j=x.C,q=A.indexOf(`
`,j);return q==-1?is:(j=Number(A.substring(j,q)),isNaN(j)?ll:(q+=1,q+j>A.length?is:(A=A.slice(q,q+j),x.C=q+j,A)))}Os.prototype.cancel=function(){this.K=!0,qe(this)};function we(x){x.T=Date.now()+x.H,Y(x,x.H)}function Y(x,A){if(x.D!=null)throw Error("WatchDog timer not null");x.D=ol(c(x.aa,x),A)}function le(x){x.D&&(o.clearTimeout(x.D),x.D=null)}Os.prototype.aa=function(){this.D=null;const x=Date.now();x-this.T>=0?(Kc(this.i,this.B),this.M!=2&&(uo(),lr(17)),qe(this),this.m=2,he(this)):Y(this,this.T-x)};function he(x){x.j.I==0||x.K||LM(x.j,x)}function qe(x){le(x);var A=x.O;A&&typeof A.dispose=="function"&&A.dispose(),x.O=null,pe(x.V),x.g&&(A=x.g,x.g=null,A.abort(),A.dispose())}function jt(x,A){try{var j=x.j;if(j.I!=0&&(j.g==x||pt(j.h,x))){if(!x.L&&pt(j.h,x)&&j.I==3){try{var q=j.Ba.g.parse(A)}catch{q=null}if(Array.isArray(q)&&q.length==3){var se=q;if(se[0]==0){e:if(!j.v){if(j.g)if(j.g.F+3e3<x.F)m2(j),f2(j);else break e;VS(j),lr(18)}}else j.xa=se[1],0<j.xa-j.K&&se[2]<37500&&j.F&&j.A==0&&!j.C&&(j.C=ol(c(j.Va,j),6e3));It(j.h)<=1&&j.ta&&(j.ta=void 0)}else Rf(j,11)}else if((x.L||j.g==x)&&m2(j),!D(A))for(se=j.Ba.g.parse(A),A=0;A<se.length;A++){let On=se[A];const ws=On[0];if(!(ws<=j.K))if(j.K=ws,On=On[1],j.I==2)if(On[0]=="c"){j.M=On[1],j.ba=On[2];const ql=On[3];ql!=null&&(j.ka=ql,j.j.info("VER="+j.ka));const Mf=On[4];Mf!=null&&(j.za=Mf,j.j.info("SVER="+j.za));const _d=On[5];_d!=null&&typeof _d=="number"&&_d>0&&(q=1.5*_d,j.O=q,j.j.info("backChannelRequestTimeoutMs_="+q)),q=j;const Sd=x.g;if(Sd){const y2=Sd.g?Sd.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y2){var ae=q.h;ae.g||y2.indexOf("spdy")==-1&&y2.indexOf("quic")==-1&&y2.indexOf("h2")==-1||(ae.j=ae.l,ae.g=new Set,ae.h&&(ye(ae,ae.h),ae.h=null))}if(q.G){const HS=Sd.g?Sd.g.getResponseHeader("X-HTTP-Session-Id"):null;HS&&(q.wa=HS,je(q.J,q.G,HS))}}j.I=3,j.l&&j.l.ra(),j.aa&&(j.T=Date.now()-x.F,j.j.info("Handshake RTT: "+j.T+"ms")),q=j;var Ce=x;if(q.na=OM(q,q.L?q.ba:null,q.W),Ce.L){Jt(q.h,Ce);var Ot=Ce,cs=q.O;cs&&(Ot.H=cs),Ot.D&&(le(Ot),we(Ot)),q.g=Ce}else MM(q);j.i.length>0&&p2(j)}else On[0]!="stop"&&On[0]!="close"||Rf(j,7);else j.I==3&&(On[0]=="stop"||On[0]=="close"?On[0]=="stop"?Rf(j,7):$S(j):On[0]!="noop"&&j.l&&j.l.qa(On),j.A=0)}}uo(4)}catch{}}var Le=class{constructor(x,A){this.g=x,this.map=A}};function yt(x){this.l=x||10,o.PerformanceNavigationTiming?(x=o.performance.getEntriesByType("navigation"),x=x.length>0&&(x[0].nextHopProtocol=="hq"||x[0].nextHopProtocol=="h2")):x=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=x?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Xe(x){return x.h?!0:x.g?x.g.size>=x.j:!1}function It(x){return x.h?1:x.g?x.g.size:0}function pt(x,A){return x.h?x.h==A:x.g?x.g.has(A):!1}function ye(x,A){x.g?x.g.add(A):x.h=A}function Jt(x,A){x.h&&x.h==A?x.h=null:x.g&&x.g.has(A)&&x.g.delete(A)}yt.prototype.cancel=function(){if(this.i=tn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const x of this.g.values())x.cancel();this.g.clear()}};function tn(x){if(x.h!=null)return x.i.concat(x.h.G);if(x.g!=null&&x.g.size!==0){let A=x.i;for(const j of x.g.values())A=A.concat(j.G);return A}return p(x.i)}var kn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function on(x,A){if(x){x=x.split("&");for(let j=0;j<x.length;j++){const q=x[j].indexOf("=");let se,ae=null;q>=0?(se=x[j].substring(0,q),ae=x[j].substring(q+1)):se=x[j],A(se,ae?decodeURIComponent(ae.replace(/\+/g," ")):"")}}}function vt(x){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;x instanceof vt?(this.l=x.l,ee(this,x.j),this.o=x.o,this.g=x.g,de(this,x.u),this.h=x.h,ze(this,ay(x.i)),this.m=x.m):x&&(A=String(x).match(kn))?(this.l=!1,ee(this,A[1]||"",!0),this.o=dn(A[2]||""),this.g=dn(A[3]||"",!0),de(this,A[4]),this.h=dn(A[5]||"",!0),ze(this,A[6]||"",!0),this.m=dn(A[7]||"")):(this.l=!1,this.i=new ur(null,this.l))}vt.prototype.toString=function(){const x=[];var A=this.j;A&&x.push(Ar(A,si,!0),":");var j=this.g;return(j||A=="file")&&(x.push("//"),(A=this.o)&&x.push(Ar(A,si,!0),"@"),x.push(vs(j).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),j=this.u,j!=null&&x.push(":",String(j))),(j=this.h)&&(this.g&&j.charAt(0)!="/"&&x.push("/"),x.push(Ar(j,j.charAt(0)=="/"?cr:kt,!0))),(j=this.i.toString())&&x.push("?",j),(j=this.m)&&x.push("#",Ar(j,Fr)),x.join("")},vt.prototype.resolve=function(x){const A=$(this);let j=!!x.j;j?ee(A,x.j):j=!!x.o,j?A.o=x.o:j=!!x.g,j?A.g=x.g:j=x.u!=null;var q=x.h;if(j)de(A,x.u);else if(j=!!x.h){if(q.charAt(0)!="/")if(this.g&&!this.h)q="/"+q;else{var se=A.h.lastIndexOf("/");se!=-1&&(q=A.h.slice(0,se+1)+q)}if(se=q,se==".."||se==".")q="";else if(se.indexOf("./")!=-1||se.indexOf("/.")!=-1){q=se.lastIndexOf("/",0)==0,se=se.split("/");const ae=[];for(let Ce=0;Ce<se.length;){const Ot=se[Ce++];Ot=="."?q&&Ce==se.length&&ae.push(""):Ot==".."?((ae.length>1||ae.length==1&&ae[0]!="")&&ae.pop(),q&&Ce==se.length&&ae.push("")):(ae.push(Ot),q=!0)}q=ae.join("/")}else q=se}return j?A.h=q:j=x.i.toString()!=="",j?ze(A,ay(x.i)):j=!!x.m,j&&(A.m=x.m),A};function $(x){return new vt(x)}function ee(x,A,j){x.j=j?dn(A,!0):A,x.j&&(x.j=x.j.replace(/:$/,""))}function de(x,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);x.u=A}else x.u=null}function ze(x,A,j){A instanceof ur?(x.i=A,st(x.i,x.l)):(j||(A=Ar(A,An)),x.i=new ur(A,x.l))}function je(x,A,j){x.i.set(A,j)}function wt(x){return je(x,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),x}function dn(x,A){return x?A?decodeURI(x.replace(/%25/g,"%2525")):decodeURIComponent(x):""}function Ar(x,A,j){return typeof x=="string"?(x=encodeURI(x).replace(A,as),j&&(x=x.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x):null}function as(x){return x=x.charCodeAt(0),"%"+(x>>4&15).toString(16)+(x&15).toString(16)}var si=/[#\/\?@]/g,kt=/[#\?:]/g,cr=/[#\?]/g,An=/[#\?@]/g,Fr=/#/g;function ur(x,A){this.h=this.g=null,this.i=x||null,this.j=!!A}function ii(x){x.g||(x.g=new Map,x.h=0,x.i&&on(x.i,function(A,j){x.add(decodeURIComponent(A.replace(/\+/g," ")),j)}))}n=ur.prototype,n.add=function(x,A){ii(this),this.i=null,x=an(this,x);let j=this.g.get(x);return j||this.g.set(x,j=[]),j.push(A),this.h+=1,this};function Ta(x,A){ii(x),A=an(x,A),x.g.has(A)&&(x.i=null,x.h-=x.g.get(A).length,x.g.delete(A))}function vd(x,A){return ii(x),A=an(x,A),x.g.has(A)}n.forEach=function(x,A){ii(this),this.g.forEach(function(j,q){j.forEach(function(se){x.call(A,se,q,this)},this)},this)};function sm(x,A){ii(x);let j=[];if(typeof A=="string")vd(x,A)&&(j=j.concat(x.g.get(an(x,A))));else for(x=Array.from(x.g.values()),A=0;A<x.length;A++)j=j.concat(x[A]);return j}n.set=function(x,A){return ii(this),this.i=null,x=an(this,x),vd(this,x)&&(this.h-=this.g.get(x).length),this.g.set(x,[A]),this.h+=1,this},n.get=function(x,A){return x?(x=sm(this,x),x.length>0?String(x[0]):A):A};function Nf(x,A,j){Ta(x,A),j.length>0&&(x.i=null,x.g.set(an(x,A),p(j)),x.h+=j.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const x=[],A=Array.from(this.g.keys());for(let q=0;q<A.length;q++){var j=A[q];const se=vs(j);j=sm(this,j);for(let ae=0;ae<j.length;ae++){let Ce=se;j[ae]!==""&&(Ce+="="+vs(j[ae])),x.push(Ce)}}return this.i=x.join("&")};function ay(x){const A=new ur;return A.i=x.i,x.g&&(A.g=new Map(x.g),A.h=x.h),A}function an(x,A){return A=String(A),x.j&&(A=A.toLowerCase()),A}function st(x,A){A&&!x.j&&(ii(x),x.i=null,x.g.forEach(function(j,q){const se=q.toLowerCase();q!=se&&(Ta(this,q),Nf(this,se,j))},x)),x.j=A}function jn(x,A){const j=new al;if(o.Image){const q=new Image;q.onload=u(ls,j,"TestLoadImage: loaded",!0,A,q),q.onerror=u(ls,j,"TestLoadImage: error",!1,A,q),q.onabort=u(ls,j,"TestLoadImage: abort",!1,A,q),q.ontimeout=u(ls,j,"TestLoadImage: timeout",!1,A,q),o.setTimeout(function(){q.ontimeout&&q.ontimeout()},1e4),q.src=x}else A(!1)}function Fo(x,A){const j=new al,q=new AbortController,se=setTimeout(()=>{q.abort(),ls(j,"TestPingServer: timeout",!1,A)},1e4);fetch(x,{signal:q.signal}).then(ae=>{clearTimeout(se),ae.ok?ls(j,"TestPingServer: ok",!0,A):ls(j,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(se),ls(j,"TestPingServer: error",!1,A)})}function ls(x,A,j,q,se){try{se&&(se.onload=null,se.onerror=null,se.onabort=null,se.ontimeout=null),q(j)}catch{}}function Xc(){this.g=new Ye}function Fs(x){this.i=x.Sb||null,this.h=x.ab||!1}h(Fs,tt),Fs.prototype.g=function(){return new Mi(this.i,this.h)};function Mi(x,A){bt.call(this),this.H=x,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Mi,bt),n=Mi.prototype,n.open=function(x,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=x,this.D=A,this.readyState=1,im(this)},n.send=function(x){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};x&&(A.body=x),(this.H||o).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,If(this)),this.readyState=0},n.Pa=function(x){if(this.g&&(this.l=x,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=x.headers,this.readyState=2,im(this)),this.g&&(this.readyState=3,im(this),this.g)))if(this.responseType==="arraybuffer")x.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in x){if(this.j=x.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;wd(this)}else x.text().then(this.Oa.bind(this),this.ga.bind(this))};function wd(x){x.j.read().then(x.Ma.bind(x)).catch(x.ga.bind(x))}n.Ma=function(x){if(this.g){if(this.o&&x.value)this.response.push(x.value);else if(!this.o){var A=x.value?x.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!x.done}))&&(this.response=this.responseText+=A)}x.done?If(this):im(this),this.readyState==3&&wd(this)}},n.Oa=function(x){this.g&&(this.response=this.responseText=x,If(this))},n.Na=function(x){this.g&&(this.response=x,If(this))},n.ga=function(){this.g&&If(this)};function If(x){x.readyState=4,x.l=null,x.j=null,x.B=null,im(x)}n.setRequestHeader=function(x,A){this.A.append(x,A)},n.getResponseHeader=function(x){return this.h&&this.h.get(x.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const x=[],A=this.h.entries();for(var j=A.next();!j.done;)j=j.value,x.push(j[0]+": "+j[1]),j=A.next();return x.join(`\r
`)};function im(x){x.onreadystatechange&&x.onreadystatechange.call(x)}Object.defineProperty(Mi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(x){this.m=x?"include":"same-origin"}});function _M(x){let A="";return te(x,function(j,q){A+=q,A+=":",A+=j,A+=`\r
`}),A}function BS(x,A,j){e:{for(q in j){var q=!1;break e}q=!0}q||(j=_M(j),typeof x=="string"?j!=null&&vs(j):je(x,A,j))}function Er(x){bt.call(this),this.headers=new Map,this.L=x||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Er,bt);var lZ=/^https?$/i,cZ=["POST","PUT"];n=Er.prototype,n.Fa=function(x){this.H=x},n.ea=function(x,A,j,q){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+x);A=A?A.toUpperCase():"GET",this.D=x,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Hl.g(),this.g.onreadystatechange=f(c(this.Ca,this));try{this.B=!0,this.g.open(A,String(x),!0),this.B=!1}catch(ae){SM(this,ae);return}if(x=j||"",j=new Map(this.headers),q)if(Object.getPrototypeOf(q)===Object.prototype)for(var se in q)j.set(se,q[se]);else if(typeof q.keys=="function"&&typeof q.get=="function")for(const ae of q.keys())j.set(ae,q.get(ae));else throw Error("Unknown input type for opt_headers: "+String(q));q=Array.from(j.keys()).find(ae=>ae.toLowerCase()=="content-type"),se=o.FormData&&x instanceof o.FormData,!(Array.prototype.indexOf.call(cZ,A,void 0)>=0)||q||se||j.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ae,Ce]of j)this.g.setRequestHeader(ae,Ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(x),this.v=!1}catch(ae){SM(this,ae)}};function SM(x,A){x.h=!1,x.g&&(x.j=!0,x.g.abort(),x.j=!1),x.l=A,x.o=5,TM(x),h2(x)}function TM(x){x.A||(x.A=!0,$t(x,"complete"),$t(x,"error"))}n.abort=function(x){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=x||7,$t(this,"complete"),$t(this,"abort"),h2(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),h2(this,!0)),Er.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?AM(this):this.Xa())},n.Xa=function(){AM(this)};function AM(x){if(x.h&&typeof i<"u"){if(x.v&&kd(x)==4)setTimeout(x.Ca.bind(x),0);else if($t(x,"readystatechange"),kd(x)==4){x.h=!1;try{const ae=x.ca();e:switch(ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var j;if(!(j=A)){var q;if(q=ae===0){let Ce=String(x.D).match(kn)[1]||null;!Ce&&o.self&&o.self.location&&(Ce=o.self.location.protocol.slice(0,-1)),q=!lZ.test(Ce?Ce.toLowerCase():"")}j=q}if(j)$t(x,"complete"),$t(x,"success");else{x.o=6;try{var se=kd(x)>2?x.g.statusText:""}catch{se=""}x.l=se+" ["+x.ca()+"]",TM(x)}}finally{h2(x)}}}}function h2(x,A){if(x.g){x.m&&(clearTimeout(x.m),x.m=null);const j=x.g;x.g=null,A||$t(x,"ready");try{j.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function kd(x){return x.g?x.g.readyState:0}n.ca=function(){try{return kd(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(x){if(this.g){var A=this.g.responseText;return x&&A.indexOf(x)==0&&(A=A.substring(x.length)),ft(A)}};function EM(x){try{if(!x.g)return null;if("response"in x.g)return x.g.response;switch(x.F){case"":case"text":return x.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in x.g)return x.g.mozResponseArrayBuffer}return null}catch{return null}}function uZ(x){const A={};x=(x.g&&kd(x)>=2&&x.g.getAllResponseHeaders()||"").split(`\r
`);for(let q=0;q<x.length;q++){if(D(x[q]))continue;var j=Yc(x[q]);const se=j[0];if(j=j[1],typeof j!="string")continue;j=j.trim();const ae=A[se]||[];A[se]=ae,ae.push(j)}H(A,function(q){return q.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ly(x,A,j){return j&&j.internalChannelParams&&j.internalChannelParams[x]||A}function CM(x){this.za=0,this.i=[],this.j=new al,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ly("failFast",!1,x),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ly("baseRetryDelayMs",5e3,x),this.Za=ly("retryDelaySeedMs",1e4,x),this.Ta=ly("forwardChannelMaxRetries",2,x),this.va=ly("forwardChannelRequestTimeoutMs",2e4,x),this.ma=x&&x.xmlHttpFactory||void 0,this.Ua=x&&x.Rb||void 0,this.Aa=x&&x.useFetchStreams||!1,this.O=void 0,this.L=x&&x.supportsCrossDomainXhr||!1,this.M="",this.h=new yt(x&&x.concurrentRequestLimit),this.Ba=new Xc,this.S=x&&x.fastHandshake||!1,this.R=x&&x.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=x&&x.Pb||!1,x&&x.ua&&this.j.ua(),x&&x.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&x&&x.detectBufferingProxy||!1,this.ia=void 0,x&&x.longPollingTimeout&&x.longPollingTimeout>0&&(this.ia=x.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=CM.prototype,n.ka=8,n.I=1,n.connect=function(x,A,j,q){lr(0),this.W=x,this.H=A||{},j&&q!==void 0&&(this.H.OSID=j,this.H.OAID=q),this.F=this.X,this.J=OM(this,null,this.W),p2(this)};function $S(x){if(NM(x),x.I==3){var A=x.V++,j=$(x.J);if(je(j,"SID",x.M),je(j,"RID",A),je(j,"TYPE","terminate"),cy(x,j),A=new Os(x,x.j,A),A.M=2,A.A=wt($(j)),j=!1,o.navigator&&o.navigator.sendBeacon)try{j=o.navigator.sendBeacon(A.A.toString(),"")}catch{}!j&&o.Image&&(new Image().src=A.A,j=!0),j||(A.g=FM(A.j,null),A.g.ea(A.A)),A.F=Date.now(),we(A)}jM(x)}function f2(x){x.g&&(US(x),x.g.cancel(),x.g=null)}function NM(x){f2(x),x.v&&(o.clearTimeout(x.v),x.v=null),m2(x),x.h.cancel(),x.m&&(typeof x.m=="number"&&o.clearTimeout(x.m),x.m=null)}function p2(x){if(!Xe(x.h)&&!x.m){x.m=!0;var A=x.Ea;R||I(),M||(R(),M=!0),E.add(A,x),x.D=0}}function dZ(x,A){return It(x.h)>=x.h.j-(x.m?1:0)?!1:x.m?(x.i=A.G.concat(x.i),!0):x.I==1||x.I==2||x.D>=(x.Sa?0:x.Ta)?!1:(x.m=ol(c(x.Ea,x,A),DM(x,x.D)),x.D++,!0)}n.Ea=function(x){if(this.m)if(this.m=null,this.I==1){if(!x){this.V=Math.floor(Math.random()*1e5),x=this.V++;const se=new Os(this,this.j,x);let ae=this.o;if(this.U&&(ae?(ae=ce(ae),W(ae,this.U)):ae=this.U),this.u!==null||this.R||(se.J=ae,ae=null),this.S)e:{for(var A=0,j=0;j<this.i.length;j++){t:{var q=this.i[j];if("__data__"in q.map&&(q=q.map.__data__,typeof q=="string")){q=q.length;break t}q=void 0}if(q===void 0)break;if(A+=q,A>4096){A=j;break e}if(A===4096||j===this.i.length-1){A=j+1;break e}}A=1e3}else A=1e3;A=RM(this,se,A),j=$(this.J),je(j,"RID",x),je(j,"CVER",22),this.G&&je(j,"X-HTTP-Session-Id",this.G),cy(this,j),ae&&(this.R?A="headers="+vs(_M(ae))+"&"+A:this.u&&BS(j,this.u,ae)),ye(this.h,se),this.Ra&&je(j,"TYPE","init"),this.S?(je(j,"$req",A),je(j,"SID","null"),se.U=!0,ve(se,j,null)):ve(se,j,A),this.I=2}}else this.I==3&&(x?IM(this,x):this.i.length==0||Xe(this.h)||IM(this))};function IM(x,A){var j;A?j=A.l:j=x.V++;const q=$(x.J);je(q,"SID",x.M),je(q,"RID",j),je(q,"AID",x.K),cy(x,q),x.u&&x.o&&BS(q,x.u,x.o),j=new Os(x,x.j,j,x.D+1),x.u===null&&(j.J=x.o),A&&(x.i=A.G.concat(x.i)),A=RM(x,j,1e3),j.H=Math.round(x.va*.5)+Math.round(x.va*.5*Math.random()),ye(x.h,j),ve(j,q,A)}function cy(x,A){x.H&&te(x.H,function(j,q){je(A,q,j)}),x.l&&te({},function(j,q){je(A,q,j)})}function RM(x,A,j){j=Math.min(x.i.length,j);const q=x.l?c(x.l.Ka,x.l,x):null;e:{var se=x.i;let Ot=-1;for(;;){const cs=["count="+j];Ot==-1?j>0?(Ot=se[0].g,cs.push("ofs="+Ot)):Ot=0:cs.push("ofs="+Ot);let On=!0;for(let ws=0;ws<j;ws++){var ae=se[ws].g;const ql=se[ws].map;if(ae-=Ot,ae<0)Ot=Math.max(0,se[ws].g-100),On=!1;else try{ae="req"+ae+"_"||"";try{var Ce=ql instanceof Map?ql:Object.entries(ql);for(const[Mf,_d]of Ce){let Sd=_d;a(_d)&&(Sd=Ge(_d)),cs.push(ae+Mf+"="+encodeURIComponent(Sd))}}catch(Mf){throw cs.push(ae+"type="+encodeURIComponent("_badmap")),Mf}}catch{q&&q(ql)}}if(On){Ce=cs.join("&");break e}}Ce=void 0}return x=x.i.splice(0,j),A.G=x,Ce}function MM(x){if(!x.g&&!x.v){x.Y=1;var A=x.Da;R||I(),M||(R(),M=!0),E.add(A,x),x.A=0}}function VS(x){return x.g||x.v||x.A>=3?!1:(x.Y++,x.v=ol(c(x.Da,x),DM(x,x.A)),x.A++,!0)}n.Da=function(){if(this.v=null,PM(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var x=4*this.T;this.j.info("BP detection timer enabled: "+x),this.B=ol(c(this.Wa,this),x)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,lr(10),f2(this),PM(this))};function US(x){x.B!=null&&(o.clearTimeout(x.B),x.B=null)}function PM(x){x.g=new Os(x,x.j,"rpc",x.Y),x.u===null&&(x.g.J=x.o),x.g.P=0;var A=$(x.na);je(A,"RID","rpc"),je(A,"SID",x.M),je(A,"AID",x.K),je(A,"CI",x.F?"0":"1"),!x.F&&x.ia&&je(A,"TO",x.ia),je(A,"TYPE","xmlhttp"),cy(x,A),x.u&&x.o&&BS(A,x.u,x.o),x.O&&(x.g.H=x.O);var j=x.g;x=x.ba,j.M=1,j.A=wt($(A)),j.u=null,j.R=!0,Ne(j,x)}n.Va=function(){this.C!=null&&(this.C=null,f2(this),VS(this),lr(19))};function m2(x){x.C!=null&&(o.clearTimeout(x.C),x.C=null)}function LM(x,A){var j=null;if(x.g==A){m2(x),US(x),x.g=null;var q=2}else if(pt(x.h,A))j=A.G,Jt(x.h,A),q=1;else return;if(x.I!=0){if(A.o)if(q==1){j=A.u?A.u.length:0,A=Date.now()-A.F;var se=x.D;q=mn(),$t(q,new wa(q,j)),p2(x)}else MM(x);else if(se=A.m,se==3||se==0&&A.X>0||!(q==1&&dZ(x,A)||q==2&&VS(x)))switch(j&&j.length>0&&(A=x.h,A.i=A.i.concat(j)),se){case 1:Rf(x,5);break;case 4:Rf(x,10);break;case 3:Rf(x,6);break;default:Rf(x,2)}}}function DM(x,A){let j=x.Qa+Math.floor(Math.random()*x.Za);return x.isActive()||(j*=2),j*A}function Rf(x,A){if(x.j.info("Error code "+A),A==2){var j=c(x.bb,x),q=x.Ua;const se=!q;q=new vt(q||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ee(q,"https"),wt(q),se?jn(q.toString(),j):Fo(q.toString(),j)}else lr(2);x.I=0,x.l&&x.l.pa(A),jM(x),NM(x)}n.bb=function(x){x?(this.j.info("Successfully pinged google.com"),lr(2)):(this.j.info("Failed to ping google.com"),lr(1))};function jM(x){if(x.I=0,x.ja=[],x.l){const A=tn(x.h);(A.length!=0||x.i.length!=0)&&(g(x.ja,A),g(x.ja,x.i),x.h.i.length=0,p(x.i),x.i.length=0),x.l.oa()}}function OM(x,A,j){var q=j instanceof vt?$(j):new vt(j);if(q.g!="")A&&(q.g=A+"."+q.g),de(q,q.u);else{var se=o.location;q=se.protocol,A=A?A+"."+se.hostname:se.hostname,se=+se.port;const ae=new vt(null);q&&ee(ae,q),A&&(ae.g=A),se&&de(ae,se),j&&(ae.h=j),q=ae}return j=x.G,A=x.wa,j&&A&&je(q,j,A),je(q,"VER",x.ka),cy(x,q),q}function FM(x,A,j){if(A&&!x.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=x.Aa&&!x.ma?new Er(new Fs({ab:j})):new Er(x.ma),A.Fa(x.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function zM(){}n=zM.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function g2(){}g2.prototype.g=function(x,A){return new zo(x,A)};function zo(x,A){bt.call(this),this.g=new CM(A),this.l=x,this.h=A&&A.messageUrlParams||null,x=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(x?x["X-Client-Protocol"]="webchannel":x={"X-Client-Protocol":"webchannel"}),this.g.o=x,x=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(x?x["X-WebChannel-Content-Type"]=A.messageContentType:x={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(x?x["X-WebChannel-Client-Profile"]=A.sa:x={"X-WebChannel-Client-Profile":A.sa}),this.g.U=x,(x=A&&A.Qb)&&!D(x)&&(this.g.u=x),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!D(A)&&(this.g.G=A,x=this.h,x!==null&&A in x&&(x=this.h,A in x&&delete x[A])),this.j=new om(this)}h(zo,bt),zo.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},zo.prototype.close=function(){$S(this.g)},zo.prototype.o=function(x){var A=this.g;if(typeof x=="string"){var j={};j.__data__=x,x=j}else this.v&&(j={},j.__data__=Ge(x),x=j);A.i.push(new Le(A.Ya++,x)),A.I==3&&p2(A)},zo.prototype.N=function(){this.g.l=null,delete this.j,$S(this.g),delete this.g,zo.Z.N.call(this)};function BM(x){wn.call(this),x.__headers__&&(this.headers=x.__headers__,this.statusCode=x.__status__,delete x.__headers__,delete x.__status__);var A=x.__sm__;if(A){e:{for(const j in A){x=j;break e}x=void 0}(this.i=x)&&(x=this.i,A=A!==null&&x in A?A[x]:void 0),this.data=A}else this.data=x}h(BM,wn);function $M(){tr.call(this),this.status=1}h($M,tr);function om(x){this.g=x}h(om,zM),om.prototype.ra=function(){$t(this.g,"a")},om.prototype.qa=function(x){$t(this.g,new BM(x))},om.prototype.pa=function(x){$t(this.g,new $M)},om.prototype.oa=function(){$t(this.g,"b")},g2.prototype.createWebChannel=g2.prototype.g,zo.prototype.send=zo.prototype.o,zo.prototype.open=zo.prototype.m,zo.prototype.close=zo.prototype.close,OV=function(){return new g2},jV=function(){return mn()},DV=Xt,m6={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ka.NO_ERROR=0,ka.TIMEOUT=8,ka.HTTP_ERROR=6,D4=ka,_a.COMPLETE="complete",LV=_a,bn.EventType=vn,vn.OPEN="a",vn.CLOSE="b",vn.ERROR="c",vn.MESSAGE="d",bt.prototype.listen=bt.prototype.J,$y=bn,Er.prototype.listenOnce=Er.prototype.K,Er.prototype.getLastError=Er.prototype.Ha,Er.prototype.getLastErrorCode=Er.prototype.ya,Er.prototype.getStatus=Er.prototype.ca,Er.prototype.getResponseJson=Er.prototype.La,Er.prototype.getResponseText=Er.prototype.la,Er.prototype.send=Er.prototype.ea,Er.prototype.setWithCredentials=Er.prototype.Fa,PV=Er}).apply(typeof D2<"u"?D2:typeof self<"u"?self:typeof window<"u"?window:{});const kP="@firebase/firestore",_P="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}yi.UNAUTHENTICATED=new yi(null),yi.GOOGLE_CREDENTIALS=new yi("google-credentials-uid"),yi.FIRST_PARTY=new yi("first-party-uid"),yi.MOCK_USER=new yi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K1="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T0=new A3("@firebase/firestore");function fm(){return T0.logLevel}function Be(n,...e){if(T0.logLevel<=Qt.DEBUG){const t=e.map(b7);T0.debug(`Firestore (${K1}): ${n}`,...t)}}function td(n,...e){if(T0.logLevel<=Qt.ERROR){const t=e.map(b7);T0.error(`Firestore (${K1}): ${n}`,...t)}}function k1(n,...e){if(T0.logLevel<=Qt.WARN){const t=e.map(b7);T0.warn(`Firestore (${K1}): ${n}`,...t)}}function b7(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gt(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,FV(n,r,t)}function FV(n,e,t){let r=`FIRESTORE (${K1}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw td(r),new Error(r)}function _n(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||FV(e,s,r)}function Et(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Re extends xa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class kse{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(yi.UNAUTHENTICATED))}shutdown(){}}class _se{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Sse{constructor(e){this.t=e,this.currentUser=yi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_n(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Uu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Uu,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Be("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Be("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Uu)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Be("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(_n(typeof r.accessToken=="string",31837,{l:r}),new zV(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _n(e===null||typeof e=="string",2055,{h:e}),new yi(e)}}class Tse{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=yi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ase{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Tse(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(yi.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class SP{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ese{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,wi(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){_n(this.o===void 0,3512);const r=i=>{i.error!=null&&Be("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Be("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Be("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):Be("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new SP(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(_n(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new SP(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cse(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v7{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Cse(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Zt(n,e){return n<e?-1:n>e?1:0}function g6(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return ST(s)===ST(i)?Zt(s,i):ST(s)?1:-1}return Zt(n.length,e.length)}const Nse=55296,Ise=57343;function ST(n){const e=n.charCodeAt(0);return e>=Nse&&e<=Ise}function _1(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP="__name__";class rc{constructor(e,t,r){t===void 0?t=0:t>e.length&&gt(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&gt(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return rc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof rc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=rc.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Zt(e.length,t.length)}static compareSegments(e,t){const r=rc.isNumericId(e),s=rc.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?rc.extractNumericId(e).compare(rc.extractNumericId(t)):g6(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return $h.fromString(e.substring(4,e.length-2))}}class qn extends rc{construct(e,t,r){return new qn(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Re(ue.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new qn(t)}static emptyPath(){return new qn([])}}const Rse=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Js extends rc{construct(e,t,r){return new Js(e,t,r)}static isValidIdentifier(e){return Rse.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Js.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===TP}static keyField(){return new Js([TP])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Re(ue.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Re(ue.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Re(ue.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Re(ue.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Js(t)}static emptyPath(){return new Js([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.path=e}static fromPath(e){return new et(qn.fromString(e))}static fromName(e){return new et(qn.fromString(e).popFirst(5))}static empty(){return new et(qn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return qn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new et(new qn(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BV(n,e,t){if(!t)throw new Re(ue.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Mse(n,e,t,r){if(e===!0&&r===!0)throw new Re(ue.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function AP(n){if(!et.isDocumentKey(n))throw new Re(ue.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function EP(n){if(et.isDocumentKey(n))throw new Re(ue.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $V(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function E3(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":gt(12329,{type:typeof n})}function Yi(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Re(ue.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=E3(n);throw new Re(ue.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Pse(n,e){if(e<=0)throw new Re(ue.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jr(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ew(n,e){if(!$V(n))throw new Re(ue.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new Re(ue.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CP=-62135596800,NP=1e6;class Gn{static now(){return Gn.fromMillis(Date.now())}static fromDate(e){return Gn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*NP);return new Gn(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Re(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Re(ue.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<CP)throw new Re(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Re(ue.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/NP}_compareTo(e){return this.seconds===e.seconds?Zt(this.nanoseconds,e.nanoseconds):Zt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Gn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ew(e,Gn._jsonSchema))return new Gn(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-CP;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Gn._jsonSchemaVersion="firestore/timestamp/1.0",Gn._jsonSchema={type:Jr("string",Gn._jsonSchemaVersion),seconds:Jr("number"),nanoseconds:Jr("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{static fromTimestamp(e){return new Tt(e)}static min(){return new Tt(new Gn(0,0))}static max(){return new Tt(new Gn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gb=-1;function Lse(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Tt.fromTimestamp(r===1e9?new Gn(t+1,0):new Gn(t,r));return new ef(s,et.empty(),e)}function Dse(n){return new ef(n.readTime,n.key,gb)}class ef{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ef(Tt.min(),et.empty(),gb)}static max(){return new ef(Tt.max(),et.empty(),gb)}}function jse(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=et.comparator(n.documentKey,e.documentKey),t!==0?t:Zt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ose="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fse{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y1(n){if(n.code!==ue.FAILED_PRECONDITION||n.message!==Ose)throw n;Be("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&gt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new fe((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof fe?t:fe.resolve(t)}catch(t){return fe.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):fe.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):fe.reject(t)}static resolve(e){return new fe((t,r)=>{t(e)})}static reject(e){return new fe((t,r)=>{r(e)})}static waitFor(e){return new fe((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=fe.resolve(!1);for(const r of e)t=t.next(s=>s?fe.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new fe((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(u=>{o[c]=u,++a,a===i&&r(o)},u=>s(u))}})}static doWhile(e,t){return new fe((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function zse(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function X1(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}C3.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w7=-1;function N3(n){return n==null}function o_(n){return n===0&&1/n==-1/0}function Bse(n){return typeof n=="number"&&Number.isInteger(n)&&!o_(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VV="";function $se(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=IP(e)),e=Vse(n.get(t),e);return IP(e)}function Vse(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case VV:t+="";break;default:t+=i}}return t}function IP(n){return n+VV+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RP(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function bf(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function UV(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e,t){this.comparator=e,this.root=t||Ws.EMPTY}insert(e,t){return new kr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ws.BLACK,null,null))}remove(e){return new kr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ws.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new j2(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new j2(this.root,e,this.comparator,!1)}getReverseIterator(){return new j2(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new j2(this.root,e,this.comparator,!0)}}class j2{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ws{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Ws.RED,this.left=s??Ws.EMPTY,this.right=i??Ws.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Ws(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ws.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ws.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ws.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ws.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw gt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw gt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw gt(27949);return e+(this.isRed()?0:1)}}Ws.EMPTY=null,Ws.RED=!0,Ws.BLACK=!1;Ws.EMPTY=new class{constructor(){this.size=0}get key(){throw gt(57766)}get value(){throw gt(16141)}get color(){throw gt(16727)}get left(){throw gt(29726)}get right(){throw gt(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Ws(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e){this.comparator=e,this.data=new kr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new MP(this.data.getIterator())}getIteratorFrom(e){return new MP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ys)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ys(this.comparator);return t.data=e,t}}class MP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this.fields=e,e.sort(Js.comparator)}static empty(){return new oa([])}unionWith(e){let t=new ys(Js.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new oa(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _1(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HV extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new HV("Invalid base64 string: "+i):i}}(e);return new ti(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new ti(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ti.EMPTY_BYTE_STRING=new ti("");const Use=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tf(n){if(_n(!!n,39018),typeof n=="string"){let e=0;const t=Use.exec(n);if(_n(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$r(n.seconds),nanos:$r(n.nanos)}}function $r(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function nf(n){return typeof n=="string"?ti.fromBase64String(n):ti.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qV="server_timestamp",GV="__type__",WV="__previous_value__",KV="__local_write_time__";function k7(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[GV])==null?void 0:r.stringValue)===qV}function I3(n){const e=n.mapValue.fields[WV];return k7(e)?I3(e):e}function yb(n){const e=tf(n.mapValue.fields[KV].timestampValue);return new Gn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hse{constructor(e,t,r,s,i,o,a,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}}const a_="(default)";class xb{constructor(e,t){this.projectId=e,this.database=t||a_}static empty(){return new xb("","")}get isDefaultDatabase(){return this.database===a_}isEqual(e){return e instanceof xb&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV="__type__",qse="__max__",O2={mapValue:{}},XV="__vector__",l_="value";function rf(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?k7(n)?4:Wse(n)?9007199254740991:Gse(n)?10:11:gt(28295,{value:n})}function Oc(n,e){if(n===e)return!0;const t=rf(n);if(t!==rf(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yb(n).isEqual(yb(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=tf(s.timestampValue),a=tf(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return nf(s.bytesValue).isEqual(nf(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return $r(s.geoPointValue.latitude)===$r(i.geoPointValue.latitude)&&$r(s.geoPointValue.longitude)===$r(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return $r(s.integerValue)===$r(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=$r(s.doubleValue),a=$r(i.doubleValue);return o===a?o_(o)===o_(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return _1(n.arrayValue.values||[],e.arrayValue.values||[],Oc);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(RP(o)!==RP(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Oc(o[l],a[l])))return!1;return!0}(n,e);default:return gt(52216,{left:n})}}function bb(n,e){return(n.values||[]).find(t=>Oc(t,e))!==void 0}function S1(n,e){if(n===e)return 0;const t=rf(n),r=rf(e);if(t!==r)return Zt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Zt(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=$r(i.integerValue||i.doubleValue),l=$r(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return PP(n.timestampValue,e.timestampValue);case 4:return PP(yb(n),yb(e));case 5:return g6(n.stringValue,e.stringValue);case 6:return function(i,o){const a=nf(i),l=nf(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=Zt(a[c],l[c]);if(u!==0)return u}return Zt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Zt($r(i.latitude),$r(o.latitude));return a!==0?a:Zt($r(i.longitude),$r(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return LP(n.arrayValue,e.arrayValue);case 10:return function(i,o){var f,p,g,y;const a=i.fields||{},l=o.fields||{},c=(f=a[l_])==null?void 0:f.arrayValue,u=(p=l[l_])==null?void 0:p.arrayValue,h=Zt(((g=c==null?void 0:c.values)==null?void 0:g.length)||0,((y=u==null?void 0:u.values)==null?void 0:y.length)||0);return h!==0?h:LP(c,u)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===O2.mapValue&&o===O2.mapValue)return 0;if(i===O2.mapValue)return 1;if(o===O2.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const f=g6(l[h],u[h]);if(f!==0)return f;const p=S1(a[l[h]],c[u[h]]);if(p!==0)return p}return Zt(l.length,u.length)}(n.mapValue,e.mapValue);default:throw gt(23264,{he:t})}}function PP(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Zt(n,e);const t=tf(n),r=tf(e),s=Zt(t.seconds,r.seconds);return s!==0?s:Zt(t.nanos,r.nanos)}function LP(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=S1(t[s],r[s]);if(i)return i}return Zt(t.length,r.length)}function T1(n){return y6(n)}function y6(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=tf(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return nf(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return et.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=y6(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${y6(t.fields[o])}`;return s+"}"}(n.mapValue):gt(61005,{value:n})}function j4(n){switch(rf(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=I3(n);return e?16+j4(e):16;case 5:return 2*n.stringValue.length;case 6:return nf(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+j4(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return bf(r.fields,(i,o)=>{s+=i.length+j4(o)}),s}(n.mapValue);default:throw gt(13486,{value:n})}}function DP(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function x6(n){return!!n&&"integerValue"in n}function _7(n){return!!n&&"arrayValue"in n}function jP(n){return!!n&&"nullValue"in n}function OP(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function O4(n){return!!n&&"mapValue"in n}function Gse(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[YV])==null?void 0:r.stringValue)===XV}function Tx(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return bf(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Tx(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Tx(n.arrayValue.values[t]);return e}return{...n}}function Wse(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qse}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e){this.value=e}static empty(){return new Ao({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!O4(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tx(t)}setAll(e){let t=Js.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Tx(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());O4(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Oc(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];O4(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){bf(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ao(Tx(this.value))}}function JV(n){const e=[];return bf(n.fields,(t,r)=>{const s=new Js([t]);if(O4(r)){const i=JV(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new oa(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new vi(e,0,Tt.min(),Tt.min(),Tt.min(),Ao.empty(),0)}static newFoundDocument(e,t,r,s){return new vi(e,1,t,Tt.min(),r,s,0)}static newNoDocument(e,t){return new vi(e,2,t,Tt.min(),Tt.min(),Ao.empty(),0)}static newUnknownDocument(e,t){return new vi(e,3,t,Tt.min(),Tt.min(),Ao.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ao.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ao.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof vi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new vi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e,t){this.position=e,this.inclusive=t}}function FP(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=et.comparator(et.fromName(o.referenceValue),t.key):r=S1(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function zP(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Oc(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(e,t="asc"){this.field=e,this.dir=t}}function Kse(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{}class Yr extends QV{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Xse(e,t,r):t==="array-contains"?new Zse(e,r):t==="in"?new eie(e,r):t==="not-in"?new tie(e,r):t==="array-contains-any"?new nie(e,r):new Yr(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Jse(e,r):new Qse(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(S1(t,this.value)):t!==null&&rf(this.value)===rf(t)&&this.matchesComparison(S1(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return gt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zl extends QV{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new zl(e,t)}matches(e){return ZV(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ZV(n){return n.op==="and"}function eU(n){return Yse(n)&&ZV(n)}function Yse(n){for(const e of n.filters)if(e instanceof zl)return!1;return!0}function b6(n){if(n instanceof Yr)return n.field.canonicalString()+n.op.toString()+T1(n.value);if(eU(n))return n.filters.map(e=>b6(e)).join(",");{const e=n.filters.map(t=>b6(t)).join(",");return`${n.op}(${e})`}}function tU(n,e){return n instanceof Yr?function(r,s){return s instanceof Yr&&r.op===s.op&&r.field.isEqual(s.field)&&Oc(r.value,s.value)}(n,e):n instanceof zl?function(r,s){return s instanceof zl&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&tU(o,s.filters[a]),!0):!1}(n,e):void gt(19439)}function nU(n){return n instanceof Yr?function(t){return`${t.field.canonicalString()} ${t.op} ${T1(t.value)}`}(n):n instanceof zl?function(t){return t.op.toString()+" {"+t.getFilters().map(nU).join(" ,")+"}"}(n):"Filter"}class Xse extends Yr{constructor(e,t,r){super(e,t,r),this.key=et.fromName(r.referenceValue)}matches(e){const t=et.comparator(e.key,this.key);return this.matchesComparison(t)}}class Jse extends Yr{constructor(e,t){super(e,"in",t),this.keys=rU("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Qse extends Yr{constructor(e,t){super(e,"not-in",t),this.keys=rU("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function rU(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>et.fromName(r.referenceValue))}class Zse extends Yr{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return _7(t)&&bb(t.arrayValue,this.value)}}class eie extends Yr{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&bb(this.value.arrayValue,t)}}class tie extends Yr{constructor(e,t){super(e,"not-in",t)}matches(e){if(bb(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!bb(this.value.arrayValue,t)}}class nie extends Yr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!_7(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>bb(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rie{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function BP(n,e=null,t=[],r=[],s=null,i=null,o=null){return new rie(n,e,t,r,s,i,o)}function S7(n){const e=Et(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>b6(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),N3(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>T1(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>T1(r)).join(",")),e.Te=t}return e.Te}function T7(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Kse(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!tU(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!zP(n.startAt,e.startAt)&&zP(n.endAt,e.endAt)}function v6(n){return et.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function sie(n,e,t,r,s,i,o,a){return new J1(n,e,t,r,s,i,o,a)}function R3(n){return new J1(n)}function $P(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function sU(n){return n.collectionGroup!==null}function Ax(n){const e=Et(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ys(Js.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new vb(i,r))}),t.has(Js.keyField().canonicalString())||e.Ie.push(new vb(Js.keyField(),r))}return e.Ie}function Nc(n){const e=Et(n);return e.Ee||(e.Ee=iie(e,Ax(n))),e.Ee}function iie(n,e){if(n.limitType==="F")return BP(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vb(s.field,i)});const t=n.endAt?new c_(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new c_(n.startAt.position,n.startAt.inclusive):null;return BP(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function w6(n,e){const t=n.filters.concat([e]);return new J1(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function u_(n,e,t){return new J1(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function M3(n,e){return T7(Nc(n),Nc(e))&&n.limitType===e.limitType}function iU(n){return`${S7(Nc(n))}|lt:${n.limitType}`}function pm(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>nU(s)).join(", ")}]`),N3(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>T1(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>T1(s)).join(",")),`Target(${r})`}(Nc(n))}; limitType=${n.limitType})`}function P3(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):et.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Ax(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=FP(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Ax(r),s)||r.endAt&&!function(o,a,l){const c=FP(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Ax(r),s))}(n,e)}function oie(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function oU(n){return(e,t)=>{let r=!1;for(const s of Ax(n)){const i=aie(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function aie(n,e,t){const r=n.field.isKeyField()?et.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?S1(l,c):gt(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return gt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){bf(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return UV(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lie=new kr(et.comparator);function nd(){return lie}const aU=new kr(et.comparator);function Vy(...n){let e=aU;for(const t of n)e=e.insert(t.key,t);return e}function lU(n){let e=aU;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Jf(){return Ex()}function cU(){return Ex()}function Ex(){return new W0(n=>n.toString(),(n,e)=>n.isEqual(e))}const cie=new kr(et.comparator),uie=new ys(et.comparator);function en(...n){let e=uie;for(const t of n)e=e.add(t);return e}const die=new ys(Zt);function hie(){return die}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A7(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:o_(e)?"-0":e}}function uU(n){return{integerValue:""+n}}function dU(n,e){return Bse(e)?uU(e):A7(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L3{constructor(){this._=void 0}}function fie(n,e,t){return n instanceof wb?function(s,i){const o={fields:{[GV]:{stringValue:qV},[KV]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&k7(i)&&(i=I3(i)),i&&(o.fields[WV]=i),{mapValue:o}}(t,e):n instanceof kb?fU(n,e):n instanceof _b?pU(n,e):function(s,i){const o=hU(s,i),a=VP(o)+VP(s.Ae);return x6(o)&&x6(s.Ae)?uU(a):A7(s.serializer,a)}(n,e)}function pie(n,e,t){return n instanceof kb?fU(n,e):n instanceof _b?pU(n,e):t}function hU(n,e){return n instanceof Sb?function(r){return x6(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class wb extends L3{}class kb extends L3{constructor(e){super(),this.elements=e}}function fU(n,e){const t=mU(e);for(const r of n.elements)t.some(s=>Oc(s,r))||t.push(r);return{arrayValue:{values:t}}}class _b extends L3{constructor(e){super(),this.elements=e}}function pU(n,e){let t=mU(e);for(const r of n.elements)t=t.filter(s=>!Oc(s,r));return{arrayValue:{values:t}}}class Sb extends L3{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function VP(n){return $r(n.integerValue||n.doubleValue)}function mU(n){return _7(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e,t){this.field=e,this.transform=t}}function mie(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof kb&&s instanceof kb||r instanceof _b&&s instanceof _b?_1(r.elements,s.elements,Oc):r instanceof Sb&&s instanceof Sb?Oc(r.Ae,s.Ae):r instanceof wb&&s instanceof wb}(n.transform,e.transform)}class gie{constructor(e,t){this.version=e,this.transformResults=t}}class Xi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Xi}static exists(e){return new Xi(void 0,e)}static updateTime(e){return new Xi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function F4(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class D3{}function yU(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new j3(n.key,Xi.none()):new Cw(n.key,n.data,Xi.none());{const t=n.data,r=Ao.empty();let s=new ys(Js.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new vf(n.key,r,new oa(s.toArray()),Xi.none())}}function yie(n,e,t){n instanceof Cw?function(s,i,o){const a=s.value.clone(),l=HP(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof vf?function(s,i,o){if(!F4(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=HP(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(xU(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Cx(n,e,t,r){return n instanceof Cw?function(i,o,a,l){if(!F4(i.precondition,o))return a;const c=i.value.clone(),u=qP(i.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof vf?function(i,o,a,l){if(!F4(i.precondition,o))return a;const c=qP(i.fieldTransforms,l,o),u=o.data;return u.setAll(xU(i)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(i,o,a){return F4(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function xie(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=hU(r.transform,s||null);i!=null&&(t===null&&(t=Ao.empty()),t.set(r.field,i))}return t||null}function UP(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&_1(r,s,(i,o)=>mie(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Cw extends D3{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class vf extends D3{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function xU(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function HP(n,e,t){const r=new Map;_n(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,pie(o,a,t[s]))}return r}function qP(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,fie(i,o,e))}return r}class j3 extends D3{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bie extends D3{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vie{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&yie(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Cx(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Cx(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=cU();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=yU(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Tt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),en())}isEqual(e){return this.batchId===e.batchId&&_1(this.mutations,e.mutations,(t,r)=>UP(t,r))&&_1(this.baseMutations,e.baseMutations,(t,r)=>UP(t,r))}}class E7{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){_n(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return cie}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new E7(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wie{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kie{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gr,ln;function _ie(n){switch(n){case ue.OK:return gt(64938);case ue.CANCELLED:case ue.UNKNOWN:case ue.DEADLINE_EXCEEDED:case ue.RESOURCE_EXHAUSTED:case ue.INTERNAL:case ue.UNAVAILABLE:case ue.UNAUTHENTICATED:return!1;case ue.INVALID_ARGUMENT:case ue.NOT_FOUND:case ue.ALREADY_EXISTS:case ue.PERMISSION_DENIED:case ue.FAILED_PRECONDITION:case ue.ABORTED:case ue.OUT_OF_RANGE:case ue.UNIMPLEMENTED:case ue.DATA_LOSS:return!0;default:return gt(15467,{code:n})}}function bU(n){if(n===void 0)return td("GRPC error has no .code"),ue.UNKNOWN;switch(n){case Gr.OK:return ue.OK;case Gr.CANCELLED:return ue.CANCELLED;case Gr.UNKNOWN:return ue.UNKNOWN;case Gr.DEADLINE_EXCEEDED:return ue.DEADLINE_EXCEEDED;case Gr.RESOURCE_EXHAUSTED:return ue.RESOURCE_EXHAUSTED;case Gr.INTERNAL:return ue.INTERNAL;case Gr.UNAVAILABLE:return ue.UNAVAILABLE;case Gr.UNAUTHENTICATED:return ue.UNAUTHENTICATED;case Gr.INVALID_ARGUMENT:return ue.INVALID_ARGUMENT;case Gr.NOT_FOUND:return ue.NOT_FOUND;case Gr.ALREADY_EXISTS:return ue.ALREADY_EXISTS;case Gr.PERMISSION_DENIED:return ue.PERMISSION_DENIED;case Gr.FAILED_PRECONDITION:return ue.FAILED_PRECONDITION;case Gr.ABORTED:return ue.ABORTED;case Gr.OUT_OF_RANGE:return ue.OUT_OF_RANGE;case Gr.UNIMPLEMENTED:return ue.UNIMPLEMENTED;case Gr.DATA_LOSS:return ue.DATA_LOSS;default:return gt(39323,{code:n})}}(ln=Gr||(Gr={}))[ln.OK=0]="OK",ln[ln.CANCELLED=1]="CANCELLED",ln[ln.UNKNOWN=2]="UNKNOWN",ln[ln.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ln[ln.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ln[ln.NOT_FOUND=5]="NOT_FOUND",ln[ln.ALREADY_EXISTS=6]="ALREADY_EXISTS",ln[ln.PERMISSION_DENIED=7]="PERMISSION_DENIED",ln[ln.UNAUTHENTICATED=16]="UNAUTHENTICATED",ln[ln.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ln[ln.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ln[ln.ABORTED=10]="ABORTED",ln[ln.OUT_OF_RANGE=11]="OUT_OF_RANGE",ln[ln.UNIMPLEMENTED=12]="UNIMPLEMENTED",ln[ln.INTERNAL=13]="INTERNAL",ln[ln.UNAVAILABLE=14]="UNAVAILABLE",ln[ln.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sie(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tie=new $h([4294967295,4294967295],0);function GP(n){const e=Sie().encode(n),t=new MV;return t.update(e),new Uint8Array(t.digest())}function WP(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new $h([t,r],0),new $h([s,i],0)]}class C7{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Uy(`Invalid padding: ${t}`);if(r<0)throw new Uy(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Uy(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Uy(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=$h.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply($h.fromNumber(r)));return s.compare(Tie)===1&&(s=new $h([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=GP(e),[r,s]=WP(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new C7(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=GP(e),[r,s]=WP(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Uy extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O3{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Nw.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new O3(Tt.min(),s,new kr(Zt),nd(),en())}}class Nw{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Nw(r,t,en(),en(),en())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class vU{constructor(e,t){this.targetId=e,this.Ce=t}}class wU{constructor(e,t,r=ti.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class KP{constructor(){this.ve=0,this.Fe=YP(),this.Me=ti.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=en(),t=en(),r=en();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:gt(38017,{changeType:i})}}),new Nw(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=YP()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,_n(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Aie{constructor(e){this.Ge=e,this.ze=new Map,this.je=nd(),this.Je=F2(),this.He=F2(),this.Ye=new kr(Zt)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:gt(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(v6(i))if(r===0){const o=new et(i.path);this.et(t,o,vi.newNoDocument(o,Tt.min()))}else _n(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=nf(r).toUint8Array()}catch(l){if(l instanceof HV)return k1("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new C7(o,s,i)}catch(l){return k1(l instanceof Uy?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&v6(a.target)){const l=new et(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,vi.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=en();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new O3(e,t,this.Ye,this.je,r);return this.je=nd(),this.Je=F2(),this.He=F2(),this.Ye=new kr(Zt),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new KP,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ys(Zt),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ys(Zt),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Be("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new KP),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function F2(){return new kr(et.comparator)}function YP(){return new kr(et.comparator)}const Eie={asc:"ASCENDING",desc:"DESCENDING"},Cie={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Nie={and:"AND",or:"OR"};class Iie{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function k6(n,e){return n.useProto3Json||N3(e)?e:{value:e}}function d_(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function kU(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Rie(n,e){return d_(n,e.toTimestamp())}function Ic(n){return _n(!!n,49232),Tt.fromTimestamp(function(t){const r=tf(t);return new Gn(r.seconds,r.nanos)}(n))}function N7(n,e){return _6(n,e).canonicalString()}function _6(n,e){const t=function(s){return new qn(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function _U(n){const e=qn.fromString(n);return _n(CU(e),10190,{key:e.toString()}),e}function S6(n,e){return N7(n.databaseId,e.path)}function TT(n,e){const t=_U(e);if(t.get(1)!==n.databaseId.projectId)throw new Re(ue.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Re(ue.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new et(TU(t))}function SU(n,e){return N7(n.databaseId,e)}function Mie(n){const e=_U(n);return e.length===4?qn.emptyPath():TU(e)}function T6(n){return new qn(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function TU(n){return _n(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function XP(n,e,t){return{name:S6(n,e),fields:t.value.mapValue.fields}}function Pie(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:gt(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,u){return c.useProto3Json?(_n(u===void 0||typeof u=="string",58123),ti.fromBase64String(u||"")):(_n(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),ti.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?ue.UNKNOWN:bU(c.code);return new Re(u,c.message||"")}(o);t=new wU(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=TT(n,r.document.name),i=Ic(r.document.updateTime),o=r.document.createTime?Ic(r.document.createTime):Tt.min(),a=new Ao({mapValue:{fields:r.document.fields}}),l=vi.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new z4(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=TT(n,r.document),i=r.readTime?Ic(r.readTime):Tt.min(),o=vi.newNoDocument(s,i),a=r.removedTargetIds||[];t=new z4([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=TT(n,r.document),i=r.removedTargetIds||[];t=new z4([],i,s,null)}else{if(!("filter"in e))return gt(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new kie(s,i),a=r.targetId;t=new vU(a,o)}}return t}function Lie(n,e){let t;if(e instanceof Cw)t={update:XP(n,e.key,e.value)};else if(e instanceof j3)t={delete:S6(n,e.key)};else if(e instanceof vf)t={update:XP(n,e.key,e.data),updateMask:Uie(e.fieldMask)};else{if(!(e instanceof bie))return gt(16599,{Vt:e.type});t={verify:S6(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof wb)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof kb)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof _b)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Sb)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw gt(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Rie(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:gt(27497)}(n,e.precondition)),t}function Die(n,e){return n&&n.length>0?(_n(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Ic(s.updateTime):Ic(i);return o.isEqual(Tt.min())&&(o=Ic(i)),new gie(o,s.transformResults||[])}(t,e))):[]}function jie(n,e){return{documents:[SU(n,e.path)]}}function Oie(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=SU(n,s);const i=function(c){if(c.length!==0)return EU(zl.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(u=>function(f){return{field:mm(f.field),direction:Bie(f.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=k6(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:t,parent:s}}function Fie(n){let e=Mie(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){_n(r===1,65062);const u=t.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let i=[];t.where&&(i=function(h){const f=AU(h);return f instanceof zl&&eU(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(f=>function(g){return new vb(gm(g.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,N3(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,p=h.values||[];return new c_(p,f)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const f=!h.before,p=h.values||[];return new c_(p,f)}(t.endAt)),sie(e,s,o,i,a,"F",l,c)}function zie(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return gt(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function AU(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=gm(t.unaryFilter.field);return Yr.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=gm(t.unaryFilter.field);return Yr.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=gm(t.unaryFilter.field);return Yr.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=gm(t.unaryFilter.field);return Yr.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return gt(61313);default:return gt(60726)}}(n):n.fieldFilter!==void 0?function(t){return Yr.create(gm(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return gt(58110);default:return gt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return zl.create(t.compositeFilter.filters.map(r=>AU(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return gt(1026)}}(t.compositeFilter.op))}(n):gt(30097,{filter:n})}function Bie(n){return Eie[n]}function $ie(n){return Cie[n]}function Vie(n){return Nie[n]}function mm(n){return{fieldPath:n.canonicalString()}}function gm(n){return Js.fromServerFormat(n.fieldPath)}function EU(n){return n instanceof Yr?function(t){if(t.op==="=="){if(OP(t.value))return{unaryFilter:{field:mm(t.field),op:"IS_NAN"}};if(jP(t.value))return{unaryFilter:{field:mm(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(OP(t.value))return{unaryFilter:{field:mm(t.field),op:"IS_NOT_NAN"}};if(jP(t.value))return{unaryFilter:{field:mm(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mm(t.field),op:$ie(t.op),value:t.value}}}(n):n instanceof zl?function(t){const r=t.getFilters().map(s=>EU(s));return r.length===1?r[0]:{compositeFilter:{op:Vie(t.op),filters:r}}}(n):gt(54877,{filter:n})}function Uie(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function CU(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t,r,s,i=Tt.min(),o=Tt.min(),a=ti.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ah(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hie{constructor(e){this.yt=e}}function qie(n){const e=Fie({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?u_(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gie{constructor(){this.Cn=new Wie}addToCollectionParentIndex(e,t){return this.Cn.add(t),fe.resolve()}getCollectionParents(e,t){return fe.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return fe.resolve()}deleteFieldIndex(e,t){return fe.resolve()}deleteAllFieldIndexes(e){return fe.resolve()}createTargetIndexes(e,t){return fe.resolve()}getDocumentsMatchingTarget(e,t){return fe.resolve(null)}getIndexType(e,t){return fe.resolve(0)}getFieldIndexes(e,t){return fe.resolve([])}getNextCollectionGroupToUpdate(e){return fe.resolve(null)}getMinOffset(e,t){return fe.resolve(ef.min())}getMinOffsetFromCollectionGroup(e,t){return fe.resolve(ef.min())}updateCollectionGroup(e,t,r){return fe.resolve()}updateIndexEntries(e,t){return fe.resolve()}}class Wie{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ys(qn.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ys(qn.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},NU=41943040;class wo{static withCacheSize(e){return new wo(e,wo.DEFAULT_COLLECTION_PERCENTILE,wo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */wo.DEFAULT_COLLECTION_PERCENTILE=10,wo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wo.DEFAULT=new wo(NU,wo.DEFAULT_COLLECTION_PERCENTILE,wo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wo.DISABLED=new wo(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new A1(0)}static cr(){return new A1(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP="LruGarbageCollector",Kie=1048576;function ZP([n,e],[t,r]){const s=Zt(n,t);return s===0?Zt(e,r):s}class Yie{constructor(e){this.Ir=e,this.buffer=new ys(ZP),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();ZP(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Xie{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Be(QP,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){X1(t)?Be(QP,"Ignoring IndexedDB error during garbage collection: ",t):await Y1(t)}await this.Vr(3e5)})}}class Jie{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return fe.resolve(C3.ce);const r=new Yie(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Be("LruGarbageCollector","Garbage collection skipped; disabled"),fe.resolve(JP)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Be("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),JP):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(Be("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),fm()<=Qt.DEBUG&&Be("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),fe.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function Qie(n,e){return new Jie(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zie{constructor(){this.changes=new W0(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,vi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?fe.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eoe{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class toe{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Cx(r.mutation,s,oa.empty(),Gn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,en()).next(()=>r))}getLocalViewOfDocuments(e,t,r=en()){const s=Jf();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Vy();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Jf();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,en()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=nd();const o=Ex(),a=function(){return Ex()}();return t.forEach((l,c)=>{const u=r.get(c.key);s.has(c.key)&&(u===void 0||u.mutation instanceof vf)?i=i.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Cx(u.mutation,c,u.mutation.getFieldMask(),Gn.now())):o.set(c.key,oa.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>a.set(c,new eoe(u,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Ex();let s=new kr((o,a)=>o-a),i=en();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let u=r.get(l)||oa.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(s.get(a.batchId)||en()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=cU();u.forEach(f=>{if(!i.has(f)){const p=yU(t.get(f),r.get(f));p!==null&&h.set(f,p),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return fe.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return et.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sU(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):fe.resolve(Jf());let a=gb,l=i;return o.next(c=>fe.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(u)?fe.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,en())).next(u=>({batchId:a,changes:lU(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new et(t)).next(r=>{let s=Vy();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Vy();return this.indexManager.getCollectionParents(e,i).next(a=>fe.forEach(a,l=>{const c=function(h,f){return new J1(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(u=>{u.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,vi.newInvalidDocument(u)))});let a=Vy();return o.forEach((l,c)=>{const u=i.get(l);u!==void 0&&Cx(u.mutation,c,oa.empty(),Gn.now()),P3(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class noe{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return fe.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ic(s.createTime)}}(t)),fe.resolve()}getNamedQuery(e,t){return fe.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:qie(s.bundledQuery),readTime:Ic(s.readTime)}}(t)),fe.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class roe{constructor(){this.overlays=new kr(et.comparator),this.qr=new Map}getOverlay(e,t){return fe.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Jf();return fe.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),fe.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),fe.resolve()}getOverlaysForCollection(e,t,r){const s=Jf(),i=t.length+1,o=new et(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return fe.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new kr((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let u=i.get(c.largestBatchId);u===null&&(u=Jf(),i=i.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Jf(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=s)););return fe.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new wie(t,r));let i=this.qr.get(t);i===void 0&&(i=en(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class soe{constructor(){this.sessionToken=ti.EMPTY_BYTE_STRING}getSessionToken(e){return fe.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,fe.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I7{constructor(){this.Qr=new ys(Ns.$r),this.Ur=new ys(Ns.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Ns(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Ns(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new et(new qn([])),r=new Ns(t,e),s=new Ns(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new et(new qn([])),r=new Ns(t,e),s=new Ns(t,e+1);let i=en();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Ns(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ns{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return et.comparator(e.key,t.key)||Zt(e.Yr,t.Yr)}static Kr(e,t){return Zt(e.Yr,t.Yr)||et.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ioe{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ys(Ns.$r)}checkEmpty(e){return fe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new vie(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Ns(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return fe.resolve(o)}lookupMutationBatch(e,t){return fe.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return fe.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return fe.resolve(this.mutationQueue.length===0?w7:this.tr-1)}getAllMutationBatches(e){return fe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ns(t,0),s=new Ns(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),fe.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ys(Zt);return t.forEach(s=>{const i=new Ns(s,0),o=new Ns(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),fe.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;et.isDocumentKey(i)||(i=i.child(""));const o=new Ns(new et(i),0);let a=new ys(Zt);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.Yr)),!0)},o),fe.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){_n(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return fe.forEach(t.mutations,s=>{const i=new Ns(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Ns(t,0),s=this.Zr.firstAfterOrEqual(r);return fe.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,fe.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ooe{constructor(e){this.ri=e,this.docs=function(){return new kr(et.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return fe.resolve(r?r.document.mutableCopy():vi.newInvalidDocument(t))}getEntries(e,t){let r=nd();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():vi.newInvalidDocument(s))}),fe.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=nd();const o=t.path,a=new et(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||jse(Dse(u),r)<=0||(s.has(u.key)||P3(t,u))&&(i=i.insert(u.key,u.mutableCopy()))}return fe.resolve(i)}getAllFromCollectionGroup(e,t,r,s){gt(9500)}ii(e,t){return fe.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new aoe(this)}getSize(e){return fe.resolve(this.size)}}class aoe extends Zie{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),fe.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class loe{constructor(e){this.persistence=e,this.si=new W0(t=>S7(t),T7),this.lastRemoteSnapshotVersion=Tt.min(),this.highestTargetId=0,this.oi=0,this._i=new I7,this.targetCount=0,this.ai=A1.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),fe.resolve()}getLastRemoteSnapshotVersion(e){return fe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return fe.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),fe.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),fe.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new A1(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,fe.resolve()}updateTargetData(e,t){return this.Pr(t),fe.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,fe.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),fe.waitFor(i).next(()=>s)}getTargetCount(e){return fe.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return fe.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),fe.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),fe.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),fe.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return fe.resolve(r)}containsKey(e,t){return fe.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(e,t){this.ui={},this.overlays={},this.ci=new C3(0),this.li=!1,this.li=!0,this.hi=new soe,this.referenceDelegate=e(this),this.Pi=new loe(this),this.indexManager=new Gie,this.remoteDocumentCache=function(s){return new ooe(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new Hie(t),this.Ii=new noe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new roe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new ioe(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Be("MemoryPersistence","Starting transaction:",e);const s=new coe(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return fe.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class coe extends Fse{constructor(e){super(),this.currentSequenceNumber=e}}class R7{constructor(e){this.persistence=e,this.Ri=new I7,this.Vi=null}static mi(e){return new R7(e)}get fi(){if(this.Vi)return this.Vi;throw gt(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),fe.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),fe.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),fe.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return fe.forEach(this.fi,r=>{const s=et.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,Tt.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return fe.or([()=>fe.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class h_{constructor(e,t){this.persistence=e,this.pi=new W0(r=>$se(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Qie(this,t)}static mi(e,t){return new h_(e,t)}Ei(){}di(e){return fe.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return fe.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?fe.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Tt.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),fe.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),fe.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),fe.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),fe.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=j4(e.data.value)),t}br(e,t,r){return fe.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return fe.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M7{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=en(),s=en();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new M7(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uoe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class doe{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return ere()?8:zse(Ai())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new uoe;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(fm()<=Qt.DEBUG&&Be("QueryEngine","SDK will not create cache indexes for query:",pm(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),fe.resolve()):(fm()<=Qt.DEBUG&&Be("QueryEngine","Query:",pm(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(fm()<=Qt.DEBUG&&Be("QueryEngine","The SDK decides to create cache indexes for query:",pm(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Nc(t))):fe.resolve())}ys(e,t){if($P(t))return fe.resolve(null);let r=Nc(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=u_(t,null,"F"),r=Nc(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=en(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Ds(t,a);return this.Cs(t,c,o,l.readTime)?this.ys(e,u_(t,null,"F")):this.vs(e,c,t,l)}))})))}ws(e,t,r,s){return $P(t)||s.isEqual(Tt.min())?fe.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?fe.resolve(null):(fm()<=Qt.DEBUG&&Be("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),pm(t)),this.vs(e,o,t,Lse(s,gb)).next(a=>a))})}Ds(e,t){let r=new ys(oU(e));return t.forEach((s,i)=>{P3(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return fm()<=Qt.DEBUG&&Be("QueryEngine","Using full collection scan to execute query:",pm(t)),this.ps.getDocumentsMatchingQuery(e,t,ef.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P7="LocalStore",hoe=3e8;class foe{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new kr(Zt),this.xs=new W0(i=>S7(i),T7),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new toe(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function poe(n,e,t,r){return new foe(n,e,t,r)}async function RU(n,e){const t=Et(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=en();for(const c of s){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of i){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return t.localDocuments.getDocuments(r,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function moe(n,e){const t=Et(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,f=h.keys();let p=fe.resolve();return f.forEach(g=>{p=p.next(()=>u.getEntry(l,g)).next(y=>{const v=c.docVersions.get(g);_n(v!==null,48541),y.version.compareTo(v)<0&&(h.applyToRemoteDocument(y,c),y.isValidDocument()&&(y.setReadTime(c.commitVersion),u.addEntry(y)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=en();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function MU(n){const e=Et(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function goe(n,e){const t=Et(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((u,h)=>{const f=s.get(h);if(!f)return;a.push(t.Pi.removeMatchingKeys(i,u.removedDocuments,h).next(()=>t.Pi.addMatchingKeys(i,u.addedDocuments,h)));let p=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?p=p.withResumeToken(ti.EMPTY_BYTE_STRING,Tt.min()).withLastLimboFreeSnapshotVersion(Tt.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),s=s.insert(h,p),function(y,v,b){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=hoe?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(f,p,u)&&a.push(t.Pi.updateTargetData(i,p))});let l=nd(),c=en();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(yoe(i,o,e.documentUpdates).next(u=>{l=u.ks,c=u.qs})),!r.isEqual(Tt.min())){const u=t.Pi.getLastRemoteSnapshotVersion(i).next(h=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return fe.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.Ms=s,i))}function yoe(n,e,t){let r=en(),s=en();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=nd();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Tt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Be(P7,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:s}})}function xoe(n,e){const t=Et(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=w7),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function boe(n,e){const t=Et(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,fe.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new Ah(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function A6(n,e,t){const r=Et(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!X1(o))throw o;Be(P7,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function eL(n,e,t){const r=Et(n);let s=Tt.min(),i=en();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=Et(l),f=h.xs.get(u);return f!==void 0?fe.resolve(h.Ms.get(f)):h.Pi.getTargetData(c,u)}(r,o,Nc(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:Tt.min(),t?i:en())).next(a=>(voe(r,oie(e),a),{documents:a,Qs:i})))}function voe(n,e,t){let r=n.Os.get(e)||Tt.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}class tL{constructor(){this.activeTargetIds=hie()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class woe{constructor(){this.Mo=new tL,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new tL,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class koe{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nL="ConnectivityMonitor";class rL{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Be(nL,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Be(nL,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let z2=null;function E6(){return z2===null?z2=function(){return 268435456+Math.round(2147483648*Math.random())}():z2++,"0x"+z2.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="RestConnection",_oe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Soe{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===a_?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=E6(),a=this.zo(e,t.toUriEncodedString());Be(AT,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:c}=new URL(a),u=Uc(c);return this.Jo(e,a,l,r,u).then(h=>(Be(AT,`Received RPC '${e}' ${o}: `,h),h),h=>{throw k1(AT,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",r),h})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+K1}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=_oe[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Toe{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const li="WebChannelConnection";class Aoe extends Soe{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=E6();return new Promise((a,l)=>{const c=new PV;c.setWithCredentials(!0),c.listenOnce(LV.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case D4.NO_ERROR:const h=c.getResponseJson();Be(li,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case D4.TIMEOUT:Be(li,`RPC '${e}' ${o} timed out`),l(new Re(ue.DEADLINE_EXCEEDED,"Request time out"));break;case D4.HTTP_ERROR:const f=c.getStatus();if(Be(li,`RPC '${e}' ${o} failed with status:`,f,"response text:",c.getResponseText()),f>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const g=p==null?void 0:p.error;if(g&&g.status&&g.message){const y=function(b){const w=b.toLowerCase().replace(/_/g,"-");return Object.values(ue).indexOf(w)>=0?w:ue.UNKNOWN}(g.status);l(new Re(y,g.message))}else l(new Re(ue.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new Re(ue.UNAVAILABLE,"Connection failed."));break;default:gt(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{Be(li,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(s);Be(li,`RPC '${e}' ${o} sending request:`,s),c.send(t,"POST",u,r,15)})}T_(e,t,r){const s=E6(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=OV(),a=jV(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const u=i.join("");Be(li,`Creating RPC '${e}' stream ${s}: ${u}`,l);const h=o.createWebChannel(u,l);this.I_(h);let f=!1,p=!1;const g=new Toe({Yo:v=>{p?Be(li,`Not sending because RPC '${e}' stream ${s} is closed:`,v):(f||(Be(li,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),Be(li,`RPC '${e}' stream ${s} sending:`,v),h.send(v))},Zo:()=>h.close()}),y=(v,b,w)=>{v.listen(b,k=>{try{w(k)}catch(T){setTimeout(()=>{throw T},0)}})};return y(h,$y.EventType.OPEN,()=>{p||(Be(li,`RPC '${e}' stream ${s} transport opened.`),g.o_())}),y(h,$y.EventType.CLOSE,()=>{p||(p=!0,Be(li,`RPC '${e}' stream ${s} transport closed`),g.a_(),this.E_(h))}),y(h,$y.EventType.ERROR,v=>{p||(p=!0,k1(li,`RPC '${e}' stream ${s} transport errored. Name:`,v.name,"Message:",v.message),g.a_(new Re(ue.UNAVAILABLE,"The operation could not be completed")))}),y(h,$y.EventType.MESSAGE,v=>{var b;if(!p){const w=v.data[0];_n(!!w,16349);const k=w,T=(k==null?void 0:k.error)||((b=k[0])==null?void 0:b.error);if(T){Be(li,`RPC '${e}' stream ${s} received error:`,T);const R=T.status;let M=function(S){const N=Gr[S];if(N!==void 0)return bU(N)}(R),E=T.message;M===void 0&&(M=ue.INTERNAL,E="Unknown error status: "+R+" with message "+T.message),p=!0,g.a_(new Re(M,E)),h.close()}else Be(li,`RPC '${e}' stream ${s} received:`,w),g.u_(w)}}),y(a,DV.STAT_EVENT,v=>{v.stat===m6.PROXY?Be(li,`RPC '${e}' stream ${s} detected buffering proxy`):v.stat===m6.NOPROXY&&Be(li,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{g.__()},0),g}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function ET(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F3(n){return new Iie(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Be("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sL="PersistentStream";class LU{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new PU(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ue.RESOURCE_EXHAUSTED?(td(t.toString()),td("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ue.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new Re(ue.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Be(sL,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Be(sL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Eoe extends LU{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Pie(this.serializer,e),r=function(i){if(!("targetChange"in i))return Tt.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Tt.min():o.readTime?Ic(o.readTime):Tt.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=T6(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=v6(l)?{documents:jie(i,l)}:{query:Oie(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=kU(i,o.resumeToken);const c=k6(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Tt.min())>0){a.readTime=d_(i,o.snapshotVersion.toTimestamp());const c=k6(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=zie(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=T6(this.serializer),t.removeTarget=e,this.q_(t)}}class Coe extends LU{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return _n(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,_n(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){_n(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Die(e.writeResults,e.commitTime),r=Ic(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=T6(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Lie(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Noe{}class Ioe extends Noe{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Re(ue.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,_6(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Re(ue.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,_6(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ue.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Re(ue.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Roe{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(td(t),this.aa=!1):Be("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A0="RemoteStore";class Moe{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{K0(this)&&(Be(A0,"Restarting streams for network reachability change."),await async function(l){const c=Et(l);c.Ea.add(4),await Iw(c),c.Ra.set("Unknown"),c.Ea.delete(4),await z3(c)}(this))})}),this.Ra=new Roe(r,s)}}async function z3(n){if(K0(n))for(const e of n.da)await e(!0)}async function Iw(n){for(const e of n.da)await e(!1)}function DU(n,e){const t=Et(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),O7(t)?j7(t):Q1(t).O_()&&D7(t,e))}function L7(n,e){const t=Et(n),r=Q1(t);t.Ia.delete(e),r.O_()&&jU(t,e),t.Ia.size===0&&(r.O_()?r.L_():K0(t)&&t.Ra.set("Unknown"))}function D7(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Tt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Q1(n).Y_(e)}function jU(n,e){n.Va.Ue(e),Q1(n).Z_(e)}function j7(n){n.Va=new Aie({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Q1(n).start(),n.Ra.ua()}function O7(n){return K0(n)&&!Q1(n).x_()&&n.Ia.size>0}function K0(n){return Et(n).Ea.size===0}function OU(n){n.Va=void 0}async function Poe(n){n.Ra.set("Online")}async function Loe(n){n.Ia.forEach((e,t)=>{D7(n,e)})}async function Doe(n,e){OU(n),O7(n)?(n.Ra.ha(e),j7(n)):n.Ra.set("Unknown")}async function joe(n,e,t){if(n.Ra.set("Online"),e instanceof wU&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){Be(A0,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await f_(n,r)}else if(e instanceof z4?n.Va.Ze(e):e instanceof vU?n.Va.st(e):n.Va.tt(e),!t.isEqual(Tt.min()))try{const r=await MU(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=i.Ia.get(c);u&&i.Ia.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=i.Ia.get(l);if(!u)return;i.Ia.set(l,u.withResumeToken(ti.EMPTY_BYTE_STRING,u.snapshotVersion)),jU(i,l);const h=new Ah(u.target,l,c,u.sequenceNumber);D7(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Be(A0,"Failed to raise snapshot:",r),await f_(n,r)}}async function f_(n,e,t){if(!X1(e))throw e;n.Ea.add(1),await Iw(n),n.Ra.set("Offline"),t||(t=()=>MU(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Be(A0,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await z3(n)})}function FU(n,e){return e().catch(t=>f_(n,t,e))}async function B3(n){const e=Et(n),t=sf(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:w7;for(;Ooe(e);)try{const s=await xoe(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,Foe(e,s)}catch(s){await f_(e,s)}zU(e)&&BU(e)}function Ooe(n){return K0(n)&&n.Ta.length<10}function Foe(n,e){n.Ta.push(e);const t=sf(n);t.O_()&&t.X_&&t.ea(e.mutations)}function zU(n){return K0(n)&&!sf(n).x_()&&n.Ta.length>0}function BU(n){sf(n).start()}async function zoe(n){sf(n).ra()}async function Boe(n){const e=sf(n);for(const t of n.Ta)e.ea(t.mutations)}async function $oe(n,e,t){const r=n.Ta.shift(),s=E7.from(r,e,t);await FU(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await B3(n)}async function Voe(n,e){e&&sf(n).X_&&await async function(r,s){if(function(o){return _ie(o)&&o!==ue.ABORTED}(s.code)){const i=r.Ta.shift();sf(r).B_(),await FU(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await B3(r)}}(n,e),zU(n)&&BU(n)}async function iL(n,e){const t=Et(n);t.asyncQueue.verifyOperationInProgress(),Be(A0,"RemoteStore received new credentials");const r=K0(t);t.Ea.add(3),await Iw(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await z3(t)}async function Uoe(n,e){const t=Et(n);e?(t.Ea.delete(2),await z3(t)):e||(t.Ea.add(2),await Iw(t),t.Ra.set("Unknown"))}function Q1(n){return n.ma||(n.ma=function(t,r,s){const i=Et(t);return i.sa(),new Eoe(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:Poe.bind(null,n),t_:Loe.bind(null,n),r_:Doe.bind(null,n),H_:joe.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),O7(n)?j7(n):n.Ra.set("Unknown")):(await n.ma.stop(),OU(n))})),n.ma}function sf(n){return n.fa||(n.fa=function(t,r,s){const i=Et(t);return i.sa(),new Coe(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:zoe.bind(null,n),r_:Voe.bind(null,n),ta:Boe.bind(null,n),na:$oe.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await B3(n)):(await n.fa.stop(),n.Ta.length>0&&(Be(A0,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Uu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new F7(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Re(ue.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function z7(n,e){if(td("AsyncQueue",`${e}: ${n}`),X1(n))return new Re(ue.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{static emptySet(e){return new Jm(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||et.comparator(t.key,r.key):(t,r)=>et.comparator(t.key,r.key),this.keyedMap=Vy(),this.sortedSet=new kr(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jm)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Jm;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(){this.ga=new kr(et.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):gt(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class E1{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new E1(e,t,Jm.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&M3(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hoe{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class qoe{constructor(){this.queries=aL(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Et(t),i=s.queries;s.queries=aL(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new Re(ue.ABORTED,"Firestore shutting down"))}}function aL(){return new W0(n=>iU(n),M3)}async function B7(n,e){const t=Et(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new Hoe,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=z7(o,`Initialization of query '${pm(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&V7(t)}async function $7(n,e){const t=Et(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Goe(n,e){const t=Et(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&V7(t)}function Woe(n,e,t){const r=Et(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function V7(n){n.Ca.forEach(e=>{e.next()})}var C6,lL;(lL=C6||(C6={})).Ma="default",lL.Cache="cache";class U7{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new E1(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=E1.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==C6.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(e){this.key=e}}class VU{constructor(e){this.key=e}}class Koe{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=en(),this.mutatedKeys=en(),this.eu=oU(e),this.tu=new Jm(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new oL,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const f=s.get(u),p=P3(this.query,h)?h:null,g=!!f&&this.mutatedKeys.has(f.key),y=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let v=!1;f&&p?f.data.isEqual(p.data)?g!==y&&(r.track({type:3,doc:p}),v=!0):this.su(f,p)||(r.track({type:2,doc:p}),v=!0,(l&&this.eu(p,l)>0||c&&this.eu(p,c)<0)&&(a=!0)):!f&&p?(r.track({type:0,doc:p}),v=!0):f&&!p&&(r.track({type:1,doc:f}),v=!0,(l||c)&&(a=!0)),v&&(p?(o=o.add(p),i=y?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,h)=>function(p,g){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return gt(20277,{Rt:v})}};return y(p)-y(g)}(u.type,h.type)||this.eu(u.doc,h.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new E1(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new oL,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=en(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new VU(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new $U(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=en();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return E1.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const H7="SyncEngine";class Yoe{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Xoe{constructor(e){this.key=e,this.hu=!1}}class Joe{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new W0(a=>iU(a),M3),this.Iu=new Map,this.Eu=new Set,this.du=new kr(et.comparator),this.Au=new Map,this.Ru=new I7,this.Vu={},this.mu=new Map,this.fu=A1.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Qoe(n,e,t=!0){const r=KU(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await UU(r,e,t,!0),s}async function Zoe(n,e){const t=KU(n);await UU(t,e,!0,!1)}async function UU(n,e,t,r){const s=await boe(n.localStore,Nc(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await eae(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&DU(n.remoteStore,s),a}async function eae(n,e,t,r,s){n.pu=(h,f,p)=>async function(y,v,b,w){let k=v.view.ru(b);k.Cs&&(k=await eL(y.localStore,v.query,!1).then(({documents:E})=>v.view.ru(E,k)));const T=w&&w.targetChanges.get(v.targetId),R=w&&w.targetMismatches.get(v.targetId)!=null,M=v.view.applyChanges(k,y.isPrimaryClient,T,R);return uL(y,v.targetId,M.au),M.snapshot}(n,h,f,p);const i=await eL(n.localStore,e,!0),o=new Koe(e,i.Qs),a=o.ru(i.documents),l=Nw.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);uL(n,t,c.au);const u=new Yoe(e,t,o);return n.Tu.set(e,u),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function tae(n,e,t){const r=Et(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!M3(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await A6(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&L7(r.remoteStore,s.targetId),N6(r,s.targetId)}).catch(Y1)):(N6(r,s.targetId),await A6(r.localStore,s.targetId,!0))}async function nae(n,e){const t=Et(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),L7(t.remoteStore,r.targetId))}async function rae(n,e,t){const r=uae(n);try{const s=await function(o,a){const l=Et(o),c=Gn.now(),u=a.reduce((p,g)=>p.add(g.key),en());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let g=nd(),y=en();return l.Ns.getEntries(p,u).next(v=>{g=v,g.forEach((b,w)=>{w.isValidDocument()||(y=y.add(b))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,g)).next(v=>{h=v;const b=[];for(const w of a){const k=xie(w,h.get(w.key).overlayedDocument);k!=null&&b.push(new vf(w.key,k,JV(k.value.mapValue),Xi.exists(!0)))}return l.mutationQueue.addMutationBatch(p,c,b,a)}).next(v=>{f=v;const b=v.applyToLocalDocumentSet(h,y);return l.documentOverlayCache.saveOverlays(p,v.batchId,b)})}).then(()=>({batchId:f.batchId,changes:lU(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new kr(Zt)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(r,s.batchId,t),await Rw(r,s.changes),await B3(r.remoteStore)}catch(s){const i=z7(s,"Failed to persist write");t.reject(i)}}async function HU(n,e){const t=Et(n);try{const r=await goe(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(_n(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?_n(o.hu,14607):s.removedDocuments.size>0&&(_n(o.hu,42227),o.hu=!1))}),await Rw(t,r,e)}catch(r){await Y1(r)}}function cL(n,e,t){const r=Et(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Et(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const f of h.Sa)f.va(a)&&(c=!0)}),c&&V7(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function sae(n,e,t){const r=Et(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new kr(et.comparator);o=o.insert(i,vi.newNoDocument(i,Tt.min()));const a=en().add(i),l=new O3(Tt.min(),new Map,new kr(Zt),o,a);await HU(r,l),r.du=r.du.remove(i),r.Au.delete(e),q7(r)}else await A6(r.localStore,e,!1).then(()=>N6(r,e,t)).catch(Y1)}async function iae(n,e){const t=Et(n),r=e.batch.batchId;try{const s=await moe(t.localStore,e);GU(t,r,null),qU(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Rw(t,s)}catch(s){await Y1(s)}}async function oae(n,e,t){const r=Et(n);try{const s=await function(o,a){const l=Et(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(_n(h!==null,37113),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(r.localStore,e);GU(r,e,t),qU(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Rw(r,s)}catch(s){await Y1(s)}}function qU(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function GU(n,e,t){const r=Et(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function N6(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||WU(n,r)})}function WU(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(L7(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),q7(n))}function uL(n,e,t){for(const r of t)r instanceof $U?(n.Ru.addReference(r.key,e),aae(n,r)):r instanceof VU?(Be(H7,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||WU(n,r.key)):gt(19791,{wu:r})}function aae(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Be(H7,"New document in limbo: "+t),n.Eu.add(r),q7(n))}function q7(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new et(qn.fromString(e)),r=n.fu.next();n.Au.set(r,new Xoe(t)),n.du=n.du.insert(t,r),DU(n.remoteStore,new Ah(Nc(R3(t.path)),r,"TargetPurposeLimboResolution",C3.ce))}}async function Rw(n,e,t){const r=Et(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){const h=c?!c.fromCache:(u=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){s.push(c);const h=M7.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,c){const u=Et(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>fe.forEach(c,f=>fe.forEach(f.Es,p=>u.persistence.referenceDelegate.addReference(h,f.targetId,p)).next(()=>fe.forEach(f.ds,p=>u.persistence.referenceDelegate.removeReference(h,f.targetId,p)))))}catch(h){if(!X1(h))throw h;Be(P7,"Failed to update sequence numbers: "+h)}for(const h of c){const f=h.targetId;if(!h.fromCache){const p=u.Ms.get(f),g=p.snapshotVersion,y=p.withLastLimboFreeSnapshotVersion(g);u.Ms=u.Ms.insert(f,y)}}}(r.localStore,i))}async function lae(n,e){const t=Et(n);if(!t.currentUser.isEqual(e)){Be(H7,"User change. New user:",e.toKey());const r=await RU(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new Re(ue.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Rw(t,r.Ls)}}function cae(n,e){const t=Et(n),r=t.Au.get(e);if(r&&r.hu)return en().add(r.key);{let s=en();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function KU(n){const e=Et(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=HU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cae.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sae.bind(null,e),e.Pu.H_=Goe.bind(null,e.eventManager),e.Pu.yu=Woe.bind(null,e.eventManager),e}function uae(n){const e=Et(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=iae.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oae.bind(null,e),e}class p_{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=F3(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return poe(this.persistence,new doe,e.initialUser,this.serializer)}Cu(e){return new IU(R7.mi,this.serializer)}Du(e){return new woe}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}p_.provider={build:()=>new p_};class dae extends p_{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){_n(this.persistence.referenceDelegate instanceof h_,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Xie(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?wo.withCacheSize(this.cacheSizeBytes):wo.DEFAULT;return new IU(r=>h_.mi(r,t),this.serializer)}}class I6{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>cL(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=lae.bind(null,this.syncEngine),await Uoe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new qoe}()}createDatastore(e){const t=F3(e.databaseInfo.databaseId),r=function(i){return new Aoe(i)}(e.databaseInfo);return function(i,o,a,l){return new Ioe(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new Moe(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>cL(this.syncEngine,t,0),function(){return rL.v()?new rL:new koe}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,u){const h=new Joe(s,i,o,a,l,c);return u&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Et(s);Be(A0,"RemoteStore shutting down."),i.Ea.add(5),await Iw(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}I6.provider={build:()=>new I6};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G7{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):td("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const of="FirestoreClient";class hae{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=yi.UNAUTHENTICATED,this.clientId=v7.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Be(of,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Be(of,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Uu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=z7(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function CT(n,e){n.asyncQueue.verifyOperationInProgress(),Be(of,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await RU(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function dL(n,e){n.asyncQueue.verifyOperationInProgress();const t=await fae(n);Be(of,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>iL(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>iL(e.remoteStore,s)),n._onlineComponents=e}async function fae(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Be(of,"Using user provided OfflineComponentProvider");try{await CT(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===ue.FAILED_PRECONDITION||s.code===ue.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;k1("Error using user provided cache. Falling back to memory cache: "+t),await CT(n,new p_)}}else Be(of,"Using default OfflineComponentProvider"),await CT(n,new dae(void 0));return n._offlineComponents}async function YU(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Be(of,"Using user provided OnlineComponentProvider"),await dL(n,n._uninitializedComponentsProvider._online)):(Be(of,"Using default OnlineComponentProvider"),await dL(n,new I6))),n._onlineComponents}function pae(n){return YU(n).then(e=>e.syncEngine)}async function m_(n){const e=await YU(n),t=e.eventManager;return t.onListen=Qoe.bind(null,e.syncEngine),t.onUnlisten=tae.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Zoe.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nae.bind(null,e.syncEngine),t}function mae(n,e,t={}){const r=new Uu;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new G7({next:f=>{u.Nu(),o.enqueueAndForget(()=>$7(i,h));const p=f.docs.has(a);!p&&f.fromCache?c.reject(new Re(ue.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&f.fromCache&&l&&l.source==="server"?c.reject(new Re(ue.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new U7(R3(a.path),u,{includeMetadataChanges:!0,qa:!0});return B7(i,h)}(await m_(n),n.asyncQueue,e,t,r)),r.promise}function gae(n,e,t={}){const r=new Uu;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new G7({next:f=>{u.Nu(),o.enqueueAndForget(()=>$7(i,h)),f.fromCache&&l.source==="server"?c.reject(new Re(ue.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new U7(a,u,{includeMetadataChanges:!0,qa:!0});return B7(i,h)}(await m_(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XU(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hL=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JU="firestore.googleapis.com",fL=!0;class pL{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Re(ue.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=JU,this.ssl=fL}else this.host=e.host,this.ssl=e.ssl??fL;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=NU;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Kie)throw new Re(ue.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Mse("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=XU(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Re(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Re(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Re(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $3{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pL({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Re(ue.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Re(ue.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pL(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new kse;switch(r.type){case"firstParty":return new Ase(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Re(ue.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=hL.get(t);r&&(Be("ComponentProvider","Removing Datastore"),hL.delete(t),r.terminate())}(this),Promise.resolve()}}function yae(n,e,t,r={}){var c;n=Yi(n,$3);const s=Uc(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(S3(`https://${a}`),T3("Firestore",!0)),i.host!==JU&&i.host!==a&&k1("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Zh(l,o)&&(n._setSettings(l),r.mockUserToken)){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=yi.MOCK_USER;else{u=TV(r.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new Re(ue.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new yi(f)}n._authCredentials=new _se(new zV(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fd(this.firestore,e,this._query)}}class Pr{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pr(this.firestore,e,this._key)}toJSON(){return{type:Pr._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ew(t,Pr._jsonSchema))return new Pr(e,r||null,new et(qn.fromString(t.referencePath)))}}Pr._jsonSchemaVersion="firestore/documentReference/1.0",Pr._jsonSchema={type:Jr("string",Pr._jsonSchemaVersion),referencePath:Jr("string")};class Vh extends fd{constructor(e,t,r){super(e,t,R3(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pr(this.firestore,null,new et(e))}withConverter(e){return new Vh(this.firestore,e,this._path)}}function Zs(n,e,...t){if(n=Sn(n),BV("collection","path",e),n instanceof $3){const r=qn.fromString(e,...t);return EP(r),new Vh(n,null,r)}{if(!(n instanceof Pr||n instanceof Vh))throw new Re(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qn.fromString(e,...t));return EP(r),new Vh(n.firestore,null,r)}}function or(n,e,...t){if(n=Sn(n),arguments.length===1&&(e=v7.newId()),BV("doc","path",e),n instanceof $3){const r=qn.fromString(e,...t);return AP(r),new Pr(n,null,new et(r))}{if(!(n instanceof Pr||n instanceof Vh))throw new Re(ue.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(qn.fromString(e,...t));return AP(r),new Pr(n.firestore,n instanceof Vh?n.converter:null,new et(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mL="AsyncQueue";class gL{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new PU(this,"async_queue_retry"),this._c=()=>{const r=ET();r&&Be(mL,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=ET();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ET();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Uu;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!X1(e))throw e;Be(mL,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,td("INTERNAL UNHANDLED ERROR: ",yL(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=F7.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&gt(47125,{Pc:yL(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function yL(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xL(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Fc extends $3{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new gL,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gL(e),this._firestoreClient=void 0,await e}}}function QU(n,e){const t=typeof n=="object"?n:G0(),r=typeof n=="string"?n:a_,s=hd(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=p7("firestore");i&&yae(s,...i)}return s}function Mw(n){if(n._terminated)throw new Re(ue.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||xae(n),n._firestoreClient}function xae(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,c,u){return new Hse(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,XU(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new hae(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $a(ti.fromBase64String(e))}catch(t){throw new Re(ue.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new $a(ti.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:$a._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ew(e,$a._jsonSchema))return $a.fromBase64String(e.bytes)}}$a._jsonSchemaVersion="firestore/bytes/1.0",$a._jsonSchema={type:Jr("string",$a._jsonSchemaVersion),bytes:Jr("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Re(ue.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Js(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Re(ue.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Re(ue.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Zt(this._lat,e._lat)||Zt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Rc._jsonSchemaVersion}}static fromJSON(e){if(Ew(e,Rc._jsonSchema))return new Rc(e.latitude,e.longitude)}}Rc._jsonSchemaVersion="firestore/geoPoint/1.0",Rc._jsonSchema={type:Jr("string",Rc._jsonSchemaVersion),latitude:Jr("number"),longitude:Jr("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Mc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ew(e,Mc._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Mc(e.vectorValues);throw new Re(ue.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Mc._jsonSchemaVersion="firestore/vectorValue/1.0",Mc._jsonSchema={type:Jr("string",Mc._jsonSchemaVersion),vectorValues:Jr("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bae=/^__.*__$/;class vae{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new vf(e,this.data,this.fieldMask,t,this.fieldTransforms):new Cw(e,this.data,t,this.fieldTransforms)}}class ZU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new vf(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function eH(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw gt(40011,{Ac:n})}}class W7{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new W7({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return g_(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(eH(this.Ac)&&bae.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class wae{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||F3(e)}Cc(e,t,r,s=!1){return new W7({Ac:e,methodName:t,Dc:r,path:Js.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Dw(n){const e=n._freezeSettings(),t=F3(n._databaseId);return new wae(n._databaseId,!!e.ignoreUndefinedProperties,t)}function K7(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);J7("Data must be an object, but it was:",o,r);const a=rH(r,o);let l,c;if(i.merge)l=new oa(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const h of i.mergeFields){const f=R6(e,h,t);if(!o.contains(f))throw new Re(ue.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);iH(u,f)||u.push(f)}l=new oa(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new vae(new Ao(a),l,c)}class V3 extends Lw{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof V3}}class Y7 extends Lw{_toFieldTransform(e){return new gU(e.path,new wb)}isEqual(e){return e instanceof Y7}}class X7 extends Lw{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Sb(e.serializer,dU(e.serializer,this.Fc));return new gU(e.path,t)}isEqual(e){return e instanceof X7&&this.Fc===e.Fc}}function tH(n,e,t,r){const s=n.Cc(1,e,t);J7("Data must be an object, but it was:",s,r);const i=[],o=Ao.empty();bf(r,(l,c)=>{const u=Q7(e,l,t);c=Sn(c);const h=s.yc(u);if(c instanceof V3)i.push(u);else{const f=jw(c,h);f!=null&&(i.push(u),o.set(u,f))}});const a=new oa(i);return new ZU(o,a,s.fieldTransforms)}function nH(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[R6(e,r,t)],l=[s];if(i.length%2!=0)throw new Re(ue.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(R6(e,i[f])),l.push(i[f+1]);const c=[],u=Ao.empty();for(let f=a.length-1;f>=0;--f)if(!iH(c,a[f])){const p=a[f];let g=l[f];g=Sn(g);const y=o.yc(p);if(g instanceof V3)c.push(p);else{const v=jw(g,y);v!=null&&(c.push(p),u.set(p,v))}}const h=new oa(c);return new ZU(u,h,o.fieldTransforms)}function kae(n,e,t,r=!1){return jw(t,n.Cc(r?4:3,e))}function jw(n,e){if(sH(n=Sn(n)))return J7("Unsupported field value:",e,n),rH(n,e);if(n instanceof Lw)return function(r,s){if(!eH(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=jw(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Sn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dU(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Gn.fromDate(r);return{timestampValue:d_(s.serializer,i)}}if(r instanceof Gn){const i=new Gn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:d_(s.serializer,i)}}if(r instanceof Rc)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof $a)return{bytesValue:kU(s.serializer,r._byteString)};if(r instanceof Pr){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:N7(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Mc)return function(o,a){return{mapValue:{fields:{[YV]:{stringValue:XV},[l_]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return A7(a.serializer,c)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${E3(r)}`)}(n,e)}function rH(n,e){const t={};return UV(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):bf(n,(r,s)=>{const i=jw(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function sH(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Gn||n instanceof Rc||n instanceof $a||n instanceof Pr||n instanceof Lw||n instanceof Mc)}function J7(n,e,t){if(!sH(t)||!$V(t)){const r=E3(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function R6(n,e,t){if((e=Sn(e))instanceof Pw)return e._internalPath;if(typeof e=="string")return Q7(n,e);throw g_("Field path arguments must be of type string or ",n,!1,void 0,t)}const _ae=new RegExp("[~\\*/\\[\\]]");function Q7(n,e,t){if(e.search(_ae)>=0)throw g_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Pw(...e.split("."))._internalPath}catch{throw g_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function g_(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Re(ue.INVALID_ARGUMENT,a+n+l)}function iH(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oH{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Pr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Sae(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(U3("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Sae extends oH{data(){return super.data()}}function U3(n,e){return typeof e=="string"?Q7(n,e):e instanceof Pw?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aH(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Re(ue.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Z7{}class e8 extends Z7{}function Uh(n,e,...t){let r=[];e instanceof Z7&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof t8).length,a=i.filter(l=>l instanceof H3).length;if(o>1||o>0&&a>0)throw new Re(ue.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class H3 extends e8{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new H3(e,t,r)}_apply(e){const t=this._parse(e);return lH(e._query,t),new fd(e.firestore,e.converter,w6(e._query,t))}_parse(e){const t=Dw(e.firestore);return function(i,o,a,l,c,u,h){let f;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new Re(ue.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){vL(h,u);const g=[];for(const y of h)g.push(bL(l,i,y));f={arrayValue:{values:g}}}else f=bL(l,i,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||vL(h,u),f=kae(a,o,h,u==="in"||u==="not-in");return Yr.create(c,u,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function $m(n,e,t){const r=e,s=U3("where",n);return H3._create(s,r,t)}class t8 extends Z7{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new t8(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:zl.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)lH(o,l),o=w6(o,l)}(e._query,t),new fd(e.firestore,e.converter,w6(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class n8 extends e8{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n8(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Re(ue.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Re(ue.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vb(i,o)}(e._query,this._field,this._direction);return new fd(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new J1(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function Ow(n,e="asc"){const t=e,r=U3("orderBy",n);return n8._create(r,t)}class r8 extends e8{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new r8(e,t,r)}_apply(e){return new fd(e.firestore,e.converter,u_(e._query,this._limit,this._limitType))}}function q3(n){return Pse("limit",n),r8._create("limit",n,"F")}function bL(n,e,t){if(typeof(t=Sn(t))=="string"){if(t==="")throw new Re(ue.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sU(e)&&t.indexOf("/")!==-1)throw new Re(ue.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(qn.fromString(t));if(!et.isDocumentKey(r))throw new Re(ue.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return DP(n,new et(r))}if(t instanceof Pr)return DP(n,t._key);throw new Re(ue.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${E3(t)}.`)}function vL(n,e){if(!Array.isArray(n)||n.length===0)throw new Re(ue.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function lH(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Re(ue.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Re(ue.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Tae{convertValue(e,t="none"){switch(rf(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $r(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nf(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw gt(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return bf(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[l_].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>$r(o.doubleValue));return new Mc(t)}convertGeoPoint(e){return new Rc($r(e.latitude),$r(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=I3(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yb(e));default:return null}}convertTimestamp(e){const t=tf(e);return new Gn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=qn.fromString(e);_n(CU(r),9688,{name:e});const s=new xb(r.get(1),r.get(3)),i=new et(r.popFirst(5));return s.isEqual(t)||td(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s8(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Hy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class d0 extends oH{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new B4(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(U3("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Re(ue.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=d0._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}d0._jsonSchemaVersion="firestore/documentSnapshot/1.0",d0._jsonSchema={type:Jr("string",d0._jsonSchemaVersion),bundleSource:Jr("string","DocumentSnapshot"),bundleName:Jr("string"),bundle:Jr("string")};class B4 extends d0{data(e={}){return super.data(e)}}class h0{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Hy(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new B4(this._firestore,this._userDataWriter,r.key,r,new Hy(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Re(ue.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new B4(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Hy(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new B4(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Hy(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:Aae(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Re(ue.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=h0._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=v7.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Aae(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return gt(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(n){n=Yi(n,Pr);const e=Yi(n.firestore,Fc);return mae(Mw(e),n._key).then(t=>cH(e,n,t))}h0._jsonSchemaVersion="firestore/querySnapshot/1.0",h0._jsonSchema={type:Jr("string",h0._jsonSchemaVersion),bundleSource:Jr("string","QuerySnapshot"),bundleName:Jr("string"),bundle:Jr("string")};class i8 extends Tae{constructor(e){super(),this.firestore=e}convertBytes(e){return new $a(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pr(this.firestore,null,t)}}function Hh(n){n=Yi(n,fd);const e=Yi(n.firestore,Fc),t=Mw(e),r=new i8(e);return aH(n._query),gae(t,n._query).then(s=>new h0(e,r,n,s))}function Pc(n,e,t){n=Yi(n,Pr);const r=Yi(n.firestore,Fc),s=s8(n.converter,e,t);return zw(r,[K7(Dw(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Xi.none())])}function Tb(n,e,t,...r){n=Yi(n,Pr);const s=Yi(n.firestore,Fc),i=Dw(s);let o;return o=typeof(e=Sn(e))=="string"||e instanceof Pw?nH(i,"updateDoc",n._key,e,t,r):tH(i,"updateDoc",n._key,e),zw(s,[o.toMutation(n._key,Xi.exists(!0))])}function l7e(n){return zw(Yi(n.firestore,Fc),[new j3(n._key,Xi.none())])}function Fw(n,e){const t=Yi(n.firestore,Fc),r=or(n),s=s8(n.converter,e);return zw(t,[K7(Dw(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Xi.exists(!1))]).then(()=>r)}function Ab(n,...e){var l,c,u;n=Sn(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||xL(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(xL(e[r])){const h=e[r];e[r]=(l=h.next)==null?void 0:l.bind(h),e[r+1]=(c=h.error)==null?void 0:c.bind(h),e[r+2]=(u=h.complete)==null?void 0:u.bind(h)}let i,o,a;if(n instanceof Pr)o=Yi(n.firestore,Fc),a=R3(n._key.path),i={next:h=>{e[r]&&e[r](cH(o,n,h))},error:e[r+1],complete:e[r+2]};else{const h=Yi(n,fd);o=Yi(h.firestore,Fc),a=h._query;const f=new i8(o);i={next:p=>{e[r]&&e[r](new h0(o,f,h,p))},error:e[r+1],complete:e[r+2]},aH(n._query)}return function(f,p,g,y){const v=new G7(y),b=new U7(p,v,g);return f.asyncQueue.enqueueAndForget(async()=>B7(await m_(f),b)),()=>{v.Nu(),f.asyncQueue.enqueueAndForget(async()=>$7(await m_(f),b))}}(Mw(o),a,s,i)}function zw(n,e){return function(r,s){const i=new Uu;return r.asyncQueue.enqueueAndForget(async()=>rae(await pae(r),s,i)),i.promise}(Mw(n),e)}function cH(n,e,t){const r=t.docs.get(e._key),s=new i8(n);return new d0(n,s,e._key,r,new Hy(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eae{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Dw(e)}set(e,t,r){this._verifyNotCommitted();const s=NT(e,this._firestore),i=s8(s.converter,t,r),o=K7(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Xi.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=NT(e,this._firestore);let o;return o=typeof(t=Sn(t))=="string"||t instanceof Pw?nH(this._dataReader,"WriteBatch.update",i._key,t,r,s):tH(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Xi.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=NT(e,this._firestore);return this._mutations=this._mutations.concat(new j3(t._key,Xi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Re(ue.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function NT(n,e){if((n=Sn(n)).firestore!==e)throw new Re(ue.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function rd(){return new Y7("serverTimestamp")}function y_(n){return new X7("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cae(n){return Mw(n=Yi(n,Fc)),new Eae(n,e=>zw(n,e))}(function(e,t=!0){(function(s){K1=s})(q0),el(new ma("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Fc(new Sse(r.getProvider("auth-internal")),new Ese(o,r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Re(ue.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xb(c.options.projectId,u)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Si(kP,_P,e),Si(kP,_P,"esm2020")})();function uH(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Nae=uH,dH=new H0("auth","Firebase",uH());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_=new A3("@firebase/auth");function Iae(n,...e){x_.logLevel<=Qt.WARN&&x_.warn(`Auth (${q0}): ${n}`,...e)}function $4(n,...e){x_.logLevel<=Qt.ERROR&&x_.error(`Auth (${q0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(n,...e){throw a8(n,...e)}function jl(n,...e){return a8(n,...e)}function o8(n,e,t){const r={...Nae(),[e]:t};return new H0("auth","Firebase",r).create(e,{appName:n.name})}function Lc(n){return o8(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Rae(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&tl(n,"argument-error"),o8(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function a8(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return dH.create(n,...e)}function mt(n,e,...t){if(!n)throw a8(e,...t)}function zu(n){const e="INTERNAL ASSERTION FAILED: "+n;throw $4(e),new Error(e)}function sd(n,e){n||zu(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M6(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Mae(){return wL()==="http:"||wL()==="https:"}function wL(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pae(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mae()||m7()||"connection"in navigator)?navigator.onLine:!0}function Lae(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(e,t){this.shortDelay=e,this.longDelay=t,sd(t>e,"Short delay should be less than long delay!"),this.isMobile=Yne()||Qne()}get(){return Pae()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l8(n,e){sd(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hH{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dae={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jae=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Oae=new Bw(3e4,6e4);function pd(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function wf(n,e,t,r,s={}){return fH(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Aw({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...i};return Jne()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&Uc(n.emulatorConfig.host)&&(c.credentials="include"),hH.fetch()(await pH(n,n.config.apiHost,t,a),c)})}async function fH(n,e,t){n._canInitEmulator=!1;const r={...Dae,...e};try{const s=new zae(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw B2(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw B2(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw B2(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw B2(n,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw o8(n,u,c);tl(n,u)}}catch(s){if(s instanceof xa)throw s;tl(n,"network-request-failed",{message:String(s)})}}async function Z1(n,e,t,r,s={}){const i=await wf(n,e,t,r,s);return"mfaPendingCredential"in i&&tl(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function pH(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?l8(n.config,s):`${n.config.apiScheme}://${s}`;return jae.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function Fae(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zae{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jl(this.auth,"network-request-failed")),Oae.get())})}}function B2(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=jl(n,e,r);return s.customData._tokenResponse=t,s}function kL(n){return n!==void 0&&n.enterprise!==void 0}class Bae{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Fae(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function $ae(n,e){return wf(n,"GET","/v2/recaptchaConfig",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vae(n,e){return wf(n,"POST","/v1/accounts:delete",e)}async function b_(n,e){return wf(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nx(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Uae(n,e=!1){const t=Sn(n),r=await t.getIdToken(e),s=c8(r);mt(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Nx(IT(s.auth_time)),issuedAtTime:Nx(IT(s.iat)),expirationTime:Nx(IT(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function IT(n){return Number(n)*1e3}function c8(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return $4("JWT malformed, contained fewer than 3 sections"),null;try{const s=wV(t);return s?JSON.parse(s):($4("Failed to decode base64 JWT payload"),null)}catch(s){return $4("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function _L(n){const e=c8(n);return mt(e,"internal-error"),mt(typeof e.exp<"u","internal-error"),mt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eb(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof xa&&Hae(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Hae({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qae{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nx(this.lastLoginAt),this.creationTime=Nx(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v_(n){var h;const e=n.auth,t=await n.getIdToken(),r=await Eb(n,b_(e,{idToken:t}));mt(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?mH(s.providerUserInfo):[],o=Wae(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new P6(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(n,u)}async function Gae(n){const e=Sn(n);await v_(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Wae(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function mH(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kae(n,e){const t=await fH(n,{},async()=>{const r=Aw({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await pH(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&Uc(n.emulatorConfig.host)&&(l.credentials="include"),hH.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Yae(n,e){return wf(n,"POST","/v2/accounts:revokeToken",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){mt(e.idToken,"internal-error"),mt(typeof e.idToken<"u","internal-error"),mt(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):_L(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){mt(e.length!==0,"internal-error");const t=_L(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(mt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Kae(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Qm;return r&&(mt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(mt(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(mt(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qm,this.toJSON())}_performRefresh(){return zu("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ad(n,e){mt(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Rl{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new qae(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new P6(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Eb(this,this.stsTokenManager.getToken(this.auth,e));return mt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Uae(this,e)}reload(){return Gae(this)}_assign(e){this!==e&&(mt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Rl({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){mt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await v_(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wi(this.auth.app))return Promise.reject(Lc(this.auth));const e=await this.getIdToken();return await Eb(this,Vae(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:p,providerData:g,stsTokenManager:y}=t;mt(h&&y,e,"internal-error");const v=Qm.fromJSON(this.name,y);mt(typeof h=="string",e,"internal-error"),Ad(r,e.name),Ad(s,e.name),mt(typeof f=="boolean",e,"internal-error"),mt(typeof p=="boolean",e,"internal-error"),Ad(i,e.name),Ad(o,e.name),Ad(a,e.name),Ad(l,e.name),Ad(c,e.name),Ad(u,e.name);const b=new Rl({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:p,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:c,lastLoginAt:u});return g&&Array.isArray(g)&&(b.providerData=g.map(w=>({...w}))),l&&(b._redirectEventId=l),b}static async _fromIdTokenResponse(e,t,r=!1){const s=new Qm;s.updateFromServerResponse(t);const i=new Rl({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await v_(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];mt(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?mH(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Qm;a.updateFromIdToken(r);const l=new Rl({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new P6(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SL=new Map;function Bu(n){sd(n instanceof Function,"Expected a class definition");let e=SL.get(n);return e?(sd(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,SL.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gH{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}gH.type="NONE";const TL=gH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4(n,e,t){return`firebase:${n}:${e}:${t}`}class Zm{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=V4(this.userKey,s.apiKey,i),this.fullPersistenceKey=V4("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await b_(this.auth,{idToken:e}).catch(()=>{});return t?Rl._fromGetAccountInfoResponse(this.auth,t,e):null}return Rl._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Zm(Bu(TL),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Bu(TL);const o=V4(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const u=await c._get(o);if(u){let h;if(typeof u=="string"){const f=await b_(e,{idToken:u}).catch(()=>{});if(!f)break;h=await Rl._fromGetAccountInfoResponse(e,f,u)}else h=Rl._fromJSON(e,u);c!==i&&(a=h),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Zm(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Zm(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AL(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(vH(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(yH(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(kH(e))return"Blackberry";if(_H(e))return"Webos";if(xH(e))return"Safari";if((e.includes("chrome/")||bH(e))&&!e.includes("edge/"))return"Chrome";if(wH(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function yH(n=Ai()){return/firefox\//i.test(n)}function xH(n=Ai()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bH(n=Ai()){return/crios\//i.test(n)}function vH(n=Ai()){return/iemobile/i.test(n)}function wH(n=Ai()){return/android/i.test(n)}function kH(n=Ai()){return/blackberry/i.test(n)}function _H(n=Ai()){return/webos/i.test(n)}function u8(n=Ai()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Xae(n=Ai()){var e;return u8(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Jae(){return Zne()&&document.documentMode===10}function SH(n=Ai()){return u8(n)||wH(n)||_H(n)||kH(n)||/windows phone/i.test(n)||vH(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TH(n,e=[]){let t;switch(n){case"Browser":t=AL(Ai());break;case"Worker":t=`${AL(Ai())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${q0}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qae{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zae(n,e={}){return wf(n,"GET","/v2/passwordPolicy",pd(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ele=6;class tle{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??ele,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nle{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new EL(this),this.idTokenSubscription=new EL(this),this.beforeStateQueue=new Qae(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dH,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bu(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Zm.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await b_(this,{idToken:e}),r=await Rl._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(wi(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return mt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await v_(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Lae()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(wi(this.app))return Promise.reject(Lc(this));const t=e?Sn(e):null;return t&&mt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&mt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return wi(this.app)?Promise.reject(Lc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return wi(this.app)?Promise.reject(Lc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bu(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Zae(this),t=new tle(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new H0("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Yae(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Bu(e)||this._popupRedirectResolver;mt(t,this,"argument-error"),this.redirectPersistenceManager=await Zm.create(this,[Bu(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(mt(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return mt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=TH(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(wi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Iae(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function md(n){return Sn(n)}class EL{constructor(e){this.auth=e,this.observer=null,this.addObserver=ire(t=>this.observer=t)}get next(){return mt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G3={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rle(n){G3=n}function AH(n){return G3.loadJS(n)}function sle(){return G3.recaptchaEnterpriseScript}function ile(){return G3.gapiScript}function ole(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class ale{constructor(){this.enterprise=new lle}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class lle{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const cle="recaptcha-enterprise",EH="NO_RECAPTCHA";class ule{constructor(e){this.type=cle,this.auth=md(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{$ae(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Bae(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;kL(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(EH)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ale().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&kL(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=sle();l.length!==0&&(l+=a),AH(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function CL(n,e,t,r=!1,s=!1){const i=new ule(n);let o;if(s)o=EH;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function NL(n,e,t,r,s){var i;if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await CL(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await CL(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dle(n,e){const t=hd(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Zh(i,e??{}))return s;tl(s,"already-initialized")}return t.initialize({options:e})}function hle(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Bu);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function fle(n,e,t){const r=md(n);mt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=CH(e),{host:o,port:a}=ple(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){mt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),mt(Zh(c,r.config.emulator)&&Zh(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Uc(o)?(S3(`${i}//${o}${l}`),T3("Auth",!0)):mle()}function CH(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ple(n){const e=CH(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:IL(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:IL(o)}}}function IL(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function mle(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d8{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zu("not implemented")}_getIdTokenResponse(e){return zu("not implemented")}_linkToIdToken(e,t){return zu("not implemented")}_getReauthenticationResolver(e){return zu("not implemented")}}async function gle(n,e){return wf(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yle(n,e){return Z1(n,"POST","/v1/accounts:signInWithPassword",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xle(n,e){return Z1(n,"POST","/v1/accounts:signInWithEmailLink",pd(n,e))}async function ble(n,e){return Z1(n,"POST","/v1/accounts:signInWithEmailLink",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb extends d8{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Cb(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Cb(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return NL(e,t,"signInWithPassword",yle);case"emailLink":return xle(e,{email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return NL(e,r,"signUpPassword",gle);case"emailLink":return ble(e,{idToken:t,email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eg(n,e){return Z1(n,"POST","/v1/accounts:signInWithIdp",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vle="http://localhost";class E0 extends d8{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new E0(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new E0(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return eg(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,eg(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,eg(e,t)}buildRequest(){const e={requestUri:vle,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Aw(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wle(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function kle(n){const e=zy(By(n)).link,t=e?zy(By(e)).deep_link_id:null,r=zy(By(n)).deep_link_id;return(r?zy(By(r)).link:null)||r||t||e||n}class h8{constructor(e){const t=zy(By(e)),r=t.apiKey??null,s=t.oobCode??null,i=wle(t.mode??null);mt(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=kle(e);try{return new h8(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(){this.providerId=ey.PROVIDER_ID}static credential(e,t){return Cb._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=h8.parseLink(t);return mt(r,"argument-error"),Cb._fromEmailAndCode(e,r.code,r.tenantId)}}ey.PROVIDER_ID="password";ey.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ey.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f8{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w extends f8{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd extends $w{constructor(){super("facebook.com")}static credential(e){return E0._fromParams({providerId:Bd.PROVIDER_ID,signInMethod:Bd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bd.credentialFromTaggedObject(e)}static credentialFromError(e){return Bd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Bd.credential(e.oauthAccessToken)}catch{return null}}}Bd.FACEBOOK_SIGN_IN_METHOD="facebook.com";Bd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl extends $w{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return E0._fromParams({providerId:Nl.PROVIDER_ID,signInMethod:Nl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Nl.credentialFromTaggedObject(e)}static credentialFromError(e){return Nl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Nl.credential(t,r)}catch{return null}}}Nl.GOOGLE_SIGN_IN_METHOD="google.com";Nl.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d extends $w{constructor(){super("github.com")}static credential(e){return E0._fromParams({providerId:$d.PROVIDER_ID,signInMethod:$d.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $d.credentialFromTaggedObject(e)}static credentialFromError(e){return $d.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $d.credential(e.oauthAccessToken)}catch{return null}}}$d.GITHUB_SIGN_IN_METHOD="github.com";$d.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd extends $w{constructor(){super("twitter.com")}static credential(e,t){return E0._fromParams({providerId:Vd.PROVIDER_ID,signInMethod:Vd.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Vd.credentialFromTaggedObject(e)}static credentialFromError(e){return Vd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Vd.credential(t,r)}catch{return null}}}Vd.TWITTER_SIGN_IN_METHOD="twitter.com";Vd.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _le(n,e){return Z1(n,"POST","/v1/accounts:signUp",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Rl._fromIdTokenResponse(e,r,s),o=RL(r);return new id({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=RL(r);return new id({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function RL(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sle(n){var s;if(wi(n.app))return Promise.reject(Lc(n));const e=md(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new id({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await _le(e,{returnSecureToken:!0}),r=await id._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_ extends xa{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,w_.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new w_(e,t,r,s)}}function NH(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?w_._fromErrorAndOperation(n,i,e,r):i})}async function Tle(n,e,t=!1){const r=await Eb(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return id._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ale(n,e,t=!1){const{auth:r}=n;if(wi(r.app))return Promise.reject(Lc(r));const s="reauthenticate";try{const i=await Eb(n,NH(r,s,e,n),t);mt(i.idToken,r,"internal-error");const o=c8(i.idToken);mt(o,r,"internal-error");const{sub:a}=o;return mt(n.uid===a,r,"user-mismatch"),id._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&tl(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IH(n,e,t=!1){if(wi(n.app))return Promise.reject(Lc(n));const r="signIn",s=await NH(n,r,e),i=await id._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Ele(n,e){return IH(md(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cle(n,e){return Z1(n,"POST","/v1/accounts:signInWithCustomToken",pd(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c7e(n,e){if(wi(n.app))return Promise.reject(Lc(n));const t=md(n),r=await Cle(t,{token:e,returnSecureToken:!0}),s=await id._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nle(n){const e=md(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Ile(n,e,t){return wi(n.app)?Promise.reject(Lc(n)):Ele(Sn(n),ey.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Nle(n),r})}function Rle(n,e,t,r){return Sn(n).onIdTokenChanged(e,t,r)}function Mle(n,e,t){return Sn(n).beforeAuthStateChanged(e,t)}function Ple(n,e,t,r){return Sn(n).onAuthStateChanged(e,t,r)}const k_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RH{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(k_,"1"),this.storage.removeItem(k_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lle=1e3,Dle=10;class MH extends RH{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=SH(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Jae()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Dle):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Lle)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}MH.type="LOCAL";const jle=MH;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PH extends RH{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}PH.type="SESSION";const LH=PH;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ole(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W3{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new W3(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await Ole(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}W3.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p8(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fle{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=p8("",20);s.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(){return window}function zle(n){Dc().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DH(){return typeof Dc().WorkerGlobalScope<"u"&&typeof Dc().importScripts=="function"}async function Ble(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $le(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function Vle(){return DH()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jH="firebaseLocalStorageDb",Ule=1,__="firebaseLocalStorage",OH="fbase_key";class Vw{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function K3(n,e){return n.transaction([__],e?"readwrite":"readonly").objectStore(__)}function Hle(){const n=indexedDB.deleteDatabase(jH);return new Vw(n).toPromise()}function L6(){const n=indexedDB.open(jH,Ule);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(__,{keyPath:OH})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(__)?e(r):(r.close(),await Hle(),e(await L6()))})})}async function ML(n,e,t){const r=K3(n,!0).put({[OH]:e,value:t});return new Vw(r).toPromise()}async function qle(n,e){const t=K3(n,!1).get(e),r=await new Vw(t).toPromise();return r===void 0?null:r.value}function PL(n,e){const t=K3(n,!0).delete(e);return new Vw(t).toPromise()}const Gle=800,Wle=3;class FH{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await L6(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Wle)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return DH()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=W3._getInstance(Vle()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await Ble(),!this.activeServiceWorker)return;this.sender=new Fle(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$le()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await L6();return await ML(e,k_,"1"),await PL(e,k_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ML(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>qle(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>PL(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=K3(s,!1).getAll();return new Vw(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Gle)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}FH.type="LOCAL";const Kle=FH;new Bw(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zH(n,e){return e?Bu(e):(mt(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m8 extends d8{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return eg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return eg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return eg(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Yle(n){return IH(n.auth,new m8(n),n.bypassAuthState)}function Xle(n){const{auth:e,user:t}=n;return mt(t,e,"internal-error"),Ale(t,new m8(n),n.bypassAuthState)}async function Jle(n){const{auth:e,user:t}=n;return mt(t,e,"internal-error"),Tle(t,new m8(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BH{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Yle;case"linkViaPopup":case"linkViaRedirect":return Jle;case"reauthViaPopup":case"reauthViaRedirect":return Xle;default:tl(this.auth,"internal-error")}}resolve(e){sd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){sd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qle=new Bw(2e3,1e4);async function $H(n,e,t){if(wi(n.app))return Promise.reject(jl(n,"operation-not-supported-in-this-environment"));const r=md(n);Rae(n,e,f8);const s=zH(r,t);return new Qf(r,"signInViaPopup",e,s).executeNotNull()}class Qf extends BH{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Qf.currentPopupAction&&Qf.currentPopupAction.cancel(),Qf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return mt(e,this.auth,"internal-error"),e}async onExecution(){sd(this.filter.length===1,"Popup operations only handle one event");const e=p8();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(jl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(jl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Qle.get())};e()}}Qf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zle="pendingRedirect",U4=new Map;class ece extends BH{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=U4.get(this.auth._key());if(!e){try{const r=await tce(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}U4.set(this.auth._key(),e)}return this.bypassAuthState||U4.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tce(n,e){const t=sce(e),r=rce(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function nce(n,e){U4.set(n._key(),e)}function rce(n){return Bu(n._redirectPersistence)}function sce(n){return V4(Zle,n.config.apiKey,n.name)}async function ice(n,e,t=!1){if(wi(n.app))return Promise.reject(Lc(n));const r=md(n),s=zH(r,e),o=await new ece(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oce=10*60*1e3;class ace{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lce(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!VH(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(jl(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=oce&&this.cachedEventUids.clear(),this.cachedEventUids.has(LL(e))}saveEventToCache(e){this.cachedEventUids.add(LL(e)),this.lastProcessedEventTime=Date.now()}}function LL(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function VH({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function lce(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return VH(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cce(n,e={}){return wf(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uce=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dce=/^https?/;async function hce(n){if(n.config.emulator)return;const{authorizedDomains:e}=await cce(n);for(const t of e)try{if(fce(t))return}catch{}tl(n,"unauthorized-domain")}function fce(n){const e=M6(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!dce.test(t))return!1;if(uce.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pce=new Bw(3e4,6e4);function DL(){const n=Dc().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function mce(n){return new Promise((e,t)=>{var s,i,o;function r(){DL(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{DL(),t(jl(n,"network-request-failed"))},timeout:pce.get()})}if((i=(s=Dc().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Dc().gapi)!=null&&o.load)r();else{const a=ole("iframefcb");return Dc()[a]=()=>{gapi.load?r():t(jl(n,"network-request-failed"))},AH(`${ile()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw H4=null,e})}let H4=null;function gce(n){return H4=H4||mce(n),H4}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yce=new Bw(5e3,15e3),xce="__/auth/iframe",bce="emulator/auth/iframe",vce={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},wce=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kce(n){const e=n.config;mt(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?l8(e,bce):`https://${n.config.authDomain}/${xce}`,r={apiKey:e.apiKey,appName:n.name,v:q0},s=wce.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Aw(r).slice(1)}`}async function _ce(n){const e=await gce(n),t=Dc().gapi;return mt(t,n,"internal-error"),e.open({where:document.body,url:kce(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:vce,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=jl(n,"network-request-failed"),a=Dc().setTimeout(()=>{i(o)},yce.get());function l(){Dc().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sce={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Tce=500,Ace=600,Ece="_blank",Cce="http://localhost";class jL{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Nce(n,e,t,r=Tce,s=Ace){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...Sce,width:r.toString(),height:s.toString(),top:i,left:o},c=Ai().toLowerCase();t&&(a=bH(c)?Ece:t),yH(c)&&(e=e||Cce,l.scrollbars="yes");const u=Object.entries(l).reduce((f,[p,g])=>`${f}${p}=${g},`,"");if(Xae(c)&&a!=="_self")return Ice(e||"",a),new jL(null);const h=window.open(e||"",a,u);mt(h,n,"popup-blocked");try{h.focus()}catch{}return new jL(h)}function Ice(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rce="__/auth/handler",Mce="emulator/auth/handler",Pce=encodeURIComponent("fac");async function OL(n,e,t,r,s,i){mt(n.config.authDomain,n,"auth-domain-config-required"),mt(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:q0,eventId:s};if(e instanceof f8){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",sre(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof $w){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await n._getAppCheckToken(),c=l?`#${Pce}=${encodeURIComponent(l)}`:"";return`${Lce(n)}?${Aw(a).slice(1)}${c}`}function Lce({config:n}){return n.emulator?l8(n,Mce):`https://${n.authDomain}/${Rce}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RT="webStorageSupport";class Dce{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=LH,this._completeRedirectFn=ice,this._overrideRedirectResult=nce}async _openPopup(e,t,r,s){var o;sd((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await OL(e,t,r,M6(),s);return Nce(e,i,p8())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await OL(e,t,r,M6(),s);return zle(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(sd(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await _ce(e),r=new ace(e);return t.register("authEvent",s=>(mt(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(RT,{type:RT},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[RT];i!==void 0&&t(!!i),tl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hce(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return SH()||xH()||u8()}}const jce=Dce;var FL="@firebase/auth",zL="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oce{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){mt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fce(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zce(n){el(new ma("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;mt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:TH(n)},c=new nle(r,s,i,l);return hle(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),el(new ma("auth-internal",e=>{const t=md(e.getProvider("auth").getImmediate());return(r=>new Oce(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Si(FL,zL,Fce(n)),Si(FL,zL,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bce=5*60,$ce=SV("authIdTokenMaxAge")||Bce;let BL=null;const Vce=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>$ce)return;const s=t==null?void 0:t.token;BL!==s&&(BL=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function D6(n=G0()){const e=hd(n,"auth");if(e.isInitialized())return e.getImmediate();const t=dle(n,{popupRedirectResolver:jce,persistence:[Kle,jle,LH]}),r=SV("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Vce(i.toString());Mle(t,o,()=>o(t.currentUser)),Rle(t,a=>o(a))}}const s=kV("auth");return s&&fle(t,`http://${s}`),t}function Uce(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}rle({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=jl("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Uce().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});zce("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UH="firebasestorage.googleapis.com",HH="storageBucket",Hce=2*60*1e3,qce=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr extends xa{constructor(e,t,r=0){super(MT(e),`Firebase Storage: ${t} (${MT(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Dr.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return MT(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Lr;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Lr||(Lr={}));function MT(n){return"storage/"+n}function g8(){const n="An unknown error occurred, please check the error payload for server response.";return new Dr(Lr.UNKNOWN,n)}function Gce(n){return new Dr(Lr.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Wce(n){return new Dr(Lr.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Kce(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Dr(Lr.UNAUTHENTICATED,n)}function Yce(){return new Dr(Lr.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Xce(n){return new Dr(Lr.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function Jce(){return new Dr(Lr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Qce(){return new Dr(Lr.CANCELED,"User canceled the upload/download.")}function Zce(n){return new Dr(Lr.INVALID_URL,"Invalid URL '"+n+"'.")}function eue(n){return new Dr(Lr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function tue(){return new Dr(Lr.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+HH+"' property when initializing the app?")}function nue(){return new Dr(Lr.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function rue(){return new Dr(Lr.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function sue(n){return new Dr(Lr.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function j6(n){return new Dr(Lr.INVALID_ARGUMENT,n)}function qH(){return new Dr(Lr.APP_DELETED,"The Firebase app was deleted.")}function iue(n){return new Dr(Lr.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ix(n,e){return new Dr(Lr.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function xy(n){throw new Dr(Lr.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=aa.makeFromUrl(e,t)}catch{return new aa(e,"")}if(r.path==="")return r;throw eue(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(T){T.path.charAt(T.path.length-1)==="/"&&(T.path_=T.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(T){T.path_=decodeURIComponent(T.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",p=new RegExp(`^https?://${h}/${u}/b/${s}/o${f}`,"i"),g={bucket:1,path:3},y=t===UH?"(?:storage.googleapis.com|storage.cloud.google.com)":t,v="([^?#]*)",b=new RegExp(`^https?://${y}/${s}/${v}`,"i"),k=[{regex:a,indices:l,postModify:i},{regex:p,indices:g,postModify:c},{regex:b,indices:{bucket:1,path:2},postModify:c}];for(let T=0;T<k.length;T++){const R=k[T],M=R.regex.exec(e);if(M){const E=M[R.indices.bucket];let I=M[R.indices.path];I||(I=""),r=new aa(E,I),R.postModify(r);break}}if(r==null)throw Zce(e);return r}}class oue{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aue(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...v){c||(c=!0,e.apply(null,v))}function h(v){s=setTimeout(()=>{s=null,n(p,l())},v)}function f(){i&&clearTimeout(i)}function p(v,...b){if(c){f();return}if(v){f(),u.call(null,v,...b);return}if(l()||o){f(),u.call(null,v,...b);return}r<64&&(r*=2);let k;a===1?(a=2,k=0):k=(r+Math.random())*1e3,h(k)}let g=!1;function y(v){g||(g=!0,f(),!c&&(s!==null?(v||(a=2),clearTimeout(s),h(0)):v||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,y(!0)},t),y}function lue(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cue(n){return n!==void 0}function uue(n){return typeof n=="object"&&!Array.isArray(n)}function y8(n){return typeof n=="string"||n instanceof String}function $L(n){return x8()&&n instanceof Blob}function x8(){return typeof Blob<"u"}function VL(n,e,t,r){if(r<e)throw j6(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw j6(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b8(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function GH(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var f0;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(f0||(f0={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function due(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hue{constructor(e,t,r,s,i,o,a,l,c,u,h,f=!0,p=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=f,this.isUsingEmulator=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,y)=>{this.resolve_=g,this.reject_=y,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new $2(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===f0.NO_ERROR,l=i.getStatus();if(!a||due(l,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===f0.ABORT;r(!1,new $2(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new $2(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());cue(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=g8();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?qH():Qce();o(l)}else{const l=Jce();o(l)}};this.canceled_?t(!1,new $2(!1,null,!0)):this.backoffId_=aue(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&lue(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class $2{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function fue(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function pue(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function mue(n,e){e&&(n["X-Firebase-GMPID"]=e)}function gue(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function yue(n,e,t,r,s,i,o=!0,a=!1){const l=GH(n.urlParams),c=n.url+l,u=Object.assign({},n.headers);return mue(u,e),fue(u,t),pue(u,i),gue(u,r),new hue(c,n.method,u,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xue(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function bue(...n){const e=xue();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(x8())return new Blob(n);throw new Dr(Lr.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function vue(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wue(n){if(typeof atob>"u")throw sue("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class PT{constructor(e,t){this.data=e,this.contentType=t||null}}function kue(n,e){switch(n){case Sc.RAW:return new PT(WH(e));case Sc.BASE64:case Sc.BASE64URL:return new PT(KH(n,e));case Sc.DATA_URL:return new PT(Sue(e),Tue(e))}throw g8()}function WH(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function _ue(n){let e;try{e=decodeURIComponent(n)}catch{throw Ix(Sc.DATA_URL,"Malformed data URL.")}return WH(e)}function KH(n,e){switch(n){case Sc.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Ix(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Sc.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Ix(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=wue(e)}catch(s){throw s.message.includes("polyfill")?s:Ix(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class YH{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ix(Sc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=Aue(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function Sue(n){const e=new YH(n);return e.base64?KH(Sc.BASE64,e.rest):_ue(e.rest)}function Tue(n){return new YH(n).contentType}function Aue(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,t){let r=0,s="";$L(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if($L(this.data_)){const r=this.data_,s=vue(r,e,t);return s===null?null:new Ud(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Ud(r,!0)}}static getBlob(...e){if(x8()){const t=e.map(r=>r instanceof Ud?r.data_:r);return new Ud(bue.apply(null,t))}else{const t=e.map(o=>y8(o)?kue(Sc.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Ud(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XH(n){let e;try{e=JSON.parse(n)}catch{return null}return uue(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eue(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Cue(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function JH(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nue(n,e){return e}let Li=class{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||Nue}},V2=null;function Iue(n){return!y8(n)||n.length<2?n:JH(n)}function QH(){if(V2)return V2;const n=[];n.push(new Li("bucket")),n.push(new Li("generation")),n.push(new Li("metageneration")),n.push(new Li("name","fullPath",!0));function e(i,o){return Iue(o)}const t=new Li("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new Li("size");return s.xform=r,n.push(s),n.push(new Li("timeCreated")),n.push(new Li("updated")),n.push(new Li("md5Hash",null,!0)),n.push(new Li("cacheControl",null,!0)),n.push(new Li("contentDisposition",null,!0)),n.push(new Li("contentEncoding",null,!0)),n.push(new Li("contentLanguage",null,!0)),n.push(new Li("contentType",null,!0)),n.push(new Li("metadata","customMetadata",!0)),V2=n,V2}function Rue(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new aa(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function Mue(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return Rue(r,n),r}function ZH(n,e,t){const r=XH(e);return r===null?null:Mue(n,r,t)}function Pue(n,e,t,r){const s=XH(e);if(s===null||!y8(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const u=n.bucket,h=n.fullPath,f="/b/"+o(u)+"/o/"+o(h),p=b8(f,t,r),g=GH({alt:"media",token:c});return p+g})[0]}function Lue(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class eq{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tq(n){if(!n)throw g8()}function Due(n,e){function t(r,s){const i=ZH(n,s,e);return tq(i!==null),i}return t}function jue(n,e){function t(r,s){const i=ZH(n,s,e);return tq(i!==null),Pue(i,s,n.host,n._protocol)}return t}function nq(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=Yce():s=Kce():t.getStatus()===402?s=Wce(n.bucket):t.getStatus()===403?s=Xce(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function Oue(n){const e=nq(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=Gce(n.path)),i.serverResponse=s.serverResponse,i}return t}function Fue(n,e,t){const r=e.fullServerUrl(),s=b8(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new eq(s,i,jue(n,t),o);return a.errorHandler=Oue(e),a}function zue(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function Bue(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=zue(null,e)),r}function $ue(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let k="";for(let T=0;T<2;T++)k=k+Math.random().toString().slice(2);return k}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=Bue(e,r,s),u=Lue(c,t),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,f=`\r
--`+l+"--",p=Ud.getBlob(h,r,f);if(p===null)throw nue();const g={name:c.fullPath},y=b8(i,n.host,n._protocol),v="POST",b=n.maxUploadRetryTime,w=new eq(y,v,Due(n,t),b);return w.urlParams=g,w.headers=o,w.body=p.uploadData(),w.errorHandler=nq(e),w}class Vue{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=f0.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=f0.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=f0.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s,i){if(this.sent_)throw xy("cannot .send() more than once");if(Uc(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw xy("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw xy("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw xy("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw xy("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class Uue extends Vue{initXhr(){this.xhr_.responseType="text"}}function rq(){return new Uue}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(e,t){this._service=e,t instanceof aa?this._location=t:this._location=aa.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new C0(e,t)}get root(){const e=new aa(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return JH(this._location.path)}get storage(){return this._service}get parent(){const e=Eue(this._location.path);if(e===null)return null;const t=new aa(this._location.bucket,e);return new C0(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw iue(e)}}function Hue(n,e,t){n._throwIfRoot("uploadBytes");const r=$ue(n.storage,n._location,QH(),new Ud(e,!0),t);return n.storage.makeRequestWithTokens(r,rq).then(s=>({metadata:s,ref:n}))}function que(n){n._throwIfRoot("getDownloadURL");const e=Fue(n.storage,n._location,QH());return n.storage.makeRequestWithTokens(e,rq).then(t=>{if(t===null)throw rue();return t})}function Gue(n,e){const t=Cue(n._location.path,e),r=new aa(n._location.bucket,t);return new C0(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wue(n){return/^[A-Za-z]+:\/\//.test(n)}function Kue(n,e){return new C0(n,e)}function sq(n,e){if(n instanceof v8){const t=n;if(t._bucket==null)throw tue();const r=new C0(t,t._bucket);return e!=null?sq(r,e):r}else return e!==void 0?Gue(n,e):n}function Yue(n,e){if(e&&Wue(e)){if(n instanceof v8)return Kue(n,e);throw j6("To use ref(service, url), the first argument must be a Storage instance.")}else return sq(n,e)}function UL(n,e){const t=e==null?void 0:e[HH];return t==null?null:aa.makeFromBucketSpec(t,n)}function Xue(n,e,t,r={}){n.host=`${e}:${t}`;const s=Uc(e);s&&(S3(`https://${n.host}/b`),T3("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:TV(i,n.app.options.projectId))}class v8{constructor(e,t,r,s,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=UH,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Hce,this._maxUploadRetryTime=qce,this._requests=new Set,s!=null?this._bucket=aa.makeFromBucketSpec(s,this._host):this._bucket=UL(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=aa.makeFromBucketSpec(this._url,e):this._bucket=UL(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){VL("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){VL("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(wi(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new C0(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new oue(qH());{const o=yue(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const HL="@firebase/storage",qL="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iq="storage";function Y3(n,e,t){return n=Sn(n),Hue(n,e,t)}function Uw(n){return n=Sn(n),que(n)}function Hw(n,e){return n=Sn(n),Yue(n,e)}function Jue(n=G0(),e){n=Sn(n);const r=hd(n,iq).getImmediate({identifier:e}),s=p7("storage");return s&&Que(r,...s),r}function Que(n,e,t,r={}){Xue(n,e,t,r)}function Zue(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new v8(t,r,s,e,q0)}function ede(){el(new ma(iq,Zue,"PUBLIC").setMultipleInstances(!0)),Si(HL,qL,""),Si(HL,qL,"esm2020")}ede();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tde="type.googleapis.com/google.protobuf.Int64Value",nde="type.googleapis.com/google.protobuf.UInt64Value";function oq(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function S_(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>S_(e));if(typeof n=="function"||typeof n=="object")return oq(n,e=>S_(e));throw new Error("Data cannot be encoded in JSON: "+n)}function C1(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case tde:case nde:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>C1(e)):typeof n=="function"||typeof n=="object"?oq(n,e=>C1(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w8="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GL={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Co extends xa{constructor(e,t,r){super(`${w8}/${e}`,t||""),this.details=r,Object.setPrototypeOf(this,Co.prototype)}}function rde(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function T_(n,e){let t=rde(n),r=t,s;try{const i=e&&e.error;if(i){const o=i.status;if(typeof o=="string"){if(!GL[o])return new Co("internal","internal");t=GL[o],r=o}const a=i.message;typeof a=="string"&&(r=a),s=i.details,s!==void 0&&(s=C1(s))}}catch{}return t==="ok"?null:new Co(t,r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sde{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,wi(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s==null||s.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6="us-central1",ide=/^data: (.*?)(?:\n|$)/;function ode(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Co("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class ade{constructor(e,t,r,s,i=O6,o=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new sde(e,t,r,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(i);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=O6}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function lde(n,e,t){const r=Uc(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(S3(n.emulatorOrigin+"/backends"),T3("Functions",!0))}function cde(n,e,t){const r=s=>dde(n,e,s,t||{});return r.stream=(s,i)=>fde(n,e,s,i),r}function aq(n){return n.emulatorOrigin&&Uc(n.emulatorOrigin)?"include":void 0}async function ude(n,e,t,r,s){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t,credentials:aq(s)})}catch{return{status:0,json:null}}let o=null;try{o=await i.json()}catch{}return{status:i.status,json:o}}async function lq(n,e){const t={},r=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(t.Authorization="Bearer "+r.authToken),r.messagingToken&&(t["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=r.appCheckToken),t}function dde(n,e,t,r){const s=n._url(e);return hde(n,s,t,r)}async function hde(n,e,t,r){t=S_(t);const s={data:t},i=await lq(n,r),o=r.timeout||7e4,a=ode(o),l=await Promise.race([ude(e,s,i,n.fetchImpl,n),a.promise,n.cancelAllRequests]);if(a.cancel(),!l)throw new Co("cancelled","Firebase Functions instance was deleted.");const c=T_(l.status,l.json);if(c)throw c;if(!l.json)throw new Co("internal","Response is not valid JSON object.");let u=l.json.data;if(typeof u>"u"&&(u=l.json.result),typeof u>"u")throw new Co("internal","Response is missing data field.");return{data:C1(u)}}function fde(n,e,t,r){const s=n._url(e);return pde(n,s,t,r||{})}async function pde(n,e,t,r){var f;t=S_(t);const s={data:t},i=await lq(n,r);i["Content-Type"]="application/json",i.Accept="text/event-stream";let o;try{o=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(s),headers:i,signal:r==null?void 0:r.signal,credentials:aq(n)})}catch(p){if(p instanceof Error&&p.name==="AbortError"){const y=new Co("cancelled","Request was cancelled.");return{data:Promise.reject(y),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(y)}}}}}}const g=T_(0,null);return{data:Promise.reject(g),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(g)}}}}}}let a,l;const c=new Promise((p,g)=>{a=p,l=g});(f=r==null?void 0:r.signal)==null||f.addEventListener("abort",()=>{const p=new Co("cancelled","Request was cancelled.");l(p)});const u=o.body.getReader(),h=mde(u,a,l,r==null?void 0:r.signal);return{stream:{[Symbol.asyncIterator](){const p=h.getReader();return{async next(){const{value:g,done:y}=await p.read();return{value:g,done:y}},async return(){return await p.cancel(),{done:!0,value:void 0}}}}},data:c}}function mde(n,e,t,r){const s=(o,a)=>{const l=o.match(ide);if(!l)return;const c=l[1];try{const u=JSON.parse(c);if("result"in u){e(C1(u.result));return}if("message"in u){a.enqueue(C1(u.message));return}if("error"in u){const h=T_(0,u);a.error(h),t(h);return}}catch(u){if(u instanceof Co){a.error(u),t(u);return}}},i=new TextDecoder;return new ReadableStream({start(o){let a="";return l();async function l(){if(r!=null&&r.aborted){const c=new Co("cancelled","Request was cancelled");return o.error(c),t(c),Promise.resolve()}try{const{value:c,done:u}=await n.read();if(u){a.trim()&&s(a.trim(),o),o.close();return}if(r!=null&&r.aborted){const f=new Co("cancelled","Request was cancelled");o.error(f),t(f),await n.cancel();return}a+=i.decode(c,{stream:!0});const h=a.split(`
`);a=h.pop()||"";for(const f of h)f.trim()&&s(f.trim(),o);return l()}catch(c){const u=c instanceof Co?c:T_(0,null);o.error(u),t(u)}}},cancel(){return n.cancel()}})}const WL="@firebase/functions",KL="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gde="auth-internal",yde="app-check-internal",xde="messaging-internal";function bde(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(gde),o=t.getProvider(xde),a=t.getProvider(yde);return new ade(s,i,o,a,r)};el(new ma(w8,e,"PUBLIC").setMultipleInstances(!0)),Si(WL,KL,n),Si(WL,KL,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A_(n=G0(),e=O6){const r=hd(Sn(n),w8).getImmediate({identifier:e}),s=p7("functions");return s&&vde(r,...s),r}function vde(n,e,t){lde(Sn(n),e,t)}function zc(n,e,t){return cde(Sn(n),e,t)}bde();const wde=(n,e)=>e.some(t=>n instanceof t);let YL,XL;function kde(){return YL||(YL=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _de(){return XL||(XL=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cq=new WeakMap,F6=new WeakMap,uq=new WeakMap,LT=new WeakMap,k8=new WeakMap;function Sde(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(qh(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&cq.set(t,n)}).catch(()=>{}),k8.set(e,n),e}function Tde(n){if(F6.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});F6.set(n,e)}let z6={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return F6.get(n);if(e==="objectStoreNames")return n.objectStoreNames||uq.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qh(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ade(n){z6=n(z6)}function Ede(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(DT(this),e,...t);return uq.set(r,e.sort?e.sort():[e]),qh(r)}:_de().includes(n)?function(...e){return n.apply(DT(this),e),qh(cq.get(this))}:function(...e){return qh(n.apply(DT(this),e))}}function Cde(n){return typeof n=="function"?Ede(n):(n instanceof IDBTransaction&&Tde(n),wde(n,kde())?new Proxy(n,z6):n)}function qh(n){if(n instanceof IDBRequest)return Sde(n);if(LT.has(n))return LT.get(n);const e=Cde(n);return e!==n&&(LT.set(n,e),k8.set(e,n)),e}const DT=n=>k8.get(n);function Nde(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=qh(o);return r&&o.addEventListener("upgradeneeded",l=>{r(qh(o.result),l.oldVersion,l.newVersion,qh(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Ide=["get","getKey","getAll","getAllKeys","count"],Rde=["put","add","delete","clear"],jT=new Map;function JL(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(jT.get(e))return jT.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Rde.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Ide.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return jT.set(e,i),i}Ade(n=>({...n,get:(e,t,r)=>JL(e,t)||n.get(e,t,r),has:(e,t)=>!!JL(e,t)||n.has(e,t)}));const dq="@firebase/installations",_8="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hq=1e4,fq=`w:${_8}`,pq="FIS_v2",Mde="https://firebaseinstallations.googleapis.com/v1",Pde=60*60*1e3,Lde="installations",Dde="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jde={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},N0=new H0(Lde,Dde,jde);function mq(n){return n instanceof xa&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gq({projectId:n}){return`${Mde}/projects/${n}/installations`}function yq(n){return{token:n.token,requestStatus:2,expiresIn:Fde(n.expiresIn),creationTime:Date.now()}}async function xq(n,e){const r=(await e.json()).error;return N0.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function bq({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Ode(n,{refreshToken:e}){const t=bq(n);return t.append("Authorization",zde(e)),t}async function vq(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Fde(n){return Number(n.replace("s","000"))}function zde(n){return`${pq} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bde({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=gq(n),s=bq(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:pq,appId:n.appId,sdkVersion:fq},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await vq(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:yq(c.authToken)}}else throw await xq("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wq(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $de(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vde=/^[cdef][\w-]{21}$/,B6="";function Ude(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Hde(n);return Vde.test(t)?t:B6}catch{return B6}}function Hde(n){return $de(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X3(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kq=new Map;function _q(n,e){const t=X3(n);Sq(t,e),qde(t,e)}function Sq(n,e){const t=kq.get(n);if(t)for(const r of t)r(e)}function qde(n,e){const t=Gde();t&&t.postMessage({key:n,fid:e}),Wde()}let Zf=null;function Gde(){return!Zf&&"BroadcastChannel"in self&&(Zf=new BroadcastChannel("[Firebase] FID Change"),Zf.onmessage=n=>{Sq(n.data.key,n.data.fid)}),Zf}function Wde(){kq.size===0&&Zf&&(Zf.close(),Zf=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kde="firebase-installations-database",Yde=1,I0="firebase-installations-store";let OT=null;function S8(){return OT||(OT=Nde(Kde,Yde,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(I0)}}})),OT}async function E_(n,e){const t=X3(n),s=(await S8()).transaction(I0,"readwrite"),i=s.objectStore(I0),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&_q(n,e.fid),e}async function Tq(n){const e=X3(n),r=(await S8()).transaction(I0,"readwrite");await r.objectStore(I0).delete(e),await r.done}async function J3(n,e){const t=X3(n),s=(await S8()).transaction(I0,"readwrite"),i=s.objectStore(I0),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&_q(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T8(n){let e;const t=await J3(n.appConfig,r=>{const s=Xde(r),i=Jde(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===B6?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Xde(n){const e=n||{fid:Ude(),registrationStatus:0};return Aq(e)}function Jde(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(N0.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Qde(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Zde(n)}:{installationEntry:e}}async function Qde(n,e){try{const t=await Bde(n,e);return E_(n.appConfig,t)}catch(t){throw mq(t)&&t.customData.serverCode===409?await Tq(n.appConfig):await E_(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Zde(n){let e=await QL(n.appConfig);for(;e.registrationStatus===1;)await wq(100),e=await QL(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await T8(n);return r||t}return e}function QL(n){return J3(n,e=>{if(!e)throw N0.create("installation-not-found");return Aq(e)})}function Aq(n){return ehe(n)?{fid:n.fid,registrationStatus:0}:n}function ehe(n){return n.registrationStatus===1&&n.registrationTime+hq<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function the({appConfig:n,heartbeatServiceProvider:e},t){const r=nhe(n,t),s=Ode(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:fq,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await vq(()=>fetch(r,a));if(l.ok){const c=await l.json();return yq(c)}else throw await xq("Generate Auth Token",l)}function nhe(n,{fid:e}){return`${gq(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A8(n,e=!1){let t;const r=await J3(n.appConfig,i=>{if(!Eq(i))throw N0.create("not-registered");const o=i.authToken;if(!e&&ihe(o))return i;if(o.requestStatus===1)return t=rhe(n,e),i;{if(!navigator.onLine)throw N0.create("app-offline");const a=ahe(i);return t=she(n,a),a}});return t?await t:r.authToken}async function rhe(n,e){let t=await ZL(n.appConfig);for(;t.authToken.requestStatus===1;)await wq(100),t=await ZL(n.appConfig);const r=t.authToken;return r.requestStatus===0?A8(n,e):r}function ZL(n){return J3(n,e=>{if(!Eq(e))throw N0.create("not-registered");const t=e.authToken;return lhe(t)?{...e,authToken:{requestStatus:0}}:e})}async function she(n,e){try{const t=await the(n,e),r={...e,authToken:t};return await E_(n.appConfig,r),t}catch(t){if(mq(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Tq(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await E_(n.appConfig,r)}throw t}}function Eq(n){return n!==void 0&&n.registrationStatus===2}function ihe(n){return n.requestStatus===2&&!ohe(n)}function ohe(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Pde}function ahe(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function lhe(n){return n.requestStatus===1&&n.requestTime+hq<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function che(n){const e=n,{installationEntry:t,registrationPromise:r}=await T8(e);return r?r.catch(console.error):A8(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uhe(n,e=!1){const t=n;return await dhe(t),(await A8(t,e)).token}async function dhe(n){const{registrationPromise:e}=await T8(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hhe(n){if(!n||!n.options)throw FT("App Configuration");if(!n.name)throw FT("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw FT(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function FT(n){return N0.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cq="installations",fhe="installations-internal",phe=n=>{const e=n.getProvider("app").getImmediate(),t=hhe(e),r=hd(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},mhe=n=>{const e=n.getProvider("app").getImmediate(),t=hd(e,Cq).getImmediate();return{getId:()=>che(t),getToken:s=>uhe(t,s)}};function ghe(){el(new ma(Cq,phe,"PUBLIC")),el(new ma(fhe,mhe,"PRIVATE"))}ghe();Si(dq,_8);Si(dq,_8,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_="analytics",yhe="firebase_id",xhe="origin",bhe=60*1e3,vhe="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",E8="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ji=new A3("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const whe={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},ca=new H0("analytics","Analytics",whe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function khe(n){if(!n.startsWith(E8)){const e=ca.create("invalid-gtag-resource",{gtagURL:n});return Ji.warn(e.message),""}return n}function Nq(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function _he(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function She(n,e){const t=_he("firebase-js-sdk-policy",{createScriptURL:khe}),r=document.createElement("script"),s=`${E8}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function The(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Ahe(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await Nq(t)).find(c=>c.measurementId===s);l&&await e[l.appId]}}catch(a){Ji.error(a)}n("config",s,i)}async function Ehe(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await Nq(t);for(const l of o){const c=a.find(h=>h.measurementId===l),u=c&&e[c.appId];if(u)i.push(u);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Ji.error(i)}}function Che(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await Ehe(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await Ahe(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,c]=o;n("get",a,l,c)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Ji.error(a)}}return s}function Nhe(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=Che(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function Ihe(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(E8)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rhe=30,Mhe=1e3;class Phe{constructor(e={},t=Mhe){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Iq=new Phe;function Lhe(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function Dhe(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:Lhe(t)},s=vhe.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw ca.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function jhe(n,e=Iq,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw ca.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw ca.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new zhe;return setTimeout(async()=>{a.abort()},bhe),Rq({appId:r,apiKey:s,measurementId:i},o,a,e)}async function Rq(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=Iq){var a;const{appId:i,measurementId:o}=n;try{await Ohe(r,e)}catch(l){if(o)return Ji.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await Dhe(n);return s.deleteThrottleMetadata(i),l}catch(l){const c=l;if(!Fhe(c)){if(s.deleteThrottleMetadata(i),o)return Ji.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw l}const u=Number((a=c==null?void 0:c.customData)==null?void 0:a.httpStatus)===503?hP(t,s.intervalMillis,Rhe):hP(t,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:t+1};return s.setThrottleMetadata(i,h),Ji.debug(`Calling attemptFetch again in ${u} millis`),Rq(n,h,r,s)}}function Ohe(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(ca.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Fhe(n){if(!(n instanceof xa)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class zhe{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Bhe(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}async function $he(n,e,t,r){if(r&&r.global){const s={};for(const i of Object.keys(t))s[`user_properties.${i}`]=t[i];return n("set",s),Promise.resolve()}else{const s=await e;n("config",s,{update:!0,user_properties:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vhe(){if(g7())try{await y7()}catch(n){return Ji.warn(ca.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Ji.warn(ca.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Uhe(n,e,t,r,s,i,o){const a=jhe(n);a.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&Ji.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Ji.error(f)),e.push(a);const l=Vhe().then(f=>{if(f)return r.getId()}),[c,u]=await Promise.all([a,l]);Ihe(i)||She(i,c.measurementId),s("js",new Date);const h=(o==null?void 0:o.config)??{};return h[xhe]="firebase",h.update=!0,u!=null&&(h[yhe]=u),s("config",c.measurementId,h),c.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hhe{constructor(e){this.app=e}_delete(){return delete tg[this.app.options.appId],Promise.resolve()}}let tg={},eD=[];const tD={};let zT="dataLayer",qhe="gtag",nD,C8,rD=!1;function Ghe(){const n=[];if(m7()&&n.push("This is a browser extension environment."),AV()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=ca.create("invalid-analytics-context",{errorInfo:e});Ji.warn(t.message)}}function Whe(n,e,t){Ghe();const r=n.options.appId;if(!r)throw ca.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ji.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ca.create("no-api-key");if(tg[r]!=null)throw ca.create("already-exists",{id:r});if(!rD){The(zT);const{wrappedGtag:i,gtagCore:o}=Nhe(tg,eD,tD,zT,qhe);C8=i,nD=o,rD=!0}return tg[r]=Uhe(n,eD,tD,e,nD,zT,t),new Hhe(n)}function Khe(n=G0()){n=Sn(n);const e=hd(n,C_);return e.isInitialized()?e.getImmediate():Yhe(n)}function Yhe(n,e={}){const t=hd(n,C_);if(t.isInitialized()){const s=t.getImmediate();if(Zh(e,t.getOptions()))return s;throw ca.create("already-initialized")}return t.initialize({options:e})}async function Xhe(){if(m7()||!AV()||!g7())return!1;try{return await y7()}catch{return!1}}function Jhe(n,e,t){n=Sn(n),$he(C8,tg[n.app.options.appId],e,t).catch(r=>Ji.error(r))}function gd(n,e,t,r){n=Sn(n),Bhe(C8,tg[n.app.options.appId],e,t,r).catch(s=>Ji.error(s))}const sD="@firebase/analytics",iD="0.10.19";function Qhe(){el(new ma(C_,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Whe(r,s,t)},"PUBLIC")),el(new ma("analytics-internal",n,"PRIVATE")),Si(sD,iD),Si(sD,iD,"esm2020");function n(e){try{const t=e.getProvider(C_).getImmediate();return{logEvent:(r,s,i)=>gd(t,r,s,i),setUserProperties:(r,s)=>Jhe(t,r,s)}}catch(t){throw ca.create("interop-component-reg-failed",{reason:t})}}}Qhe();const Zhe={apiKey:"AIzaSyDpydu7ZwtyWzVO0oxHgdC5w04tBXuwgGA",authDomain:"ai-lms-pro.firebaseapp.com",projectId:"ai-lms-pro",storageBucket:"ai-lms-pro.firebasestorage.app",messagingSenderId:"479417566126",appId:"1:479417566126:web:c40e64e9ee2f403b70be3f",measurementId:"G-52ME59SEG7"},qw=NV(Zhe),Kt=QU(qw),jc=D6(qw),Gw=Jue(qw),af=A_(qw);let ni=null;typeof window<"u"&&Xhe().then(n=>{n&&(ni=Khe(qw),console.log(" Firebase Analytics initialized"))}).catch(()=>{console.log(" Firebase Analytics not supported in this environment")});const Mq=V.createContext(void 0),oD=({children:n})=>{const[e,t]=V.useState(null),[r,s]=V.useState(!0),[i,o]=V.useState(!1),[a,l]=V.useState(null),[c,u]=V.useState(null),[h,f]=V.useState(null),[p,g]=V.useState(null),y=async()=>{if(!e){f(null);return}try{const k=await zc(af,"getMyUsageStats")();f(k.data)}catch(w){console.warn("Failed to fetch usage stats:",w),f({tier:"free",status:"active",usage:{textTokens:{used:0,limit:5e4,percent:0},images:{used:0,limit:10,percent:0},audio:{used:0,limit:10,percent:0},podcasts:{used:0,limit:2,percent:0}},features:{lessonGeneration:!0,examGeneration:!0,imageGeneration:!0,podcastGeneration:!0,mindMapGeneration:!0,knowledgeBase:!1,advancedAnalytics:!1},resetDate:new Date(new Date().getFullYear(),new Date().getMonth()+1,1).toISOString()})}};V.useEffect(()=>(console.log(" AuthProvider:   ..."),Ple(jc,async k=>{var T;if(console.log(" AuthProvider:   :",k?" ("+(k.email||"Anonymous")+")":""),k&&k.isAnonymous){const R=Object.create(k);Object.defineProperty(R,"email",{value:"dev@test.com"}),Object.defineProperty(R,"displayName",{value:"Wizdi Developer (Anon)"}),t(R),o(!1),l(null),u("teacher")}else if(t(k),k)try{const M=(await Ka(or(Kt,"users",k.uid))).data(),E=((T=M==null?void 0:M.roles)==null?void 0:T.includes("admin"))||(M==null?void 0:M.isAdmin)===!0;o(E),l((M==null?void 0:M.institutionId)||null),u((M==null?void 0:M.role)||"teacher"),console.log(" Admin status:",E,"| Institution:",(M==null?void 0:M.institutionId)||"none")}catch(R){console.warn("Failed to check admin status:",R),o(!1),l(null),u(null)}else o(!1),l(null),u(null),f(null);s(!1)})),[]),V.useEffect(()=>{e&&!e.isAnonymous&&y()},[e]),console.log(" AuthProvider Render: Loading =",r,"| User =",e==null?void 0:e.email);const v=async()=>{console.log(" Dev Login Activated (Anonymous Auth)");try{await Sle(jc)}catch(w){console.error("Dev Login Failed:",w),alert("   ")}},b=async()=>{const w=new Nl;w.addScope("https://www.googleapis.com/auth/classroom.courses.readonly"),w.addScope("https://www.googleapis.com/auth/classroom.coursework.students"),w.addScope("https://www.googleapis.com/auth/classroom.rosters.readonly");try{w.setCustomParameters({prompt:"select_account"});const k=await $H(jc,w),T=Nl.credentialFromResult(k),R=T==null?void 0:T.accessToken;R&&(g(R),console.log(" Google Classroom Token Acquired"))}catch(k){console.error(" Failed to connect to Classroom:",k),alert("   .   .")}};return d.jsx(Mq.Provider,{value:{currentUser:e,loading:r,isAdmin:i,institutionId:a,userRole:c,usageStats:h,refreshUsageStats:y,mockLogin:v,googleClassroomToken:p,connectClassroom:b},children:n})},kf=()=>{const n=V.useContext(Mq);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},efe=()=>{const{mockLogin:n}=kf(),[e,t]=V.useState(!1),[r,s]=V.useState(""),[i,o]=V.useState(""),[a,l]=V.useState(""),[c,u]=V.useState(!1),h=async()=>{const p=new Nl;try{await $H(jc,p)}catch(g){console.error("Login failed:",g),alert(" .   .")}},f=async p=>{p.preventDefault(),l(""),u(!0);try{await Ile(jc,r,i)}catch(g){console.error("Email login failed:",g),g.code==="auth/user-not-found"?l("  "):g.code==="auth/wrong-password"?l(" "):g.code==="auth/invalid-email"?l("   "):l(" .  .")}finally{u(!1)}};return d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",dir:"rtl",children:d.jsxs("div",{className:"bg-white p-10 rounded-2xl shadow-xl text-center max-w-md w-full border border-gray-200",children:[d.jsx("h1",{className:"text-4xl mb-2",children:""}),d.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"  -AI-LMS"}),d.jsx("p",{className:"text-gray-500 mb-8",children:"    "}),d.jsxs("button",{onClick:h,className:"w-full py-3 px-4 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition-all flex items-center justify-center gap-3 font-bold text-gray-700",children:[d.jsx("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"Google",className:"w-6 h-6",loading:"eager",decoding:"async"}),"  Google"]}),d.jsxs("div",{className:"mt-6",children:[d.jsx("button",{onClick:()=>t(!e),className:"text-sm text-blue-600 hover:text-blue-800 underline",children:e?"":"   "}),e&&d.jsxs("form",{onSubmit:f,className:"mt-4 space-y-3",children:[d.jsx("input",{type:"email",placeholder:"",value:r,onChange:p=>s(p.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",required:!0}),d.jsx("input",{type:"password",placeholder:"",value:i,onChange:p=>o(p.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",required:!0}),a&&d.jsx("p",{className:"text-red-500 text-sm",children:a}),d.jsx("button",{type:"submit",disabled:c,className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-bold disabled:opacity-50",children:c?"...":""})]})]}),!1]})})},zs=[];for(let n=0;n<256;++n)zs.push((n+256).toString(16).slice(1));function tfe(n,e=0){return(zs[n[e+0]]+zs[n[e+1]]+zs[n[e+2]]+zs[n[e+3]]+"-"+zs[n[e+4]]+zs[n[e+5]]+"-"+zs[n[e+6]]+zs[n[e+7]]+"-"+zs[n[e+8]]+zs[n[e+9]]+"-"+zs[n[e+10]]+zs[n[e+11]]+zs[n[e+12]]+zs[n[e+13]]+zs[n[e+14]]+zs[n[e+15]]).toLowerCase()}let BT;const nfe=new Uint8Array(16);function rfe(){if(!BT){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");BT=crypto.getRandomValues.bind(crypto)}return BT(nfe)}const sfe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),aD={randomUUID:sfe};function ife(n,e,t){var s;n=n||{};const r=n.random??((s=n.rng)==null?void 0:s.call(n))??rfe();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tfe(r)}function cn(n,e,t){return aD.randomUUID&&!n?aD.randomUUID():ife(n)}const N8="users",N1={xp:0,level:1,currentStreak:0,lastActivityDate:new Date().toISOString(),frozenDays:0,gems:0,leagueTier:"BRONZE",leagueWeeklyXp:0,unlockedThemes:["default"],equippedTheme:"default"},ofe=()=>({...N1}),afe=(n,e,t)=>{const r=[],s={...n};s.xp+=e,s.leagueWeeklyXp=(s.leagueWeeklyXp||0)+e;const i=Pq(s.xp);return i>s.level&&(s.level=i,s.gems=(s.gems||0)+50,r.push("LEVEL_UP")),{newProfile:s,events:r}},Pq=n=>Math.floor(Math.sqrt(Math.max(0,n)/100))+1,lD=async(n,e,t)=>{if(!n)return null;const r=or(Kt,N8,n);try{const s=await Ka(r);let i;if(s.exists()){const a=s.data();i={...N1,...a.gamification||{}}}else i={...N1};i.xp=(i.xp||0)+e,i.gems=(i.gems||0)+t,i.leagueWeeklyXp=(i.leagueWeeklyXp||0)+e;const o=Pq(i.xp);return o>i.level&&(i.level=o,i.gems+=50),i.lastActivityDate=new Date().toISOString(),await Pc(r,{gamification:i},{merge:!0}),i}catch(s){return console.error("Error syncing gamification progress:",s),null}},lfe=async n=>{if(!n)return{currentStreak:0,frozenDays:0,status:"reset"};const e=or(Kt,N8,n);try{const t=await Ka(e);if(!t.exists())return{currentStreak:0,frozenDays:0,status:"reset"};const r=t.data(),s={...N1,...r.gamification||{}},i=new Date(s.lastActivityDate),o=new Date,a=new Date(i);a.setHours(0,0,0,0);const l=new Date(o);l.setHours(0,0,0,0);const c=Math.abs(l.getTime()-a.getTime()),u=Math.ceil(c/(1e3*60*60*24));let h="maintained";if(u===0)return{currentStreak:s.currentStreak,frozenDays:s.frozenDays,status:"maintained"};if(u!==1){const f=u-1;s.frozenDays>=f?(s.frozenDays-=f,h="frozen_used"):(s.currentStreak=0,h="reset")}return h!=="maintained"&&await Tb(e,{"gamification.currentStreak":s.currentStreak,"gamification.frozenDays":s.frozenDays}),{currentStreak:s.currentStreak,frozenDays:s.frozenDays,status:h}}catch(t){return console.error("Error checking streak:",t),{currentStreak:0,frozenDays:0,status:"reset"}}},cfe=async n=>{const t=or(Kt,N8,n);try{const r=await Ka(t);if(!r.exists())return{success:!1,message:"User not found"};const s=r.data(),i={...N1,...s.gamification||{}};return i.gems<50?{success:!1,message:"  "}:(await Tb(t,{"gamification.gems":y_(-50),"gamification.frozenDays":y_(1)}),{success:!0,message:"   !",newBalance:i.gems-50})}catch(r){return console.error("Error purchasing item:",r),{success:!1,message:" "}}},ufe=2e3,cD={id:"loading",teacherId:"",title:"...",targetAudience:"",syllabus:[]},Lq=V.createContext(void 0),dfe=(n,e)=>{var i,o;const t=n.course?n.course:n,s=(Array.isArray(t.syllabus)?t.syllabus:[]).map(a=>{const l=a.id||cn(),u=(Array.isArray(a.learningUnits)?a.learningUnits:[]).filter(h=>h!=null).map(h=>{const f=h.id||cn(),g=(Array.isArray(h.activityBlocks)?h.activityBlocks:[]).filter(y=>y!=null).map(y=>({...y,id:y.id||cn()}));return{...h,id:f,activityBlocks:g}});return{...a,id:l,learningUnits:u}});return{id:e,teacherId:t.teacherId||"",title:t.title||" ",targetAudience:t.targetAudience||"",syllabus:s,mode:t.mode||((o=(i=t.wizardData)==null?void 0:i.settings)==null?void 0:o.courseMode)||"learning",wizardData:t.wizardData||null,subject:t.subject||"",gradeLevel:t.gradeLevel||"",fullBookContent:t.fullBookContent||"",showSourceToStudent:t.showSourceToStudent??!0,pdfSource:t.pdfSource||null,createdAt:t.createdAt||null}},hfe=({children:n})=>{const{currentUser:e}=kf(),[t,r]=V.useState(cD),[s,i]=V.useState(""),[o,a]=V.useState(null),[l,c]=V.useState(null),[u,h]=V.useState(null),f=V.useRef(null),p=V.useRef(null),g=V.useRef(t),y=V.useRef(s),v=V.useRef(o);g.current=t,y.current=s,v.current=o,V.useEffect(()=>{if(!e){h(null);return}const N=or(Kt,`users/${e.uid}/profile/gamification`),P=Ab(N,O=>{if(O.exists())h(O.data());else{const D=ofe();Pc(N,D)}});return()=>P()},[e]);const b=nt.useCallback(async(N,P)=>{if(!e||!u)return;const{newProfile:O}=afe(u,N);try{const D=or(Kt,`users/${e.uid}/profile/gamification`);await Pc(D,O,{merge:!0})}catch(D){console.error("Failed to update gamification profile:",D)}},[e,u]),w=nt.useCallback(N=>{console.log("[CourseContext] loadCourse called with id:",N),c(N)},[]);V.useEffect(()=>{if(!l){console.log("[CourseContext] No currentCourseId, skipping load");return}console.log("[CourseContext] Setting up onSnapshot for courseId:",l);const N=Ab(or(Kt,"courses",l),async P=>{var O;if(console.log("[CourseContext] onSnapshot callback - exists:",P.exists()),P.exists()){const D=P.data();if((O=D.syllabus)==null?void 0:O.some(J=>{var Q;return(Q=J.learningUnits)==null?void 0:Q.some(re=>re.isLazy)})){const J=Zs(Kt,"courses",l,"units"),Q=await Hh(J),re=new Map;Q.forEach(ne=>{re.set(ne.id,ne.data())}),D.syllabus=D.syllabus.map(ne=>({...ne,learningUnits:ne.learningUnits.map(te=>te.isLazy&&re.has(te.id)?re.get(te.id):te)}))}if(P.id===l){const J=dfe(D,P.id);r(Q=>JSON.stringify(Q)===JSON.stringify(J)?Q:(console.log("CourseContext: Data changed, updating state"),J))}i(D.fullBookContent||""),a(D.pdfSource||null)}else{console.warn(`   (${l})     .`);const D=new URL(window.location.href);if(D.searchParams.has("studentCourseId")){D.searchParams.delete("studentCourseId"),window.location.href=D.toString();return}c(null),r(cD)}},P=>{console.error("Error fetching course:",P),c(null)});return()=>N()},[l]);const k=nt.useCallback((N,P,O)=>{l&&(p.current={course:N,bookContent:P,pdf:O},f.current&&clearTimeout(f.current),f.current=setTimeout(async()=>{const D=p.current;if(D){try{const{id:G,...J}=D.course,Q=JSON.parse(JSON.stringify(J));await Pc(or(Kt,"courses",l),{...Q,fullBookContent:D.bookContent,pdfSource:D.pdf,lastUpdated:new Date},{merge:!0}),console.log(" Course saved to Firestore (debounced)")}catch(G){console.error("Error saving:",G)}p.current=null}},ufe))},[l]);V.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const T=nt.useCallback(N=>{r(P=>{const O=typeof N=="function"?N(P):N;return k(O,y.current,v.current),O})},[k]),R=nt.useCallback(N=>{i(N),k(g.current,N,v.current)},[k]),M=nt.useCallback(N=>{a(N),k(g.current,y.current,N)},[k]),E=nt.useCallback(N=>{r(P=>{const O={...P,title:N};return k(O,y.current,v.current),O})},[k]),I=nt.useCallback((N,P)=>{r(O=>{const D={...O};return D.syllabus=D.syllabus.map(G=>G.id!==N?G:{...G,learningUnits:G.learningUnits.map(J=>J.id===P.id?P:J)}),k(D,y.current,v.current),D})},[k]),S=nt.useMemo(()=>({course:t,fullBookContent:s,pdfSource:o,currentCourseId:l,gamificationProfile:u,triggerXp:b,loadCourse:w,setCourse:T,setFullBookContent:R,setPdfSource:M,updateCourseTitle:E,updateLearningUnit:I}),[t,s,o,l,u,b,w,T,R,M,E,I]);return d.jsx(Lq.Provider,{value:S,children:n})},I8=()=>{const n=V.useContext(Lq);if(!n)throw new Error("useCourseStore must be used within a CourseProvider");return n},ffe=`
###  EXAM MODE PROTOCOL (STRICT ENFORCEMENT) 
You are now operating in 'Assessment Mode'. Your goal is to TEST, not to TEACH.

### MANDATORY CONSTRAINTS:
1. **NO TEACHING CONTENT:**
   - The field 'teach_content' MUST be null or an empty string "".
   - Do NOT provide introductory text, explanations, or "refreshers".
   - The user is here to be tested on what they already know.

2. **NO HINTS (ZERO TOLERANCE):**
   - The array 'progressive_hints' MUST be empty [].
   - Do NOT include 'source_reference_hint' unless specifically asked for a reading comprehension task.

3. **TONE:**
   - Strict, Objective, Neutral.
   - NO "Good job!", "Let's think about this...", or "Remember that...".
   - Use the tone of a state examiner.
   
4. **CONTENT:**
   - Pure assessment items only.
   - For 'open_question', provide a detailed marking rubric in 'model_answer', but DO NOT scaffold the answer for the student.

IF YOU VIOLATE THESE RULES, THE EXAM INTEGRITY IS COMPROMISED.
`,Ui={CORRECT_FIRST_TRY:100,HINT_PENALTY:2,RETRY_PARTIAL:50,MAX_ATTEMPTS:3},d7e={CORRECT:100,PARTIAL:50,INCORRECT:0},uD={multiple_choice:5,"multiple-choice":5,true_false:5,"true-false":5,fill_in_blanks:7,"fill-in-blanks":7,cloze:7,memory_game:8,"memory-game":8,ordering:10,categorization:10,open_question:15,"open-question":15,audio_response:10,"audio-response":10,matching:8,highlight:6,sentence_builder:8,image_labeling:10,table_completion:10,text_selection:7,rating_scale:5,matrix:10},dD={Remember:1,Understand:1.2,Apply:1.5,Analyze:1.7,Evaluate:2,Create:2.2,:1,:1.2,:1.5,:1.7,:2,:2.2,Knowledge:1,Comprehension:1.2,Application:1.5,Analysis:1.7,Synthesis:2,Evaluation:2},hD={multiple_choice:"Remember","multiple-choice":"Remember",true_false:"Remember","true-false":"Remember",fill_in_blanks:"Understand","fill-in-blanks":"Understand",cloze:"Understand",memory_game:"Remember","memory-game":"Remember",ordering:"Apply",categorization:"Apply",open_question:"Analyze","open-question":"Analyze",audio_response:"Apply","audio-response":"Apply",matching:"Understand",highlight:"Understand",sentence_builder:"Apply",image_labeling:"Apply",table_completion:"Apply",text_selection:"Analyze",rating_scale:"Evaluate",matrix:"Understand"},ks=(n,e)=>{const t=n.toLowerCase().replace(/-/g,"_"),r=uD[t]??uD[n]??10;let s=e;(!s||!dD[s])&&(s=hD[t]??hD[n]??"Remember");const i=dD[s]??1;return Math.round(r*i)},Ww=n=>n.isCorrect?n.attempts===1?n.hintsUsed>0?Math.max(0,Ui.CORRECT_FIRST_TRY-n.hintsUsed*Ui.HINT_PENALTY):Ui.CORRECT_FIRST_TRY:Ui.RETRY_PARTIAL:0,ty=n=>{try{let e=n.replace(/```json|```/g,"").trim();const t=e.indexOf("{"),r=e.indexOf("[");let s=-1,i=-1;return r!==-1&&(t===-1||r<t)?(s=r,i=e.lastIndexOf("]")+1):t!==-1&&(s=t,i=e.lastIndexOf("}")+1),s!==-1&&i!==-1&&(e=e.substring(s,i)),e=e.replace(/}\s*{/g,"}, {"),e}catch(e){return console.error("JSON cleaning failed, returning original:",e),n}},fD=n=>{var u,h,f;if(!n)return console.warn("mapSystemItemToBlock received null item"),null;console.log(" mapSystemItemToBlock - Input:",JSON.stringify(n,null,2));const e=n.interaction||((u=n.data)==null?void 0:u.interaction);let t;if(e&&typeof e=="object"){const p=n.data&&typeof n.data=="object"?n.data:{};t={...n,...p,...e},console.log(" Found nested interaction object, merging data. Keys:",Object.keys(t))}else t=((h=n.data)==null?void 0:h.data)||n.data||n.interactive_question||n,console.log(" Using standard data path. Keys:",Object.keys(t));let r=(e==null?void 0:e.type)||n.suggested_interaction_type||n.selected_interaction||n.type||t.type||"multiple_choice";r=r.replace(/-/g,"_"),console.log(" Detected type:",r,"rawData keys:",Object.keys(t));const s=t.question||n.question;let i;typeof s=="object"&&s!==null?i=s.text||s.question||s.instruction:typeof s=="string"&&(i=s),i||(i=t.question_text||t.text||t.instruction||n.text||n.instruction),(!i||i.trim()==="")&&(console.warn(" mapSystemItemToBlock: No question text found, using placeholder"),i="  ");const o=["","",""],a=n.learning_level||t.learning_level||((f=n.data)==null?void 0:f.learning_level),l=o.includes(a)?a:void 0,c={bloomLevel:n.bloom_level||"  ",feedbackCorrect:t.feedback_correct||t.feedback||" !    .",feedbackIncorrect:t.feedback_incorrect||" .       .",sourceReference:t.source_reference||t.source_reference_hint||null,...l&&{learningLevel:l}};if(r==="multiple_choice"||r==="true_false"||r==="true_false_speed"||r==="teach_then_ask"){console.log(" Handling as MULTIPLE CHOICE");let p=[];Array.isArray(t.options)?p=t.options:Array.isArray(n.options)?p=n.options:Array.isArray(t.choices)?p=t.choices:Array.isArray(t.answers)&&(p=t.answers);const g=p.map(w=>typeof w=="string"?w:w.text||w.label||"");if(g.length<2)if(r==="true_false"||r==="true_false_speed")g.push(""," ");else return console.warn("Invalid options detected for MC, returning null to force retry/skip"),null;let y="";const v=p.find(w=>typeof w=="object"&&(w.is_correct||w.isCorrect===!0));if(v?y=v.text||v.label||"":t.correct_answer&&typeof t.correct_answer=="string"?y=t.correct_answer:t.correct_index!==void 0&&g[t.correct_index]?y=g[t.correct_index]:y=g[0],!g.includes(y)){console.warn(`correctAnswer "${y}" not found in options. Attempting fuzzy match...`);const w=y.toLowerCase().trim(),k=g.find(T=>T.toLowerCase().trim()===w||T.toLowerCase().includes(w)||w.includes(T.toLowerCase()));k?y=k:(console.warn(`No match found. Defaulting to first option: "${g[0]}"`),y=g[0])}return{id:cn(),type:"multiple-choice",content:{question:i,options:g,correctAnswer:y},metadata:{...c,score:ks(r,c.bloomLevel),progressiveHints:t.progressive_hints||[],richOptions:p.some(w=>typeof w=="object")?p:void 0}}}if(r==="open_question"||r==="open_ended"){console.log(" Handling as OPEN QUESTION");let p;const g=t.model_answer||t.teacher_guidelines||t.answer_key;return Array.isArray(g)?(p=g.map(y=>typeof y=="string"?y:y.text||y.point||JSON.stringify(y)).filter(Boolean).join(`
- `),p&&(p="- "+p)):typeof g=="object"&&g!==null?p=g.text||g.answer||g.content||JSON.stringify(g):typeof g=="string"?p=g:p="   .",{id:cn(),type:"open-question",content:{question:i},metadata:{...c,modelAnswer:p,score:ks("open_question",c.bloomLevel)}}}if(r==="ordering"||r==="sequencing"){console.log(" Handling as ORDERING");const g=(t.items||t.steps||t.correct_order||[]).map(y=>typeof y=="string"?y:y.text||y.step||y.content||y.description||JSON.stringify(y));if(g.length<2)if(console.warn("Ordering items missing or too few. Attempting auto-repair from text."),i&&i.length>20){let y=i.split(`
`).map(v=>v.trim()).filter(v=>v.length>0);if(y.length<2&&(y=i.split(".").map(v=>v.trim()).filter(v=>v.length>5)),y.length>=2)g.push(...y);else return null}else return null;return{id:cn(),type:"ordering",content:{instruction:i!=="  "?i:"   :",correct_order:g},metadata:{...c,score:ks("ordering",c.bloomLevel)}}}if(r==="matching"&&(t.leftItems||t.left_items)){console.log(" Handling as MATCHING (line drawing - early check)");const p=t.leftItems||t.left_items||[],g=t.rightItems||t.right_items||[],y=t.correctMatches||t.correct_matches||[];return{id:cn(),type:"matching",content:{instruction:i||t.instruction||"  :",leftItems:p.length>0?p:[{id:"1",text:" 1"}],rightItems:g.length>0?g:[{id:"a",text:" 1"}],correctMatches:y,hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("matching",c.bloomLevel)}}}if(r==="categorization"||r==="grouping"||r==="matching"&&t.pairs){console.log(" Handling as CATEGORIZATION");let p=[],g=[];if(r==="matching"||t.pairs){const y=t.pairs||[],v=new Set;y.forEach(b=>v.add(b.right||b.category||"")),p=Array.from(v).filter(Boolean),g=y.map(b=>({text:b.left||b.item||"",category:b.right||b.category||""}))}else{const y=t.groups||t.categories||[" 1"," 2"],v={};p=y.map(w=>typeof w=="string"?w:typeof w=="object"&&w.label?(w.id&&(v[w.id]=w.label),w.label):String(w)),g=(t.items||[]).map(w=>{if(typeof w=="object"&&w.category_id){const k=w.text||w.content||JSON.stringify(w),T=v[w.category_id]||w.category_id;return{text:k,category:T}}return typeof w=="object"&&w.category?{text:w.text||w.content||JSON.stringify(w),category:w.category}:typeof w=="object"&&w.group_index!==void 0&&p[w.group_index]?{text:w.text||w.content||"",category:p[w.group_index]}:typeof w=="object"&&w.group?{text:w.text||JSON.stringify(w),category:w.group}:{text:typeof w=="string"?w:w.text||JSON.stringify(w),category:p[0]||""}})}if(g.length===0){console.warn("Categorization items missing. Attempting to parse from text.");const y=i?i.match(/[-*]\s?(.+)/g):null;if(y&&y.length>=2&&y.forEach(v=>{const b=v.replace(/[-*]\s?/,"").trim();b&&g.push({text:b,category:p[0]||"General"})}),g.length===0)return null}return{id:cn(),type:"categorization",content:{question:i!=="  "?i:"   :",categories:p,items:g},metadata:{...c,score:ks("categorization",c.bloomLevel)}}}if(r==="fill_in_blanks"||r==="cloze"){console.log(" Handling as FILL IN BLANKS");const p=t.text||t.content||t.sentence||i||"  ";let g=t.word_bank||t.options||[];return{id:cn(),type:"fill_in_blanks",content:{sentence:p},metadata:{...c,score:ks("fill_in_blanks",c.bloomLevel),wordBank:g}}}if(r==="audio_response"||r==="oral_answer"||r==="record_answer")return{id:cn(),type:"audio-response",content:{question:i||"  :",description:t.description||"     .",maxDuration:t.max_duration||60},metadata:{...c,score:ks("audio_response",c.bloomLevel)}};if(r==="memory_game"||r==="memory"||r==="matching_pairs"){console.log(" Handling as MEMORY GAME");const p=t.pairs||t.cards||[];console.log(" Memory game pairs found:",p.length,p);const g=[];return Array.isArray(p)&&p.forEach(y=>{y.card_a&&y.card_b?g.push({card_a:y.card_a,card_b:y.card_b}):y.card1&&y.card2?g.push({card_a:y.card1,card_b:y.card2}):y.left&&y.right?g.push({card_a:y.left,card_b:y.right}):y.term&&y.definition?g.push({card_a:y.term,card_b:y.definition}):y.concept&&y.meaning?g.push({card_a:y.concept,card_b:y.meaning}):Array.isArray(y)&&y.length===2&&g.push({card_a:y[0],card_b:y[1]})}),console.log(" Normalized pairs:",g.length),g.length<2?(console.warn(" Memory game pairs missing or too few. Required: 2+, Got:",g.length),null):{id:cn(),type:"memory_game",content:{pair_count:g.length,pairs:g,question:i||"   :"},metadata:{...c,score:ks("memory_game",c.bloomLevel)}}}if(r==="matching_lines"||r==="matching"&&t.leftItems){console.log(" Handling as MATCHING (line drawing)");const p=t.leftItems||t.left_items||[],g=t.rightItems||t.right_items||[],y=t.correctMatches||t.correct_matches||[];return{id:cn(),type:"matching",content:{instruction:i||"  :",leftItems:p.length>0?p:[{id:"1",text:" 1"}],rightItems:g.length>0?g:[{id:"a",text:" 1"}],correctMatches:y,hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("matching",c.bloomLevel)}}}if(r==="highlight"||r==="circle"||r==="underline")return console.log(" Handling as HIGHLIGHT"),{id:cn(),type:"highlight",content:{instruction:i||"    :",text:t.text||t.content||" ",correctHighlights:t.correctHighlights||t.correct_highlights||[],highlightType:t.highlightType||t.highlight_type||"background",hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("highlight",c.bloomLevel)}};if(r==="sentence_builder"||r==="word_order"||r==="scrambled_sentence"){console.log(" Handling as SENTENCE BUILDER");const p=t.words||t.items||[],g=t.correctSentence||t.correct_sentence||p.join(" ");return{id:cn(),type:"sentence_builder",content:{instruction:i||"   :",words:p.length>0?p:["1","2","3"],correctSentence:g,hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("sentence_builder",c.bloomLevel)}}}if(r==="image_labeling"||r==="diagram_labeling"||r==="label_image")return console.log(" Handling as IMAGE LABELING"),{id:cn(),type:"image_labeling",content:{instruction:i||"    :",imageUrl:t.imageUrl||t.image_url||"",labels:t.labels||[],dropZones:t.dropZones||t.drop_zones||[],hints:t.hints||t.progressive_hints||[],imageDescription:t.imageDescription||t.image_description||""},metadata:{...c,score:ks("image_labeling",c.bloomLevel)}};if(r==="table_completion"||r==="fill_table"||r==="complete_table")return console.log(" Handling as TABLE COMPLETION"),{id:cn(),type:"table_completion",content:{instruction:i||"  :",headers:t.headers||[" 1"," 2"],rows:t.rows||[],hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("table_completion",c.bloomLevel)}};if(r==="text_selection"||r==="select_words"||r==="select_text")return console.log(" Handling as TEXT SELECTION"),{id:cn(),type:"text_selection",content:{instruction:i||"   :",text:t.text||t.content||" ",selectableUnits:t.selectableUnits||t.selectable_units||"word",correctSelections:t.correctSelections||t.correct_selections||[],minSelections:t.minSelections||t.min_selections||1,maxSelections:t.maxSelections||t.max_selections,hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("text_selection",c.bloomLevel)}};if(r==="rating_scale"||r==="scale"||r==="likert")return console.log(" Handling as RATING SCALE"),{id:cn(),type:"rating_scale",content:{question:i||":",minValue:t.minValue||t.min_value||1,maxValue:t.maxValue||t.max_value||5,minLabel:t.minLabel||t.min_label||"",maxLabel:t.maxLabel||t.max_label||"",correctAnswer:t.correct_answer,showNumbers:t.showNumbers!==void 0?t.showNumbers:!0},metadata:{...c,score:ks("rating_scale",c.bloomLevel)}};if(r==="matrix"||r==="grid"||r==="multi_true_false")return console.log(" Handling as MATRIX"),{id:cn(),type:"matrix",content:{instruction:i||"   :",columns:t.columns||[""," "],rows:t.rows||[],hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("matrix",c.bloomLevel)}};if(r==="fill_in_blank"||r==="fill_in_blanks"||r==="fill_blank"||r==="cloze"){console.log(" Handling as FILL IN BLANKS");const p=t.sentences||[],g=t.bank||t.word_bank||[],y=t.text||t.sentence||t.content;if(y&&p.length===0)return console.log(" FILL IN BLANKS: Using direct text format:",y.substring(0,50)+"..."),{id:cn(),type:"fill_in_blanks",content:{text:y,hidden_words:g,distractors:[]},metadata:{...c,score:ks("fill_in_blanks",c.bloomLevel),wordBank:g}};const v=p.map(b=>({sentence:b.text||b.sentence||"",answer:b.answer||b.correct||""}));return{id:cn(),type:"fill_in_blanks",content:{instruction:i||"   :",blanks:v,wordBank:g,hints:t.hints||t.progressive_hints||[]},metadata:{...c,score:ks("fill_in_blanks",c.bloomLevel)}}}return console.warn(" mapSystemItemToBlock: Unknown type -",r),null},pfe={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,onRetry:()=>{},shouldRetry:n=>{const e=n.message.toLowerCase();return e.includes("network")||e.includes("timeout")||e.includes("429")||e.includes("rate limit")||e.includes("econnreset")}};async function Dq(n,e={}){const t={...pfe,...e};let r;for(let s=1;s<=t.maxRetries;s++)try{return await n()}catch(i){if(r=i,s===t.maxRetries||!t.shouldRetry(i))throw i;const o=Math.min(t.initialDelay*Math.pow(t.backoffMultiplier,s-1),t.maxDelay);console.warn(`[Retry] Attempt ${s}/${t.maxRetries} failed. Retrying in ${o}ms...`,i.message),t.onRetry(s,i),await mfe(o)}throw r}function mfe(n){return new Promise(e=>setTimeout(e,n))}function jq(n){if(!n)return"   ";const t=(n.message||String(n)).toLowerCase();return t.includes("rate limit")||t.includes("429")?"  .      .":t.includes("network")||t.includes("offline")||t.includes("econnreset")?"  .       .":t.includes("timeout")?"    .   .":t.includes("auth")||t.includes("unauthorized")||t.includes("401")?" .   .":t.includes("permission")||t.includes("forbidden")||t.includes("403")?"     .":t.includes("not found")||t.includes("404")?"   .":t.includes("500")||t.includes("server error")||t.includes("internal error")?"  .    .":t.includes("validation")||t.includes("invalid")?"   .    .":t.includes("generation failed")?"    .      .":" .      ."}async function Oq(n,e,t="    "){return Promise.race([n(),new Promise((r,s)=>setTimeout(()=>s(new Error(t)),e))])}const Q3=async(n,e)=>await Dq(async()=>await Oq(async()=>(await zc(af,"geminiChat",{timeout:12e4})({messages:n,options:e})).data.content,12e4,"    .  ."),{maxRetries:3,initialDelay:1e3,backoffMultiplier:2,onRetry:(t,r)=>{console.warn(`[Gemini Retry] Attempt ${t}/3:`,jq(r))},shouldRetry:t=>{const r=t.message.toLowerCase();return r.includes("unauthenticated")||r.includes("invalid-argument")?!1:r.includes("network")||r.includes("timeout")||r.includes("internal")||r.includes("unavailable")||r.includes("502")||r.includes("503")||r.includes("bad gateway")||r.includes("service unavailable")}}),gfe=async(n,e)=>await Dq(async()=>await Oq(async()=>(await zc(af,"geminiChatFast",{timeout:3e4})({messages:n,options:e})).data.content,3e4,"    .  ."),{maxRetries:2,initialDelay:500,backoffMultiplier:2,onRetry:(t,r)=>{console.warn(`[Gemini Fast Retry] Attempt ${t}/2:`,jq(r))},shouldRetry:t=>{const r=t.message.toLowerCase();return r.includes("unauthenticated")||r.includes("invalid-argument")?!1:r.includes("network")||r.includes("timeout")||r.includes("internal")||r.includes("unavailable")}}),yfe=async(n,e)=>{const t=await gfe(n,{...e,responseFormat:{type:"json_object"}});try{return JSON.parse(t)}catch{throw console.error("Failed to parse Gemini Fast JSON response:",t.substring(0,500)),new Error("   ")}},h7e=async(n,e)=>{const t=await Q3(n,{...e,responseFormat:{type:"json_object"}});try{return JSON.parse(t)}catch{throw console.error("Failed to parse Gemini JSON response:",t.substring(0,500)),new Error("   ")}},Fq=async(n,e)=>{if(n.includes("/chat/completions")){const t=e.messages;return{choices:[{message:{role:"assistant",content:await Q3(t,{temperature:e.temperature,maxTokens:e.max_tokens,responseFormat:e.response_format})}}]}}throw new Error(`Unsupported endpoint: ${n}. Use callGeminiChat directly.`)},pD=new Map,xfe=5*60*1e3,bfe=10*60*1e3;function vfe(){const n=Date.now(),e=[];pD.forEach((t,r)=>{n-t.timestamp>bfe&&(console.warn(`[Dedup] Cleaning up stale request: ${r}`),e.push(r))}),e.forEach(t=>pD.delete(t))}typeof window<"u"&&setInterval(vfe,xfe);const N_={teacher:{id:"teacher",name:" ",systemPrompt:"  ,  .     (/).   ,      .   .",initialMessage:"!       .    ! "},socratic:{id:"socratic",name:" ",systemPrompt:"   .     .        .   ,     .      .    .",initialMessage:".      .  ,      . "},concise:{id:"concise",name:"",systemPrompt:"    .      .  ,  ( 2-3 ).     ' '.",initialMessage:".     .  ? "},coach:{id:"coach",name:" ",systemPrompt:"    .    .    ,      ('   ?').    .    .",initialMessage:" ?      ,      .  ! "}},wfe=n=>{const e=N_[n]||N_.socratic;return`SYSTEM: ${e.systemPrompt}
ROLE: ${e.name}`},kfe=(n,e,t,r,s)=>`
  # ROLE
  # ROLE
  ${n==="exam"?"You are a Strict Examiner.":"You are a supportive tutor checking a student's answer based on a text."}
  ${n==="exam"?"Provide objective feedback based strictly on the Model Answer.":"DO NOT GIVE THE ANSWER. GUIDE THE STUDENT TO IT."}
  Output Language: Hebrew.

  # INPUT
      - Source Text(Context): """${e.substring(0,1e3)}..."""
        - Question: "${t}"
          - Model Answer(Hidden from student): "${r}"
            - Student's Answer: "${s}"

  # TASK
  Analyze the student's answer and categorize it into one of 3 states:

    1. ** CORRECT **: The student understood the core concept.
      * * Action:* Praise and confirm.
  2. ** PARTIALLY CORRECT **: The student got some parts right but missed key details.
      * * Action:* Acknowledge the correct part, then ask a guiding question to help them find the missing part in the text.
  3. ** INCORRECT / IRRELEVANT **: The answer is wrong or off - topic.
      * * Action:* Give a specific hint pointing to the relevant paragraph without revealing the answer.

  # OUTPUT FORMAT(JSON ONLY)
    {
      "status": "correct" | "partial" | "incorrect",
        "feedback_to_student": "WRITE HERE: The personalized message (in Hebrew). E.g., '   ,     ?'"
    }
`,zq=(n,e)=>`
   .        .

##  - JSON :
${n}

##  :
${e}

##  :
1. **   -JSON ** -       
2. **     ** -    
3. ** : ** (    )
4. ** JSON  ** -   ,  markdown
5. **    ** ( ,  ) -        !

##     (!):
- ** :**  ,   .       .
  * : "     "
  * : "    "  "    "
- ** :**      "", "", ""    .
  * : "   ..."
  * : "     ..."
- ** :**      ().     - .

##   JSON :

###  - (multiple-choice):
{
  "question": " ",
  "options": [" ", " ", " ", " "],
  "correctAnswer": " "
}

###   (open-question):
{
  "question": " ",
  "expectedAnswer": " "
}

###   (fill_in_blanks):
{
  "text": "  [ ] "
}

### / (ordering):
{
  "instruction": " ",
  "correct_order": [" 1", " 2", " 3"]
}

###  (categorization):
{
  "question": "",
  "categories": [" 1", " 2"],
  "items": [{ "text": "", "category": " 1" }]
}

###   (memory_game):
{
  "pairs": [
    { "card_a": " ", "card_b": " " },
    { "card_a": " ", "card_b": " " }
  ]
}
**:**   pairs   ,  6    !

###  (matching):
{
  "instruction": "    ",
  "leftItems": [
    { "id": "l1", "text": " " },
    { "id": "l2", "text": " " }
  ],
  "rightItems": [
    { "id": "r1", "text": " " },
    { "id": "r2", "text": " " }
  ],
  "correctMatches": [
    { "left": "l1", "right": "r1" },
    { "left": "l2", "right": "r2" }
  ]
}
**:**   items   ,  5     !

### /  (true_false_speed):
{
  "instruction": "    -   ?",
  "statements": [
    { "text": " ", "is_true": true },
    { "text": " ", "is_true": false },
    { "text": " ", "is_true": true }
  ]
}
**:**   statements   ,  5    !

### / (text):
{
  "text": " "
}

##      (HOOKS):

   /   "hook",     ** **.

**  :**
- "      ..."
- "  "
- "  "
-    

**    :**

**Type A: Visual Hook (/)**
-       (30-60 )
- : "   [ ] : '  ? ?'"

**Type B: Mystery/Riddle Hook (/)**
- ,    
- : "  : [].    ?"

**Type C: Quick Game/Challenge ( )**
-   2-3   
- : " :  3   []  30 "

**Type D: Provocation/Dilemma Hook (/)**
-      
- : "  [ ].  ?  ?"

**Type E: Hands-On Hook ( )**
-     
- : "   [].    []"

**Type F: Personal Connection Hook ( )**
-     twist 
- : "  [ ]?   [ ]?"

      -   /.

## :
  -JSON  ,  .
`,_fe=(n,e,t)=>`
Role: Educational Data Analyst.
Task: Analyze student performance based on learning data.
Student: ${n}.
Topic: ${e}.

DATA:
${t}

METRICS TO ANALYZE:
1. Time per Question: Calculate average time spent
2. Attempts: Count average attempts per question
3. Hints: Calculate hint usage rate
4. Mistakes: Identify specific topics or skills with repeated errors

OUTPUT FORMAT (JSON ONLY):
{
  "strengths": ["List 2-3 specific skills the student demonstrated well"],
  "weaknesses": ["List 2-3 specific topics that need more practice"],
  "recommendedFocus": "Specific topic or skill to practice next",
  "learningMetrics": {
    "averageTimePerQuestion": 0,
    "hintUsageRate": 0.0,
    "attemptsPerQuestion": 0,
    "completionRate": 0.0
  }
}
`,Sfe=n=>`
Role: Senior Educational Consultant.
  Task: Analyze CLASS performance based on aggregated student data.
    
    DATA SAMPLES(Anonymized):
    ${n}

MISSION:
    Identify PATTERNS in the class.
1. Are they generally impulsive or hesitant ?
  2. Is there a specific topic they all struggle with?

      OUTPUT FORMAT(JSON ONLY):
{
  "strongSkills": ["List 2-3 skills the CLASS excels at"],
    "weakSkills": ["List 2-3 skills the CLASS struggles with"],
      "actionItems": ["List 2 practical teaching strategies for tomorrow"]
}
`,Tfe=n=>`
    Create a personal student report based on this data:
    ${n}

    Language: Hebrew.
    Tone: Encouraging, professional, pedagogical.
    Output JSON Structure:
    {
      "studentName": "Name",
      "summary": "A personal paragraph summarizing the student's progress",
      "criteria": {
        "knowledge": "Assessment of knowledge acquisition",
        "depth": "Assessment of analytical depth",
        "expression": "Assessment of capability to express ideas",
        "recommendations": "Actionable advice for improvement"
      }
    }
`,qy=new Map,$6=async(n,e)=>{const t=`${e}:${n.trim()}`,s=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(i)).map(l=>l.toString(16).padStart(2,"0")).join("")},Afe=n=>qy.get(n)||null,mD=(n,e)=>{if(qy.set(n,e),qy.size>50){const t=qy.keys().next().value;t&&qy.delete(t)}},Bq=async(n,e)=>{try{const t=Hw(Gw,`infographic_cache/${n}.png`);await Y3(t,e,{contentType:"image/png",cacheControl:"public, max-age=31536000"});const r=await Uw(t);return console.log(` Saved to Firebase Storage: ${n.substring(0,8)}...`),r}catch(t){throw console.error("Failed to save to Firebase Storage:",t),t}},Efe=async n=>{try{const e=Hw(Gw,`infographic_cache/${n}.png`),t=await Uw(e);return console.log(` Retrieved from Firebase Storage: ${n.substring(0,8)}...`),t}catch(e){return e.code==="storage/object-not-found"||console.error("Error retrieving from Firebase Storage:",e),null}},Cfe=(n,e,t,r)=>{ni&&gd(ni,"infographic_generation_start",{visual_type:n,text_length:e,user_id:t,course_id:r}),console.log(" Analytics: Generation started",{visualType:n,textLength:e})},Nfe=(n,e,t,r,s,i)=>{ni&&gd(ni,"infographic_generation_complete",{visual_type:n,provider:e,generation_time:t,cost:r,user_id:s,course_id:i}),console.log(" Analytics: Generation completed",{visualType:n,provider:e,generationTime:`${t}ms`,cost:`$${r.toFixed(4)}`})},gD=(n,e,t,r)=>{ni&&gd(ni,"infographic_generation_failed",{visual_type:n,provider:e,user_id:t,course_id:r}),console.log(" Analytics: Generation failed",{visualType:n,provider:e})},yD=(n,e,t,r)=>{ni&&gd(ni,"infographic_cache_hit",{visual_type:n,cache_source:e,user_id:t,course_id:r}),console.log(" Analytics: Cache HIT",{visualType:n,cacheSource:e})},Ife=(n,e,t)=>{ni&&gd(ni,"infographic_cache_miss",{visual_type:n,user_id:e,course_id:t}),console.log(" Analytics: Cache MISS",{visualType:n})},Rfe=(n,e,t)=>{ni&&gd(ni,"infographic_preview_opened",{visual_type:n,user_id:e,course_id:t}),console.log(" Analytics: Preview opened",{visualType:n})},Mfe=(n,e,t)=>{ni&&gd(ni,"infographic_preview_confirmed",{visual_type:n,user_id:e,course_id:t}),console.log(" Analytics: Preview confirmed",{visualType:n})},Pfe=(n,e,t)=>{ni&&gd(ni,"infographic_preview_rejected",{visual_type:n,user_id:e,course_id:t}),console.log(" Analytics: Preview rejected",{visualType:n})},Vl="gemini-3-pro-preview",Lfe=async(n,e,t)=>{var r;try{console.log(" Calling Gemini 3 Pro Image Cloud Function for infographic...");const s=jc.currentUser;if(!s)return console.error(" User not authenticated"),null;const i=await s.getIdToken(),a=await fetch("https://us-central1-ai-lms-pro.cloudfunctions.net/generateGeminiInfographic",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({content:n,visualType:e,topic:t})});if(!a.ok){const c=await a.json();return console.error(" Gemini 3 Pro Image Cloud Function error:",c),null}const l=await a.json();if(l.success&&((r=l.image)!=null&&r.base64)){console.log(" Gemini 3 Pro Image received from Cloud Function");const c=atob(l.image.base64),u=new Array(c.length);for(let f=0;f<c.length;f++)u[f]=c.charCodeAt(f);const h=new Uint8Array(u);return new Blob([h],{type:l.image.mimeType||"image/png"})}return null}catch(s){return console.error(" Gemini 3 Pro Image Cloud Function call failed:",s),null}},Kw={chat:{completions:{create:async n=>await Fq("/chat/completions",n)}}},Y0=Kw,Dfe=async(n,e,t,r,s="learning")=>{const i=kfe(s,r,n,t,e);console.log(" checkOpenQuestionAnswer - calling AI with prompt length:",i.length);try{const a=(await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:i}],response_format:{type:"json_object"},temperature:.3})).choices[0].message.content||"{}";console.log(" AI raw response:",a.substring(0,200));const l=JSON.parse(a);return console.log(" Parsed response:",l),{status:l.status||"partial",feedback:l.feedback_to_student||"  ."}}catch(o){return console.error(" checkOpenQuestionAnswer error:",o==null?void 0:o.message,o),{status:"partial",feedback:"  .  ."}}},f7e=async(n,e)=>{const t=zq(n,e);try{return(await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:t}]})).choices[0].message.content||n}catch{return n}},$q=async(n,e="auto")=>{const{isGeminiImageAvailable:t,generateGeminiImage:r}=await Ln(async()=>{const{isGeminiImageAvailable:s,generateGeminiImage:i}=await import("./imagenService-D9X-XJ8a.js");return{isGeminiImageAvailable:s,generateGeminiImage:i}},[]);if(console.log(" Generating with Gemini Image via Cloud Function..."),!t())return console.error(" Gemini Image not available"),null;try{const s=await r(n);return s?(console.log(" Gemini Image generation successful"),s):(console.error(" Gemini Image generation returned null"),null)}catch(s){return console.error(" Gemini Image generation failed:",s),null}},V6=async(n,e,t,r=!1)=>{const s=n.length>2e3?n.substring(0,2e3)+"...":n;if(Cfe(e,n.length),!r){const i=await $6(s,e),o=Afe(i);if(o){console.log(` Memory Cache HIT for ${e} infographic (hash: ${i.substring(0,8)}...)`),yD(e,"memory");const l=o.split(",")[1],c=atob(l),u=new Array(c.length);for(let f=0;f<c.length;f++)u[f]=c.charCodeAt(f);const h=new Uint8Array(u);return new Blob([h],{type:"image/png"})}const a=await Efe(i);if(a){console.log(` Firebase Storage Cache HIT for ${e} infographic`),yD(e,"firebase-storage");const c=await(await fetch(a)).blob(),u=new FileReader;return u.onloadend=()=>{mD(i,u.result)},u.readAsDataURL(c),c}console.log(` Cache MISS for ${e} infographic - generating new image...`),Ife(e)}try{console.log(` Generating ${e} infographic with Gemini 3 Pro Image...`);const i=Date.now();let o=null,a=.04;try{console.log(" Using Gemini 3 Pro Image for real infographic image generation..."),o=await Lfe(s,e,t),o&&console.log(" Gemini 3 Pro Image infographic generated successfully!")}catch(c){console.error(" Gemini 3 Pro Image infographic generation failed:",c)}const l=Date.now()-i;if(o){if(console.log(` ${e} infographic generated successfully with Gemini 3 Pro Image`),Nfe(e,"gemini3",l,a),!r){const c=await $6(s,e),u=new FileReader;u.onloadend=()=>{const h=u.result;mD(c,h),console.log(` Memory cache saved (hash: ${c.substring(0,8)}...)`)},u.readAsDataURL(o);try{await Bq(c,o),console.log(" Firebase Storage cache saved (persistent)")}catch(h){console.warn(" Firebase Storage save failed (memory cache still active):",h)}}}else console.warn(` ${e} infographic generation failed - Gemini 3 Pro only mode`),gD(e,"gemini3");return o}catch(i){return console.error(`Error generating ${e} infographic:`,i),gD(e,"gemini3"),null}},jfe=async(n,e,t)=>{const r=_fe(n,t,JSON.stringify(e,null,2));try{const s=await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:r}],response_format:{type:"json_object"},temperature:.5});return JSON.parse(s.choices[0].message.content||"{}")}catch{return null}},p7e=async n=>{const e=Sfe(JSON.stringify(n.slice(0,15).map(t=>({score:t.score,analytics:t.analytics})),null,2));try{const t=await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:e}],response_format:{type:"json_object"},temperature:.6});return JSON.parse(t.choices[0].message.content||"{}")}catch{return null}},m7e=async n=>{const e=Tfe(JSON.stringify(n));try{const t=await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:e}],response_format:{type:"json_object"}});return JSON.parse(t.choices[0].message.content||"{}")}catch(t){return console.error("Student Report Error:",t),null}},g7e=async n=>{const e=new FormData;e.append("file",n,"recording.webm"),e.append("model","whisper-1"),e.append("language","he");try{return(await Fq("/audio/transcriptions",e)).text||null}catch(t){return console.error("Transcription Error:",t),null}},Ofe=async(n,e,t)=>{const r=typeof e=="string",i=zq(JSON.stringify(r?{text:e}:e,null,2),t);try{console.log(` AI Refine - Block type: ${n}, Instruction: ${t}`),console.log(` Original content type: ${typeof e}, isString: ${r}`);const a=(await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:i}],response_format:{type:"json_object"}})).choices[0].message.content||"{}";console.log(" AI Refine Response:",a.substring(0,300)+"...");const l=JSON.parse(a);if(Object.keys(l).length===0)return console.warn(" AI returned empty object, keeping original content"),e;if(!((u,h)=>{switch(h){case"true_false_speed":return u.statements&&u.statements.length>0;case"memory_game":return u.pairs&&u.pairs.length>0;case"categorization":return u.items&&u.items.length>0&&u.categories&&u.categories.length>0;case"ordering":return u.correct_order&&u.correct_order.length>0;case"matching":return u.pairs&&u.pairs.length>0||u.leftItems&&u.leftItems.length>0||u.correctMatches&&u.correctMatches.length>0;case"multiple_choice":case"multipleChoice":case"multiple-choice":return u.options&&u.options.length>0;default:return!0}})(l,n))return console.warn(` AI returned empty arrays for ${n}, keeping original content`),e;if(r&&n==="text"){const u=l.text||l.content||l.teach_content;if(u&&typeof u=="string")return console.log(" Extracted text content from response"),u}return l}catch(o){return console.error(" AI Refine Error:",o),e}},y7e=async(n,e)=>{var t;try{console.log(` Refining activity-intro image with instruction: ${e}`);const{generateGeminiImage:r}=await Ln(async()=>{const{generateGeminiImage:h}=await import("./imagenService-D9X-XJ8a.js");return{generateGeminiImage:h}},[]),{uploadGeneratedImage:s}=await Ln(async()=>{const{uploadGeneratedImage:h}=await Promise.resolve().then(()=>Cme);return{uploadGeneratedImage:h}},void 0),o=`    AI.
      ,  prompt    .

  : ${n.imagePrompt||n.title||n.description||" "}
 : ${e}

 prompt  (4-5 )      ,   .
:    -prompt ,  .`,l=((t=(await Y0.chat.completions.create({model:Vl,messages:[{role:"user",content:o}],temperature:.7})).choices[0].message.content)==null?void 0:t.trim())||"";if(!l)return console.error(" Failed to generate new image prompt"),null;console.log(` New image prompt: ${l.substring(0,100)}...`);const c=await r(l);if(!c)return console.error(" Failed to generate new image"),null;const u=await s(c,"ai-image");return u?(console.log(" New activity-intro image generated and uploaded"),{imageUrl:u,title:n.title||" ",description:n.description||"",imagePrompt:l}):(console.error(" Failed to upload new image"),null)}catch(r){return console.error(" Error refining activity-intro image:",r),null}},Ffe={flowchart:{keywords:["","","","","","","","","",""," "," "],numberPatterns:/(?:||)\s*\d+|^\d+\.|^[\u05D0-\u05EA]\./gm,structure:/\d+\.\s+.+\n\d+\.\s+/g,weight:1},timeline:{keywords:["","","","","","","","","","","",""],datePatterns:/\b\d{4}\b|\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/g,centuryPatterns:/\s+-?\d+|\s+-?\d+/g,structure:/(?:-?||)\s*\d{4}/g,weight:1.2},comparison:{keywords:["","","","","",""," "," ","","","vs",""],vsPattern:/\b(vs\.?|versus)\b/gi,structure:/(.+)\s+(?:| -?)\s+(.+)/g,tablePattern:/\|.+\|/g,weight:1.1},cycle:{keywords:["","","","","","","  ","","",""],cyclicPatterns:/||||/g,circularLogic:/(.*.*.*)|(.*.*)/g,weight:.9}},zfe=(n,e)=>{const t=n.toLowerCase();return e.reduce((r,s)=>{const i=new RegExp(s,"gi"),o=t.match(i);return r+(o?o.length:0)},0)},Bfe=(n,e)=>{const t=Ffe[e];let r=0;const s=zfe(n,t.keywords);if(r+=s*10,e==="flowchart"){const i=n.match(t.numberPatterns),o=n.match(t.structure);r+=((i==null?void 0:i.length)||0)*15,r+=((o==null?void 0:o.length)||0)*20}if(e==="timeline"){const i=n.match(t.datePatterns),o=n.match(t.centuryPatterns),a=n.match(t.structure);r+=((i==null?void 0:i.length)||0)*25,r+=((o==null?void 0:o.length)||0)*20,r+=((a==null?void 0:a.length)||0)*15}if(e==="comparison"){const i=n.match(t.vsPattern),o=n.match(t.structure),a=n.match(t.tablePattern);r+=((i==null?void 0:i.length)||0)*30,r+=((o==null?void 0:o.length)||0)*20,r+=((a==null?void 0:a.length)||0)*25}if(e==="cycle"){const i=n.match(t.cyclicPatterns),o=n.match(t.circularLogic);r+=((i==null?void 0:i.length)||0)*20,r+=((o==null?void 0:o.length)||0)*30}return r*t.weight},U6=n=>{const t=["flowchart","timeline","comparison","cycle"].map(l=>({type:l,score:Bfe(n,l)}));t.sort((l,c)=>c.score-l.score);const r=t.reduce((l,c)=>l+c.score,0),s=t[0].score,i=r>0?Math.min(s/r,1):0;let o="";t[0].type==="flowchart"?o="      ":t[0].type==="timeline"?o="    ":t[0].type==="comparison"?o="     ":t[0].type==="cycle"&&(o="    ");const a=t.slice(1,4).map(l=>({type:l.type,confidence:r>0?l.score/r:0}));return{suggestedType:t[0].type,confidence:i,reason:o,alternatives:a}};async function Rx(n,e,t=5){try{const r=zc(af,"searchKnowledge"),s={};e!=null&&e.grade&&(s.grade=e.grade),e!=null&&e.volumeType&&(s.volumeType=e.volumeType),e!=null&&e.contentType&&(s.contentType=e.contentType),e!=null&&e.subject&&(s.subject=e.subject),console.log(` KB Search: query="${n}", filters=`,s);const o=(await r({query:n,filters:s,limit:t,minSimilarity:.25})).data;return console.log(` KB Search results: ${o.results.length} found in ${o.processingTimeMs}ms`),o.results}catch(r){return console.warn("Knowledge base search failed:",r),[]}}async function $fe(n,e,t){try{return(await zc(af,"getKnowledgeContext")({topic:n,grade:e,includeTeacherGuide:(t==null?void 0:t.includeTeacherGuide)??!0,maxChunks:(t==null?void 0:t.maxChunks)??5})).data.context}catch(r){return console.warn("Failed to get knowledge context:",r),""}}function Vfe(n){return!n||n.trim().length===0?"":`
##    (     ):

${n}

---
     . :
-      
-      
-    
`}async function Vq(n,e){const t={exercises:[],commonMistakes:[],progressionLevels:[],mathLanguage:[],examples:[],questionPhrasing:[],studentAddressing:[],explanationPatterns:[],rawContext:""};try{console.log(` Searching KB for topic "${n}" grade ${e} - querying all 3 source types...`);const[r,s,i]=await Promise.all([Rx(n,{grade:e,volumeType:"curriculum"},3),Rx(n,{grade:e,volumeType:"student"},4),Rx(n,{grade:e,volumeType:"teacher"},3)]),o=[...r,...s,...i];if(o.length===0)return console.log(` No knowledge base results for "${n}" grade ${e}`),t;console.log(` KB results: curriculum=${r.length}, student=${s.length}, teacher=${i.length}`);for(const a of o){const l=a.chunk.content,c=a.chunk.volumeType==="curriculum"?" ":a.chunk.volumeType==="teacher"?" ":" ";if(t.rawContext+=`[${c} - ${a.chunk.chapter}]
${l}

`,a.chunk.volumeType==="curriculum"){const v=l.match(/(?:|||-| -|  )[^\n]+/g);v&&t.progressionLevels.push(...v);const b=l.match(/(?:|| | |)[^\n]+/g);b&&t.mathLanguage.push(...b)}const u=l.match(/(?:||||)[^\n]+(?:\n[^\n]+)?/g);if(u&&t.exercises.push(...u.slice(0,3)),a.chunk.volumeType==="teacher"){const v=l.match(/(?: | || )[^\n]+(?:\n[^\n]+)?/g);v&&t.commonMistakes.push(...v);const b=l.match(/(?: || | | )[^\n]+/g);b&&t.progressionLevels.push(...b)}const h=l.match(/(?:||||)[^\n]{10,60}/g);h&&t.mathLanguage.push(...h.slice(0,3));const f=l.match(/(?:|||)[^\n]+(?:\n[^\n]+)?/g);f&&t.examples.push(...f.slice(0,3));const p=l.match(/(?:||||||||||||||)[^\n?]+\??/g);p&&t.questionPhrasing.push(...p.slice(0,5));const g=l.match(/(?:|| | |||| || )[^\n]+/g);g&&t.studentAddressing.push(...g);const y=l.match(/(?:| ||||.*| | )[^\n]+/g);y&&t.explanationPatterns.push(...y)}t.exercises=[...new Set(t.exercises)].slice(0,5),t.commonMistakes=[...new Set(t.commonMistakes)].slice(0,5),t.progressionLevels=[...new Set(t.progressionLevels)].slice(0,3),t.mathLanguage=[...new Set(t.mathLanguage)].slice(0,5),t.examples=[...new Set(t.examples)].slice(0,5),t.questionPhrasing=[...new Set(t.questionPhrasing)].slice(0,5),t.studentAddressing=[...new Set(t.studentAddressing)].slice(0,5),t.explanationPatterns=[...new Set(t.explanationPatterns)].slice(0,5),console.log(` Extracted from KB: ${t.exercises.length} exercises, ${t.commonMistakes.length} mistakes, ${t.questionPhrasing.length} question patterns, ${t.studentAddressing.length} addressing patterns, ${t.progressionLevels.length} progression levels (from curriculum)`)}catch(r){console.warn("Failed to get math pedagogical context:",r)}return t}function Uq(n){if(!n.rawContext&&n.exercises.length===0)return"";let e=`
##      -  !

###     (   !):
`;return n.studentAddressing.length>0&&(e+=`   :
${n.studentAddressing.map((t,r)=>` "${t}"`).join(`
`)}

**:**      ("", "", " ")   (" ", "").
`),n.questionPhrasing.length>0&&(e+=`
###    -   :
${n.questionPhrasing.map((t,r)=>` ${t}`).join(`
`)}

`),n.explanationPatterns.length>0&&(e+=`###    :
${n.explanationPatterns.map((t,r)=>` ${t}`).join(`
`)}

`),n.exercises.length>0&&(e+=`###     (  ):
${n.exercises.map((t,r)=>`${r+1}. ${t}`).join(`
`)}

`),n.examples.length>0&&(e+=`###    :
${n.examples.join(`
`)}

`),n.commonMistakes.length>0&&(e+=`###    (    !):
${n.commonMistakes.map((t,r)=>`${r+1}. ${t}`).join(`
`)}

`),n.progressionLevels.length>0&&(e+=`###    :
${n.progressionLevels.join(`
`)}

`),n.mathLanguage.length>0&&(e+=`###     :
${n.mathLanguage.join(`
`)}

`),e+=`---
##     :
1. ** :**      -    
2. ** :**     ('  )
3. ** :**     
4. **:**       
5. ** :**         
6. **:**     ("...", " ...")
`,e}const Ufe=async(n,e="General")=>{const t=JSON.stringify(n.content,null,2),r=`
    You are an expert Pedagogical Data Scientist.
    TASK: Analyze this Learning Item and generate "Adaptive Metadata".
    
    CONTEXT TOPIC: ${e}
    ITEM TYPE: ${n.type}
    ITEM CONTENT:
    ${t}

    REQUIREMENTS:
    1. **Difficulty Index (IRT Beta):** Estimate probability of failure (0.0 = Trivial, 1.0 = Impossible).
    2. **Bloom Taxonomy:** Classify the cognitive load.
    3. **Error Tagging:** 
       - If this is a Multiple Choice / True-False question, analyze the WRONG answers (distractors).
       - Assign a specific 'error_tag' concept to each wrong answer (e.g., "sign_error", "phonetic_confusion").
       - If distractors are missing or generic, invent tags based on potential student errors.

    OUTPUT JSON FORMAT:
    {
        "difficulty_level": 0.5,
        "bloom_taxonomy": "Apply",
        "estimated_time_sec": 45,
        "distractors_analysis": [
             { "option_text": "Option A", "error_tag": "calculation_error", "feedback": "Did you forget to carry the 1?" }
        ]
    }
    `;try{const i=(await Kw.chat.completions.create({model:Vl,messages:[{role:"user",content:r}],response_format:{type:"json_object"},temperature:.3})).choices[0].message.content||"{}",o=JSON.parse(i);return{...n,metadata:{...n.metadata,difficulty_level:o.difficulty_level,bloom_taxonomy:o.bloom_taxonomy,estimated_time_sec:o.estimated_time_sec,adaptive_analysis:o}}}catch(s){return console.error("Enrichment Failed:",s),n}},Hq=async(n,e)=>{var s;if(!["multiple-choice","open-question","fill_in_blanks","ordering"].includes(n.type))return null;const t=JSON.stringify(n.content,null,2),r=`
    You are an expert Instructional Designer specializing in scaffolded learning.

    TASK: Create an EASIER variant of this question for struggling students.

    TOPIC: ${e}
    ORIGINAL QUESTION TYPE: ${n.type}
    ORIGINAL CONTENT:
    ${t}

    SCAFFOLDING STRATEGIES TO USE:
    1. Simplify the language (shorter sentences, simpler vocabulary)
    2. Add a concrete example or worked problem before the question
    3. For multiple-choice: Make wrong answers more obviously wrong
    4. Add 2-3 progressive hints that guide without giving away the answer
    5. Break down complex questions into smaller steps

    CRITICAL: Output MUST match the EXACT same content structure as the input.
    The type "${n.type}" requires specific content fields.

    OUTPUT JSON FORMAT:
    {
        "scaffolded_content": { ... same structure as original content, but easier ... },
        "progressive_hints": ["First hint (very subtle)", "Second hint (more direct)", "Third hint (almost gives it away)"],
        "pre_context": "A short example or explanation shown before the question (optional, max 50 words)"
    }

    Important: Keep the question type the same. If it's multiple-choice, keep 4 options.
    Write in Hebrew if the original was in Hebrew.
    `;try{const o=(await Kw.chat.completions.create({model:Vl,messages:[{role:"user",content:r}],response_format:{type:"json_object"},temperature:.5})).choices[0].message.content||"{}",a=JSON.parse(o);return a.scaffolded_content?{id:`${n.id}_`,type:n.type,content:a.scaffolded_content,metadata:{...n.metadata,isVariant:!0,variantType:"",originalBlockId:n.id,progressiveHints:a.progressive_hints||[],preContext:a.pre_context,difficulty_level:Math.max(0,(((s=n.metadata)==null?void 0:s.difficulty_level)||.5)-.2)}}:(console.warn("Scaffolding generation returned empty content"),null)}catch(i){return console.error(" Gen Failed:",i),null}},qq=async(n,e)=>{var s;if(!["multiple-choice","open-question","fill_in_blanks","ordering"].includes(n.type))return null;const t=JSON.stringify(n.content,null,2),r=`
    You are an expert Instructional Designer specializing in gifted education.

    TASK: Create a MORE CHALLENGING variant of this question for advanced students.

    TOPIC: ${e}
    ORIGINAL QUESTION TYPE: ${n.type}
    ORIGINAL CONTENT:
    ${t}

    ENRICHMENT STRATEGIES TO USE:
    1. Increase cognitive complexity (move up Bloom's taxonomy)
    2. Add real-world application or transfer questions
    3. For multiple-choice: Make distractors more plausible, require deeper analysis
    4. Add "why" or "how" elements to straightforward questions
    5. Connect to related advanced concepts

    CRITICAL: Output MUST match the EXACT same content structure as the input.
    The type "${n.type}" requires specific content fields.

    OUTPUT JSON FORMAT:
    {
        "enriched_content": { ... same structure as original content, but harder ... },
        "extension_question": "An optional follow-up challenge question for those who want more",
        "connection_note": "Brief note on how this connects to more advanced topics"
    }

    Important: Keep the question type the same. If it's multiple-choice, keep 4 options.
    Write in Hebrew if the original was in Hebrew.
    `;try{const o=(await Kw.chat.completions.create({model:Vl,messages:[{role:"user",content:r}],response_format:{type:"json_object"},temperature:.6})).choices[0].message.content||"{}",a=JSON.parse(o);return a.enriched_content?{id:`${n.id}_`,type:n.type,content:a.enriched_content,metadata:{...n.metadata,isVariant:!0,variantType:"",originalBlockId:n.id,extensionQuestion:a.extension_question,connectionNote:a.connection_note,difficulty_level:Math.min(1,(((s=n.metadata)==null?void 0:s.difficulty_level)||.5)+.2),bloom_taxonomy:"Analyze"}}:(console.warn("Enrichment generation returned empty content"),null)}catch(i){return console.error(" Gen Failed:",i),null}},Hfe=async(n,e)=>{const[t,r]=await Promise.all([Hq(n,e),qq(n,e)]);return{:t,:r}},qfe=async(n,e)=>{var s,i;const t=await Ufe(n,e),r=await Hfe(t,e);return{...t,metadata:{...t.metadata,_id:(s=r.)==null?void 0:s.id,_id:(i=r.)==null?void 0:i.id,has_variants:!!(r.||r.),_variant:r.||null,_variant:r.||null}}},xD=async(n,e,t)=>{const r=JSON.stringify(n.content,null,2),s=t?`User chose WRONG answer: "${t}"`:"User failed this task.",i=`
    You are an expert AI Tutor (Remediation Specialist).
    A student FAILED the following learning item.
    
    TOPIC: ${e}
    ORIGINAL ITEM:
    ${r}

    FAILURE CONTEXT: ${s}

    MISSION:
    1. Identify the likely misconception causing this error.
    2. Create a "Bridge" explanation block (Text) that clarifies this SPECIFIC concept.
    3. Use an encouraging, non-judgmental tone.
    4. Keep it concise (under 80 words).
    5. Use analogies if helpful.

    OUTPUT JSON:
    {
       "remedial_text": "Here is why... (Explanation)... Remember that..."
    }
    `;try{const a=(await Kw.chat.completions.create({model:Vl,messages:[{role:"user",content:i}],response_format:{type:"json_object"},temperature:.5})).choices[0].message.content||"{}",l=JSON.parse(a);return{id:cn(),type:"text",content:`###     

${l.remedial_text||"    ..."}`,metadata:{isRemediation:!0,relatedToBlockId:n.id,bloom_taxonomy:"Understand"}}}catch(o){return console.error("Remediation Gen Failed",o),null}},Gfe=n=>{const e=n.match(/[-]|[1-9][0-2]?/);if(!e)return"children aged 10-12";const t=e[0],r={:"young children aged 6-7 (first grade)",:"children aged 7-8 (second grade)",:"children aged 8-9 (third grade)",:"children aged 9-10 (fourth grade)",:"pre-teens aged 10-11 (fifth grade)",:"pre-teens aged 11-12 (sixth grade)",:"young teenagers aged 12-13 (seventh grade, middle school)",:"teenagers aged 13-14 (eighth grade, middle school)",:"teenagers aged 14-15 (ninth grade, high school)",:"high school students aged 15-16 (tenth grade)",:"high school students aged 16-17 (eleventh grade)",:"high school seniors aged 17-18 (twelfth grade)"},s={1:"young children aged 6-7 (first grade)",2:"children aged 7-8 (second grade)",3:"children aged 8-9 (third grade)",4:"children aged 9-10 (fourth grade)",5:"pre-teens aged 10-11 (fifth grade)",6:"pre-teens aged 11-12 (sixth grade)",7:"young teenagers aged 12-13 (seventh grade, middle school)",8:"teenagers aged 13-14 (eighth grade, middle school)",9:"teenagers aged 14-15 (ninth grade, high school)",10:"high school students aged 15-16 (tenth grade)",11:"high school students aged 16-17 (eleventh grade)",12:"high school seniors aged 17-18 (twelfth grade)"};return r[t]||s[t]||"students aged 10-14"};A_(G0());async function Wfe(n,e){return await Q3(n,e)}const Ci={chat:{completions:{create:async n=>{const e=n.messages;return{choices:[{message:{role:"assistant",content:await Wfe(e,{temperature:n.temperature,maxTokens:n.max_tokens,responseFormat:n.response_format})}}]}}}}},bD={teacher:{id:"teacher",name:" ",systemPrompt:"  ,  .     (/).   ,      .   .",initialMessage:"!       .    ! "},socratic:{id:"socratic",name:" ",systemPrompt:"   .     .        .   ,     .      .    .",initialMessage:".      .  ,      . "},concise:{id:"concise",name:"",systemPrompt:"    .      .  ,  ( 2-3 ).     ' '.",initialMessage:".     .  ? "},coach:{id:"coach",name:" ",systemPrompt:"    .    .    ,      ('   ?').    .    .",initialMessage:" ?      ,      .  ! "}},ao="gpt-4o-mini",Gq=(n,e)=>{if(!e)switch(n){case 3:return["Remember (Foundation)","Analyze (Process)","Create (Synthesis)"];case 5:return["Remember","Remember","Apply","Analyze","Create"];case 7:return["Remember","Remember","Apply","Apply","Analyze","Evaluate","Create"];default:return Array(n).fill("Mix of Levels")}const t=Object.values(e).reduce((s,i)=>s+i,0),r=[];for(Object.entries(e).forEach(([s,i])=>{const o=Math.round(i/t*n);for(let a=0;a<o;a++)r.push(s)});r.length<n;)r.push("Apply");return r.slice(0,n).sort()},Kfe=(n,e,t)=>{const r=n.toLowerCase().split(" ")[0].split("(")[0].trim(),s=e/t,i=s<=.33?" ()":s<=.66?" ()":" ()",o={remember:{complexity:"  -   ",questionTypes:"  , / ,  ",cognitiveLoad:" -    ,   ",examples:{good:"  3 + 2? ( ,  )",bad:"   47    23 ,  ? (  )"}},understand:{complexity:" -   ",questionTypes:"   ,   ",cognitiveLoad:"- -     ",examples:{good:"  ?   5    3 (/)",bad:"        ( -  )"}},apply:{complexity:" -   ",questionTypes:"  ,  ",cognitiveLoad:" -      ",examples:{good:"  12   .    5.    ?",bad:"  12 + 5? (  -  )"}},analyze:{complexity:"  -  ",questionTypes:" ,   ,  ",cognitiveLoad:"- -     ",examples:{good:"     : 3+2, 15+8, 7+4 ( )",bad:"  3+2? (  -  )"}},evaluate:{complexity:" -  ",questionTypes:" ,  ,  ",cognitiveLoad:" -     ",examples:{good:" : 8+7=14.   ?  .",bad:"  8+7? ( -  )"}},create:{complexity:"  -  ",questionTypes:" ,  ,   ",cognitiveLoad:"  -    ",examples:{good:"        ",bad:": 5+3 ( -  )"}}},a=o[r]||o.apply;return`
 SCAFFOLDING -   ( ${e}  ${t}):


  : ${i}
  : ${n}
  : ${a.complexity}

   : ${a.questionTypes}
  : ${a.cognitiveLoad}

    :
   "${a.examples.good}"

    (/ ):
   "${a.examples.bad}"

   :
${e===1?`   -   !    
   -     
   -     -  `:""}
${e===t?`   -   !    
   -    
   -    `:""}
${e>1&&e<t?`   -   -    
   -   
   -     -  `:""}


`},x7e=async(n,e,t,r,s="learning",i,o="lesson",a,l)=>{let c="",u="",h=5,f="";o==="exam"||s==="exam"?(h=t==="short"?3:t==="long"?7:5,f=`
      STEP 1: Knowledge Check. Type: multiple_choice OR true_false (Strict).
      STEP 2: Application. Type: categorization OR ordering.
      STEP 3-${h}: Synthesis/Audio. Type: open_question OR audio_response. NO teaching content.
      `):o==="activity"?t==="short"?(h=3,f=`
          STEP 1: Speed Challenge. Type: true_false_speed OR memory_game.
          STEP 2: Puzzle Challenge. Type: ordering OR categorization.
          STEP 3: Master Challenge. Type: memory_game OR categorization (Hard).
        `):(h=t==="long"?7:5,f=`
          STEPS 1-2: Warmup Games. Type: memory_game / true_false_speed.
          STEPS 3-4: Logic Puzzles. Type: ordering / categorization / matching.
          STEPS 5-${h}: Boss Levels. Type: categorization / matching (Complex).
        `):t==="short"?(h=3,f=`
        STEP 1: Introduction & Exposition (Teach + Check). Type: multiple_choice (as Knowledge Check). DO NOT use memory_game.
        STEP 2: Deep Dive (Understand). Type: fill_in_blanks (Conceptual Cloze).
        STEP 3: Conclusion & Reflection. Type: open_question.
      `):t==="long"?(h=7,f=`
        STEPS 1-2: Exposition & Concepts. Type: multiple_choice (Knowledge Check) / true_false.
        STEPS 3-5: Application & Practice. Type: fill_in_blanks / categorization / ordering.
        STEPS 6-7: Synthesis & Critical Thinking. Type: open_question / multiple_choice (Complex Scenario).
      `):(h=5,f=`
        STEPS 1-2: Core Concepts (Teach). Type: multiple_choice (Concept Check) OR true_false (Misconception Buster).
        STEPS 3-4: Analysis (Apply). Type: fill_in_blanks OR categorization.
        STEP 5: Synthesis (Create/Evaluate). Type: open_question OR audio_response.
      `);const p=r?`BASE CONTENT ON THIS TEXT ONLY:
"""${r.substring(0,15e3)}"""
Ignore outside knowledge if it contradicts the text.`:`Topic: "${n}"`,g=Gq(h,i),y=`
    Task: Create a "Skeleton" for a learning unit.
    ${p}
    Target Audience: ${e}.
    ${c}
    ${u}
    Mode: ${s==="exam"||o==="exam"?"STRICT EXAMINATION / TEST MODE":o==="activity"?"INTERACTIVE ACTIVITY MODE":"Learning/Tutorial Mode"}
    Count: Exactly ${h} steps.
    Language: Hebrew.

    BLOOM TAXONOMY REQUIREMENTS:
    ${JSON.stringify(g)}

    MISSION:
    1. **Holistic Analysis:** Read the ENTIRE source text first. Understand the "Big Picture".
    2. **SEGMENTATION STRATEGY (CRITICAL):**
       - **Scan First:** Identify ALL distinct case studies, periods, or sub-topics.
       - **Anti-Bias Rule:** You MUST include ALL major distinct stories found.
       - **Action:** Divorce the Source Text into ${h} DISTINCT, NON-OVERLAPPING logical chunks.
       - **Constraint:** Chunk A must end completely before Chunk B begins.

    3. **ZERO-TEXT-WALL POLICY (V4 ANTI-BATCHING):**
       ${s==="exam"||o==="exam"?`- **EXAM MODE / ASSESSMENT ONLY:**
           - **Structure:** Question Block ONLY. No introduction text.
           - **Content:** Do NOT output 'teach_content'. Output strictly assessment items.
           - **Logic:** Each step is a test item.`:o==="activity"?`- **ACTIVITY MODE / INTERACTIVE ONLY:**
             - **Structure:** 100% Interaction. No long text explanations.
             - **Content:** Interactive challenges.
             - **Logic:** Fun, pacing, engaging.`:`- **CRITICAL:** You must ensure that the user interacts FREQUENTLY.
             - **Rule:** If the narrative has more distinct chunks than the requested ${h} steps, you MUST Insert 'multiple_choice' or 'true_false' steps in between to ensure coverge without merging topics.
             - **Structure:** Text Chunk -> Question -> Text Chunk -> Question.`}

    4. **Topic Policing:**
       - For each step, define a strict **narrative_focus** (Allowed Content) and **forbidden_topics** (Banned Content).

    5. **LOGIC SAFETY:**
       - **Categorization:** Categories must be MUTUALLY EXCLUSIVE.
       - **Ordering:** Must be based on objective criteria.

    6. **Structure Guide:**
    ${f}

    ${o==="activity"?`7. **OPENING IMAGE PROMPT (CRITICAL FOR ACTIVITIES):**
       - You MUST generate a "context_image_prompt" field that describes an engaging opening image.
       - The image should show the SPECIFIC subject matter of this activity - NOT a generic professional.
       - For example: If the topic is "children from different historical periods", show children in period clothing, NOT an archaeologist.
       - Focus on the MAIN CHARACTERS or SUBJECTS of the content, not observers or researchers.
       - The prompt should be in English and describe a visually engaging scene that draws students into the topic.
       - Include specific visual details: clothing, setting, objects, actions.
       - Style: Semi-realistic educational illustration, warm colors, age-appropriate.
       - CRITICAL: NO TEXT AT ALL in the image - no labels, no signs, no writing, no letters, no words in ANY language. The image must be purely visual with no text elements.`:""}

    Output JSON Structure:
    {
      "unit_title": "String (DO NOT prefix with ' :' - just the topic name)",
      "goals": ["Goal 1 (Understand)", "Goal 2 (Practice)", "Goal 3 (Analyze)"],
      ${o==="activity"?`"context_image_prompt": "English prompt describing the opening image - focus on the ACTUAL SUBJECT (e.g., 'Children from different eras: a Roman child in toga, a medieval child, and a modern child, standing together in a magical setting, comparing their toys and clothes')",`:""}
      "steps": [
        {
          "step_number": 1,
          "title": "Unique Title for Chunk A",
          "narrative_focus": "${s==="exam"?"Assessment Topic A":"Discuss ONLY [Specific Concept A]"} . Do not mention [Concept B].",
          "forbidden_topics": ["Concept B", "Concept C", "Future Events"],
          "bloom_level": "Remember",
          "suggested_interaction_type": "${s==="exam"?"multiple_choice":"memory_game"}"
        }
      ]
    }
  `;try{const b=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:y}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}",w=JSON.parse(ty(b));return!w.steps||!Array.isArray(w.steps)?(console.warn("Invalid skeleton format received"),null):w}catch(v){return console.error("Skeleton Gen Error:",v),null}},Yfe=n=>{const e=/([3-6]|[-])['']?$/.test(n)||n.includes("")||n.includes("Elementary"),t=/(1[0-2]|['][]?)$/.test(n)||n.includes("")||n.includes("High School");return e?`
    3. **LINGUISTIC CONSTRAINTS (Elementary / CEFR A2-B1):**
       - **Structure:** Use ONLY simple sentences (Subject-Verb-Object). Max 10-12 words.
       - **Prohibition:** NO Passive Voice. NO "Construct State Chains" ( ).
       - **Vocabulary:** Concrete nouns only. Abstract concepts must be explained in parentheses ().
       - **COGNITIVE SHIELD:** If the thought is complex (Bloom Level 4+), SPLIT it into multiple short sentences. DO NOT delete the logic.`:t?`
    3. **LINGUISTIC CONSTRAINTS (High School / CEFR B2-C1):**
       - **Register:** Academic / Formal Hebrew.
       - **Requirement:** Mandatory use of Nominalization ( ).
       - **Syntax:** Complex embedded clauses are expected.
       - **Tone:** Academic, authoritative.`:`
    3. **LINGUISTIC CONSTRAINTS (Middle School / CEFR B1-B2):**
       - **Structure:** Compound sentences allowed (Although/Because/Therefore). Max 20 words.
       - **Tone:** Slight cynicism or humor is allowed here (Wizdi-Bot style).
       - **Focus:** Highlight Cause-and-Effect relationships.`},b7e=async(n,e,t,r,s,i="learning",o,a=5)=>{const l=r?`Source Material:
"""${r.substring(0,3e3)}..."""`:`Topic: ${n}`,c=i==="exam"?ffe:"";let u="";if(o==="math"||/|||||||||||/.test(n))try{const T=t.match(/\s*([-]{1,2})/),R=t.match(/^([-]{1,2})[']?$/),M=t.match(/(\d{1,2})/);let E="";T?E=T[1]:R?E=R[1]:M&&(E={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:"",11:"",12:""}[M[1]]||""),console.log(` Fetching KB context for step ${e.step_number}: "${e.title}", grade ${E}`);const I=await Vq(e.title||n,E);I.rawContext||I.exercises.length>0||I.studentAddressing.length>0||I.questionPhrasing.length>0?(u=Uq(I),console.log(` KB context added for step ${e.step_number}: ${I.exercises.length} exercises, ${I.studentAddressing.length} addressing patterns, ${I.questionPhrasing.length} question patterns (${u.length} chars)`)):console.log(` No useful KB content found for step ${e.step_number}`)}catch(T){console.warn("Failed to fetch KB context for step:",T)}const f=n||e.title||" ",p=!!r,y=`
 TOPIC BOUNDARY - ABSOLUTE RESTRICTION 

${p?`   / .
    : "${e.title}"

 :      -   !
       !
 :      `:`    : "${n}"

  :        "${n}"!
       !
${p?"":/|/.test(f)&&!/|/.test(f)?`
   /  -  :
 :   (  X + Y?)
 :   (  X - Y?)
 :   (  X  Y?) -  !
 :   (  X  Y?) -  !
`://.test(f)&&!/||/.test(f)?`
     -  :
 :   (  X  Y?)
 :  , ,  -     
`://.test(f)&&!/||/.test(f)?`
     -  :
 :   (  X  Y?)
 :  , ,  -     
`:""}`}

 END TOPIC BOUNDARY 
`,v=u?`
     CRITICAL INSTRUCTION - READ THIS FIRST 

          .     :

        teach_content  : " ", " ", " " 
          -   ! 

      :
     teach_content: "   !        ..."
     question: "  5    3 .     ?"

      -  !
     teach_content: "   ..." ( )
     question: "   5+3?" (   )

    ${u}

     END CRITICAL INSTRUCTION 
`:"",b=Kfe(e.bloom_level||"Apply",e.step_number||1,a),k=[{type:"text",text:`
    ${y}
    ${b}
    ${v}
    ${l}
    ${c}

    MANDATORY REQUIREMENTS:
  1. ** Pedagogy:** Strictly follow the Bloom Level(${e.bloom_level}) and Interaction Type(${e.suggested_interaction_type}). USE THE SCAFFOLDING INSTRUCTIONS ABOVE to determine difficulty!
    2. ** ZERO - TEXT - WALL RULE(V4 Anti - Batching):**
       - ** CRITICAL:** You must NEVER output two distinct text chunks consecutively without a question.
       - ** Focus:** Discuss ONLY: ${e.narrative_focus||"current step's topic"}.
       - ** BAN:** Do NOT mention: ${JSON.stringify(e.forbidden_topics||[])}.
       ${i==="exam"?"- **EXAM MODE:** Do NOT output 'teach_content'. Set it to null or empty string. Focus entirely on the Question.":"- **Constraint:** If the text requires multiple paragraphs, ensure the question relates to the *entire* chunk or breaks it down."}

    ${Yfe(t)}

       - ** Age Adaptation(Grades 1 - 6):** Every technical term MUST have a concrete analogy.
       - ** Tone Override:** ${i==="exam"?"Objective, Examiner Tone (No Humor)":"As per Linguistic Constraints above"}.

  4. ** STRICT GROUNDING(Anti - Hallucination V3):**
       - ** Rule:** Use ONLY the provided Source Text.If it's not in the PDF, it doesn't exist.

    5. ** Micro - Learning Progression:**
    - Treat this step as "Chapter ${e.step_number}". Do not repeat definitions from previous chapters.
      ${i==="exam"?'- **EXAM MODE:** TONE must be objective, examiner tone. No "Wizdi-Bot" persona.':""}

  6. ** Logic & Interaction Rules:**
       - ** Ordering:** The 'teach_content' MUST be a narrative story.Items must be paraphrased.
       - ** Categorization:** Categories must be ** MUTUALLY EXCLUSIVE **.
       - ** OPEN QUESTION RUBRIC:** Provide a detailed \`model_answer\` with 3-4 bullet points.
       - **Language:** OUTPUT VALUES MUST BE IN HEBREW.
       - **TEXTBOOK STYLE:** If KB context was provided above, you MUST use its exact phrasing style, student addressing patterns, and question formats. Copy the TONE from the textbook examples!
       
    8. **PEDAGOGICAL SAFETY VALVE (BLOOM-PRESERVING FALLBACK):**
       - **Rule:** If the Source Text lacks the data structure required for the requested Interaction Type (e.g., requested "Ordering" but text has no clear sequence), you MUST trigger a Fallback.
       - **CRITICAL:** The Fallback must preserve the cognitive load (Bloom Level).
       
       **CASE A: REQUESTED "Ordering" (Apply/Analyze)**
       - FAILURE CONDITION: Text lists items without a clear objective sequence.
       - FALLBACK ACTION: Switch to "Categorization" (if items differ by type) OR "Fill-in-Blanks" (Cloze).
       
       **CASE B: REQUESTED "Categorization" (Apply/Analyze)**
       - FAILURE CONDITION: All items belong to a single category or are ambiguous.
       - FALLBACK ACTION: Switch to "Fill-in-Blanks" (Contextual inference).
       
       **CASE C: REQUESTED "Memory Game" (Remember)**
       - FAILURE CONDITION: Cannot find 6 distinct pairs.
       - FALLBACK ACTION: Switch to "Multiple Choice" (Fact recall) or "True/False" (Fact verification).
       
       **GENERAL RULE:**
       - NEVER return empty or broken JSON logic (e.g., categories=["None"]).
       - ALWAYS prefer a valid "Lower-Type" over an Invalid "Higher-Type".
       - IF ALL ELSE FAILS: Fallback to "Multiple Choice".

    7. **Scaffolding:**
       ${i==="exam"?"- **EXAM MODE:** Do NOT generate 'progressive_hints'. Return empty array [].":`- **Level 1 Hint:** Point to the specific text part.
- **Level 2 Hint:** Rephrase content.`}
       - **Feedback:** Explain WHY specific wrong choice is incorrect.

    Output FORMAT (JSON ONLY):
    {
       "step_number": ${e.step_number},
       "bloom_level": "${e.bloom_level}",
       "teach_content": ${i==="exam"?"null":`"${u?" !  ...":"Full explanation text"} (MUST start with / /  if math topic)"`},
       "selected_interaction": "${e.suggested_interaction_type}", 
       "data": {
          "progressive_hints": ["Hint 1", "Hint 2"],
          "source_reference_hint": "See section '...'",
          // DYNAMIC STRUCTURE BASED ON INTERACTION TYPE:
          // 1. MULTIPLE CHOICE / TRUE_FALSE:
          // { "question": "...", "options": ["A", "B", "C", "D"], "correct_answer": "A" }
          
          // 2. CATEGORIZATION:
          // { "question": "Sort the items...", "categories": ["Cat1", "Cat2"], "items": [{ "text": "Item1", "category": "Cat1" }] }
          
          // 3. ORDERING:
          // { "instruction": "Order the events...", "correct_order": ["Event 1", "Event 2", "Event 3"] }
          
          // 4. FILL IN BLANKS:
          // { "text": "The [Sun] is hot." } (MUST use brackets [] for hidden words, do NOT use underscores)
          
          // 5. MEMORY GAME:
          // { "question": "Match the pairs...", "pairs": [{ "card_a": "Term", "card_b": "Def" }] }
          
          // 6. OPEN QUESTION:
          // { "question": "...", "model_answer": "...", "points": 10 }
          
          // 7. AUDIO RESPONSE (Simulated Oral Exam):
          // { "question": "Explain in your own words...", "max_duration": 60 }
       }
    }
  `}];s&&k.push({type:"image_url",image_url:{url:`data:${s.mimeType};base64,${s.base64}`}});try{const R=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:k}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}",M=JSON.parse(ty(R));return i==="exam"&&M&&(M.teach_content="",M.data&&(M.data.progressive_hints=[])),M}catch(T){return console.error(`Step Gen Error (Step ${e.step_number}):`,T),null}},v7e=async(n,e,t,r,s)=>{console.log(` generateTeacherStepContent called with sourceType: ${r}, sourceText: ${e?`${e.substring(0,100)}... (${e.length} chars)`:"UNDEFINED"}`);const i=r==="TOPIC_ONLY"?n:e.substring(0,2e4),a=[{type:"text",text:`
    System Prompt: Master Teacher Lesson Architect V3 (Enhanced)

     IDENTITY:
    You are Michal Rosen, a veteran Israeli master teacher with 15 years of classroom experience.
    You create lesson plans that are:
    - Ultra-practical (every sentence is actionable)
    - Visually rich (auto-generated images, infographics, diagrams)
    - Interactive (embedded practice activities)
    - Field-tested (includes classroom management tips)

    YOUR CLIENT: A busy teacher preparing tomorrow's lesson.
    YOUR GOAL: Create a complete, ready-to-use lesson plan they can pick up 5 minutes before class.

    INPUT CONTEXT:
    SOURCE_TYPE: "${r}"
    CONTENT: """${i}"""
    GRADE_LEVEL: "${t}"
    DURATION: "45 Minutes"

     VISUAL GENERATION STRATEGY:

    CASE A: If SOURCE_TYPE == "YOUTUBE":
    - Use specific video timestamps
    - Example: "Play video 02:30-03:45 to show photosynthesis process"

    CASE B: If SOURCE_TYPE == "TEXT_FILE" or "TOPIC_ONLY":
    - Generate AI image prompts for DALL-E 3
    - Be SPECIFIC and VISUAL
    - Good: "A colorful diagram showing the water cycle with labeled arrows: evaporation from ocean, condensation in clouds, precipitation as rain, collection in rivers"
    - Bad: "An image about water cycle"

     IMAGE PROMPT GUIDELINES:
    - Start with art style: "Educational diagram", "Photorealistic", "Colorful illustration for grade ${t}"
    - If showing people/students: MUST specify age-appropriate characters - "${Gfe(t)}"
    - Include specific visual elements: colors, labels, arrows, comparisons
    - Keep culturally neutral and age-appropriate
    - Hebrew text in images should be minimal (use English labels)

     TONE & LANGUAGE REQUIREMENTS:
    - Use second person: " ..." (not " ...")
    - Conversational Hebrew: "   ..." (not "   ...")
    - Specific instructions: "    5 "" (not just "  ")

     GRADE-SPECIFIC ADAPTATION:
    ${t.includes("")||t.includes("")||t.includes("")?`
    - Primary grades (-): Use concrete examples from playground/family/pets
    - Max sentence length: 10 words
    - Add gestures: "(  ...)"
    - Repeat key concepts twice
    `:t.includes("")||t.includes("")||t.includes("")?`
    - Upper elementary (-): Mix concrete and abstract
    - Encourage "turn and talk" moments
    - Max sentence length: 15 words
    `:`
    - Secondary: Academic tone OK
    - Encourage debate and critical thinking
    - Reference current events
    `}

     CLASSROOM MANAGEMENT EMBEDS:
    Sprinkle these throughout the script:
    - In Hook: " [TIP:   ,  10  ]"
    - In Instruction: " [CHECK:    -   ?]"
    - In Practice: " [IF STUCK:    -slow motion]"

     CRITICAL CONSTRAINTS:
    - NO student-facing language (say " " not "  ")
    - NO quizzes in Hook/Instruction (save for Guided Practice)
    - NO gamification mentions
    - Script must be readable aloud naturally

    

    STRUCTURE (Enhanced 5-Step Model):

    1. THE HOOK (5 min)
    Goal: Engagement + Set learning objectives
    Output:
    - Engaging script (story/question/demonstration)
    - media_asset: ALWAYS generate ONE curiosity-provoking image (type = "illustration")
    - Classroom management tip
    - Learning objectives (2-3 bullet points)

     HOOK IMAGE STRATEGY - "THE RIDDLE":
    - ALWAYS generate an image that creates CURIOSITY or shows a PROBLEM/CONFLICT
    - DO NOT show a generic image of the topic - that's boring!
    - The image should make students ask "Why?" or "How?" or feel emotion

     HOOK IMAGE PROMPT GUIDELINES:
    - Show the PROBLEM, not the solution
    - Create visual tension or curiosity
    - Evoke emotion (surprise, concern, wonder)

     GOOD EXAMPLES:
    - Environment lesson: "A polar bear standing alone on a tiny melting ice chunk in vast ocean" (evokes emotion, raises questions)
    - Recycling lesson: "A sea turtle tangled in plastic bags underwater" (shows problem)
    - History lesson: "An empty throne with a broken crown on the floor" (creates mystery)

     BAD EXAMPLES:
    - Environment lesson: "A beautiful green Earth" (generic, boring)
    - Recycling lesson: "Recycling bins in a row" (no emotion, no curiosity)
    - History lesson: "A portrait of King David" (informative but not engaging)

    2. DIRECT INSTRUCTION (15 min)
    Goal: Frontal Teaching with Visual Support
    Output: 3-4 Teaching Slides, each with:
    - Slide title
    - Bullet points for board (3-5 items)
    - Script to say (conversational, 80-120 words)
    - media_asset: ALWAYS set type to "none" (NO images/infographics in slides!)
    - Timing estimate (e.g., "3-5 minutes")
    - Differentiation note (tips for struggling/advanced students)

     MEDIA BUDGET RULE FOR SLIDES:
    - DO NOT generate images for slides - focus on clear verbal explanations
    - The teacher will use the whiteboard for diagrams, not AI images
    - This prevents visual overload and keeps students focused on the teacher

    3. GUIDED PRACTICE (10 min) - IN-CLASS FACILITATION
    Goal: Teacher-led practice with SPECIFIC questions and worked examples
    Output:
    - Teacher facilitation script (how to introduce and guide the practice)
    - EXAMPLE QUESTIONS (2-3 specific questions for the teacher to ask):
      * question_text: The EXACT question to ask the class (in Hebrew)
      * expected_answer: What a correct answer should include
      * common_mistakes: 1-2 typical wrong answers to watch for
      * follow_up_prompt: How to probe deeper (e.g., "   ?")
    - WORKED EXAMPLE (demonstrate solution on the board):
      * problem: A specific problem/scenario to solve together
      * solution_steps: Step-by-step solution (3-5 steps)
      * key_points: Important things to emphasize while solving
    - Suggested activities (1-2) with pedagogical reasoning:
      * activity_type: Choose from multiple-choice, memory_game, ordering, categorization, etc.
      * description: What this activity should assess
      * facilitation_tip: How to guide students
    - Differentiation strategies:
      * for_struggling_students: Specific scaffolding (e.g., "    1 ,    2")
      * for_advanced_students: Extension challenge with specific example
    - Assessment tips (what to look for while students practice)

    4. INDEPENDENT PRACTICE (10 min) - DIGITAL ACTIVITIES
    Goal: Ready-to-use interactive activities students can do independently
     CRITICAL: Each interactive block MUST be complete and valid!
    Output:
    - Brief introduction text for students (in Hebrew)
    - 2-3 ready-to-use interactive blocks (choose DIFFERENT types for variety):
      * multiple-choice: { question, options (EXACTLY 4 options), correct_answer (must match one option) }
      * memory_game: { pairs: [{ card_a, card_b }] } - MINIMUM 4 pairs required!
      * fill_in_blanks: { text (with ___ blanks), word_bank (array of words) }
      * ordering: { instruction, correct_order (MINIMUM 4 items) }
      * categorization: { question, categories (2-3), items: [{ text, category }] - MINIMUM 4 items }
      * open-question: { question }
    - Estimated duration (e.g., "10-15 ")

     IMPORTANT RULES FOR INTERACTIVE BLOCKS:
    1. Generate EXACTLY 2-3 different activity types (not the same type twice!)
    2. Each block must have ALL required fields filled with real content
    3. For multiple-choice: options must be realistic distractors, not placeholder text
    4. For memory_game: pairs must be related (concept-definition, term-example, etc.)

    5. DISCUSSION (5 min)
    Goal: Oral Assessment + Critical Thinking
    Output:
    - 2-3 open-ended questions (increasing difficulty)
    - Facilitation tips (e.g., "Ask follow-up: 'Why do you think that?'")

    6. SUMMARY (5 min)
    Goal: Closure + Retention
    Output:
    - ONE memorable takeaway sentence (for notebooks)
    - visual_summary: ONE infographic (this is the ONLY visual in the entire lesson!)
    - Optional homework suggestion

     INFOGRAPHIC GUIDELINES FOR SUMMARY (THE ONLY VISUAL!):
    This is the ONE AND ONLY media item in the lesson (besides optional YouTube in Hook).
    Make it count! Choose the best type based on content:
    - FLOWCHART: Process with sequential steps (, )
    - TIMELINE: Chronological events (,  )
    - COMPARISON: Contrasting concepts (, )
    - CYCLE: Repeating process (,  )

     CRITICAL: The infographic MUST be about the LESSON'S SUBJECT MATTER!
    - If the lesson is about " " (waste and recycling), the infographic should visualize recycling concepts (e.g., the 5Rs cycle, types of waste, recycling process)
    - If the lesson is about "  ", the infographic should show WWII events/timeline
    - DO NOT create infographics about META-SKILLS like "how to analyze text" or "reading comprehension steps"
    - The infographic visualizes the CONTENT being taught, not the teaching METHOD

    Provide a DETAILED description for the infographic that captures the lesson's KEY SUBJECT MATTER concepts!

    OUTPUT FORMAT (JSON Schema): Generate valid JSON in Hebrew (except for field keys).

    {
      "lesson_metadata": {
        "title": "String (Hebrew - catchy lesson title. DO NOT prefix with ' :' - just the topic name)",
        "target_audience": "${t}",
        "duration": "45 min",
        "subject": "String (e.g., , )",
        "learning_objectives": [
          "  1",
          "  2"
        ]
      },
      "hook": {
        "script_for_teacher": "String (Hebrew - engaging opening script, 80-120 words)",
        "media_asset": {
          "type": "${r==="YOUTUBE"?"youtube_timestamp":"none"}",
          "content": "${r==="YOUTUBE"?"Start: 00:00, End: 02:00":""}"
        },
        "classroom_management_tip": " [TIP: specific tip in Hebrew]"
      },
      "direct_instruction": {
        "slides": [
          {
            "slide_title": "String (Hebrew)",
            "bullet_points_for_board": ["Point 1", "Point 2", "Point 3"],
            "script_to_say": "String (Hebrew - conversational, 80-120 words)",
            "media_asset": {
              "type": "none",
              "content": ""
            },
            "timing_estimate": "3-5 ",
            "differentiation_note": "  : [tip].  : [challenge]"
          }
        ]
      },
      "guided_practice": {
        "teacher_facilitation_script": "String (Hebrew - how to introduce and guide the practice)",
        "example_questions": [
          {
            "question_text": "    ",
            "expected_answer": "    ",
            "common_mistakes": ["  1", "  2"],
            "follow_up_prompt": "  "
          },
          {
            "question_text": " ",
            "expected_answer": " ",
            "common_mistakes": [" "],
            "follow_up_prompt": " "
          }
        ],
        "worked_example": {
          "problem": "/     ",
          "solution_steps": [
            " 1: ...",
            " 2: ...",
            " 3: ...",
            " 4: ..."
          ],
          "key_points": [
            "   1",
            "   2"
          ]
        },
        "suggested_activities": [
          {
            "activity_type": "multiple-choice",
            "description": "  ...",
            "facilitation_tip": " 2   ,   "
          }
        ],
        "differentiation_strategies": {
          "for_struggling_students": "    ",
          "for_advanced_students": "    "
        },
        "assessment_tips": [
          "  ...",
          " ..."
        ]
      },
      "independent_practice": {
        "introduction_text": "String (Hebrew - brief instructions for students)",
        "interactive_blocks": [
          {
            "type": "multiple-choice",
            "data": {
              "question": "String (Hebrew - clear question about the topic)",
              "options": [" 1", " 2", " 3", " 4"],
              "correct_answer": " 1"
            }
          },
          {
            "type": "memory_game",
            "data": {
              "pairs": [
                { "card_a": " 1", "card_b": " 1" },
                { "card_a": " 2", "card_b": " 2" },
                { "card_a": " 3", "card_b": " 3" },
                { "card_a": " 4", "card_b": " 4" }
              ]
            }
          }
        ],
        "estimated_duration": "10-15 "
      },
      "discussion": {
        "questions": [
          " 1 ()",
          " 2 ()",
          " 3 ()"
        ],
        "facilitation_tips": [
          " : '   ?'",
          "  ,  "
        ]
      },
      "summary": {
        "takeaway_sentence": "String (Hebrew - one memorable sentence for notebooks)",
        "visual_summary": {
          "type": "infographic",
          "content": "DETAILED prompt describing the SUBJECT MATTER to visualize (e.g., for a lesson about recycling: 'Create an infographic showing the 5Rs cycle: Reduce, Reuse, Recycle, Recover, Refuse - with icons and Hebrew labels for each step'). MUST be about the lesson topic, NOT about learning skills!",
          "prompt": "Same as content"
        },
        "homework_suggestion": "String (optional, Hebrew)"
      }
    }
  `}];s&&r==="TEXT_FILE"&&a.push({type:"image_url",image_url:{url:`data:${s.mimeType};base64,${s.base64}`}});try{const c=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}";return JSON.parse(ty(c))}catch(l){return console.error("Teacher Lesson Gen Error:",l),null}},Xfe=async(n,e,t,r)=>{console.log(` [Part1] Generating Hook + Direct Instruction for: ${n}`);const s=Date.now(),i=r==="TOPIC_ONLY"?n:e.substring(0,15e3),o=`
    You are a Master Teacher creating PART 1 of a lesson plan (Hook + Direct Instruction).

    CONTEXT:
    - Topic: "${n}"
    - Grade: "${t}"
    - Source: ${r==="YOUTUBE"?"YouTube video":r==="TEXT_FILE"?"Text document":"Topic only"}
    ${r!=="TOPIC_ONLY"?`- Content: """${i}"""`:""}

    Generate ONLY these sections in Hebrew:

    1. LESSON_METADATA:
       - title: Catchy lesson title about the SUBJECT MATTER (Hebrew, no prefix)
         CRITICAL: Title must be about the CONTENT topic (e.g., " ", " ")
         DO NOT create titles about META-SKILLS (e.g., "  ", " ")
       - target_audience: "${t}"
       - duration: "45 min"
       - subject: Subject area
       - learning_objectives: 2-3 specific objectives about the CONTENT

    2. HOOK (5 min):
       - script_for_teacher: Engaging opening script (80-120 words, conversational Hebrew)
       - media_asset: { type: "${r==="YOUTUBE"?"youtube_timestamp":"illustration"}", content: "${r==="YOUTUBE"?"timestamp range":"detailed image prompt for curiosity-provoking visual"}" }
       - classroom_management_tip: One practical tip

    3. DIRECT_INSTRUCTION (15 min):
       - slides: Array of 3-4 slides, each with:
         * slide_title: Hebrew title
         * bullet_points_for_board: 3-5 points
         * script_to_say: 80-120 words conversational Hebrew
         * media_asset: { type: "none", content: "" }
         * timing_estimate: e.g., "3-5 "
         * differentiation_note: Tips for struggling/advanced students

    OUTPUT: Valid JSON only (no markdown, no explanations).
    {
      "lesson_metadata": { ... },
      "hook": { ... },
      "direct_instruction": { "slides": [...] }
    }
  `;try{const l=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:o}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}",c=JSON.parse(ty(l));return console.log(` [Part1] Completed in ${Date.now()-s}ms`),c}catch(a){return console.error("[Part1] Generation Error:",a),null}},Jfe=async(n,e,t,r)=>{console.log(` [Part2] Generating Practice + Discussion + Summary for: ${n}`);const s=Date.now(),i=e?e.substring(0,1e4):n,o=(r==null?void 0:r.length)>0?r.join(`
- `):"   ",a=`
    You are a Master Teacher creating PART 2 of a lesson plan (Practice + Discussion + Summary).

    CONTEXT:
    - Topic: "${n}"
    - Grade: "${t}"
    - Learning Objectives:
      - ${o}
    - Content reference: """${i}"""

     CRITICAL: You MUST fill ALL fields with real Hebrew content. Empty or placeholder values are NOT acceptable!

    Generate these sections in Hebrew:

    1. GUIDED_PRACTICE (10 min):
       - teacher_facilitation_script: 2-3 sentences explaining how to introduce practice
       - example_questions: EXACTLY 2 questions, each with ALL these fields:
         * question_text: The actual question in Hebrew
         * expected_answer: The correct answer
         * common_mistakes: Array of 1-2 common wrong answers
         * follow_up_prompt: A follow-up question
       - worked_example: { problem: "specific problem", solution_steps: [" 1", " 2", " 3"], key_points: [" 1", " 2"] }
       - differentiation_strategies: { for_struggling_students: "specific help", for_advanced_students: "specific challenge" }
       - assessment_tips: ["tip 1", "tip 2"]

    2. INDEPENDENT_PRACTICE (10 min - Digital activities):
       - introduction_text: Brief instructions in Hebrew
       - interactive_blocks: Generate EXACTLY 2 activities. Choose 2 DIFFERENT types:

         OPTION A - multiple-choice (MUST have exactly 4 options):
         {
           "type": "multiple-choice",
           "data": {
             "question": "  ?",
             "options": [" ", " ", " ", " "],
             "correct_answer": " "
           }
         }

         OPTION B - categorization (MUST have 4+ items):
         {
           "type": "categorization",
           "data": {
             "question": "   :",
             "categories": [" 1", " 2"],
             "items": [
               { "text": " 1", "category": " 1" },
               { "text": " 2", "category": " 2" },
               { "text": " 3", "category": " 1" },
               { "text": " 4", "category": " 2" }
             ]
           }
         }

         OPTION C - fill_in_blanks:
         {
           "type": "fill_in_blanks",
           "data": {
             "text": "  ___  ___ ",
             "word_bank": ["1", "2", "1", "2"]
           }
         }

         OPTION D - ordering (MUST have 4+ items):
         {
           "type": "ordering",
           "data": {
             "instruction": "    :",
             "correct_order": [" 1", " 2", " 3", " 4"]
           }
         }

       - estimated_duration: "10-15 "

    3. DISCUSSION (5 min):
       - questions: Array of 3 STRING questions (NOT objects!), easy to hard:
         [" ?", " ?", " ?"]
       - facilitation_tips: Array of 2 STRING tips:
         [" 1", " 2"]

    4. SUMMARY (5 min):
       - takeaway_sentence: One memorable Hebrew sentence
       - visual_summary: { "type": "infographic", "content": "Detailed prompt about ${n} - describe the key concepts to visualize" }
       - homework_suggestion: Optional homework in Hebrew

    OUTPUT: Valid JSON only. Fill EVERY field with real content!
  `;try{const c=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}",u=JSON.parse(ty(c)),h=Qfe(u,n);return console.log(` [Part2] Completed in ${Date.now()-s}ms`),h}catch(l){return console.error("[Part2] Generation Error:",l),null}};function Qfe(n,e){var t,r,s,i,o;return(t=n.discussion)!=null&&t.questions?n.discussion.questions=n.discussion.questions.map(a=>typeof a=="string"?a:typeof a=="object"?a.question||a.text||a.question_text||`  ${e}`:`  ${e}`):(n.discussion=n.discussion||{},n.discussion.questions=[`    ${e}?`,"     ?","  ?"]),(r=n.discussion)!=null&&r.facilitation_tips?n.discussion.facilitation_tips=n.discussion.facilitation_tips.map(a=>typeof a=="string"?a:typeof a=="object"&&(a.tip||a.text)||"  "):n.discussion.facilitation_tips=[' "   ?"',"    "],!((s=n.independent_practice)!=null&&s.interactive_blocks)||n.independent_practice.interactive_blocks.length===0?(n.independent_practice=n.independent_practice||{},n.independent_practice.introduction_text=n.independent_practice.introduction_text||"   :",n.independent_practice.interactive_blocks=[{type:"multiple-choice",data:{question:`     ${e}?`,options:[" "," "," "," "],correct_answer:" "}}],n.independent_practice.estimated_duration="10-15 "):n.independent_practice.interactive_blocks=n.independent_practice.interactive_blocks.map(a=>!a.data||Object.keys(a.data).length===0?(console.warn(`[Part2] Interactive block "${a.type}" missing data - will be filtered`),null):a).filter(Boolean),(i=n.summary)!=null&&i.takeaway_sentence||(n.summary=n.summary||{},n.summary.takeaway_sentence=`   ${e}    .`),(o=n.summary)!=null&&o.visual_summary||(n.summary.visual_summary={type:"infographic",content:`Create an infographic summarizing the key concepts of ${e}`}),n}const w7e=async(n,e,t,r,s)=>{console.log(` [Parallel] Starting parallel lesson generation for: ${n}`);const i=Date.now(),o=Xfe(n,e,t,r),a=Jfe(n,e,t,[` ${n}`,`  ${n}`]),l=await o;l&&s&&(console.log(` [Parallel] Part1 ready - notifying UI (${Date.now()-i}ms)`),s(l));const c=await a;if(l&&c){const u={lesson_metadata:l.lesson_metadata,hook:l.hook,direct_instruction:l.direct_instruction,guided_practice:c.guided_practice,independent_practice:c.independent_practice,discussion:c.discussion,summary:c.summary};return console.log(` [Parallel] Full lesson ready in ${Date.now()-i}ms`),u}return l&&!c?(console.warn("[Parallel] Part2 failed, using partial result"),{...l,guided_practice:{teacher_facilitation_script:" ",example_questions:[],worked_example:{problem:"",solution_steps:[],key_points:[]},differentiation_strategies:{for_struggling_students:"",for_advanced_students:""},assessment_tips:[]},independent_practice:{introduction_text:"   ",interactive_blocks:[],estimated_duration:"10 "},discussion:{questions:[],facilitation_tips:[]},summary:{takeaway_sentence:"",visual_summary:{type:"infographic",content:""}}}):null},k7e=async n=>{var u,h,f;console.log(" Starting visual generation (Media Budget: Hook image + Summary infographic)...");const e={...n},t=async(p,g,y)=>{try{let v=null;if(g==="infographic"&&y)console.log(` Generating ${y} infographic...`),v=await V6(p,y,e.lesson_metadata.title);else{console.log(" Generating illustration image...");const b=`Create a colorful, engaging educational illustration for a classroom lesson about: ${p}.
Style: Clean, modern, suitable for students. Include visual elements that represent the topic clearly.
The image should be eye-catching and help introduce the lesson topic.
Do NOT include any text in the image - visuals only.`;v=await $q(b)}if(v){const b=await $6(p,y||"flowchart"),w=await Bq(b,v);return console.log(" Image uploaded to Firebase Storage"),w}return null}catch(v){return console.error("Image generation/upload failed:",v),null}},r=e.hook.media_asset;console.log(" Generating hook 'curiosity' illustration...");let s;if(r&&r.content&&r.type==="illustration")s=r.content;else{const p=e.lesson_metadata.title,g=e.lesson_metadata.subject||"education";s=`Create a thought-provoking, emotionally engaging image that raises curiosity about "${p}". Show a PROBLEM or CONFLICT related to the topic, not the solution. The image should make viewers ask "Why?" or "How?". Style: photorealistic, dramatic lighting, educational context for ${g}.`}const i=await t(s,"illustration");i?(e.hook.media_asset={type:"illustration",content:s,url:i,status:"generated"},console.log(" Hook curiosity illustration generated successfully")):console.log(" Hook illustration generation failed");const o=e.summary.takeaway_sentence||e.lesson_metadata.title;(!e.summary.visual_summary||e.summary.visual_summary.type!=="infographic")&&(console.log(" visual_summary not properly set by AI, creating default infographic structure..."),e.summary.visual_summary={type:"infographic",content:o,status:"pending"});const a=e.summary.visual_summary.content||o,l=U6(a);console.log(` Summary: Auto-detected ${l.suggestedType} infographic`),console.log(`   Content: "${a.substring(0,80)}..."`);const c=await t(a,"infographic",l.suggestedType);return c&&e.summary.visual_summary?(e.summary.visual_summary.url=c,e.summary.visual_summary.status="generated",console.log(" Summary infographic generated successfully")):e.summary.visual_summary&&(e.summary.visual_summary.status="failed",console.log(" Summary infographic generation failed")),console.log(" Media Budget Summary:"),console.log(`    Hook: ${(u=e.hook.media_asset)!=null&&u.url?"Image ":((h=e.hook.media_asset)==null?void 0:h.type)==="youtube_timestamp"?"YouTube ":"None"}`),console.log("    Slides: None (teacher uses whiteboard)"),console.log(`    Summary: ${((f=e.summary.visual_summary)==null?void 0:f.status)==="generated"?"Infographic ":"None"}`),e},_7e=async(n,e)=>{try{const t=`
      generate a "Deep Dive" podcast script between two hosts, Dan and Noa.
      Topic: ${e||"The provided text"}
      Source Material: """${n.substring(0,15e3)}"""
      
      Characters:
      - Dan: Enthusiastic, uses analogies, asks the "dumb" questions to clarify things.
      - Noa: The expert, skeptical but clear, brings the data.
      
      Format: JSON matching:
      {
        "title": "Fun Title",
        "lines": [
          { "speaker": "Dan", "text": "...", "emotion": "Excited" },
          { "speaker": "Noa", "text": "...", "emotion": "Neutral" }
        ]
      }
      
      Language: Hebrew.
      Length: Approx 10-15 exchanges.
      Style: Conversational, fun, like "NotebookLM".
      `,s=(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:t}],response_format:{type:"json_object"}})).choices[0].message.content||"{}";return JSON.parse(s)}catch(t){return console.error("Podcast Gen Error:",t),null}},S7e=async(n,e,t="medium",r="General",s,i="activity")=>{const o=i==="lesson"?1:t==="short"?3:t==="long"?8:5;console.log(" generateCourseSyllabus called with sourceText:",s?`${s.substring(0,100)}... (${s.length} chars)`:"UNDEFINED");const a=s?`
      SOURCE CONTENT (Base the syllabus STRICTLY on this content):
      """
      ${s.substring(0,1e4)}
      """

      CRITICAL: The syllabus MUST be derived from the source content above. Do NOT invent topics that are not covered in the source text.
    `:"",l=`
      Task: Create a Syllabus (Table of Contents) for a Lesson Plan.
      Topic: "${n}"
      Subject: ${r}
      Target Audience: ${e}
      Count: Exactly ${o} distinct Learning Units.
      Language: Hebrew.

      ${a}

      CRITICAL RULES FOR UNIT TITLES:
      - The unit title must describe the SUBJECT MATTER CONTENT (e.g., " ", " ", "  ")
      - DO NOT create titles about learning SKILLS or META-SKILLS (e.g., "  ", " ", " ")
      - If the source text is ABOUT recycling, the title should be about recycling - NOT about "analyzing informational text about recycling"
      - The lesson teaches the CONTENT, not the skill of reading/analyzing

      Structure:
      - Divide the topic into logical "Phases" or "Modules".
      - Each Module contains 1-2 Learning Units.
      - Total Learning Units: ${o}.
      ${s?'- IMPORTANT: Unit titles must reflect the actual SUBJECT MATTER from the source text (not meta-skills like "text analysis").':""}

      Output JSON:
      {
        "modules": [
          {
            "title": "Module Title (e.g., 'Phase 1: Introduction')",
            "units": [
              { "title": "Unit Title - must be about the CONTENT topic (e.g., '  ', NOT '   ')" }
            ]
          }
        ]
      }
    `;try{const u=(await Ci.chat.completions.create({model:"gpt-4o",messages:[{role:"system",content:"You are a Curriculum Architect. Output strict JSON."},{role:"user",content:l}],response_format:{type:"json_object"},temperature:.7})).choices[0].message.content||"{}";return(JSON.parse(ty(u)).modules||[]).map(f=>({id:cn(),title:f.title,learningUnits:(f.units||[]).map(p=>({id:cn(),title:p.title,type:"practice",activityBlocks:[],metadata:{status:"pending"}}))}))}catch(c){return console.error("Syllabus Gen Error:",c),[{id:cn(),title:" ",learningUnits:[{id:cn(),title:n,type:"practice",activityBlocks:[],metadata:{status:"pending"}}]}]}},T7e=async n=>{if(!n||n.length<50)return" ";const t=`
    Task: Extract the main topic/subject from the following text.

    TEXT:
    """
    ${n.substring(0,3e3)}
    """

    RULES:
    - Return ONLY the topic name in Hebrew (2-6 words maximum)
    - Focus on the CONTENT topic, not meta-descriptions
    - Examples of good outputs: " ", "  ", "  "
    - Examples of BAD outputs: " ", " ", " ..."
    - If the text is about multiple topics, pick the most prominent one
    - If you can't determine a topic, return " "

    Output: Just the topic name, nothing else.
  `;try{const r=await Q3([{role:"user",content:t}],{temperature:.3,maxTokens:50}),s=r==null?void 0:r.trim().replace(/["""]/g,"").trim();return s&&s.length>2&&s.length<100?s:" "}catch(r){return console.error("Topic extraction error:",r)," "}},A7e=async(n,e,t,r="",s,i=!0,o,a,l,c)=>{var h;const u=QU(G0());try{const f=o==="exam"?"exam_generation_queue":"course_generation_queue";console.log(` Routing to queue: ${f} (productType: ${o})`);const p=await Fw(Zs(u,f),{topic:n,gradeLevel:e,subject:r,fileData:t||null,sourceText:s||null,activityLength:a||"medium",taxonomy:l||null,productType:o||null,questionPreferences:c||null,status:"pending",createdAt:new Date,userId:((h=jc.currentUser)==null?void 0:h.uid)||null});return new Promise((g,y)=>{const v=Ab(or(u,f,p.id),b=>{const w=b.data();if(w)if(w.status==="completed"&&w.result){v();let k=[...w.result];k=k.map(T=>({...T,learningUnits:(T.learningUnits||[]).map(R=>({...R,activityBlocks:(R.activityBlocks||[]).filter(M=>i||M.type!=="interactive-chat").map(M=>{var E;if(M.type==="multiple-choice"&&Array.isArray((E=M.content)==null?void 0:E.options)){const I=[...M.content.options].sort(()=>Math.random()-.5);return{...M,content:{...M.content,options:I}}}return M})}))})),g(k)}else w.status==="error"&&(v(),y(new Error(w.error||"Unknown error during generation")))},b=>{console.error("Firestore listener error:",b),y(b)})})}catch(f){throw console.error("Failed to queue request:",f),f}},E7e=async n=>{try{const{generateGeminiImage:e,isGeminiImageAvailable:t}=await Ln(async()=>{const{generateGeminiImage:s,isGeminiImageAvailable:i}=await import("./imagenService-D9X-XJ8a.js");return{generateGeminiImage:s,isGeminiImageAvailable:i}},[]);if(!t())return console.error("Gemini Image not available"),null;const r=await e(n);return r||null}catch(e){return console.error("Error generating image (Gemini):",e),null}},Zfe=async(n,e,t="",r,s="",i,o,a=!0,l="learning",c="medium")=>{var g,y;console.log("generateFullUnitContent RECEIVED MODE:",l,"LENGTH:",c);let u="",h=[],f="",p=5;if(c==="short"?p=3:c==="long"&&(p=7),l==="learning")c==="short"?f=`
          ## STEP 1: FOUNDATION (Remember/Understand)
          - **Goal:** Establish facts and definitions.
          - **Allowed Types:** multiple_choice, true_false.

          ## STEP 2: CONNECTION (Apply/Analyze)
          - **Goal:** Understand relationships.
          - **Allowed Types:** ordering, grouping.

          ## STEP 3: SYNTHESIS (Evaluate/Create)
          - **Goal:** Critical thinking.
          - **Allowed Types:** multiple_choice (Scenario), open_question.
          `:c==="long"?f=`
          ## STEPS 1-2: FOUNDATION (Remember/Understand)
          - **Goal:** Solidify base knowledge.
          - **Allowed Types:** multiple_choice, true_false.

          ## STEPS 3-5: CONNECTION (Apply/Analyze)
          - **Goal:** Deep dive into processes and categories.
          - **Allowed Types:** ordering (Process/Timeline), grouping (Categorization), matching.

          ## STEPS 6-7: SYNTHESIS (Evaluate/Create)
          - **Goal:** Complex scenarios and creation.
          - **Allowed Types:** multiple_choice (Complex Scenario), open_question.
          `:f=`
          ## STEPS 1-2: FOUNDATION (Remember/Understand)
          - **Goal:** Establish facts.
          - **Allowed Types:** multiple_choice, true_false.

          ## STEPS 3-4: CONNECTION (Apply/Analyze)
          - **Goal:** Connect concepts.
          - **Allowed Types:** ordering, grouping, matching.

          ## STEP 5: SYNTHESIS (Evaluate/Create)
          - **Goal:** Critical thinking.
          - **Allowed Types:** multiple_choice (Scenario), open_question.
          `;else{const w=Math.max(1,Math.round(.33*p)),k=Math.max(1,Math.round(33/100*p)),T=Math.max(1,p-w-k);f=`
          ## DISTRIBUTION (Required by User Configuration):
          - **Foundation (Recall):** ${w} Questions.
          - **Connection (Analysis):** ${k} Questions.
          - **Synthesis (Evaluation):** ${T} Questions.
          
          ## BLOCK 1: FOUNDATION (${w} Qs)
          - Interactions: Multiple Choice, True/False.
          
          ## BLOCK 2: CONNECTION (${k} Qs)
          - Interactions: Ordering, Categorization, Fill-in-Blanks.
          
          ## BLOCK 3: SYNTHESIS (${T} Qs)
          - Interactions: Open Question, Complex Scenario MC.
      `}if(l==="learning"){const v=Gq(p);f=`
      ## WIZDI PYRAMID DISTRIBUTION (Fixed Structure):
      The user requested a ${c} activity (${p} steps).
      You must follow this EXACT cognitive progression:
      ${v.map((b,w)=>`${w+1}. Step ${w+1}: ${b}`).join(`
      `)}

      ##     (INTERACTION RULES):
      - **/ (Remember/Understand):**   (Multiple Choice), /  (True/False),   (Memory Game).
      - **/ (Apply/Analyze):**   (Ordering),   (Categorization),   (Fill-in-Blanks).
      - **/ (Evaluate/Create):**   (Open Question),   (Complex Scenario).
      `,console.log(" Mode: Learning (Storyteller / Topic-Based)"),u=`
        # ROLE
        You are an expert Pedagogical Architect and engaging Storyteller.
      Subject: ${s}. Target Audience: ${t}.
    Language: Hebrew.
  
        # GOAL
        Create a ${p} -step scaffolded learning activity.
        Do NOT use the same question type for every step.Analyze the content and select the BEST interaction type.
  
        # DYNAMIC INTERACTION STRATEGY
        ${f}
  
        # JSON OUTPUT FORMAT
    {
      "learning_unit": {
        "title": "${n}",
          "steps": [
            {
              "step_number": 1,
              "bloom_level": "Foundation",
              "selected_interaction": "multiple_choice",
              "teach_content": "Short engaging explanation...",
              "data": {
                "question": "Question text...",
                "progressive_hints": ["Hint 1", "Hint 2", "Hint 3"],
                "options": [
                  { "id": "o1", "text": "Opt1", "is_correct": true, "feedback": "Good job!" },
                  { "id": "o2", "text": "Opt2", "is_correct": false, "feedback": "Hint..." }
                ],
                // "correct_answer" is now implicit in options, but keep for fallback
              }
            },
            // ... Generate exactly ${p} steps following the strategy above
          ]
      }
    }
  
        # APPENDIX: DATA STRUCTURE RULES
      - ** ordering **: "items" list in CORRECT order.
        - ** grouping **: "items" list with "group_index" mapping to "groups".
        - ** matching **: treat as ** grouping ** (Left side = groups, Right side = items).
        - ** open_question **: "data" has "question" and "model_answer".
  
        # OUTPUT FORMAT(JSON ONLY)
        Return a VALID JSON object with the "learning_unit" root.
      `,h.push({type:"text",text:`Task: Create Learning Journey for "${n}"(Topic: ${e}).`})}else console.log(" Mode: Exam (Assessment)"),u=`
        You are a captivating Storyteller and Private Tutor.
      Subject: ${s}. Target Audience: ${t}.
    Language: Hebrew.

      TASK: Create a specific "Learning Journey"(NOT A QUIZ).

        TONE & STYLE:
    - Fascinating, engaging, and narrative - driven.
        - Do NOT use dry "textbook" language.Use phrases like "Imagine that...", "Surprisingly...", "Let's dive into...".
        - The "content_to_read" must feel like a micro - story or a fascinating fact, not a definition.
        
        For the topic: "${e}", Unit: "${n}".

        Create a JSON with "learning_unit" containing "cards".
      CRITICAL: Teach first, then ask.

        # EXAMPLE JSON(STRICTLY FOLLOW THIS STRUCTURE)
    {
      "learning_unit": {
        "title": "Topic Name",
          "cards": [
            {
              "type": "teach_then_ask",
              "content_to_read": "Imagine a world where money has lost all value. In 1923 Germany, a loaf of bread cost millions of marks! This chaos made people desperate for a strong leader who promised order.",
              "interactive_question": {
                "text": "Why were people in Germany willing to listen to extreme leaders like Hitler?",
                "options": ["They were bored", "They were desperate for stability", "They wanted to experiment"],
                "correct_answer": "They were desperate for stability",
                "feedback_correct": "Exactly! Desperate times often push people toward extreme solutions.",
                "feedback_incorrect": "Think about the chaos of paying millions for bread. They wanted Order."
              }
            }
          ]
      }
    }

        # OUTPUT FORMAT(JSON ONLY)
        Return a VALID JSON object with the "learning_unit" root.Do not wrap in markdown code blocks.
      `,h.push({type:"text",text:`Topic: ${e}. Create the Learning Journey.`});try{const b=(await Ci.chat.completions.create({model:ao,messages:[{role:"system",content:u},{role:"user",content:h}],temperature:l==="learning"?.7:.3,response_format:{type:"json_object"}},{timeout:18e4})).choices[0].message.content||"[]";let w=[];const k=[];try{const R=JSON.parse(b);if(l==="learning"){const M=((g=R.learning_unit)==null?void 0:g.steps)||((y=R.learning_unit)==null?void 0:y.cards)||[];if(Array.isArray(M)&&(M.forEach(E=>{(E.teach_content||E.content_to_read)&&k.push({id:cn(),type:"text",content:E.teach_content||E.content_to_read,metadata:{note:`Step ${E.step_number||""}: ${E.bloom_level||""} `}});const I=fD(E);I&&k.push(I)}),k.length>0))return k}Array.isArray(R)?w=R:R.items&&Array.isArray(R.items)?w=R.items:w=Object.values(R).find(M=>Array.isArray(M))||[]}catch(R){console.error("JSON Parse Error",R),w=[]}k.push({id:cn(),type:"text",content:`# ! 
  ** ${n}**  .
   .!`,metadata:{}});const T=o&&o.botPersona?bD[o.botPersona]:bD.socratic;return a&&k.push({id:cn(),type:"interactive-chat",content:{title:T.name,description:`  ${s} `},metadata:{botPersona:T.id,initialMessage:T.initialMessage,systemPrompt:`${T.systemPrompt} 

 : ${n} 
 : ${t} `}}),Array.isArray(w)&&w.forEach(R=>{const M=fD(R);M&&k.push(M)}),k}catch(v){return console.error("OpenAI Error:",v),[]}},C7e=async(n,e,t="",r,s="",i,o,a=!0,l="learning",c="medium",u=!0)=>{const h=await Zfe(n,e,t,r,s,i,o,a,l,c);if(!u||h.length===0)return h;console.log(` Generating adaptive variants for ${h.length} blocks...`);const f=["multiple-choice","open-question","fill_in_blanks","ordering","true_false","categorization"],p=await Promise.all(h.map(async g=>{var y,v;if(f.includes(g.type))try{const b=await qfe(g,e);return console.log(` Generated variants for block ${g.id}: scaffolding=${!!((y=b.metadata)!=null&&y.scaffolding_id)}, enrichment=${!!((v=b.metadata)!=null&&v.enrichment_id)}`),b}catch(b){return console.warn(` Failed to generate variants for block ${g.id}:`,b),g}return g}));return console.log(` Adaptive content generation complete. ${p.filter(g=>{var y;return(y=g.metadata)==null?void 0:y.has_variants}).length} blocks have variants.`),p},N7e=async(n,e)=>{const t=`
    Act as an expert pedagogical editor.
    Original text: "${n}"
    Instruction: ${e}
    Output language: Hebrew.
      Goal: Improve clarity, accuracy, and engagement.
  `;try{return(await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:t}]})).choices[0].message.content||n}catch(r){return console.error("Refine Error:",r),n}},X0=async(n,e,t)=>{if(!(t==="math"||/|||||||||||||||/.test(n)))return"";try{const s=e.match(/\s*([-]{1,2})/),i=e.match(/^([-]{1,2})[']?$/),o=e.match(/(\d{1,2})/);let a="";s?a=s[1]:i?a=i[1]:o&&(a={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:"",11:"",12:""}[o[1]]||""),console.log(` Fetching pedagogical context for: ${n}, grade ${a}`);const l=await Vq(n,a);if(l.rawContext||l.exercises.length>0){const u=Uq(l);return console.log(` Found pedagogical context: ${l.exercises.length} exercises, ${l.studentAddressing.length} addressing patterns, ${l.questionPhrasing.length} question patterns`),u}console.log(` Fallback to basic knowledge context for: ${n}, grade ${a}`);const c=await $fe(n,a);if(c)return console.log(` Found basic knowledge context (${c.length} chars)`),Vfe(c)}catch(s){console.warn("Failed to fetch knowledge context:",s)}return""},epe=async(n,e,t,r)=>{const s=await X0(n,e,r);let o=t&&t.trim().length>0?`**CRITICAL: BASE YOUR CONTENT ONLY ON THIS SOURCE TEXT:**
"""${t.substring(0,3e3)}"""

**IMPORTANT:** You MUST extract actual concepts, terms and items from the source text above. DO NOT use generic examples.`:`Topic: "${n}"`;s&&(o=`${s}

---

${o}`);const a=`
    Create a detailed Categorization Activity in Hebrew.
      ${o}
    Target Audience: ${e}.
    Language: Hebrew.

    Task: Create 2 Mutually Exclusive Categories and 6-8 items FROM THE SOURCE TEXT.

    **CRITICAL RULES:**
    1. Categories and items MUST be extracted from the source text
    2. DO NOT use generic examples - use actual content from the text
    3. Categories must be distinct (e.g., "/", "/", "/")
    4. All items must be directly mentioned or clearly derived from the source text
    5. Determine the learning level:
       - "": Basic categorization of simple concepts
       - "": Categorization requiring application of knowledge
       - "": Complex categorization requiring analysis

    JSON Output (Hebrew):
    {
      "question": "    :",
      "categories": ["[ ]", "[ ]"],
      "items": [{ "text": "[ ]", "category": "[ ]" }],
      "learning_level": "" | "" | ""
    }
    `;try{const l=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"}}),c=JSON.parse(l.choices[0].message.content||"{}");if(!c.categories||c.categories.length<2||!c.items||c.items.length<2)return null;const u=["","",""];return c.learning_level=u.includes(c.learning_level)?c.learning_level:"",c}catch{return null}},tpe=async(n,e,t,r)=>{const s=await X0(n,e,r);let o=t&&t.trim().length>0?`**CRITICAL: BASE YOUR CONTENT ONLY ON THIS SOURCE TEXT:**
"""${t.substring(0,3e3)}"""

**IMPORTANT:** You MUST extract the actual sequence/steps from the source text above. DO NOT use generic placeholders like "Step 1", "Step 2". Use the REAL content from the text.`:`Topic: "${n}"`;s&&(o=`${s}

---

${o}`);const a=`
    Create an Ordering / Sequencing Activity in Hebrew.
      ${o}
    Target Audience: ${e}.
    Language: Hebrew.

    Task: Extract a logical sequence FROM THE SOURCE TEXT.

    **CRITICAL RULES:**
    1. Each item in correct_order MUST be actual content extracted from the source text
    2. DO NOT use generic labels like " ", " " - use the REAL steps/events from the text
    3. If the text describes a historical process - use the actual historical events
    4. If the text describes a procedure - use the actual procedure steps
    5. If no clear sequence exists, order items by logical progression found in the text
    6. Items should be concise but specific to the content
    7. Determine the learning level:
       - "": Simple ordering of clearly stated sequence
       - "": Ordering requiring logical reasoning
       - "": Complex ordering requiring analysis of relationships

    JSON Output (Hebrew):
    {
      "instruction": "  [/]  :",
      "correct_order": ["[  ]", "[  ]", "[  ]"],
      "learning_level": "" | "" | ""
    }
    `;try{const l=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"}}),c=JSON.parse(l.choices[0].message.content||"{}");if(!c.correct_order||c.correct_order.length<2)return null;const u=["","",""];return c.learning_level=u.includes(c.learning_level)?c.learning_level:"",c}catch{return null}},npe=async(n,e,t,r)=>{const s=await X0(n,e,r);let o=t&&t.trim().length>0?`**CRITICAL: BASE YOUR CONTENT ONLY ON THIS SOURCE TEXT:**
"""${t.substring(0,3e3)}"""

**IMPORTANT:** Create a fill-in-the-blanks exercise using actual content from this source text. The hidden words must be key terms that appear in the source.`:`Topic: "${n}"`;s&&(o=`${s}

---

${o}`);const a=`
    Create a Fill-in-the-Blanks (Cloze) Text in Hebrew.
      ${o}
    Target Audience: ${e}.
    Language: Hebrew.

    Task: Write a summary paragraph based on the source text.

    **CRITICAL RULES:**
    1. Use [brackets] to hide key concepts FROM THE SOURCE TEXT
    2. The hidden words must be actual terms/concepts from the source
    3. MUST have at least 3 hidden words
    4. Context MUST make the hidden word guessable
    5. DO NOT use generic examples - use actual content from the provided text
    6. Determine the learning level:
       - "": Basic fill-in with obvious clues
       - "": Fill-in requiring understanding of context
       - "": Complex fill-in requiring deeper knowledge

    JSON Output (Hebrew):
    {
      "text": "[   [  ]  ]",
      "learning_level": "" | "" | ""
    }
    `;try{const l=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"}}),c=JSON.parse(l.choices[0].message.content||"{}");if(!c.text||!c.text.includes("[")||!c.text.includes("]"))return null;const h=["","",""].includes(c.learning_level)?c.learning_level:"";return{text:c.text,learning_level:h}}catch{return null}},rpe=async(n,e,t,r)=>{const s=await X0(n,e,r);let o=t&&t.trim().length>0?`**CRITICAL: BASE YOUR CONTENT ONLY ON THIS SOURCE TEXT:**
"""${t.substring(0,3e3)}"""

**IMPORTANT:** Create matching pairs using actual terms, concepts, events or definitions from this source text. DO NOT use generic examples.`:`Topic: "${n}"`;s&&(o=`${s}

---

${o}`);const a=`
    Create a Memory Game (Matching Pairs) in Hebrew.
      ${o}
    Target Audience: ${e}.
    Language: Hebrew.

    Task: Create 6 matching pairs FROM THE SOURCE TEXT.

    **CRITICAL RULES:**
    1. All pairs MUST be extracted from the source text
    2. DO NOT use generic examples - use actual content from the text
    3. Match types: TermDefinition, EventDate, CauseEffect, PersonAchievement
    4. Both card_a and card_b must contain content from the source
    5. Determine the learning level:
       - "": Simple term-definition matching
       - "": Matching requiring understanding of relationships
       - "": Complex matching requiring analysis

    JSON Output (Hebrew):
    {
      "pairs": [
        { "card_a": "[/ ]", "card_b": "[/ ]" }
      ],
      "learning_level": "" | "" | ""
    }
    `;try{const l=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"}}),c=JSON.parse(l.choices[0].message.content||"{}");if(!c.pairs||c.pairs.length<3)return null;const u=["","",""];return c.learning_level=u.includes(c.learning_level)?c.learning_level:"",c}catch{return null}},I7e=async(n,e,t,r)=>{const s=await X0(n,e,r);let o=t&&t.trim().length>0?`**CRITICAL: BASE YOUR CONTENT ONLY ON THIS SOURCE TEXT:**
"""${t.substring(0,3e3)}"""

**IMPORTANT:** Create a true/false statement based on actual facts from this source text.`:`Topic: "${n}"`;s&&(o=`${s}

---

${o}`);const a=`
    Create a True/False question in Hebrew.
    ${o}
    Target Audience: ${e}.
    Language: Hebrew.

    **RULES:**
    1. Create a clear, unambiguous statement
    2. The statement must be definitively true OR definitively false
    3. Base it on actual content from the source text
    4. Avoid trick questions or overly technical language
    5. Determine the learning level:
       - "": Simple fact-checking statement
       - "": Statement requiring understanding of concepts
       - "": Complex statement requiring analysis

    JSON Output:
    {
      "statement": " ",
      "answer": true,
      "explanation": "    / ",
      "learning_level": "" | "" | ""
    }
  `;try{const l=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:a}],response_format:{type:"json_object"}}),c=JSON.parse(l.choices[0].message.content||"{}");if(!c.statement||c.answer===void 0)return null;const u=["","",""];return c.learning_level=u.includes(c.learning_level)?c.learning_level:"",c}catch{return null}},spe=async(n,e,t,r,s)=>{const i=await X0(n,e,s);let o=r?`TEXT:
"""${r.substring(0,5e3)}"""`:`Topic: "${n}"`;i&&(o=`${i}

---

${o}`);const l=i&&i.length>100?`
        .

${o}

 : ${e}

**  :**
1.     -  "", " ", " " '
2.         
3.     
4.       ( )
5.      :
   - "":      (, , , )
   - "":        
   - "":     ,   

OUTPUT JSON:
{
  "question": "   ",
  "options": [" ", " ", " ", " "],
  "correct_answer": " ",
  "learning_level": "" | "" | ""
}
`:`
    Based on the following content, create a single Multiple Choice Question.

    ${o}

    Target Audience: ${e}.
    Language: Hebrew.

    Goal: Test understanding of the core message.

    Determine the learning level of the question:
    - "" (Understanding): Basic question testing comprehension (what, who, where, when)
    - "" (Application): Question requiring application of knowledge in a new situation
    - "" (Deepening): Challenging question requiring critical thinking, analysis or comparison

    OUTPUT JSON:
    {
      "question": "The question text",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct_answer": "Option A",
      "learning_level": "" | "" | ""
    }
  `;try{const c=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:l}],response_format:{type:"json_object"}}),u=JSON.parse(c.choices[0].message.content||"{}");if(!u.question||!u.options||!u.correct_answer)return null;const f=["","",""].includes(u.learning_level)?u.learning_level:"";return{id:cn(),type:"multiple-choice",content:{question:u.question,options:u.options,correctAnswer:u.correct_answer},metadata:{score:10,difficulty:1,learningLevel:f}}}catch(c){return console.error("Single MCQ Gen Error:",c),null}},ipe=async(n,e,t,r,s)=>{const i=await X0(n,e,s);let o=r?`TEXT:
"""${r.substring(0,5e3)}"""`:`Topic: "${n}"`;i&&(o=`${i}

---

${o}`);const l=i&&i.length>100?`
        .

${o}

 : ${e}

**  :**
1.     -  "", " ", "" '
2.         
3.     
4.     
5.      :
   - "":     
   - "":      
   - "":      

OUTPUT JSON:
{
  "question": "   ",
  "model_answer": "     ",
  "learning_level": "" | "" | ""
}
`:`
    Based on the following content, create a single Open-Ended Question.

    ${o}

    Target Audience: ${e}.
    Language: Hebrew.

    Goal: Encourage deep thinking or opinion.

    Determine the learning level of the question:
    - "" (Understanding): Basic question testing comprehension
    - "" (Application): Question requiring application of knowledge
    - "" (Deepening): Challenging question requiring critical thinking

    OUTPUT JSON:
    {
      "question": "The open question text",
      "model_answer": "A model answer or key points to look for.",
      "learning_level": "" | "" | ""
    }
  `;try{const c=await Ci.chat.completions.create({model:ao,messages:[{role:"user",content:l}],response_format:{type:"json_object"}}),u=JSON.parse(c.choices[0].message.content||"{}");if(!u.question)return null;const f=["","",""].includes(u.learning_level)?u.learning_level:"";return{id:cn(),type:"open-question",content:{question:u.question},metadata:{score:20,modelAnswer:u.model_answer||"    .",learningLevel:f}}}catch(c){return console.error("Single Open Gen Error:",c),null}};async function ope(){var e,t;console.log(" Starting migration: game  activity");const n={total:0,updated:0,skipped:0,errors:[]};try{const r=Zs(Kt,"courses"),s=await Hh(r);n.total=s.size,console.log(` Found ${n.total} courses to check`);for(const i of s.docs){const o=i.id,a=i.data();try{const l=(t=(e=a.wizardData)==null?void 0:e.settings)==null?void 0:t.productType;if(l==="game"){const c=or(Kt,"courses",o);await Tb(c,{"wizardData.settings.productType":"activity"}),n.updated++,console.log(` Updated course: ${a.title||o}`)}else n.skipped++,l&&console.log(` Skipped (${l}): ${a.title||o}`)}catch(l){n.errors.push(`${o}: ${l.message}`),console.error(` Error updating ${o}:`,l)}}return console.log(`
 Migration Summary:`),console.log(`   Total courses: ${n.total}`),console.log(`   Updated: ${n.updated}`),console.log(`   Skipped: ${n.skipped}`),console.log(`   Errors: ${n.errors.length}`),n.errors.length>0&&console.log(`
 Errors:`,n.errors),n}catch(r){return console.error(" Migration failed:",r),n.errors.push(`Global error: ${r.message}`),n}}typeof window<"u"&&(window.migrateGameToActivity=ope);function Z3(n={}){const{breakpoint:e=768,includeTablet:t=!1}=n,r=t?1024:e,[s,i]=V.useState(()=>typeof window>"u"?!1:window.innerWidth<r);return V.useEffect(()=>{if(typeof window>"u")return;const o=()=>{const a=window.innerWidth<r;i(a)};return o(),window.addEventListener("resize",o),window.addEventListener("orientationchange",o),()=>{window.removeEventListener("resize",o),window.removeEventListener("orientationchange",o)}},[r]),s}const Yw=({size:n="md",color:e="gradient",label:t="...",className:r=""})=>{const s={sm:{container:"w-6 h-6",starSizes:[8,6,5]},md:{container:"w-10 h-10",starSizes:[12,10,8]},lg:{container:"w-14 h-14",starSizes:[16,14,10]},xl:{container:"w-20 h-20",starSizes:[24,20,14]}},i={primary:["#4F46E5","#6366F1","#818CF8"],action:["#F97316","#FB923C","#FDBA74"],white:["#FFFFFF","#F1F5F9","#E2E8F0"],gradient:["#4F46E5","#8B5CF6","#EC4899"]},o=s[n],a=i[e];return d.jsxs("div",{role:"status","aria-live":"polite","aria-label":t,className:`inline-flex items-center justify-center ${r}`,children:[d.jsxs("div",{className:`relative ${o.container}`,children:[d.jsx("svg",{className:"absolute inset-0 m-auto animate-pulse motion-reduce:animate-none",width:o.starSizes[0],height:o.starSizes[0],viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M12 2L14.09 8.26L20.5 9.27L15.75 13.97L16.82 20.5L12 17.77L7.18 20.5L8.25 13.97L3.5 9.27L9.91 8.26L12 2Z",fill:a[0],className:"drop-shadow-lg"})}),d.jsx("div",{className:"absolute inset-0 animate-[orbit_2s_linear_infinite] motion-reduce:animate-none",style:{animationDelay:"0ms"},children:d.jsx("svg",{className:"absolute",style:{top:"0%",left:"50%",transform:"translateX(-50%)"},width:o.starSizes[1],height:o.starSizes[1],viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M12 2L14.09 8.26L20.5 9.27L15.75 13.97L16.82 20.5L12 17.77L7.18 20.5L8.25 13.97L3.5 9.27L9.91 8.26L12 2Z",fill:a[1],className:"drop-shadow-md"})})}),d.jsx("div",{className:"absolute inset-0 animate-[orbit_2s_linear_infinite] motion-reduce:animate-none",style:{animationDelay:"-666ms"},children:d.jsx("svg",{className:"absolute",style:{top:"0%",left:"50%",transform:"translateX(-50%)"},width:o.starSizes[2],height:o.starSizes[2],viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M12 2L14.09 8.26L20.5 9.27L15.75 13.97L16.82 20.5L12 17.77L7.18 20.5L8.25 13.97L3.5 9.27L9.91 8.26L12 2Z",fill:a[2],className:"drop-shadow-sm"})})}),d.jsx("div",{className:"absolute inset-0 animate-[orbit_2s_linear_infinite] motion-reduce:animate-none",style:{animationDelay:"-1333ms"},children:d.jsx("svg",{className:"absolute",style:{top:"0%",left:"50%",transform:"translateX(-50%)"},width:o.starSizes[1],height:o.starSizes[1],viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M12 2L14.09 8.26L20.5 9.27L15.75 13.97L16.82 20.5L12 17.77L7.18 20.5L8.25 13.97L3.5 9.27L9.91 8.26L12 2Z",fill:a[0],className:"drop-shadow-md opacity-80"})})}),d.jsxs("div",{className:"absolute inset-0",children:[d.jsx("div",{className:"absolute w-1 h-1 rounded-full animate-[sparkle_1.5s_ease-in-out_infinite] motion-reduce:animate-none",style:{top:"20%",left:"80%",backgroundColor:a[1],animationDelay:"0ms"}}),d.jsx("div",{className:"absolute w-1 h-1 rounded-full animate-[sparkle_1.5s_ease-in-out_infinite] motion-reduce:animate-none",style:{top:"70%",left:"15%",backgroundColor:a[2],animationDelay:"500ms"}}),d.jsx("div",{className:"absolute w-0.5 h-0.5 rounded-full animate-[sparkle_1.5s_ease-in-out_infinite] motion-reduce:animate-none",style:{top:"85%",left:"75%",backgroundColor:a[0],animationDelay:"1000ms"}})]})]}),d.jsx("span",{className:"sr-only",children:t})]})},Yl=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),d.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),lm=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polyline",{points:"3 6 5 6 21 6"}),d.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),d.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),d.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),I_=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),d.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]}),R7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),d.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),$T=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),No=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),d.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),ape=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})}),br=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polyline",{points:"20 6 9 17 4 12"})}),M7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),d.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),d.jsx("polyline",{points:"7 3 7 8 15 8"})]}),lpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),d.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),U2=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),d.jsx("polyline",{points:"5 12 12 5 19 12"})]}),vD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),d.jsx("polyline",{points:"19 12 12 19 5 12"})]}),P7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),d.jsx("polyline",{points:"12 19 5 12 12 5"})]}),L7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),d.jsx("polyline",{points:"12 5 19 12 12 19"})]}),D7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),d.jsx("polyline",{points:"12 19 5 12 12 5"})]}),j7e=({className:n="w-6 h-6"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M22 10v6M2 10l10-5 10 5-10 5z"}),d.jsx("path",{d:"M6 12v5c3 3 9 3 12 0v-5"})]}),I1=({className:n="w-6 h-6"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),d.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]}),O7e=({className:n="w-6 h-6"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H8v20H6.5A2.5 2.5 0 0 1 4 19.5z"}),d.jsx("path",{d:"M10 2h3v20h-3z"}),d.jsx("path",{d:"M15 2h5l-1.5 20H15z"})]}),wD=({className:n="w-6 h-6"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),d.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),d.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),H2=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),d.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),d.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),d.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),d.jsx("line",{x1:"6.5",y1:"10",x2:"6.5",y2:"14"}),d.jsx("line",{x1:"17.5",y1:"10",x2:"17.5",y2:"14"}),d.jsx("line",{x1:"10",y1:"6.5",x2:"14",y2:"6.5"})]}),p0=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),d.jsx("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),d.jsx("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),d.jsx("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})]}),kD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),d.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),d.jsx("polyline",{points:"21 15 16 10 5 21"})]}),R_=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polygon",{points:"23 7 16 12 23 17 23 7"}),d.jsx("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),_D=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polyline",{points:"4 7 4 4 20 4 20 7"}),d.jsx("line",{x1:"9",y1:"20",x2:"15",y2:"20"}),d.jsx("line",{x1:"12",y1:"4",x2:"12",y2:"20"})]}),Wq=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),SD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),d.jsx("polyline",{points:"17 8 12 3 7 8"}),d.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),F7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),d.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Hi=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"})}),Gy=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),d.jsx("polyline",{points:"14 2 14 8 20 8"})]}),cpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M6 21l15 -15l-3 -3l-15 15l3 3"}),d.jsx("path",{d:"M15 6l3 3"}),d.jsx("path",{d:"M9 3a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"}),d.jsx("path",{d:"M19 13a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"})]}),z7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("rect",{x:"3",y:"11",width:"18",height:"10",rx:"2"}),d.jsx("circle",{cx:"12",cy:"5",r:"2"}),d.jsx("path",{d:"M12 7v4"}),d.jsx("line",{x1:"8",y1:"16",x2:"8",y2:"16"}),d.jsx("line",{x1:"16",y1:"16",x2:"16",y2:"16"})]}),Mx=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"}),d.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"})]}),TD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"13.5",cy:"6.5",r:".5"}),d.jsx("circle",{cx:"17.5",cy:"10.5",r:".5"}),d.jsx("circle",{cx:"8.5",cy:"7.5",r:".5"}),d.jsx("circle",{cx:"6.5",cy:"12.5",r:".5"}),d.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"})]}),upe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"m21.41 11.58-9-5a1 1 0 0 0-1 0l-8.91 5a1 1 0 0 0 .44 1.92l2.5-.42a4 4 0 0 0 7.82.42l2.5.42a1 1 0 0 0 .65-1.92Z"}),d.jsx("path",{d:"M12 2v4"}),d.jsx("path",{d:"M12 16v6"}),d.jsx("path",{d:"M8 22h8"})]}),H6=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),d.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),AD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),d.jsx("polyline",{points:"2 17 12 22 22 17"}),d.jsx("polyline",{points:"2 12 12 17 22 12"})]}),B7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"11",cy:"11",r:"8"}),d.jsx("path",{d:"m21 21-4.3-4.3"})]}),q6=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),$7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),d.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),V7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),d.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),d.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),d.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),dpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"12",cy:"12",r:"10"}),d.jsx("polyline",{points:"12 6 12 12 16 14"})]}),ED=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"12",cy:"12",r:"10"}),d.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),d.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),Kq=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),CD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polyline",{points:"23 4 23 10 17 10"}),d.jsx("polyline",{points:"1 20 1 14 7 14"}),d.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),U7e=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polyline",{points:"6 9 12 15 18 9"})}),H7e=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polyline",{points:"18 15 12 9 6 15"})}),q7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),d.jsx("line",{x1:"4",y1:"22",x2:"4",y2:"15"})]}),G7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),d.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),d.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),W7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}),d.jsx("path",{d:"M12 12v9"}),d.jsx("path",{d:"m16 16-4-4-4 4"})]}),R8=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M3 18v-6a9 9 0 0 1 18 0v6"}),d.jsx("path",{d:"M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"})]}),hpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),d.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),d.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),d.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]}),Yq=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"12",cy:"12",r:"10"}),d.jsx("circle",{cx:"12",cy:"12",r:"6"}),d.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),fpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M12 2a3 3 0 0 1 3 3v6h-6V5a3 3 0 0 1 3-3z"}),d.jsx("path",{d:"M15 11h-6a5 5 0 0 0-5 5v2a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-2a5 5 0 0 0-5-5z"}),d.jsx("circle",{cx:"12",cy:"17",r:"1.5"})]}),ppe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M7 10v12"}),d.jsx("path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"})]}),mpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M17 14V2"}),d.jsx("path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"})]}),ND=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polyline",{points:"15 18 9 12 15 6"})}),G6=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polyline",{points:"9 18 15 12 9 6"})}),gpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6"}),d.jsx("path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18"}),d.jsx("path",{d:"M4 22h16"}),d.jsx("path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"}),d.jsx("path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"}),d.jsx("path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z"})]}),ID=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),d.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),ype=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),d.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),d.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),xpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"18",cy:"5",r:"3"}),d.jsx("circle",{cx:"6",cy:"12",r:"3"}),d.jsx("circle",{cx:"18",cy:"19",r:"3"}),d.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),d.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),VT=({className:n="w-5 h-5"})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),RD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),d.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),d.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),d.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]}),bpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"m4 6 8-4 8 4"}),d.jsx("path",{d:"m18 10 4 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8l4-2"}),d.jsx("path",{d:"M14 22v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4"}),d.jsx("path",{d:"M18 5v17"}),d.jsx("path",{d:"M6 5v17"}),d.jsx("circle",{cx:"12",cy:"9",r:"2"})]}),MD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M12 3a12 12 0 0 0 8.5 3A12 12 0 0 1 12 21 12 12 0 0 1 3.5 6 12 12 0 0 0 12 3"}),d.jsx("path",{d:"M12 11v-1"}),d.jsx("path",{d:"M11 11h2v2h-2z"})]}),UT=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"12",cy:"12",r:"9"}),d.jsx("path",{d:"M14.8 9A2 2 0 0 0 13 8h-2a2 2 0 0 0 0 4h2a2 2 0 0 1 0 4h-2a2 2 0 0 1-1.8-1"}),d.jsx("path",{d:"M12 6v2m0 8v2"})]}),PD=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 17c1.38 0 2.5-1.12 2.5-2.5 0-1.38-1.12-2.5-2.5-2.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5c1.38 0 2.5 1.12 2.5 2.5 0 1.38 1.12 2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5c0-1.38-1.12-2.5-2.5-2.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5"}),d.jsx("path",{d:"M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"})]}),vpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),d.jsx("path",{d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"})]}),wpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"19",y1:"4",x2:"10",y2:"4"}),d.jsx("line",{x1:"14",y1:"20",x2:"5",y2:"20"}),d.jsx("line",{x1:"15",y1:"4",x2:"9",y2:"20"})]}),kpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"}),d.jsx("line",{x1:"4",y1:"21",x2:"20",y2:"21"})]}),_pe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 12h8"}),d.jsx("path",{d:"M4 18V6"}),d.jsx("path",{d:"M12 18V6"}),d.jsx("path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1"})]}),Spe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 12h8"}),d.jsx("path",{d:"M4 18V6"}),d.jsx("path",{d:"M12 18V6"}),d.jsx("path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2"}),d.jsx("path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2"})]}),Tpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"10",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"10",y1:"12",x2:"21",y2:"12"}),d.jsx("line",{x1:"10",y1:"18",x2:"21",y2:"18"}),d.jsx("path",{d:"M4 6h1v4"}),d.jsx("path",{d:"M4 10h2"}),d.jsx("path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"})]}),Ape=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),d.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"}),d.jsx("line",{x1:"21",y1:"18",x2:"7",y2:"18"})]}),Epe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"6"}),d.jsx("line",{x1:"21",y1:"12",x2:"3",y2:"12"}),d.jsx("line",{x1:"18",y1:"18",x2:"6",y2:"18"})]}),Cpe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),d.jsx("line",{x1:"3",y1:"12",x2:"15",y2:"12"}),d.jsx("line",{x1:"3",y1:"18",x2:"17",y2:"18"})]}),Npe=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M4 7V4h16v3"}),d.jsx("path",{d:"M9 20h6"}),d.jsx("path",{d:"M12 4v16"}),d.jsx("path",{d:"m3 3 18 18"})]}),HT=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16"}),d.jsx("path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9"}),d.jsx("path",{d:"m2 15 6 6"}),d.jsx("path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12l3.5-3.5Z"})]}),qT=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),d.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),GT=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("path",{d:"M6 18h8"}),d.jsx("path",{d:"M3 22h18"}),d.jsx("path",{d:"M14 22a7 7 0 1 0 0-14h-1"}),d.jsx("path",{d:"M9 14h2"}),d.jsx("path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z"}),d.jsx("path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3"})]}),K7e=({className:n="w-5 h-5"})=>d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:[d.jsx("circle",{cx:"12",cy:"12",r:"1"}),d.jsx("circle",{cx:"12",cy:"5",r:"1"}),d.jsx("circle",{cx:"12",cy:"19",r:"1"})]}),Xq={goals:{id:"goals",label:"",icon:Yq,color:"blue",description:"  "},opening:{id:"opening",label:"",icon:I1,color:"purple",description:"Hook -   "},instruction:{id:"instruction",label:"",icon:R_,color:"green",description:"  "},practice:{id:"practice",label:"",icon:fpe,color:"orange",description:"  "},summary:{id:"summary",label:"",icon:br,color:"teal",description:" "}};function Bf(n,e,t){return n===0?t.includes("goal")||t.includes("objective")?"goals":"opening":n===e-1?"summary":["multiple-choice","true_false_speed","open-question","rating_scale","matrix"].includes(t)?n>e*.7?"summary":"practice":["memory_game","ordering","categorization","fill_in_blanks","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection"].includes(t)?"practice":"instruction"}const Ipe=()=>{const{course:n}=I8(),e=(n==null?void 0:n.mode)==="exam";return V.useCallback(r=>{if(e)return;new Audio(`/sounds/${r}.mp3`).play().catch(i=>{})},[e])},W6={submitFeedback:async n=>{try{const e=await Fw(Zs(Kt,"feedback_logs"),{...n,timestamp:rd()});return console.log("Feedback submitted with ID: ",e.id),e.id}catch(e){throw console.error("Error submitting feedback: ",e),e}},getFeedbackForCourse:async n=>{try{const e=Uh(Zs(Kt,"feedback_logs"),$m("courseId","==",n),Ow("timestamp","desc"),q3(100));return(await Hh(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Error fetching feedback: ",e),[]}},getFeedbackStats:async n=>{try{const e=await W6.getFeedbackForCourse(n),t={positive:0,negative:0,tags:{}};return e.forEach(r=>{var s;r.type==="positive"&&t.positive++,r.type==="negative"&&(t.negative++,(s=r.tags)==null||s.forEach(i=>{t.tags[i]=(t.tags[i]||0)+1}))}),{stats:t,recent:e.slice(0,5)}}catch(e){return console.error("Error getting stats:",e),{stats:{positive:0,negative:0,tags:{}},recent:[]}}}},Rpe=[{id:"confusing",label:" "},{id:"too_hard",label:" "},{id:"boring",label:""},{id:"bug",label:" "}],Mpe=({courseId:n,unitId:e,blockId:t,blockType:r,userId:s,className:i=""})=>{const[o,a]=V.useState("idle"),[l,c]=V.useState([]),[u,h]=V.useState(!1),f=async()=>{a("submitted");try{await W6.submitFeedback({userId:s,userRole:"student",courseId:n,unitId:e,blockId:t,type:"positive",context:{blockType:r}})}catch(v){console.error("Failed to submit positive feedback",v)}},p=()=>{a("negative_selecting")},g=v=>{c(b=>b.includes(v)?b.filter(w=>w!==v):[...b,v])},y=async()=>{if(l.length!==0){h(!0);try{await W6.submitFeedback({userId:s,userRole:"student",courseId:n,unitId:e,blockId:t,type:"negative",tags:l,context:{blockType:r}}),a("submitted")}catch(v){console.error("Failed to submit negative feedback",v)}finally{h(!1)}}};return o==="submitted"?d.jsxs("div",{className:`flex items-center gap-2 text-green-600 bg-green-50 px-3 py-1.5 rounded-full text-xs font-bold animate-fade-in ${i}`,children:[d.jsx(br,{className:"w-4 h-4"}),"   !"]}):o==="negative_selecting"?d.jsxs("div",{className:`bg-white shadow-lg border border-slate-200 rounded-xl p-3 absolute z-50 animate-scale-in w-64 ${i}`,children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsx("span",{className:"text-xs font-bold text-slate-500",children:" ?"}),d.jsx("button",{onClick:()=>a("idle"),className:"text-slate-400 hover:text-slate-600",children:d.jsx(No,{className:"w-4 h-4"})})]}),d.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Rpe.map(v=>d.jsx("button",{onClick:()=>g(v.id),className:`text-xs px-2 py-1 rounded-md border transition-all ${l.includes(v.id)?"bg-red-100 border-red-300 text-red-700 font-bold":"bg-slate-50 border-slate-200 text-slate-600 hover:bg-slate-100"}`,children:v.label},v.id))}),d.jsx("button",{onClick:y,disabled:u||l.length===0,className:"w-full bg-slate-900 text-white rounded-lg py-1.5 text-xs font-bold hover:bg-black disabled:opacity-50 transition-colors",children:u?"...":" "})]}):d.jsxs("div",{className:`flex items-center gap-1 opacity-60 hover:opacity-100 transition-opacity ${i}`,children:[d.jsx("button",{onClick:f,className:"p-1.5 hover:bg-green-50 hover:text-green-600 rounded-full transition-colors group",title:" / ",children:d.jsx(ppe,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})}),d.jsx("button",{onClick:p,className:"p-1.5 hover:bg-red-50 hover:text-red-600 rounded-full transition-colors group",title:"  / ",children:d.jsx(mpe,{className:"w-4 h-4 group-hover:scale-110 transition-transform"})})]})},Ppe=["  ...","  ...","   ...","   ..."],Lpe=({customMessages:n})=>{const e=n||Ppe,[t,r]=V.useState(""),[s,i]=V.useState(0),[o,a]=V.useState(!0),[l,c]=V.useState(!0);return V.useEffect(()=>{const u=setInterval(()=>{c(h=>!h)},530);return()=>clearInterval(u)},[]),V.useEffect(()=>{const u=e[s];let h;return o?t.length<u.length?h=setTimeout(()=>{r(u.slice(0,t.length+1))},50):h=setTimeout(()=>{a(!1)},1500):t.length>0?h=setTimeout(()=>{r(t.slice(0,-1))},30):(i(f=>(f+1)%e.length),a(!0)),()=>clearTimeout(h)},[t,o,s,e]),d.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-md animate-in fade-in duration-300",children:[d.jsxs("div",{className:"relative mb-8",children:[d.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-full opacity-20 animate-ping"}),d.jsx("div",{className:"absolute inset-0 bg-indigo-500 rounded-full opacity-20 animate-ping delay-75",style:{animationDuration:"2s"}}),d.jsx("div",{className:"relative w-32 h-32 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-full flex items-center justify-center shadow-2xl border-4 border-blue-400/30",children:d.jsx(Hi,{className:"w-16 h-16 text-white animate-pulse"})})]}),d.jsx("div",{className:"h-12 flex items-center justify-center overflow-hidden",dir:"rtl",children:d.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-white tracking-wide",children:[t,d.jsx("span",{className:`inline-block w-1 h-8 bg-white mr-1 align-middle transition-opacity duration-100 ${l?"opacity-100":"opacity-0"}`})]})}),d.jsx("div",{className:"w-64 h-1 bg-white/10 rounded-full mt-8 overflow-hidden",children:d.jsx("div",{className:"h-full bg-blue-400 animate-progress-indeterminate origin-right"})})]})},Xw="users",eS="profile",Dpe="stats",jpe="sessions",LD={performance:{average_response_time_sec:0,global_accuracy_rate:0,error_rate_by_topic:{},total_questions_attempted:0,total_correct_answers:0},behavioral:{hint_dependency_score:0,retry_persistence:0,media_preference:{text:0,video:0,gamified:0}},engagement:{total_learning_time_sec:0,completed_lessons_count:0,last_active_at:new Date}},Ope=(n,e,t,r=.1)=>t<=1?e:r*e+(1-r)*n,Fpe=(n,e,t,r)=>{if(t===0)return n;const s=Math.min(e/t/3,1);if(r<=t)return s;const i=(r-t)/r;return i*n+(1-i)*s},zpe=n=>{const e=n.filter(r=>!r.isCorrect&&r.attemptCount===1),t=n.filter(r=>r.attemptCount>1);return e.length===0?1:Math.min(t.length/Math.max(e.length,1),1)},Bpe=(n,e)=>{const t={text:0,video:0,gamified:0};e.forEach(s=>{["text","pdf","open-question"].includes(s.type)?t.text++:["video","podcast"].includes(s.type)?t.video++:["memory_game","interactive-chat","categorization","ordering"].includes(s.type)&&t.gamified++});const r=t.text+t.video+t.gamified;return r===0?n:{text:.7*n.text+.3*(t.text/r),video:.7*n.video+.3*(t.video/r),gamified:.7*n.gamified+.3*(t.gamified/r)}},$pe=async(n,e,t)=>{if(!n||!e)return console.warn("updateStudentProfile: Missing userId or sessionData"),null;const r=or(Kt,Xw,n,eS,Dpe);try{const s=await Ka(r);let i;s.exists()?i={userId:n,...LD,...s.data()}:i={userId:n,lastUpdated:new Date,...LD};const{summary:o,interactions:a,duration_sec:l}=e,c=i.performance.total_questions_attempted+o.total_questions,u=i.performance.total_correct_answers+o.correct_answers,h=c>0?u/c:0,f=Ope(i.performance.average_response_time_sec,o.avg_response_time_sec,c),p={...i.performance.error_rate_by_topic};if(t){const R=o.total_questions-o.correct_answers;p[t]=(p[t]||0)+R}const g=Fpe(i.behavioral.hint_dependency_score,o.total_hints_used,o.total_questions,c),y=zpe(a),v=.8*i.behavioral.retry_persistence+.2*y,b=Bpe(i.behavioral.media_preference,a),w=i.engagement.total_learning_time_sec+l,k=i.engagement.completed_lessons_count+1,T={userId:n,lastUpdated:new Date,performance:{average_response_time_sec:Math.round(f*100)/100,global_accuracy_rate:Math.round(h*1e3)/1e3,error_rate_by_topic:p,total_questions_attempted:c,total_correct_answers:u},behavioral:{hint_dependency_score:Math.round(g*1e3)/1e3,retry_persistence:Math.round(v*1e3)/1e3,media_preference:{text:Math.round(b.text*1e3)/1e3,video:Math.round(b.video*1e3)/1e3,gamified:Math.round(b.gamified*1e3)/1e3}},engagement:{total_learning_time_sec:Math.round(w),completed_lessons_count:k,last_active_at:new Date}};return await Pc(r,T,{merge:!0}),console.log(`Profile updated for user ${n}:`,{accuracy:T.performance.global_accuracy_rate,hintDependency:T.behavioral.hint_dependency_score,totalQuestions:T.performance.total_questions_attempted}),T}catch(s){return console.error("Error updating student profile:",s),null}},Vpe=async(n,e)=>{if(!n||!e)return!1;const t=or(Kt,Xw,n,jpe,`${e.lessonId}_${e.startTime}`);try{return await Pc(t,{...e,savedAt:rd()}),!0}catch(r){return console.error("Error saving session data:",r),!1}},Upe=async(n,e)=>{if(!n||!e.length)return;const t=or(Kt,Xw,n,eS,"error_fingerprint");try{const r=await Ka(t);let s;r.exists()?s=r.data():s={errorTags:{},lastUpdated:new Date},e.forEach(i=>{s.errorTags[i]=(s.errorTags[i]||0)+1}),s.lastUpdated=new Date,await Pc(t,s),console.log(`Error fingerprint updated for ${n}:`,s.errorTags)}catch(r){console.error("Error updating error fingerprint:",r)}},DD=async(n,e,t)=>{if(!n||!e)return;const r=or(Kt,Xw,n,eS,"proficiency_vector");try{const s=await Ka(r);let i;s.exists()?i=s.data():i={topics:{},lastUpdated:new Date},i.topics[e]=Math.round(t*1e3)/1e3,i.lastUpdated=new Date,await Pc(r,i),console.log(`Proficiency vector updated for ${n}: ${e} = ${t}`)}catch(s){console.error("Error updating proficiency vector:",s)}},Jq=async n=>{if(!n)return null;const e=or(Kt,Xw,n,eS,"proficiency_vector");try{const t=await Ka(e);return t.exists()?t.data():null}catch(t){return console.error("Error fetching proficiency vector:",t),null}},Hpe=async(n,e,t,r)=>{const[s,i]=await Promise.all([$pe(n,e,t),Vpe(n,e)]);return r&&r.length>0&&await Upe(n,r),{profile:s,sessionSaved:i}},qpe=(n,e)=>{const[t]=V.useState(Date.now()),r=V.useRef([]),s=V.useRef(null),i=V.useCallback((c,u)=>{s.current={questionId:c,type:u,startTime:Date.now(),hintCount:0}},[]),o=V.useCallback(()=>{s.current&&s.current.hintCount++},[]),a=V.useCallback((c,u)=>{if(!s.current)return;const h=Date.now(),f=(h-s.current.startTime)/1e3,p={questionId:s.current.questionId,type:s.current.type,isCorrect:c,attemptCount:u,timeSpentSec:f,hintsUsed:s.current.hintCount,timestamp:h};r.current.push(p),s.current=null},[]),l=V.useCallback(()=>{const c=Date.now(),u=r.current,h=u.length,f=u.filter(y=>y.isCorrect).length,p=u.reduce((y,v)=>y+v.hintsUsed,0),g=u.reduce((y,v)=>y+v.timeSpentSec,0);return{userId:n,lessonId:e,startTime:t,endTime:c,duration_sec:(c-t)/1e3,interactions:u,summary:{total_questions:h,correct_answers:f,total_hints_used:p,avg_response_time_sec:h>0?g/h:0}}},[n,e,t]);return{onQuestionStart:i,onHintRequested:o,onAnswerSubmitted:a,getSessionSummary:l}},Qq={numbers:{id:"numbers",name:"",nameEn:"Numbers",children:["counting","place_value","number_line","comparing_numbers"],gradeRange:{min:1,max:6}},counting:{id:"counting",name:"",nameEn:"Counting",children:["counting_1_10","counting_1_100","skip_counting"],gradeRange:{min:1,max:2}},counting_1_10:{id:"counting_1_10",name:" 1-10",nameEn:"Counting 1-10",gradeRange:{min:1,max:1},bloomLevels:["Remember"]},counting_1_100:{id:"counting_1_100",name:" 1-100",nameEn:"Counting 1-100",prerequisites:["counting_1_10"],gradeRange:{min:1,max:2},bloomLevels:["Remember","Understand"]},skip_counting:{id:"skip_counting",name:" ",nameEn:"Skip Counting",prerequisites:["counting_1_100"],gradeRange:{min:1,max:2},bloomLevels:["Understand","Apply"]},place_value:{id:"place_value",name:" ",nameEn:"Place Value",children:["ones_tens","hundreds","thousands"],prerequisites:["counting_1_100"],gradeRange:{min:1,max:4}},ones_tens:{id:"ones_tens",name:" ",nameEn:"Ones and Tens",prerequisites:["counting_1_100"],gradeRange:{min:1,max:2}},hundreds:{id:"hundreds",name:"",nameEn:"Hundreds",prerequisites:["ones_tens"],gradeRange:{min:2,max:3}},thousands:{id:"thousands",name:"",nameEn:"Thousands",prerequisites:["hundreds"],gradeRange:{min:3,max:4}},number_line:{id:"number_line",name:" ",nameEn:"Number Line",prerequisites:["counting_1_100"],gradeRange:{min:1,max:4},bloomLevels:["Understand","Apply"]},comparing_numbers:{id:"comparing_numbers",name:" ",nameEn:"Comparing Numbers",prerequisites:["place_value"],gradeRange:{min:1,max:3},bloomLevels:["Understand","Apply"]},arithmetic:{id:"arithmetic",name:" ",nameEn:"Arithmetic",children:["addition","subtraction","multiplication","division"],prerequisites:["numbers"],gradeRange:{min:1,max:6}},addition:{id:"addition",name:"",nameEn:"Addition",children:["addition_basic","addition_with_carry","addition_multi_digit"],prerequisites:["counting"],gradeRange:{min:1,max:4}},addition_basic:{id:"addition_basic",name:" ",nameEn:"Basic Addition",prerequisites:["counting_1_10"],gradeRange:{min:1,max:1},bloomLevels:["Remember","Understand"]},addition_with_carry:{id:"addition_with_carry",name:"  ",nameEn:"Addition with Carrying",prerequisites:["addition_basic","place_value"],gradeRange:{min:2,max:3},bloomLevels:["Apply"]},addition_multi_digit:{id:"addition_multi_digit",name:"  -",nameEn:"Multi-digit Addition",prerequisites:["addition_with_carry","hundreds"],gradeRange:{min:3,max:4},bloomLevels:["Apply","Analyze"]},subtraction:{id:"subtraction",name:"",nameEn:"Subtraction",children:["subtraction_basic","subtraction_with_borrow","subtraction_multi_digit"],prerequisites:["addition"],gradeRange:{min:1,max:4}},subtraction_basic:{id:"subtraction_basic",name:" ",nameEn:"Basic Subtraction",prerequisites:["addition_basic"],gradeRange:{min:1,max:2},bloomLevels:["Remember","Understand"]},subtraction_with_borrow:{id:"subtraction_with_borrow",name:"  ",nameEn:"Subtraction with Borrowing",prerequisites:["subtraction_basic","place_value"],gradeRange:{min:2,max:3},bloomLevels:["Apply"]},subtraction_multi_digit:{id:"subtraction_multi_digit",name:"  -",nameEn:"Multi-digit Subtraction",prerequisites:["subtraction_with_borrow"],gradeRange:{min:3,max:4},bloomLevels:["Apply","Analyze"]},multiplication:{id:"multiplication",name:"",nameEn:"Multiplication",children:["multiplication_concept","times_tables","multiplication_multi_digit"],prerequisites:["addition"],gradeRange:{min:2,max:5}},multiplication_concept:{id:"multiplication_concept",name:" ",nameEn:"Multiplication Concept",prerequisites:["skip_counting","addition_basic"],gradeRange:{min:2,max:2},bloomLevels:["Understand"]},times_tables:{id:"times_tables",name:" ",nameEn:"Times Tables",prerequisites:["multiplication_concept"],gradeRange:{min:2,max:4},bloomLevels:["Remember"],estimatedHours:20},multiplication_multi_digit:{id:"multiplication_multi_digit",name:"  -",nameEn:"Multi-digit Multiplication",prerequisites:["times_tables","place_value"],gradeRange:{min:4,max:5},bloomLevels:["Apply","Analyze"]},division:{id:"division",name:"",nameEn:"Division",children:["division_concept","division_basic","division_with_remainder","long_division"],prerequisites:["multiplication"],gradeRange:{min:2,max:6}},division_concept:{id:"division_concept",name:" ",nameEn:"Division Concept",prerequisites:["multiplication_concept"],gradeRange:{min:2,max:3},bloomLevels:["Understand"]},division_basic:{id:"division_basic",name:" ",nameEn:"Basic Division",prerequisites:["division_concept","times_tables"],gradeRange:{min:3,max:4},bloomLevels:["Apply"]},division_with_remainder:{id:"division_with_remainder",name:"  ",nameEn:"Division with Remainder",prerequisites:["division_basic"],gradeRange:{min:3,max:4},bloomLevels:["Apply","Analyze"]},long_division:{id:"long_division",name:" ",nameEn:"Long Division",prerequisites:["division_with_remainder","multiplication_multi_digit"],gradeRange:{min:4,max:6},bloomLevels:["Apply","Analyze"]},fractions:{id:"fractions",name:"",nameEn:"Fractions",children:["fraction_basics","equivalent_fractions","fraction_operations","mixed_numbers"],prerequisites:["division"],gradeRange:{min:3,max:6}},fraction_basics:{id:"fraction_basics",name:" ",nameEn:"Fraction Basics",prerequisites:["division_concept"],gradeRange:{min:3,max:4},bloomLevels:["Remember","Understand"]},equivalent_fractions:{id:"equivalent_fractions",name:" ",nameEn:"Equivalent Fractions",prerequisites:["fraction_basics","multiplication"],gradeRange:{min:4,max:5},bloomLevels:["Understand","Apply"]},fraction_operations:{id:"fraction_operations",name:" ",nameEn:"Fraction Operations",children:["fraction_addition","fraction_subtraction","fraction_multiplication","fraction_division"],prerequisites:["equivalent_fractions"],gradeRange:{min:4,max:6}},fraction_addition:{id:"fraction_addition",name:" ",nameEn:"Adding Fractions",prerequisites:["equivalent_fractions"],gradeRange:{min:4,max:5},bloomLevels:["Apply"]},fraction_subtraction:{id:"fraction_subtraction",name:" ",nameEn:"Subtracting Fractions",prerequisites:["fraction_addition"],gradeRange:{min:4,max:5},bloomLevels:["Apply"]},fraction_multiplication:{id:"fraction_multiplication",name:" ",nameEn:"Multiplying Fractions",prerequisites:["fraction_basics","multiplication"],gradeRange:{min:5,max:6},bloomLevels:["Apply","Analyze"]},fraction_division:{id:"fraction_division",name:" ",nameEn:"Dividing Fractions",prerequisites:["fraction_multiplication"],gradeRange:{min:5,max:6},bloomLevels:["Apply","Analyze"]},mixed_numbers:{id:"mixed_numbers",name:" ",nameEn:"Mixed Numbers",prerequisites:["fraction_basics"],gradeRange:{min:4,max:6},bloomLevels:["Understand","Apply"]},decimals:{id:"decimals",name:" ",nameEn:"Decimals",children:["decimal_concept","decimal_operations","decimal_fraction_conversion"],prerequisites:["fractions","place_value"],gradeRange:{min:4,max:6}},decimal_concept:{id:"decimal_concept",name:"  ",nameEn:"Decimal Concept",prerequisites:["fraction_basics","place_value"],gradeRange:{min:4,max:5},bloomLevels:["Understand"]},decimal_operations:{id:"decimal_operations",name:"  ",nameEn:"Decimal Operations",prerequisites:["decimal_concept"],gradeRange:{min:5,max:6},bloomLevels:["Apply"]},decimal_fraction_conversion:{id:"decimal_fraction_conversion",name:"   ",nameEn:"Decimal-Fraction Conversion",prerequisites:["decimal_concept","equivalent_fractions"],gradeRange:{min:5,max:6},bloomLevels:["Apply","Analyze"]},geometry:{id:"geometry",name:"",nameEn:"Geometry",children:["shapes_2d","shapes_3d","measurement","area_perimeter"],gradeRange:{min:1,max:6}},shapes_2d:{id:"shapes_2d",name:" -",nameEn:"2D Shapes",children:["basic_shapes","triangles","quadrilaterals"],gradeRange:{min:1,max:4}},basic_shapes:{id:"basic_shapes",name:" ",nameEn:"Basic Shapes",gradeRange:{min:1,max:2},bloomLevels:["Remember","Understand"]},triangles:{id:"triangles",name:"",nameEn:"Triangles",prerequisites:["basic_shapes"],gradeRange:{min:3,max:5},bloomLevels:["Understand","Apply"]},quadrilaterals:{id:"quadrilaterals",name:"",nameEn:"Quadrilaterals",prerequisites:["basic_shapes"],gradeRange:{min:3,max:5},bloomLevels:["Understand","Apply"]},shapes_3d:{id:"shapes_3d",name:" -",nameEn:"3D Shapes",prerequisites:["shapes_2d"],gradeRange:{min:2,max:5},bloomLevels:["Understand","Apply"]},measurement:{id:"measurement",name:"",nameEn:"Measurement",children:["length","weight","time","money"],gradeRange:{min:1,max:4}},length:{id:"length",name:"",nameEn:"Length",gradeRange:{min:1,max:3}},weight:{id:"weight",name:"",nameEn:"Weight",gradeRange:{min:2,max:4}},time:{id:"time",name:"",nameEn:"Time",gradeRange:{min:1,max:3}},money:{id:"money",name:"",nameEn:"Money",prerequisites:["addition","subtraction"],gradeRange:{min:1,max:3}},area_perimeter:{id:"area_perimeter",name:" ",nameEn:"Area and Perimeter",prerequisites:["multiplication","shapes_2d"],gradeRange:{min:3,max:6},bloomLevels:["Apply","Analyze"]},word_problems:{id:"word_problems",name:" ",nameEn:"Word Problems",prerequisites:["arithmetic"],gradeRange:{min:1,max:6},bloomLevels:["Apply","Analyze","Evaluate"]}},Gpe=(n,e=Qq)=>{const t=e[n];if(!t||!t.prerequisites)return[];const r=new Set,s=[...t.prerequisites];for(;s.length>0;){const i=s.pop();if(!r.has(i)){r.add(i);const o=e[i];o!=null&&o.prerequisites&&s.push(...o.prerequisites)}}return Array.from(r)},Wpe=(n,e,t=.7,r=Qq)=>{const s=Gpe(n,r);for(const i of s)if((e[i]??0)<t)return!1;return!0},Kpe={enableChallengeMode:!0,enableMasterySkip:!0,challengeSkipThreshold:2,masteryThreshold:.95,minBlocksBeforeSkip:3},Ype=(n,e,t)=>{var o,a;let r=0;const s=["Remember","Understand"],i=["multiple-choice","true_false_speed","memory_game"];for(let l=e+1;l<n.length&&r<t;l++){const c=n[l],u=((o=c.metadata)==null?void 0:o.bloom_taxonomy)&&s.includes(c.metadata.bloom_taxonomy),h=i.includes(c.type),f=(((a=c.metadata)==null?void 0:a.difficulty_level)??.5)<.4;if(["text","pdf","video","podcast"].includes(c.type)){r++;continue}if(u||h||f)r++;else break}return r},Xpe=(n,e,t)=>{var r,s,i;for(let o=e+1;o<n.length;o++){const a=n[o],l=((s=(r=a.metadata)==null?void 0:r.tags)==null?void 0:s[0])||((i=a.metadata)==null?void 0:i.topic);if(l&&l!==t)return o}return null},jD=async(n,e,t,r,s,i,o={})=>{var u,h,f,p,g,y,v;const a={...Kpe,...o},l=((h=(u=s.metadata)==null?void 0:u.tags)==null?void 0:h[0])||((f=s.metadata)==null?void 0:f.topic)||"general",c={action:"continue",message:void 0};if(n==="challenge"&&a.enableChallengeMode){if(r>=a.minBlocksBeforeSkip){const b=Ype(t,r,a.challengeSkipThreshold);if(b>0)return{action:"skip",skipCount:b,message:`!   ${b}  `,toast:{type:"challenge",title:" Challenge Mode!",description:`/ /!   ${b}  `}}}return{action:"continue",message:" !    .",toast:{type:"success",title:"  !",description:" !"}}}if(n==="mastered"&&a.enableMasterySkip){const b=Xpe(t,r,l);if(b!==null){let w=!0;if(i)try{const k=await Jq(i),R=((g=(p=t[b].metadata)==null?void 0:p.tags)==null?void 0:g[0])||"general";k!=null&&k.topics&&(w=Wpe(R,k.topics,.6))}catch(k){console.error("Failed to check prerequisites:",k)}if(w){const k=b-r-1;return{action:"skip_to_topic",skipCount:k,targetTopicId:(v=(y=t[b].metadata)==null?void 0:y.tags)==null?void 0:v[0],message:"  !   ",toast:{type:"success",title:"  !",description:`  ${k}    `}}}}return{action:"continue",message:"  !   .",toast:{type:"success",title:" !",description:"   "}}}return n==="remediate"?{action:"continue",message:"    ..."}:c},OD=(n,e,t)=>{switch(n.action){case"skip":case"skip_to_topic":const r=e+(n.skipCount||0)+1;return Math.min(r,t-1);case"continue":default:return e+1}},Jpe=(n,e,t)=>{var r,s,i,o;return e<.4&&t<.5&&((r=n.metadata)!=null&&r._id||(s=n.metadata)!=null&&s.scaffolding_id)?"":e>.8&&t>.9&&((i=n.metadata)!=null&&i._id||(o=n.metadata)!=null&&o.enrichment_id)?"":""},Qpe=async(n,e)=>{try{const t=await Jq(n);if(t!=null&&t.topics&&t.topics[e]!==void 0){const r=t.topics[e],s=r>.7?.75:r<.3?.4:.6;return console.log(` Loaded existing profile for ${n}: topic=${e}, mastery=${r.toFixed(2)}`),{mastery:r,accuracy:s}}return{mastery:.5,accuracy:.5}}catch(t){return console.error("Failed to load student profile:",t),{mastery:.5,accuracy:.5}}},Jw=async n=>{try{const e=Zs(Kt,"users",n.userId,"adaptive_events");await Fw(e,{...n,timestamp:rd()}),await Zpe(n.userId,n.type),console.log(` [Adaptive Log] ${n.type}:`,n.data)}catch(e){console.error("Failed to log adaptive event:",e)}},Zpe=async(n,e)=>{const t=or(Kt,"users",n,"profile","adaptive_stats"),r={lastUpdated:rd(),[`counts.${e}`]:y_(1),"counts.total":y_(1)};await Pc(t,r,{merge:!0})},Y7e=async n=>{var e;try{const t=or(Kt,"users",n,"profile","adaptive_stats"),r=await Ka(t);if(!r.exists())return null;const s=r.data();return{counts:s.counts||{},lastUpdated:((e=s.lastUpdated)==null?void 0:e.toDate())||null}}catch(t){return console.error("Failed to get adaptive stats:",t),null}},e0e=(n,e,t,r,s,i)=>{Jw({type:"variant_selected",userId:n,courseId:e,blockId:t,data:{variantType:r,mastery:s,accuracy:i}})},FD=(n,e,t,r,s,i,o,a)=>{Jw({type:"bkt_update",userId:n,courseId:e,blockId:t,data:{previousMastery:r,newMastery:s,action:i,isCorrect:o,topicId:a}})},t0e=(n,e,t)=>{Jw({type:"challenge_mode",userId:n,courseId:e,data:{skippedBlocks:t}})},n0e=(n,e,t,r)=>{Jw({type:"mastery_skip",userId:n,courseId:e,data:{topicId:t,mastery:r}})},r0e=(n,e,t,r,s)=>{Jw({type:"remediation_injected",userId:n,courseId:e,blockId:t,data:{remediationBlockId:r,wrongAnswer:s}})},q2=new Map,s0e=10*60*1e3;async function i0e(n,e,t="math"){if(!n||n.trim().length<5)return console.log(" Topic identification skipped: content too short"),null;const r=`${e}_${t}_${n.substring(0,100)}`,s=q2.get(r);if(s&&Date.now()-s.timestamp<s0e)return console.log(` Topic identification (cached): "${s.topic}"`),s.topic;try{console.log(` Searching curriculum for topic: grade=${e}, subject=${t}`);const i=await Rx(n,{grade:e,subject:t,volumeType:"curriculum"},1);if(i.length>0&&i[0].similarity>.4){const a=i[0].chunk.chapter;return console.log(` Topic identified from curriculum: "${a}" (similarity: ${(i[0].similarity*100).toFixed(1)}%)`),q2.set(r,{topic:a,timestamp:Date.now()}),a}const o=await Rx(n,{grade:e,subject:t,volumeType:"student"},1);if(o.length>0&&o[0].similarity>.4){const a=o[0].chunk.chapter;return console.log(` Topic identified from student book: "${a}" (similarity: ${(o[0].similarity*100).toFixed(1)}%)`),q2.set(r,{topic:a,timestamp:Date.now()}),a}return console.log(` No curriculum topic found for content in grade ${e}`),q2.set(r,{topic:null,timestamp:Date.now()}),null}catch(i){return console.warn(" Error identifying curriculum topic:",i),null}}async function zD(n,e,t){var r,s;if((r=n.metadata)!=null&&r.curriculumTopicId)return n.metadata.curriculumTopicId;if(e){const i=o0e(n.content);if(i){const o=await i0e(i,e,t||"math");if(o)return o}}return(s=n.metadata)!=null&&s.bloomLevel?`bloom_${n.metadata.bloomLevel}`:"general"}function o0e(n){if(typeof n=="string")return n;if(n!=null&&n.question)return n.question;if(n!=null&&n.instruction)return n.instruction;if(n!=null&&n.text)return n.text;if(typeof n=="object"){const e=[];return n.question&&e.push(n.question),n.instruction&&e.push(n.instruction),n.options&&Array.isArray(n.options)&&e.push(...n.options.map(t=>typeof t=="string"?t:t.text||"")),e.join(" ").trim()}return""}const a0e=({className:n})=>d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n,children:d.jsx("path",{d:"M2 12h20M12 2v20M4.93 4.93l14.14 14.14M4.93 19.07L19.07 4.93"})}),l0e=({isOpen:n,onClose:e,currentGems:t,frozenDays:r,onPurchaseComplete:s})=>{const{currentUser:i}=kf(),[o,a]=V.useState(!1),[l,c]=V.useState(null);if(!n)return null;const u=async()=>{if(!i)return;a(!0),c(null);const h=await cfe(i.uid);a(!1),h.success?(c({type:"success",text:h.message}),h.newBalance!==void 0&&s(h.newBalance)):c({type:"error",text:h.message})};return d.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 animate-in fade-in duration-200",children:[d.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e}),d.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-in zoom-in-95 duration-200",dir:"rtl",children:[d.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-400 p-6 text-white text-center",children:[d.jsx("h2",{className:"text-3xl font-black mb-2 drop-shadow-md",children:" "}),d.jsxs("div",{className:"flex items-center justify-center gap-2 bg-white/20 rounded-full py-1 px-4 w-fit mx-auto backdrop-blur-md",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsx("span",{className:"text-xl font-bold",children:t})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 p-2 bg-white/10 hover:bg-white/20 rounded-full transition",children:d.jsx(No,{className:"w-6 h-6 text-white"})})]}),d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{className:"flex items-center gap-4 p-4 border-2 border-slate-100 rounded-2xl hover:border-blue-100 transition-colors group",children:[d.jsx("div",{className:"w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform",children:d.jsx(a0e,{className:"w-8 h-8 text-cyan-500"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-bold text-lg text-slate-800",children:" "}),d.jsx("p",{className:"text-sm text-slate-500 leading-tight",children:"         ."}),d.jsxs("div",{className:"mt-2 text-xs font-bold text-cyan-600 bg-cyan-50 px-2 py-0.5 rounded-md w-fit",children:[" : ",r]})]}),d.jsx("button",{onClick:u,disabled:o||t<50,className:`flex flex-col items-center justify-center w-20 h-14 rounded-xl font-bold transition-all active:scale-95 border-b-4
                                ${t>=50?"bg-blue-500 hover:bg-blue-400 text-white border-blue-700 shadow-lg":"bg-slate-200 text-slate-400 border-slate-300 cursor-not-allowed"}
                            `,children:o?d.jsx("div",{className:"w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"}):d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"text-lg leading-none",children:"50"}),d.jsx("span",{className:"text-[10px] opacity-80",children:""})]})})]}),l&&d.jsx("div",{className:`p-3 rounded-xl text-center font-bold animate-in slide-in-from-bottom-2 ${l.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:l.text})]})]})]})};/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var c0e={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}};/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=(n,e,t,r)=>{const s=V.forwardRef(({color:i="currentColor",size:o=24,stroke:a=2,title:l,className:c,children:u,...h},f)=>V.createElement("svg",{ref:f,...c0e[n],width:o,height:o,className:["tabler-icon",`tabler-icon-${e}`,c].join(" "),...n==="filled"?{fill:i}:{strokeWidth:a,stroke:i},...h},[l&&V.createElement("title",{key:"svg-title"},l),...r.map(([p,g])=>V.createElement(p,g)),...Array.isArray(u)?u:[u]]));return s.displayName=`${t}`,s};/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const u0e=[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]],d0e=At("outline","alert-triangle","AlertTriangle",u0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0e=[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M5 12l6 6",key:"svg-1"}],["path",{d:"M5 12l6 -6",key:"svg-2"}]],f0e=At("outline","arrow-left","ArrowLeft",h0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const p0e=[["path",{d:"M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6",key:"svg-0"}],["path",{d:"M9 17v1a3 3 0 0 0 6 0v-1",key:"svg-1"}]],m0e=At("outline","bell","Bell",p0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const g0e=[["path",{d:"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-0"}],["path",{d:"M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-1"}],["path",{d:"M3 6l0 13",key:"svg-2"}],["path",{d:"M12 6l0 13",key:"svg-3"}],["path",{d:"M21 6l0 13",key:"svg-4"}]],R1=At("outline","book","Book",g0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const y0e=[["path",{d:"M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z",key:"svg-0"}]],x0e=At("outline","bookmark","Bookmark",y0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const b0e=[["path",{d:"M2 8a4 4 0 0 1 4 -4h12a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-12a4 4 0 0 1 -4 -4v-8z",key:"svg-0"}],["path",{d:"M10 9l5 3l-5 3z",key:"svg-1"}]],v0e=At("outline","brand-youtube","BrandYoutube",b0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const w0e=[["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-0"}],["path",{d:"M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3",key:"svg-1"}],["path",{d:"M9.7 17l4.6 0",key:"svg-2"}]],q4=At("outline","bulb","Bulb",w0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0e=[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]],M_=At("outline","check","Check",k0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0e=[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]],wc=At("outline","chevron-left","ChevronLeft",_0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0e=[["path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2",key:"svg-0"}],["path",{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z",key:"svg-1"}],["path",{d:"M9 14l2 2l4 -4",key:"svg-2"}]],M1=At("outline","clipboard-check","ClipboardCheck",S0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0e=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]],tS=At("outline","clock","Clock",T0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0e=[["path",{d:"M12 5h3.5a5 5 0 0 1 0 10h-5.5l-4.015 4.227a2.3 2.3 0 0 1 -3.923 -2.035l1.634 -8.173a5 5 0 0 1 4.904 -4.019h3.4z",key:"svg-0"}],["path",{d:"M14 15l4.07 4.284a2.3 2.3 0 0 0 3.925 -2.023l-1.6 -8.232",key:"svg-1"}],["path",{d:"M8 9v2",key:"svg-2"}],["path",{d:"M7 10h2",key:"svg-3"}],["path",{d:"M14 10h2",key:"svg-4"}]],E0e=At("outline","device-gamepad-2","DeviceGamepad2",A0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0e=[["path",{d:"M6 5h12l3 5l-8.5 9.5a.7 .7 0 0 1 -1 0l-8.5 -9.5l3 -5",key:"svg-0"}],["path",{d:"M10 12l-2 -2.2l.6 -1",key:"svg-1"}]],K6=At("outline","diamond","Diamond",C0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const N0e=[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]],BD=At("outline","external-link","ExternalLink",N0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0e=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M9 9l1 0",key:"svg-2"}],["path",{d:"M9 13l6 0",key:"svg-3"}],["path",{d:"M9 17l6 0",key:"svg-4"}]],R0e=At("outline","file-text","FileText",I0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0e=[["path",{d:"M12 10.941c2.333 -3.308 .167 -7.823 -1 -8.941c0 3.395 -2.235 5.299 -3.667 6.706c-1.43 1.408 -2.333 3.621 -2.333 5.588c0 3.704 3.134 6.706 7 6.706s7 -3.002 7 -6.706c0 -1.712 -1.232 -4.403 -2.333 -5.588c-2.084 3.353 -3.257 3.353 -4.667 2.235",key:"svg-0"}]],$D=At("outline","flame","Flame",M0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0e=[["path",{d:"M9 3l6 0",key:"svg-0"}],["path",{d:"M10 9l4 0",key:"svg-1"}],["path",{d:"M10 3v6l-4 11a.7 .7 0 0 0 .5 1h11a.7 .7 0 0 0 .5 -1l-4 -11v-6",key:"svg-2"}]],L0e=At("outline","flask","Flask",P0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0e=[["path",{d:"M5 9l14 0",key:"svg-0"}],["path",{d:"M5 15l14 0",key:"svg-1"}],["path",{d:"M11 4l-4 16",key:"svg-2"}],["path",{d:"M17 4l-4 16",key:"svg-3"}]],j0e=At("outline","hash","Hash",D0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0e=[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]],F0e=At("outline","history","History",O0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0e=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]],B0e=At("outline","info-circle","InfoCircle",z0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0e=[["path",{d:"M9 6.371c0 4.418 -2.239 6.629 -5 6.629",key:"svg-0"}],["path",{d:"M4 6.371h7",key:"svg-1"}],["path",{d:"M5 9c0 2.144 2.252 3.908 6 4",key:"svg-2"}],["path",{d:"M12 20l4 -9l4 9",key:"svg-3"}],["path",{d:"M19.1 18h-6.2",key:"svg-4"}],["path",{d:"M6.694 3l.793 .582",key:"svg-5"}]],Y6=At("outline","language","Language",$0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0e=[["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M4 14m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-1"}]],Zq=At("outline","layout-list","LayoutList",V0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0e=[["path",{d:"M12 3a9 9 0 1 0 9 9",key:"svg-0"}]],VD=At("outline","loader-2","Loader2",U0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0e=[["path",{d:"M19 5h-7l-4 14l-3 -6h-2",key:"svg-0"}],["path",{d:"M14 13l6 6",key:"svg-1"}],["path",{d:"M14 19l6 -6",key:"svg-2"}]],UD=At("outline","math","Math",H0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0e=[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]],G0e=At("outline","message","Message",q0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0e=[["path",{d:"M9 2m0 3a3 3 0 0 1 3 -3h0a3 3 0 0 1 3 3v5a3 3 0 0 1 -3 3h0a3 3 0 0 1 -3 -3z",key:"svg-0"}],["path",{d:"M5 10a7 7 0 0 0 14 0",key:"svg-1"}],["path",{d:"M8 21l8 0",key:"svg-2"}],["path",{d:"M12 17l0 4",key:"svg-3"}]],K0e=At("outline","microphone","Microphone",W0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0e=[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 10l.01 0",key:"svg-1"}],["path",{d:"M15 10l.01 0",key:"svg-2"}],["path",{d:"M9.5 15a3.5 3.5 0 0 0 5 0",key:"svg-3"}]],eG=At("outline","mood-smile","MoodSmile",Y0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0e=[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]],J0e=At("outline","pencil","Pencil",X0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0e=[["path",{d:"M15 8h.01",key:"svg-0"}],["path",{d:"M3 6a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v12a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3v-12z",key:"svg-1"}],["path",{d:"M3 16l5 -5c.928 -.893 2.072 -.893 3 0l5 5",key:"svg-2"}],["path",{d:"M14 14l1 -1c.928 -.893 2.072 -.893 3 0l3 3",key:"svg-3"}]],Z0e=At("outline","photo","Photo",Q0e);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const eme=[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]],tG=At("outline","refresh","Refresh",eme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const tme=[["path",{d:"M6 4m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 2v2",key:"svg-1"}],["path",{d:"M9 12v9",key:"svg-2"}],["path",{d:"M15 12v9",key:"svg-3"}],["path",{d:"M5 16l4 -2",key:"svg-4"}],["path",{d:"M15 14l4 2",key:"svg-5"}],["path",{d:"M9 18h6",key:"svg-6"}],["path",{d:"M10 8v.01",key:"svg-7"}],["path",{d:"M14 8v.01",key:"svg-8"}]],X6=At("outline","robot","Robot",tme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const nme=[["path",{d:"M4.05 11a8 8 0 1 1 .5 4m-.5 5v-5h5",key:"svg-0"}]],rme=At("outline","rotate-clockwise","RotateClockwise",nme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const sme=[["path",{d:"M22 9l-10 -4l-10 4l10 4l10 -4v6",key:"svg-0"}],["path",{d:"M6 10.6v5.4a6 3 0 0 0 12 0v-5.4",key:"svg-1"}]],ime=At("outline","school","School",sme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ome=[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]],ame=At("outline","send","Send",ome);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const lme=[["path",{d:"M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-2"}],["path",{d:"M8.7 10.7l6.6 -3.4",key:"svg-3"}],["path",{d:"M8.7 13.3l6.6 3.4",key:"svg-4"}]],cme=At("outline","share","Share",lme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ume=[["path",{d:"M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3",key:"svg-0"}],["path",{d:"M12 11m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12 12l0 2.5",key:"svg-2"}]],dme=At("outline","shield-lock","ShieldLock",ume);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const hme=[["path",{d:"M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z",key:"svg-0"}],["path",{d:"M9 11v-5a3 3 0 0 1 6 0v5",key:"svg-1"}]],fme=At("outline","shopping-bag","ShoppingBag",hme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const pme=[["path",{d:"M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm0 -12a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2zm-7 12a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6z",key:"svg-0"}]],ng=At("outline","sparkles","Sparkles",pme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const mme=[["path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z",key:"svg-0"}]],rg=At("outline","star","Star",mme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const gme=[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0",key:"svg-1"}],["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-2"}]],P_=At("outline","target","Target",gme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const yme=[["path",{d:"M8 21l8 0",key:"svg-0"}],["path",{d:"M12 17l0 4",key:"svg-1"}],["path",{d:"M7 4l10 0",key:"svg-2"}],["path",{d:"M17 4v8a5 5 0 0 1 -10 0v-8",key:"svg-3"}],["path",{d:"M5 9m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-4"}],["path",{d:"M19 9m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-5"}]],J6=At("outline","trophy","Trophy",yme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const xme=[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]],G4=At("outline","upload","Upload",xme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const bme=[["path",{d:"M15 10l4.553 -2.276a1 1 0 0 1 1.447 .894v6.764a1 1 0 0 1 -1.447 .894l-4.553 -2.276v-4z",key:"svg-0"}],["path",{d:"M3 6m0 2a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-8a2 2 0 0 1 -2 -2z",key:"svg-1"}]],HD=At("outline","video","Video",bme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const vme=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],wme=At("outline","x","X",vme);/**
 * @license @tabler/icons-react v3.36.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const kme=[["path",{d:"M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z",key:"svg-0"}]],_me=At("filled","player-play-filled","PlayerPlayFilled",kme),Sme=({onContinue:n,onReview:e,xpGained:t=50,gemsGained:r=2})=>d.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[d.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300"}),d.jsxs("div",{className:"relative bg-white w-full max-w-sm rounded-[32px] shadow-2xl p-8 flex flex-col items-center text-center animate-in zoom-in-90 slide-in-from-bottom-10 duration-500 overflow-hidden",children:[d.jsx("div",{className:"absolute top-0 left-0 right-0 h-40 bg-gradient-to-b from-blue-50 to-transparent -z-10"}),d.jsxs("div",{className:"relative mb-6",children:[d.jsx("div",{className:"absolute inset-0 bg-blue-400 blur-2xl opacity-20 animate-pulse"}),d.jsxs("div",{className:"relative transform hover:scale-110 transition-transform duration-500",children:[d.jsx(J6,{size:80,className:"text-yellow-400 drop-shadow-[0_10px_10px_rgba(0,0,0,0.2)]",stroke:1.5,fill:"#FACC15"}),d.jsx(rg,{className:"absolute -top-2 -right-4 text-yellow-300 w-8 h-8 animate-bounce delay-100 drop-shadow-sm",fill:"currentColor"}),d.jsx(rg,{className:"absolute top-10 -left-6 text-yellow-300 w-6 h-6 animate-bounce delay-300 drop-shadow-sm",fill:"currentColor"})]})]}),d.jsx("h2",{className:"text-3xl font-black text-slate-800 mb-2 tracking-tight",children:"  !"}),d.jsx("p",{className:"text-slate-500 font-medium mb-8",children:" !    ."}),d.jsxs("div",{className:"flex items-center justify-center gap-4 w-full mb-8",children:[d.jsxs("div",{className:"flex items-center gap-2 bg-yellow-50 border border-yellow-100 px-4 py-2 rounded-2xl w-full justify-center shadow-sm",children:[d.jsx(rg,{className:"text-yellow-500 w-6 h-6",fill:"currentColor"}),d.jsxs("span",{className:"font-black text-slate-700 text-lg",children:["+",t," XP"]})]}),d.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 border border-blue-100 px-4 py-2 rounded-2xl w-full justify-center shadow-sm",children:[d.jsx(K6,{className:"text-blue-500 w-6 h-6",fill:"currentColor"}),d.jsxs("span",{className:"font-black text-slate-700 text-lg",children:["+",r]})]})]}),d.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[d.jsxs("button",{onClick:n,className:"w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-bold text-xl shadow-lg shadow-blue-200 transform transition-all active:scale-95 flex items-center justify-center gap-2",children:[d.jsx("span",{children:""}),d.jsx(f0e,{size:24})]}),e&&d.jsxs("button",{onClick:e,className:"w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl font-bold text-lg transition-colors flex items-center justify-center gap-2",children:[d.jsx(rme,{size:20}),d.jsx("span",{children:"  "})]})]})]})]}),qD=(n,e="socratic")=>{const t=N_[e]||N_.socratic,r=n==="interactive-chat"?wfe(e):"";let s="";switch(n){case"multiple-choice":s={question:"     ",options:[" "," "," "," "],correctAnswer:" "};break;case"open-question":s={question:"     "};break;case"interactive-chat":s={title:t.name,description:"'..."};break;case"fill_in_blanks":s={text:"  : []    []."};break;case"ordering":s={instruction:"    :",correct_order:[" "," "," "]};break;case"categorization":s={question:"    :",categories:[" "," "],items:[{text:" 1",category:" "},{text:" 2",category:" "}]};break;case"memory_game":s={pairs:[{card_a:" 1",card_b:" 1"},{card_a:" 2",card_b:" 2"},{card_a:" 3",card_b:" 3"}]};break;case"true_false_speed":s={statement:"     ",answer:!0};break;case"podcast":s={title:" AI",audioUrl:null,script:null,description:" "};break;case"audio-response":s={question:"  :",description:"    ",maxDuration:60};break;case"drag_and_drop":s={instruction:"    :",zones:[{id:"zone1",label:" 1",color:"#E0F2FE"},{id:"zone2",label:" 2",color:"#FEF3C7"}],items:[{id:"item1",text:" 1",correctZone:"zone1"},{id:"item2",text:" 2",correctZone:"zone2"}]};break;case"hotspot":s={instruction:"    :",image_description:" ",hotspots:[{id:"spot1",label:" 1",x:25,y:25,width:20,height:20,feedback:"   "},{id:"spot2",label:" 2",x:60,y:40,width:20,height:20,feedback:"   "}]};break;case"mindmap":s={title:" ",nodes:[{id:"1",type:"topic",data:{label:" ",color:"#3B82F6"},position:{x:400,y:200}},{id:"2",type:"subtopic",data:{label:"- 1",color:"#10B981"},position:{x:200,y:100}},{id:"3",type:"subtopic",data:{label:"- 2",color:"#10B981"},position:{x:200,y:300}}],edges:[{id:"e1-2",source:"1",target:"2"},{id:"e1-3",source:"1",target:"3"}],layoutDirection:"RL"};break;case"infographic":s={imageUrl:"",title:"",caption:"",visualType:"flowchart"};break;case"matching":s={instruction:"       :",leftItems:[{id:"l1",text:"  1"},{id:"l2",text:"  2"},{id:"l3",text:"  3"}],rightItems:[{id:"r1",text:"  1"},{id:"r2",text:"  2"},{id:"r3",text:"  3"}],correctMatches:[{left:"l1",right:"r1"},{left:"l2",right:"r2"},{left:"l3",right:"r3"}],hints:[]};break;case"highlight":s={instruction:"      :",text:"   .      .",correctHighlights:[{start:15,end:22,text:""}],highlightType:"background",hints:[]};break;case"sentence_builder":s={instruction:"    :",words:[""," ","",""],correctSentence:"    ",hints:[]};break;case"image_labeling":s={instruction:"     :",imageUrl:"",labels:[{id:"label1",text:" 1"},{id:"label2",text:" 2"},{id:"label3",text:" 3"}],dropZones:[{id:"zone1",x:20,y:30,width:15,height:10,correctLabelId:"label1"},{id:"zone2",x:50,y:50,width:15,height:10,correctLabelId:"label2"},{id:"zone3",x:70,y:20,width:15,height:10,correctLabelId:"label3"}],hints:[]};break;case"table_completion":s={instruction:"    :",headers:[" "," "," "],rows:[{cells:[{value:" 1",editable:!1},{value:"",editable:!0,correctAnswer:" 1"},{value:" 2",editable:!1}]},{cells:[{value:"",editable:!0,correctAnswer:" 2"},{value:" 3",editable:!1},{value:"",editable:!0,correctAnswer:" 3"}]}],hints:[]};break;case"text_selection":s={instruction:"     :",text:"      .     .",selectableUnits:"word",correctSelections:["","",""],minSelections:1,maxSelections:5,hints:[]};break;case"rating_scale":s={question:"      ?",minValue:1,maxValue:5,minLabel:"  ",maxLabel:" ",correctAnswer:void 0,showNumbers:!0};break;case"matrix":s={instruction:"      :",columns:[""," "," "],rows:[{question:"  ",correctAnswer:""},{question:"   ",correctAnswer:" "},{question:"   ",correctAnswer:" "}],hints:[]};break;case"text":s="<h3></h3><p>     ...</p>";break;default:s=""}return{id:cn(),type:n,content:s,metadata:{score:0,systemPrompt:r,initialMessage:n==="interactive-chat"?t.initialMessage:"",botPersona:e,caption:"",relatedQuestion:null}}},Tme=async n=>{const e=Ame(n),t=window.open("","_blank","width=800,height=600");if(!t){alert("     ");return}t.document.write(`
    <!DOCTYPE html>
    <html dir="rtl" lang="he">
    <head>
      <meta charset="UTF-8">
      <title>${nn(n.lesson_metadata.title)} -  </title>
      <style>
        @media print {
          body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
          .page-break { page-break-before: always; }
        }
        body {
          font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
          direction: rtl;
          text-align: right;
          margin: 0;
          padding: 20px;
          color: #333;
          background: white;
        }
      </style>
    </head>
    <body>
      ${e}
      <script>
        window.onload = function() {
          setTimeout(function() {
            window.print();
            window.onafterprint = function() { window.close(); };
          }, 250);
        };
      <\/script>
    </body>
    </html>
  `),t.document.close()},Ame=n=>{var t,r,s;const e={"multiple-choice":" -",memory_game:" ",fill_in_blanks:" ",ordering:" ",categorization:" ",drag_and_drop:" ",hotspot:" ","open-question":" "};return`
    <div style="font-family: 'Segoe UI', Tahoma, Arial, sans-serif; direction: rtl; text-align: right; padding: 20px; max-width: 800px; margin: 0 auto; color: #333;">
      <!-- Title Page -->
      <div style="text-align: center; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 3px solid #2B59C3;">
        <h1 style="font-size: 28px; color: #2B59C3; margin-bottom: 20px;">${nn(n.lesson_metadata.title)}</h1>
        <p style="font-size: 16px; color: #666; margin: 8px 0;"> : ${nn(n.lesson_metadata.target_audience)}</p>
        <p style="font-size: 16px; color: #666; margin: 8px 0;">: ${nn(n.lesson_metadata.duration)}</p>
        ${n.lesson_metadata.subject?`<p style="font-size: 16px; color: #666; margin: 8px 0;">: ${nn(n.lesson_metadata.subject)}</p>`:""}
      </div>

      <!-- Learning Objectives -->
      ${n.lesson_metadata.learning_objectives&&n.lesson_metadata.learning_objectives.length>0?`
        <div style="margin-bottom: 25px;">
          <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
            <h2 style="margin: 0; font-size: 18px;">  </h2>
          </div>
          <ul style="margin: 0; padding-right: 25px;">
            ${n.lesson_metadata.learning_objectives.map(i=>`<li style="margin: 8px 0;">${nn(i)}</li>`).join("")}
          </ul>
        </div>
      `:""}

      <!-- Hook -->
      <div style="margin-bottom: 25px;">
        <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
          <h2 style="margin: 0; font-size: 18px;">  (Hook)</h2>
        </div>
        <p style="line-height: 1.8;">${nn(n.hook.script_for_teacher)}</p>
        ${n.hook.media_asset?`<p style="color: #666; font-style: italic;">[: ${nn(n.hook.media_asset.type)}]</p>`:""}
        ${n.hook.classroom_management_tip?`
          <div style="background: #FEF3C7; padding: 10px 15px; border-radius: 5px; border-right: 4px solid #D97706; margin-top: 10px;">
            <p style="margin: 0; color: #92400E;">   : ${nn(n.hook.classroom_management_tip)}</p>
          </div>
        `:""}
      </div>

      <!-- Direct Instruction - Each as separate section -->
      ${n.direct_instruction.slides.map((i,o)=>`
        <div style="margin-bottom: 25px; ${o===0?"page-break-before: always;":""}">
          <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
            <h2 style="margin: 0; font-size: 18px;">  : ${nn(i.slide_title)}</h2>
            ${i.timing_estimate?`<span style="font-size: 14px; opacity: 0.9;">  ${nn(i.timing_estimate)}</span>`:""}
          </div>
          <div style="padding: 15px; background: #F9FAFB; border-radius: 8px; border: 1px solid #E5E7EB;">
            <p style="font-weight: bold; margin-bottom: 5px;">  :</p>
            <ul style="margin: 0 0 15px 0; padding-right: 25px;">
              ${i.bullet_points_for_board.map(a=>`<li style="margin: 5px 0;">${nn(a)}</li>`).join("")}
            </ul>

            <p style="font-weight: bold; margin-bottom: 5px;"> :</p>
            <p style="line-height: 1.8; background: white; padding: 10px; border-radius: 5px;">${nn(i.script_to_say)}</p>

            ${i.differentiation_note?`
              <div style="background: #F3E8FF; padding: 8px 12px; border-radius: 5px; margin-top: 10px;">
                <p style="margin: 0; color: #7C3AED; font-size: 14px;"> : ${nn(i.differentiation_note)}</p>
              </div>
            `:""}

            ${i.media_asset?`<p style="color: #666; font-style: italic; margin-top: 10px;">[: ${nn(i.media_asset.type)}]</p>`:""}
          </div>
        </div>
      `).join("")}

      <!-- Guided Practice -->
      <div style="margin-bottom: 25px; page-break-before: always;">
        <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
          <h2 style="margin: 0; font-size: 18px;">   (Guided Practice)</h2>
        </div>
        <p style="line-height: 1.8;">${nn(n.guided_practice.teacher_facilitation_script)}</p>

        ${n.guided_practice.example_questions&&n.guided_practice.example_questions.length>0?`
          <div style="margin-top: 20px;">
            <p style="font-weight: bold; font-size: 16px; color: #2B59C3;">   :</p>
            ${n.guided_practice.example_questions.map((i,o)=>`
              <div style="background: #EFF6FF; padding: 15px; border-radius: 8px; margin: 12px 0; border-right: 4px solid #2B59C3;">
                <p style="margin: 0; font-weight: bold; color: #1E40AF;"> ${o+1}: ${nn(i.question_text)}</p>
                <p style="margin: 10px 0 5px 0; color: #166534;"><strong>  :</strong> ${nn(i.expected_answer)}</p>
                ${i.common_mistakes&&i.common_mistakes.length>0?`
                  <p style="margin: 5px 0; color: #DC2626;"><strong>  :</strong> ${i.common_mistakes.map(a=>nn(a)).join(" | ")}</p>
                `:""}
                ${i.follow_up_prompt?`<p style="margin: 5px 0 0 0; color: #7C3AED;"><strong>  :</strong> ${nn(i.follow_up_prompt)}</p>`:""}
              </div>
            `).join("")}
          </div>
        `:""}

        ${n.guided_practice.worked_example?`
          <div style="margin-top: 20px; background: #FEF3C7; padding: 15px; border-radius: 8px; border: 2px solid #F59E0B;">
            <p style="font-weight: bold; font-size: 16px; color: #B45309; margin-top: 0;">   (  ):</p>
            <p style="margin: 10px 0; font-weight: bold;">${nn(n.guided_practice.worked_example.problem)}</p>
            <div style="background: white; padding: 12px; border-radius: 5px; margin: 10px 0;">
              <p style="font-weight: bold; margin-top: 0;"> :</p>
              <ol style="margin: 0; padding-right: 25px;">
                ${n.guided_practice.worked_example.solution_steps.map(i=>`<li style="margin: 8px 0;">${nn(i)}</li>`).join("")}
              </ol>
            </div>
            ${n.guided_practice.worked_example.key_points&&n.guided_practice.worked_example.key_points.length>0?`
              <div style="margin-top: 10px;">
                <p style="font-weight: bold; color: #B45309;">  :</p>
                <ul style="margin: 0; padding-right: 25px;">
                  ${n.guided_practice.worked_example.key_points.map(i=>`<li style="margin: 5px 0;">${nn(i)}</li>`).join("")}
                </ul>
              </div>
            `:""}
          </div>
        `:""}

        ${n.guided_practice.suggested_activities&&n.guided_practice.suggested_activities.length>0?`
          <div style="margin-top: 15px;">
            <p style="font-weight: bold;"> :</p>
            ${n.guided_practice.suggested_activities.map(i=>`
              <div style="background: #F0FDF4; padding: 10px 15px; border-radius: 5px; margin: 8px 0; border-right: 4px solid #22C55E;">
                <p style="margin: 0; font-weight: bold;">${nn(e[i.activity_type]||i.activity_type)}</p>
                <p style="margin: 5px 0 0 0;">${nn(i.description)}</p>
                ${i.facilitation_tip?`<p style="margin: 5px 0 0 0; color: #666; font-size: 14px;"> ${nn(i.facilitation_tip)}</p>`:""}
              </div>
            `).join("")}
          </div>
        `:""}

        ${n.guided_practice.differentiation_strategies?`
          <div style="margin-top: 15px; background: #F3E8FF; padding: 15px; border-radius: 8px;">
            <p style="font-weight: bold; margin-top: 0;">:</p>
            <p style="margin: 8px 0;">  : ${nn(n.guided_practice.differentiation_strategies.for_struggling_students)}</p>
            <p style="margin: 8px 0;">  : ${nn(n.guided_practice.differentiation_strategies.for_advanced_students)}</p>
          </div>
        `:""}

        ${n.guided_practice.assessment_tips&&n.guided_practice.assessment_tips.length>0?`
          <div style="margin-top: 15px;">
            <p style="font-weight: bold;">   :</p>
            <ul style="margin: 0; padding-right: 25px;">
              ${n.guided_practice.assessment_tips.map(i=>`<li style="margin: 5px 0;">${nn(i)}</li>`).join("")}
            </ul>
          </div>
        `:""}
      </div>

      <!-- Independent Practice -->
      <div style="margin-bottom: 25px;">
        <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
          <h2 style="margin: 0; font-size: 18px;">   (Independent Practice)</h2>
        </div>
        <p style="line-height: 1.8;">${nn(((t=n.independent_practice)==null?void 0:t.introduction_text)||"   ")}</p>
        ${(r=n.independent_practice)!=null&&r.estimated_duration?`<p style="color: #6366F1; font-style: italic;">  : ${nn(n.independent_practice.estimated_duration)}</p>`:""}
        ${(s=n.independent_practice)!=null&&s.interactive_blocks&&n.independent_practice.interactive_blocks.length>0?`
          <div style="background: #EFF6FF; padding: 12px 15px; border-radius: 5px; margin-top: 10px;">
            <p style="margin: 0; font-weight: bold;"> ${n.independent_practice.interactive_blocks.length}   </p>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">(     )</p>
          </div>
        `:""}
      </div>

      <!-- Discussion -->
      <div style="margin-bottom: 25px;">
        <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
          <h2 style="margin: 0; font-size: 18px;">  (Discussion)</h2>
        </div>
        ${n.discussion.questions&&n.discussion.questions.length>0?`
          <p style="font-weight: bold;"> :</p>
          <ul style="margin: 0 0 15px 0; padding-right: 25px;">
            ${n.discussion.questions.map(i=>`<li style="margin: 8px 0;">${nn(i)}</li>`).join("")}
          </ul>
        `:""}
        ${n.discussion.facilitation_tips&&n.discussion.facilitation_tips.length>0?`
          <div style="background: #DBEAFE; padding: 12px 15px; border-radius: 5px;">
            <p style="font-weight: bold; color: #1D4ED8; margin-top: 0;">  :</p>
            <ul style="margin: 0; padding-right: 25px;">
              ${n.discussion.facilitation_tips.map(i=>`<li style="margin: 5px 0; color: #1E40AF;">${nn(i)}</li>`).join("")}
            </ul>
          </div>
        `:""}
      </div>

      <!-- Summary -->
      <div style="margin-bottom: 25px;">
        <div style="background: #2B59C3; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px;">
          <h2 style="margin: 0; font-size: 18px;">  (Summary)</h2>
        </div>
        <div style="background: linear-gradient(135deg, #EFF6FF, #DBEAFE); padding: 20px; border-radius: 8px; text-align: center;">
          <p style="font-size: 18px; font-weight: bold; color: #1D4ED8; margin: 0;">${nn(n.summary.takeaway_sentence)}</p>
        </div>
        ${n.summary.homework_suggestion?`
          <div style="background: #F3E8FF; padding: 12px 15px; border-radius: 5px; margin-top: 15px; border-right: 4px solid #9333EA;">
            <p style="font-weight: bold; color: #7C3AED; margin: 0 0 5px 0;">  :</p>
            <p style="margin: 0;">${nn(n.summary.homework_suggestion)}</p>
          </div>
        `:""}
      </div>

      <!-- Footer -->
      <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #E5E7EB; color: #9CA3AF; font-size: 12px;">
        <p> " wizdi</p>
      </div>
    </div>
  `},nn=n=>{const e=document.createElement("div");return e.textContent=n,e.innerHTML},Eme=async(n,e)=>{await Tme(n)},Q6=async(n,e,t,r)=>{if(n.size>10485760)throw new Error(`Image size too large (${(n.size/1024/1024).toFixed(2)}MB). Max allowed is 10MB.`);const i=n.type||"image/png",o=i.includes("jpeg")||i.includes("jpg")?"jpg":"png",a=`${cn()}.${o}`,l=e==="infographic"?"infographics":"ai_images",c=t&&r?`generated_images/${l}/${t}/${r}/${a}`:`generated_images/${l}/${a}`,u=Hw(Gw,c);try{const h=await Y3(u,n,{contentType:i,customMetadata:{type:e,generatedAt:new Date().toISOString()}}),f=await Uw(h.ref);return console.log(` Image uploaded to Storage: ${c}`),f}catch(h){throw console.error("Image Upload Failed:",h),new Error("Failed to upload generated image.")}},nG=async(n,e,t)=>{if(n.size>3145728)throw new Error(`File size too large (${(n.size/1024/1024).toFixed(2)}MB). Max allowed is 3MB.`);const s=`${cn()}.webm`,i=`student_uploads/${e}/assignments/${t}/audio/${s}`,o=Hw(Gw,i);try{const a=await Y3(o,n);return await Uw(a.ref)}catch(a){throw console.error("Audio Upload Failed:",a),new Error("Failed to upload audio recording.")}},Cme=Object.freeze(Object.defineProperty({__proto__:null,uploadGeneratedImage:Q6,uploadStudentAudio:nG},Symbol.toStringTag,{value:"Module"}));var rG={exports:{}},sG={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P1=V;function Nme(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ime=typeof Object.is=="function"?Object.is:Nme,Rme=P1.useState,Mme=P1.useEffect,Pme=P1.useLayoutEffect,Lme=P1.useDebugValue;function Dme(n,e){var t=e(),r=Rme({inst:{value:t,getSnapshot:e}}),s=r[0].inst,i=r[1];return Pme(function(){s.value=t,s.getSnapshot=e,WT(s)&&i({inst:s})},[n,t,e]),Mme(function(){return WT(s)&&i({inst:s}),n(function(){WT(s)&&i({inst:s})})},[n]),Lme(t),t}function WT(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ime(n,t)}catch{return!0}}function jme(n,e){return e()}var Ome=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?jme:Dme;sG.useSyncExternalStore=P1.useSyncExternalStore!==void 0?P1.useSyncExternalStore:Ome;rG.exports=sG;var M8=rG.exports;function Gs(n){this.content=n}Gs.prototype={constructor:Gs,find:function(n){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===n)return e;return-1},get:function(n){var e=this.find(n);return e==-1?void 0:this.content[e+1]},update:function(n,e,t){var r=t&&t!=n?this.remove(t):this,s=r.find(n),i=r.content.slice();return s==-1?i.push(t||n,e):(i[s+1]=e,t&&(i[s]=t)),new Gs(i)},remove:function(n){var e=this.find(n);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new Gs(t)},addToStart:function(n,e){return new Gs([n,e].concat(this.remove(n).content))},addToEnd:function(n,e){var t=this.remove(n).content.slice();return t.push(n,e),new Gs(t)},addBefore:function(n,e,t){var r=this.remove(e),s=r.content.slice(),i=r.find(n);return s.splice(i==-1?s.length:i,0,e,t),new Gs(s)},forEach:function(n){for(var e=0;e<this.content.length;e+=2)n(this.content[e],this.content[e+1])},prepend:function(n){return n=Gs.from(n),n.size?new Gs(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Gs.from(n),n.size?new Gs(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var e=this;n=Gs.from(n);for(var t=0;t<n.content.length;t+=2)e=e.remove(n.content[t]);return e},toObject:function(){var n={};return this.forEach(function(e,t){n[e]=t}),n},get size(){return this.content.length>>1}};Gs.from=function(n){if(n instanceof Gs)return n;var e=[];if(n)for(var t in n)e.push(t,n[t]);return new Gs(e)};function iG(n,e,t){for(let r=0;;r++){if(r==n.childCount||r==e.childCount)return n.childCount==e.childCount?null:t;let s=n.child(r),i=e.child(r);if(s==i){t+=s.nodeSize;continue}if(!s.sameMarkup(i))return t;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)t++;return t}if(s.content.size||i.content.size){let o=iG(s.content,i.content,t+1);if(o!=null)return o}t+=s.nodeSize}}function oG(n,e,t,r){for(let s=n.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:t,b:r};let o=n.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){t-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:t,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,r--;return{a:t,b:r}}if(o.content.size||a.content.size){let c=oG(o.content,a.content,t-1,r-1);if(c)return c}t-=l,r-=l}}class ge{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,t,r,s=0,i){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),r,s+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,r,s){let i="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(r)&&(s[s.length-1]=t.withText(t.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new ge(s,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let r=[],s=0;if(t>e)for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),r.push(a),s+=a.nodeSize),o=l}return new ge(r,s)}cutByIndex(e,t){return e==t?ge.empty:e==0&&t==this.content.length?this:new ge(this.content.slice(e,t))}replaceChild(e,t){let r=this.content[e];if(r==t)return this;let s=this.content.slice(),i=this.size+t.nodeSize-r.nodeSize;return s[e]=t,new ge(s,i)}addToStart(e){return new ge([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ge(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,r=0;t<this.content.length;t++){let s=this.content[t];e(s,r,t),r+=s.nodeSize}}findDiffStart(e,t=0){return iG(this,e,t)}findDiffEnd(e,t=this.size,r=e.size){return oG(this,e,t,r)}findIndex(e){if(e==0)return G2(0,e);if(e==this.size)return G2(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,r=0;;t++){let s=this.child(t),i=r+s.nodeSize;if(i>=e)return i==e?G2(t+1,i):G2(t,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ge.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ge(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ge.empty;let t,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(t||(t=e.slice(0,s)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new ge(t||e,r)}static from(e){if(!e)return ge.empty;if(e instanceof ge)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ge([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ge.empty=new ge([],0);const KT={index:0,offset:0};function G2(n,e){return KT.index=n,KT.offset=e,KT}function L_(n,e){if(n===e)return!0;if(!(n&&typeof n=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(n);if(Array.isArray(e)!=t)return!1;if(t){if(n.length!=e.length)return!1;for(let r=0;r<n.length;r++)if(!L_(n[r],e[r]))return!1}else{for(let r in n)if(!(r in e)||!L_(n[r],e[r]))return!1;for(let r in e)if(!(r in n))return!1}return!0}let Fn=class Z6{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),r=!0),t&&t.push(i)}}return t||(t=e.slice()),r||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&L_(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[t.type];if(!r)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=r.create(t.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(t[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Z6.none;if(e instanceof Z6)return[e];let t=e.slice();return t.sort((r,s)=>r.type.rank-s.type.rank),t}};Fn.none=[];class D_ extends Error{}class De{constructor(e,t,r){this.content=e,this.openStart=t,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let r=lG(this.content,e+this.openStart,t);return r&&new De(r,this.openStart,this.openEnd)}removeBetween(e,t){return new De(aG(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return De.empty;let r=t.openStart||0,s=t.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new De(ge.fromJSON(e,t.content),r,s)}static maxOpen(e,t=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)s++;return new De(e,r,s)}}De.empty=new De(ge.empty,0,0);function aG(n,e,t){let{index:r,offset:s}=n.findIndex(e),i=n.maybeChild(r),{index:o,offset:a}=n.findIndex(t);if(s==e||i.isText){if(a!=t&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,e).append(n.cut(t))}if(r!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(r,i.copy(aG(i.content,e-s-1,t-s-1)))}function lG(n,e,t,r){let{index:s,offset:i}=n.findIndex(e),o=n.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,t)?null:n.cut(0,e).append(t).append(n.cut(e));let a=lG(o.content,e-i-1,t,o);return a&&n.replaceChild(s,o.copy(a))}function Fme(n,e,t){if(t.openStart>n.depth)throw new D_("Inserted content deeper than insertion position");if(n.depth-t.openStart!=e.depth-t.openEnd)throw new D_("Inconsistent open depths");return cG(n,e,t,0)}function cG(n,e,t,r){let s=n.index(r),i=n.node(r);if(s==e.index(r)&&r<n.depth-t.openStart){let o=cG(n,e,t,r+1);return i.copy(i.content.replaceChild(s,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&n.depth==r&&e.depth==r){let o=n.parent,a=o.content;return g0(o,a.cut(0,n.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=zme(t,n);return g0(i,dG(n,o,a,e,r))}else return g0(i,j_(n,e,r))}function uG(n,e){if(!e.type.compatibleContent(n.type))throw new D_("Cannot join "+e.type.name+" onto "+n.type.name)}function eC(n,e,t){let r=n.node(t);return uG(r,e.node(t)),r}function m0(n,e){let t=e.length-1;t>=0&&n.isText&&n.sameMarkup(e[t])?e[t]=n.withText(e[t].text+n.text):e.push(n)}function Px(n,e,t,r){let s=(e||n).node(t),i=0,o=e?e.index(t):s.childCount;n&&(i=n.index(t),n.depth>t?i++:n.textOffset&&(m0(n.nodeAfter,r),i++));for(let a=i;a<o;a++)m0(s.child(a),r);e&&e.depth==t&&e.textOffset&&m0(e.nodeBefore,r)}function g0(n,e){return n.type.checkContent(e),n.copy(e)}function dG(n,e,t,r,s){let i=n.depth>s&&eC(n,e,s+1),o=r.depth>s&&eC(t,r,s+1),a=[];return Px(null,n,s,a),i&&o&&e.index(s)==t.index(s)?(uG(i,o),m0(g0(i,dG(n,e,t,r,s+1)),a)):(i&&m0(g0(i,j_(n,e,s+1)),a),Px(e,t,s,a),o&&m0(g0(o,j_(t,r,s+1)),a)),Px(r,null,s,a),new ge(a)}function j_(n,e,t){let r=[];if(Px(null,n,t,r),n.depth>t){let s=eC(n,e,t+1);m0(g0(s,j_(n,e,t+1)),r)}return Px(e,null,t,r),new ge(r)}function zme(n,e){let t=e.depth-n.openStart,s=e.node(t).copy(n.content);for(let i=t-1;i>=0;i--)s=e.node(i).copy(ge.from(s));return{start:s.resolveNoCache(n.openStart+t),end:s.resolveNoCache(s.content.size-n.openEnd-t)}}class Nb{constructor(e,t,r){this.pos=e,this.path=t,this.parentOffset=r,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(t);return r?e.child(t).cut(r):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let r=this.path[t*3],s=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return Fn.none;if(this.textOffset)return e.child(t).marks;let r=e.maybeChild(t-1),s=e.maybeChild(t);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let r=t.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!t||t(this.node(r))))return new O_(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let r=[],s=0,i=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(r.push(o,a,s+l),!c||(o=o.child(a),o.isText))break;i=c-1,s+=l+1}return new Nb(t,r,i)}static resolveCached(e,t){let r=GD.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==t)return o}else GD.set(e,r=new Bme);let s=r.elts[r.i]=Nb.resolve(e,t);return r.i=(r.i+1)%$me,s}}class Bme{constructor(){this.elts=[],this.i=0}}const $me=12,GD=new WeakMap;class O_{constructor(e,t,r){this.$from=e,this.$to=t,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Vme=Object.create(null);let Gh=class tC{constructor(e,t,r,s=Fn.none){this.type=e,this.attrs=t,this.marks=s,this.content=r||ge.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,r,s=0){this.content.nodesBetween(e,t,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,r,s){return this.content.textBetween(e,t,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,r){return this.type==e&&L_(this.attrs,t||e.defaultAttrs||Vme)&&Fn.sameSet(this.marks,r||Fn.none)}copy(e=null){return e==this.content?this:new tC(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new tC(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,r=!1){if(e==t)return De.empty;let s=this.resolve(e),i=this.resolve(t),o=r?0:s.sharedDepth(t),a=s.start(o),c=s.node(o).content.cut(s.pos-a,i.pos-a);return new De(c,s.depth-o,i.depth-o)}replace(e,t,r){return Fme(this.resolve(e),this.resolve(t),r)}nodeAt(e){for(let t=this;;){let{index:r,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(r),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(t),index:t,offset:r};let s=this.content.child(t-1);return{node:s,index:t-1,offset:r-s.nodeSize}}resolve(e){return Nb.resolveCached(this,e)}resolveNoCache(e){return Nb.resolve(this,e)}rangeHasMark(e,t,r){let s=!1;return t>e&&this.nodesBetween(e,t,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),hG(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,r=ge.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,t,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Fn.none;for(let t=0;t<this.marks.length;t++){let r=this.marks[t];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Fn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let r;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,r)}let s=ge.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,s,r);return i.type.checkAttrs(i.attrs),i}};Gh.prototype.text=void 0;let Ume=class nC extends Gh{constructor(e,t,r,s){if(super(e,t,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):hG(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new nC(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new nC(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function hG(n,e){for(let t=n.length-1;t>=0;t--)e=n[t].type.name+"("+e+")";return e}class R0{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let r=new Hme(e,t);if(r.next==null)return R0.empty;let s=fG(r);r.next&&r.err("Unexpected trailing text");let i=Jme(Xme(s));return Qme(i,r),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,r=e.childCount){let s=this;for(let i=t;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let r=0;r<e.next.length;r++)if(this.next[t].type==e.next[r].type)return!0;return!1}fillBefore(e,t=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!t||l.validEnd))return ge.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=i(h,a.concat(u));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&t(r.next[s].next)}return t(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}R0.empty=new R0(!0);class Hme{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function fG(n){let e=[];do e.push(qme(n));while(n.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function qme(n){let e=[];do e.push(Gme(n));while(n.next&&n.next!=")"&&n.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Gme(n){let e=Yme(n);for(;;)if(n.eat("+"))e={type:"plus",expr:e};else if(n.eat("*"))e={type:"star",expr:e};else if(n.eat("?"))e={type:"opt",expr:e};else if(n.eat("{"))e=Wme(n,e);else break;return e}function WD(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let e=Number(n.next);return n.pos++,e}function Wme(n,e){let t=WD(n),r=t;return n.eat(",")&&(n.next!="}"?r=WD(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:t,max:r,expr:e}}function Kme(n,e){let t=n.nodeTypes,r=t[e];if(r)return[r];let s=[];for(let i in t){let o=t[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&n.err("No node type or group '"+e+"' found"),s}function Yme(n){if(n.eat("(")){let e=fG(n);return n.eat(")")||n.err("Missing closing paren"),e}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let e=Kme(n,n.next).map(t=>(n.inline==null?n.inline=t.isInline:n.inline!=t.isInline&&n.err("Mixing inline and block content"),{type:"name",value:t}));return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Xme(n){let e=[[]];return s(i(n,0),t()),e;function t(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;s(c,a=t())}else if(o.type=="star"){let l=t();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=t();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();s(i(o.expr,l),u),l=u}if(o.max==-1)s(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();r(l,u),s(i(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function pG(n,e){return e-n}function KD(n,e){let t=[];return r(e),t.sort(pG);function r(s){let i=n[s];if(i.length==1&&!i[0].term)return r(i[0].to);t.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&t.indexOf(l)==-1&&r(l)}}}function Jme(n){let e=Object.create(null);return t(KD(n,0));function t(r){let s=[];r.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<s.length;u++)s[u][0]==a&&(c=s[u][1]);KD(n,l).forEach(u=>{c||s.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[r.join(",")]=new R0(r.indexOf(n.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(pG);i.next.push({type:s[o][0],next:e[a.join(",")]||t(a)})}return i}}function Qme(n,e){for(let t=0,r=[n];t<r.length;t++){let s=r[t],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:c}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(c)==-1&&r.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function mG(n){let e=Object.create(null);for(let t in n){let r=n[t];if(!r.hasDefault)return null;e[t]=r.default}return e}function gG(n,e){let t=Object.create(null);for(let r in n){let s=e&&e[r];if(s===void 0){let i=n[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}t[r]=s}return t}function yG(n,e,t,r){for(let s in e)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${t} of type ${s}`);for(let s in n){let i=n[s];i.validate&&i.validate(e[s])}}function xG(n,e){let t=Object.create(null);if(e)for(let r in e)t[r]=new ege(n,r,e[r]);return t}let YD=class bG{constructor(e,t,r){this.name=e,this.schema=t,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=xG(e,r.attrs),this.defaultAttrs=mG(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==R0.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:gG(this.attrs,e)}create(e=null,t,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Gh(this,this.computeAttrs(e),ge.from(t),Fn.setFrom(r))}createChecked(e=null,t,r){return t=ge.from(t),this.checkContent(t),new Gh(this,this.computeAttrs(e),t,Fn.setFrom(r))}createAndFill(e=null,t,r){if(e=this.computeAttrs(e),t=ge.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let s=this.contentMatch.matchFragment(t),i=s&&s.fillBefore(ge.empty,!0);return i?new Gh(this,e,t.append(i),Fn.setFrom(r)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){yG(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?t&&t.push(e[r]):t||(t=e.slice(0,r));return t?t.length?t:Fn.none:e}static compile(e,t){let r=Object.create(null);e.forEach((i,o)=>r[i]=new bG(i,t,o));let s=t.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Zme(n,e,t){let r=t.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${n}, got ${i}`)}}class ege{constructor(e,t,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Zme(e,t,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class nS{constructor(e,t,r,s){this.name=e,this.rank=t,this.schema=r,this.spec=s,this.attrs=xG(e,s.attrs),this.excluded=null;let i=mG(this.attrs);this.instance=i?new Fn(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Fn(this,gG(this.attrs,e))}static compile(e,t){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new nS(i,s++,t,o)),r}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){yG(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let vG=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=Gs.from(e.nodes),t.marks=Gs.from(e.marks||{}),this.nodes=YD.compile(this.spec.nodes,this),this.marks=nS.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=R0.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?XD(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:XD(this,o.split(" "))}this.nodeFromJSON=s=>Gh.fromJSON(this,s),this.markFromJSON=s=>Fn.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof YD){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,r,s)}text(e,t){let r=this.nodes.text;return new Ume(r,r.defaultAttrs,e,Fn.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}};function XD(n,e){let t=[];for(let r=0;r<e.length;r++){let s=e[r],i=n.marks[s],o=i;if(i)t.push(i);else for(let a in n.marks){let l=n.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return t}function tge(n){return n.tag!=null}function nge(n){return n.style!=null}let Lx=class rC{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let r=this.matchedStyles=[];t.forEach(s=>{if(tge(s))this.tags.push(s);else if(nge(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let r=new QD(this,t,!1);return r.addAll(e,Fn.none,t.from,t.to),r.finish()}parseSlice(e,t={}){let r=new QD(this,t,!0);return r.addAll(e,Fn.none,t.from,t.to),De.maxOpen(r.finish())}matchTag(e,t,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(ige(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,t,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<i)break}t.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=ZD(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=ZD(o)),o.node||o.ignore||o.mark||(o.node=s)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new rC(e,rC.schemaRules(e)))}};const wG={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},rge={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},kG={ol:!0,ul:!0},Ib=1,sC=2,Dx=4;function JD(n,e,t){return e!=null?(e?Ib:0)|(e==="full"?sC:0):n&&n.whitespace=="pre"?Ib|sC:t&~Dx}class W2{constructor(e,t,r,s,i,o){this.type=e,this.attrs=t,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Fn.none,this.match=i||(o&Dx?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(ge.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Ib)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let t=ge.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(ge.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!wG.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class QD{constructor(e,t,r){this.parser=e,this.options=t,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=t.topNode,i,o=JD(null,t.preserveWhitespace,0)|(r?Dx:0);s?i=new W2(s.type,s.attrs,Fn.none,!0,t.topMatch||s.type.contentMatch,o):r?i=new W2(null,null,Fn.none,!0,null,o):i=new W2(e.schema.topNodeType,null,Fn.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let r=e.nodeValue,s=this.top,i=s.options&sC?"full":this.localPreserveWS||(s.options&Ib)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),t,!0),a[l]&&this.insertNode(o.text(a[l]),t,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),t,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,t,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;kG.hasOwnProperty(o)&&this.parser.normalizeLists&&sge(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:rge.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(wG.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let h=l&&l.skip?t:this.readStyles(e,t);h&&this.addAll(e,h),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,r,s){let i,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,t.attrs||null,r,t.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[t.mark];r=r.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,t,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!s||s.length>c.length+a)&&(s=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)t=this.enterInner(s[o],null,t,!1);return t}insertNode(e,t,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let s=this.findPlace(e,t,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Fn.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):ej(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,t,r,s){let i=this.findPlace(e.create(t),r,!1);return i&&(i=this.enterInner(e,t,r,!0,s)),i}enterInner(e,t,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=JD(e,i,o.options);o.options&Dx&&o.content.length==0&&(a|=Dx);let l=Fn.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):ej(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new W2(e,t,l,s,null,a)),this.open++,r}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=Ib)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let r=this.nodes[t].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==t&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,r){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&t.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let r=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let t in this.parser.schema.nodes){let r=this.parser.schema.nodes[t];if(r.isTextblock&&r.defaultAttrs)return r}}}function sge(n){for(let e=n.firstChild,t=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&kG.hasOwnProperty(r)&&t?(t.appendChild(e),e=t):r=="li"?t=e:r&&(t=null)}}function ige(n,e){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,e)}function ZD(n){let e={};for(let t in n)e[t]=n[t];return e}function ej(n,e){let t=e.schema.nodes;for(let r in t){let s=t[r];if(!s.allowsMarkType(n))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(s.contentMatch))return!0}}class J0{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},r){r||(r=YT(t).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(i.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(o,t))}),r}serializeNodeInner(e,t){let{dom:r,contentDOM:s}=W4(YT(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return r}serializeNode(e,t={}){let r=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,t,r={}){let s=this.marks[e.type.name];return s&&W4(YT(r),s(e,t),null,e.attrs)}static renderSpec(e,t,r=null,s){return W4(e,t,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new J0(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=tj(e.nodes);return t.text||(t.text=r=>r.text),t}static marksFromSchema(e){return tj(e.marks)}}function tj(n){let e={};for(let t in n){let r=n[t].spec.toDOM;r&&(e[t]=r)}return e}function YT(n){return n.document||window.document}const nj=new WeakMap;function oge(n){let e=nj.get(n);return e===void 0&&nj.set(n,e=age(n)),e}function age(n){let e=null;function t(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)t(r[s]);else for(let s in r)t(r[s])}return t(n),e}function W4(n,e,t,r){if(typeof e=="string")return{dom:n.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=oge(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(t=s.slice(0,o),s=s.slice(o+1));let a,l=t?n.createElementNS(t,s):n.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let h in c)if(c[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),c[h]):h=="style"&&l.style?l.style.cssText=c[h]:l.setAttribute(h,c[h])}}for(let h=u;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:g}=W4(n,f,t,r);if(l.appendChild(p),g){if(a)throw new RangeError("Multiple content holes");a=g}}}return{dom:l,contentDOM:a}}const _G=65535,SG=Math.pow(2,16);function lge(n,e){return n+e*SG}function rj(n){return n&_G}function cge(n){return(n-(n&_G))/SG}const TG=1,AG=2,K4=4,EG=8;class iC{constructor(e,t,r){this.pos=e,this.delInfo=t,this.recover=r}get deleted(){return(this.delInfo&EG)>0}get deletedBefore(){return(this.delInfo&(TG|K4))>0}get deletedAfter(){return(this.delInfo&(AG|K4))>0}get deletedAcross(){return(this.delInfo&K4)>0}}class na{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&na.empty)return na.empty}recover(e){let t=0,r=rj(e);if(!this.inverted)for(let s=0;s<r;s++)t+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+t+cge(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],h=l+c;if(e<=h){let f=c?e==l?-1:e==h?1:t:t,p=l+s+(f<0?0:u);if(r)return p;let g=e==(t<0?l:h)?null:lge(a/3,e-l),y=e==l?AG:e==h?TG:K4;return(t<0?e!=l:e!=h)&&(y|=EG),new iC(p,y,g)}s+=u-c}return r?e+s:new iC(e+s,0,null)}touches(e,t){let r=0,s=rj(t),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==s*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[s+t],u=this.ranges[s+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new na(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?na.empty:new na(e<0?[0,-e,0]:[0,0,e])}}na.empty=new na([]);class Rb{constructor(e,t,r=0,s=e?e.length:0){this.mirror=t,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new Rb(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,r=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],s!=null&&s<t?r+s:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,r=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),s!=null&&s>t?r-s-1:void 0)}}invert(){let e=new Rb;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new iC(e,s,null)}}const XT=Object.create(null);class Ni{getMap(){return na.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=XT[t.stepType];if(!r)throw new RangeError(`No step type ${t.stepType} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in XT)throw new RangeError("Duplicate use of step JSON ID "+e);return XT[e]=t,t.prototype.jsonID=e,t}}class Qr{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Qr(e,null)}static fail(e){return new Qr(null,e)}static fromReplace(e,t,r,s){try{return Qr.ok(e.replace(t,r,s))}catch(i){if(i instanceof D_)return Qr.fail(i.message);throw i}}}function P8(n,e,t){let r=[];for(let s=0;s<n.childCount;s++){let i=n.child(s);i.content.size&&(i=i.copy(P8(i.content,e,i))),i.isInline&&(i=e(i,t,s)),r.push(i)}return ge.fromArray(r)}class Eh extends Ni{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new De(P8(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),t.openStart,t.openEnd);return Qr.fromReplace(e,this.from,this.to,i)}invert(){return new Ml(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new Eh(t.pos,r.pos,this.mark)}merge(e){return e instanceof Eh&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Eh(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Eh(t.from,t.to,e.markFromJSON(t.mark))}}Ni.jsonID("addMark",Eh);class Ml extends Ni{constructor(e,t,r){super(),this.from=e,this.to=t,this.mark=r}apply(e){let t=e.slice(this.from,this.to),r=new De(P8(t.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),t.openStart,t.openEnd);return Qr.fromReplace(e,this.from,this.to,r)}invert(){return new Eh(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deleted&&r.deleted||t.pos>=r.pos?null:new Ml(t.pos,r.pos,this.mark)}merge(e){return e instanceof Ml&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ml(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ml(t.from,t.to,e.markFromJSON(t.mark))}}Ni.jsonID("removeMark",Ml);class Ch extends Ni{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Qr.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Qr.fromReplace(e,this.pos,this.pos+1,new De(ge.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let r=this.mark.addToSet(t.marks);if(r.length==t.marks.length){for(let s=0;s<t.marks.length;s++)if(!t.marks[s].isInSet(r))return new Ch(this.pos,t.marks[s]);return new Ch(this.pos,this.mark)}}return new M0(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ch(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ch(t.pos,e.markFromJSON(t.mark))}}Ni.jsonID("addNodeMark",Ch);class M0 extends Ni{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Qr.fail("No node at mark step's position");let r=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Qr.fromReplace(e,this.pos,this.pos+1,new De(ge.from(r),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ch(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new M0(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new M0(t.pos,e.markFromJSON(t.mark))}}Ni.jsonID("removeNodeMark",M0);class Rs extends Ni{constructor(e,t,r,s=!1){super(),this.from=e,this.to=t,this.slice=r,this.structure=s}apply(e){return this.structure&&oC(e,this.from,this.to)?Qr.fail("Structure replace would overwrite content"):Qr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new na([this.from,this.to-this.from,this.slice.size])}invert(e){return new Rs(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return t.deletedAcross&&r.deletedAcross?null:new Rs(t.pos,Math.max(t.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Rs)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?De.empty:new De(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Rs(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?De.empty:new De(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Rs(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Rs(t.from,t.to,De.fromJSON(e,t.slice),!!t.structure)}}Ni.jsonID("replace",Rs);class Ls extends Ni{constructor(e,t,r,s,i,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(oC(e,this.from,this.gapFrom)||oC(e,this.gapTo,this.to)))return Qr.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Qr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,t.content);return r?Qr.fromReplace(e,this.from,this.to,r):Qr.fail("Content does not fit in gap")}getMap(){return new na([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Ls(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return t.deletedAcross&&r.deletedAcross||s<t.pos||i>r.pos?null:new Ls(t.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ls(t.from,t.to,t.gapFrom,t.gapTo,De.fromJSON(e,t.slice),t.insert,!!t.structure)}}Ni.jsonID("replaceAround",Ls);function oC(n,e,t){let r=n.resolve(e),s=t-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function uge(n,e,t,r){let s=[],i=[],o,a;n.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),p=Math.min(c+l.nodeSize,t),g=r.addToSet(h);for(let y=0;y<h.length;y++)h[y].isInSet(g)||(o&&o.to==f&&o.mark.eq(h[y])?o.to=p:s.push(o=new Ml(f,p,h[y])));a&&a.to==f?a.to=p:i.push(a=new Eh(f,p,r))}}),s.forEach(l=>n.step(l)),i.forEach(l=>n.step(l))}function dge(n,e,t,r){let s=[],i=0;n.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof nS){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let h=l[u],f;for(let p=0;p<s.length;p++){let g=s[p];g.step==i-1&&h.eq(s[p].style)&&(f=g)}f?(f.to=c,f.step=i):s.push({style:h,from:Math.max(a,e),to:c,step:i})}}}),s.forEach(o=>n.step(new Ml(o.from,o.to,o.style)))}function L8(n,e,t,r=t.contentMatch,s=!0){let i=n.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,h=r.matchType(c.type);if(!h)o.push(new Rs(a,u,De.empty));else{r=h;for(let f=0;f<c.marks.length;f++)t.allowsMarkType(c.marks[f].type)||n.step(new Ml(a,u,c.marks[f]));if(s&&c.isText&&t.whitespace!="pre"){let f,p=/\r?\n|\r/g,g;for(;f=p.exec(c.text);)g||(g=new De(ge.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new Rs(a+f.index,a+f.index+f[0].length,g))}}a=u}if(!r.validEnd){let l=r.fillBefore(ge.empty,!0);n.replace(a,a,new De(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function hge(n,e,t){return(e==0||n.canReplace(e,n.childCount))&&(t==n.childCount||n.canReplace(0,t))}function ny(n){let t=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let r=n.depth,s=0,i=0;;--r){let o=n.$from.node(r),a=n.$from.index(r)+s,l=n.$to.indexAfter(r)-i;if(r<n.depth&&o.canReplace(a,l,t))return r;if(r==0||o.type.spec.isolating||!hge(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function fge(n,e,t){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,c=a,u=ge.empty,h=0;for(let g=i,y=!1;g>t;g--)y||r.index(g)>0?(y=!0,u=ge.from(r.node(g).copy(u)),h++):l--;let f=ge.empty,p=0;for(let g=i,y=!1;g>t;g--)y||s.after(g+1)<s.end(g)?(y=!0,f=ge.from(s.node(g).copy(f)),p++):c++;n.step(new Ls(l,c,o,a,new De(u.append(f),h,p),u.size-h,!0))}function D8(n,e,t=null,r=n){let s=pge(n,e),i=s&&mge(r,e);return i?s.map(sj).concat({type:e,attrs:t}).concat(i.map(sj)):null}function sj(n){return{type:n,attrs:null}}function pge(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return t.canReplaceWith(r,s,o)?i:null}function mge(n,e){let{parent:t,startIndex:r,endIndex:s}=n,i=t.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<s;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function gge(n,e,t){let r=ge.empty;for(let o=t.length-1;o>=0;o--){if(r.size){let a=t[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=ge.from(t[o].type.create(t[o].attrs,r))}let s=e.start,i=e.end;n.step(new Ls(s,i,s,i,new De(r,0,0),t.length,!0))}function yge(n,e,t,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=n.steps.length;n.doc.nodesBetween(e,t,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&xge(n.doc,n.mapping.slice(i).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let p=r.whitespace=="pre",g=!!r.contentMatch.matchType(r.schema.linebreakReplacement);p&&!g?c=!1:!p&&g&&(c=!0)}c===!1&&NG(n,o,a,i),L8(n,n.mapping.slice(i).map(a,1),r,void 0,c===null);let u=n.mapping.slice(i),h=u.map(a,1),f=u.map(a+o.nodeSize,1);return n.step(new Ls(h,f,h+1,f-1,new De(ge.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&CG(n,o,a,i),!1}})}function CG(n,e,t,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=n.mapping.slice(r).map(t+1+i+o.index);n.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function NG(n,e,t,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=n.mapping.slice(r).map(t+1+i);n.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function xge(n,e,t){let r=n.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,t)}function bge(n,e,t,r,s){let i=n.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let o=t.create(r,null,s||i.marks);if(i.isLeaf)return n.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);n.step(new Ls(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new De(ge.from(o),0,0),1,!0))}function Hu(n,e,t=1,r){let s=n.resolve(e),i=s.depth-t,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=t-2;c>i;c--,u--){let h=s.node(c),f=s.index(c);if(h.type.spec.isolating)return!1;let p=h.content.cutByIndex(f,h.childCount),g=r&&r[u+1];g&&(p=p.replaceChild(0,g.type.create(g.attrs)));let y=r&&r[u]||h;if(!h.canReplace(f+1,h.childCount)||!y.type.validContent(p))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function vge(n,e,t=1,r){let s=n.doc.resolve(e),i=ge.empty,o=ge.empty;for(let a=s.depth,l=s.depth-t,c=t-1;a>l;a--,c--){i=ge.from(s.node(a).copy(i));let u=r&&r[c];o=ge.from(u?u.type.create(u.attrs,o):s.node(a).copy(o))}n.step(new Rs(e,e,new De(i.append(o),t,t),!0))}function _f(n,e){let t=n.resolve(e),r=t.index();return IG(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(r,r+1)}function wge(n,e){e.content.size||n.type.compatibleContent(e.type);let t=n.contentMatchAt(n.childCount),{linebreakReplacement:r}=n.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?n.type.schema.nodes.text:i.type;if(t=t.matchType(o),!t||!n.type.allowsMarks(i.marks))return!1}return t.validEnd}function IG(n,e){return!!(n&&e&&!n.isLeaf&&wge(n,e))}function rS(n,e,t=-1){let r=n.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):t>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&IG(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=t<0?r.before(s):r.after(s)}}function kge(n,e,t){let r=null,{linebreakReplacement:s}=n.doc.type.schema,i=n.doc.resolve(e-t),o=i.node().type;if(s&&o.inlineContent){let u=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);u&&!h?r=!1:!u&&h&&(r=!0)}let a=n.steps.length;if(r===!1){let u=n.doc.resolve(e+t);NG(n,u.node(),u.before(),a)}o.inlineContent&&L8(n,e+t-1,o,i.node().contentMatchAt(i.index()),r==null);let l=n.mapping.slice(a),c=l.map(e-t);if(n.step(new Rs(c,l.map(e+t,-1),De.empty,!0)),r===!0){let u=n.doc.resolve(c);CG(n,u.node(),u.before(),n.steps.length)}return n}function _ge(n,e,t){let r=n.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),t))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,t))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,t))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function RG(n,e,t){let r=n.resolve(e);if(!t.content.size)return e;let s=t.content;for(let i=0;i<t.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(i==1)u=c.canReplace(l,l,s);else{let h=c.contentMatchAt(l).findWrapping(s.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function sS(n,e,t=e,r=De.empty){if(e==t&&!r.size)return null;let s=n.resolve(e),i=n.resolve(t);return MG(s,i,r)?new Rs(e,t,r):new Sge(s,i,r).fit()}function MG(n,e,t){return!t.openStart&&!t.openEnd&&n.start()==e.start()&&n.parent.canReplace(n.index(),e.index(),t.content)}class Sge{constructor(e,t,r){this.$from=e,this.$to=t,this.unplaced=r,this.frontier=[],this.placed=ge.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=ge.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new De(i,o,a);return e>-1?new Ls(r.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||r.pos!=this.$to.pos?new Rs(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=t.firstChild;if(t.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}t=i.content}for(let t=1;t<=2;t++)for(let r=t==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=JT(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,h=null;if(t==1&&(o?c.matchType(o.type)||(h=c.fillBefore(ge.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:h};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=JT(e,t);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new De(e,t+1,Math.max(r,s.size+t>=e.size-r?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:r}=this.unplaced,s=JT(e,t);if(s.childCount<=1&&t>0){let i=e.size-t<=t+s.size;this.unplaced=new De(Wy(e,t-1,1),t-1,i?t-1:r)}else this.unplaced=new De(Wy(e,t,1),t,r)}placeNodes({sliceDepth:e,frontierDepth:t,parent:r,inject:s,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:f}=this.frontier[t];if(s){for(let y=0;y<s.childCount;y++)u.push(s.child(y));h=h.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let y=a.child(c),v=h.matchType(y.type);if(!v)break;c++,(c>1||l==0||y.content.size)&&(h=v,u.push(PG(y.mark(f.allowedMarks(y.marks)),c==1?l:0,c==a.childCount?p:-1)))}let g=c==a.childCount;g||(p=-1),this.placed=Ky(this.placed,t,ge.from(u)),this.frontier[t].match=h,g&&p<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,v=a;y<p;y++){let b=v.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),v=b.content}this.unplaced=g?e==0?De.empty:new De(Wy(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new De(Wy(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!QT(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:r,type:s}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=QT(e,t,s,r,i);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=QT(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Ky(this.placed,t.depth,t.fit)),e=t.move;for(let r=t.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,t=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Ky(this.placed,this.depth,ge.from(e.create(t,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(ge.empty,!0);t.childCount&&(this.placed=Ky(this.placed,this.frontier.length,t))}}function Wy(n,e,t){return e==0?n.cutByIndex(t,n.childCount):n.replaceChild(0,n.firstChild.copy(Wy(n.firstChild.content,e-1,t)))}function Ky(n,e,t){return e==0?n.append(t):n.replaceChild(n.childCount-1,n.lastChild.copy(Ky(n.lastChild.content,e-1,t)))}function JT(n,e){for(let t=0;t<e;t++)n=n.firstChild.content;return n}function PG(n,e,t){if(e<=0)return n;let r=n.content;return e>1&&(r=r.replaceChild(0,PG(r.firstChild,e-1,r.childCount==1?t-1:0))),e>0&&(r=n.type.contentMatch.fillBefore(r).append(r),t<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(ge.empty,!0)))),n.copy(r)}function QT(n,e,t,r,s){let i=n.node(e),o=s?n.indexAfter(e):n.index(e);if(o==i.childCount&&!t.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!Tge(t,i.content,o)?a:null}function Tge(n,e,t){for(let r=t;r<e.childCount;r++)if(!n.allowsMarks(e.child(r).marks))return!0;return!1}function Age(n){return n.spec.defining||n.spec.definingForContent}function Ege(n,e,t,r){if(!r.size)return n.deleteRange(e,t);let s=n.doc.resolve(e),i=n.doc.resolve(t);if(MG(s,i,r))return n.step(new Rs(e,t,r));let o=DG(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let f=s.depth,p=s.pos-1;f>0;f--,p--){let g=s.node(f).type.spec;if(g.defining||g.definingAsContext||g.isolating)break;o.indexOf(f)>-1?a=f:s.before(f)==p&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,p=0;;p++){let g=f.firstChild;if(c.push(g),p==r.openStart)break;f=g.content}for(let f=u-1;f>=0;f--){let p=c[f],g=Age(p.type);if(g&&!p.sameMarkup(s.node(Math.abs(a)-1)))u=f;else if(g||!p.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let p=(f+u+1)%(r.openStart+1),g=c[p];if(g)for(let y=0;y<o.length;y++){let v=o[(y+l)%o.length],b=!0;v<0&&(b=!1,v=-v);let w=s.node(v-1),k=s.index(v-1);if(w.canReplaceWith(k,k,g.type,g.marks))return n.replace(s.before(v),b?i.after(v):t,new De(LG(r.content,0,r.openStart,p),p,r.openEnd))}}let h=n.steps.length;for(let f=o.length-1;f>=0&&(n.replace(e,t,r),!(n.steps.length>h));f--){let p=o[f];p<0||(e=s.before(p),t=i.after(p))}}function LG(n,e,t,r,s){if(e<t){let i=n.firstChild;n=n.replaceChild(0,i.copy(LG(i.content,e+1,t,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(n).append(n);n=o.append(i.matchFragment(o).fillBefore(ge.empty,!0))}return n}function Cge(n,e,t,r){if(!r.isInline&&e==t&&n.doc.resolve(e).parent.content.size){let s=_ge(n.doc,e,r.type);s!=null&&(e=t=s)}n.replaceRange(e,t,new De(ge.from(r),0,0))}function Nge(n,e,t){let r=n.doc.resolve(e),s=n.doc.resolve(t),i=DG(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return n.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return n.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&t>r.end(o)&&s.end(o)-t!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return n.delete(r.before(o),t);n.delete(e,t)}function DG(n,e){let t=[],r=Math.min(n.depth,e.depth);for(let s=r;s>=0;s--){let i=n.start(s);if(i<n.pos-(n.depth-s)||e.end(s)>e.pos+(e.depth-s)||n.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==n.depth&&s==e.depth&&n.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&t.push(s)}return t}class sg extends Ni{constructor(e,t,r){super(),this.pos=e,this.attr=t,this.value=r}apply(e){let t=e.nodeAt(this.pos);if(!t)return Qr.fail("No node at attribute step's position");let r=Object.create(null);for(let i in t.attrs)r[i]=t.attrs[i];r[this.attr]=this.value;let s=t.type.create(r,null,t.marks);return Qr.fromReplace(e,this.pos,this.pos+1,new De(ge.from(s),0,t.isLeaf?0:1))}getMap(){return na.empty}invert(e){return new sg(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new sg(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new sg(t.pos,t.attr,t.value)}}Ni.jsonID("attr",sg);class Mb extends Ni{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let r=e.type.create(t,e.content,e.marks);return Qr.ok(r)}getMap(){return na.empty}invert(e){return new Mb(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Mb(t.attr,t.value)}}Ni.jsonID("docAttr",Mb);let L1=class extends Error{};L1=function n(e){let t=Error.call(this,e);return t.__proto__=n.prototype,t};L1.prototype=Object.create(Error.prototype);L1.prototype.constructor=L1;L1.prototype.name="TransformError";class jG{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Rb}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new L1(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,r=De.empty){let s=sS(this.doc,e,t,r);return s&&this.step(s),this}replaceWith(e,t,r){return this.replace(e,t,new De(ge.from(r),0,0))}delete(e,t){return this.replace(e,t,De.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,r){return Ege(this,e,t,r),this}replaceRangeWith(e,t,r){return Cge(this,e,t,r),this}deleteRange(e,t){return Nge(this,e,t),this}lift(e,t){return fge(this,e,t),this}join(e,t=1){return kge(this,e,t),this}wrap(e,t){return gge(this,e,t),this}setBlockType(e,t=e,r,s=null){return yge(this,e,t,r,s),this}setNodeMarkup(e,t,r=null,s){return bge(this,e,t,r,s),this}setNodeAttribute(e,t,r){return this.step(new sg(e,t,r)),this}setDocAttribute(e,t){return this.step(new Mb(e,t)),this}addNodeMark(e,t){return this.step(new Ch(e,t)),this}removeNodeMark(e,t){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(t instanceof Fn)t.isInSet(r.marks)&&this.step(new M0(e,t));else{let s=r.marks,i,o=[];for(;i=t.isInSet(s);)o.push(new M0(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,r){return vge(this,e,t,r),this}addMark(e,t,r){return uge(this,e,t,r),this}removeMark(e,t,r){return dge(this,e,t,r),this}clearIncompatible(e,t,r){return L8(this,e,t,r),this}}const ZT=Object.create(null);class Bt{constructor(e,t,r){this.$anchor=e,this.$head=t,this.ranges=r||[new Ige(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=De.empty){let r=t.content.lastChild,s=null;for(let a=0;a<t.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?De.empty:t),a==0&&aj(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),aj(e,r,t.isInline?-1:1))}}static findFrom(e,t,r=!1){let s=e.parent.inlineContent?new _t(e):ym(e.node(0),e.parent,e.pos,e.index(),t,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=t<0?ym(e.node(0),e.node(i),e.before(i+1),e.index(i),t,r):ym(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,r);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new ua(e.node(0))}static atStart(e){return ym(e,e,0,0,1)||new ua(e)}static atEnd(e){return ym(e,e,e.content.size,e.childCount,-1)||new ua(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=ZT[t.type];if(!r)throw new RangeError(`No selection type ${t.type} defined`);return r.fromJSON(e,t)}static jsonID(e,t){if(e in ZT)throw new RangeError("Duplicate use of selection JSON ID "+e);return ZT[e]=t,t.prototype.jsonID=e,t}getBookmark(){return _t.between(this.$anchor,this.$head).getBookmark()}}Bt.prototype.visible=!0;class Ige{constructor(e,t){this.$from=e,this.$to=t}}let ij=!1;function oj(n){!ij&&!n.parent.inlineContent&&(ij=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class _t extends Bt{constructor(e,t=e){oj(e),oj(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let r=e.resolve(t.map(this.head));if(!r.parent.inlineContent)return Bt.near(r);let s=e.resolve(t.map(this.anchor));return new _t(s.parent.inlineContent?s:r,r)}replace(e,t=De.empty){if(super.replace(e,t),t==De.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof _t&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new iS(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new _t(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,r=t){let s=e.resolve(t);return new this(s,r==t?s:e.resolve(r))}static between(e,t,r){let s=e.pos-t.pos;if((!r||s)&&(r=s>=0?1:-1),!t.parent.inlineContent){let i=Bt.findFrom(t,r,!0)||Bt.findFrom(t,-r,!0);if(i)t=i.$head;else return Bt.near(t,r)}return e.parent.inlineContent||(s==0?e=t:(e=(Bt.findFrom(e,-r,!0)||Bt.findFrom(e,r,!0)).$anchor,e.pos<t.pos!=s<0&&(e=t))),new _t(e,t)}}Bt.jsonID("text",_t);class iS{constructor(e,t){this.anchor=e,this.head=t}map(e){return new iS(e.map(this.anchor),e.map(this.head))}resolve(e){return _t.between(e.resolve(this.anchor),e.resolve(this.head))}}class rt extends Bt{constructor(e){let t=e.nodeAfter,r=e.node(0).resolve(e.pos+t.nodeSize);super(e,r),this.node=t}map(e,t){let{deleted:r,pos:s}=t.mapResult(this.anchor),i=e.resolve(s);return r?Bt.near(i):new rt(i)}content(){return new De(ge.from(this.node),0,0)}eq(e){return e instanceof rt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new j8(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new rt(e.resolve(t.anchor))}static create(e,t){return new rt(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}rt.prototype.visible=!1;Bt.jsonID("node",rt);class j8{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:r}=e.mapResult(this.anchor);return t?new iS(r,r):new j8(r)}resolve(e){let t=e.resolve(this.anchor),r=t.nodeAfter;return r&&rt.isSelectable(r)?new rt(t):Bt.near(t)}}class ua extends Bt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=De.empty){if(t==De.empty){e.delete(0,e.doc.content.size);let r=Bt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new ua(e)}map(e){return new ua(e)}eq(e){return e instanceof ua}getBookmark(){return Rge}}Bt.jsonID("all",ua);const Rge={map(){return this},resolve(n){return new ua(n)}};function ym(n,e,t,r,s,i=!1){if(e.inlineContent)return _t.create(n,t);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&rt.isSelectable(a))return rt.create(n,t-(s<0?a.nodeSize:0))}else{let l=ym(n,a,t+s,s<0?a.childCount:0,s,i);if(l)return l}t+=a.nodeSize*s}return null}function aj(n,e,t){let r=n.steps.length-1;if(r<e)return;let s=n.steps[r];if(!(s instanceof Rs||s instanceof Ls))return;let i=n.mapping.maps[r],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),n.setSelection(Bt.near(n.doc.resolve(o),t))}const lj=1,K2=2,cj=4;class Mge extends jG{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|lj)&~K2,this.storedMarks=null,this}get selectionSet(){return(this.updated&lj)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=K2,this}ensureMarks(e){return Fn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&K2)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~K2,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let r=this.selection;return t&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Fn.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,r){let s=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=t),!e)return this.deleteRange(t,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(t);i=r==t?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(t,r,s.text(e,i)),!this.selection.empty&&this.selection.to==t+e.length&&this.setSelection(Bt.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=cj,this}get scrolledIntoView(){return(this.updated&cj)>0}}function uj(n,e){return!e||!n?n:n.bind(e)}class Yy{constructor(e,t,r){this.name=e,this.init=uj(t.init,r),this.apply=uj(t.apply,r)}}const Pge=[new Yy("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Yy("selection",{init(n,e){return n.selection||Bt.atStart(e.doc)},apply(n){return n.selection}}),new Yy("storedMarks",{init(n){return n.storedMarks||null},apply(n,e,t,r){return r.selection.$cursor?n.storedMarks:null}}),new Yy("scrollToSelection",{init(){return 0},apply(n,e){return n.scrolledIntoView?e+1:e}})];class eA{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Pge.slice(),t&&t.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Yy(r.key,r.spec.state,r))})}}class Vm{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=t){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,c=s?s[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<o?{state:r,n:t.length}:{state:this,n:0})}t.push(u),r=r.applyInner(u),i=!0}s&&(s[o]={state:r,n:t.length})}}if(!i)return{state:r,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Vm(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Mge(this)}static create(e){let t=new eA(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Vm(t);for(let s=0;s<t.fields.length;s++)r[t.fields[s].name]=t.fields[s].init(e,r);return r}reconfigure(e){let t=new eA(this.schema,e.plugins),r=t.fields,s=new Vm(t);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(t[r]=i.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,r){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new eA(e.schema,e.plugins),i=new Vm(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=Gh.fromJSON(e.schema,t.doc);else if(o.name=="selection")i.selection=Bt.fromJSON(i.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){i[o.name]=c.fromJSON.call(l,e,t[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function OG(n,e,t){for(let r in n){let s=n[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=OG(s,e,{})),t[r]=s}return t}class _r{constructor(e){this.spec=e,this.props={},e.props&&OG(e.props,this,this.props),this.key=e.key?e.key.key:FG("plugin")}getState(e){return e[this.key]}}const tA=Object.create(null);function FG(n){return n in tA?n+"$"+ ++tA[n]:(tA[n]=0,n+"$")}class bs{constructor(e="key"){this.key=FG(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const O8=(n,e)=>n.selection.empty?!1:(e&&e(n.tr.deleteSelection().scrollIntoView()),!0);function zG(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("backward",n):t.parentOffset>0)?null:t}const BG=(n,e,t)=>{let r=zG(n,t);if(!r)return!1;let s=F8(r);if(!s){let o=r.blockRange(),a=o&&ny(o);return a==null?!1:(e&&e(n.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(YG(n,s,e,-1))return!0;if(r.parent.content.size==0&&(D1(i,"end")||rt.isSelectable(i)))for(let o=r.depth;;o--){let a=sS(n.doc,r.before(o),r.after(o),De.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=n.tr.step(a);l.setSelection(D1(i,"end")?Bt.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):rt.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},Lge=(n,e,t)=>{let r=zG(n,t);if(!r)return!1;let s=F8(r);return s?$G(n,s,e):!1},Dge=(n,e,t)=>{let r=UG(n,t);if(!r)return!1;let s=z8(r);return s?$G(n,s,e):!1};function $G(n,e,t){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=sS(n.doc,i,l,De.empty);if(!c||c.from!=i||c instanceof Rs&&c.slice.size>=l-i)return!1;if(t){let u=n.tr.step(c);u.setSelection(_t.create(u.doc,i)),t(u.scrollIntoView())}return!0}function D1(n,e,t=!1){for(let r=n;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}const VG=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("backward",n):r.parentOffset>0)return!1;i=F8(r)}let o=i&&i.nodeBefore;return!o||!rt.isSelectable(o)?!1:(e&&e(n.tr.setSelection(rt.create(n.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function F8(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){if(n.index(e)>0)return n.doc.resolve(n.before(e+1));if(n.node(e).type.spec.isolating)break}return null}function UG(n,e){let{$cursor:t}=n.selection;return!t||(e?!e.endOfTextblock("forward",n):t.parentOffset<t.parent.content.size)?null:t}const HG=(n,e,t)=>{let r=UG(n,t);if(!r)return!1;let s=z8(r);if(!s)return!1;let i=s.nodeAfter;if(YG(n,s,e,1))return!0;if(r.parent.content.size==0&&(D1(i,"start")||rt.isSelectable(i))){let o=sS(n.doc,r.before(),r.after(),De.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=n.tr.step(o);a.setSelection(D1(i,"start")?Bt.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):rt.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(n.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},qG=(n,e,t)=>{let{$head:r,empty:s}=n.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(t?!t.endOfTextblock("forward",n):r.parentOffset<r.parent.content.size)return!1;i=z8(r)}let o=i&&i.nodeAfter;return!o||!rt.isSelectable(o)?!1:(e&&e(n.tr.setSelection(rt.create(n.doc,i.pos)).scrollIntoView()),!0)};function z8(n){if(!n.parent.type.spec.isolating)for(let e=n.depth-1;e>=0;e--){let t=n.node(e);if(n.index(e)+1<t.childCount)return n.doc.resolve(n.after(e+1));if(t.type.spec.isolating)break}return null}const jge=(n,e)=>{let t=n.selection,r=t instanceof rt,s;if(r){if(t.node.isTextblock||!_f(n.doc,t.from))return!1;s=t.from}else if(s=rS(n.doc,t.from,-1),s==null)return!1;if(e){let i=n.tr.join(s);r&&i.setSelection(rt.create(i.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},Oge=(n,e)=>{let t=n.selection,r;if(t instanceof rt){if(t.node.isTextblock||!_f(n.doc,t.to))return!1;r=t.to}else if(r=rS(n.doc,t.to,1),r==null)return!1;return e&&e(n.tr.join(r).scrollIntoView()),!0},Fge=(n,e)=>{let{$from:t,$to:r}=n.selection,s=t.blockRange(r),i=s&&ny(s);return i==null?!1:(e&&e(n.tr.lift(s,i).scrollIntoView()),!0)},GG=(n,e)=>{let{$head:t,$anchor:r}=n.selection;return!t.parent.type.spec.code||!t.sameParent(r)?!1:(e&&e(n.tr.insertText(`
`).scrollIntoView()),!0)};function B8(n){for(let e=0;e<n.edgeCount;e++){let{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const zge=(n,e)=>{let{$head:t,$anchor:r}=n.selection;if(!t.parent.type.spec.code||!t.sameParent(r))return!1;let s=t.node(-1),i=t.indexAfter(-1),o=B8(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=t.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Bt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},WG=(n,e)=>{let t=n.selection,{$from:r,$to:s}=t;if(t instanceof ua||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=B8(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=n.tr.insert(o,i.createAndFill());a.setSelection(_t.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},KG=(n,e)=>{let{$cursor:t}=n.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(Hu(n.doc,i))return e&&e(n.tr.split(i).scrollIntoView()),!0}let r=t.blockRange(),s=r&&ny(r);return s==null?!1:(e&&e(n.tr.lift(r,s).scrollIntoView()),!0)};function Bge(n){return(e,t)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof rt&&e.selection.node.isBlock)return!r.parentOffset||!Hu(e.doc,r.pos)?!1:(t&&t(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,a,l=!1,c=!1;for(let p=r.depth;;p--)if(r.node(p).isBlock){l=r.end(p)==r.pos+(r.depth-p),c=r.start(p)==r.pos-(r.depth-p),a=B8(r.node(p-1).contentMatchAt(r.indexAfter(p-1))),i.unshift(l&&a?{type:a}:null),o=p;break}else{if(p==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof _t||e.selection instanceof ua)&&u.deleteSelection();let h=u.mapping.map(r.pos),f=Hu(u.doc,h,i.length,i);if(f||(i[0]=a?{type:a}:null,f=Hu(u.doc,h,i.length,i)),!f)return!1;if(u.split(h,i.length,i),!l&&c&&r.node(o).type!=a){let p=u.mapping.map(r.before(o)),g=u.doc.resolve(p);a&&r.node(o-1).canReplaceWith(g.index(),g.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return t&&t(u.scrollIntoView()),!0}}const $ge=Bge(),Vge=(n,e)=>{let{$from:t,to:r}=n.selection,s,i=t.sharedDepth(r);return i==0?!1:(s=t.before(i),e&&e(n.tr.setSelection(rt.create(n.doc,s))),!0)};function Uge(n,e,t){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(t&&t(n.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||_f(n.doc,e.pos))?!1:(t&&t(n.tr.join(e.pos).scrollIntoView()),!0)}function YG(n,e,t,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&Uge(n,e,t))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(t){let p=e.pos+i.nodeSize,g=ge.empty;for(let b=o.length-1;b>=0;b--)g=ge.from(o[b].create(null,g));g=ge.from(s.copy(g));let y=n.tr.step(new Ls(e.pos-1,p,e.pos,p,new De(g,1,0),o.length,!0)),v=y.doc.resolve(p+2*o.length);v.nodeAfter&&v.nodeAfter.type==s.type&&_f(y.doc,v.pos)&&y.join(v.pos),t(y.scrollIntoView())}return!0}let u=i.type.spec.isolating||r>0&&l?null:Bt.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),f=h&&ny(h);if(f!=null&&f>=e.depth)return t&&t(n.tr.lift(h,f).scrollIntoView()),!0;if(c&&D1(i,"start",!0)&&D1(s,"end")){let p=s,g=[];for(;g.push(p),!p.isTextblock;)p=p.lastChild;let y=i,v=1;for(;!y.isTextblock;y=y.firstChild)v++;if(p.canReplace(p.childCount,p.childCount,y.content)){if(t){let b=ge.empty;for(let k=g.length-1;k>=0;k--)b=ge.from(g[k].copy(b));let w=n.tr.step(new Ls(e.pos-g.length,e.pos+i.nodeSize,e.pos+v,e.pos+i.nodeSize-v,new De(b,g.length,0),0,!0));t(w.scrollIntoView())}return!0}}return!1}function XG(n){return function(e,t){let r=e.selection,s=n<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(t&&t(e.tr.setSelection(_t.create(e.doc,n<0?s.start(i):s.end(i)))),!0):!1}}const Hge=XG(-1),qge=XG(1);function Gge(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i),a=o&&D8(o,n,e);return a?(r&&r(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function dj(n,e=null){return function(t,r){let s=!1;for(let i=0;i<t.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[i];t.doc.nodesBetween(o,a,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(n,e)))if(l.type==n)s=!0;else{let u=t.doc.resolve(c),h=u.index();s=u.parent.canReplaceWith(h,h+1,n)}})}if(!s)return!1;if(r){let i=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];i.setBlockType(a,l,n,e)}r(i.scrollIntoView())}return!0}}function $8(...n){return function(e,t,r){for(let s=0;s<n.length;s++)if(n[s](e,t,r))return!0;return!1}}$8(O8,BG,VG);$8(O8,HG,qG);$8(GG,WG,KG,$ge);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Wge(n,e=null){return function(t,r){let{$from:s,$to:i}=t.selection,o=s.blockRange(i);if(!o)return!1;let a=r?t.tr:null;return Kge(a,o,n,e)?(r&&r(a.scrollIntoView()),!0):!1}}function Kge(n,e,t,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new O_(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new O_(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=D8(i,t,r,e);return a?(n&&Yge(n,e,a,s,t),!0):!1}function Yge(n,e,t,r,s){let i=ge.empty;for(let u=t.length-1;u>=0;u--)i=ge.from(t[u].type.create(t[u].attrs,i));n.step(new Ls(e.start-(r?2:0),e.end,e.start,e.end,new De(i,0,0),t.length,!0));let o=0;for(let u=0;u<t.length;u++)t[u].type==s&&(o=u+1);let a=t.length-o,l=e.start+t.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,f=!0;u<h;u++,f=!1)!f&&Hu(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return n}function Xge(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==n);return i?t?r.node(i.depth-1).type==n?Jge(e,t,n,i):Qge(e,t,i):!0:!1}}function Jge(n,e,t,r){let s=n.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new Ls(i-1,o,i,o,new De(ge.from(t.create(null,r.parent.copy())),1,0),1,!0)),r=new O_(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=ny(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return _f(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function Qge(n,e,t){let r=n.tr,s=t.parent;for(let p=t.end,g=t.endIndex-1,y=t.startIndex;g>y;g--)p-=s.child(g).nodeSize,r.delete(p-1,p+1);let i=r.doc.resolve(t.start),o=i.nodeAfter;if(r.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,l=t.endIndex==s.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?ge.empty:ge.from(s))))return!1;let h=i.pos,f=h+o.nodeSize;return r.step(new Ls(h-(a?1:0),f+(l?1:0),h+1,f-1,new De((a?ge.empty:ge.from(s.copy(ge.empty))).append(l?ge.empty:ge.from(s.copy(ge.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function Zge(n){return function(e,t){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==n);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=n)return!1;if(t){let c=l.lastChild&&l.lastChild.type==a.type,u=ge.from(c?n.create():null),h=new De(ge.from(n.create(null,ge.from(a.type.create(null,u)))),c?3:1,0),f=i.start,p=i.end;t(e.tr.step(new Ls(f-(c?3:1),p,f,p,h,1,!0)).scrollIntoView())}return!0}}const Ys=function(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e},j1=function(n){let e=n.assignedSlot||n.parentNode;return e&&e.nodeType==11?e.host:e};let aC=null;const ou=function(n,e,t){let r=aC||(aC=document.createRange());return r.setEnd(n,t??n.nodeValue.length),r.setStart(n,e||0),r},e1e=function(){aC=null},P0=function(n,e,t,r){return t&&(hj(n,e,t,r,-1)||hj(n,e,t,r,1))},t1e=/^(img|br|input|textarea|hr)$/i;function hj(n,e,t,r,s){for(var i;;){if(n==t&&e==r)return!0;if(e==(s<0?0:Va(n))){let o=n.parentNode;if(!o||o.nodeType!=1||Qw(n)||t1e.test(n.nodeName)||n.contentEditable=="false")return!1;e=Ys(n)+(s<0?0:1),n=o}else if(n.nodeType==1){let o=n.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else n=o,e=s<0?Va(n):0}else return!1}}function Va(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function n1e(n,e){for(;;){if(n.nodeType==3&&e)return n;if(n.nodeType==1&&e>0){if(n.contentEditable=="false")return null;n=n.childNodes[e-1],e=Va(n)}else if(n.parentNode&&!Qw(n))e=Ys(n),n=n.parentNode;else return null}}function r1e(n,e){for(;;){if(n.nodeType==3&&e<n.nodeValue.length)return n;if(n.nodeType==1&&e<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[e],e=0}else if(n.parentNode&&!Qw(n))e=Ys(n)+1,n=n.parentNode;else return null}}function s1e(n,e,t){for(let r=e==0,s=e==Va(n);r||s;){if(n==t)return!0;let i=Ys(n);if(n=n.parentNode,!n)return!1;r=r&&i==0,s=s&&i==Va(n)}}function Qw(n){let e;for(let t=n;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==n||e.contentDOM==n)}const oS=function(n){return n.focusNode&&P0(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function Hf(n,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=n,t.key=t.code=e,t}function i1e(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function o1e(n,e,t){if(n.caretPositionFromPoint)try{let r=n.caretPositionFromPoint(e,t);if(r)return{node:r.offsetNode,offset:Math.min(Va(r.offsetNode),r.offset)}}catch{}if(n.caretRangeFromPoint){let r=n.caretRangeFromPoint(e,t);if(r)return{node:r.startContainer,offset:Math.min(Va(r.startContainer),r.startOffset)}}}const Bc=typeof navigator<"u"?navigator:null,fj=typeof document<"u"?document:null,Sf=Bc&&Bc.userAgent||"",lC=/Edge\/(\d+)/.exec(Sf),JG=/MSIE \d/.exec(Sf),cC=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Sf),Po=!!(JG||cC||lC),Wh=JG?document.documentMode:cC?+cC[1]:lC?+lC[1]:0,Ya=!Po&&/gecko\/(\d+)/i.test(Sf);Ya&&+(/Firefox\/(\d+)/.exec(Sf)||[0,0])[1];const uC=!Po&&/Chrome\/(\d+)/.exec(Sf),Ms=!!uC,QG=uC?+uC[1]:0,Ei=!Po&&!!Bc&&/Apple Computer/.test(Bc.vendor),O1=Ei&&(/Mobile\/\w+/.test(Sf)||!!Bc&&Bc.maxTouchPoints>2),Oa=O1||(Bc?/Mac/.test(Bc.platform):!1),ZG=Bc?/Win/.test(Bc.platform):!1,$u=/Android \d/.test(Sf),Zw=!!fj&&"webkitFontSmoothing"in fj.documentElement.style,a1e=Zw?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function l1e(n){let e=n.defaultView&&n.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Jc(n,e){return typeof n=="number"?n:n[e]}function c1e(n){let e=n.getBoundingClientRect(),t=e.width/n.offsetWidth||1,r=e.height/n.offsetHeight||1;return{left:e.left,right:e.left+n.clientWidth*t,top:e.top,bottom:e.top+n.clientHeight*r}}function pj(n,e,t){let r=n.someProp("scrollThreshold")||0,s=n.someProp("scrollMargin")||5,i=n.dom.ownerDocument;for(let o=t||n.dom;o;){if(o.nodeType!=1){o=j1(o);continue}let a=o,l=a==i.body,c=l?l1e(i):c1e(a),u=0,h=0;if(e.top<c.top+Jc(r,"top")?h=-(c.top-e.top+Jc(s,"top")):e.bottom>c.bottom-Jc(r,"bottom")&&(h=e.bottom-e.top>c.bottom-c.top?e.top+Jc(s,"top")-c.top:e.bottom-c.bottom+Jc(s,"bottom")),e.left<c.left+Jc(r,"left")?u=-(c.left-e.left+Jc(s,"left")):e.right>c.right-Jc(r,"right")&&(u=e.right-c.right+Jc(s,"right")),u||h)if(l)i.defaultView.scrollBy(u,h);else{let p=a.scrollLeft,g=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let y=a.scrollLeft-p,v=a.scrollTop-g;e={left:e.left-y,top:e.top-v,right:e.right-y,bottom:e.bottom-v}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:j1(o)}}function u1e(n){let e=n.dom.getBoundingClientRect(),t=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=n.root.elementFromPoint(i,o);if(!a||a==n.dom||!n.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:eW(n.dom)}}function eW(n){let e=[],t=n.ownerDocument;for(let r=n;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),n!=t);r=j1(r));return e}function d1e({refDOM:n,refTop:e,stack:t}){let r=n?n.getBoundingClientRect().top:0;tW(t,r==0?0:r-e)}function tW(n,e){for(let t=0;t<n.length;t++){let{dom:r,top:s,left:i}=n[t];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let cm=null;function h1e(n){if(n.setActive)return n.setActive();if(cm)return n.focus(cm);let e=eW(n);n.focus(cm==null?{get preventScroll(){return cm={preventScroll:!0},!0}}:void 0),cm||(cm=!1,tW(e,0))}function nW(n,e){let t,r=2e8,s,i=0,o=e.top,a=e.top,l,c;for(let u=n.firstChild,h=0;u;u=u.nextSibling,h++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=ou(u).getClientRects();else continue;for(let p=0;p<f.length;p++){let g=f[p];if(g.top<=o&&g.bottom>=a){o=Math.max(g.bottom,o),a=Math.min(g.top,a);let y=g.left>e.left?g.left-e.left:g.right<e.left?e.left-g.right:0;if(y<r){t=u,r=y,s=y&&t.nodeType==3?{left:g.right<e.left?g.right:g.left,top:e.top}:e,u.nodeType==1&&y&&(i=h+(e.left>=(g.left+g.right)/2?1:0));continue}}else g.top>e.top&&!l&&g.left<=e.left&&g.right>=e.left&&(l=u,c={left:Math.max(g.left,Math.min(g.right,e.left)),top:g.top});!t&&(e.left>=g.right&&e.top>=g.top||e.left>=g.left&&e.top>=g.bottom)&&(i=h+1)}}return!t&&l&&(t=l,s=c,r=0),t&&t.nodeType==3?f1e(t,s):!t||r&&t.nodeType==1?{node:n,offset:i}:nW(t,s)}function f1e(n,e){let t=n.nodeValue.length,r=document.createRange(),s;for(let i=0;i<t;i++){r.setEnd(n,i+1),r.setStart(n,i);let o=Rd(r,1);if(o.top!=o.bottom&&V8(e,o)){s={node:n,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:n,offset:0}}function V8(n,e){return n.left>=e.left-1&&n.left<=e.right+1&&n.top>=e.top-1&&n.top<=e.bottom+1}function p1e(n,e){let t=n.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<n.getBoundingClientRect().left?t:n}function m1e(n,e,t){let{node:r,offset:s}=nW(e,t),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return n.docView.posFromDOM(r,s,i)}function g1e(n,e,t,r){let s=-1;for(let i=e,o=!1;i!=n.dom;){let a=n.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:n.docView.posFromDOM(e,t,-1)}function rW(n,e,t){let r=n.childNodes.length;if(r&&t.top<t.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-t.top)/(t.bottom-t.top))-2)),i=s;;){let o=n.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(V8(e,c))return rW(o,e,c)}}if((i=(i+1)%r)==s)break}return n}function y1e(n,e){let t=n.dom.ownerDocument,r,s=0,i=o1e(t,e.left,e.top);i&&({node:r,offset:s}=i);let o=(n.root.elementFromPoint?n.root:t).elementFromPoint(e.left,e.top),a;if(!o||!n.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=n.dom.getBoundingClientRect();if(!V8(e,c)||(o=rW(n.dom,e,c),!o))return null}if(Ei)for(let c=o;r&&c;c=j1(c))c.draggable&&(r=void 0);if(o=p1e(o,e),r){if(Ya&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let u=r.childNodes[s],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let c;Zw&&s&&r.nodeType==1&&(c=r.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,r==n.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=n.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=g1e(n,r,s,e))}a==null&&(a=m1e(n,o,e));let l=n.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function mj(n){return n.top<n.bottom||n.left<n.right}function Rd(n,e){let t=n.getClientRects();if(t.length){let r=t[e<0?0:t.length-1];if(mj(r))return r}return Array.prototype.find.call(t,mj)||n.getBoundingClientRect()}const x1e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function sW(n,e,t){let{node:r,offset:s,atom:i}=n.docView.domFromPos(e,t<0?-1:1),o=Zw||Ya;if(r.nodeType==3)if(o&&(x1e.test(r.nodeValue)||(t<0?!s:s==r.nodeValue.length))){let l=Rd(ou(r,s,s),t);if(Ya&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let c=Rd(ou(r,s-1,s-1),-1);if(c.top==l.top){let u=Rd(ou(r,s,s+1),-1);if(u.top!=l.top)return by(u,u.left<c.left)}}return l}else{let l=s,c=s,u=t<0?1:-1;return t<0&&!s?(c++,u=-1):t>=0&&s==r.nodeValue.length?(l--,u=1):t<0?l--:c++,by(Rd(ou(r,l,c),u),u<0)}if(!n.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(t<0||s==Va(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return nA(l.getBoundingClientRect(),!1)}if(i==null&&s<Va(r)){let l=r.childNodes[s];if(l.nodeType==1)return nA(l.getBoundingClientRect(),!0)}return nA(r.getBoundingClientRect(),t>=0)}if(i==null&&s&&(t<0||s==Va(r))){let l=r.childNodes[s-1],c=l.nodeType==3?ou(l,Va(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return by(Rd(c,1),!1)}if(i==null&&s<Va(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?ou(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return by(Rd(c,-1),!0)}return by(Rd(r.nodeType==3?ou(r):r,-t),t>=0)}function by(n,e){if(n.width==0)return n;let t=e?n.left:n.right;return{top:n.top,bottom:n.bottom,left:t,right:t}}function nA(n,e){if(n.height==0)return n;let t=e?n.top:n.bottom;return{top:t,bottom:t,left:n.left,right:n.right}}function iW(n,e,t){let r=n.state,s=n.root.activeElement;r!=e&&n.updateState(e),s!=n.dom&&n.focus();try{return t()}finally{r!=e&&n.updateState(r),s!=n.dom&&s&&s.focus()}}function b1e(n,e,t){let r=e.selection,s=t=="up"?r.$from:r.$to;return iW(n,e,()=>{let{node:i}=n.docView.domFromPos(s.pos,t=="up"?-1:1);for(;;){let a=n.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=sW(n,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=ou(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const v1e=/[\u0590-\u08ac]/;function w1e(n,e,t){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=n.domSelection();return a?!v1e.test(r.parent.textContent)||!a.modify?t=="left"||t=="backward"?i:o:iW(n,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=n.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",t,"character");let p=r.depth?n.docView.domAfterPos(r.before()):n.dom,{focusNode:g,focusOffset:y}=n.domSelectionRange(),v=g&&!p.contains(g.nodeType==1?g:g.parentNode)||l==g&&c==y;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),v}):r.pos==r.start()||r.pos==r.end()}let gj=null,yj=null,xj=!1;function k1e(n,e,t){return gj==e&&yj==t?xj:(gj=e,yj=t,xj=t=="up"||t=="down"?b1e(n,e,t):w1e(n,e,t))}const Xa=0,bj=1,ep=2,$c=3;class e2{constructor(e,t,r,s){this.parent=e,this.children=t,this.dom=r,this.contentDOM=s,this.dirty=Xa,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,r=this.posAtStart;;t++){let s=this.children[t];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=t>Ys(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!t||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let r=t;r;r=r.parent)if(r==this)return t}posFromDOM(e,t,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,t,r)}return-1}descAt(e){for(let t=0,r=0;t<this.children.length;t++){let s=this.children[t],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof aW){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,t);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof oW&&i.side>=0;r--);if(t<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&t&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?Ys(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?Ys(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(s==-1&&e<=c){let u=o+l.border;if(e>=u&&t<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let h=a;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=Ys(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(c>t||a==this.children.length-1)){t=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=Ys(h.dom);break}t+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:r}=this.domFromPos(e,0);if(t.nodeType!=1||r==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[r]}setSelection(e,t,r,s=!1){let i=Math.min(e,t),o=Math.max(e,t);for(let p=0,g=0;p<this.children.length;p++){let y=this.children[p],v=g+y.size;if(i>g&&o<v)return y.setSelection(e-g-y.border,t-g-y.border,r,s);g=v}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),h=!1;if((Ya||Ei)&&e==t){let{node:p,offset:g}=a;if(p.nodeType==3){if(h=!!(g&&p.nodeValue[g-1]==`
`),h&&g==p.nodeValue.length)for(let y=p,v;y;y=y.parentNode){if(v=y.nextSibling){v.nodeName=="BR"&&(a=l={node:v.parentNode,offset:Ys(v)+1});break}let b=y.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{let y=p.childNodes[g-1];h=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(Ya&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let p=u.focusNode.childNodes[u.focusOffset];p&&p.contentEditable=="false"&&(s=!0)}if(!(s||h&&Ei)&&P0(a.node,a.offset,u.anchorNode,u.anchorOffset)&&P0(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==t)&&!(h&&Ya)){c.collapse(a.node,a.offset);try{e!=t&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>t){let g=a;a=l,l=g}let p=document.createRange();p.setEnd(l.node,l.offset),p.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(p)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&t>=r:e<o&&t>r){let a=r+i.border,l=o-i.border;if(e>=a&&t<=l){this.dirty=e==r||t==o?ep:bj,e==a&&t==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=$c:i.markDirty(e-a,t-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?ep:$c}r=o}this.dirty=ep}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let r=e==1?ep:bj;t.dirty<r&&(t.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class oW extends e2{constructor(e,t,r,s){let i,o=t.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Xa&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class _1e extends e2{constructor(e,t,r,s){super(e,[],t,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class L0 extends e2{constructor(e,t,r,s,i){super(e,[],r,s),this.mark=t,this.spec=i}static create(e,t,r,s){let i=s.nodeViews[t.type.name],o=i&&i(t,s,r);return(!o||!o.dom)&&(o=J0.renderSpec(document,t.type.spec.toDOM(t,r),null,t.attrs)),new L0(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&$c||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=$c&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Xa){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Xa}}slice(e,t,r){let s=L0.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;t<o&&(i=hC(i,t,o,r)),e>0&&(i=hC(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Kh extends e2{constructor(e,t,r,s,i,o,a,l,c){super(e,[],i,o),this.node=t,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,t,r,s,i,o){let a=i.nodeViews[t.type.name],l,c=a&&a(t,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),u=c&&c.dom,h=c&&c.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=J0.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!h&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let f=u;return u=uW(u,r,t),c?l=new S1e(e,t,r,s,u,h||null,f,c,i,o+1):t.isText?new aS(e,t,r,s,u,f,i):new Kh(e,t,r,s,u,h||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let r=this.children[t];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>ge.empty)}return e}matchesNode(e,t,r){return this.dirty==Xa&&e.eq(this.node)&&F_(t,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let r=this.node.inlineContent,s=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new A1e(this,o&&o.node,e);N1e(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?Fn.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,s)},(c,u,h,f)=>{l.syncToMarks(c.marks,r,e);let p;l.findNodeMatch(c,u,h,f)||a&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(p=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,h,p,e)||l.updateNextNode(c,u,h,e,f,s)||l.addNode(c,u,h,e,s),s+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ep)&&(o&&this.protectLocalComposition(e,o),lW(this.contentDOM,this.children,e),O1&&I1e(this.dom))}localCompositionInfo(e,t){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof _t)||r<t||s>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=R1e(this.node.content,o,r-t,s-t);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:r,text:s}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new _1e(this,i,t,s);e.input.compositionNodes.push(o),this.children=hC(this.children,r,r+s.length,e,o)}update(e,t,r,s){return this.dirty==$c||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,r,s),!0)}updateInner(e,t,r,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Xa}updateOuterDeco(e){if(F_(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=cW(this.dom,this.nodeDOM,dC(this.outerDeco,this.node,t),dC(e,this.node,t)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function vj(n,e,t,r,s){uW(r,e,n);let i=new Kh(void 0,n,e,t,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class aS extends Kh{constructor(e,t,r,s,i,o,a){super(e,t,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,r,s){return this.dirty==$c||this.dirty!=Xa&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Xa||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Xa,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,r){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,r){let s=this.node.cut(e,t),i=document.createTextNode(s.text);return new aS(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=$c)}get domAtom(){return!1}isText(e){return this.node.text==e}}class aW extends e2{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Xa&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class S1e extends Kh{constructor(e,t,r,s,i,o,a,l,c,u){super(e,t,r,s,i,o,a,c,u),this.spec=l}update(e,t,r,s){if(this.dirty==$c)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,r);return i&&this.updateInner(e,t,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,r,s){this.spec.setSelection?this.spec.setSelection(e,t,r.root):super.setSelection(e,t,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function lW(n,e,t){let r=n.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==n){for(;a!=r;)r=wj(r),s=!0;r=r.nextSibling}else s=!0,n.insertBefore(a,r);if(o instanceof L0){let l=r?r.previousSibling:n.lastChild;lW(o.contentDOM,o.children,t),r=l?l.nextSibling:n.firstChild}}for(;r;)r=wj(r),s=!0;s&&t.trackWrites==n&&(t.trackWrites=null)}const jx=function(n){n&&(this.nodeName=n)};jx.prototype=Object.create(null);const tp=[new jx];function dC(n,e,t){if(n.length==0)return tp;let r=t?tp[0]:new jx,s=[r];for(let i=0;i<n.length;i++){let o=n[i].type.attrs;if(o){o.nodeName&&s.push(r=new jx(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&s.length==1&&s.push(r=new jx(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function cW(n,e,t,r){if(t==tp&&r==tp)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=t[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=n&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=tp[0]),s=l}T1e(s,a||tp[0],o)}return s}function T1e(n,e,t){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in t)&&n.removeAttribute(r);for(let r in t)r!="class"&&r!="style"&&r!="nodeName"&&t[r]!=e[r]&&n.setAttribute(r,t[r]);if(e.class!=t.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&n.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&n.classList.add(s[i]);n.classList.length==0&&n.removeAttribute("class")}if(e.style!=t.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)n.style.removeProperty(s[1])}t.style&&(n.style.cssText+=t.style)}}function uW(n,e,t){return cW(n,n,tp,dC(e,t,n.nodeType!=1))}function F_(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].type.eq(e[t].type))return!1;return!0}function wj(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class A1e{constructor(e,t,r){this.lock=t,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=E1e(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let r=e;r<t;r++)this.top.children[r].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Xa,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=L0.create(this.top,e[i],t,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,t,r)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,r,s,i){let o=this.top.children[s];return o.dirty==$c&&o.dom==o.contentDOM&&(o.dirty=ep),o.update(e,t,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=t}}updateNextNode(e,t,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Kh){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,h,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=$c&&F_(t,l.outerDeco));if(!f&&l.update(e,t,r,s))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(l,e,t,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=ep,h.updateChildren(s,o+1),h.dirty=Xa),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,r,s,i,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!F_(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Kh.create(this.top,t,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,r,s,i){let o=Kh.create(this.top,e,t,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new oW(this.top,e,t,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof L0;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof aS)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Ei||Ms)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new aW(this.top,[],r,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function E1e(n,e){let t=e,r=t.children.length,s=n.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let c=t.children[r-1];if(c instanceof L0)t=c,r=c.children.length;else{a=c,r--;break}}else{if(t==e)break e;r=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=n.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function C1e(n,e){return n.type.side-e.type.side}function N1e(n,e,t,r){let s=e.locals(n),i=0;if(s.length==0){for(let c=0;c<n.childCount;c++){let u=n.child(c);r(u,s,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,h;for(;o<s.length&&s[o].to==i;){let v=s[o++];v.widget&&(u?(h||(h=[u])).push(v):u=v)}if(u)if(h){h.sort(C1e);for(let v=0;v<h.length;v++)t(h[v],c,!!l)}else t(u,c,!!l);let f,p;if(l)p=-1,f=l,l=null;else if(c<n.childCount)p=c,f=n.child(c++);else break;for(let v=0;v<a.length;v++)a[v].to<=i&&a.splice(v--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let g=i+f.nodeSize;if(f.isText){let v=g;o<s.length&&s[o].from<v&&(v=s[o].from);for(let b=0;b<a.length;b++)a[b].to<v&&(v=a[b].to);v<g&&(l=f.cut(v-i),f=f.cut(0,v-i),g=v,p=-1)}else for(;o<s.length&&s[o].to<g;)o++;let y=f.isInline&&!f.isLeaf?a.filter(v=>!v.inline):a.slice();r(f,y,e.forChild(i,f),p),i=g}}function I1e(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let e=n.style.cssText;n.style.cssText=e+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=e}}function R1e(n,e,t,r){for(let s=0,i=0;s<n.childCount&&i<=r;){let o=n.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<n.childCount;){let c=n.child(s++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=t){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=t)return a+c;if(t==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function hC(n,e,t,r,s){let i=[];for(let o=0,a=0;o<n.length;o++){let l=n[o],c=a,u=a+=l.size;c>=t||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,r)),s&&(i.push(s),s=void 0),u>t&&i.push(l.slice(t-c,l.size,r)))}return i}function U8(n,e=null){let t=n.domSelectionRange(),r=n.state.doc;if(!t.focusNode)return null;let s=n.docView.nearestDesc(t.focusNode),i=s&&s.size==0,o=n.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(oS(t)){for(l=o;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&rt.isSelectable(h)&&s.parent&&!(h.isInline&&s1e(t.focusNode,t.focusOffset,s.dom))){let f=s.posBefore;c=new rt(o==f?a:r.resolve(f))}}else{if(t instanceof n.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let h=o,f=o;for(let p=0;p<t.rangeCount;p++){let g=t.getRangeAt(p);h=Math.min(h,n.docView.posFromDOM(g.startContainer,g.startOffset,1)),f=Math.max(f,n.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(h<0)return null;[l,o]=f==n.state.selection.anchor?[f,h]:[h,f],a=r.resolve(o)}else l=n.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let h=e=="pointer"||n.state.selection.head<a.pos&&!i?1:-1;c=H8(n,u,a,h)}return c}function dW(n){return n.editable?n.hasFocus():fW(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function qu(n,e=!1){let t=n.state.selection;if(hW(n,t),!!dW(n)){if(!e&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Ms){let r=n.domSelectionRange(),s=n.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&P0(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)P1e(n);else{let{anchor:r,head:s}=t,i,o;kj&&!(t instanceof _t)&&(t.$from.parent.inlineContent||(i=_j(n,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=_j(n,t.to))),n.docView.setSelection(r,s,n,e),kj&&(i&&Sj(i),o&&Sj(o)),t.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&M1e(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const kj=Ei||Ms&&QG<63;function _j(n,e){let{node:t,offset:r}=n.docView.domFromPos(e,0),s=r<t.childNodes.length?t.childNodes[r]:null,i=r?t.childNodes[r-1]:null;if(Ei&&s&&s.contentEditable=="false")return rA(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return rA(s);if(i)return rA(i)}}function rA(n){return n.contentEditable="true",Ei&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Sj(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function M1e(n){let e=n.dom.ownerDocument;e.removeEventListener("selectionchange",n.input.hideSelectionGuard);let t=n.domSelectionRange(),r=t.anchorNode,s=t.anchorOffset;e.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=s)&&(e.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!dW(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function P1e(n){let e=n.domSelection();if(!e)return;let t=n.cursorWrapper.dom,r=t.nodeName=="IMG";r?e.collapse(t.parentNode,Ys(t)+1):e.collapse(t,0),!r&&!n.state.selection.visible&&Po&&Wh<=11&&(t.disabled=!0,t.disabled=!1)}function hW(n,e){if(e instanceof rt){let t=n.docView.descAt(e.from);t!=n.lastSelectedViewDesc&&(Tj(n),t&&t.selectNode(),n.lastSelectedViewDesc=t)}else Tj(n)}function Tj(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function H8(n,e,t,r){return n.someProp("createSelectionBetween",s=>s(n,e,t))||_t.between(e,t,r)}function Aj(n){return n.editable&&!n.hasFocus()?!1:fW(n)}function fW(n){let e=n.domSelectionRange();if(!e.anchorNode)return!1;try{return n.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(n.editable||n.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function L1e(n){let e=n.docView.domFromPos(n.state.selection.anchor,0),t=n.domSelectionRange();return P0(e.node,e.offset,t.anchorNode,t.anchorOffset)}function fC(n,e){let{$anchor:t,$head:r}=n.selection,s=e>0?t.max(r):t.min(r),i=s.parent.inlineContent?s.depth?n.doc.resolve(e>0?s.after():s.before()):null:s;return i&&Bt.findFrom(i,e)}function Dd(n,e){return n.dispatch(n.state.tr.setSelection(e).scrollIntoView()),!0}function Ej(n,e,t){let r=n.state.selection;if(r instanceof _t)if(t.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=n.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return Dd(n,new _t(r.$anchor,o))}else if(r.empty){if(n.endOfTextblock(e>0?"forward":"backward")){let s=fC(n.state,e);return s&&s instanceof rt?Dd(n,s):!1}else if(!(Oa&&t.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=n.docView.descAt(a))&&!o.contentDOM?rt.isSelectable(i)?Dd(n,new rt(e<0?n.state.doc.resolve(s.pos-i.nodeSize):s)):Zw?Dd(n,new _t(n.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof rt&&r.node.isInline)return Dd(n,new _t(e>0?r.$to:r.$from));{let s=fC(n.state,e);return s?Dd(n,s):!1}}}function z_(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Ox(n,e){let t=n.pmViewDesc;return t&&t.size==0&&(e<0||n.nextSibling||n.nodeName!="BR")}function um(n,e){return e<0?D1e(n):j1e(n)}function D1e(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s,i,o=!1;for(Ya&&t.nodeType==1&&r<z_(t)&&Ox(t.childNodes[r],-1)&&(o=!0);;)if(r>0){if(t.nodeType!=1)break;{let a=t.childNodes[r-1];if(Ox(a,-1))s=t,i=--r;else if(a.nodeType==3)t=a,r=t.nodeValue.length;else break}}else{if(pW(t))break;{let a=t.previousSibling;for(;a&&Ox(a,-1);)s=t.parentNode,i=Ys(a),a=a.previousSibling;if(a)t=a,r=z_(t);else{if(t=t.parentNode,t==n.dom)break;r=0}}}o?pC(n,t,r):s&&pC(n,s,i)}function j1e(n){let e=n.domSelectionRange(),t=e.focusNode,r=e.focusOffset;if(!t)return;let s=z_(t),i,o;for(;;)if(r<s){if(t.nodeType!=1)break;let a=t.childNodes[r];if(Ox(a,1))i=t,o=++r;else break}else{if(pW(t))break;{let a=t.nextSibling;for(;a&&Ox(a,1);)i=a.parentNode,o=Ys(a)+1,a=a.nextSibling;if(a)t=a,r=0,s=z_(t);else{if(t=t.parentNode,t==n.dom)break;r=s=0}}}i&&pC(n,i,o)}function pW(n){let e=n.pmViewDesc;return e&&e.node&&e.node.isBlock}function O1e(n,e){for(;n&&e==n.childNodes.length&&!Qw(n);)e=Ys(n)+1,n=n.parentNode;for(;n&&e<n.childNodes.length;){let t=n.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=0}}function F1e(n,e){for(;n&&!e&&!Qw(n);)e=Ys(n),n=n.parentNode;for(;n&&e;){let t=n.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;n=t,e=n.childNodes.length}}function pC(n,e,t){if(e.nodeType!=3){let i,o;(o=O1e(e,t))?(e=o,t=0):(i=F1e(e,t))&&(e=i,t=i.nodeValue.length)}let r=n.domSelection();if(!r)return;if(oS(r)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,t);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&qu(n)},50)}function Cj(n,e){let t=n.state.doc.resolve(e);if(!(Ms||ZG)&&t.parent.inlineContent){let s=n.coordsAtPos(e);if(e>t.start()){let i=n.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<t.end()){let i=n.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Nj(n,e,t){let r=n.state.selection;if(r instanceof _t&&!r.empty||t.indexOf("s")>-1||Oa&&t.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||n.endOfTextblock(e<0?"up":"down")){let o=fC(n.state,e);if(o&&o instanceof rt)return Dd(n,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof ua?Bt.near(o,e):Bt.findFrom(o,e);return a?Dd(n,a):!1}return!1}function Ij(n,e){if(!(n.state.selection instanceof _t))return!0;let{$head:t,$anchor:r,empty:s}=n.state.selection;if(!t.sameParent(r))return!0;if(!s)return!1;if(n.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let o=n.state.tr;return e<0?o.delete(t.pos-i.nodeSize,t.pos):o.delete(t.pos,t.pos+i.nodeSize),n.dispatch(o),!0}return!1}function Rj(n,e,t){n.domObserver.stop(),e.contentEditable=t,n.domObserver.start()}function z1e(n){if(!Ei||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Rj(n,r,"true"),setTimeout(()=>Rj(n,r,"false"),20)}return!1}function B1e(n){let e="";return n.ctrlKey&&(e+="c"),n.metaKey&&(e+="m"),n.altKey&&(e+="a"),n.shiftKey&&(e+="s"),e}function $1e(n,e){let t=e.keyCode,r=B1e(e);if(t==8||Oa&&t==72&&r=="c")return Ij(n,-1)||um(n,-1);if(t==46&&!e.shiftKey||Oa&&t==68&&r=="c")return Ij(n,1)||um(n,1);if(t==13||t==27)return!0;if(t==37||Oa&&t==66&&r=="c"){let s=t==37?Cj(n,n.state.selection.from)=="ltr"?-1:1:-1;return Ej(n,s,r)||um(n,s)}else if(t==39||Oa&&t==70&&r=="c"){let s=t==39?Cj(n,n.state.selection.from)=="ltr"?1:-1:1;return Ej(n,s,r)||um(n,s)}else{if(t==38||Oa&&t==80&&r=="c")return Nj(n,-1,r)||um(n,-1);if(t==40||Oa&&t==78&&r=="c")return z1e(n)||Nj(n,1,r)||um(n,1);if(r==(Oa?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function q8(n,e){n.someProp("transformCopied",p=>{e=p(e,n)});let t=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let p=r.firstChild;t.push(p.type.name,p.attrs!=p.type.defaultAttrs?p.attrs:null),r=p.content}let o=n.someProp("clipboardSerializer")||J0.fromSchema(n.state.schema),a=vW(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=bW[c.nodeName.toLowerCase()]);){for(let p=u.length-1;p>=0;p--){let g=a.createElement(u[p]);for(;l.firstChild;)g.appendChild(l.firstChild);l.appendChild(g),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(t)}`);let f=n.someProp("clipboardTextSerializer",p=>p(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function mW(n,e,t,r,s){let i=s.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=!!e&&(r||i||!t);if(l){if(n.someProp("transformPastedText",f=>{e=f(e,i||r,n)}),i)return a=new De(ge.from(n.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),n.someProp("transformPasted",f=>{a=f(a,n,!0)}),a;let h=n.someProp("clipboardTextParser",f=>f(e,s,r,n));if(h)a=h;else{let f=s.marks(),{schema:p}=n.state,g=J0.fromSchema(p);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let v=o.appendChild(document.createElement("p"));y&&v.appendChild(g.serializeNode(p.text(y,f)))})}}else n.someProp("transformPastedHTML",h=>{t=h(t,n)}),o=q1e(t),Zw&&G1e(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(n.someProp("clipboardParser")||n.someProp("domParser")||Lx.fromSchema(n.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!V1e.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=W1e(Mj(a,+u[1],+u[2]),u[4]);else if(a=De.maxOpen(U1e(a.content,s),!0),a.openStart||a.openEnd){let h=0,f=0;for(let p=a.content.firstChild;h<a.openStart&&!p.type.spec.isolating;h++,p=p.firstChild);for(let p=a.content.lastChild;f<a.openEnd&&!p.type.spec.isolating;f++,p=p.lastChild);a=Mj(a,h,f)}return n.someProp("transformPasted",h=>{a=h(a,n,l)}),a}const V1e=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function U1e(n,e){if(n.childCount<2)return n;for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.index(t)),i,o=[];if(n.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&yW(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=xW(o[o.length-1],i.length));let u=gW(a,l);o.push(u),s=s.matchType(u.type),i=l}}),o)return ge.from(o)}return n}function gW(n,e,t=0){for(let r=e.length-1;r>=t;r--)n=e[r].create(null,ge.from(n));return n}function yW(n,e,t,r,s){if(s<n.length&&s<e.length&&n[s]==e[s]){let i=yW(n,e,t,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==n.length-1?t.type:n[s+1]))return r.copy(r.content.append(ge.from(gW(t,n,s+1))))}}function xW(n,e){if(e==0)return n;let t=n.content.replaceChild(n.childCount-1,xW(n.lastChild,e-1)),r=n.contentMatchAt(n.childCount).fillBefore(ge.empty,!0);return n.copy(t.append(r))}function mC(n,e,t,r,s,i){let o=e<0?n.firstChild:n.lastChild,a=o.content;return n.childCount>1&&(i=0),s<r-1&&(a=mC(a,e,t,r,s+1,i)),s>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(ge.empty,!0))),n.replaceChild(e<0?0:n.childCount-1,o.copy(a))}function Mj(n,e,t){return e<n.openStart&&(n=new De(mC(n.content,-1,e,n.openStart,0,n.openEnd),e,n.openEnd)),t<n.openEnd&&(n=new De(mC(n.content,1,t,n.openEnd,0,0),n.openStart,t)),n}const bW={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Pj=null;function vW(){return Pj||(Pj=document.implementation.createHTMLDocument("title"))}let sA=null;function H1e(n){let e=window.trustedTypes;return e?(sA||(sA=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),sA.createHTML(n)):n}function q1e(n){let e=/^(\s*<meta [^>]*>)*/.exec(n);e&&(n=n.slice(e[0].length));let t=vW().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(n),s;if((s=r&&bW[r[1].toLowerCase()])&&(n=s.map(i=>"<"+i+">").join("")+n+s.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=H1e(n),s)for(let i=0;i<s.length;i++)t=t.querySelector(s[i])||t;return t}function G1e(n){let e=n.querySelectorAll(Ms?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let r=e[t];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),r)}}function W1e(n,e){if(!n.size)return n;let t=n.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return n}let{content:s,openStart:i,openEnd:o}=n;for(let a=r.length-2;a>=0;a-=2){let l=t.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=ge.from(l.create(r[a+1],s)),i++,o++}return new De(s,i,o)}const to={},no={},K1e={touchstart:!0,touchmove:!0};class Y1e{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function X1e(n){for(let e in to){let t=to[e];n.dom.addEventListener(e,n.input.eventHandlers[e]=r=>{Q1e(n,r)&&!G8(n,r)&&(n.editable||!(r.type in no))&&t(n,r)},K1e[e]?{passive:!0}:void 0)}Ei&&n.dom.addEventListener("input",()=>null),gC(n)}function Nh(n,e){n.input.lastSelectionOrigin=e,n.input.lastSelectionTime=Date.now()}function J1e(n){n.domObserver.stop();for(let e in n.input.eventHandlers)n.dom.removeEventListener(e,n.input.eventHandlers[e]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function gC(n){n.someProp("handleDOMEvents",e=>{for(let t in e)n.input.eventHandlers[t]||n.dom.addEventListener(t,n.input.eventHandlers[t]=r=>G8(n,r))})}function G8(n,e){return n.someProp("handleDOMEvents",t=>{let r=t[e.type];return r?r(n,e)||e.defaultPrevented:!1})}function Q1e(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=n.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Z1e(n,e){!G8(n,e)&&to[e.type]&&(n.editable||!(e.type in no))&&to[e.type](n,e)}no.keydown=(n,e)=>{let t=e;if(n.input.shiftKey=t.keyCode==16||t.shiftKey,!kW(n,t)&&(n.input.lastKeyCode=t.keyCode,n.input.lastKeyCodeTime=Date.now(),!($u&&Ms&&t.keyCode==13)))if(t.keyCode!=229&&n.domObserver.forceFlush(),O1&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();n.input.lastIOSEnter=r,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==r&&(n.someProp("handleKeyDown",s=>s(n,Hf(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",r=>r(n,t))||$1e(n,t)?t.preventDefault():Nh(n,"key")};no.keyup=(n,e)=>{e.keyCode==16&&(n.input.shiftKey=!1)};no.keypress=(n,e)=>{let t=e;if(kW(n,t)||!t.charCode||t.ctrlKey&&!t.altKey||Oa&&t.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,t))){t.preventDefault();return}let r=n.state.selection;if(!(r instanceof _t)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(t.charCode),i=()=>n.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",o=>o(n,r.$from.pos,r.$to.pos,s,i))&&n.dispatch(i()),t.preventDefault()}};function lS(n){return{left:n.clientX,top:n.clientY}}function eye(n,e){let t=e.x-n.clientX,r=e.y-n.clientY;return t*t+r*r<100}function W8(n,e,t,r,s){if(r==-1)return!1;let i=n.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(n.someProp(e,a=>o>i.depth?a(n,t,i.nodeAfter,i.before(o),s,!0):a(n,t,i.node(o),i.before(o),s,!1)))return!0;return!1}function ig(n,e,t){if(n.focused||n.focus(),n.state.selection.eq(e))return;let r=n.state.tr.setSelection(e);r.setMeta("pointer",!0),n.dispatch(r)}function tye(n,e){if(e==-1)return!1;let t=n.state.doc.resolve(e),r=t.nodeAfter;return r&&r.isAtom&&rt.isSelectable(r)?(ig(n,new rt(t)),!0):!1}function nye(n,e){if(e==-1)return!1;let t=n.state.selection,r,s;t instanceof rt&&(r=t.node);let i=n.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(rt.isSelectable(a)){r&&t.$from.depth>0&&o>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?s=i.before(t.$from.depth):s=i.before(o);break}}return s!=null?(ig(n,rt.create(n.state.doc,s)),!0):!1}function rye(n,e,t,r,s){return W8(n,"handleClickOn",e,t,r)||n.someProp("handleClick",i=>i(n,e,r))||(s?nye(n,t):tye(n,t))}function sye(n,e,t,r){return W8(n,"handleDoubleClickOn",e,t,r)||n.someProp("handleDoubleClick",s=>s(n,e,r))}function iye(n,e,t,r){return W8(n,"handleTripleClickOn",e,t,r)||n.someProp("handleTripleClick",s=>s(n,e,r))||oye(n,t,r)}function oye(n,e,t){if(t.button!=0)return!1;let r=n.state.doc;if(e==-1)return r.inlineContent?(ig(n,_t.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)ig(n,_t.create(r,a+1,a+1+o.content.size));else if(rt.isSelectable(o))ig(n,rt.create(r,a));else continue;return!0}}function K8(n){return B_(n)}const wW=Oa?"metaKey":"ctrlKey";to.mousedown=(n,e)=>{let t=e;n.input.shiftKey=t.shiftKey;let r=K8(n),s=Date.now(),i="singleClick";s-n.input.lastClick.time<500&&eye(t,n.input.lastClick)&&!t[wW]&&n.input.lastClick.button==t.button&&(n.input.lastClick.type=="singleClick"?i="doubleClick":n.input.lastClick.type=="doubleClick"&&(i="tripleClick")),n.input.lastClick={time:s,x:t.clientX,y:t.clientY,type:i,button:t.button};let o=n.posAtCoords(lS(t));o&&(i=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new aye(n,o,t,!!r)):(i=="doubleClick"?sye:iye)(n,o.pos,o.inside,t)?t.preventDefault():Nh(n,"pointer"))};class aye{constructor(e,t,r,s){this.view=e,this.pos=t,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[wW],this.allowDefault=r.shiftKey;let i,o;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);i=u.parent,o=u.depth?u.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof rt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ya&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Nh(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>qu(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(lS(e))),this.updateAllowDefault(e),this.allowDefault||!t?Nh(this.view,"pointer"):rye(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Ei&&this.mightDrag&&!this.mightDrag.node.isAtom||Ms&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(ig(this.view,Bt.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):Nh(this.view,"pointer")}move(e){this.updateAllowDefault(e),Nh(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}to.touchstart=n=>{n.input.lastTouch=Date.now(),K8(n),Nh(n,"pointer")};to.touchmove=n=>{n.input.lastTouch=Date.now(),Nh(n,"pointer")};to.contextmenu=n=>K8(n);function kW(n,e){return n.composing?!0:Ei&&Math.abs(e.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const lye=$u?5e3:-1;no.compositionstart=no.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:e}=n,t=e.selection.$to;if(e.selection instanceof _t&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Ms&&ZG&&cye(n)))n.markCursor=n.state.storedMarks||t.marks(),B_(n,!0),n.markCursor=null;else if(B_(n,!e.selection.empty),Ya&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=n.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=n.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}n.input.composing=!0}_W(n,lye)};function cye(n){let{focusNode:e,focusOffset:t}=n.domSelectionRange();if(!e||e.nodeType!=1||t>=e.childNodes.length)return!1;let r=e.childNodes[t];return r.nodeType==1&&r.contentEditable=="false"}no.compositionend=(n,e)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=e.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,_W(n,20))};function _W(n,e){clearTimeout(n.input.composingTimeout),e>-1&&(n.input.composingTimeout=setTimeout(()=>B_(n),e))}function SW(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=dye());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function uye(n){let e=n.domSelectionRange();if(!e.focusNode)return null;let t=n1e(e.focusNode,e.focusOffset),r=r1e(e.focusNode,e.focusOffset);if(t&&r&&t!=r){let s=r.pmViewDesc,i=n.domObserver.lastChangedTextNode;if(t==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(n.input.compositionNode==r){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return r}}return t||r}function dye(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function B_(n,e=!1){if(!($u&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),SW(n),e||n.docView&&n.docView.dirty){let t=U8(n),r=n.state.selection;return t&&!t.eq(r)?n.dispatch(n.state.tr.setSelection(t)):(n.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function hye(n,e){if(!n.dom.parentNode)return;let t=n.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),n.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),n.focus()},50)}const Pb=Po&&Wh<15||O1&&a1e<604;to.copy=no.cut=(n,e)=>{let t=e,r=n.state.selection,s=t.type=="cut";if(r.empty)return;let i=Pb?null:t.clipboardData,o=r.content(),{dom:a,text:l}=q8(n,o);i?(t.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):hye(n,a),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function fye(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function pye(n,e){if(!n.dom.parentNode)return;let t=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,r=n.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),r.parentNode&&r.parentNode.removeChild(r),t?Lb(n,r.value,null,s,e):Lb(n,r.textContent,r.innerHTML,s,e)},50)}function Lb(n,e,t,r,s){let i=mW(n,e,t,r,n.state.selection.$from);if(n.someProp("handlePaste",l=>l(n,s,i||De.empty)))return!0;if(!i)return!1;let o=fye(i),a=o?n.state.tr.replaceSelectionWith(o,r):n.state.tr.replaceSelection(i);return n.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function TW(n){let e=n.getData("text/plain")||n.getData("Text");if(e)return e;let t=n.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}no.paste=(n,e)=>{let t=e;if(n.composing&&!$u)return;let r=Pb?null:t.clipboardData,s=n.input.shiftKey&&n.input.lastKeyCode!=45;r&&Lb(n,TW(r),r.getData("text/html"),s,t)?t.preventDefault():pye(n,t)};class AW{constructor(e,t,r){this.slice=e,this.move=t,this.node=r}}const mye=Oa?"altKey":"ctrlKey";function EW(n,e){let t=n.someProp("dragCopies",r=>!r(e));return t??!e[mye]}to.dragstart=(n,e)=>{let t=e,r=n.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let s=n.state.selection,i=s.empty?null:n.posAtCoords(lS(t)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof rt?s.to-1:s.to))){if(r&&r.mightDrag)o=rt.create(n.state.doc,r.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let h=n.docView.nearestDesc(t.target,!0);h&&h.node.type.spec.draggable&&h!=n.docView&&(o=rt.create(n.state.doc,h.posBefore))}}let a=(o||n.state.selection).content(),{dom:l,text:c,slice:u}=q8(n,a);(!t.dataTransfer.files.length||!Ms||QG>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Pb?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",Pb||t.dataTransfer.setData("text/plain",c),n.dragging=new AW(u,EW(n,t),o)};to.dragend=n=>{let e=n.dragging;window.setTimeout(()=>{n.dragging==e&&(n.dragging=null)},50)};no.dragover=no.dragenter=(n,e)=>e.preventDefault();no.drop=(n,e)=>{try{gye(n,e,n.dragging)}finally{n.dragging=null}};function gye(n,e,t){if(!e.dataTransfer)return;let r=n.posAtCoords(lS(e));if(!r)return;let s=n.state.doc.resolve(r.pos),i=t&&t.slice;i?n.someProp("transformPasted",p=>{i=p(i,n,!1)}):i=mW(n,TW(e.dataTransfer),Pb?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(t&&EW(n,e));if(n.someProp("handleDrop",p=>p(n,e,i||De.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?RG(n.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=n.state.tr;if(o){let{node:p}=t;p?p.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,h=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),l.doc.eq(h))return;let f=l.doc.resolve(c);if(u&&rt.isSelectable(i.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new rt(f));else{let p=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((g,y,v,b)=>p=b),l.setSelection(H8(n,f,l.doc.resolve(p)))}n.focus(),n.dispatch(l.setMeta("uiEvent","drop"))}to.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&qu(n)},20))};to.blur=(n,e)=>{let t=e;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),t.relatedTarget&&n.dom.contains(t.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};to.beforeinput=(n,e)=>{if(Ms&&$u&&e.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:r}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=r||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",i=>i(n,Hf(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in no)to[n]=no[n];function Db(n,e){if(n==e)return!0;for(let t in n)if(n[t]!==e[t])return!1;for(let t in e)if(!(t in n))return!1;return!0}class $_{constructor(e,t){this.toDOM=e,this.spec=t||y0,this.side=this.spec.side||0}map(e,t,r,s){let{pos:i,deleted:o}=e.mapResult(t.from+s,this.side<0?-1:1);return o?null:new Gi(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof $_&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Db(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Yh{constructor(e,t){this.attrs=e,this.spec=t||y0}map(e,t,r,s){let i=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new Gi(i,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Yh&&Db(this.attrs,e.attrs)&&Db(this.spec,e.spec)}static is(e){return e.type instanceof Yh}destroy(){}}class Y8{constructor(e,t){this.attrs=e,this.spec=t||y0}map(e,t,r,s){let i=e.mapResult(t.from+s,1);if(i.deleted)return null;let o=e.mapResult(t.to+s,-1);return o.deleted||o.pos<=i.pos?null:new Gi(i.pos-r,o.pos-r,this)}valid(e,t){let{index:r,offset:s}=e.content.findIndex(t.from),i;return s==t.from&&!(i=e.child(r)).isText&&s+i.nodeSize==t.to}eq(e){return this==e||e instanceof Y8&&Db(this.attrs,e.attrs)&&Db(this.spec,e.spec)}destroy(){}}class Gi{constructor(e,t,r){this.from=e,this.to=t,this.type=r}copy(e,t){return new Gi(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,r){return this.type.map(e,this,t,r)}static widget(e,t,r){return new Gi(e,e,new $_(t,r))}static inline(e,t,r,s){return new Gi(e,t,new Yh(r,s))}static node(e,t,r,s){return new Gi(e,t,new Y8(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Yh}get widget(){return this.type instanceof $_}}const xm=[],y0={};class gr{constructor(e,t){this.local=e.length?e:xm,this.children=t.length?t:xm}static create(e,t){return t.length?V_(t,e,0,y0):gi}find(e,t,r){let s=[];return this.findInner(e??0,t??1e9,s,0,r),s}findInner(e,t,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,r,s+a,i)}}map(e,t,r){return this==gi||e.maps.length==0?this:this.mapInner(e,t,0,0,r||y0)}mapInner(e,t,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(t,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?yye(this.children,o||[],e,t,r,s,i):o?new gr(o.sort(x0),xm):gi}add(e,t){return t.length?this==gi?gr.create(e,t):this.addInner(e,t,0):this}addInner(e,t,r){let s,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=NW(t,a,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,u,c+1):s.splice(i,0,l,l+a.nodeSize,V_(u,a,c+1,y0)),i+=3}});let o=CW(i?IW(t):t,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new gr(o.length?this.local.concat(o).sort(x0):this.local,s||this.children)}remove(e){return e.length==0||this==gi?this:this.removeInner(e,0)}removeInner(e,t){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+t,l=r[i+1]+t;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(o,a+1);c!=gi?r[i+2]=c:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,t)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new gr(s,r):gi}forChild(e,t){if(this==gi)return this;if(t.isLeaf)return gr.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Yh){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(s||(s=[])).push(l.copy(c,u))}}if(s){let a=new gr(s.sort(x0),xm);return r?new Hd([a,r]):a}return r||gi}eq(e){if(this==e)return!0;if(!(e instanceof gr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return X8(this.localsInner(e))}localsInner(e){if(this==gi)return xm;if(e.inlineContent||!this.local.some(Yh.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Yh||t.push(this.local[r]);return t}forEachSet(e){e(this)}}gr.empty=new gr([],[]);gr.removeOverlap=X8;const gi=gr.empty;class Hd{constructor(e){this.members=e}map(e,t){const r=this.members.map(s=>s.map(e,t,y0));return Hd.from(r)}forChild(e,t){if(t.isLeaf)return gr.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,t);i!=gi&&(i instanceof Hd?r=r.concat(i.members):r.push(i))}return Hd.from(r)}eq(e){if(!(e instanceof Hd)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!t)t=i;else{r&&(t=t.slice(),r=!1);for(let o=0;o<i.length;o++)t.push(i[o])}}return t?X8(r?t:t.sort(x0)):xm}static from(e){switch(e.length){case 0:return gi;case 1:return e[0];default:return new Hd(e.every(t=>t instanceof gr)?e:e.reduce((t,r)=>t.concat(r instanceof gr?r:r.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function yye(n,e,t,r,s,i,o){let a=n.slice();for(let c=0,u=i;c<t.maps.length;c++){let h=0;t.maps[c].forEach((f,p,g,y)=>{let v=y-g-(p-f);for(let b=0;b<a.length;b+=3){let w=a[b+1];if(w<0||f>w+u-h)continue;let k=a[b]+u-h;p>=k?a[b+1]=f<=k?-2:-1:f>=u&&v&&(a[b]+=v,a[b+1]+=v)}h+=v}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(n[c]+i),h=u-s;if(h<0||h>=r.content.size){l=!0;continue}let f=t.map(n[c+1]+i,-1),p=f-s,{index:g,offset:y}=r.content.findIndex(h),v=r.maybeChild(g);if(v&&y==h&&y+v.nodeSize==p){let b=a[c+2].mapInner(t,v,u+1,n[c]+i+1,o);b!=gi?(a[c]=h,a[c+1]=p,a[c+2]=b):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=xye(a,n,e,t,s,i,o),u=V_(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let p=u.children[h];for(;f<a.length&&a[f]<p;)f+=3;a.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new gr(e.sort(x0),a)}function CW(n,e){if(!e||!n.length)return n;let t=[];for(let r=0;r<n.length;r++){let s=n[r];t.push(new Gi(s.from+e,s.to+e,s.type))}return t}function xye(n,e,t,r,s,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,s,c);h?t.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<n.length;l+=3)n[l+1]==-1&&a(n[l+2],e[l]+i+1);return t}function NW(n,e,t){if(e.isLeaf)return null;let r=t+e.nodeSize,s=null;for(let i=0,o;i<n.length;i++)(o=n[i])&&o.from>t&&o.to<r&&((s||(s=[])).push(o),n[i]=null);return s}function IW(n){let e=[];for(let t=0;t<n.length;t++)n[t]!=null&&e.push(n[t]);return e}function V_(n,e,t,r){let s=[],i=!1;e.forEach((a,l)=>{let c=NW(n,a,l+t);if(c){i=!0;let u=V_(c,a,t+l+1,r);u!=gi&&s.push(l,l+a.nodeSize,u)}});let o=CW(i?IW(n):n,-t).sort(x0);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new gr(o,s):gi}function x0(n,e){return n.from-e.from||n.to-e.to}function X8(n){let e=n;for(let t=0;t<e.length-1;t++){let r=e[t];if(r.from!=r.to)for(let s=t+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==n&&(e=n.slice()),e[s]=i.copy(i.from,r.to),Lj(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==n&&(e=n.slice()),e[t]=r.copy(r.from,i.from),Lj(e,s,r.copy(i.from,r.to)));break}}}return e}function Lj(n,e,t){for(;e<n.length&&x0(t,n[e])>0;)e++;n.splice(e,0,t)}function iA(n){let e=[];return n.someProp("decorations",t=>{let r=t(n.state);r&&r!=gi&&e.push(r)}),n.cursorWrapper&&e.push(gr.create(n.state.doc,[n.cursorWrapper.deco])),Hd.from(e)}const bye={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},vye=Po&&Wh<=11;class wye{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class kye{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new wye,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);Po&&Wh<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),vye&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,bye)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Aj(this.view)){if(this.suppressingSelectionUpdates)return qu(this.view);if(Po&&Wh<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&P0(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,r;for(let i=e.focusNode;i;i=j1(i))t.add(i);for(let i=e.anchorNode;i;i=j1(i))if(t.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Aj(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let h=this.registerMutation(t[u],l);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(Ya&&l.length){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,f]=u;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of u){let p=f.parentNode;p&&p.nodeName=="LI"&&(!h||Tye(e,h)!=p)&&f.remove()}}}else if((Ms||Ei)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let h=u.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&oS(r)&&(c=U8(e))&&c.eq(Bt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,qu(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),_ye(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||qu(e),this.currentSelection.set(r))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];t.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Po&&Wh<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:f}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=s&&s.parentNode==e.target?Ys(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Ys(i):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let Dj=new WeakMap,jj=!1;function _ye(n){if(!Dj.has(n)&&(Dj.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Ya,jj)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),jj=!0}}function Oj(n,e){let t=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=n.domAtPos(n.state.selection.anchor);return P0(o.node,o.offset,s,i)&&([t,r,s,i]=[s,i,t,r]),{anchorNode:t,anchorOffset:r,focusNode:s,focusOffset:i}}function Sye(n,e){if(e.getComposedRanges){let s=e.getComposedRanges(n.root)[0];if(s)return Oj(n,s)}let t;function r(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",r,!0),t?Oj(n,t):null}function Tye(n,e){for(let t=e.parentNode;t&&t!=n.dom;t=t.parentNode){let r=n.docView.nearestDesc(t,!0);if(r&&r.node.isBlock)return t}return null}function Aye(n,e,t){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=n.docView.parseRange(e,t),l=n.domSelectionRange(),c,u=l.anchorNode;if(u&&n.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],oS(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Ms&&n.input.lastKeyCode===8)for(let v=i;v>s;v--){let b=r.childNodes[v-1],w=b.pmViewDesc;if(b.nodeName=="BR"&&!w){i=v;break}if(!w||w.size)break}let h=n.state.doc,f=n.someProp("domParser")||Lx.fromSchema(n.state.schema),p=h.resolve(o),g=null,y=f.parse(r,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:s,to:i,preserveWhitespace:p.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Eye,context:p});if(c&&c[0].pos!=null){let v=c[0].pos,b=c[1]&&c[1].pos;b==null&&(b=v),g={anchor:v+o,head:b+o}}return{doc:y,sel:g,from:o,to:a}}function Eye(n){let e=n.pmViewDesc;if(e)return e.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(Ei&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(n.parentNode.lastChild==n||Ei&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Cye=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Nye(n,e,t,r,s){let i=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,e<0){let E=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,I=U8(n,E);if(I&&!n.state.selection.eq(I)){if(Ms&&$u&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",N=>N(n,Hf(13,"Enter"))))return;let S=n.state.tr.setSelection(I);E=="pointer"?S.setMeta("pointer",!0):E=="key"&&S.scrollIntoView(),i&&S.setMeta("composition",i),n.dispatch(S)}return}let o=n.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=n.state.doc.resolve(t).after(a+1);let l=n.state.selection,c=Aye(n,e,t),u=n.state.doc,h=u.slice(c.from,c.to),f,p;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(f=n.state.selection.to,p="end"):(f=n.state.selection.from,p="start"),n.input.lastKeyCode=null;let g=Mye(h.content,c.doc.content,c.from,f,p);if(g&&n.input.domChangeCount++,(O1&&n.input.lastIOSEnter>Date.now()-225||$u)&&s.some(E=>E.nodeType==1&&!Cye.test(E.nodeName))&&(!g||g.endA>=g.endB)&&n.someProp("handleKeyDown",E=>E(n,Hf(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!g)if(r&&l instanceof _t&&!l.empty&&l.$head.sameParent(l.$anchor)&&!n.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))g={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let E=Fj(n,n.state.doc,c.sel);if(E&&!E.eq(n.state.selection)){let I=n.state.tr.setSelection(E);i&&I.setMeta("composition",i),n.dispatch(I)}}return}n.state.selection.from<n.state.selection.to&&g.start==g.endB&&n.state.selection instanceof _t&&(g.start>n.state.selection.from&&g.start<=n.state.selection.from+2&&n.state.selection.from>=c.from?g.start=n.state.selection.from:g.endA<n.state.selection.to&&g.endA>=n.state.selection.to-2&&n.state.selection.to<=c.to&&(g.endB+=n.state.selection.to-g.endA,g.endA=n.state.selection.to)),Po&&Wh<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>c.from&&c.doc.textBetween(g.start-c.from-1,g.start-c.from+1)==" "&&(g.start--,g.endA--,g.endB--);let y=c.doc.resolveNoCache(g.start-c.from),v=c.doc.resolveNoCache(g.endB-c.from),b=u.resolve(g.start),w=y.sameParent(v)&&y.parent.inlineContent&&b.end()>=g.endA;if((O1&&n.input.lastIOSEnter>Date.now()-225&&(!w||s.some(E=>E.nodeName=="DIV"||E.nodeName=="P"))||!w&&y.pos<c.doc.content.size&&(!y.sameParent(v)||!y.parent.inlineContent)&&y.pos<v.pos&&!/\S/.test(c.doc.textBetween(y.pos,v.pos,"","")))&&n.someProp("handleKeyDown",E=>E(n,Hf(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>g.start&&Rye(u,g.start,g.endA,y,v)&&n.someProp("handleKeyDown",E=>E(n,Hf(8,"Backspace")))){$u&&Ms&&n.domObserver.suppressSelectionUpdates();return}Ms&&g.endB==g.start&&(n.input.lastChromeDelete=Date.now()),$u&&!w&&y.start()!=v.start()&&v.parentOffset==0&&y.depth==v.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==g.endA&&(g.endB-=2,v=c.doc.resolveNoCache(g.endB-c.from),setTimeout(()=>{n.someProp("handleKeyDown",function(E){return E(n,Hf(13,"Enter"))})},20));let k=g.start,T=g.endA,R=E=>{let I=E||n.state.tr.replace(k,T,c.doc.slice(g.start-c.from,g.endB-c.from));if(c.sel){let S=Fj(n,I.doc,c.sel);S&&!(Ms&&n.composing&&S.empty&&(g.start!=g.endB||n.input.lastChromeDelete<Date.now()-100)&&(S.head==k||S.head==I.mapping.map(T)-1)||Po&&S.empty&&S.head==k)&&I.setSelection(S)}return i&&I.setMeta("composition",i),I.scrollIntoView()},M;if(w)if(y.pos==v.pos){Po&&Wh<=11&&y.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>qu(n),20));let E=R(n.state.tr.delete(k,T)),I=u.resolve(g.start).marksAcross(u.resolve(g.endA));I&&E.ensureMarks(I),n.dispatch(E)}else if(g.endA==g.endB&&(M=Iye(y.parent.content.cut(y.parentOffset,v.parentOffset),b.parent.content.cut(b.parentOffset,g.endA-b.start())))){let E=R(n.state.tr);M.type=="add"?E.addMark(k,T,M.mark):E.removeMark(k,T,M.mark),n.dispatch(E)}else if(y.parent.child(y.index()).isText&&y.index()==v.index()-(v.textOffset?0:1)){let E=y.parent.textBetween(y.parentOffset,v.parentOffset),I=()=>R(n.state.tr.insertText(E,k,T));n.someProp("handleTextInput",S=>S(n,k,T,E,I))||n.dispatch(I())}else n.dispatch(R());else n.dispatch(R())}function Fj(n,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:H8(n,e.resolve(t.anchor),e.resolve(t.head))}function Iye(n,e){let t=n.firstChild.marks,r=e.firstChild.marks,s=t,i=r,o,a,l;for(let u=0;u<r.length;u++)s=r[u].removeFromSet(s);for(let u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(ge.from(c).eq(n))return{mark:a,type:o}}function Rye(n,e,t,r,s){if(t-e<=s.pos-r.pos||oA(r,!0,!1)<s.pos)return!1;let i=n.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&t==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=n.resolve(oA(i,!0,!0));return!o.parent.isTextblock||o.pos>t||oA(o,!0,!1)<t?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function oA(n,e,t){let r=n.depth,s=e?n.end():n.pos;for(;r>0&&(e||n.indexAfter(r)==n.node(r).childCount);)r--,s++,e=!1;if(t){let i=n.node(r).maybeChild(n.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function Mye(n,e,t,r,s){let i=n.findDiffStart(e,t);if(i==null)return null;let{a:o,b:a}=n.findDiffEnd(e,t+n.size,t+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&n.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&zj(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<n.size&&zj(n.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function zj(n){if(n.length!=2)return!1;let e=n.charCodeAt(0),t=n.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class RW{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Y1e,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Hj),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Vj(this),$j(this),this.nodeViews=Uj(this),this.docView=vj(this.state.doc,Bj(this),iA(this),this.dom,this),this.domObserver=new kye(this,(r,s,i,o)=>Nye(this,r,s,i,o)),this.domObserver.start(),X1e(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&gC(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Hj),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let r in this._props)t[r]=this._props[r];t.state=this.state;for(let r in e)t[r]=e[r];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(SW(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let p=Uj(this);Lye(p,this.nodeViews)&&(this.nodeViews=p,i=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&gC(this),this.editable=Vj(this),$j(this);let l=iA(this),c=Bj(this),u=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,c,l);(h||!e.selection.eq(s.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&u1e(this);if(o){this.domObserver.stop();let p=h&&(Po||Ms)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&Pye(s.selection,e.selection);if(h){let g=Ms?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=uye(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=vj(e.doc,c,l,this.dom,this)),g&&!this.trackWrites&&(p=!0)}p||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&L1e(this))?qu(this,p):(hW(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&d1e(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof rt){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&pj(this,t.getBoundingClientRect(),e)}else pj(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let r=this.directPlugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let r=this.state.plugins[t];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let r=this.pluginViews[t];r.update&&r.update(this,e)}}updateDraggedNode(e,t){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new AW(e.slice,e.move,s<0?void 0:rt.create(this.state.doc,s))}someProp(e,t){let r=this._props&&this._props[e],s;if(r!=null&&(s=t?t(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=t?t(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=t?t(a):a))return s}}hasFocus(){if(Po){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&h1e(this.dom),qu(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return y1e(this,e)}coordsAtPos(e,t=1){return sW(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,r=-1){let s=this.docView.posFromDOM(e,t,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return k1e(this,t||this.state,e)}pasteHTML(e,t){return Lb(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return Lb(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return q8(this,e)}destroy(){this.docView&&(J1e(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],iA(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,e1e())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Z1e(this,e)}domSelectionRange(){let e=this.domSelection();return e?Ei&&this.root.nodeType===11&&i1e(this.dom.ownerDocument)==this.dom&&Sye(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}RW.prototype.dispatch=function(n){let e=this._props.dispatchTransaction;e?e.call(this,n):this.updateState(this.state.apply(n))};function Bj(n){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(n.editable),n.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(n.state)),t)for(let r in t)r=="class"?e.class+=" "+t[r]:r=="style"?e.style=(e.style?e.style+";":"")+t[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(t[r]))}),e.translate||(e.translate="no"),[Gi.node(0,n.state.doc.content.size,e)]}function $j(n){if(n.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),n.cursorWrapper={dom:e,deco:Gi.widget(n.state.selection.from,e,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function Vj(n){return!n.someProp("editable",e=>e(n.state)===!1)}function Pye(n,e){let t=Math.min(n.$anchor.sharedDepth(n.head),e.$anchor.sharedDepth(e.head));return n.$anchor.start(t)!=e.$anchor.start(t)}function Uj(n){let e=Object.create(null);function t(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return n.someProp("nodeViews",t),n.someProp("markViews",t),e}function Lye(n,e){let t=0,r=0;for(let s in n){if(n[s]!=e[s])return!0;t++}for(let s in e)r++;return t!=r}function Hj(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var lf={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},U_={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Dye=typeof navigator<"u"&&/Mac/.test(navigator.platform),jye=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Xs=0;Xs<10;Xs++)lf[48+Xs]=lf[96+Xs]=String(Xs);for(var Xs=1;Xs<=24;Xs++)lf[Xs+111]="F"+Xs;for(var Xs=65;Xs<=90;Xs++)lf[Xs]=String.fromCharCode(Xs+32),U_[Xs]=String.fromCharCode(Xs);for(var aA in lf)U_.hasOwnProperty(aA)||(U_[aA]=lf[aA]);function Oye(n){var e=Dye&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||jye&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?U_:lf)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const Fye=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),zye=typeof navigator<"u"&&/Win/.test(navigator.platform);function Bye(n){let e=n.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Fye?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(t="Alt-"+t),s&&(t="Ctrl-"+t),o&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function $ye(n){let e=Object.create(null);for(let t in n)e[Bye(t)]=n[t];return e}function lA(n,e,t=!0){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t&&e.shiftKey&&(n="Shift-"+n),n}function Vye(n){return new _r({props:{handleKeyDown:MW(n)}})}function MW(n){let e=$ye(n);return function(t,r){let s=Oye(r),i,o=e[lA(s,r)];if(o&&o(t.state,t.dispatch,t))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[lA(s,r,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(zye&&r.ctrlKey&&r.altKey)&&(i=lf[r.keyCode])&&i!=s){let a=e[lA(i,r)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}var Uye=Object.defineProperty,J8=(n,e)=>{for(var t in e)Uye(n,t,{get:e[t],enumerable:!0})};function cS(n){const{state:e,transaction:t}=n;let{selection:r}=t,{doc:s}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=t.selection,s=t.doc,i=t.storedMarks,t}}}var uS=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:r}=this,{view:s}=t,{tr:i}=r,o=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const h=l(...u)(o);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(i),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a=[],l=!!e,c=e||i.tr,u=()=>(!l&&t&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(f=>f===!0)),h={...Object.fromEntries(Object.entries(r).map(([f,p])=>[f,(...y)=>{const v=this.buildProps(c,t),b=p(...y)(v);return a.push(b),h}])),run:u};return h}createCan(e){const{rawCommands:t,state:r}=this,s=!1,i=e||r.tr,o=this.buildProps(i,s);return{...Object.fromEntries(Object.entries(t).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(i,s)}}buildProps(e,t=!0){const{rawCommands:r,editor:s,state:i}=this,{view:o}=s,a={tr:e,editor:s,view:o,state:cS({state:i,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}},PW={};J8(PW,{blur:()=>Hye,clearContent:()=>qye,clearNodes:()=>Gye,command:()=>Wye,createParagraphNear:()=>Kye,cut:()=>Yye,deleteCurrentNode:()=>Xye,deleteNode:()=>Jye,deleteRange:()=>Qye,deleteSelection:()=>Zye,enter:()=>exe,exitCode:()=>txe,extendMarkRange:()=>nxe,first:()=>rxe,focus:()=>ixe,forEach:()=>oxe,insertContent:()=>axe,insertContentAt:()=>uxe,joinBackward:()=>fxe,joinDown:()=>hxe,joinForward:()=>pxe,joinItemBackward:()=>mxe,joinItemForward:()=>gxe,joinTextblockBackward:()=>yxe,joinTextblockForward:()=>xxe,joinUp:()=>dxe,keyboardShortcut:()=>vxe,lift:()=>wxe,liftEmptyBlock:()=>kxe,liftListItem:()=>_xe,newlineInCode:()=>Sxe,resetAttributes:()=>Txe,scrollIntoView:()=>Axe,selectAll:()=>Exe,selectNodeBackward:()=>Cxe,selectNodeForward:()=>Nxe,selectParentNode:()=>Ixe,selectTextblockEnd:()=>Rxe,selectTextblockStart:()=>Mxe,setContent:()=>Pxe,setMark:()=>Zxe,setMeta:()=>ebe,setNode:()=>tbe,setNodeSelection:()=>nbe,setTextDirection:()=>rbe,setTextSelection:()=>sbe,sinkListItem:()=>ibe,splitBlock:()=>obe,splitListItem:()=>abe,toggleList:()=>lbe,toggleMark:()=>cbe,toggleNode:()=>ube,toggleWrap:()=>dbe,undoInputRule:()=>hbe,unsetAllMarks:()=>fbe,unsetMark:()=>pbe,unsetTextDirection:()=>mbe,updateAttributes:()=>gbe,wrapIn:()=>ybe,wrapInList:()=>xbe});var Hye=()=>({editor:n,view:e})=>(requestAnimationFrame(()=>{var t;n.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())==null||t.removeAllRanges())}),!0),qye=(n=!0)=>({commands:e})=>e.setContent("",{emitUpdate:n}),Gye=()=>({state:n,tr:e,dispatch:t})=>{const{selection:r}=e,{ranges:s}=r;return t&&s.forEach(({$from:i,$to:o})=>{n.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),p=h.blockRange(f);if(!p)return;const g=ny(p);if(a.type.isTextblock){const{defaultType:y}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(p.start,y)}(g||g===0)&&e.lift(p,g)})}),!0},Wye=n=>e=>n(e),Kye=()=>({state:n,dispatch:e})=>WG(n,e),Yye=(n,e)=>({editor:t,tr:r})=>{const{state:s}=t,i=s.doc.slice(n.from,n.to);r.deleteRange(n.from,n.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new _t(r.doc.resolve(Math.max(o-1,0)))),!0},Xye=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,r=t.$anchor.node();if(r.content.size>0)return!1;const s=n.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);n.delete(a,l).scrollIntoView()}return!0}return!1};function ts(n,e){if(typeof n=="string"){if(!e.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return e.nodes[n]}return n}var Jye=n=>({tr:e,state:t,dispatch:r})=>{const s=ts(n,t.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Qye=n=>({tr:e,dispatch:t})=>{const{from:r,to:s}=n;return t&&e.delete(r,s),!0},Zye=()=>({state:n,dispatch:e})=>O8(n,e),exe=()=>({commands:n})=>n.keyboardShortcut("Enter"),txe=()=>({state:n,dispatch:e})=>zge(n,e);function Q8(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function H_(n,e,t={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>t.strict?e[s]===n[s]:Q8(e[s])?e[s].test(n[s]):e[s]===n[s]):!0}function LW(n,e,t={}){return n.find(r=>r.type===e&&H_(Object.fromEntries(Object.keys(t).map(s=>[s,r.attrs[s]])),t))}function qj(n,e,t={}){return!!LW(n,e,t)}function Z8(n,e,t){var r;if(!n||!e)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(t=t||((r=s.node.marks[0])==null?void 0:r.attrs),!LW([...s.node.marks],e,t)))return;let o=s.index,a=n.start()+s.offset,l=o+1,c=a+s.node.nodeSize;for(;o>0&&qj([...n.parent.child(o-1).marks],e,t);)o-=1,a-=n.parent.child(o).nodeSize;for(;l<n.parent.childCount&&qj([...n.parent.child(l).marks],e,t);)c+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function yd(n,e){if(typeof n=="string"){if(!e.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return e.marks[n]}return n}var nxe=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const i=yd(n,r.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(s){const h=Z8(l,i,e);if(h&&h.from<=c&&h.to>=u){const f=_t.create(o,h.from,h.to);t.setSelection(f)}}return!0},rxe=n=>e=>{const t=typeof n=="function"?n(e):n;for(let r=0;r<t.length;r+=1)if(t[r](e))return!0;return!1};function DW(n){return n instanceof _t}function np(n=0,e=0,t=0){return Math.min(Math.max(n,e),t)}function jW(n,e=null){if(!e)return null;const t=Bt.atStart(n),r=Bt.atEnd(n);if(e==="start"||e===!0)return t;if(e==="end")return r;const s=t.from,i=r.to;return e==="all"?_t.create(n,np(0,s,i),np(n.content.size,s,i)):_t.create(n,np(e,s,i),np(e,s,i))}function sxe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function eR(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var ixe=(n=null,e={})=>({editor:t,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(eR()||sxe())&&r.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(r.hasFocus()&&n===null||n===!1)return!0;if(i&&n===null&&!DW(t.state.selection))return o(),!0;const a=jW(s.doc,n)||t.state.selection,l=t.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},oxe=(n,e)=>t=>n.every((r,s)=>e(r,{...t,index:s})),axe=(n,e)=>({tr:t,commands:r})=>r.insertContentAt({from:t.selection.from,to:t.selection.to},n,e),OW=n=>{const e=n.childNodes;for(let t=e.length-1;t>=0;t-=1){const r=e[t];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?n.removeChild(r):r.nodeType===1&&OW(r)}return n};function Y2(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${n}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return OW(t)}function jb(n,e,t){if(n instanceof Gh||n instanceof ge)return n;t={slice:!0,parseOptions:{},...t};const r=typeof n=="object"&&n!==null,s=typeof n=="string";if(r)try{if(Array.isArray(n)&&n.length>0)return ge.fromArray(n.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(n);return t.errorOnInvalidContent&&o.check(),o}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",i),jb("",e,t)}if(s){if(t.errorOnInvalidContent){let o=!1,a="";const l=new vG({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?Lx.fromSchema(l).parseSlice(Y2(n),t.parseOptions):Lx.fromSchema(l).parse(Y2(n),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Lx.fromSchema(e);return t.slice?i.parseSlice(Y2(n),t.parseOptions).content:i.parse(Y2(n),t.parseOptions)}return jb("",e,t)}function lxe(n,e,t){const r=n.steps.length-1;if(r<e)return;const s=n.steps[r];if(!(s instanceof Rs||s instanceof Ls))return;const i=n.mapping.maps[r];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),n.setSelection(Bt.near(n.doc.resolve(o),t))}var cxe=n=>!("type"in n),uxe=(n,e,t)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const l=v=>{i.emit("contentError",{editor:i,error:v,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{jb(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(v){l(v)}try{a=jb(e,i.schema,{parseOptions:c,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:i.options.enableContentCheck})}catch(v){return l(v),!1}let{from:u,to:h}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},f=!0,p=!0;if((cxe(a)?a:[a]).forEach(v=>{v.check(),f=f?v.isText&&v.marks.length===0:!1,p=p?v.isBlock:!1}),u===h&&p){const{parent:v}=r.doc.resolve(u);v.isTextblock&&!v.type.spec.code&&!v.childCount&&(u-=1,h+=1)}let y;if(f){if(Array.isArray(e))y=e.map(v=>v.text||"").join("");else if(e instanceof ge){let v="";e.forEach(b=>{b.text&&(v+=b.text)}),y=v}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,u,h)}else{y=a;const v=r.doc.resolve(u),b=v.node(),w=v.parentOffset===0,k=b.isText||b.isTextblock,T=b.content.size>0;w&&k&&T&&(u=Math.max(0,u-1)),r.replaceWith(u,h,y)}t.updateSelection&&lxe(r,r.steps.length-1,-1),t.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:y}),t.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:y})}return!0},dxe=()=>({state:n,dispatch:e})=>jge(n,e),hxe=()=>({state:n,dispatch:e})=>Oge(n,e),fxe=()=>({state:n,dispatch:e})=>BG(n,e),pxe=()=>({state:n,dispatch:e})=>HG(n,e),mxe=()=>({state:n,dispatch:e,tr:t})=>{try{const r=rS(n.doc,n.selection.$from.pos,-1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},gxe=()=>({state:n,dispatch:e,tr:t})=>{try{const r=rS(n.doc,n.selection.$from.pos,1);return r==null?!1:(t.join(r,2),e&&e(t),!0)}catch{return!1}},yxe=()=>({state:n,dispatch:e})=>Lge(n,e),xxe=()=>({state:n,dispatch:e})=>Dge(n,e);function FW(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function bxe(n){const e=n.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))eR()||FW()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(t=`Alt-${t}`),s&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}var vxe=n=>({editor:e,view:t,tr:r,dispatch:s})=>{const i=bxe(n).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function cf(n,e,t={}){const{from:r,to:s,empty:i}=n.selection,o=e?ts(e,n.schema):null,a=[];n.doc.nodesBetween(r,s,(h,f)=>{if(h.isText)return;const p=Math.max(r,f),g=Math.min(s,f+h.nodeSize);a.push({node:h,from:p,to:g})});const l=s-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>H_(h.node.attrs,t,{strict:!1}));return i?!!c.length:c.reduce((h,f)=>h+f.to-f.from,0)>=l}var wxe=(n,e={})=>({state:t,dispatch:r})=>{const s=ts(n,t.schema);return cf(t,s,e)?Fge(t,r):!1},kxe=()=>({state:n,dispatch:e})=>KG(n,e),_xe=n=>({state:e,dispatch:t})=>{const r=ts(n,e.schema);return Xge(r)(e,t)},Sxe=()=>({state:n,dispatch:e})=>GG(n,e);function dS(n,e){return e.nodes[n]?"node":e.marks[n]?"mark":null}function Gj(n,e){const t=typeof e=="string"?[e]:e;return Object.keys(n).reduce((r,s)=>(t.includes(s)||(r[s]=n[s]),r),{})}var Txe=(n,e)=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const a=dS(typeof n=="string"?n:n.name,r.schema);if(!a)return!1;a==="node"&&(i=ts(n,r.schema)),a==="mark"&&(o=yd(n,r.schema));let l=!1;return t.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,h)=>{i&&i===u.type&&(l=!0,s&&t.setNodeMarkup(h,void 0,Gj(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&(l=!0,s&&t.addMark(h,h+u.nodeSize,o.create(Gj(f.attrs,e))))})})}),l},Axe=()=>({tr:n,dispatch:e})=>(e&&n.scrollIntoView(),!0),Exe=()=>({tr:n,dispatch:e})=>{if(e){const t=new ua(n.doc);n.setSelection(t)}return!0},Cxe=()=>({state:n,dispatch:e})=>VG(n,e),Nxe=()=>({state:n,dispatch:e})=>qG(n,e),Ixe=()=>({state:n,dispatch:e})=>Vge(n,e),Rxe=()=>({state:n,dispatch:e})=>qge(n,e),Mxe=()=>({state:n,dispatch:e})=>Hge(n,e);function yC(n,e,t={},r={}){return jb(n,e,{slice:!1,parseOptions:t,errorOnInvalidContent:r.errorOnInvalidContent})}var Pxe=(n,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:r={}}={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if(r.preserveWhitespace!=="full"){const c=yC(n,s.schema,r,{errorOnInvalidContent:e??s.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&i.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},n,{parseOptions:r,errorOnInvalidContent:e??s.options.enableContentCheck})};function zW(n,e){const t=yd(e,n.schema),{from:r,to:s,empty:i}=n.selection,o=[];i?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function BW(n,e){const t=new jG(n);return e.forEach(r=>{r.steps.forEach(s=>{t.step(s)})}),t}function Lxe(n){for(let e=0;e<n.edgeCount;e+=1){const{type:t}=n.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function Dxe(n,e,t){const r=[];return n.nodesBetween(e.from,e.to,(s,i)=>{t(s)&&r.push({node:s,pos:i})}),r}function jxe(n,e){for(let t=n.depth;t>0;t-=1){const r=n.node(t);if(e(r))return{pos:t>0?n.before(t):0,start:n.start(t),depth:t,node:r}}}function hS(n){return e=>jxe(e.$from,n)}function Ze(n,e,t){return n.config[e]===void 0&&n.parent?Ze(n.parent,e,t):typeof n.config[e]=="function"?n.config[e].bind({...t,parent:n.parent?Ze(n.parent,e,t):null}):n.config[e]}function tR(n){return n.map(e=>{const t={name:e.name,options:e.options,storage:e.storage},r=Ze(e,"addExtensions",t);return r?[e,...tR(r())]:e}).flat(10)}function nR(n,e){const t=J0.fromSchema(e).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(t),s.innerHTML}function $W(n){return typeof n=="function"}function Nn(n,e=void 0,...t){return $W(n)?e?n.bind(e)(...t):n(...t):n}function Oxe(n={}){return Object.keys(n).length===0&&n.constructor===Object}function F1(n){const e=n.filter(s=>s.type==="extension"),t=n.filter(s=>s.type==="node"),r=n.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:r}}function VW(n){const e=[],{nodeExtensions:t,markExtensions:r}=F1(n),s=[...t,...r],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=Ze(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([f,p])=>{e.push({type:h,name:f,attribute:{...i,...p}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Ze(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function ns(...n){return n.filter(e=>!!e).reduce((e,t)=>{const r={...e};return Object.entries(t).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],c=a.filter(u=>!l.includes(u));r[s]=[...l,...c].join(" ")}else if(s==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());c.set(h,f)}),a.forEach(u=>{const[h,f]=u.split(":").map(p=>p.trim());c.set(h,f)}),r[s]=Array.from(c.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else r[s]=i}),r},{})}function q_(n,e){return e.filter(t=>t.type===n.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(n.attrs)||{}:{[t.name]:n.attrs[t.name]}).reduce((t,r)=>ns(t,r),{})}function Fxe(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function Wj(n,e){return"style"in n?n:{...n,getAttrs:t=>{const r=n.getAttrs?n.getAttrs(t):n.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):Fxe(t.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function Kj(n){return Object.fromEntries(Object.entries(n).filter(([e,t])=>e==="attrs"&&Oxe(t)?!1:t!=null))}function Yj(n){var e,t;const r={};return!((e=n==null?void 0:n.attribute)!=null&&e.isRequired)&&"default"in((n==null?void 0:n.attribute)||{})&&(r.default=n.attribute.default),((t=n==null?void 0:n.attribute)==null?void 0:t.validate)!==void 0&&(r.validate=n.attribute.validate),[n.name,r]}function zxe(n,e){var t;const r=VW(n),{nodeExtensions:s,markExtensions:i}=F1(n),o=(t=s.find(c=>Ze(c,"topNode")))==null?void 0:t.name,a=Object.fromEntries(s.map(c=>{const u=r.filter(b=>b.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=n.reduce((b,w)=>{const k=Ze(w,"extendNodeSchema",h);return{...b,...k?k(c):{}}},{}),p=Kj({...f,content:Nn(Ze(c,"content",h)),marks:Nn(Ze(c,"marks",h)),group:Nn(Ze(c,"group",h)),inline:Nn(Ze(c,"inline",h)),atom:Nn(Ze(c,"atom",h)),selectable:Nn(Ze(c,"selectable",h)),draggable:Nn(Ze(c,"draggable",h)),code:Nn(Ze(c,"code",h)),whitespace:Nn(Ze(c,"whitespace",h)),linebreakReplacement:Nn(Ze(c,"linebreakReplacement",h)),defining:Nn(Ze(c,"defining",h)),isolating:Nn(Ze(c,"isolating",h)),attrs:Object.fromEntries(u.map(Yj))}),g=Nn(Ze(c,"parseHTML",h));g&&(p.parseDOM=g.map(b=>Wj(b,u)));const y=Ze(c,"renderHTML",h);y&&(p.toDOM=b=>y({node:b,HTMLAttributes:q_(b,u)}));const v=Ze(c,"renderText",h);return v&&(p.toText=v),[c.name,p]})),l=Object.fromEntries(i.map(c=>{const u=r.filter(v=>v.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=n.reduce((v,b)=>{const w=Ze(b,"extendMarkSchema",h);return{...v,...w?w(c):{}}},{}),p=Kj({...f,inclusive:Nn(Ze(c,"inclusive",h)),excludes:Nn(Ze(c,"excludes",h)),group:Nn(Ze(c,"group",h)),spanning:Nn(Ze(c,"spanning",h)),code:Nn(Ze(c,"code",h)),attrs:Object.fromEntries(u.map(Yj))}),g=Nn(Ze(c,"parseHTML",h));g&&(p.parseDOM=g.map(v=>Wj(v,u)));const y=Ze(c,"renderHTML",h);return y&&(p.toDOM=v=>y({mark:v,HTMLAttributes:q_(v,u)})),[c.name,p]}));return new vG({topNode:o,nodes:a,marks:l})}function Bxe(n){const e=n.filter((t,r)=>n.indexOf(t)!==r);return Array.from(new Set(e))}function rR(n){return n.sort((t,r)=>{const s=Ze(t,"priority")||100,i=Ze(r,"priority")||100;return s>i?-1:s<i?1:0})}function UW(n){const e=rR(tR(n)),t=Bxe(e.map(r=>r.name));return t.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${t.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function HW(n,e,t){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=t||{};let a="";return n.nodesBetween(r,s,(l,c,u,h)=>{var f;l.isBlock&&c>r&&(a+=i);const p=o==null?void 0:o[l.type.name];if(p)return u&&(a+=p({node:l,pos:c,parent:u,index:h,range:e})),!1;l.isText&&(a+=(f=l==null?void 0:l.text)==null?void 0:f.slice(Math.max(r,c)-c,s-c))}),a}function $xe(n,e){const t={from:0,to:n.content.size};return HW(n,t,e)}function qW(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function Vxe(n,e){const t=ts(e,n.schema),{from:r,to:s}=n.selection,i=[];n.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function GW(n,e){const t=dS(typeof e=="string"?e:e.name,n.schema);return t==="node"?Vxe(n,e):t==="mark"?zW(n,e):{}}function Uxe(n,e=JSON.stringify){const t={};return n.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(t,s)?!1:t[s]=!0})}function Hxe(n){const e=Uxe(n);return e.length===1?e:e.filter((t,r)=>!e.filter((i,o)=>o!==r).some(i=>t.oldRange.from>=i.oldRange.from&&t.oldRange.to<=i.oldRange.to&&t.newRange.from>=i.newRange.from&&t.newRange.to<=i.newRange.to))}function WW(n){const{mapping:e,steps:t}=n,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(i).map(a,-1),u=e.slice(i).map(l),h=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:h,to:f},newRange:{from:c,to:u}})})}),Hxe(r)}function sR(n,e,t){const r=[];return n===e?t.resolve(n).marks().forEach(s=>{const i=t.resolve(n),o=Z8(i,s.type);o&&r.push({mark:s,...o})}):t.nodesBetween(n,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}var qxe=(n,e,t,r=20)=>{const s=n.doc.resolve(t);let i=r,o=null;for(;i>0&&o===null;){const a=s.node(i);(a==null?void 0:a.type.name)===e?o=a:i-=1}return[o,i]};function cA(n,e){return e.nodes[n]||e.marks[n]||null}function Y4(n,e,t){return Object.fromEntries(Object.entries(t).filter(([r])=>{const s=n.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}var Gxe=(n,e=500)=>{let t="";const r=n.parentOffset;return n.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)==null?void 0:c.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";t+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,r-i))}),t};function xC(n,e,t={}){const{empty:r,ranges:s}=n.selection,i=e?yd(e,n.schema):null;if(r)return!!(n.storedMarks||n.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>H_(h.attrs,t,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:h,$to:f})=>{const p=h.pos,g=f.pos;n.doc.nodesBetween(p,g,(y,v)=>{if(!y.isText&&!y.marks.length)return;const b=Math.max(p,v),w=Math.min(g,v+y.nodeSize),k=w-b;o+=k,a.push(...y.marks.map(T=>({mark:T,from:b,to:w})))})}),o===0)return!1;const l=a.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>H_(h.mark.attrs,t,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),c=a.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(l>0?l+c:l)>=o}function Wxe(n,e,t={}){if(!e)return cf(n,null,t)||xC(n,null,t);const r=dS(e,n.schema);return r==="node"?cf(n,e,t):r==="mark"?xC(n,e,t):!1}var Kxe=(n,e)=>{const{$from:t,$to:r,$anchor:s}=n.selection;if(e){const i=hS(a=>a.type.name===e)(n.selection);if(!i)return!1;const o=n.doc.resolve(i.pos+1);return s.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||t.pos!==r.pos)},Yxe=n=>{const{$from:e,$to:t}=n.selection;return!(e.parentOffset>0||e.pos!==t.pos)};function Xj(n,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===n.name):e}function Jj(n,e){const{nodeExtensions:t}=F1(e),r=t.find(o=>o.name===n);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=Nn(Ze(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function fS(n,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var r;if(t){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((r=n.text)!=null?r:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(e){let s=!0;return n.content.forEach(i=>{s!==!1&&(fS(i,{ignoreWhitespace:t,checkChildren:e})||(s=!1))}),s}return!1}function KW(n){return n instanceof rt}var YW=class XW{constructor(e){this.position=e}static fromJSON(e){return new XW(e.position)}toJSON(){return{position:this.position}}};function Xxe(n,e){const t=e.mapping.mapResult(n.position);return{position:new YW(t.pos),mapResult:t}}function Jxe(n){return new YW(n)}function Qxe(n,e,t){var r;const{selection:s}=e;let i=null;if(DW(s)&&(i=s.$cursor),i){const a=(r=n.storedMarks)!=null?r:i.marks();return i.parent.type.allowsMarkType(t)&&(!!t.isInSet(a)||!a.some(c=>c.type.excludes(t)))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(t):!1;return n.doc.nodesBetween(a.pos,l.pos,(u,h,f)=>{if(c)return!1;if(u.isInline){const p=!f||f.type.allowsMarkType(t),g=!!t.isInSet(u.marks)||!u.marks.some(y=>y.type.excludes(t));c=p&&g}return!c}),c})}var Zxe=(n,e={})=>({tr:t,state:r,dispatch:s})=>{const{selection:i}=t,{empty:o,ranges:a}=i,l=yd(n,r.schema);if(s)if(o){const c=zW(r,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(f,p)=>{const g=Math.max(p,u),y=Math.min(p+f.nodeSize,h);f.marks.find(b=>b.type===l)?f.marks.forEach(b=>{l===b.type&&t.addMark(g,y,l.create({...b.attrs,...e}))}):t.addMark(g,y,l.create(e))})});return Qxe(r,t,l)},ebe=(n,e)=>({tr:t})=>(t.setMeta(n,e),!0),tbe=(n,e={})=>({state:t,dispatch:r,chain:s})=>{const i=ts(n,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>dj(i,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>dj(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},nbe=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,s=np(n,0,r.content.size),i=rt.create(r,s);e.setSelection(i)}return!0},rbe=(n,e)=>({tr:t,state:r,dispatch:s})=>{const{selection:i}=r;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=i.from,a=i.to),s&&t.doc.nodesBetween(o,a,(l,c)=>{l.isText||t.setNodeMarkup(c,void 0,{...l.attrs,dir:n})}),!0},sbe=n=>({tr:e,dispatch:t})=>{if(t){const{doc:r}=e,{from:s,to:i}=typeof n=="number"?{from:n,to:n}:n,o=_t.atStart(r).from,a=_t.atEnd(r).to,l=np(s,o,a),c=np(i,o,a),u=_t.create(r,l,c);e.setSelection(u)}return!0},ibe=n=>({state:e,dispatch:t})=>{const r=ts(n,e.schema);return Zge(r)(e,t)};function Qj(n,e){const t=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(t){const r=t.filter(s=>e==null?void 0:e.includes(s.type.name));n.tr.ensureMarks(r)}}var obe=({keepMarks:n=!0}={})=>({tr:e,state:t,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=s.extensionManager.attributes,u=Y4(c,a.node().type.name,a.node().attrs);if(i instanceof rt&&i.node.isBlock)return!a.parentOffset||!Hu(o,a.pos)?!1:(r&&(n&&Qj(t,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:Lxe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=h&&f?[{type:f,attrs:u}]:void 0,g=Hu(e.doc,e.mapping.map(a.pos),1,p);if(!p&&!g&&Hu(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(g=!0,p=f?[{type:f,attrs:u}]:void 0),r){if(g&&(i instanceof _t&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,p),f&&!h&&!a.parentOffset&&a.parent.type!==f)){const y=e.mapping.map(a.before()),v=e.doc.resolve(y);a.node(-1).canReplaceWith(v.index(),v.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}n&&Qj(t,s.extensionManager.splittableMarks),e.scrollIntoView()}return g},abe=(n,e={})=>({tr:t,state:r,dispatch:s,editor:i})=>{var o;const a=ts(n,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==a)return!1;const f=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let b=ge.empty;const w=l.index(-1)?1:l.index(-2)?2:3;for(let I=l.depth-w;I>=l.depth-3;I-=1)b=ge.from(l.node(I).copy(b));const k=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,T={...Y4(f,l.node().type.name,l.node().attrs),...e},R=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(T))||void 0;b=b.append(ge.from(a.createAndFill(null,R)||void 0));const M=l.before(l.depth-(w-1));t.replace(M,l.after(-k),new De(b,4-w,0));let E=-1;t.doc.nodesBetween(M,t.doc.content.size,(I,S)=>{if(E>-1)return!1;I.isTextblock&&I.content.size===0&&(E=S+1)}),E>-1&&t.setSelection(_t.near(t.doc.resolve(E))),t.scrollIntoView()}return!0}const p=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,g={...Y4(f,h.type.name,h.attrs),...e},y={...Y4(f,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const v=p?[{type:a,attrs:g},{type:p,attrs:y}]:[{type:a,attrs:g}];if(!Hu(t.doc,l.pos,2))return!1;if(s){const{selection:b,storedMarks:w}=r,{splittableMarks:k}=i.extensionManager,T=w||b.$to.parentOffset&&b.$from.marks();if(t.split(l.pos,2,v).scrollIntoView(),!T||!s)return!0;const R=T.filter(M=>k.includes(M.type.name));t.ensureMarks(R)}return!0},uA=(n,e)=>{const t=hS(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&_f(n.doc,t.pos)&&n.join(t.pos),!0},dA=(n,e)=>{const t=hS(o=>o.type===e)(n.selection);if(!t)return!0;const r=n.doc.resolve(t.start).after(t.depth);if(r===void 0)return!0;const s=n.doc.nodeAt(r);return t.node.type===(s==null?void 0:s.type)&&_f(n.doc,r)&&n.join(r),!0},lbe=(n,e,t,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:h,splittableMarks:f}=s.extensionManager,p=ts(n,o.schema),g=ts(e,o.schema),{selection:y,storedMarks:v}=o,{$from:b,$to:w}=y,k=b.blockRange(w),T=v||y.$to.parentOffset&&y.$from.marks();if(!k)return!1;const R=hS(M=>Jj(M.type.name,h))(y);if(k.depth>=1&&R&&k.depth-R.depth<=1){if(R.node.type===p)return c.liftListItem(g);if(Jj(R.node.type.name,h)&&p.validContent(R.node.content)&&a)return l().command(()=>(i.setNodeMarkup(R.pos,p),!0)).command(()=>uA(i,p)).command(()=>dA(i,p)).run()}return!t||!T||!a?l().command(()=>u().wrapInList(p,r)?!0:c.clearNodes()).wrapInList(p,r).command(()=>uA(i,p)).command(()=>dA(i,p)).run():l().command(()=>{const M=u().wrapInList(p,r),E=T.filter(I=>f.includes(I.type.name));return i.ensureMarks(E),M?!0:c.clearNodes()}).wrapInList(p,r).command(()=>uA(i,p)).command(()=>dA(i,p)).run()},cbe=(n,e={},t={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=t,o=yd(n,r.schema);return xC(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},ube=(n,e,t={})=>({state:r,commands:s})=>{const i=ts(n,r.schema),o=ts(e,r.schema),a=cf(r,i,t);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...t})},dbe=(n,e={})=>({state:t,commands:r})=>{const s=ts(n,t.schema);return cf(t,s,e)?r.lift(s):r.wrapIn(s,e)},hbe=()=>({state:n,dispatch:e})=>{const t=n.plugins;for(let r=0;r<t.length;r+=1){const s=t[r];let i;if(s.spec.isInputRules&&(i=s.getState(n))){if(e){const o=n.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,n.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},fbe=()=>({tr:n,dispatch:e})=>{const{selection:t}=n,{empty:r,ranges:s}=t;return r||e&&s.forEach(i=>{n.removeMark(i.$from.pos,i.$to.pos)}),!0},pbe=(n,e={})=>({tr:t,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=yd(n,r.schema),{$from:c,empty:u,ranges:h}=a;if(!s)return!0;if(u&&o){let{from:f,to:p}=a;const g=(i=c.marks().find(v=>v.type===l))==null?void 0:i.attrs,y=Z8(c,l,g);y&&(f=y.from,p=y.to),t.removeMark(f,p,l)}else h.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,l)});return t.removeStoredMark(l),!0},mbe=n=>({tr:e,state:t,dispatch:r})=>{const{selection:s}=t;let i,o;return typeof n=="number"?(i=n,o=n):n&&"from"in n&&"to"in n?(i=n.from,o=n.to):(i=s.from,o=s.to),r&&e.doc.nodesBetween(i,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},gbe=(n,e={})=>({tr:t,state:r,dispatch:s})=>{let i=null,o=null;const a=dS(typeof n=="string"?n:n.name,r.schema);if(!a)return!1;a==="node"&&(i=ts(n,r.schema)),a==="mark"&&(o=yd(n,r.schema));let l=!1;return t.selection.ranges.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;let f,p,g,y;t.selection.empty?r.doc.nodesBetween(u,h,(v,b)=>{i&&i===v.type&&(l=!0,g=Math.max(b,u),y=Math.min(b+v.nodeSize,h),f=b,p=v)}):r.doc.nodesBetween(u,h,(v,b)=>{b<u&&i&&i===v.type&&(l=!0,g=Math.max(b,u),y=Math.min(b+v.nodeSize,h),f=b,p=v),b>=u&&b<=h&&(i&&i===v.type&&(l=!0,s&&t.setNodeMarkup(b,void 0,{...v.attrs,...e})),o&&v.marks.length&&v.marks.forEach(w=>{if(o===w.type&&(l=!0,s)){const k=Math.max(b,u),T=Math.min(b+v.nodeSize,h);t.addMark(k,T,o.create({...w.attrs,...e}))}}))}),p&&(f!==void 0&&s&&t.setNodeMarkup(f,void 0,{...p.attrs,...e}),o&&p.marks.length&&p.marks.forEach(v=>{o===v.type&&s&&t.addMark(g,y,o.create({...v.attrs,...e}))}))}),l},ybe=(n,e={})=>({state:t,dispatch:r})=>{const s=ts(n,t.schema);return Gge(s,e)(t,r)},xbe=(n,e={})=>({state:t,dispatch:r})=>{const s=ts(n,t.schema);return Wge(s,e)(t,r)},bbe=class{constructor(){this.callbacks={}}on(n,e){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(e),this}emit(n,...e){const t=this.callbacks[n];return t&&t.forEach(r=>r.apply(this,e)),this}off(n,e){const t=this.callbacks[n];return t&&(e?this.callbacks[n]=t.filter(r=>r!==e):delete this.callbacks[n]),this}once(n,e){const t=(...r)=>{this.off(n,t),e.apply(this,r)};return this.on(n,t)}removeAllListeners(){this.callbacks={}}},pS=class{constructor(n){var e;this.find=n.find,this.handler=n.handler,this.undoable=(e=n.undoable)!=null?e:!0}},vbe=(n,e)=>{if(Q8(e))return e.exec(n);const t=e(n);if(!t)return null;const r=[t.text];return r.index=t.index,r.input=n,r.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(t.replaceWith)),r};function X2(n){var e;const{editor:t,from:r,to:s,text:i,rules:o,plugin:a}=n,{view:l}=t;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const h=Gxe(c)+i;return o.forEach(f=>{if(u)return;const p=vbe(h,f.find);if(!p)return;const g=l.state.tr,y=cS({state:l.state,transaction:g}),v={from:r-(p[0].length-i.length),to:s},{commands:b,chain:w,can:k}=new uS({editor:t,state:y});f.handler({state:y,range:v,match:p,commands:b,chain:w,can:k})===null||!g.steps.length||(f.undoable&&g.setMeta(a,{transform:g,from:r,to:s,text:i}),l.dispatch(g),u=!0)}),u}function wbe(n){const{editor:e,rules:t}=n,r=new _r({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=nR(ge.from(u),o.schema);const{from:h}=l,f=h+u.length;X2({editor:e,from:h,to:f,text:u,rules:t,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return X2({editor:e,from:i,to:o,text:a,rules:t,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&X2({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?X2({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:r}):!1}},isInputRules:!0});return r}function kbe(n){return Object.prototype.toString.call(n).slice(8,-1)}function J2(n){return kbe(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function JW(n,e){const t={...n};return J2(n)&&J2(e)&&Object.keys(e).forEach(r=>{J2(e[r])&&J2(n[r])?t[r]=JW(n[r],e[r]):t[r]=e[r]}),t}var iR=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...Nn(Ze(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Nn(Ze(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){const e=this.extend({...this.config,addOptions:()=>JW(this.options,n)});return e.name=this.name,e.parent=this.parent,e}extend(n={}){const e=new this.constructor({...this.config,...n});return e.parent=this,this.child=e,e.name="name"in n?n.name:e.parent.name,e}},Q0=class QW extends iR{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new QW(t)}static handleExit({editor:e,mark:t}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===t.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===t.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function _be(n){return typeof n=="number"}var Sbe=class{constructor(n){this.find=n.find,this.handler=n.handler}},Tbe=(n,e,t)=>{if(Q8(e))return[...n.matchAll(e)];const r=e(n,t);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=n,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function Abe(n){const{editor:e,state:t,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=n,{commands:l,chain:c,can:u}=new uS({editor:e,state:t}),h=[];return t.doc.nodesBetween(r,s,(p,g)=>{var y,v,b,w,k;if((v=(y=p.type)==null?void 0:y.spec)!=null&&v.code||!(p.isText||p.isTextblock||p.isInline))return;const T=(k=(w=(b=p.content)==null?void 0:b.size)!=null?w:p.nodeSize)!=null?k:0,R=Math.max(r,g),M=Math.min(s,g+T);if(R>=M)return;const E=p.isText?p.text||"":p.textBetween(R-g,M-g,void 0,"");Tbe(E,i.find,o).forEach(S=>{if(S.index===void 0)return;const N=R+S.index+1,P=N+S[0].length,O={from:t.tr.mapping.map(N),to:t.tr.mapping.map(P)},D=i.handler({state:t,range:O,match:S,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});h.push(D)})}),h.every(p=>p!==null)}var Q2=null,Ebe=n=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)==null||e.setData("text/html",n),t};function Cbe(n){const{editor:e,rules:t}=n;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:h,to:f,rule:p,pasteEvt:g})=>{const y=u.tr,v=cS({state:u,transaction:y});if(!(!Abe({editor:e,state:v,from:Math.max(h-1,0),to:f.b-1,rule:p,pasteEvent:g,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return t.map(u=>new _r({view(h){const f=g=>{var y;r=(y=h.dom.parentElement)!=null&&y.contains(g.target)?h.dom.parentElement:null,r&&(Q2=e)},p=()=>{Q2&&(Q2=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=r===h.dom.parentElement,a=f,!i){const p=Q2;p!=null&&p.isEditable&&setTimeout(()=>{const g=p.state.selection;g&&p.commands.deleteRange({from:g.from,to:g.to})},10)}return!1},paste:(h,f)=>{var p;const g=(p=f.clipboardData)==null?void 0:p.getData("text/html");return o=f,s=!!(g!=null&&g.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,p)=>{const g=h[0],y=g.getMeta("uiEvent")==="paste"&&!s,v=g.getMeta("uiEvent")==="drop"&&!i,b=g.getMeta("applyPasteRules"),w=!!b;if(!y&&!v&&!w)return;if(w){let{text:R}=b;typeof R=="string"?R=R:R=nR(ge.from(R),p.schema);const{from:M}=b,E=M+R.length,I=Ebe(R);return l({rule:u,state:p,from:M,to:{b:E},pasteEvt:I})}const k=f.doc.content.findDiffStart(p.doc.content),T=f.doc.content.findDiffEnd(p.doc.content);if(!(!_be(k)||!T||k===T.b))return l({rule:u,state:p,from:k,to:T,pasteEvt:o})}}))}var mS=class{constructor(n,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=n,this.extensions=UW(n),this.schema=zxe(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((n,e)=>{const t={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:cA(e.name,this.schema)},r=Ze(e,"addCommands",t);return r?{...n,...r()}:n},{})}get plugins(){const{editor:n}=this;return rR([...this.extensions].reverse()).flatMap(r=>{const s={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:n,type:cA(r.name,this.schema)},i=[],o=Ze(r,"addKeyboardShortcuts",s);let a={};if(r.type==="mark"&&Ze(r,"exitable",s)&&(a.ArrowRight=()=>Q0.handleExit({editor:n,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([p,g])=>[p,()=>g({editor:n})]));a={...a,...f}}const l=Vye(a);i.push(l);const c=Ze(r,"addInputRules",s);if(Xj(r,n.options.enableInputRules)&&c){const f=c();if(f&&f.length){const p=wbe({editor:n,rules:f}),g=Array.isArray(p)?p:[p];i.push(...g)}}const u=Ze(r,"addPasteRules",s);if(Xj(r,n.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const p=Cbe({editor:n,rules:f});i.push(...p)}}const h=Ze(r,"addProseMirrorPlugins",s);if(h){const f=h();i.push(...f)}return i})}get attributes(){return VW(this.extensions)}get nodeViews(){const{editor:n}=this,{nodeExtensions:e}=F1(this.extensions);return Object.fromEntries(e.filter(t=>!!Ze(t,"addNodeView")).map(t=>{const r=this.attributes.filter(l=>l.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:n,type:ts(t.name,this.schema)},i=Ze(t,"addNodeView",s);if(!i)return[];const o=i();if(!o)return[];const a=(l,c,u,h,f)=>{const p=q_(l,r);return o({node:l,view:c,getPos:u,decorations:h,innerDecorations:f,editor:n,extension:t,HTMLAttributes:p})};return[t.name,a]}))}get markViews(){const{editor:n}=this,{markExtensions:e}=F1(this.extensions);return Object.fromEntries(e.filter(t=>!!Ze(t,"addMarkView")).map(t=>{const r=this.attributes.filter(a=>a.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:n,type:yd(t.name,this.schema)},i=Ze(t,"addMarkView",s);if(!i)return[];const o=(a,l,c)=>{const u=q_(a,r);return i()({mark:a,view:l,inline:c,editor:n,extension:t,HTMLAttributes:u,updateAttributes:h=>{Vbe(a,n,h)}})};return[t.name,o]}))}setupExtensions(){const n=this.extensions;this.editor.extensionStorage=Object.fromEntries(n.map(e=>[e.name,e.storage])),n.forEach(e=>{var t;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:cA(e.name,this.schema)};e.type==="mark"&&((t=Nn(Ze(e,"keepOnSplit",r)))==null||t)&&this.splittableMarks.push(e.name);const s=Ze(e,"onBeforeCreate",r),i=Ze(e,"onCreate",r),o=Ze(e,"onUpdate",r),a=Ze(e,"onSelectionUpdate",r),l=Ze(e,"onTransaction",r),c=Ze(e,"onFocus",r),u=Ze(e,"onBlur",r),h=Ze(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}};mS.resolve=UW;mS.sort=rR;mS.flatten=tR;var Nbe={};J8(Nbe,{ClipboardTextSerializer:()=>eK,Commands:()=>tK,Delete:()=>nK,Drop:()=>rK,Editable:()=>sK,FocusEvents:()=>oK,Keymap:()=>aK,Paste:()=>lK,Tabindex:()=>cK,TextDirection:()=>uK,focusEventsPluginKey:()=>iK});var jr=class ZW extends iR{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new ZW(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},eK=jr.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new _r({key:new bs("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:e,schema:t}=n,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=qW(t);return HW(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),tK=jr.create({name:"commands",addCommands(){return{...PW}}}),nK=jr.create({name:"delete",onUpdate({transaction:n,appendedTransactions:e}){var t,r,s;const i=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,n))!=null?c:n.getMeta("y-sync$"))return;const u=BW(n.before,[n,...e]);WW(u).forEach(p=>{u.mapping.mapResult(p.oldRange.from).deletedAfter&&u.mapping.mapResult(p.oldRange.to).deletedBefore&&u.before.nodesBetween(p.oldRange.from,p.oldRange.to,(g,y)=>{const v=y+g.nodeSize-2,b=p.oldRange.from<=y&&v<=p.oldRange.to;this.editor.emit("delete",{type:"node",node:g,from:y,to:v,newFrom:u.mapping.map(y),newTo:u.mapping.map(v),deletedRange:p.oldRange,newRange:p.newRange,partial:!b,editor:this.editor,transaction:n,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((p,g)=>{var y,v;if(p instanceof Ml){const b=f.slice(g).map(p.from,-1),w=f.slice(g).map(p.to),k=f.invert().map(b,-1),T=f.invert().map(w),R=(y=u.doc.nodeAt(b-1))==null?void 0:y.marks.some(E=>E.eq(p.mark)),M=(v=u.doc.nodeAt(w))==null?void 0:v.marks.some(E=>E.eq(p.mark));this.editor.emit("delete",{type:"mark",mark:p.mark,from:p.from,to:p.to,deletedRange:{from:k,to:T},newRange:{from:b,to:w},partial:!!(M||R),editor:this.editor,transaction:n,combinedTransform:u})}})};(s=(r=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:r.async)==null||s?setTimeout(i,0):i()}}),rK=jr.create({name:"drop",addProseMirrorPlugins(){return[new _r({key:new bs("tiptapDrop"),props:{handleDrop:(n,e,t,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:r})}}})]}}),sK=jr.create({name:"editable",addProseMirrorPlugins(){return[new _r({key:new bs("editable"),props:{editable:()=>this.editor.options.editable}})]}}),iK=new bs("focusEvents"),oK=jr.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new _r({key:iK,props:{handleDOMEvents:{focus:(e,t)=>{n.isFocused=!0;const r=n.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,t)=>{n.isFocused=!1;const r=n.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),aK=jr.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:f,parent:p}=h,g=h.parent.isTextblock&&f>0?a.doc.resolve(f-1):h,y=g.parent.type.spec.isolating,v=h.pos-h.parentOffset,b=y&&g.parent.childCount===1?v===h.pos:Bt.atStart(c).from===f;return!u||!p.type.isTextblock||p.textContent.length||!b||b&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return eR()||FW()?i:s},addProseMirrorPlugins(){return[new _r({key:new bs("clearDocument"),appendTransaction:(n,e,t)=>{if(n.some(y=>y.getMeta("composition")))return;const r=n.some(y=>y.docChanged)&&!e.doc.eq(t.doc),s=n.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=Bt.atStart(e.doc).from,c=Bt.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!fS(t.doc))return;const f=t.tr,p=cS({state:t,transaction:f}),{commands:g}=new uS({editor:this.editor,state:p});if(g.clearNodes(),!!f.steps.length)return f}})]}}),lK=jr.create({name:"paste",addProseMirrorPlugins(){return[new _r({key:new bs("tiptapPaste"),props:{handlePaste:(n,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),cK=jr.create({name:"tabindex",addProseMirrorPlugins(){return[new _r({key:new bs("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),uK=jr.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:n}=F1(this.extensions);return[{types:n.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return t&&(t==="ltr"||t==="rtl"||t==="auto")?t:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new _r({key:new bs("textDirection"),props:{attributes:()=>{const n=this.options.direction;return n?{dir:n}:{}}}})]}}),Ibe=class bm{constructor(e,t,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=t,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:t,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new bm(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new bm(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new bm(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,r)=>{const s=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new bm(a,this.editor,s,s?t:null);s&&(l.actualDepth=this.depth+1),e.push(new bm(a,this.editor,s,s?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(t).length>0){const i=s.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==t[l])break}}else r=s;s=s.parent}return r}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(t);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>t[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,t,r))))}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}},Rbe=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Mbe(n,e,t){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s),s}var Pbe=class extends bbe{constructor(n={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:r})=>{throw r},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:Xxe,createMappablePosition:Jxe},this.setOptions(n),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:r,slice:s,moved:i})=>this.options.onDrop(r,s,i)),this.on("paste",({event:r,slice:s})=>this.options.onPaste(r,s)),this.on("delete",this.options.onDelete);const e=this.createDoc(),t=jW(e,this.options.autofocus);this.editorState=Vm.create({doc:e,schema:this.schema,selection:t||void 0}),this.options.element&&this.mount(this.options.element)}mount(n){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(n),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const n=this.editorView.dom;n!=null&&n.editor&&delete n.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(n){console.warn("Failed to remove CSS element:",n)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Mbe(Rbe,this.options.injectNonce))}setOptions(n={}){this.options={...this.options,...n},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(n,e=!0){this.setOptions({editable:n}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:n=>{this.editorState=n},dispatch:n=>{this.dispatchTransaction(n)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(n,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in n)return Reflect.get(n,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(n,e){const t=$W(e)?e(n,[...this.state.plugins]):[...this.state.plugins,n],r=this.state.reconfigure({plugins:t});return this.view.updateState(r),r}unregisterPlugin(n){if(this.isDestroyed)return;const e=this.state.plugins;let t=e;if([].concat(n).forEach(s=>{const i=typeof s=="string"?`${s}$`:s.key;t=t.filter(o=>!o.key.startsWith(i))}),e.length===t.length)return;const r=this.state.reconfigure({plugins:t});return this.view.updateState(r),r}createExtensionManager(){var n,e;const r=[...this.options.enableCoreExtensions?[sK,eK.configure({blockSeparator:(e=(n=this.options.coreExtensionOptions)==null?void 0:n.clipboardTextSerializer)==null?void 0:e.blockSeparator}),tK,oK,aK,cK,rK,lK,nK,uK.configure({direction:this.options.textDirection})].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new mS(r,this)}createCommandManager(){this.commandManager=new uS({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let n;try{n=yC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(t=>t.name!=="collaboration"),this.createExtensionManager()}}),n=yC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return n}createView(n){var e;this.editorView=new RW(n,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const t=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(t),this.prependClass(),this.injectCSS();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(n){this.isCapturingTransaction=!0,n(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(n){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=n;return}n.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:t}=this.state.applyTransaction(n),r=!this.state.selection.eq(e.selection),s=t.includes(n),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:n,nextState:e}),!s)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:n,appendedTransactions:t.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:n});const o=t.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=o==null?void 0:o.getMeta("focus"),l=o==null?void 0:o.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),!(n.getMeta("preventUpdate")||!t.some(c=>c.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:n,appendedTransactions:t.slice(1)})}getAttributes(n){return GW(this.state,n)}isActive(n,e){const t=typeof n=="string"?n:null,r=typeof n=="string"?e:n;return Wxe(this.state,t,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return nR(this.state.doc.content,this.schema)}getText(n){const{blockSeparator:e=`

`,textSerializers:t={}}=n||{};return $xe(this.state.doc,{blockSeparator:e,textSerializers:{...qW(this.schema),...t}})}get isEmpty(){return fS(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var n,e;return(e=(n=this.editorView)==null?void 0:n.isDestroyed)!=null?e:!0}$node(n,e){var t;return((t=this.$doc)==null?void 0:t.querySelector(n,e))||null}$nodes(n,e){var t;return((t=this.$doc)==null?void 0:t.querySelectorAll(n,e))||null}$pos(n){const e=this.state.doc.resolve(n);return new Ibe(e,this)}get $doc(){return this.$pos(0)}};function z1(n){return new pS({find:n.find,handler:({state:e,range:t,match:r})=>{const s=Nn(n.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(sR(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(y=>y===n.type&&y!==p.mark.type)).filter(p=>p.to>c).length)return null;u<t.to&&i.delete(u,t.to),c>t.from&&i.delete(t.from+l,c);const f=t.from+l+o.length;i.addMark(t.from+l,f,n.type.create(s||{})),i.removeStoredMark(n.type)}},undoable:n.undoable})}function Lbe(n){return new pS({find:n.find,handler:({state:e,range:t,match:r})=>{const s=Nn(n.getAttributes,void 0,r)||{},{tr:i}=e,o=t.from;let a=t.to;const l=n.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,o+r[0].length-1),i.replaceWith(u,a,l)}else if(r[0]){const c=n.type.isInline?o:o-1;i.insert(c,n.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()},undoable:n.undoable})}function bC(n){return new pS({find:n.find,handler:({state:e,range:t,match:r})=>{const s=e.doc.resolve(t.from),i=Nn(n.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),n.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,n.type,i)},undoable:n.undoable})}function B1(n){return new pS({find:n.find,handler:({state:e,range:t,match:r,chain:s})=>{const i=Nn(n.getAttributes,void 0,r)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&D8(l,n.type,i);if(!c)return null;if(o.wrap(l,c),n.keepMarks&&n.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:p}=n.editor.extensionManager,g=f||h.$to.parentOffset&&h.$from.marks();if(g){const y=g.filter(v=>p.includes(v.type.name));o.ensureMarks(y)}}if(n.keepAttributes){const h=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===n.type&&_f(o.doc,t.from-1)&&(!n.joinPredicate||n.joinPredicate(r,u))&&o.join(t.from-1)},undoable:n.undoable})}function Dbe(n,e){const{selection:t}=n,{$from:r}=t;if(t instanceof rt){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}var jbe={};J8(jbe,{createAtomBlockMarkdownSpec:()=>Obe,createBlockMarkdownSpec:()=>Fbe,createInlineMarkdownSpec:()=>$be,parseAttributes:()=>oR,parseIndentedBlocks:()=>vC,renderNestedMarkdownContent:()=>lR,serializeAttributes:()=>aR});function oR(n){if(!(n!=null&&n.trim()))return{};const e={},t=[],r=n.replace(/["']([^"']*)["']/g,c=>(t.push(c),`__QUOTED_${t.length-1}__`)),s=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){const c=s.map(u=>u.trim().slice(1));e.class=c.join(" ")}const i=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var h;const f=parseInt(((h=u.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),p=t[f];p&&(e[c]=p.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function aR(n){if(!n||Object.keys(n).length===0)return"";const e=[];return n.class&&String(n.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),n.id&&e.push(`#${n.id}`),Object.entries(n).forEach(([t,r])=>{t==="class"||t==="id"||(r===!0?e.push(t):r!==!1&&r!=null&&e.push(`${t}="${String(r)}"`))}),e.join(" ")}function Obe(n){const{nodeName:e,name:t,parseAttributes:r=oR,serializeAttributes:s=aR,defaultAttributes:i={},requiredAttributes:o=[],allowedAttributes:a}=n,l=t||e,c=u=>{if(!a)return u;const h={};return a.forEach(f=>{f in u&&(h[f]=u[f])}),h};return{parseMarkdown:(u,h)=>{const f={...i,...u.attributes};return h.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var h;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),p=(h=u.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(u,h,f){const p=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),g=u.match(p);if(!g)return;const y=g[1]||"",v=r(y);if(!o.find(w=>!(w in v)))return{type:e,raw:g[0],attributes:v}}},renderMarkdown:u=>{const h=c(u.attrs||{}),f=s(h),p=f?` {${f}}`:"";return`:::${l}${p} :::`}}}function Fbe(n){const{nodeName:e,name:t,getContent:r,parseAttributes:s=oR,serializeAttributes:i=aR,defaultAttributes:o={},content:a="block",allowedAttributes:l}=n,c=t||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{p in h&&(f[p]=h[p])}),f};return{parseMarkdown:(h,f)=>{let p;if(r){const y=r(h);p=typeof y=="string"?[{type:"text",text:y}]:y}else a==="block"?p=f.parseChildren(h.tokens||[]):p=f.parseInline(h.tokens||[]);const g={...o,...h.attributes};return f.createNode(e,g,p)},markdownTokenizer:{name:e,level:"block",start(h){var f;const p=new RegExp(`^:::${c}`,"m"),g=(f=h.match(p))==null?void 0:f.index;return g!==void 0?g:-1},tokenize(h,f,p){var g;const y=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),v=h.match(y);if(!v)return;const[b,w=""]=v,k=s(w);let T=1;const R=b.length;let M="";const E=/^:::([\w-]*)(\s.*)?/gm,I=h.slice(R);for(E.lastIndex=0;;){const S=E.exec(I);if(S===null)break;const N=S.index,P=S[1];if(!((g=S[2])!=null&&g.endsWith(":::"))){if(P)T+=1;else if(T-=1,T===0){const O=I.slice(0,N);M=O.trim();const D=h.slice(0,R+N+S[0].length);let G=[];if(M)if(a==="block")for(G=p.blockTokens(O),G.forEach(J=>{J.text&&(!J.tokens||J.tokens.length===0)&&(J.tokens=p.inlineTokens(J.text))});G.length>0;){const J=G[G.length-1];if(J.type==="paragraph"&&(!J.text||J.text.trim()===""))G.pop();else break}else G=p.inlineTokens(M);return{type:e,raw:D,attributes:k,content:M,tokens:G}}}}}},renderMarkdown:(h,f)=>{const p=u(h.attrs||{}),g=i(p),y=g?` {${g}}`:"",v=f.renderChildren(h.content||[],`

`);return`:::${c}${y}

${v}

:::`}}}function zbe(n){if(!n.trim())return{};const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=t.exec(n);for(;r!==null;){const[,s,i,o]=r;e[s]=i||o,r=t.exec(n)}return e}function Bbe(n){return Object.entries(n).filter(([,e])=>e!=null).map(([e,t])=>`${e}="${t}"`).join(" ")}function $be(n){const{nodeName:e,name:t,getContent:r,parseAttributes:s=zbe,serializeAttributes:i=Bbe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=n,c=t||e,u=f=>{if(!l)return f;const p={};return l.forEach(g=>{const y=typeof g=="string"?g:g.name,v=typeof g=="string"?void 0:g.skipIfDefault;if(y in f){const b=f[y];if(v!==void 0&&b===v)return;p[y]=b}}),p},h=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,p)=>{const g={...o,...f.attributes};if(a)return p.createNode(e,g);const y=r?r(f):f.content||"";return y?p.createNode(e,g,[p.createTextNode(y)]):p.createNode(e,g,[])},markdownTokenizer:{name:e,level:"inline",start(f){const p=a?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),g=f.match(p),y=g==null?void 0:g.index;return y!==void 0?y:-1},tokenize(f,p,g){const y=a?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),v=f.match(y);if(!v)return;let b="",w="";if(a){const[,T]=v;w=T}else{const[,T,R]=v;w=T,b=R||""}const k=s(w.trim());return{type:e,raw:v[0],content:b.trim(),attributes:k}}},renderMarkdown:f=>{let p="";r?p=r(f):f.content&&f.content.length>0&&(p=f.content.filter(b=>b.type==="text").map(b=>b.text).join(""));const g=u(f.attrs||{}),y=i(g),v=y?` ${y}`:"";return a?`[${c}${v}]`:`[${c}${v}]${p}[/${c}]`}}}function vC(n,e,t){var r,s,i,o;const a=n.split(`
`),l=[];let c="",u=0;const h=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],p=f.match(e.itemPattern);if(!p){if(l.length>0)break;if(f.trim()===""){u+=1,c=`${c}${f}
`;continue}else return}const g=e.extractItemData(p),{indentLevel:y,mainContent:v}=g;c=`${c}${f}
`;const b=[v];for(u+=1;u<a.length;){const R=a[u];if(R.trim()===""){const E=a.slice(u+1).findIndex(N=>N.trim()!=="");if(E===-1)break;if((((s=(r=a[u+1+E].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:s.length)||0)>y){b.push(R),c=`${c}${R}
`,u+=1;continue}else break}if((((o=(i=R.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:o.length)||0)>y)b.push(R),c=`${c}${R}
`,u+=1;else break}let w;const k=b.slice(1);if(k.length>0){const R=k.map(M=>M.slice(y+h)).join(`
`);R.trim()&&(e.customNestedParser?w=e.customNestedParser(R):w=t.blockTokens(R))}const T=e.createToken(g,w);l.push(T)}if(l.length!==0)return{items:l,raw:c}}function lR(n,e,t,r){if(!n||!Array.isArray(n.content))return"";const s=typeof t=="function"?t(r):t,[i,...o]=n.content,a=e.renderChildren([i]),l=[`${s}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const h=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(h)}}),l.join(`
`)}function Vbe(n,e,t={}){const{state:r}=e,{doc:s,tr:i}=r,o=n;s.descendants((a,l)=>{const c=i.mapping.map(l),u=i.mapping.map(l)+a.nodeSize;let h=null;if(a.marks.forEach(p=>{if(p!==o)return!1;h=p}),!h)return;let f=!1;if(Object.keys(t).forEach(p=>{t[p]!==h.attrs[p]&&(f=!0)}),f){const p=n.type.create({...n.attrs,...t});i.removeMark(c,u,n.type),i.addMark(c,u,p)}}),i.docChanged&&e.view.dispatch(i)}var ba=class dK extends iR{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new dK(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function D0(n){return new Sbe({find:n.find,handler:({state:e,range:t,match:r,pasteEvent:s})=>{const i=Nn(n.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=t.to;if(a){const u=l.search(/\S/),h=t.from+l.indexOf(a),f=h+a.length;if(sR(t.from,t.to,e.doc).filter(g=>g.mark.type.excluded.find(v=>v===n.type&&v!==g.mark.type)).filter(g=>g.to>h).length)return null;f<t.to&&o.delete(f,t.to),h>t.from&&o.delete(t.from+u,h),c=t.from+u+a.length,o.addMark(t.from+u,c,n.type.create(i||{})),o.removeStoredMark(n.type)}}})}const{getOwnPropertyNames:Ube,getOwnPropertySymbols:Hbe}=Object,{hasOwnProperty:qbe}=Object.prototype;function hA(n,e){return function(r,s,i){return n(r,s,i)&&e(r,s,i)}}function Z2(n){return function(t,r,s){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,s);const{cache:i}=s,o=i.get(t),a=i.get(r);if(o&&a)return o===r&&a===t;i.set(t,r),i.set(r,t);const l=n(t,r,s);return i.delete(t),i.delete(r),l}}function Gbe(n){return n!=null?n[Symbol.toStringTag]:void 0}function Zj(n){return Ube(n).concat(Hbe(n))}const Wbe=Object.hasOwn||((n,e)=>qbe.call(n,e));function Z0(n,e){return n===e||!n&&!e&&n!==n&&e!==e}const Kbe="__v",Ybe="__o",Xbe="_owner",{getOwnPropertyDescriptor:eO,keys:tO}=Object;function Jbe(n,e){return n.byteLength===e.byteLength&&G_(new Uint8Array(n),new Uint8Array(e))}function Qbe(n,e,t){let r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function Zbe(n,e){return n.byteLength===e.byteLength&&G_(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function eve(n,e){return Z0(n.getTime(),e.getTime())}function tve(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function nve(n,e){return n===e}function nO(n,e,t){const r=n.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=n.entries();let o,a,l=0;for(;(o=i.next())&&!o.done;){const c=e.entries();let u=!1,h=0;for(;(a=c.next())&&!a.done;){if(s[h]){h++;continue}const f=o.value,p=a.value;if(t.equals(f[0],p[0],l,h,n,e,t)&&t.equals(f[1],p[1],f[0],p[0],n,e,t)){u=s[h]=!0;break}h++}if(!u)return!1;l++}return!0}const rve=Z0;function sve(n,e,t){const r=tO(n);let s=r.length;if(tO(e).length!==s)return!1;for(;s-- >0;)if(!hK(n,e,t,r[s]))return!1;return!0}function vy(n,e,t){const r=Zj(n);let s=r.length;if(Zj(e).length!==s)return!1;let i,o,a;for(;s-- >0;)if(i=r[s],!hK(n,e,t,i)||(o=eO(n,i),a=eO(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function ive(n,e){return Z0(n.valueOf(),e.valueOf())}function ove(n,e){return n.source===e.source&&n.flags===e.flags}function rO(n,e,t){const r=n.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=n.values();let o,a;for(;(o=i.next())&&!o.done;){const l=e.values();let c=!1,u=0;for(;(a=l.next())&&!a.done;){if(!s[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=s[u]=!0;break}u++}if(!c)return!1}return!0}function G_(n,e){let t=n.byteLength;if(e.byteLength!==t||n.byteOffset!==e.byteOffset)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function ave(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function hK(n,e,t,r){return(r===Xbe||r===Ybe||r===Kbe)&&(n.$$typeof||e.$$typeof)?!0:Wbe(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}const lve="[object ArrayBuffer]",cve="[object Arguments]",uve="[object Boolean]",dve="[object DataView]",hve="[object Date]",fve="[object Error]",pve="[object Map]",mve="[object Number]",gve="[object Object]",yve="[object RegExp]",xve="[object Set]",bve="[object String]",vve={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},wve="[object URL]",kve=Object.prototype.toString;function _ve({areArrayBuffersEqual:n,areArraysEqual:e,areDataViewsEqual:t,areDatesEqual:r,areErrorsEqual:s,areFunctionsEqual:i,areMapsEqual:o,areNumbersEqual:a,areObjectsEqual:l,arePrimitiveWrappersEqual:c,areRegExpsEqual:u,areSetsEqual:h,areTypedArraysEqual:f,areUrlsEqual:p,unknownTagComparators:g}){return function(v,b,w){if(v===b)return!0;if(v==null||b==null)return!1;const k=typeof v;if(k!==typeof b)return!1;if(k!=="object")return k==="number"?a(v,b,w):k==="function"?i(v,b,w):!1;const T=v.constructor;if(T!==b.constructor)return!1;if(T===Object)return l(v,b,w);if(Array.isArray(v))return e(v,b,w);if(T===Date)return r(v,b,w);if(T===RegExp)return u(v,b,w);if(T===Map)return o(v,b,w);if(T===Set)return h(v,b,w);const R=kve.call(v);if(R===hve)return r(v,b,w);if(R===yve)return u(v,b,w);if(R===pve)return o(v,b,w);if(R===xve)return h(v,b,w);if(R===gve)return typeof v.then!="function"&&typeof b.then!="function"&&l(v,b,w);if(R===wve)return p(v,b,w);if(R===fve)return s(v,b,w);if(R===cve)return l(v,b,w);if(vve[R])return f(v,b,w);if(R===lve)return n(v,b,w);if(R===dve)return t(v,b,w);if(R===uve||R===mve||R===bve)return c(v,b,w);if(g){let M=g[R];if(!M){const E=Gbe(v);E&&(M=g[E])}if(M)return M(v,b,w)}return!1}}function Sve({circular:n,createCustomConfig:e,strict:t}){let r={areArrayBuffersEqual:Jbe,areArraysEqual:t?vy:Qbe,areDataViewsEqual:Zbe,areDatesEqual:eve,areErrorsEqual:tve,areFunctionsEqual:nve,areMapsEqual:t?hA(nO,vy):nO,areNumbersEqual:rve,areObjectsEqual:t?vy:sve,arePrimitiveWrappersEqual:ive,areRegExpsEqual:ove,areSetsEqual:t?hA(rO,vy):rO,areTypedArraysEqual:t?hA(G_,vy):G_,areUrlsEqual:ave,unknownTagComparators:void 0};if(e&&(r=Object.assign({},r,e(r))),n){const s=Z2(r.areArraysEqual),i=Z2(r.areMapsEqual),o=Z2(r.areObjectsEqual),a=Z2(r.areSetsEqual);r=Object.assign({},r,{areArraysEqual:s,areMapsEqual:i,areObjectsEqual:o,areSetsEqual:a})}return r}function Tve(n){return function(e,t,r,s,i,o,a){return n(e,t,a)}}function Ave({circular:n,comparator:e,createState:t,equals:r,strict:s}){if(t)return function(a,l){const{cache:c=n?new WeakMap:void 0,meta:u}=t();return e(a,l,{cache:c,equals:r,meta:u,strict:s})};if(n)return function(a,l){return e(a,l,{cache:new WeakMap,equals:r,meta:void 0,strict:s})};const i={cache:void 0,equals:r,meta:void 0,strict:s};return function(a,l){return e(a,l,i)}}const Eve=Tf();Tf({strict:!0});Tf({circular:!0});Tf({circular:!0,strict:!0});Tf({createInternalComparator:()=>Z0});Tf({strict:!0,createInternalComparator:()=>Z0});Tf({circular:!0,createInternalComparator:()=>Z0});Tf({circular:!0,createInternalComparator:()=>Z0,strict:!0});function Tf(n={}){const{circular:e=!1,createInternalComparator:t,createState:r,strict:s=!1}=n,i=Sve(n),o=_ve(i),a=t?t(o):Tve(o);return Ave({circular:e,comparator:o,createState:r,equals:a,strict:s})}var fK={exports:{}},pK={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gS=V,Cve=M8;function Nve(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ive=typeof Object.is=="function"?Object.is:Nve,Rve=Cve.useSyncExternalStore,Mve=gS.useRef,Pve=gS.useEffect,Lve=gS.useMemo,Dve=gS.useDebugValue;pK.useSyncExternalStoreWithSelector=function(n,e,t,r,s){var i=Mve(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Lve(function(){function l(p){if(!c){if(c=!0,u=p,p=r(p),s!==void 0&&o.hasValue){var g=o.value;if(s(g,p))return h=g}return h=p}if(g=h,Ive(u,p))return g;var y=r(p);return s!==void 0&&s(g,y)?(u=p,g):(u=p,h=y)}var c=!1,u,h,f=t===void 0?null:t;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,t,r,s]);var a=Rve(n,i[0],i[1]);return Pve(function(){o.hasValue=!0,o.value=a},[a]),Dve(a),a};fK.exports=pK;var mK=fK.exports;const Q7e=xw(mK);var jve=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},Ove=({contentComponent:n})=>{const e=M8.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return d.jsx(d.Fragment,{children:Object.values(e)})};function Fve(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,r){e={...e,[t]:$te.createPortal(r.reactElement,r.element,t)},n.forEach(s=>s())},removeRenderer(t){const r={...e};delete r[t],e=r,n.forEach(s=>s())}}}var zve=class extends nt.Component{constructor(n){var e;super(n),this.editorContentRef=nt.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=n.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var n;const e=this.props.editor;if(e&&!e.isDestroyed&&((n=e.view.dom)!=null&&n.parentNode)){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:t}),e.contentComponent=Fve(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var n;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((n=e.view.dom)!=null&&n.parentNode))return;const t=document.createElement("div");t.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:t})}catch{}}}render(){const{editor:n,innerRef:e,...t}=this.props;return d.jsxs(d.Fragment,{children:[d.jsx("div",{ref:jve(e,this.editorContentRef),...t}),(n==null?void 0:n.contentComponent)&&d.jsx(Ove,{contentComponent:n.contentComponent})]})}},Bve=V.forwardRef((n,e)=>{const t=nt.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return nt.createElement(zve,{key:t,innerRef:e,...n})}),$ve=nt.memo(Bve),Vve=typeof window<"u"?V.useLayoutEffect:V.useEffect,Uve=class{constructor(n){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=n,this.lastSnapshot={editor:n,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(n){return this.subscribers.add(n),()=>{this.subscribers.delete(n)}}watch(n){if(this.editor=n,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(r=>r())},t=this.editor;return t.on("transaction",e),()=>{t.off("transaction",e)}}}};function Hve(n){var e;const[t]=V.useState(()=>new Uve(n.editor)),r=mK.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!=null?e:Eve);return Vve(()=>t.watch(n.editor),[n.editor,t]),V.useDebugValue(r),r}var qve=!1,wC=typeof window>"u",Gve=wC||!!(typeof window<"u"&&window.next),Wve=class gK{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?wC||Gve?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)==null?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)==null?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)==null?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)==null?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)==null?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)==null?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)==null?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)==null?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)==null?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)==null?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)==null?void 0:i.call(s,...r)},onDelete:(...r)=>{var s,i;return(i=(s=this.options.current).onDelete)==null?void 0:i.call(s,...r)}};return new Pbe(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=t.extensions)==null?void 0:o[i])}):e[r]===t[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?gK.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function Kve(n={},e=[]){const t=V.useRef(n);t.current=n;const[r]=V.useState(()=>new Wve(t)),s=M8.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return V.useDebugValue(s),V.useEffect(r.onRender(e)),Hve({editor:s,selector:({transactionNumber:i})=>n.shouldRerenderOnTransaction===!1||n.shouldRerenderOnTransaction===void 0?null:n.immediatelyRender&&i===0?0:i+1}),s}var Yve=V.createContext({editor:null});Yve.Consumer;var Xve=V.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),Jve=()=>V.useContext(Xve);nt.forwardRef((n,e)=>{const{onDragStart:t}=Jve(),r=n.as||"div";return d.jsx(r,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});nt.createContext({markViewContentRef:()=>{}});var W_=(n,e)=>{if(n==="slot")return 0;if(n instanceof Function)return n(e);const{children:t,...r}=e??{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,r,t]},Qve=/^\s*>\s$/,Zve=ba.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return W_("blockquote",{...ns(this.options.HTMLAttributes,n),children:W_("slot",{})})},parseMarkdown:(n,e)=>e.createNode("blockquote",void 0,e.parseChildren(n.tokens||[])),renderMarkdown:(n,e)=>{if(!n.content)return"";const t=">",r=[];return n.content.forEach(s=>{const a=e.renderChildren([s]).split(`
`).map(l=>l.trim()===""?t:`${t} ${l}`);r.push(a.join(`
`))}),r.join(`
${t}
`)},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[B1({find:Qve,type:this.type})]}}),ewe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,twe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,nwe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,rwe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,swe=Q0.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return W_("strong",{...ns(this.options.HTMLAttributes,n),children:W_("slot",{})})},markdownTokenName:"strong",parseMarkdown:(n,e)=>e.applyMark("bold",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`**${e.renderChildren(n)}**`,addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[z1({find:ewe,type:this.type}),z1({find:nwe,type:this.type})]},addPasteRules(){return[D0({find:twe,type:this.type}),D0({find:rwe,type:this.type})]}}),iwe=/(^|[^`])`([^`]+)`(?!`)$/,owe=/(^|[^`])`([^`]+)`(?!`)/g,awe=Q0.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",ns(this.options.HTMLAttributes,n),0]},markdownTokenName:"codespan",parseMarkdown:(n,e)=>e.applyMark("code",[{type:"text",text:n.text||""}]),renderMarkdown:(n,e)=>n.content?`\`${e.renderChildren(n.content)}\``:"",addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[z1({find:iwe,type:this.type})]},addPasteRules(){return[D0({find:owe,type:this.type})]}}),fA=4,lwe=/^```([a-z]+)?[\s\n]$/,cwe=/^~~~([a-z]+)?[\s\n]$/,uwe=ba.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:fA,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var e;const{languageClassPrefix:t}=this.options;if(!t)return null;const i=[...((e=n.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:e}){return["pre",ns(this.options.HTMLAttributes,e),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(n,e)=>{var t;return((t=n.raw)==null?void 0:t.startsWith("```"))===!1&&n.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:n.lang||null},n.text?[e.createTextNode(n.text)]:[])},renderMarkdown:(n,e)=>{var t;let r="";const s=((t=n.attrs)==null?void 0:t.language)||"";return n.content?r=[`\`\`\`${s}`,e.renderChildren(n.content),"```"].join(`
`):r=`\`\`\`${s}

\`\`\``,r},addCommands(){return{setCodeBlock:n=>({commands:e})=>e.setNode(this.name,n),toggleCodeBlock:n=>({commands:e})=>e.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!n||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:n})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:fA,{state:r}=n,{selection:s}=r,{$from:i,empty:o}=s;if(i.parent.type!==this.type)return!1;const a=" ".repeat(t);return o?n.commands.insertContent(a):n.commands.command(({tr:l})=>{const{from:c,to:u}=s,p=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(g=>a+g).join(`
`);return l.replaceWith(c,u,r.schema.text(p)),!0})},"Shift-Tab":({editor:n})=>{var e;if(!this.options.enableTabIndentation)return!1;const t=(e=this.options.tabSize)!=null?e:fA,{state:r}=n,{selection:s}=r,{$from:i,empty:o}=s;return i.parent.type!==this.type?!1:o?n.commands.command(({tr:a})=>{var l;const{pos:c}=i,u=i.start(),h=i.end(),p=r.doc.textBetween(u,h,`
`,`
`).split(`
`);let g=0,y=0;const v=c-u;for(let M=0;M<p.length;M+=1){if(y+p[M].length>=v){g=M;break}y+=p[M].length+1}const w=((l=p[g].match(/^ */))==null?void 0:l[0])||"",k=Math.min(w.length,t);if(k===0)return!0;let T=u;for(let M=0;M<g;M+=1)T+=p[M].length+1;return a.delete(T,T+k),c-T<=k&&a.setSelection(_t.create(a.doc,T)),!0}):n.commands.command(({tr:a})=>{const{from:l,to:c}=s,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(p=>{var g;const y=((g=p.match(/^ */))==null?void 0:g[0])||"",v=Math.min(y.length,t);return p.slice(v)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=n,{selection:t}=e,{$from:r,empty:s}=t;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:n.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=n,{selection:t,doc:r}=e,{$from:s,empty:i}=t;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?n.commands.command(({tr:c})=>(c.setSelection(Bt.near(r.resolve(a))),!0)):n.commands.exitCode()}}},addInputRules(){return[bC({find:lwe,type:this.type,getAttributes:n=>({language:n[1]})}),bC({find:cwe,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new _r({key:new bs("codeBlockVSCodeHandler"),props:{handlePaste:(n,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!t||!i)return!1;const{tr:o,schema:a}=n.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(_t.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),n.dispatch(o),!0}}})]}}),dwe=ba.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`

`):""}),hwe=ba.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",ns(this.options.HTMLAttributes,n)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:r})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:s,storedMarks:i}=t;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(f=>a.includes(f.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),fwe=ba.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:e}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,ns(this.options.HTMLAttributes,e),0]},parseMarkdown:(n,e)=>e.createNode("heading",{level:n.depth||1},e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>{var t;const r=(t=n.attrs)!=null&&t.level?parseInt(n.attrs.level,10):1,s="#".repeat(r);return n.content?`${s} ${e.renderChildren(n.content)}`:""},addCommands(){return{setHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.setNode(this.name,n):!1,toggleHeading:n=>({commands:e})=>this.options.levels.includes(n.level)?e.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,e)=>({...n,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(n=>bC({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}}),pwe=ba.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",ns(this.options.HTMLAttributes,n)]},markdownTokenName:"hr",parseMarkdown:(n,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:n,state:e})=>{if(!Dbe(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$to:r}=t,s=n();return KW(t)?s.insertContentAt(r.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({state:i,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(_t.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(rt.create(o.doc,l.pos)):o.setSelection(_t.create(o.doc,l.pos));else{const u=i.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,h=u==null?void 0:u.create();h&&(o.insert(c,h),o.setSelection(_t.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Lbe({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),mwe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,gwe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,ywe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,xwe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,bwe=Q0.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",ns(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(n,e)=>e.applyMark("italic",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`*${e.renderChildren(n)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[z1({find:mwe,type:this.type}),z1({find:ywe,type:this.type})]},addPasteRules(){return[D0({find:gwe,type:this.type}),D0({find:xwe,type:this.type})]}});const vwe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",wwe="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",kC="numeric",_C="ascii",SC="alpha",Fx="asciinumeric",Xy="alphanumeric",TC="domain",yK="emoji",kwe="scheme",_we="slashscheme",pA="whitespace";function Swe(n,e){return n in e||(e[n]=[]),e[n]}function rp(n,e,t){e[kC]&&(e[Fx]=!0,e[Xy]=!0),e[_C]&&(e[Fx]=!0,e[SC]=!0),e[Fx]&&(e[Xy]=!0),e[SC]&&(e[Xy]=!0),e[Xy]&&(e[TC]=!0),e[yK]&&(e[TC]=!0);for(const r in e){const s=Swe(r,t);s.indexOf(n)<0&&s.push(n)}}function Twe(n,e){const t={};for(const r in e)e[r].indexOf(n)>=0&&(t[r]=!0);return t}function To(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}To.groups={};To.prototype={accepts(){return!!this.t},go(n){const e=this,t=e.j[n];if(t)return t;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(n))return i}return e.jd},has(n,e=!1){return e?n in this.j:!!this.go(n)},ta(n,e,t,r){for(let s=0;s<n.length;s++)this.tt(n[s],e,t,r)},tr(n,e,t,r){r=r||To.groups;let s;return e&&e.j?s=e:(s=new To(e),t&&r&&rp(e,t,r)),this.jr.push([n,s]),s},ts(n,e,t,r){let s=this;const i=n.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(n[o]);return s.tt(n[i-1],e,t,r)},tt(n,e,t,r){r=r||To.groups;const s=this;if(e&&e.j)return s.j[n]=e,e;const i=e;let o,a=s.go(n);if(a?(o=new To,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new To,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(Twe(o.t,r),t);rp(i,l,r)}else t&&rp(i,t,r);o.t=i}return s.j[n]=o,o}};const Ft=(n,e,t,r,s)=>n.ta(e,t,r,s),Cr=(n,e,t,r,s)=>n.tr(e,t,r,s),sO=(n,e,t,r,s)=>n.ts(e,t,r,s),ke=(n,e,t,r,s)=>n.tt(e,t,r,s),tu="WORD",AC="UWORD",xK="ASCIINUMERICAL",bK="ALPHANUMERICAL",Ob="LOCALHOST",EC="TLD",CC="UTLD",X4="SCHEME",vm="SLASH_SCHEME",cR="NUM",NC="WS",uR="NL",zx="OPENBRACE",Bx="CLOSEBRACE",K_="OPENBRACKET",Y_="CLOSEBRACKET",X_="OPENPAREN",J_="CLOSEPAREN",Q_="OPENANGLEBRACKET",Z_="CLOSEANGLEBRACKET",e5="FULLWIDTHLEFTPAREN",t5="FULLWIDTHRIGHTPAREN",n5="LEFTCORNERBRACKET",r5="RIGHTCORNERBRACKET",s5="LEFTWHITECORNERBRACKET",i5="RIGHTWHITECORNERBRACKET",o5="FULLWIDTHLESSTHAN",a5="FULLWIDTHGREATERTHAN",l5="AMPERSAND",c5="APOSTROPHE",u5="ASTERISK",jd="AT",d5="BACKSLASH",h5="BACKTICK",f5="CARET",qd="COLON",dR="COMMA",p5="DOLLAR",Zl="DOT",m5="EQUALS",hR="EXCLAMATION",Na="HYPHEN",$x="PERCENT",g5="PIPE",y5="PLUS",x5="POUND",Vx="QUERY",fR="QUOTE",vK="FULLWIDTHMIDDLEDOT",pR="SEMI",ec="SLASH",Ux="TILDE",b5="UNDERSCORE",wK="EMOJI",v5="SYM";var kK=Object.freeze({__proto__:null,ALPHANUMERICAL:bK,AMPERSAND:l5,APOSTROPHE:c5,ASCIINUMERICAL:xK,ASTERISK:u5,AT:jd,BACKSLASH:d5,BACKTICK:h5,CARET:f5,CLOSEANGLEBRACKET:Z_,CLOSEBRACE:Bx,CLOSEBRACKET:Y_,CLOSEPAREN:J_,COLON:qd,COMMA:dR,DOLLAR:p5,DOT:Zl,EMOJI:wK,EQUALS:m5,EXCLAMATION:hR,FULLWIDTHGREATERTHAN:a5,FULLWIDTHLEFTPAREN:e5,FULLWIDTHLESSTHAN:o5,FULLWIDTHMIDDLEDOT:vK,FULLWIDTHRIGHTPAREN:t5,HYPHEN:Na,LEFTCORNERBRACKET:n5,LEFTWHITECORNERBRACKET:s5,LOCALHOST:Ob,NL:uR,NUM:cR,OPENANGLEBRACKET:Q_,OPENBRACE:zx,OPENBRACKET:K_,OPENPAREN:X_,PERCENT:$x,PIPE:g5,PLUS:y5,POUND:x5,QUERY:Vx,QUOTE:fR,RIGHTCORNERBRACKET:r5,RIGHTWHITECORNERBRACKET:i5,SCHEME:X4,SEMI:pR,SLASH:ec,SLASH_SCHEME:vm,SYM:v5,TILDE:Ux,TLD:EC,UNDERSCORE:b5,UTLD:CC,UWORD:AC,WORD:tu,WS:NC});const Qc=/[a-z]/,wy=new RegExp("\\p{L}","u"),mA=new RegExp("\\p{Emoji}","u"),Zc=/\d/,gA=/\s/,iO="\r",yA=`
`,Awe="",Ewe="",xA="";let e4=null,t4=null;function Cwe(n=[]){const e={};To.groups=e;const t=new To;e4==null&&(e4=oO(vwe)),t4==null&&(t4=oO(wwe)),ke(t,"'",c5),ke(t,"{",zx),ke(t,"}",Bx),ke(t,"[",K_),ke(t,"]",Y_),ke(t,"(",X_),ke(t,")",J_),ke(t,"<",Q_),ke(t,">",Z_),ke(t,"",e5),ke(t,"",t5),ke(t,"",n5),ke(t,"",r5),ke(t,"",s5),ke(t,"",i5),ke(t,"",o5),ke(t,"",a5),ke(t,"&",l5),ke(t,"*",u5),ke(t,"@",jd),ke(t,"`",h5),ke(t,"^",f5),ke(t,":",qd),ke(t,",",dR),ke(t,"$",p5),ke(t,".",Zl),ke(t,"=",m5),ke(t,"!",hR),ke(t,"-",Na),ke(t,"%",$x),ke(t,"|",g5),ke(t,"+",y5),ke(t,"#",x5),ke(t,"?",Vx),ke(t,'"',fR),ke(t,"/",ec),ke(t,";",pR),ke(t,"~",Ux),ke(t,"_",b5),ke(t,"\\",d5),ke(t,"",vK);const r=Cr(t,Zc,cR,{[kC]:!0});Cr(r,Zc,r);const s=Cr(r,Qc,xK,{[Fx]:!0}),i=Cr(r,wy,bK,{[Xy]:!0}),o=Cr(t,Qc,tu,{[_C]:!0});Cr(o,Zc,s),Cr(o,Qc,o),Cr(s,Zc,s),Cr(s,Qc,s);const a=Cr(t,wy,AC,{[SC]:!0});Cr(a,Qc),Cr(a,Zc,i),Cr(a,wy,a),Cr(i,Zc,i),Cr(i,Qc),Cr(i,wy,i);const l=ke(t,yA,uR,{[pA]:!0}),c=ke(t,iO,NC,{[pA]:!0}),u=Cr(t,gA,NC,{[pA]:!0});ke(t,xA,u),ke(c,yA,l),ke(c,xA,u),Cr(c,gA,u),ke(u,iO),ke(u,yA),Cr(u,gA,u),ke(u,xA,u);const h=Cr(t,mA,wK,{[yK]:!0});ke(h,"#"),Cr(h,mA,h),ke(h,Awe,h);const f=ke(h,Ewe);ke(f,"#"),Cr(f,mA,h);const p=[[Qc,o],[Zc,s]],g=[[Qc,null],[wy,a],[Zc,i]];for(let y=0;y<e4.length;y++)Ed(t,e4[y],EC,tu,p);for(let y=0;y<t4.length;y++)Ed(t,t4[y],CC,AC,g);rp(EC,{tld:!0,ascii:!0},e),rp(CC,{utld:!0,alpha:!0},e),Ed(t,"file",X4,tu,p),Ed(t,"mailto",X4,tu,p),Ed(t,"http",vm,tu,p),Ed(t,"https",vm,tu,p),Ed(t,"ftp",vm,tu,p),Ed(t,"ftps",vm,tu,p),rp(X4,{scheme:!0,ascii:!0},e),rp(vm,{slashscheme:!0,ascii:!0},e),n=n.sort((y,v)=>y[0]>v[0]?1:-1);for(let y=0;y<n.length;y++){const v=n[y][0],w=n[y][1]?{[kwe]:!0}:{[_we]:!0};v.indexOf("-")>=0?w[TC]=!0:Qc.test(v)?Zc.test(v)?w[Fx]=!0:w[_C]=!0:w[kC]=!0,sO(t,v,v,w)}return sO(t,"localhost",Ob,{ascii:!0}),t.jd=new To(v5),{start:t,tokens:Object.assign({groups:e},kK)}}function _K(n,e){const t=Nwe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=t.length,s=[];let i=0,o=0;for(;o<r;){let a=n,l=null,c=0,u=null,h=-1,f=-1;for(;o<r&&(l=a.go(t[o]));)a=l,a.accepts()?(h=0,f=0,u=a):h>=0&&(h+=t[o].length,f++),c+=t[o].length,i+=t[o].length,o++;i-=h,o-=f,c-=h,s.push({t:u.t,v:e.slice(i-c,i),s:i-c,e:i})}return s}function Nwe(n){const e=[],t=n.length;let r=0;for(;r<t;){let s=n.charCodeAt(r),i,o=s<55296||s>56319||r+1===t||(i=n.charCodeAt(r+1))<56320||i>57343?n[r]:n.slice(r,r+2);e.push(o),r+=o.length}return e}function Ed(n,e,t,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];n.j[l]?i=n.j[l]:(i=new To(r),i.jr=s.slice(),n.j[l]=i),n=i}return i=new To(t),i.jr=s.slice(),n.j[e[o-1]]=i,i}function oO(n){const e=[],t=[];let r=0,s="0123456789";for(;r<n.length;){let i=0;for(;s.indexOf(n[r+i])>=0;)i++;if(i>0){e.push(t.join(""));for(let o=parseInt(n.substring(r,r+i),10);o>0;o--)t.pop();r+=i}else t.push(n[r]),r++}return e}const Fb={defaultProtocol:"http",events:null,format:aO,formatHref:aO,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function mR(n,e=null){let t=Object.assign({},Fb);n&&(t=Object.assign(t,n instanceof mR?n.o:n));const r=t.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=s}mR.prototype={o:Fb,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,e,t){const r=e!=null;let s=this.o[n];return s&&(typeof s=="object"?(s=t.t in s?s[t.t]:Fb[n],typeof s=="function"&&r&&(s=s(e,t))):typeof s=="function"&&r&&(s=s(e,t.t,t)),s)},getObj(n,e,t){let r=this.o[n];return typeof r=="function"&&e!=null&&(r=r(e,t.t,t)),r},render(n){const e=n.render(this);return(this.get("render",null,n)||this.defaultRender)(e,n.t,n)}};function aO(n){return n}function SK(n,e){this.t="token",this.v=n,this.tk=e}SK.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){const e=this.toString(),t=n.get("truncate",e,this),r=n.get("format",e,this);return t&&r.length>t?r.substring(0,t)+"":r},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=Fb.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){const e=this,t=this.toHref(n.get("defaultProtocol")),r=n.get("formatHref",t,this),s=n.get("tagName",t,e),i=this.toFormattedString(n),o={},a=n.get("className",t,e),l=n.get("target",t,e),c=n.get("rel",t,e),u=n.getObj("attributes",t,e),h=n.getObj("events",t,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:s,attributes:o,content:i,eventListeners:h}}};function yS(n,e){class t extends SK{constructor(s,i){super(s,i),this.t=n}}for(const r in e)t.prototype[r]=e[r];return t.t=n,t}const lO=yS("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),cO=yS("text"),Iwe=yS("nl"),n4=yS("url",{isLink:!0,toHref(n=Fb.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){const n=this.tk;return n.length>=2&&n[0].t!==Ob&&n[1].t===qd}}),Aa=n=>new To(n);function Rwe({groups:n}){const e=n.domain.concat([l5,u5,jd,d5,h5,f5,p5,m5,Na,cR,$x,g5,y5,x5,ec,v5,Ux,b5]),t=[c5,qd,dR,Zl,hR,$x,Vx,fR,pR,Q_,Z_,zx,Bx,Y_,K_,X_,J_,e5,t5,n5,r5,s5,i5,o5,a5],r=[l5,c5,u5,d5,h5,f5,p5,m5,Na,zx,Bx,$x,g5,y5,x5,Vx,ec,v5,Ux,b5],s=Aa(),i=ke(s,Ux);Ft(i,r,i),Ft(i,n.domain,i);const o=Aa(),a=Aa(),l=Aa();Ft(s,n.domain,o),Ft(s,n.scheme,a),Ft(s,n.slashscheme,l),Ft(o,r,i),Ft(o,n.domain,o);const c=ke(o,jd);ke(i,jd,c),ke(a,jd,c),ke(l,jd,c);const u=ke(i,Zl);Ft(u,r,i),Ft(u,n.domain,i);const h=Aa();Ft(c,n.domain,h),Ft(h,n.domain,h);const f=ke(h,Zl);Ft(f,n.domain,h);const p=Aa(lO);Ft(f,n.tld,p),Ft(f,n.utld,p),ke(c,Ob,p);const g=ke(h,Na);ke(g,Na,g),Ft(g,n.domain,h),Ft(p,n.domain,h),ke(p,Zl,f),ke(p,Na,g);const y=ke(p,qd);Ft(y,n.numeric,lO);const v=ke(o,Na),b=ke(o,Zl);ke(v,Na,v),Ft(v,n.domain,o),Ft(b,r,i),Ft(b,n.domain,o);const w=Aa(n4);Ft(b,n.tld,w),Ft(b,n.utld,w),Ft(w,n.domain,o),Ft(w,r,i),ke(w,Zl,b),ke(w,Na,v),ke(w,jd,c);const k=ke(w,qd),T=Aa(n4);Ft(k,n.numeric,T);const R=Aa(n4),M=Aa();Ft(R,e,R),Ft(R,t,M),Ft(M,e,R),Ft(M,t,M),ke(w,ec,R),ke(T,ec,R);const E=ke(a,qd),I=ke(l,qd),S=ke(I,ec),N=ke(S,ec);Ft(a,n.domain,o),ke(a,Zl,b),ke(a,Na,v),Ft(l,n.domain,o),ke(l,Zl,b),ke(l,Na,v),Ft(E,n.domain,R),ke(E,ec,R),ke(E,Vx,R),Ft(N,n.domain,R),Ft(N,e,R),ke(N,ec,R);const P=[[zx,Bx],[K_,Y_],[X_,J_],[Q_,Z_],[e5,t5],[n5,r5],[s5,i5],[o5,a5]];for(let O=0;O<P.length;O++){const[D,G]=P[O],J=ke(R,D);ke(M,D,J),ke(J,G,R);const Q=Aa(n4);Ft(J,e,Q);const re=Aa();Ft(J,t),Ft(Q,e,Q),Ft(Q,t,re),Ft(re,e,Q),Ft(re,t,re),ke(Q,G,R),ke(re,G,R)}return ke(s,Ob,w),ke(s,uR,Iwe),{start:s,tokens:kK}}function Mwe(n,e,t){let r=t.length,s=0,i=[],o=[];for(;s<r;){let a=n,l=null,c=null,u=0,h=null,f=-1;for(;s<r&&!(l=a.go(t[s].t));)o.push(t[s++]);for(;s<r&&(c=l||a.go(t[s].t));)l=null,a=c,a.accepts()?(f=0,h=a):f>=0&&f++,s++,u++;if(f<0)s-=u,s<r&&(o.push(t[s]),s++);else{o.length>0&&(i.push(bA(cO,e,o)),o=[]),s-=f,u-=f;const p=h.t,g=t.slice(s-u,s);i.push(bA(p,e,g))}}return o.length>0&&i.push(bA(cO,e,o)),i}function bA(n,e,t){const r=t[0].s,s=t[t.length-1].e,i=e.slice(r,s);return new n(i,t)}const Pwe=typeof console<"u"&&console&&console.warn||(()=>{}),Lwe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Qn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Dwe(){return To.groups={},Qn.scanner=null,Qn.parser=null,Qn.tokenQueue=[],Qn.pluginQueue=[],Qn.customSchemes=[],Qn.initialized=!1,Qn}function uO(n,e=!1){if(Qn.initialized&&Pwe(`linkifyjs: already initialized - will not register custom scheme "${n}" ${Lwe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(n))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Qn.customSchemes.push([n,e])}function jwe(){Qn.scanner=Cwe(Qn.customSchemes);for(let n=0;n<Qn.tokenQueue.length;n++)Qn.tokenQueue[n][1]({scanner:Qn.scanner});Qn.parser=Rwe(Qn.scanner.tokens);for(let n=0;n<Qn.pluginQueue.length;n++)Qn.pluginQueue[n][1]({scanner:Qn.scanner,parser:Qn.parser});return Qn.initialized=!0,Qn}function gR(n){return Qn.initialized||jwe(),Mwe(Qn.parser.start,n,_K(Qn.scanner.start,n))}gR.scan=_K;function TK(n,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const r=new mR(t),s=gR(n),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}var yR="[\0- -\u2029]",Owe=new RegExp(yR),Fwe=new RegExp(`${yR}$`),zwe=new RegExp(yR,"g");function Bwe(n){return n.length===1?n[0].isLink:n.length===3&&n[1].isLink?["()","[]"].includes(n[0].value+n[2].value):!1}function $we(n){return new _r({key:new bs("autolink"),appendTransaction:(e,t,r)=>{const s=e.some(c=>c.docChanged)&&!t.doc.eq(r.doc),i=e.some(c=>c.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=BW(t.doc,[...e]);if(WW(a).forEach(({newRange:c})=>{const u=Dxe(r.doc,c,p=>p.isTextblock);let h,f;if(u.length>1)h=u[0],f=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(u.length){const p=r.doc.textBetween(c.from,c.to," "," ");if(!Fwe.test(p))return;h=u[0],f=r.doc.textBetween(h.pos,c.to,void 0," ")}if(h&&f){const p=f.split(Owe).filter(Boolean);if(p.length<=0)return!1;const g=p[p.length-1],y=h.pos+f.lastIndexOf(g);if(!g)return!1;const v=gR(g).map(b=>b.toObject(n.defaultProtocol));if(!Bwe(v))return!1;v.filter(b=>b.isLink).map(b=>({...b,from:y+b.start+1,to:y+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>n.validate(b.value)).filter(b=>n.shouldAutoLink(b.value)).forEach(b=>{sR(b.from,b.to,r.doc).some(w=>w.mark.type===n.type)||o.addMark(b.from,b.to,n.type.create({href:b.href}))})}}),!!o.steps.length)return o}})}function Vwe(n){return new _r({key:new bs("handleClickLink"),props:{handleClick:(e,t,r)=>{var s,i;if(r.button!==0||!e.editable)return!1;let o=!1;if(n.enableClickSelection&&(o=n.editor.commands.extendMarkRange(n.type.name)),n.openOnClick){let a=null;if(r.target instanceof HTMLAnchorElement)a=r.target;else{let h=r.target;const f=[];for(;h.nodeName!=="DIV";)f.push(h),h=h.parentNode;a=f.find(p=>p.nodeName==="A")}if(!a)return o;const l=GW(e.state,n.type.name),c=(s=a==null?void 0:a.href)!=null?s:l.href,u=(i=a==null?void 0:a.target)!=null?i:l.target;a&&c&&(window.open(c,u),o=!0)}return o}}})}function Uwe(n){return new _r({key:new bs("handlePasteLink"),props:{handlePaste:(e,t,r)=>{const{shouldAutoLink:s}=n,{state:i}=e,{selection:o}=i,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=TK(l,{defaultProtocol:n.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||s!==void 0&&!s(c.href)?!1:n.editor.commands.setMark(n.type,{href:c.href})}}})}function Pf(n,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&t.push(s)}),!n||n.replace(zwe,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var AK=Q0.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(n=>{if(typeof n=="string"){uO(n);return}uO(n.scheme,n.optionalSlashes)})},onDestroy(){Dwe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(n,e)=>!!Pf(n,e.protocols),validate:n=>!!n,shouldAutoLink:n=>!!n}},addAttributes(){return{href:{default:null,parseHTML(n){return n.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:n=>{const e=n.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!Pf(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:n}){return this.options.isAllowedUri(n.href,{defaultValidate:e=>!!Pf(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ns(this.options.HTMLAttributes,n),0]:["a",ns(this.options.HTMLAttributes,{...n,href:""}),0]},markdownTokenName:"link",parseMarkdown:(n,e)=>e.applyMark("link",e.parseInline(n.tokens||[]),{href:n.href,title:n.title||null}),renderMarkdown:(n,e)=>{var t;const r=((t=n.attrs)==null?void 0:t.href)||"";return`[${e.renderChildren(n)}](${r})`},addCommands(){return{setLink:n=>({chain:e})=>{const{href:t}=n;return this.options.isAllowedUri(t,{defaultValidate:r=>!!Pf(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,n).setMeta("preventAutolink",!0).run():!1},toggleLink:n=>({chain:e})=>{const{href:t}=n||{};return t&&!this.options.isAllowedUri(t,{defaultValidate:r=>!!Pf(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,n,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:n})=>n().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[D0({find:n=>{const e=[];if(n){const{protocols:t,defaultProtocol:r}=this.options,s=TK(n).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!Pf(o,t),protocols:t,defaultProtocol:r}));s.length&&s.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:n=>{var e;return{href:(e=n.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const n=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&n.push($we({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!Pf(s,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),n.push(Vwe({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&n.push(Uwe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),n}}),Hwe=AK,qwe=Object.defineProperty,Gwe=(n,e)=>{for(var t in e)qwe(n,t,{get:e[t],enumerable:!0})},Wwe="listItem",dO="textStyle",hO=/^\s*([-+*])\s$/,EK=ba.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",ns(this.options.HTMLAttributes,n),0]},markdownTokenName:"list",parseMarkdown:(n,e)=>n.type!=="list"||n.ordered?[]:{type:"bulletList",content:n.items?e.parseChildren(n.items):[]},renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Wwe,this.editor.getAttributes(dO)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=B1({find:hO,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=B1({find:hO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(dO),editor:this.editor})),[n]}}),CK=ba.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",ns(this.options.HTMLAttributes,n),0]},markdownTokenName:"list_item",parseMarkdown:(n,e)=>{if(n.type!=="list_item")return[];let t=[];if(n.tokens&&n.tokens.length>0)if(n.tokens.some(s=>s.type==="paragraph"))t=e.parseChildren(n.tokens);else{const s=n.tokens[0];if(s&&s.type==="text"&&s.tokens&&s.tokens.length>0){if(t=[{type:"paragraph",content:e.parseInline(s.tokens)}],n.tokens.length>1){const o=n.tokens.slice(1),a=e.parseChildren(o);t.push(...a)}}else t=e.parseChildren(n.tokens)}return t.length===0&&(t=[{type:"paragraph",content:[]}]),{type:"listItem",content:t}},renderMarkdown:(n,e,t)=>lR(n,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",t),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Kwe={};Gwe(Kwe,{findListItemPos:()=>t2,getNextListDepth:()=>xR,handleBackspace:()=>IC,handleDelete:()=>RC,hasListBefore:()=>NK,hasListItemAfter:()=>Ywe,hasListItemBefore:()=>IK,listItemHasSubList:()=>RK,nextListIsDeeper:()=>MK,nextListIsHigher:()=>PK});var t2=(n,e)=>{const{$from:t}=e.selection,r=ts(n,e.schema);let s=null,i=t.depth,o=t.pos,a=null;for(;i>0&&a===null;)s=t.node(i),s.type===r?a=i:(i-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},xR=(n,e)=>{const t=t2(n,e);if(!t)return!1;const[,r]=qxe(e,n,t.$pos.pos+4);return r},NK=(n,e,t)=>{const{$anchor:r}=n.selection,s=Math.max(0,r.pos-2),i=n.doc.resolve(s).node();return!(!i||!t.includes(i.type.name))},IK=(n,e)=>{var t;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-2);return!(s.index()===0||((t=s.nodeBefore)==null?void 0:t.type.name)!==n)},RK=(n,e,t)=>{if(!t)return!1;const r=ts(n,e.schema);let s=!1;return t.descendants(i=>{i.type===r&&(s=!0)}),s},IC=(n,e,t)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!cf(n.state,e)&&NK(n.state,e,t)){const{$anchor:a}=n.state.selection,l=n.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,p)=>{f.type.name===e&&c.push({node:f,pos:p})});const u=c.at(-1);if(!u)return!1;const h=n.state.doc.resolve(l.start()+u.pos+1);return n.chain().cut({from:a.start()-1,to:a.end()+1},h.end()).joinForward().run()}if(!cf(n.state,e)||!Yxe(n.state))return!1;const r=t2(e,n.state);if(!r)return!1;const i=n.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=RK(e,n.state,i);return IK(e,n.state)&&!o?n.commands.joinItemBackward():n.chain().liftListItem(e).run()},MK=(n,e)=>{const t=xR(n,e),r=t2(n,e);return!r||!t?!1:t>r.depth},PK=(n,e)=>{const t=xR(n,e),r=t2(n,e);return!r||!t?!1:t<r.depth},RC=(n,e)=>{if(!cf(n.state,e)||!Kxe(n.state,e))return!1;const{selection:t}=n.state,{$from:r,$to:s}=t;return!t.empty&&r.sameParent(s)?!1:MK(e,n.state)?n.chain().focus(n.state.selection.from+4).lift(e).joinBackward().run():PK(e,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},Ywe=(n,e)=>{var t;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-r.parentOffset-2);return!(s.index()===s.parent.childCount-1||((t=s.nodeAfter)==null?void 0:t.type.name)!==n)},LK=jr.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{n.state.schema.nodes[t]!==void 0&&RC(n,t)&&(e=!0)}),e},"Mod-Delete":({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{n.state.schema.nodes[t]!==void 0&&RC(n,t)&&(e=!0)}),e},Backspace:({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:r})=>{n.state.schema.nodes[t]!==void 0&&IC(n,t,r)&&(e=!0)}),e},"Mod-Backspace":({editor:n})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:r})=>{n.state.schema.nodes[t]!==void 0&&IC(n,t,r)&&(e=!0)}),e}}}}),fO=/^(\s*)(\d+)\.\s+(.*)$/,Xwe=/^\s/;function Jwe(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t],i=s.match(fO);if(!i)break;const[,o,a,l]=i,c=o.length;let u=l,h=t+1;const f=[s];for(;h<n.length;){const p=n[h];if(p.match(fO))break;if(p.trim()==="")f.push(p),u+=`
`,h+=1;else if(p.match(Xwe))f.push(p),u+=`
${p.slice(c+2)}`,h+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=h,t=h}return[e,r]}function DK(n,e,t){var r;const s=[];let i=0;for(;i<n.length;){const o=n[i];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:t.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const p=t.blockTokens(u);c.push(...p)}let h=i+1;const f=[];for(;h<n.length&&n[h].indent>e;)f.push(n[h]),h+=1;if(f.length>0){const p=Math.min(...f.map(y=>y.indent)),g=DK(f,p,t);c.push({type:"list",ordered:!0,start:f[0].number,items:g,raw:f.map(y=>y.raw).join(`
`)})}s.push({type:"list_item",raw:o.raw,tokens:c}),i=h}else i+=1}return s}function Qwe(n,e){return n.map(t=>{if(t.type!=="list_item")return e.parseChildren([t])[0];const r=[];return t.tokens&&t.tokens.length>0&&t.tokens.forEach(s=>{if(s.type==="paragraph"||s.type==="list"||s.type==="blockquote"||s.type==="code")r.push(...e.parseChildren([s]));else if(s.type==="text"&&s.tokens){const i=e.parseChildren([s]);r.push({type:"paragraph",content:i})}else{const i=e.parseChildren([s]);i.length>0&&r.push(...i)}}),{type:"listItem",content:r}})}var Zwe="listItem",pO="textStyle",mO=/^(\d+)\.\s$/,jK=ba.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:e,...t}=n;return e===1?["ol",ns(this.options.HTMLAttributes,t),0]:["ol",ns(this.options.HTMLAttributes,n),0]},markdownTokenName:"list",parseMarkdown:(n,e)=>{if(n.type!=="list"||!n.ordered)return[];const t=n.start||1,r=n.items?Qwe(n.items,e):[];return t!==1?{type:"orderedList",attrs:{start:t},content:r}:{type:"orderedList",content:r}},renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:n=>{const e=n.match(/^(\s*)(\d+)\.\s+/),t=e==null?void 0:e.index;return t!==void 0?t:-1},tokenize:(n,e,t)=>{var r;const s=n.split(`
`),[i,o]=Jwe(s);if(i.length===0)return;const a=DK(i,0,t);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=i[0])==null?void 0:r.number)||1,items:a,raw:s.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Zwe,this.editor.getAttributes(pO)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=B1({find:mO,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=B1({find:mO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(pO)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[n]}}),e2e=/^\s*(\[([( |x])?\])\s$/,t2e=ba.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const e=n.getAttribute("data-checked");return e===""||e==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:e}){return["li",ns(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(n,e)=>{const t=[];if(n.tokens&&n.tokens.length>0?t.push(e.createNode("paragraph",{},e.parseInline(n.tokens))):n.text?t.push(e.createNode("paragraph",{},[e.createNode("text",{text:n.text})])):t.push(e.createNode("paragraph",{},[])),n.nestedTokens&&n.nestedTokens.length>0){const r=e.parseChildren(n.nestedTokens);t.push(...r)}return e.createNode("taskItem",{checked:n.checked||!1},t)},renderMarkdown:(n,e)=>{var t;const s=`- [${(t=n.attrs)!=null&&t.checked?"x":" "}] `;return lR(n,e,s)},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:e,getPos:t,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var h,f;a.ariaLabel=((f=(h=this.options.a11y)==null?void 0:h.checkboxLabel)==null?void 0:f.call(h,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(n),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:h}=u.target;r.isEditable&&typeof t=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const p=t();if(typeof p!="number")return!1;const g=f.doc.nodeAt(p);return f.setNodeMarkup(p,void 0,{...g==null?void 0:g.attrs,checked:h}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,h)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,h])=>{s.setAttribute(u,h)}),s.dataset.checked=n.attrs.checked,a.checked=n.attrs.checked,i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,h])=>{s.setAttribute(u,h)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[B1({find:e2e,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),n2e=ba.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",ns(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},parseMarkdown:(n,e)=>e.createNode("taskList",{},e.parseChildren(n.items||[])),renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(n){var e;const t=(e=n.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return t!==void 0?t:-1},tokenize(n,e,t){const r=i=>{const o=vC(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:t.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},t);return o?[{type:"taskList",raw:o.raw,items:o.items}]:t.blockTokens(i)},s=vC(n,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,o)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:t.inlineTokens(i.mainContent),nestedTokens:o}),customNestedParser:r},t);if(s)return{type:"taskList",raw:s.raw,items:s.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});jr.create({name:"listKit",addExtensions(){const n=[];return this.options.bulletList!==!1&&n.push(EK.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(CK.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(LK.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(jK.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(t2e.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(n2e.configure(this.options.taskList)),n}});var r2e=ba.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",ns(this.options.HTMLAttributes,n),0]},parseMarkdown:(n,e)=>{const t=n.tokens||[];return t.length===1&&t[0].type==="image"?e.parseChildren([t[0]]):e.createNode("paragraph",void 0,e.parseInline(t))},renderMarkdown:(n,e)=>!n||!Array.isArray(n.content)?"":e.renderChildren(n.content),addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),s2e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,i2e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,o2e=Q0.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",ns(this.options.HTMLAttributes,n),0]},markdownTokenName:"del",parseMarkdown:(n,e)=>e.applyMark("strike",e.parseInline(n.tokens||[])),renderMarkdown:(n,e)=>`~~${e.renderChildren(n)}~~`,addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[z1({find:s2e,type:this.type})]},addPasteRules(){return[D0({find:i2e,type:this.type})]}}),a2e=ba.create({name:"text",group:"inline",parseMarkdown:n=>({type:"text",text:n.text||""}),renderMarkdown:n=>n.text||""}),OK=Q0.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",ns(this.options.HTMLAttributes,n),0]},parseMarkdown(n,e){return e.applyMark(this.name||"underline",e.parseInline(n.tokens||[]))},renderMarkdown(n,e){return`++${e.renderChildren(n)}++`},markdownTokenizer:{name:"underline",level:"inline",start(n){return n.indexOf("++")},tokenize(n,e,t){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(n);if(!s)return;const i=s[2].trim();return{type:"underline",raw:s[0],text:i,tokens:t.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),l2e=OK;function c2e(n={}){return new _r({view(e){return new u2e(e,n)}})}class u2e{constructor(e,t){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=t.width)!==null&&r!==void 0?r:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(t){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let p=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(p){let g=p.getBoundingClientRect(),y=h?g.bottom:g.top;h&&f&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let v=this.width/2*a;r={left:g.left,right:g.right,top:y-v,bottom:y+v}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let h=l.getBoundingClientRect(),f=h.width/l.offsetWidth,p=h.height/l.offsetHeight;c=h.left-l.scrollLeft*f,u=h.top-l.scrollTop*p}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,t,e):s;if(t&&!i){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=RG(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Mr extends Bt{constructor(e){super(e,e)}map(e,t){let r=e.resolve(t.map(this.head));return Mr.valid(r)?new Mr(r):Bt.near(r)}content(){return De.empty}eq(e){return e instanceof Mr&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Mr(e.resolve(t.pos))}getBookmark(){return new bR(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!d2e(e)||!h2e(e))return!1;let r=t.type.spec.allowGapCursor;if(r!=null)return r;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,r=!1){e:for(;;){if(!r&&Mr.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=t;let l=e.doc.resolve(s);if(Mr.valid(l))return l}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!rt.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*t),r=!1;continue e}break}i=o,s+=t;let a=e.doc.resolve(s);if(Mr.valid(a))return a}return null}}}Mr.prototype.visible=!1;Mr.findFrom=Mr.findGapCursorFrom;Bt.jsonID("gapcursor",Mr);class bR{constructor(e){this.pos=e}map(e){return new bR(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return Mr.valid(t)?new Mr(t):Bt.near(t)}}function FK(n){return n.isAtom||n.spec.isolating||n.spec.createGapCursor}function d2e(n){for(let e=n.depth;e>=0;e--){let t=n.index(e),r=n.node(e);if(t==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||FK(s.type))return!0;if(s.inlineContent)return!1}}return!0}function h2e(n){for(let e=n.depth;e>=0;e--){let t=n.indexAfter(e),r=n.node(e);if(t==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(t);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||FK(s.type))return!0;if(s.inlineContent)return!1}}return!0}function f2e(){return new _r({props:{decorations:y2e,createSelectionBetween(n,e,t){return e.pos==t.pos&&Mr.valid(t)?new Mr(t):null},handleClick:m2e,handleKeyDown:p2e,handleDOMEvents:{beforeinput:g2e}}})}const p2e=MW({ArrowLeft:r4("horiz",-1),ArrowRight:r4("horiz",1),ArrowUp:r4("vert",-1),ArrowDown:r4("vert",1)});function r4(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof _t){if(!i.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Mr.findGapCursorFrom(a,e,l);return c?(s&&s(r.tr.setSelection(new Mr(c))),!0):!1}}function m2e(n,e,t){if(!n||!n.editable)return!1;let r=n.state.doc.resolve(e);if(!Mr.valid(r))return!1;let s=n.posAtCoords({left:t.clientX,top:t.clientY});return s&&s.inside>-1&&rt.isSelectable(n.state.doc.nodeAt(s.inside))?!1:(n.dispatch(n.state.tr.setSelection(new Mr(r))),!0)}function g2e(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof Mr))return!1;let{$from:t}=n.state.selection,r=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!r)return!1;let s=ge.empty;for(let o=r.length-1;o>=0;o--)s=ge.from(r[o].createAndFill(null,s));let i=n.state.tr.replace(t.pos,t.pos,new De(s,0,0));return i.setSelection(_t.near(i.doc.resolve(t.pos+1))),n.dispatch(i),!1}function y2e(n){if(!(n.selection instanceof Mr))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",gr.create(n.doc,[Gi.widget(n.selection.head,e,{key:"gapcursor"})])}var w5=200,Ds=function(){};Ds.prototype.append=function(e){return e.length?(e=Ds.from(e),!this.length&&e||e.length<w5&&this.leafAppend(e)||this.length<w5&&e.leafPrepend(this)||this.appendInner(e)):this};Ds.prototype.prepend=function(e){return e.length?Ds.from(e).append(this):this};Ds.prototype.appendInner=function(e){return new x2e(this,e)};Ds.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Ds.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Ds.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ds.prototype.forEach=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length),t<=r?this.forEachInner(e,t,r,0):this.forEachInvertedInner(e,t,r,0)};Ds.prototype.map=function(e,t,r){t===void 0&&(t=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},t,r),s};Ds.from=function(e){return e instanceof Ds?e:e&&e.length?new zK(e):Ds.empty};var zK=function(n){function e(r){n.call(this),this.values=r}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=w5)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=w5)return new e(s.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(Ds);Ds.empty=new zK([]);var x2e=function(n){function e(t,r){n.call(this),this.left=t,this.right=r,this.length=t.length+r.length,this.depth=Math.max(t.depth,r.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Ds);const b2e=500;class Il{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;t&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,f)=>{if(!h.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,u.push(h);return}if(s){u.push(new tc(h.map));let p=h.step.map(s.slice(i)),g;p&&o.maybeStep(p).doc&&(g=o.mapping.maps[o.mapping.maps.length-1],c.push(new tc(g,void 0,void 0,c.length+u.length))),i--,g&&s.appendMap(g,i)}else o.maybeStep(h.step);if(h.selection)return a=s?h.selection.map(s.slice(i)):h.selection,l=new Il(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),f=new tc(e.mapping.maps[u],h,t),p;(p=l&&l.merge(f))&&(f=p,u?i.pop():a=a.slice(0,a.length-1)),i.push(f),t&&(o++,t=void 0),s||(l=f)}let c=o-r.depth;return c>w2e&&(a=v2e(a,c),o-=c),new Il(a.append(i),o)}remapping(e,t){let r=new Rb;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,t),r}addMaps(e){return this.eventCount==0?this:new Il(this.items.append(e.map(t=>new tc(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},s);let l=t;this.items.forEach(f=>{let p=i.getMirror(--l);if(p==null)return;o=Math.min(o,p);let g=i.maps[p];if(f.step){let y=e.steps[p].invert(e.docs[p]),v=f.selection&&f.selection.map(i.slice(l+1,p));v&&a++,r.push(new tc(g,y,v))}else r.push(new tc(g))},s);let c=[];for(let f=t;f<o;f++)c.push(new tc(i.maps[f]));let u=this.items.slice(0,s).append(c).append(r),h=new Il(u,a);return h.emptyItemCount()>b2e&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),r=t.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(t.slice(r)),c=l&&l.getMap();if(r--,c&&t.appendMap(c,r),l){let u=o.selection&&o.selection.map(t.slice(r));u&&i++;let h=new tc(c.invert(),l,u),f,p=s.length-1;(f=s.length&&s[p].merge(h))?s[p]=f:s.push(h)}}else o.map&&r--},this.items.length,0),new Il(Ds.from(s.reverse()),i)}}Il.empty=new Il(Ds.empty,0);function v2e(n,e){let t;return n.forEach((r,s)=>{if(r.selection&&e--==0)return t=s,!1}),n.slice(t)}class tc{constructor(e,t,r,s){this.map=e,this.step=t,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new tc(t.getMap().invert(),t,this.selection)}}}class Od{constructor(e,t,r,s,i){this.done=e,this.undone=t,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const w2e=20;function k2e(n,e,t,r){let s=t.getMeta(b0),i;if(s)return s.historyState;t.getMeta(T2e)&&(n=new Od(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(b0))return o.getMeta(b0).redo?new Od(n.done.addTransform(t,void 0,r,J4(e)),n.undone,gO(t.mapping.maps),n.prevTime,n.prevComposition):new Od(n.done,n.undone.addTransform(t,void 0,r,J4(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=a&&(n.prevTime<(t.time||0)-r.newGroupDelay||!_2e(t,n.prevRanges)),c=o?vA(n.prevRanges,t.mapping):gO(t.mapping.maps);return new Od(n.done.addTransform(t,l?e.selection.getBookmark():void 0,r,J4(e)),Il.empty,c,t.time,a??n.prevComposition)}else return(i=t.getMeta("rebased"))?new Od(n.done.rebased(t,i),n.undone.rebased(t,i),vA(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new Od(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),vA(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function _2e(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(t=!0)}),t}function gO(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((r,s,i,o)=>e.push(i,o));return e}function vA(n,e){if(!n)return null;let t=[];for(let r=0;r<n.length;r+=2){let s=e.map(n[r],1),i=e.map(n[r+1],-1);s<=i&&t.push(s,i)}return t}function S2e(n,e,t){let r=J4(e),s=b0.get(e).spec.config,i=(t?n.undone:n.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(t?n.done:n.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new Od(t?a:i.remaining,t?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(b0,{redo:t,historyState:l})}let wA=!1,yO=null;function J4(n){let e=n.plugins;if(yO!=e){wA=!1,yO=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){wA=!0;break}}return wA}const b0=new bs("history"),T2e=new bs("closeHistory");function A2e(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new _r({key:b0,state:{init(){return new Od(Il.empty,Il.empty,null,0,-1)},apply(e,t,r){return k2e(t,r,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let r=t.inputType,s=r=="historyUndo"?$K:r=="historyRedo"?VK:null;return!s||!e.editable?!1:(t.preventDefault(),s(e.state,e.dispatch))}}}})}function BK(n,e){return(t,r)=>{let s=b0.getState(t);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(r){let i=S2e(s,t,n);i&&r(e?i.scrollIntoView():i)}return!0}}const $K=BK(!1,!0),VK=BK(!0,!0);jr.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const e=(n==null?void 0:n.node)||this.editor.state.doc;if(((n==null?void 0:n.mode)||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=n=>{const e=(n==null?void 0:n.node)||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let n=!1;return[new _r({key:new bs("characterCount"),appendTransaction:(e,t,r)=>{if(n)return;const s=this.options.limit;if(s==null||s===0){n=!0;return}const i=this.storage.characters({node:r.doc});if(i>s){const o=i-s,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return n=!0,c}n=!0},filterTransaction:(e,t)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const s=this.storage.characters({node:t.doc}),i=this.storage.characters({node:e.doc});if(i<=r||s>r&&i>r&&i<=s)return!0;if(s>r&&i>r&&i>s||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=i-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var E2e=jr.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[c2e(this.options)]}});jr.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new _r({key:new bs("focus"),props:{decorations:({doc:n,selection:e})=>{const{isEditable:t,isFocused:r}=this.editor,{anchor:s}=e,i=[];if(!t||!r)return gr.create(n,[]);let o=0;this.options.mode==="deepest"&&n.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;o+=1});let a=0;return n.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";i.push(Gi.node(c,c+l.nodeSize,{class:this.options.className}))}),gr.create(n,i)}}})]}});var C2e=jr.create({name:"gapCursor",addProseMirrorPlugins(){return[f2e()]},extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=Nn(Ze(n,"allowGapCursor",t)))!=null?e:null}}}),N2e=jr.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new _r({key:new bs("placeholder"),props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!t)return null;const i=this.editor.isEmpty;return n.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&fS(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const h=Gi.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});s.push(h)}return this.options.includeChildren}),gr.create(n,s)}}})]}});jr.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:e}=this;return[new _r({key:new bs("selection"),props:{decorations(t){return t.selection.empty||n.isFocused||!n.isEditable||KW(t.selection)||n.view.dragging?null:gr.create(t.doc,[Gi.inline(t.selection.from,t.selection.to,{class:e.className})])}}})]}});function xO({types:n,node:e}){return e&&Array.isArray(n)&&n.includes(e.type)||(e==null?void 0:e.type)===n}var I2e=jr.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var n;const e=new bs(this.name),t=this.options.node||((n=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:n.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(t).includes(s.name));return[new _r({key:e,appendTransaction:(s,i,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),h=a.content.size,f=c.nodes[t];if(u)return l.insert(h,f.create())},state:{init:(s,i)=>{const o=i.tr.doc.lastChild;return!xO({node:o,types:r})},apply:(s,i)=>{if(!s.docChanged||s.getMeta("__uniqueIDTransaction"))return i;const o=s.doc.lastChild;return!xO({node:o,types:r})}}})]}}),R2e=jr.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:e})=>$K(n,e),redo:()=>({state:n,dispatch:e})=>VK(n,e)}},addProseMirrorPlugins(){return[A2e(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),M2e=jr.create({name:"starterKit",addExtensions(){var n,e,t,r;const s=[];return this.options.bold!==!1&&s.push(swe.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(Zve.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(EK.configure(this.options.bulletList)),this.options.code!==!1&&s.push(awe.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(uwe.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(dwe.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(E2e.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(C2e.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(hwe.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(fwe.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push(R2e.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(pwe.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(bwe.configure(this.options.italic)),this.options.listItem!==!1&&s.push(CK.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(LK.configure((n=this.options)==null?void 0:n.listKeymap)),this.options.link!==!1&&s.push(AK.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&s.push(jK.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(r2e.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(o2e.configure(this.options.strike)),this.options.text!==!1&&s.push(a2e.configure(this.options.text)),this.options.underline!==!1&&s.push(OK.configure((t=this.options)==null?void 0:t.underline)),this.options.trailingNode!==!1&&s.push(I2e.configure((r=this.options)==null?void 0:r.trailingNode)),s}}),P2e=M2e,L2e=jr.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:n=>{const e=n.style.textAlign;return this.options.alignments.includes(e)?e:this.options.defaultAlignment},renderHTML:n=>n.textAlign?{style:`text-align: ${n.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:n=>({commands:e})=>this.options.alignments.includes(n)?this.options.types.map(t=>e.updateAttributes(t,{textAlign:n})).some(t=>t):!1,unsetTextAlign:()=>({commands:n})=>this.options.types.map(e=>n.resetAttributes(e,"textAlign")).some(e=>e),toggleTextAlign:n=>({editor:e,commands:t})=>this.options.alignments.includes(n)?e.isActive({textAlign:n})?t.unsetTextAlign():t.setTextAlign(n):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),D2e=L2e,j2e=N2e;const Ea=({icon:n,action:e,isActive:t,title:r})=>d.jsx("button",{type:"button",onClick:e,className:`rte-toolbar-btn ${t?"active":""}`,title:r,children:d.jsx(n,{className:"w-4 h-4"})}),ky=()=>d.jsx("div",{className:"rte-toolbar-separator"}),O2e=({editor:n})=>{const[e,t]=V.useState(""),[r,s]=V.useState(!1),i=V.useCallback(()=>{if(e){const a=e.match(/^https?:\/\//)?e:`https://${e}`;n.chain().focus().extendMarkRange("link").setLink({href:a}).run()}else n.chain().focus().extendMarkRange("link").unsetLink().run();s(!1),t("")},[n,e]),o=()=>{const a=n.getAttributes("link").href||"";t(a),s(!0)};return d.jsxs("div",{className:"rte-toolbar",children:[d.jsx(Ea,{editor:n,name:"bold",icon:vpe,action:()=>n.chain().focus().toggleBold().run(),isActive:n.isActive("bold"),title:" (Ctrl+B)"}),d.jsx(Ea,{editor:n,name:"italic",icon:wpe,action:()=>n.chain().focus().toggleItalic().run(),isActive:n.isActive("italic"),title:" (Ctrl+I)"}),d.jsx(Ea,{editor:n,name:"underline",icon:kpe,action:()=>n.chain().focus().toggleUnderline().run(),isActive:n.isActive("underline"),title:"  (Ctrl+U)"}),d.jsx(ky,{}),d.jsx(Ea,{editor:n,name:"h2",icon:_pe,action:()=>n.chain().focus().toggleHeading({level:2}).run(),isActive:n.isActive("heading",{level:2}),title:" 2"}),d.jsx(Ea,{editor:n,name:"h3",icon:Spe,action:()=>n.chain().focus().toggleHeading({level:3}).run(),isActive:n.isActive("heading",{level:3}),title:" 3"}),d.jsx(ky,{}),d.jsx(Ea,{editor:n,name:"bulletList",icon:p0,action:()=>n.chain().focus().toggleBulletList().run(),isActive:n.isActive("bulletList"),title:""}),d.jsx(Ea,{editor:n,name:"orderedList",icon:Tpe,action:()=>n.chain().focus().toggleOrderedList().run(),isActive:n.isActive("orderedList"),title:" "}),d.jsx(ky,{}),r?d.jsxs("div",{className:"flex items-center gap-1 bg-white rounded-lg px-2 py-1 border border-slate-200",children:[d.jsx("input",{type:"text",value:e,onChange:a=>t(a.target.value),onKeyDown:a=>{a.key==="Enter"?(a.preventDefault(),i()):a.key==="Escape"&&(s(!1),t(""))},placeholder:"  URL...",className:"text-sm border-none outline-none bg-transparent w-40 px-1",autoFocus:!0,dir:"ltr"}),d.jsx("button",{type:"button",onClick:i,className:"text-xs bg-blue-500 text-white px-2 py-0.5 rounded hover:bg-blue-600",children:""}),d.jsx("button",{type:"button",onClick:()=>{s(!1),t("")},className:"text-xs text-slate-500 hover:text-slate-700",children:""})]}):d.jsx(Ea,{editor:n,name:"link",icon:I_,action:o,isActive:n.isActive("link"),title:" (Ctrl+K)"}),d.jsx(ky,{}),d.jsx(Ea,{editor:n,name:"alignRight",icon:Ape,action:()=>n.chain().focus().setTextAlign("right").run(),isActive:n.isActive({textAlign:"right"}),title:" "}),d.jsx(Ea,{editor:n,name:"alignCenter",icon:Epe,action:()=>n.chain().focus().setTextAlign("center").run(),isActive:n.isActive({textAlign:"center"}),title:" "}),d.jsx(Ea,{editor:n,name:"alignLeft",icon:Cpe,action:()=>n.chain().focus().setTextAlign("left").run(),isActive:n.isActive({textAlign:"left"}),title:" "}),d.jsx(ky,{}),d.jsx(Ea,{editor:n,name:"clear",icon:Npe,action:()=>n.chain().focus().clearNodes().unsetAllMarks().run(),isActive:!1,title:" "})]})},_y=({value:n,onChange:e,placeholder:t=" ...",minHeight:r="200px",maxHeight:s,showToolbar:i=!0,direction:o="rtl",disabled:a=!1,className:l="",autoFocus:c=!1,collapsible:u=!1})=>{const[h,f]=V.useState(c||!u),p=Kve({extensions:[P2e.configure({heading:{levels:[2,3]},link:!1,underline:!1}),l2e,D2e.configure({types:["heading","paragraph"],alignments:["left","center","right"],defaultAlignment:o==="rtl"?"right":"left"}),j2e.configure({placeholder:t}),Hwe.configure({openOnClick:!1,HTMLAttributes:{target:"_blank",rel:"noopener noreferrer"}})],content:n,editable:!a,autofocus:c,onUpdate:({editor:y})=>{e(y.getHTML())}});V.useEffect(()=>{p&&n!==p.getHTML()&&p.commands.setContent(n,!1)},[n,p]),V.useEffect(()=>{p&&p.setEditable(!a)},[a,p]);const g=nt.useRef(null);if(V.useEffect(()=>{if(!u||!h)return;const y=v=>{g.current&&!g.current.contains(v.target)&&f(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[u,h]),V.useEffect(()=>{if(!u||!h)return;const y=v=>{v.key==="Escape"&&f(!1)};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[u,h]),!p)return d.jsx("div",{className:`rte-container ${l}`,style:{minHeight:r},children:d.jsx("div",{className:"p-4 text-slate-400",children:"..."})});if(u&&!h){const y=()=>{a||(f(!0),setTimeout(()=>p==null?void 0:p.commands.focus(),50))};return d.jsx("div",{ref:g,className:`rte-container rte-view-mode ${l} ${a?"opacity-60 cursor-not-allowed":"cursor-text"}`,dir:o,onClick:y,children:d.jsx("div",{className:"rte-content-preview",style:{minHeight:"24px"},dangerouslySetInnerHTML:{__html:n||`<p class="text-slate-400">${t}</p>`}})})}return d.jsxs("div",{ref:g,className:`rte-container ${l} ${a?"opacity-60":""} ${u?"rte-edit-mode":""}`,dir:o,children:[i&&d.jsxs("div",{className:"rte-toolbar-wrapper",children:[d.jsx(O2e,{editor:p}),u&&d.jsx("button",{type:"button",onClick:()=>f(!1),className:"rte-done-btn",title:" ",children:d.jsx(br,{className:"w-4 h-4"})})]}),d.jsx($ve,{editor:p,className:s?"rte-scrollable":"",style:{minHeight:r,maxHeight:s}})]})};/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:UK,setPrototypeOf:bO,isFrozen:F2e,getPrototypeOf:z2e,getOwnPropertyDescriptor:B2e}=Object;let{freeze:ro,seal:nl,create:MC}=Object,{apply:PC,construct:LC}=typeof Reflect<"u"&&Reflect;ro||(ro=function(e){return e});nl||(nl=function(e){return e});PC||(PC=function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return e.apply(t,s)});LC||(LC=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return new e(...r)});const s4=so(Array.prototype.forEach),$2e=so(Array.prototype.lastIndexOf),vO=so(Array.prototype.pop),Sy=so(Array.prototype.push),V2e=so(Array.prototype.splice),Q4=so(String.prototype.toLowerCase),kA=so(String.prototype.toString),_A=so(String.prototype.match),Ty=so(String.prototype.replace),U2e=so(String.prototype.indexOf),H2e=so(String.prototype.trim),ul=so(Object.prototype.hasOwnProperty),Di=so(RegExp.prototype.test),Ay=q2e(TypeError);function so(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return PC(n,e,r)}}function q2e(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return LC(n,t)}}function Vt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Q4;bO&&bO(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(F2e(e)||(e[r]=i),s=i)}n[s]=!0}return n}function G2e(n){for(let e=0;e<n.length;e++)ul(n,e)||(n[e]=null);return n}function Xl(n){const e=MC(null);for(const[t,r]of UK(n))ul(n,t)&&(Array.isArray(r)?e[t]=G2e(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Xl(r):e[t]=r);return e}function Ey(n,e){for(;n!==null;){const r=B2e(n,e);if(r){if(r.get)return so(r.get);if(typeof r.value=="function")return so(r.value)}n=z2e(n)}function t(){return null}return t}const wO=ro(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),SA=ro(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),TA=ro(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),W2e=ro(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),AA=ro(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),K2e=ro(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),kO=ro(["#text"]),_O=ro(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),EA=ro(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),SO=ro(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),i4=ro(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Y2e=nl(/\{\{[\w\W]*|[\w\W]*\}\}/gm),X2e=nl(/<%[\w\W]*|[\w\W]*%>/gm),J2e=nl(/\$\{[\w\W]*/gm),Q2e=nl(/^data-[\-\w.\u00B7-\uFFFF]+$/),Z2e=nl(/^aria-[\-\w]+$/),HK=nl(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),e4e=nl(/^(?:\w+script|data):/i),t4e=nl(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),qK=nl(/^html$/i),n4e=nl(/^[a-z][.\w]*(-[.\w]+)+$/i);var TO=Object.freeze({__proto__:null,ARIA_ATTR:Z2e,ATTR_WHITESPACE:t4e,CUSTOM_ELEMENT:n4e,DATA_ATTR:Q2e,DOCTYPE_NAME:qK,ERB_EXPR:X2e,IS_ALLOWED_URI:HK,IS_SCRIPT_OR_DATA:e4e,MUSTACHE_EXPR:Y2e,TMPLIT_EXPR:J2e});const Cy={element:1,text:3,progressingInstruction:7,comment:8,document:9},r4e=function(){return typeof window>"u"?null:window},s4e=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},AO=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function GK(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r4e();const e=we=>GK(we);if(e.version="3.3.1",e.removed=[],!n||!n.document||n.document.nodeType!==Cy.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:h,DOMParser:f,trustedTypes:p}=n,g=l.prototype,y=Ey(g,"cloneNode"),v=Ey(g,"remove"),b=Ey(g,"nextSibling"),w=Ey(g,"childNodes"),k=Ey(g,"parentNode");if(typeof o=="function"){const we=t.createElement("template");we.content&&we.content.ownerDocument&&(t=we.content.ownerDocument)}let T,R="";const{implementation:M,createNodeIterator:E,createDocumentFragment:I,getElementsByTagName:S}=t,{importNode:N}=r;let P=AO();e.isSupported=typeof UK=="function"&&typeof k=="function"&&M&&M.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:O,ERB_EXPR:D,TMPLIT_EXPR:G,DATA_ATTR:J,ARIA_ATTR:Q,IS_SCRIPT_OR_DATA:re,ATTR_WHITESPACE:ne,CUSTOM_ELEMENT:te}=TO;let{IS_ALLOWED_URI:H}=TO,ce=null;const xe=Vt({},[...wO,...SA,...TA,...AA,...kO]);let W=null;const dt=Vt({},[..._O,...EA,...SO,...i4]);let Me=Object.seal(MC(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Fe=null,Ae=null;const lt=Object.seal(MC(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let sn=!0,un=!0,Sr=!1,ri=!0,Yn=!1,Or=!0,ht=!1,Tn=!1,Gt=!1,Dn=!1,bt=!1,$t=!1,er=!0,js=!1;const co="user-content-";let Rn=!0,Ct=!1,oe={},pe=null;const Ge=Vt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ft=null;const Ye=Vt({},["audio","video","img","source","image","track"]);let tt=null;const bn=Vt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),vn="http://www.w3.org/1998/Math/MathML",wn="http://www.w3.org/2000/svg",tr="http://www.w3.org/1999/xhtml";let Xt=tr,ss=!1,mn=null;const il=Vt({},[vn,wn,tr],kA);let uo=Vt({},["mi","mo","mn","ms","mtext"]),jo=Vt({},["annotation-xml"]);const lr=Vt({},["title","style","font","a","script"]);let wa=null;const ol=["application/xhtml+xml","text/html"],al="text/html";let Vn=null,Oo=null;const Ri=t.createElement("form"),Kc=function(Y){return Y instanceof RegExp||Y instanceof Function},Ul=function(){let Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Oo&&Oo===Y)){if((!Y||typeof Y!="object")&&(Y={}),Y=Xl(Y),wa=ol.indexOf(Y.PARSER_MEDIA_TYPE)===-1?al:Y.PARSER_MEDIA_TYPE,Vn=wa==="application/xhtml+xml"?kA:Q4,ce=ul(Y,"ALLOWED_TAGS")?Vt({},Y.ALLOWED_TAGS,Vn):xe,W=ul(Y,"ALLOWED_ATTR")?Vt({},Y.ALLOWED_ATTR,Vn):dt,mn=ul(Y,"ALLOWED_NAMESPACES")?Vt({},Y.ALLOWED_NAMESPACES,kA):il,tt=ul(Y,"ADD_URI_SAFE_ATTR")?Vt(Xl(bn),Y.ADD_URI_SAFE_ATTR,Vn):bn,ft=ul(Y,"ADD_DATA_URI_TAGS")?Vt(Xl(Ye),Y.ADD_DATA_URI_TAGS,Vn):Ye,pe=ul(Y,"FORBID_CONTENTS")?Vt({},Y.FORBID_CONTENTS,Vn):Ge,Fe=ul(Y,"FORBID_TAGS")?Vt({},Y.FORBID_TAGS,Vn):Xl({}),Ae=ul(Y,"FORBID_ATTR")?Vt({},Y.FORBID_ATTR,Vn):Xl({}),oe=ul(Y,"USE_PROFILES")?Y.USE_PROFILES:!1,sn=Y.ALLOW_ARIA_ATTR!==!1,un=Y.ALLOW_DATA_ATTR!==!1,Sr=Y.ALLOW_UNKNOWN_PROTOCOLS||!1,ri=Y.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Yn=Y.SAFE_FOR_TEMPLATES||!1,Or=Y.SAFE_FOR_XML!==!1,ht=Y.WHOLE_DOCUMENT||!1,Dn=Y.RETURN_DOM||!1,bt=Y.RETURN_DOM_FRAGMENT||!1,$t=Y.RETURN_TRUSTED_TYPE||!1,Gt=Y.FORCE_BODY||!1,er=Y.SANITIZE_DOM!==!1,js=Y.SANITIZE_NAMED_PROPS||!1,Rn=Y.KEEP_CONTENT!==!1,Ct=Y.IN_PLACE||!1,H=Y.ALLOWED_URI_REGEXP||HK,Xt=Y.NAMESPACE||tr,uo=Y.MATHML_TEXT_INTEGRATION_POINTS||uo,jo=Y.HTML_INTEGRATION_POINTS||jo,Me=Y.CUSTOM_ELEMENT_HANDLING||{},Y.CUSTOM_ELEMENT_HANDLING&&Kc(Y.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Me.tagNameCheck=Y.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Y.CUSTOM_ELEMENT_HANDLING&&Kc(Y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Me.attributeNameCheck=Y.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Y.CUSTOM_ELEMENT_HANDLING&&typeof Y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Me.allowCustomizedBuiltInElements=Y.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Yn&&(un=!1),bt&&(Dn=!0),oe&&(ce=Vt({},kO),W=[],oe.html===!0&&(Vt(ce,wO),Vt(W,_O)),oe.svg===!0&&(Vt(ce,SA),Vt(W,EA),Vt(W,i4)),oe.svgFilters===!0&&(Vt(ce,TA),Vt(W,EA),Vt(W,i4)),oe.mathMl===!0&&(Vt(ce,AA),Vt(W,SO),Vt(W,i4))),Y.ADD_TAGS&&(typeof Y.ADD_TAGS=="function"?lt.tagCheck=Y.ADD_TAGS:(ce===xe&&(ce=Xl(ce)),Vt(ce,Y.ADD_TAGS,Vn))),Y.ADD_ATTR&&(typeof Y.ADD_ATTR=="function"?lt.attributeCheck=Y.ADD_ATTR:(W===dt&&(W=Xl(W)),Vt(W,Y.ADD_ATTR,Vn))),Y.ADD_URI_SAFE_ATTR&&Vt(tt,Y.ADD_URI_SAFE_ATTR,Vn),Y.FORBID_CONTENTS&&(pe===Ge&&(pe=Xl(pe)),Vt(pe,Y.FORBID_CONTENTS,Vn)),Y.ADD_FORBID_CONTENTS&&(pe===Ge&&(pe=Xl(pe)),Vt(pe,Y.ADD_FORBID_CONTENTS,Vn)),Rn&&(ce["#text"]=!0),ht&&Vt(ce,["html","head","body"]),ce.table&&(Vt(ce,["tbody"]),delete Fe.tbody),Y.TRUSTED_TYPES_POLICY){if(typeof Y.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ay('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Y.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ay('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');T=Y.TRUSTED_TYPES_POLICY,R=T.createHTML("")}else T===void 0&&(T=s4e(p,s)),T!==null&&typeof R=="string"&&(R=T.createHTML(""));ro&&ro(Y),Oo=Y}},ka=Vt({},[...SA,...TA,...W2e]),_a=Vt({},[...AA,...K2e]),Hl=function(Y){let le=k(Y);(!le||!le.tagName)&&(le={namespaceURI:Xt,tagName:"template"});const he=Q4(Y.tagName),qe=Q4(le.tagName);return mn[Y.namespaceURI]?Y.namespaceURI===wn?le.namespaceURI===tr?he==="svg":le.namespaceURI===vn?he==="svg"&&(qe==="annotation-xml"||uo[qe]):!!ka[he]:Y.namespaceURI===vn?le.namespaceURI===tr?he==="math":le.namespaceURI===wn?he==="math"&&jo[qe]:!!_a[he]:Y.namespaceURI===tr?le.namespaceURI===wn&&!jo[qe]||le.namespaceURI===vn&&!uo[qe]?!1:!_a[he]&&(lr[he]||!ka[he]):!!(wa==="application/xhtml+xml"&&mn[Y.namespaceURI]):!1},Tr=function(Y){Sy(e.removed,{element:Y});try{k(Y).removeChild(Y)}catch{v(Y)}},vs=function(Y,le){try{Sy(e.removed,{attribute:le.getAttributeNode(Y),from:le})}catch{Sy(e.removed,{attribute:null,from:le})}if(le.removeAttribute(Y),Y==="is")if(Dn||bt)try{Tr(le)}catch{}else try{le.setAttribute(Y,"")}catch{}},Yc=function(Y){let le=null,he=null;if(Gt)Y="<remove></remove>"+Y;else{const Le=_A(Y,/^[\r\n\t ]+/);he=Le&&Le[0]}wa==="application/xhtml+xml"&&Xt===tr&&(Y='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Y+"</body></html>");const qe=T?T.createHTML(Y):Y;if(Xt===tr)try{le=new f().parseFromString(qe,wa)}catch{}if(!le||!le.documentElement){le=M.createDocument(Xt,"template",null);try{le.documentElement.innerHTML=ss?R:qe}catch{}}const jt=le.body||le.documentElement;return Y&&he&&jt.insertBefore(t.createTextNode(he),jt.childNodes[0]||null),Xt===tr?S.call(le,ht?"html":"body")[0]:ht?le.documentElement:jt},Os=function(Y){return E.call(Y.ownerDocument||Y,Y,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},Sa=function(Y){return Y instanceof h&&(typeof Y.nodeName!="string"||typeof Y.textContent!="string"||typeof Y.removeChild!="function"||!(Y.attributes instanceof u)||typeof Y.removeAttribute!="function"||typeof Y.setAttribute!="function"||typeof Y.namespaceURI!="string"||typeof Y.insertBefore!="function"||typeof Y.hasChildNodes!="function")},ll=function(Y){return typeof a=="function"&&Y instanceof a};function is(we,Y,le){s4(we,he=>{he.call(e,Y,le,Oo)})}const ve=function(Y){let le=null;if(is(P.beforeSanitizeElements,Y,null),Sa(Y))return Tr(Y),!0;const he=Vn(Y.nodeName);if(is(P.uponSanitizeElement,Y,{tagName:he,allowedTags:ce}),Or&&Y.hasChildNodes()&&!ll(Y.firstElementChild)&&Di(/<[/\w!]/g,Y.innerHTML)&&Di(/<[/\w!]/g,Y.textContent)||Y.nodeType===Cy.progressingInstruction||Or&&Y.nodeType===Cy.comment&&Di(/<[/\w]/g,Y.data))return Tr(Y),!0;if(!(lt.tagCheck instanceof Function&&lt.tagCheck(he))&&(!ce[he]||Fe[he])){if(!Fe[he]&&Qe(he)&&(Me.tagNameCheck instanceof RegExp&&Di(Me.tagNameCheck,he)||Me.tagNameCheck instanceof Function&&Me.tagNameCheck(he)))return!1;if(Rn&&!pe[he]){const qe=k(Y)||Y.parentNode,jt=w(Y)||Y.childNodes;if(jt&&qe){const Le=jt.length;for(let yt=Le-1;yt>=0;--yt){const Xe=y(jt[yt],!0);Xe.__removalCount=(Y.__removalCount||0)+1,qe.insertBefore(Xe,b(Y))}}}return Tr(Y),!0}return Y instanceof l&&!Hl(Y)||(he==="noscript"||he==="noembed"||he==="noframes")&&Di(/<\/no(script|embed|frames)/i,Y.innerHTML)?(Tr(Y),!0):(Yn&&Y.nodeType===Cy.text&&(le=Y.textContent,s4([O,D,G],qe=>{le=Ty(le,qe," ")}),Y.textContent!==le&&(Sy(e.removed,{element:Y.cloneNode()}),Y.textContent=le)),is(P.afterSanitizeElements,Y,null),!1)},Ne=function(Y,le,he){if(er&&(le==="id"||le==="name")&&(he in t||he in Ri))return!1;if(!(un&&!Ae[le]&&Di(J,le))){if(!(sn&&Di(Q,le))){if(!(lt.attributeCheck instanceof Function&&lt.attributeCheck(le,Y))){if(!W[le]||Ae[le]){if(!(Qe(Y)&&(Me.tagNameCheck instanceof RegExp&&Di(Me.tagNameCheck,Y)||Me.tagNameCheck instanceof Function&&Me.tagNameCheck(Y))&&(Me.attributeNameCheck instanceof RegExp&&Di(Me.attributeNameCheck,le)||Me.attributeNameCheck instanceof Function&&Me.attributeNameCheck(le,Y))||le==="is"&&Me.allowCustomizedBuiltInElements&&(Me.tagNameCheck instanceof RegExp&&Di(Me.tagNameCheck,he)||Me.tagNameCheck instanceof Function&&Me.tagNameCheck(he))))return!1}else if(!tt[le]){if(!Di(H,Ty(he,ne,""))){if(!((le==="src"||le==="xlink:href"||le==="href")&&Y!=="script"&&U2e(he,"data:")===0&&ft[Y])){if(!(Sr&&!Di(re,Ty(he,ne,"")))){if(he)return!1}}}}}}}return!0},Qe=function(Y){return Y!=="annotation-xml"&&_A(Y,te)},it=function(Y){is(P.beforeSanitizeAttributes,Y,null);const{attributes:le}=Y;if(!le||Sa(Y))return;const he={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W,forceKeepAttr:void 0};let qe=le.length;for(;qe--;){const jt=le[qe],{name:Le,namespaceURI:yt,value:Xe}=jt,It=Vn(Le),pt=Xe;let ye=Le==="value"?pt:H2e(pt);if(he.attrName=It,he.attrValue=ye,he.keepAttr=!0,he.forceKeepAttr=void 0,is(P.uponSanitizeAttribute,Y,he),ye=he.attrValue,js&&(It==="id"||It==="name")&&(vs(Le,Y),ye=co+ye),Or&&Di(/((--!?|])>)|<\/(style|title|textarea)/i,ye)){vs(Le,Y);continue}if(It==="attributename"&&_A(ye,"href")){vs(Le,Y);continue}if(he.forceKeepAttr)continue;if(!he.keepAttr){vs(Le,Y);continue}if(!ri&&Di(/\/>/i,ye)){vs(Le,Y);continue}Yn&&s4([O,D,G],tn=>{ye=Ty(ye,tn," ")});const Jt=Vn(Y.nodeName);if(!Ne(Jt,It,ye)){vs(Le,Y);continue}if(T&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!yt)switch(p.getAttributeType(Jt,It)){case"TrustedHTML":{ye=T.createHTML(ye);break}case"TrustedScriptURL":{ye=T.createScriptURL(ye);break}}if(ye!==pt)try{yt?Y.setAttributeNS(yt,Le,ye):Y.setAttribute(Le,ye),Sa(Y)?Tr(Y):vO(e.removed)}catch{vs(Le,Y)}}is(P.afterSanitizeAttributes,Y,null)},Nt=function we(Y){let le=null;const he=Os(Y);for(is(P.beforeSanitizeShadowDOM,Y,null);le=he.nextNode();)is(P.uponSanitizeShadowNode,le,null),ve(le),it(le),le.content instanceof i&&we(le.content);is(P.afterSanitizeShadowDOM,Y,null)};return e.sanitize=function(we){let Y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},le=null,he=null,qe=null,jt=null;if(ss=!we,ss&&(we="<!-->"),typeof we!="string"&&!ll(we))if(typeof we.toString=="function"){if(we=we.toString(),typeof we!="string")throw Ay("dirty is not a string, aborting")}else throw Ay("toString is not a function");if(!e.isSupported)return we;if(Tn||Ul(Y),e.removed=[],typeof we=="string"&&(Ct=!1),Ct){if(we.nodeName){const Xe=Vn(we.nodeName);if(!ce[Xe]||Fe[Xe])throw Ay("root node is forbidden and cannot be sanitized in-place")}}else if(we instanceof a)le=Yc("<!---->"),he=le.ownerDocument.importNode(we,!0),he.nodeType===Cy.element&&he.nodeName==="BODY"||he.nodeName==="HTML"?le=he:le.appendChild(he);else{if(!Dn&&!Yn&&!ht&&we.indexOf("<")===-1)return T&&$t?T.createHTML(we):we;if(le=Yc(we),!le)return Dn?null:$t?R:""}le&&Gt&&Tr(le.firstChild);const Le=Os(Ct?we:le);for(;qe=Le.nextNode();)ve(qe),it(qe),qe.content instanceof i&&Nt(qe.content);if(Ct)return we;if(Dn){if(bt)for(jt=I.call(le.ownerDocument);le.firstChild;)jt.appendChild(le.firstChild);else jt=le;return(W.shadowroot||W.shadowrootmode)&&(jt=N.call(r,jt,!0)),jt}let yt=ht?le.outerHTML:le.innerHTML;return ht&&ce["!doctype"]&&le.ownerDocument&&le.ownerDocument.doctype&&le.ownerDocument.doctype.name&&Di(qK,le.ownerDocument.doctype.name)&&(yt="<!DOCTYPE "+le.ownerDocument.doctype.name+`>
`+yt),Yn&&s4([O,D,G],Xe=>{yt=Ty(yt,Xe," ")}),T&&$t?T.createHTML(yt):yt},e.setConfig=function(){let we=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ul(we),Tn=!0},e.clearConfig=function(){Oo=null,Tn=!1},e.isValidAttribute=function(we,Y,le){Oo||Ul({});const he=Vn(we),qe=Vn(Y);return Ne(he,qe,le)},e.addHook=function(we,Y){typeof Y=="function"&&Sy(P[we],Y)},e.removeHook=function(we,Y){if(Y!==void 0){const le=$2e(P[we],Y);return le===-1?void 0:V2e(P[we],le,1)[0]}return vO(P[we])},e.removeHooks=function(we){P[we]=[]},e.removeAllHooks=function(){P=AO()},e}var vR=GK();const i4e=()=>({ALLOWED_TAGS:["p","br","span","div","strong","b","em","i","u","s","strike","sub","sup","mark","h1","h2","h3","h4","h5","h6","ul","ol","li","table","thead","tbody","tfoot","tr","th","td","blockquote","pre","code","hr","img","figure","figcaption","a"],ALLOWED_ATTR:["class","id","dir","lang","title","style","href","target","rel","src","alt","width","height","loading","colspan","rowspan","scope","aria-label","aria-describedby","role"],ALLOWED_URI_REGEXP:/^(?:(?:https?|mailto|tel):|[^a-z]|[a-z+.-]+(?:[^a-z+.\-:]|$))/i,ALLOW_DATA_ATTR:!1,KEEP_CONTENT:!0}),o4e=i4e();function ko(n,e){if(!n)return"";const t={...o4e,...e};return vR.sanitize(n,{ALLOWED_TAGS:t.ALLOWED_TAGS,ALLOWED_ATTR:t.ALLOWED_ATTR,ALLOWED_URI_REGEXP:t.ALLOWED_URI_REGEXP,ALLOW_DATA_ATTR:t.ALLOW_DATA_ATTR,KEEP_CONTENT:t.KEEP_CONTENT,FORBID_TAGS:["script","style","iframe","frame","frameset","object","embed","form","input","button"],FORBID_ATTR:["onerror","onload","onclick","onmouseover","onfocus","onblur","onchange","onsubmit"]})}function a4e(n){return n?vR.sanitize(n,{ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0}):""}function EO(n){if(!n)return!1;try{const e=new URL(n,window.location.origin);return!(!["http:","https:","mailto:","tel:"].includes(e.protocol)||n.toLowerCase().includes("javascript:")||n.toLowerCase().includes("data:"))}catch{return!1}}typeof window<"u"&&vR.addHook("afterSanitizeAttributes",n=>{const e=n.attributes;if(e)for(let t=e.length-1;t>=0;t--)e[t].name.toLowerCase().startsWith("on")&&n.removeAttribute(e[t].name);if(n.tagName==="A"){const t=n.getAttribute("href");t&&!EO(t)&&n.removeAttribute("href"),t&&!t.startsWith("/")&&!t.startsWith("#")&&(n.setAttribute("rel","noopener noreferrer"),n.setAttribute("target","_blank"))}if(n.tagName==="IMG"){const t=n.getAttribute("src");t&&!EO(t)&&!t.startsWith("data:image/")&&(n.removeAttribute("src"),n.setAttribute("alt","[Image removed for security]"))}});function l4e(n){if(!n)return"";let e=n;return e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(new RegExp("(?<!\\n|^)\\*([^*\\n]+)\\*(?!\\*)","g"),"<em>$1</em>"),/(?:^|\n)\s*\*\s+/.test(e)&&(e=e.replace(/(?:^|\n)\s*\*\s+([^\n]+)/g,`
<li>$1</li>`),e=e.replace(/(<li>[\s\S]*?<\/li>)+/g,'<ul dir="rtl">$&</ul>')),e=e.replace(/->/g,""),e=e.replace(/<-/g,""),e=e.replace(/\n{2,}/g,"</p><p>"),e=e.replace(new RegExp("(?<!<\\/li>)\\n(?!<)","g"),"<br>"),!e.startsWith("<p>")&&!e.startsWith("<ul")&&(e="<p>"+e+"</p>"),e=e.replace(/<p>\s*<\/p>/g,""),e=e.replace(/<br>\s*<br>/g,"<br>"),e=e.replace(/^<br>|<br>$/g,""),e}function Z7e(n){if(!n)return"";if(/\*\*[^*]+\*\*|\*[^*]+\*/.test(n)){const t=l4e(n);return ko(t)}return ko(n)}function Jy(n){if(!n)return"";let e=a4e(n);return e=e.replace(/(?:^|\n)\s*\*\s*/g,`
`),e=e.replace(/\*\*([^*]+)\*\*/g,"$1"),e=e.replace(/\*([^*]+)\*/g,"$1"),e=e.replace(/(?:^|\n)([-\s]{2,30}:)/g,`
<strong>$1</strong>`),e=e.replace(/->/g,""),e=e.replace(/<-/g,""),e=e.replace(/\n{2,}/g,"<br><br>"),e=e.replace(/\n/g,"<br>"),e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/<br>\s*<br>\s*<br>/g,"<br><br>"),e=e.replace(/^<br>|<br>$/g,""),ko(e)}function c4e(n){if(!n)return"";let e=n;return e=e.replace(/(?:^|\n)\s*\*\s*/g,`
`),e=e.replace(/\*\*([^*]+)\*\*/g,"$1"),e=e.replace(/\*([^*]+)\*/g,"$1"),e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/\n{3,}/g,`

`),e}const u4e={lesson:["   ...","    ...","     ...","   ...","     ...","    ...","     ...","   ...","    ...","   ...","    ...","   ...","   ...","   ...","   ...","   ...","    ..."],exam:["    ...","    ...","   ...","    ...","    ...","   ...","    ...","     ...","     ...","    ...","   ...","    ...","   ...","   ...","   ...","    ...","   ..."],activity:["   ...","   ...","     ...","   ...","   ...","   ...","    ...","    ...","   ...","  ...","  ...","   ...","    ...","   ...","   ...","   ...","   ..."],general:["  ...","  ...","  ...","  ...","  ..."]},d4e={lesson:["   ...","   ..."],exam:["   ...","   ..."],activity:["    ...","   ..."],general:["  ..."," ..."]},DC=({contentType:n="general",isVisible:e=!0,isComplete:t=!1,customMessages:r,showSpinner:s=!0,showStatusBadge:i=!0,className:o="",typingSpeed:a=40,pauseDuration:l=1200,erasingSpeed:c=25})=>{const u=r||u4e[n],h=d4e[n],[f,p]=V.useState(0),[g,y]=V.useState(""),[v,b]=V.useState(!0),[w,k]=V.useState(!0),[T,R]=V.useState(!1),[M,E]=V.useState(0);return V.useEffect(()=>{t&&!T&&(R(!0),E(0),y(""),b(!0))},[t,T]),V.useEffect(()=>{const I=setInterval(()=>{k(S=>!S)},530);return()=>clearInterval(I)},[]),V.useEffect(()=>{if(!e)return;const N=(T?h:u)[T?M:f];if(!N)return;let P;return v?g.length<N.length?P=setTimeout(()=>{y(N.slice(0,g.length+1))},a):P=setTimeout(()=>{b(!1)},l):g.length>0?P=setTimeout(()=>{y(g.slice(0,-1))},c):(T?M<h.length-1&&E(O=>O+1):p(O=>(O+1)%u.length),b(!0)),()=>clearTimeout(P)},[g,v,f,M,T,u,h,e,a,l,c]),V.useEffect(()=>{p(0),E(0),y(""),b(!0),R(!1)},[n,r]),e?d.jsxs("div",{className:`flex flex-col items-center gap-4 ${o}`,dir:"rtl",children:[s&&d.jsx(Yw,{size:"lg",color:"gradient"}),d.jsx("div",{className:"min-h-[2rem] flex items-center justify-center",children:d.jsxs("span",{className:"text-lg font-medium text-indigo-700 dark:text-indigo-300",children:[g,d.jsx("span",{className:`inline-block w-0.5 h-5 bg-indigo-500 mr-0.5 align-middle transition-opacity duration-100 ${w?"opacity-100":"opacity-0"}`})]})}),i&&d.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-full border border-indigo-100 dark:border-indigo-800",children:[d.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),d.jsx("span",{className:"text-sm text-indigo-600 dark:text-indigo-300 font-medium",children:T?"...":"AI    -     "})]})]}):null},h4e=n=>d.jsx(DC,{...n,showSpinner:!1,className:`inline-flex ${n.className||""}`}),CO=({height:n="h-48",prompt:e,className:t=""})=>d.jsxs("div",{className:`
        relative overflow-hidden rounded-xl
        bg-gradient-to-br from-blue-100 via-purple-50 to-pink-100
        ${n}
        ${t}
      `,children:[d.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-shimmer",style:{backgroundSize:"200% 100%"}}),d.jsx("div",{className:"absolute inset-0 opacity-30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E")`}}),d.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(Z0e,{className:"w-12 h-12 text-blue-300/70"}),d.jsx(ng,{className:"w-5 h-5 text-purple-400 absolute -top-1 -right-1 animate-pulse"})]}),d.jsxs("div",{className:"text-center",children:[d.jsxs("p",{className:"text-sm font-bold text-blue-600/80 flex items-center gap-2",children:[d.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"})," ..."]}),e&&d.jsxs("p",{className:"text-xs text-gray-500/70 mt-1 max-w-[200px] truncate px-4",children:['"',e,'"']})]})]}),d.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-blue-100/50 overflow-hidden",children:d.jsx("div",{className:"h-full bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 animate-progress",style:{width:"100%"}})})]});function NO(n){const e=[],t=String(n||"");let r=t.indexOf(","),s=0,i=!1;for(;!i;){r===-1&&(r=t.length,i=!0);const o=t.slice(s,r).trim();(o||!i)&&e.push(o),s=r+1,r=t.indexOf(",",s)}return e}function f4e(n,e){const t={};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const p4e=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,m4e=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,g4e={};function IO(n,e){return(g4e.jsx?m4e:p4e).test(n)}const y4e=/[ \t\n\f\r]/g;function x4e(n){return typeof n=="object"?n.type==="text"?RO(n.value):!1:RO(n)}function RO(n){return n.replace(y4e,"")===""}class n2{constructor(e,t,r){this.normal=t,this.property=e,r&&(this.space=r)}}n2.prototype.normal={};n2.prototype.property={};n2.prototype.space=void 0;function WK(n,e){const t={},r={};for(const s of n)Object.assign(t,s.property),Object.assign(r,s.normal);return new n2(t,r,e)}function zb(n){return n.toLowerCase()}class Lo{constructor(e,t){this.attribute=t,this.property=e}}Lo.prototype.attribute="";Lo.prototype.booleanish=!1;Lo.prototype.boolean=!1;Lo.prototype.commaOrSpaceSeparated=!1;Lo.prototype.commaSeparated=!1;Lo.prototype.defined=!1;Lo.prototype.mustUseProperty=!1;Lo.prototype.number=!1;Lo.prototype.overloadedBoolean=!1;Lo.prototype.property="";Lo.prototype.spaceSeparated=!1;Lo.prototype.space=void 0;let b4e=0;const Mt=em(),Wr=em(),jC=em(),Te=em(),Hn=em(),og=em(),Bo=em();function em(){return 2**++b4e}const OC=Object.freeze(Object.defineProperty({__proto__:null,boolean:Mt,booleanish:Wr,commaOrSpaceSeparated:Bo,commaSeparated:og,number:Te,overloadedBoolean:jC,spaceSeparated:Hn},Symbol.toStringTag,{value:"Module"})),CA=Object.keys(OC);class wR extends Lo{constructor(e,t,r,s){let i=-1;if(super(e,t),MO(this,"space",s),typeof r=="number")for(;++i<CA.length;){const o=CA[i];MO(this,CA[i],(r&OC[o])===OC[o])}}}wR.prototype.defined=!0;function MO(n,e,t){t&&(n[e]=t)}function ry(n){const e={},t={};for(const[r,s]of Object.entries(n.properties)){const i=new wR(r,n.transform(n.attributes||{},r),s,n.space);n.mustUseProperty&&n.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,t[zb(r)]=r,t[zb(i.attribute)]=r}return new n2(e,t,n.space)}const KK=ry({properties:{ariaActiveDescendant:null,ariaAtomic:Wr,ariaAutoComplete:null,ariaBusy:Wr,ariaChecked:Wr,ariaColCount:Te,ariaColIndex:Te,ariaColSpan:Te,ariaControls:Hn,ariaCurrent:null,ariaDescribedBy:Hn,ariaDetails:null,ariaDisabled:Wr,ariaDropEffect:Hn,ariaErrorMessage:null,ariaExpanded:Wr,ariaFlowTo:Hn,ariaGrabbed:Wr,ariaHasPopup:null,ariaHidden:Wr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Hn,ariaLevel:Te,ariaLive:null,ariaModal:Wr,ariaMultiLine:Wr,ariaMultiSelectable:Wr,ariaOrientation:null,ariaOwns:Hn,ariaPlaceholder:null,ariaPosInSet:Te,ariaPressed:Wr,ariaReadOnly:Wr,ariaRelevant:null,ariaRequired:Wr,ariaRoleDescription:Hn,ariaRowCount:Te,ariaRowIndex:Te,ariaRowSpan:Te,ariaSelected:Wr,ariaSetSize:Te,ariaSort:null,ariaValueMax:Te,ariaValueMin:Te,ariaValueNow:Te,ariaValueText:null,role:null},transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function YK(n,e){return e in n?n[e]:e}function XK(n,e){return YK(n,e.toLowerCase())}const v4e=ry({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:og,acceptCharset:Hn,accessKey:Hn,action:null,allow:null,allowFullScreen:Mt,allowPaymentRequest:Mt,allowUserMedia:Mt,alt:null,as:null,async:Mt,autoCapitalize:null,autoComplete:Hn,autoFocus:Mt,autoPlay:Mt,blocking:Hn,capture:null,charSet:null,checked:Mt,cite:null,className:Hn,cols:Te,colSpan:null,content:null,contentEditable:Wr,controls:Mt,controlsList:Hn,coords:Te|og,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Mt,defer:Mt,dir:null,dirName:null,disabled:Mt,download:jC,draggable:Wr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Mt,formTarget:null,headers:Hn,height:Te,hidden:jC,high:Te,href:null,hrefLang:null,htmlFor:Hn,httpEquiv:Hn,id:null,imageSizes:null,imageSrcSet:null,inert:Mt,inputMode:null,integrity:null,is:null,isMap:Mt,itemId:null,itemProp:Hn,itemRef:Hn,itemScope:Mt,itemType:Hn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Mt,low:Te,manifest:null,max:null,maxLength:Te,media:null,method:null,min:null,minLength:Te,multiple:Mt,muted:Mt,name:null,nonce:null,noModule:Mt,noValidate:Mt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Mt,optimum:Te,pattern:null,ping:Hn,placeholder:null,playsInline:Mt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Mt,referrerPolicy:null,rel:Hn,required:Mt,reversed:Mt,rows:Te,rowSpan:Te,sandbox:Hn,scope:null,scoped:Mt,seamless:Mt,selected:Mt,shadowRootClonable:Mt,shadowRootDelegatesFocus:Mt,shadowRootMode:null,shape:null,size:Te,sizes:null,slot:null,span:Te,spellCheck:Wr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Te,step:null,style:null,tabIndex:Te,target:null,title:null,translate:null,type:null,typeMustMatch:Mt,useMap:null,value:Wr,width:Te,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Hn,axis:null,background:null,bgColor:null,border:Te,borderColor:null,bottomMargin:Te,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Mt,declare:Mt,event:null,face:null,frame:null,frameBorder:null,hSpace:Te,leftMargin:Te,link:null,longDesc:null,lowSrc:null,marginHeight:Te,marginWidth:Te,noResize:Mt,noHref:Mt,noShade:Mt,noWrap:Mt,object:null,profile:null,prompt:null,rev:null,rightMargin:Te,rules:null,scheme:null,scrolling:Wr,standby:null,summary:null,text:null,topMargin:Te,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Te,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Mt,disableRemotePlayback:Mt,prefix:null,property:null,results:Te,security:null,unselectable:null},space:"html",transform:XK}),w4e=ry({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Bo,accentHeight:Te,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Te,amplitude:Te,arabicForm:null,ascent:Te,attributeName:null,attributeType:null,azimuth:Te,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Te,by:null,calcMode:null,capHeight:Te,className:Hn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Te,diffuseConstant:Te,direction:null,display:null,dur:null,divisor:Te,dominantBaseline:null,download:Mt,dx:null,dy:null,edgeMode:null,editable:null,elevation:Te,enableBackground:null,end:null,event:null,exponent:Te,externalResourcesRequired:null,fill:null,fillOpacity:Te,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:og,g2:og,glyphName:og,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Te,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Te,horizOriginX:Te,horizOriginY:Te,id:null,ideographic:Te,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Te,k:Te,k1:Te,k2:Te,k3:Te,k4:Te,kernelMatrix:Bo,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Te,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Te,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Te,overlineThickness:Te,paintOrder:null,panose1:null,path:null,pathLength:Te,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Hn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Te,pointsAtY:Te,pointsAtZ:Te,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Bo,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Bo,rev:Bo,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Bo,requiredFeatures:Bo,requiredFonts:Bo,requiredFormats:Bo,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Te,specularExponent:Te,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Te,strikethroughThickness:Te,string:null,stroke:null,strokeDashArray:Bo,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Te,strokeOpacity:Te,strokeWidth:null,style:null,surfaceScale:Te,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Bo,tabIndex:Te,tableValues:null,target:null,targetX:Te,targetY:Te,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Bo,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Te,underlineThickness:Te,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Te,values:null,vAlphabetic:Te,vMathematical:Te,vectorEffect:null,vHanging:Te,vIdeographic:Te,version:null,vertAdvY:Te,vertOriginX:Te,vertOriginY:Te,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Te,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:YK}),JK=ry({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()}}),QK=ry({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:XK}),ZK=ry({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()}}),k4e={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},_4e=/[A-Z]/g,PO=/-[a-z]/g,S4e=/^data[-\w.:]+$/i;function eY(n,e){const t=zb(e);let r=e,s=Lo;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&S4e.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(PO,A4e);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!PO.test(i)){let o=i.replace(_4e,T4e);o.charAt(0)!=="-"&&(o="-"+o),e="data"+o}}s=wR}return new s(r,e)}function T4e(n){return"-"+n.toLowerCase()}function A4e(n){return n.charAt(1).toUpperCase()}const tY=WK([KK,v4e,JK,QK,ZK],"html"),xS=WK([KK,w4e,JK,QK,ZK],"svg");function LO(n){const e=String(n||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function E4e(n){return n.join(" ").trim()}var kR={},DO=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,C4e=/\n/g,N4e=/^\s*/,I4e=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,R4e=/^:\s*/,M4e=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,P4e=/^[;\s]*/,L4e=/^\s+|\s+$/g,D4e=`
`,jO="/",OO="*",qf="",j4e="comment",O4e="declaration";function F4e(n,e){if(typeof n!="string")throw new TypeError("First argument must be a string");if(!n)return[];e=e||{};var t=1,r=1;function s(g){var y=g.match(C4e);y&&(t+=y.length);var v=g.lastIndexOf(D4e);r=~v?g.length-v:r+g.length}function i(){var g={line:t,column:r};return function(y){return y.position=new o(g),c(),y}}function o(g){this.start=g,this.end={line:t,column:r},this.source=e.source}o.prototype.content=n;function a(g){var y=new Error(e.source+":"+t+":"+r+": "+g);if(y.reason=g,y.filename=e.source,y.line=t,y.column=r,y.source=n,!e.silent)throw y}function l(g){var y=g.exec(n);if(y){var v=y[0];return s(v),n=n.slice(v.length),y}}function c(){l(N4e)}function u(g){var y;for(g=g||[];y=h();)y!==!1&&g.push(y);return g}function h(){var g=i();if(!(jO!=n.charAt(0)||OO!=n.charAt(1))){for(var y=2;qf!=n.charAt(y)&&(OO!=n.charAt(y)||jO!=n.charAt(y+1));)++y;if(y+=2,qf===n.charAt(y-1))return a("End of comment missing");var v=n.slice(2,y-2);return r+=2,s(v),n=n.slice(y),r+=2,g({type:j4e,comment:v})}}function f(){var g=i(),y=l(I4e);if(y){if(h(),!l(R4e))return a("property missing ':'");var v=l(M4e),b=g({type:O4e,property:FO(y[0].replace(DO,qf)),value:v?FO(v[0].replace(DO,qf)):qf});return l(P4e),b}}function p(){var g=[];u(g);for(var y;y=f();)y!==!1&&(g.push(y),u(g));return g}return c(),p()}function FO(n){return n?n.replace(L4e,qf):qf}var z4e=F4e,B4e=Pk&&Pk.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(kR,"__esModule",{value:!0});kR.default=V4e;const $4e=B4e(z4e);function V4e(n,e){let t=null;if(!n||typeof n!="string")return t;const r=(0,$4e.default)(n),s=typeof e=="function";return r.forEach(i=>{if(i.type!=="declaration")return;const{property:o,value:a}=i;s?e(o,a,i):a&&(t=t||{},t[o]=a)}),t}var bS={};Object.defineProperty(bS,"__esModule",{value:!0});bS.camelCase=void 0;var U4e=/^--[a-zA-Z0-9_-]+$/,H4e=/-([a-z])/g,q4e=/^[^-]+$/,G4e=/^-(webkit|moz|ms|o|khtml)-/,W4e=/^-(ms)-/,K4e=function(n){return!n||q4e.test(n)||U4e.test(n)},Y4e=function(n,e){return e.toUpperCase()},zO=function(n,e){return"".concat(e,"-")},X4e=function(n,e){return e===void 0&&(e={}),K4e(n)?n:(n=n.toLowerCase(),e.reactCompat?n=n.replace(W4e,zO):n=n.replace(G4e,zO),n.replace(H4e,Y4e))};bS.camelCase=X4e;var J4e=Pk&&Pk.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},Q4e=J4e(kR),Z4e=bS;function FC(n,e){var t={};return!n||typeof n!="string"||(0,Q4e.default)(n,function(r,s){r&&s&&(t[(0,Z4e.camelCase)(r,e)]=s)}),t}FC.default=FC;var eke=FC;const tke=xw(eke),nY=rY("end"),_R=rY("start");function rY(n){return e;function e(t){const r=t&&t.position&&t.position[n]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function nke(n){const e=_R(n),t=nY(n);if(e&&t)return{start:e,end:t}}function Hx(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?BO(n.position):"start"in n||"end"in n?BO(n):"line"in n||"column"in n?zC(n):""}function zC(n){return $O(n&&n.line)+":"+$O(n&&n.column)}function BO(n){return zC(n&&n.start)+"-"+zC(n&&n.end)}function $O(n){return n&&typeof n=="number"?n:1}class Ii extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let s="",i={},o=!1;if(t&&("line"in t&&"column"in t?i={place:t}:"start"in t&&"end"in t?i={place:t}:"type"in t?i={ancestors:[t],place:t.position}:i={...t}),typeof e=="string"?s=e:!i.cause&&e&&(o=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?i.ruleId=r:(i.source=r.slice(0,l),i.ruleId=r.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){const l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}const a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Hx(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ii.prototype.file="";Ii.prototype.name="";Ii.prototype.reason="";Ii.prototype.message="";Ii.prototype.stack="";Ii.prototype.column=void 0;Ii.prototype.line=void 0;Ii.prototype.ancestors=void 0;Ii.prototype.cause=void 0;Ii.prototype.fatal=void 0;Ii.prototype.place=void 0;Ii.prototype.ruleId=void 0;Ii.prototype.source=void 0;const SR={}.hasOwnProperty,rke=new Map,ske=/[A-Z]/g,ike=new Set(["table","tbody","thead","tfoot","tr"]),oke=new Set(["td","th"]),sY="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function ake(n,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=mke(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=pke(t,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?xS:tY,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=iY(s,n,void 0);return i&&typeof i!="string"?i:s.create(n,s.Fragment,{children:i||void 0},void 0)}function iY(n,e,t){if(e.type==="element")return lke(n,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return cke(n,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return dke(n,e,t);if(e.type==="mdxjsEsm")return uke(n,e);if(e.type==="root")return hke(n,e,t);if(e.type==="text")return fke(n,e)}function lke(n,e,t){const r=n.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=xS,n.schema=s),n.ancestors.push(e);const i=aY(n,e.tagName,!1),o=gke(n,e);let a=AR(n,e);return ike.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!x4e(l):!0})),oY(n,o,i,e),TR(o,a),n.ancestors.pop(),n.schema=r,n.create(e,i,o,t)}function cke(n,e){if(e.data&&e.data.estree&&n.evaluater){const r=e.data.estree.body[0];return r.type,n.evaluater.evaluateExpression(r.expression)}Bb(n,e.position)}function uke(n,e){if(e.data&&e.data.estree&&n.evaluater)return n.evaluater.evaluateProgram(e.data.estree);Bb(n,e.position)}function dke(n,e,t){const r=n.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=xS,n.schema=s),n.ancestors.push(e);const i=e.name===null?n.Fragment:aY(n,e.name,!0),o=yke(n,e),a=AR(n,e);return oY(n,o,i,e),TR(o,a),n.ancestors.pop(),n.schema=r,n.create(e,i,o,t)}function hke(n,e,t){const r={};return TR(r,AR(n,e)),n.create(e,n.Fragment,r,t)}function fke(n,e){return e.value}function oY(n,e,t,r){typeof t!="string"&&t!==n.Fragment&&n.passNode&&(e.node=r)}function TR(n,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(n.children=t)}}function pke(n,e,t){return r;function r(s,i,o,a){const c=Array.isArray(o.children)?t:e;return a?c(i,o,a):c(i,o)}}function mke(n,e){return t;function t(r,s,i,o){const a=Array.isArray(i.children),l=_R(r);return e(s,i,o,a,{columnNumber:l?l.column-1:void 0,fileName:n,lineNumber:l?l.line:void 0},void 0)}}function gke(n,e){const t={};let r,s;for(s in e.properties)if(s!=="children"&&SR.call(e.properties,s)){const i=xke(n,s,e.properties[s]);if(i){const[o,a]=i;n.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&oke.has(e.tagName)?r=a:t[o]=a}}if(r){const i=t.style||(t.style={});i[n.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function yke(n,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&n.evaluater){const i=r.data.estree.body[0];i.type;const o=i.expression;o.type;const a=o.properties[0];a.type,Object.assign(t,n.evaluater.evaluateExpression(a.argument))}else Bb(n,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&n.evaluater){const a=r.value.data.estree.body[0];a.type,i=n.evaluater.evaluateExpression(a.expression)}else Bb(n,e.position);else i=r.value===null?!0:r.value;t[s]=i}return t}function AR(n,e){const t=[];let r=-1;const s=n.passKeys?new Map:rke;for(;++r<e.children.length;){const i=e.children[r];let o;if(n.passKeys){const l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){const c=s.get(l)||0;o=l+"-"+c,s.set(l,c+1)}}const a=iY(n,i,o);a!==void 0&&t.push(a)}return t}function xke(n,e,t){const r=eY(n.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?f4e(t):E4e(t)),r.property==="style"){let s=typeof t=="object"?t:bke(n,String(t));return n.stylePropertyNameCase==="css"&&(s=vke(s)),["style",s]}return[n.elementAttributeNameCase==="react"&&r.space?k4e[r.property]||r.property:r.attribute,t]}}function bke(n,e){try{return tke(e,{reactCompat:!0})}catch(t){if(n.ignoreInvalidStyle)return{};const r=t,s=new Ii("Cannot parse `style` attribute",{ancestors:n.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=n.filePath||void 0,s.url=sY+"#cannot-parse-style-attribute",s}}function aY(n,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,o;for(;++i<s.length;){const a=IO(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}r=o}else r=IO(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return SR.call(n.components,s)?n.components[s]:s}if(n.evaluater)return n.evaluater.evaluateExpression(r);Bb(n)}function Bb(n,e){const t=new Ii("Cannot handle MDX estrees without `createEvaluater`",{ancestors:n.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=n.filePath||void 0,t.url=sY+"#cannot-handle-mdx-estrees-without-createevaluater",t}function vke(n){const e={};let t;for(t in n)SR.call(n,t)&&(e[wke(t)]=n[t]);return e}function wke(n){let e=n.replace(ske,kke);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function kke(n){return"-"+n.toLowerCase()}const NA={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},_ke={};function ER(n,e){const t=_ke,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,s=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return lY(n,r,s)}function lY(n,e,t){if(Ske(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return VO(n.children,e,t)}return Array.isArray(n)?VO(n,e,t):""}function VO(n,e,t){const r=[];let s=-1;for(;++s<n.length;)r[s]=lY(n[s],e,t);return r.join("")}function Ske(n){return!!(n&&typeof n=="object")}const UO=document.createElement("i");function CR(n){const e="&"+n+";";UO.innerHTML=e;const t=UO.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function da(n,e,t,r){const s=n.length;let i=0,o;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,t=t>0?t:0,r.length<1e4)o=Array.from(r),o.unshift(e,t),n.splice(...o);else for(t&&n.splice(e,t);i<r.length;)o=r.slice(i,i+1e4),o.unshift(e,0),n.splice(...o),i+=1e4,e+=1e4}function Ba(n,e){return n.length>0?(da(n,n.length,0,e),n):e}const HO={}.hasOwnProperty;function cY(n){const e={};let t=-1;for(;++t<n.length;)Tke(e,n[t]);return e}function Tke(n,e){let t;for(t in e){const s=(HO.call(n,t)?n[t]:void 0)||(n[t]={}),i=e[t];let o;if(i)for(o in i){HO.call(s,o)||(s[o]=[]);const a=i[o];Ake(s[o],Array.isArray(a)?a:a?[a]:[])}}}function Ake(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);da(n,0,0,r)}function uY(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}function Ol(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const qi=Af(/[A-Za-z]/),_i=Af(/[\dA-Za-z]/),Eke=Af(/[#-'*+\--9=?A-Z^-~]/);function k5(n){return n!==null&&(n<32||n===127)}const BC=Af(/\d/),Cke=Af(/[\dA-Fa-f]/),Nke=Af(/[!-/:-@[-`{-~]/);function Ke(n){return n!==null&&n<-2}function Bn(n){return n!==null&&(n<0||n===32)}function Wt(n){return n===-2||n===-1||n===32}const vS=Af(new RegExp("\\p{P}|\\p{S}","u")),j0=Af(/\s/);function Af(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function sy(n){const e=[];let t=-1,r=0,s=0;for(;++t<n.length;){const i=n.charCodeAt(t);let o="";if(i===37&&_i(n.charCodeAt(t+1))&&_i(n.charCodeAt(t+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(o=String.fromCharCode(i));else if(i>55295&&i<57344){const a=n.charCodeAt(t+1);i<56320&&a>56319&&a<57344?(o=String.fromCharCode(i,a),s=1):o=""}else o=String.fromCharCode(i);o&&(e.push(n.slice(r,t),encodeURIComponent(o)),r=t+s+1,o=""),s&&(t+=s,s=0)}return e.join("")+n.slice(r)}function qt(n,e,t,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return o;function o(l){return Wt(l)?(n.enter(t),a(l)):e(l)}function a(l){return Wt(l)&&i++<s?(n.consume(l),a):(n.exit(t),e(l))}}const Ike={tokenize:Rke};function Rke(n){const e=n.attempt(this.parser.constructs.contentInitial,r,s);let t;return e;function r(a){if(a===null){n.consume(a);return}return n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),qt(n,e,"linePrefix")}function s(a){return n.enter("paragraph"),i(a)}function i(a){const l=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=l),t=l,o(a)}function o(a){if(a===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(a);return}return Ke(a)?(n.consume(a),n.exit("chunkText"),i):(n.consume(a),o)}}const Mke={tokenize:Pke},qO={tokenize:Lke};function Pke(n){const e=this,t=[];let r=0,s,i,o;return a;function a(k){if(r<t.length){const T=t[r];return e.containerState=T[1],n.attempt(T[0].continuation,l,c)(k)}return c(k)}function l(k){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&w();const T=e.events.length;let R=T,M;for(;R--;)if(e.events[R][0]==="exit"&&e.events[R][1].type==="chunkFlow"){M=e.events[R][1].end;break}b(r);let E=T;for(;E<e.events.length;)e.events[E][1].end={...M},E++;return da(e.events,R+1,0,e.events.slice(T)),e.events.length=E,c(k)}return a(k)}function c(k){if(r===t.length){if(!s)return f(k);if(s.currentConstruct&&s.currentConstruct.concrete)return g(k);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(qO,u,h)(k)}function u(k){return s&&w(),b(r),f(k)}function h(k){return e.parser.lazy[e.now().line]=r!==t.length,o=e.now().offset,g(k)}function f(k){return e.containerState={},n.attempt(qO,p,g)(k)}function p(k){return r++,t.push([e.currentConstruct,e.containerState]),f(k)}function g(k){if(k===null){s&&w(),b(0),n.consume(k);return}return s=s||e.parser.flow(e.now()),n.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),y(k)}function y(k){if(k===null){v(n.exit("chunkFlow"),!0),b(0),n.consume(k);return}return Ke(k)?(n.consume(k),v(n.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(n.consume(k),y)}function v(k,T){const R=e.sliceStream(k);if(T&&R.push(null),k.previous=i,i&&(i.next=k),i=k,s.defineSkip(k.start),s.write(R),e.parser.lazy[k.start.line]){let M=s.events.length;for(;M--;)if(s.events[M][1].start.offset<o&&(!s.events[M][1].end||s.events[M][1].end.offset>o))return;const E=e.events.length;let I=E,S,N;for(;I--;)if(e.events[I][0]==="exit"&&e.events[I][1].type==="chunkFlow"){if(S){N=e.events[I][1].end;break}S=!0}for(b(r),M=E;M<e.events.length;)e.events[M][1].end={...N},M++;da(e.events,I+1,0,e.events.slice(E)),e.events.length=M}}function b(k){let T=t.length;for(;T-- >k;){const R=t[T];e.containerState=R[1],R[0].exit.call(e,n)}t.length=k}function w(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function Lke(n,e,t){return qt(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function $1(n){if(n===null||Bn(n)||j0(n))return 1;if(vS(n))return 2}function wS(n,e,t){const r=[];let s=-1;for(;++s<n.length;){const i=n[s].resolveAll;i&&!r.includes(i)&&(e=i(e,t),r.push(i))}return e}const $C={name:"attention",resolveAll:Dke,tokenize:jke};function Dke(n,e){let t=-1,r,s,i,o,a,l,c,u;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;l=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const h={...n[r][1].end},f={...n[t][1].start};GO(h,-l),GO(f,l),o={type:l>1?"strongSequence":"emphasisSequence",start:h,end:{...n[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...n[t][1].start},end:f},i={type:l>1?"strongText":"emphasisText",start:{...n[r][1].end},end:{...n[t][1].start}},s={type:l>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},n[r][1].end={...o.start},n[t][1].start={...a.end},c=[],n[r][1].end.offset-n[r][1].start.offset&&(c=Ba(c,[["enter",n[r][1],e],["exit",n[r][1],e]])),c=Ba(c,[["enter",s,e],["enter",o,e],["exit",o,e],["enter",i,e]]),c=Ba(c,wS(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),c=Ba(c,[["exit",i,e],["enter",a,e],["exit",a,e],["exit",s,e]]),n[t][1].end.offset-n[t][1].start.offset?(u=2,c=Ba(c,[["enter",n[t][1],e],["exit",n[t][1],e]])):u=0,da(n,r-1,t-r+3,c),t=r+c.length-u-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function jke(n,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,s=$1(r);let i;return o;function o(l){return i=l,n.enter("attentionSequence"),a(l)}function a(l){if(l===i)return n.consume(l),a;const c=n.exit("attentionSequence"),u=$1(l),h=!u||u===2&&s||t.includes(l),f=!s||s===2&&u||t.includes(r);return c._open=!!(i===42?h:h&&(s||!f)),c._close=!!(i===42?f:f&&(u||!h)),e(l)}}function GO(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const Oke={name:"autolink",tokenize:Fke};function Fke(n,e,t){let r=0;return s;function s(p){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),i}function i(p){return qi(p)?(n.consume(p),o):p===64?t(p):c(p)}function o(p){return p===43||p===45||p===46||_i(p)?(r=1,a(p)):c(p)}function a(p){return p===58?(n.consume(p),r=0,l):(p===43||p===45||p===46||_i(p))&&r++<32?(n.consume(p),a):(r=0,c(p))}function l(p){return p===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):p===null||p===32||p===60||k5(p)?t(p):(n.consume(p),l)}function c(p){return p===64?(n.consume(p),u):Eke(p)?(n.consume(p),c):t(p)}function u(p){return _i(p)?h(p):t(p)}function h(p){return p===46?(n.consume(p),r=0,u):p===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(p),n.exit("autolinkMarker"),n.exit("autolink"),e):f(p)}function f(p){if((p===45||_i(p))&&r++<63){const g=p===45?f:h;return n.consume(p),g}return t(p)}}const r2={partial:!0,tokenize:zke};function zke(n,e,t){return r;function r(i){return Wt(i)?qt(n,s,"linePrefix")(i):s(i)}function s(i){return i===null||Ke(i)?e(i):t(i)}}const dY={continuation:{tokenize:$ke},exit:Vke,name:"blockQuote",tokenize:Bke};function Bke(n,e,t){const r=this;return s;function s(o){if(o===62){const a=r.containerState;return a.open||(n.enter("blockQuote",{_container:!0}),a.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(o),n.exit("blockQuoteMarker"),i}return t(o)}function i(o){return Wt(o)?(n.enter("blockQuotePrefixWhitespace"),n.consume(o),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(o))}}function $ke(n,e,t){const r=this;return s;function s(o){return Wt(o)?qt(n,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):i(o)}function i(o){return n.attempt(dY,e,t)(o)}}function Vke(n){n.exit("blockQuote")}const hY={name:"characterEscape",tokenize:Uke};function Uke(n,e,t){return r;function r(i){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(i),n.exit("escapeMarker"),s}function s(i){return Nke(i)?(n.enter("characterEscapeValue"),n.consume(i),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(i)}}const fY={name:"characterReference",tokenize:Hke};function Hke(n,e,t){const r=this;let s=0,i,o;return a;function a(h){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),l}function l(h){return h===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(h),n.exit("characterReferenceMarkerNumeric"),c):(n.enter("characterReferenceValue"),i=31,o=_i,u(h))}function c(h){return h===88||h===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(h),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),i=6,o=Cke,u):(n.enter("characterReferenceValue"),i=7,o=BC,u(h))}function u(h){if(h===59&&s){const f=n.exit("characterReferenceValue");return o===_i&&!CR(r.sliceSerialize(f))?t(h):(n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return o(h)&&s++<i?(n.consume(h),u):t(h)}}const WO={partial:!0,tokenize:Gke},KO={concrete:!0,name:"codeFenced",tokenize:qke};function qke(n,e,t){const r=this,s={partial:!0,tokenize:R};let i=0,o=0,a;return l;function l(M){return c(M)}function c(M){const E=r.events[r.events.length-1];return i=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,a=M,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),u(M)}function u(M){return M===a?(o++,n.consume(M),u):o<3?t(M):(n.exit("codeFencedFenceSequence"),Wt(M)?qt(n,h,"whitespace")(M):h(M))}function h(M){return M===null||Ke(M)?(n.exit("codeFencedFence"),r.interrupt?e(M):n.check(WO,y,T)(M)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),f(M))}function f(M){return M===null||Ke(M)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),h(M)):Wt(M)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),qt(n,p,"whitespace")(M)):M===96&&M===a?t(M):(n.consume(M),f)}function p(M){return M===null||Ke(M)?h(M):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),g(M))}function g(M){return M===null||Ke(M)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),h(M)):M===96&&M===a?t(M):(n.consume(M),g)}function y(M){return n.attempt(s,T,v)(M)}function v(M){return n.enter("lineEnding"),n.consume(M),n.exit("lineEnding"),b}function b(M){return i>0&&Wt(M)?qt(n,w,"linePrefix",i+1)(M):w(M)}function w(M){return M===null||Ke(M)?n.check(WO,y,T)(M):(n.enter("codeFlowValue"),k(M))}function k(M){return M===null||Ke(M)?(n.exit("codeFlowValue"),w(M)):(n.consume(M),k)}function T(M){return n.exit("codeFenced"),e(M)}function R(M,E,I){let S=0;return N;function N(J){return M.enter("lineEnding"),M.consume(J),M.exit("lineEnding"),P}function P(J){return M.enter("codeFencedFence"),Wt(J)?qt(M,O,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(J):O(J)}function O(J){return J===a?(M.enter("codeFencedFenceSequence"),D(J)):I(J)}function D(J){return J===a?(S++,M.consume(J),D):S>=o?(M.exit("codeFencedFenceSequence"),Wt(J)?qt(M,G,"whitespace")(J):G(J)):I(J)}function G(J){return J===null||Ke(J)?(M.exit("codeFencedFence"),E(J)):I(J)}}}function Gke(n,e,t){const r=this;return s;function s(o){return o===null?t(o):(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?t(o):e(o)}}const IA={name:"codeIndented",tokenize:Kke},Wke={partial:!0,tokenize:Yke};function Kke(n,e,t){const r=this;return s;function s(c){return n.enter("codeIndented"),qt(n,i,"linePrefix",5)(c)}function i(c){const u=r.events[r.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?o(c):t(c)}function o(c){return c===null?l(c):Ke(c)?n.attempt(Wke,o,l)(c):(n.enter("codeFlowValue"),a(c))}function a(c){return c===null||Ke(c)?(n.exit("codeFlowValue"),o(c)):(n.consume(c),a)}function l(c){return n.exit("codeIndented"),e(c)}}function Yke(n,e,t){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?t(o):Ke(o)?(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),s):qt(n,i,"linePrefix",5)(o)}function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):Ke(o)?s(o):t(o)}}const Xke={name:"codeText",previous:Qke,resolve:Jke,tokenize:Zke};function Jke(n){let e=n.length-4,t=3,r,s;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)s===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(s=r):(r===e||n[r][1].type==="lineEnding")&&(n[s][1].type="codeTextData",r!==s+2&&(n[s][1].end=n[r-1][1].end,n.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return n}function Qke(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Zke(n,e,t){let r=0,s,i;return o;function o(h){return n.enter("codeText"),n.enter("codeTextSequence"),a(h)}function a(h){return h===96?(n.consume(h),r++,a):(n.exit("codeTextSequence"),l(h))}function l(h){return h===null?t(h):h===32?(n.enter("space"),n.consume(h),n.exit("space"),l):h===96?(i=n.enter("codeTextSequence"),s=0,u(h)):Ke(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),l):(n.enter("codeTextData"),c(h))}function c(h){return h===null||h===32||h===96||Ke(h)?(n.exit("codeTextData"),l(h)):(n.consume(h),c)}function u(h){return h===96?(n.consume(h),s++,u):s===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(h)):(i.type="codeTextData",c(h))}}class e_e{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const s=t||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&Ny(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Ny(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Ny(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Ny(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Ny(this.left,t.reverse())}}}function Ny(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function pY(n){const e={};let t=-1,r,s,i,o,a,l,c;const u=new e_e(n);for(;++t<u.length;){for(;t in e;)t=e[t];if(r=u.get(t),t&&r[1].type==="chunkFlow"&&u.get(t-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,t_e(u,t)),t=e[t],c=!0);else if(r[1]._container){for(i=t,s=void 0;i--;)if(o=u.get(i),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(u.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=i);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...u.get(s)[1].start},a=u.slice(s,t),a.unshift(r),u.splice(s,t-s+1,a))}}return da(n,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function t_e(n,e){const t=n.get(e)[1],r=n.get(e)[2];let s=e-1;const i=[];let o=t._tokenizer;o||(o=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,l=[],c={};let u,h,f=-1,p=t,g=0,y=0;const v=[y];for(;p;){for(;n.get(++s)[1]!==p;);i.push(s),p._tokenizer||(u=r.sliceStream(p),p.next||u.push(null),h&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(u),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),h=p,p=p.next}for(p=t;++f<a.length;)a[f][0]==="exit"&&a[f-1][0]==="enter"&&a[f][1].type===a[f-1][1].type&&a[f][1].start.line!==a[f][1].end.line&&(y=f+1,v.push(y),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):v.pop(),f=v.length;f--;){const b=a.slice(v[f],v[f+1]),w=i.pop();l.push([w,w+b.length-1]),n.splice(w,2,b)}for(l.reverse(),f=-1;++f<l.length;)c[g+l[f][0]]=g+l[f][1],g+=l[f][1]-l[f][0]-1;return c}const n_e={resolve:s_e,tokenize:i_e},r_e={partial:!0,tokenize:o_e};function s_e(n){return pY(n),n}function i_e(n,e){let t;return r;function r(a){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?i(a):Ke(a)?n.check(r_e,o,i)(a):(n.consume(a),s)}function i(a){return n.exit("chunkContent"),n.exit("content"),e(a)}function o(a){return n.consume(a),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,s}}function o_e(n,e,t){const r=this;return s;function s(o){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),qt(n,i,"linePrefix")}function i(o){if(o===null||Ke(o))return t(o);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(o):n.interrupt(r.parser.constructs.flow,t,e)(o)}}function mY(n,e,t,r,s,i,o,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return h;function h(b){return b===60?(n.enter(r),n.enter(s),n.enter(i),n.consume(b),n.exit(i),f):b===null||b===32||b===41||k5(b)?t(b):(n.enter(r),n.enter(o),n.enter(a),n.enter("chunkString",{contentType:"string"}),y(b))}function f(b){return b===62?(n.enter(i),n.consume(b),n.exit(i),n.exit(s),n.exit(r),e):(n.enter(a),n.enter("chunkString",{contentType:"string"}),p(b))}function p(b){return b===62?(n.exit("chunkString"),n.exit(a),f(b)):b===null||b===60||Ke(b)?t(b):(n.consume(b),b===92?g:p)}function g(b){return b===60||b===62||b===92?(n.consume(b),p):p(b)}function y(b){return!u&&(b===null||b===41||Bn(b))?(n.exit("chunkString"),n.exit(a),n.exit(o),n.exit(r),e(b)):u<c&&b===40?(n.consume(b),u++,y):b===41?(n.consume(b),u--,y):b===null||b===32||b===40||k5(b)?t(b):(n.consume(b),b===92?v:y)}function v(b){return b===40||b===41||b===92?(n.consume(b),y):y(b)}}function gY(n,e,t,r,s,i){const o=this;let a=0,l;return c;function c(p){return n.enter(r),n.enter(s),n.consume(p),n.exit(s),n.enter(i),u}function u(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?t(p):p===93?(n.exit(i),n.enter(s),n.consume(p),n.exit(s),n.exit(r),e):Ke(p)?(n.enter("lineEnding"),n.consume(p),n.exit("lineEnding"),u):(n.enter("chunkString",{contentType:"string"}),h(p))}function h(p){return p===null||p===91||p===93||Ke(p)||a++>999?(n.exit("chunkString"),u(p)):(n.consume(p),l||(l=!Wt(p)),p===92?f:h)}function f(p){return p===91||p===92||p===93?(n.consume(p),a++,h):h(p)}}function yY(n,e,t,r,s,i){let o;return a;function a(f){return f===34||f===39||f===40?(n.enter(r),n.enter(s),n.consume(f),n.exit(s),o=f===40?41:f,l):t(f)}function l(f){return f===o?(n.enter(s),n.consume(f),n.exit(s),n.exit(r),e):(n.enter(i),c(f))}function c(f){return f===o?(n.exit(i),l(o)):f===null?t(f):Ke(f)?(n.enter("lineEnding"),n.consume(f),n.exit("lineEnding"),qt(n,c,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),u(f))}function u(f){return f===o||f===null||Ke(f)?(n.exit("chunkString"),c(f)):(n.consume(f),f===92?h:u)}function h(f){return f===o||f===92?(n.consume(f),u):u(f)}}function qx(n,e){let t;return r;function r(s){return Ke(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),t=!0,r):Wt(s)?qt(n,r,t?"linePrefix":"lineSuffix")(s):e(s)}}const a_e={name:"definition",tokenize:c_e},l_e={partial:!0,tokenize:u_e};function c_e(n,e,t){const r=this;let s;return i;function i(p){return n.enter("definition"),o(p)}function o(p){return gY.call(r,n,a,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return s=Ol(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(n.enter("definitionMarker"),n.consume(p),n.exit("definitionMarker"),l):t(p)}function l(p){return Bn(p)?qx(n,c)(p):c(p)}function c(p){return mY(n,u,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return n.attempt(l_e,h,h)(p)}function h(p){return Wt(p)?qt(n,f,"whitespace")(p):f(p)}function f(p){return p===null||Ke(p)?(n.exit("definition"),r.parser.defined.push(s),e(p)):t(p)}}function u_e(n,e,t){return r;function r(a){return Bn(a)?qx(n,s)(a):t(a)}function s(a){return yY(n,i,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return Wt(a)?qt(n,o,"whitespace")(a):o(a)}function o(a){return a===null||Ke(a)?e(a):t(a)}}const d_e={name:"hardBreakEscape",tokenize:h_e};function h_e(n,e,t){return r;function r(i){return n.enter("hardBreakEscape"),n.consume(i),s}function s(i){return Ke(i)?(n.exit("hardBreakEscape"),e(i)):t(i)}}const f_e={name:"headingAtx",resolve:p_e,tokenize:m_e};function p_e(n,e){let t=n.length-2,r=3,s,i;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(s={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},i={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},da(n,r,t-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),n}function m_e(n,e,t){let r=0;return s;function s(u){return n.enter("atxHeading"),i(u)}function i(u){return n.enter("atxHeadingSequence"),o(u)}function o(u){return u===35&&r++<6?(n.consume(u),o):u===null||Bn(u)?(n.exit("atxHeadingSequence"),a(u)):t(u)}function a(u){return u===35?(n.enter("atxHeadingSequence"),l(u)):u===null||Ke(u)?(n.exit("atxHeading"),e(u)):Wt(u)?qt(n,a,"whitespace")(u):(n.enter("atxHeadingText"),c(u))}function l(u){return u===35?(n.consume(u),l):(n.exit("atxHeadingSequence"),a(u))}function c(u){return u===null||u===35||Bn(u)?(n.exit("atxHeadingText"),a(u)):(n.consume(u),c)}}const g_e=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],YO=["pre","script","style","textarea"],y_e={concrete:!0,name:"htmlFlow",resolveTo:v_e,tokenize:w_e},x_e={partial:!0,tokenize:__e},b_e={partial:!0,tokenize:k_e};function v_e(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function w_e(n,e,t){const r=this;let s,i,o,a,l;return c;function c(W){return u(W)}function u(W){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(W),h}function h(W){return W===33?(n.consume(W),f):W===47?(n.consume(W),i=!0,y):W===63?(n.consume(W),s=3,r.interrupt?e:H):qi(W)?(n.consume(W),o=String.fromCharCode(W),v):t(W)}function f(W){return W===45?(n.consume(W),s=2,p):W===91?(n.consume(W),s=5,a=0,g):qi(W)?(n.consume(W),s=4,r.interrupt?e:H):t(W)}function p(W){return W===45?(n.consume(W),r.interrupt?e:H):t(W)}function g(W){const dt="CDATA[";return W===dt.charCodeAt(a++)?(n.consume(W),a===dt.length?r.interrupt?e:O:g):t(W)}function y(W){return qi(W)?(n.consume(W),o=String.fromCharCode(W),v):t(W)}function v(W){if(W===null||W===47||W===62||Bn(W)){const dt=W===47,Me=o.toLowerCase();return!dt&&!i&&YO.includes(Me)?(s=1,r.interrupt?e(W):O(W)):g_e.includes(o.toLowerCase())?(s=6,dt?(n.consume(W),b):r.interrupt?e(W):O(W)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(W):i?w(W):k(W))}return W===45||_i(W)?(n.consume(W),o+=String.fromCharCode(W),v):t(W)}function b(W){return W===62?(n.consume(W),r.interrupt?e:O):t(W)}function w(W){return Wt(W)?(n.consume(W),w):N(W)}function k(W){return W===47?(n.consume(W),N):W===58||W===95||qi(W)?(n.consume(W),T):Wt(W)?(n.consume(W),k):N(W)}function T(W){return W===45||W===46||W===58||W===95||_i(W)?(n.consume(W),T):R(W)}function R(W){return W===61?(n.consume(W),M):Wt(W)?(n.consume(W),R):k(W)}function M(W){return W===null||W===60||W===61||W===62||W===96?t(W):W===34||W===39?(n.consume(W),l=W,E):Wt(W)?(n.consume(W),M):I(W)}function E(W){return W===l?(n.consume(W),l=null,S):W===null||Ke(W)?t(W):(n.consume(W),E)}function I(W){return W===null||W===34||W===39||W===47||W===60||W===61||W===62||W===96||Bn(W)?R(W):(n.consume(W),I)}function S(W){return W===47||W===62||Wt(W)?k(W):t(W)}function N(W){return W===62?(n.consume(W),P):t(W)}function P(W){return W===null||Ke(W)?O(W):Wt(W)?(n.consume(W),P):t(W)}function O(W){return W===45&&s===2?(n.consume(W),Q):W===60&&s===1?(n.consume(W),re):W===62&&s===4?(n.consume(W),ce):W===63&&s===3?(n.consume(W),H):W===93&&s===5?(n.consume(W),te):Ke(W)&&(s===6||s===7)?(n.exit("htmlFlowData"),n.check(x_e,xe,D)(W)):W===null||Ke(W)?(n.exit("htmlFlowData"),D(W)):(n.consume(W),O)}function D(W){return n.check(b_e,G,xe)(W)}function G(W){return n.enter("lineEnding"),n.consume(W),n.exit("lineEnding"),J}function J(W){return W===null||Ke(W)?D(W):(n.enter("htmlFlowData"),O(W))}function Q(W){return W===45?(n.consume(W),H):O(W)}function re(W){return W===47?(n.consume(W),o="",ne):O(W)}function ne(W){if(W===62){const dt=o.toLowerCase();return YO.includes(dt)?(n.consume(W),ce):O(W)}return qi(W)&&o.length<8?(n.consume(W),o+=String.fromCharCode(W),ne):O(W)}function te(W){return W===93?(n.consume(W),H):O(W)}function H(W){return W===62?(n.consume(W),ce):W===45&&s===2?(n.consume(W),H):O(W)}function ce(W){return W===null||Ke(W)?(n.exit("htmlFlowData"),xe(W)):(n.consume(W),ce)}function xe(W){return n.exit("htmlFlow"),e(W)}}function k_e(n,e,t){const r=this;return s;function s(o){return Ke(o)?(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),i):t(o)}function i(o){return r.parser.lazy[r.now().line]?t(o):e(o)}}function __e(n,e,t){return r;function r(s){return n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),n.attempt(r2,e,t)}}const S_e={name:"htmlText",tokenize:T_e};function T_e(n,e,t){const r=this;let s,i,o;return a;function a(H){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume(H),l}function l(H){return H===33?(n.consume(H),c):H===47?(n.consume(H),R):H===63?(n.consume(H),k):qi(H)?(n.consume(H),I):t(H)}function c(H){return H===45?(n.consume(H),u):H===91?(n.consume(H),i=0,g):qi(H)?(n.consume(H),w):t(H)}function u(H){return H===45?(n.consume(H),p):t(H)}function h(H){return H===null?t(H):H===45?(n.consume(H),f):Ke(H)?(o=h,re(H)):(n.consume(H),h)}function f(H){return H===45?(n.consume(H),p):h(H)}function p(H){return H===62?Q(H):H===45?f(H):h(H)}function g(H){const ce="CDATA[";return H===ce.charCodeAt(i++)?(n.consume(H),i===ce.length?y:g):t(H)}function y(H){return H===null?t(H):H===93?(n.consume(H),v):Ke(H)?(o=y,re(H)):(n.consume(H),y)}function v(H){return H===93?(n.consume(H),b):y(H)}function b(H){return H===62?Q(H):H===93?(n.consume(H),b):y(H)}function w(H){return H===null||H===62?Q(H):Ke(H)?(o=w,re(H)):(n.consume(H),w)}function k(H){return H===null?t(H):H===63?(n.consume(H),T):Ke(H)?(o=k,re(H)):(n.consume(H),k)}function T(H){return H===62?Q(H):k(H)}function R(H){return qi(H)?(n.consume(H),M):t(H)}function M(H){return H===45||_i(H)?(n.consume(H),M):E(H)}function E(H){return Ke(H)?(o=E,re(H)):Wt(H)?(n.consume(H),E):Q(H)}function I(H){return H===45||_i(H)?(n.consume(H),I):H===47||H===62||Bn(H)?S(H):t(H)}function S(H){return H===47?(n.consume(H),Q):H===58||H===95||qi(H)?(n.consume(H),N):Ke(H)?(o=S,re(H)):Wt(H)?(n.consume(H),S):Q(H)}function N(H){return H===45||H===46||H===58||H===95||_i(H)?(n.consume(H),N):P(H)}function P(H){return H===61?(n.consume(H),O):Ke(H)?(o=P,re(H)):Wt(H)?(n.consume(H),P):S(H)}function O(H){return H===null||H===60||H===61||H===62||H===96?t(H):H===34||H===39?(n.consume(H),s=H,D):Ke(H)?(o=O,re(H)):Wt(H)?(n.consume(H),O):(n.consume(H),G)}function D(H){return H===s?(n.consume(H),s=void 0,J):H===null?t(H):Ke(H)?(o=D,re(H)):(n.consume(H),D)}function G(H){return H===null||H===34||H===39||H===60||H===61||H===96?t(H):H===47||H===62||Bn(H)?S(H):(n.consume(H),G)}function J(H){return H===47||H===62||Bn(H)?S(H):t(H)}function Q(H){return H===62?(n.consume(H),n.exit("htmlTextData"),n.exit("htmlText"),e):t(H)}function re(H){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume(H),n.exit("lineEnding"),ne}function ne(H){return Wt(H)?qt(n,te,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):te(H)}function te(H){return n.enter("htmlTextData"),o(H)}}const NR={name:"labelEnd",resolveAll:N_e,resolveTo:I_e,tokenize:R_e},A_e={tokenize:M_e},E_e={tokenize:P_e},C_e={tokenize:L_e};function N_e(n){let e=-1;const t=[];for(;++e<n.length;){const r=n[e][1];if(t.push(n[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return n.length!==t.length&&da(n,0,n.length,t),n}function I_e(n,e){let t=n.length,r=0,s,i,o,a;for(;t--;)if(s=n[t][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;n[t][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(n[t][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=t,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=t);const l={type:n[i][1].type==="labelLink"?"link":"image",start:{...n[i][1].start},end:{...n[n.length-1][1].end}},c={type:"label",start:{...n[i][1].start},end:{...n[o][1].end}},u={type:"labelText",start:{...n[i+r+2][1].end},end:{...n[o-2][1].start}};return a=[["enter",l,e],["enter",c,e]],a=Ba(a,n.slice(i+1,i+r+3)),a=Ba(a,[["enter",u,e]]),a=Ba(a,wS(e.parser.constructs.insideSpan.null,n.slice(i+r+4,o-3),e)),a=Ba(a,[["exit",u,e],n[o-2],n[o-1],["exit",c,e]]),a=Ba(a,n.slice(o+1)),a=Ba(a,[["exit",l,e]]),da(n,i,n.length,a),n}function R_e(n,e,t){const r=this;let s=r.events.length,i,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return a;function a(f){return i?i._inactive?h(f):(o=r.parser.defined.includes(Ol(r.sliceSerialize({start:i.end,end:r.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(f),n.exit("labelMarker"),n.exit("labelEnd"),l):t(f)}function l(f){return f===40?n.attempt(A_e,u,o?u:h)(f):f===91?n.attempt(E_e,u,o?c:h)(f):o?u(f):h(f)}function c(f){return n.attempt(C_e,u,h)(f)}function u(f){return e(f)}function h(f){return i._balanced=!0,t(f)}}function M_e(n,e,t){return r;function r(h){return n.enter("resource"),n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),s}function s(h){return Bn(h)?qx(n,i)(h):i(h)}function i(h){return h===41?u(h):mY(n,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function o(h){return Bn(h)?qx(n,l)(h):u(h)}function a(h){return t(h)}function l(h){return h===34||h===39||h===40?yY(n,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):u(h)}function c(h){return Bn(h)?qx(n,u)(h):u(h)}function u(h){return h===41?(n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),n.exit("resource"),e):t(h)}}function P_e(n,e,t){const r=this;return s;function s(a){return gY.call(r,n,i,o,"reference","referenceMarker","referenceString")(a)}function i(a){return r.parser.defined.includes(Ol(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):t(a)}function o(a){return t(a)}}function L_e(n,e,t){return r;function r(i){return n.enter("reference"),n.enter("referenceMarker"),n.consume(i),n.exit("referenceMarker"),s}function s(i){return i===93?(n.enter("referenceMarker"),n.consume(i),n.exit("referenceMarker"),n.exit("reference"),e):t(i)}}const D_e={name:"labelStartImage",resolveAll:NR.resolveAll,tokenize:j_e};function j_e(n,e,t){const r=this;return s;function s(a){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(a),n.exit("labelImageMarker"),i}function i(a){return a===91?(n.enter("labelMarker"),n.consume(a),n.exit("labelMarker"),n.exit("labelImage"),o):t(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(a):e(a)}}const O_e={name:"labelStartLink",resolveAll:NR.resolveAll,tokenize:F_e};function F_e(n,e,t){const r=this;return s;function s(o){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelLink"),i}function i(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const RA={name:"lineEnding",tokenize:z_e};function z_e(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),qt(n,e,"linePrefix")}}const Z4={name:"thematicBreak",tokenize:B_e};function B_e(n,e,t){let r=0,s;return i;function i(c){return n.enter("thematicBreak"),o(c)}function o(c){return s=c,a(c)}function a(c){return c===s?(n.enter("thematicBreakSequence"),l(c)):r>=3&&(c===null||Ke(c))?(n.exit("thematicBreak"),e(c)):t(c)}function l(c){return c===s?(n.consume(c),r++,l):(n.exit("thematicBreakSequence"),Wt(c)?qt(n,a,"whitespace")(c):a(c))}}const fo={continuation:{tokenize:H_e},exit:G_e,name:"list",tokenize:U_e},$_e={partial:!0,tokenize:W_e},V_e={partial:!0,tokenize:q_e};function U_e(n,e,t){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(p){const g=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(g==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:BC(p)){if(r.containerState.type||(r.containerState.type=g,n.enter(g,{_container:!0})),g==="listUnordered")return n.enter("listItemPrefix"),p===42||p===45?n.check(Z4,t,c)(p):c(p);if(!r.interrupt||p===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),l(p)}return t(p)}function l(p){return BC(p)&&++o<10?(n.consume(p),l):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(n.exit("listItemValue"),c(p)):t(p)}function c(p){return n.enter("listItemMarker"),n.consume(p),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,n.check(r2,r.interrupt?t:u,n.attempt($_e,f,h))}function u(p){return r.containerState.initialBlankLine=!0,i++,f(p)}function h(p){return Wt(p)?(n.enter("listItemPrefixWhitespace"),n.consume(p),n.exit("listItemPrefixWhitespace"),f):t(p)}function f(p){return r.containerState.size=i+r.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(p)}}function H_e(n,e,t){const r=this;return r.containerState._closeFlow=void 0,n.check(r2,s,i);function s(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,qt(n,e,"listItemIndent",r.containerState.size+1)(a)}function i(a){return r.containerState.furtherBlankLines||!Wt(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,n.attempt(V_e,e,o)(a))}function o(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,qt(n,n.attempt(fo,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function q_e(n,e,t){const r=this;return qt(n,s,"listItemIndent",r.containerState.size+1);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?e(i):t(i)}}function G_e(n){n.exit(this.containerState.type)}function W_e(n,e,t){const r=this;return qt(n,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(i){const o=r.events[r.events.length-1];return!Wt(i)&&o&&o[1].type==="listItemPrefixWhitespace"?e(i):t(i)}}const XO={name:"setextUnderline",resolveTo:K_e,tokenize:Y_e};function K_e(n,e){let t=n.length,r,s,i;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(s=t)}else n[t][1].type==="content"&&n.splice(t,1),!i&&n[t][1].type==="definition"&&(i=t);const o={type:"setextHeading",start:{...n[r][1].start},end:{...n[n.length-1][1].end}};return n[s][1].type="setextHeadingText",i?(n.splice(s,0,["enter",o,e]),n.splice(i+1,0,["exit",n[r][1],e]),n[r][1].end={...n[i][1].end}):n[r][1]=o,n.push(["exit",o,e]),n}function Y_e(n,e,t){const r=this;let s;return i;function i(c){let u=r.events.length,h;for(;u--;)if(r.events[u][1].type!=="lineEnding"&&r.events[u][1].type!=="linePrefix"&&r.events[u][1].type!=="content"){h=r.events[u][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||h)?(n.enter("setextHeadingLine"),s=c,o(c)):t(c)}function o(c){return n.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===s?(n.consume(c),a):(n.exit("setextHeadingLineSequence"),Wt(c)?qt(n,l,"lineSuffix")(c):l(c))}function l(c){return c===null||Ke(c)?(n.exit("setextHeadingLine"),e(c)):t(c)}}const X_e={tokenize:J_e};function J_e(n){const e=this,t=n.attempt(r2,r,n.attempt(this.parser.constructs.flowInitial,s,qt(n,n.attempt(this.parser.constructs.flow,s,n.attempt(n_e,s)),"linePrefix")));return t;function r(i){if(i===null){n.consume(i);return}return n.enter("lineEndingBlank"),n.consume(i),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function s(i){if(i===null){n.consume(i);return}return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const Q_e={resolveAll:bY()},Z_e=xY("string"),e5e=xY("text");function xY(n){return{resolveAll:bY(n==="text"?t5e:void 0),tokenize:e};function e(t){const r=this,s=this.parser.constructs[n],i=t.attempt(s,o,a);return o;function o(u){return c(u)?i(u):a(u)}function a(u){if(u===null){t.consume(u);return}return t.enter("data"),t.consume(u),l}function l(u){return c(u)?(t.exit("data"),i(u)):(t.consume(u),l)}function c(u){if(u===null)return!0;const h=s[u];let f=-1;if(h)for(;++f<h.length;){const p=h[f];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function bY(n){return e;function e(t,r){let s=-1,i;for(;++s<=t.length;)i===void 0?t[s]&&t[s][1].type==="data"&&(i=s,s++):(!t[s]||t[s][1].type!=="data")&&(s!==i+2&&(t[i][1].end=t[s-1][1].end,t.splice(i+2,s-i-2),s=i+2),i=void 0);return n?n(t,r):t}}function t5e(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const r=n[t-1][1],s=e.sliceStream(r);let i=s.length,o=-1,a=0,l;for(;i--;){const c=s[i];if(typeof c=="string"){for(o=c.length;c.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(c===-2)l=!0,a++;else if(c!==-1){i++;break}}if(e._contentTypeTextTrailing&&t===n.length&&(a=0),a){const c={type:t===n.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?o:r.start._bufferIndex+o,_index:r.start._index+i,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(n.splice(t,0,["enter",c,e],["exit",c,e]),t+=2)}t++}return n}const n5e={42:fo,43:fo,45:fo,48:fo,49:fo,50:fo,51:fo,52:fo,53:fo,54:fo,55:fo,56:fo,57:fo,62:dY},r5e={91:a_e},s5e={[-2]:IA,[-1]:IA,32:IA},i5e={35:f_e,42:Z4,45:[XO,Z4],60:y_e,61:XO,95:Z4,96:KO,126:KO},o5e={38:fY,92:hY},a5e={[-5]:RA,[-4]:RA,[-3]:RA,33:D_e,38:fY,42:$C,60:[Oke,S_e],91:O_e,92:[d_e,hY],93:NR,95:$C,96:Xke},l5e={null:[$C,Q_e]},c5e={null:[42,95]},u5e={null:[]},d5e=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:c5e,contentInitial:r5e,disable:u5e,document:n5e,flow:i5e,flowInitial:s5e,insideSpan:l5e,string:o5e,text:a5e},Symbol.toStringTag,{value:"Module"}));function h5e(n,e,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const s={},i=[];let o=[],a=[];const l={attempt:E(R),check:E(M),consume:w,enter:k,exit:T,interrupt:E(M,{interrupt:!0})},c={code:null,containerState:{},defineSkip:y,events:[],now:g,parser:n,previous:null,sliceSerialize:f,sliceStream:p,write:h};let u=e.tokenize.call(c,l);return e.resolveAll&&i.push(e),c;function h(P){return o=Ba(o,P),v(),o[o.length-1]!==null?[]:(I(e,0),c.events=wS(i,c.events,c),c.events)}function f(P,O){return p5e(p(P),O)}function p(P){return f5e(o,P)}function g(){const{_bufferIndex:P,_index:O,line:D,column:G,offset:J}=r;return{_bufferIndex:P,_index:O,line:D,column:G,offset:J}}function y(P){s[P.line]=P.column,N()}function v(){let P;for(;r._index<o.length;){const O=o[r._index];if(typeof O=="string")for(P=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===P&&r._bufferIndex<O.length;)b(O.charCodeAt(r._bufferIndex));else b(O)}}function b(P){u=u(P)}function w(P){Ke(P)?(r.line++,r.column=1,r.offset+=P===-3?2:1,N()):P!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=P}function k(P,O){const D=O||{};return D.type=P,D.start=g(),c.events.push(["enter",D,c]),a.push(D),D}function T(P){const O=a.pop();return O.end=g(),c.events.push(["exit",O,c]),O}function R(P,O){I(P,O.from)}function M(P,O){O.restore()}function E(P,O){return D;function D(G,J,Q){let re,ne,te,H;return Array.isArray(G)?xe(G):"tokenize"in G?xe([G]):ce(G);function ce(Fe){return Ae;function Ae(lt){const sn=lt!==null&&Fe[lt],un=lt!==null&&Fe.null,Sr=[...Array.isArray(sn)?sn:sn?[sn]:[],...Array.isArray(un)?un:un?[un]:[]];return xe(Sr)(lt)}}function xe(Fe){return re=Fe,ne=0,Fe.length===0?Q:W(Fe[ne])}function W(Fe){return Ae;function Ae(lt){return H=S(),te=Fe,Fe.partial||(c.currentConstruct=Fe),Fe.name&&c.parser.constructs.disable.null.includes(Fe.name)?Me():Fe.tokenize.call(O?Object.assign(Object.create(c),O):c,l,dt,Me)(lt)}}function dt(Fe){return P(te,H),J}function Me(Fe){return H.restore(),++ne<re.length?W(re[ne]):Q}}}function I(P,O){P.resolveAll&&!i.includes(P)&&i.push(P),P.resolve&&da(c.events,O,c.events.length-O,P.resolve(c.events.slice(O),c)),P.resolveTo&&(c.events=P.resolveTo(c.events,c))}function S(){const P=g(),O=c.previous,D=c.currentConstruct,G=c.events.length,J=Array.from(a);return{from:G,restore:Q};function Q(){r=P,c.previous=O,c.currentConstruct=D,c.events.length=G,a=J,N()}}function N(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function f5e(n,e){const t=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let o;if(t===s)o=[n[t].slice(r,i)];else{if(o=n.slice(t,s),r>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(r):o.shift()}i>0&&o.push(n[s].slice(0,i))}return o}function p5e(n,e){let t=-1;const r=[];let s;for(;++t<n.length;){const i=n[t];let o;if(typeof i=="string")o=i;else switch(i){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=e?" ":"	";break}case-1:{if(!e&&s)continue;o=" ";break}default:o=String.fromCharCode(i)}s=i===-2,r.push(o)}return r.join("")}function m5e(n){const r={constructs:cY([d5e,...(n||{}).extensions||[]]),content:s(Ike),defined:[],document:s(Mke),flow:s(X_e),lazy:{},string:s(Z_e),text:s(e5e)};return r;function s(i){return o;function o(a){return h5e(r,i,a)}}}function g5e(n){for(;!pY(n););return n}const JO=/[\0\t\n\r]/g;function y5e(){let n=1,e="",t=!0,r;return s;function s(i,o,a){const l=[];let c,u,h,f,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(o||void 0).decode(i)),h=0,e="",t&&(i.charCodeAt(0)===65279&&h++,t=void 0);h<i.length;){if(JO.lastIndex=h,c=JO.exec(i),f=c&&c.index!==void 0?c.index:i.length,p=i.charCodeAt(f),!c){e=i.slice(h);break}if(p===10&&h===f&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),h<f&&(l.push(i.slice(h,f)),n+=f-h),p){case 0:{l.push(65533),n++;break}case 9:{for(u=Math.ceil(n/4)*4,l.push(-2);n++<u;)l.push(-1);break}case 10:{l.push(-4),n=1;break}default:r=!0,n=1}h=f+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const x5e=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function b5e(n){return n.replace(x5e,v5e)}function v5e(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const s=t.charCodeAt(1),i=s===120||s===88;return uY(t.slice(i?2:1),i?16:10)}return CR(t)||n}const vY={}.hasOwnProperty;function w5e(n,e,t){return typeof e!="string"&&(t=e,e=void 0),k5e(t)(g5e(m5e(t).document().write(y5e()(n,e,!0))))}function k5e(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(bt),autolinkProtocol:S,autolinkEmail:S,atxHeading:i(ht),blockQuote:i(un),characterEscape:S,characterReference:S,codeFenced:i(Sr),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(Sr,o),codeText:i(ri,o),codeTextData:S,data:S,codeFlowValue:S,definition:i(Yn),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(Or),hardBreakEscape:i(Tn),hardBreakTrailing:i(Tn),htmlFlow:i(Gt,o),htmlFlowData:S,htmlText:i(Gt,o),htmlTextData:S,image:i(Dn),label:o,link:i(bt),listItem:i(er),listItemValue:f,listOrdered:i($t,h),listUnordered:i($t),paragraph:i(js),reference:W,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(ht),strong:i(co),thematicBreak:i(Ct)},exit:{atxHeading:l(),atxHeadingSequence:R,autolink:l(),autolinkEmail:sn,autolinkProtocol:lt,blockQuote:l(),characterEscapeValue:N,characterReferenceMarkerHexadecimal:Me,characterReferenceMarkerNumeric:Me,characterReferenceValue:Fe,characterReference:Ae,codeFenced:l(v),codeFencedFence:y,codeFencedFenceInfo:p,codeFencedFenceMeta:g,codeFlowValue:N,codeIndented:l(b),codeText:l(J),codeTextData:N,data:N,definition:l(),definitionDestinationString:T,definitionLabelString:w,definitionTitleString:k,emphasis:l(),hardBreakEscape:l(O),hardBreakTrailing:l(O),htmlFlow:l(D),htmlFlowData:N,htmlText:l(G),htmlTextData:N,image:l(re),label:te,labelText:ne,lineEnding:P,link:l(Q),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:dt,resourceDestinationString:H,resourceTitleString:ce,resource:xe,setextHeading:l(I),setextHeadingLineSequence:E,setextHeadingText:M,strong:l(),thematicBreak:l()}};wY(e,(n||{}).mdastExtensions||[]);const t={};return r;function r(oe){let pe={type:"root",children:[]};const Ge={stack:[pe],tokenStack:[],config:e,enter:a,exit:c,buffer:o,resume:u,data:t},ft=[];let Ye=-1;for(;++Ye<oe.length;)if(oe[Ye][1].type==="listOrdered"||oe[Ye][1].type==="listUnordered")if(oe[Ye][0]==="enter")ft.push(Ye);else{const tt=ft.pop();Ye=s(oe,tt,Ye)}for(Ye=-1;++Ye<oe.length;){const tt=e[oe[Ye][0]];vY.call(tt,oe[Ye][1].type)&&tt[oe[Ye][1].type].call(Object.assign({sliceSerialize:oe[Ye][2].sliceSerialize},Ge),oe[Ye][1])}if(Ge.tokenStack.length>0){const tt=Ge.tokenStack[Ge.tokenStack.length-1];(tt[1]||QO).call(Ge,void 0,tt[0])}for(pe.position={start:Cd(oe.length>0?oe[0][1].start:{line:1,column:1,offset:0}),end:Cd(oe.length>0?oe[oe.length-2][1].end:{line:1,column:1,offset:0})},Ye=-1;++Ye<e.transforms.length;)pe=e.transforms[Ye](pe)||pe;return pe}function s(oe,pe,Ge){let ft=pe-1,Ye=-1,tt=!1,bn,vn,wn,tr;for(;++ft<=Ge;){const Xt=oe[ft];switch(Xt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Xt[0]==="enter"?Ye++:Ye--,tr=void 0;break}case"lineEndingBlank":{Xt[0]==="enter"&&(bn&&!tr&&!Ye&&!wn&&(wn=ft),tr=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:tr=void 0}if(!Ye&&Xt[0]==="enter"&&Xt[1].type==="listItemPrefix"||Ye===-1&&Xt[0]==="exit"&&(Xt[1].type==="listUnordered"||Xt[1].type==="listOrdered")){if(bn){let ss=ft;for(vn=void 0;ss--;){const mn=oe[ss];if(mn[1].type==="lineEnding"||mn[1].type==="lineEndingBlank"){if(mn[0]==="exit")continue;vn&&(oe[vn][1].type="lineEndingBlank",tt=!0),mn[1].type="lineEnding",vn=ss}else if(!(mn[1].type==="linePrefix"||mn[1].type==="blockQuotePrefix"||mn[1].type==="blockQuotePrefixWhitespace"||mn[1].type==="blockQuoteMarker"||mn[1].type==="listItemIndent"))break}wn&&(!vn||wn<vn)&&(bn._spread=!0),bn.end=Object.assign({},vn?oe[vn][1].start:Xt[1].end),oe.splice(vn||ft,0,["exit",bn,Xt[2]]),ft++,Ge++}if(Xt[1].type==="listItemPrefix"){const ss={type:"listItem",_spread:!1,start:Object.assign({},Xt[1].start),end:void 0};bn=ss,oe.splice(ft,0,["enter",ss,Xt[2]]),ft++,Ge++,wn=void 0,tr=!0}}}return oe[pe][1]._spread=tt,Ge}function i(oe,pe){return Ge;function Ge(ft){a.call(this,oe(ft),ft),pe&&pe.call(this,ft)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(oe,pe,Ge){this.stack[this.stack.length-1].children.push(oe),this.stack.push(oe),this.tokenStack.push([pe,Ge||void 0]),oe.position={start:Cd(pe.start),end:void 0}}function l(oe){return pe;function pe(Ge){oe&&oe.call(this,Ge),c.call(this,Ge)}}function c(oe,pe){const Ge=this.stack.pop(),ft=this.tokenStack.pop();if(ft)ft[0].type!==oe.type&&(pe?pe.call(this,oe,ft[0]):(ft[1]||QO).call(this,oe,ft[0]));else throw new Error("Cannot close `"+oe.type+"` ("+Hx({start:oe.start,end:oe.end})+"): its not open");Ge.position.end=Cd(oe.end)}function u(){return ER(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function f(oe){if(this.data.expectingFirstListItemValue){const pe=this.stack[this.stack.length-2];pe.start=Number.parseInt(this.sliceSerialize(oe),10),this.data.expectingFirstListItemValue=void 0}}function p(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.lang=oe}function g(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.meta=oe}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function v(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.value=oe.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.value=oe.replace(/(\r?\n|\r)$/g,"")}function w(oe){const pe=this.resume(),Ge=this.stack[this.stack.length-1];Ge.label=pe,Ge.identifier=Ol(this.sliceSerialize(oe)).toLowerCase()}function k(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.title=oe}function T(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.url=oe}function R(oe){const pe=this.stack[this.stack.length-1];if(!pe.depth){const Ge=this.sliceSerialize(oe).length;pe.depth=Ge}}function M(){this.data.setextHeadingSlurpLineEnding=!0}function E(oe){const pe=this.stack[this.stack.length-1];pe.depth=this.sliceSerialize(oe).codePointAt(0)===61?1:2}function I(){this.data.setextHeadingSlurpLineEnding=void 0}function S(oe){const Ge=this.stack[this.stack.length-1].children;let ft=Ge[Ge.length-1];(!ft||ft.type!=="text")&&(ft=Rn(),ft.position={start:Cd(oe.start),end:void 0},Ge.push(ft)),this.stack.push(ft)}function N(oe){const pe=this.stack.pop();pe.value+=this.sliceSerialize(oe),pe.position.end=Cd(oe.end)}function P(oe){const pe=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Ge=pe.children[pe.children.length-1];Ge.position.end=Cd(oe.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(pe.type)&&(S.call(this,oe),N.call(this,oe))}function O(){this.data.atHardBreak=!0}function D(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.value=oe}function G(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.value=oe}function J(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.value=oe}function Q(){const oe=this.stack[this.stack.length-1];if(this.data.inReference){const pe=this.data.referenceType||"shortcut";oe.type+="Reference",oe.referenceType=pe,delete oe.url,delete oe.title}else delete oe.identifier,delete oe.label;this.data.referenceType=void 0}function re(){const oe=this.stack[this.stack.length-1];if(this.data.inReference){const pe=this.data.referenceType||"shortcut";oe.type+="Reference",oe.referenceType=pe,delete oe.url,delete oe.title}else delete oe.identifier,delete oe.label;this.data.referenceType=void 0}function ne(oe){const pe=this.sliceSerialize(oe),Ge=this.stack[this.stack.length-2];Ge.label=b5e(pe),Ge.identifier=Ol(pe).toLowerCase()}function te(){const oe=this.stack[this.stack.length-1],pe=this.resume(),Ge=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ge.type==="link"){const ft=oe.children;Ge.children=ft}else Ge.alt=pe}function H(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.url=oe}function ce(){const oe=this.resume(),pe=this.stack[this.stack.length-1];pe.title=oe}function xe(){this.data.inReference=void 0}function W(){this.data.referenceType="collapsed"}function dt(oe){const pe=this.resume(),Ge=this.stack[this.stack.length-1];Ge.label=pe,Ge.identifier=Ol(this.sliceSerialize(oe)).toLowerCase(),this.data.referenceType="full"}function Me(oe){this.data.characterReferenceType=oe.type}function Fe(oe){const pe=this.sliceSerialize(oe),Ge=this.data.characterReferenceType;let ft;Ge?(ft=uY(pe,Ge==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ft=CR(pe);const Ye=this.stack[this.stack.length-1];Ye.value+=ft}function Ae(oe){const pe=this.stack.pop();pe.position.end=Cd(oe.end)}function lt(oe){N.call(this,oe);const pe=this.stack[this.stack.length-1];pe.url=this.sliceSerialize(oe)}function sn(oe){N.call(this,oe);const pe=this.stack[this.stack.length-1];pe.url="mailto:"+this.sliceSerialize(oe)}function un(){return{type:"blockquote",children:[]}}function Sr(){return{type:"code",lang:null,meta:null,value:""}}function ri(){return{type:"inlineCode",value:""}}function Yn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Or(){return{type:"emphasis",children:[]}}function ht(){return{type:"heading",depth:0,children:[]}}function Tn(){return{type:"break"}}function Gt(){return{type:"html",value:""}}function Dn(){return{type:"image",title:null,url:"",alt:null}}function bt(){return{type:"link",title:null,url:"",children:[]}}function $t(oe){return{type:"list",ordered:oe.type==="listOrdered",start:null,spread:oe._spread,children:[]}}function er(oe){return{type:"listItem",spread:oe._spread,checked:null,children:[]}}function js(){return{type:"paragraph",children:[]}}function co(){return{type:"strong",children:[]}}function Rn(){return{type:"text",value:""}}function Ct(){return{type:"thematicBreak"}}}function Cd(n){return{line:n.line,column:n.column,offset:n.offset}}function wY(n,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?wY(n,r):_5e(n,r)}}function _5e(n,e){let t;for(t in e)if(vY.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&n[t].push(...r);break}case"transforms":{const r=e[t];r&&n[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(n[t],r);break}}}function QO(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+Hx({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+Hx({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Hx({start:e.start,end:e.end})+") is still open")}function S5e(n){const e=this;e.parser=t;function t(r){return w5e(r,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function T5e(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function A5e(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function E5e(n,e){const t=e.value?e.value+`
`:"",r={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(r.className=["language-"+s[0]]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(i.data={meta:e.meta}),n.patch(e,i),i=n.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},n.patch(e,i),i}function C5e(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function N5e(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function I5e(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=sy(r.toLowerCase()),i=n.footnoteOrder.indexOf(r);let o,a=n.footnoteCounts.get(r);a===void 0?(a=0,n.footnoteOrder.push(r),o=n.footnoteOrder.length):o=i+1,a+=1,n.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+s,id:t+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};n.patch(e,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return n.patch(e,c),n.applyData(e,c)}function R5e(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function M5e(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function kY(n,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=n.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function P5e(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return kY(n,e);const s={src:sy(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return n.patch(e,i),n.applyData(e,i)}function L5e(n,e){const t={src:sy(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,r),n.applyData(e,r)}function D5e(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,r),n.applyData(e,r)}function j5e(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return kY(n,e);const s={href:sy(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:n.all(e)};return n.patch(e,i),n.applyData(e,i)}function O5e(n,e){const t={href:sy(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function F5e(n,e,t){const r=n.all(e),s=t?z5e(t):_Y(e),i={},o=[];if(typeof e.checked=="boolean"){const u=r[0];let h;u&&u.type==="element"&&u.tagName==="p"?h=u:(h={type:"element",tagName:"p",properties:{},children:[]},r.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const u=r[a];(s||a!==0||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!s?o.push(...u.children):o.push(u)}const l=r[r.length-1];l&&(s||l.type!=="element"||l.tagName!=="p")&&o.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:i,children:o};return n.patch(e,c),n.applyData(e,c)}function z5e(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let r=-1;for(;!e&&++r<t.length;)e=_Y(t[r])}return e}function _Y(n){const e=n.spread;return e??n.children.length>1}function B5e(n,e){const t={},r=n.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(r,!0)};return n.patch(e,i),n.applyData(e,i)}function $5e(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function V5e(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function U5e(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function H5e(n,e){const t=n.all(e),r=t.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:n.wrap([r],!0)};n.patch(e.children[0],o),s.push(o)}if(t.length>0){const o={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},a=_R(e.children[1]),l=nY(e.children[e.children.length-1]);a&&l&&(o.position={start:a,end:l}),s.push(o)}const i={type:"element",tagName:"table",properties:{},children:n.wrap(s,!0)};return n.patch(e,i),n.applyData(e,i)}function q5e(n,e,t){const r=t?t.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",o=t&&t.type==="table"?t.align:void 0,a=o?o.length:e.children.length;let l=-1;const c=[];for(;++l<a;){const h=e.children[l],f={},p=o?o[l]:void 0;p&&(f.align=p);let g={type:"element",tagName:i,properties:f,children:[]};h&&(g.children=n.all(h),n.patch(h,g),g=n.applyData(h,g)),c.push(g)}const u={type:"element",tagName:"tr",properties:{},children:n.wrap(c,!0)};return n.patch(e,u),n.applyData(e,u)}function G5e(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const ZO=9,eF=32;function W5e(n){const e=String(n),t=/\r?\n|\r/g;let r=t.exec(e),s=0;const i=[];for(;r;)i.push(tF(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=t.exec(e);return i.push(tF(e.slice(s),s>0,!1)),i.join("")}function tF(n,e,t){let r=0,s=n.length;if(e){let i=n.codePointAt(r);for(;i===ZO||i===eF;)r++,i=n.codePointAt(r)}if(t){let i=n.codePointAt(s-1);for(;i===ZO||i===eF;)s--,i=n.codePointAt(s-1)}return s>r?n.slice(r,s):""}function K5e(n,e){const t={type:"text",value:W5e(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function Y5e(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const X5e={blockquote:T5e,break:A5e,code:E5e,delete:C5e,emphasis:N5e,footnoteReference:I5e,heading:R5e,html:M5e,imageReference:P5e,image:L5e,inlineCode:D5e,linkReference:j5e,link:O5e,listItem:F5e,list:B5e,paragraph:$5e,root:V5e,strong:U5e,table:H5e,tableCell:G5e,tableRow:q5e,text:K5e,thematicBreak:Y5e,toml:o4,yaml:o4,definition:o4,footnoteDefinition:o4};function o4(){}const SY=-1,kS=0,Gx=1,_5=2,IR=3,RR=4,MR=5,PR=6,TY=7,AY=8,nF=typeof self=="object"?self:globalThis,J5e=(n,e)=>{const t=(s,i)=>(n.set(i,s),s),r=s=>{if(n.has(s))return n.get(s);const[i,o]=e[s];switch(i){case kS:case SY:return t(o,s);case Gx:{const a=t([],s);for(const l of o)a.push(r(l));return a}case _5:{const a=t({},s);for(const[l,c]of o)a[r(l)]=r(c);return a}case IR:return t(new Date(o),s);case RR:{const{source:a,flags:l}=o;return t(new RegExp(a,l),s)}case MR:{const a=t(new Map,s);for(const[l,c]of o)a.set(r(l),r(c));return a}case PR:{const a=t(new Set,s);for(const l of o)a.add(r(l));return a}case TY:{const{name:a,message:l}=o;return t(new nF[a](l),s)}case AY:return t(BigInt(o),s);case"BigInt":return t(Object(BigInt(o)),s);case"ArrayBuffer":return t(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return t(new DataView(a),o)}}return t(new nF[i](o),s)};return r},rF=n=>J5e(new Map,n)(0),dm="",{toString:Q5e}={},{keys:Z5e}=Object,Iy=n=>{const e=typeof n;if(e!=="object"||!n)return[kS,e];const t=Q5e.call(n).slice(8,-1);switch(t){case"Array":return[Gx,dm];case"Object":return[_5,dm];case"Date":return[IR,dm];case"RegExp":return[RR,dm];case"Map":return[MR,dm];case"Set":return[PR,dm];case"DataView":return[Gx,t]}return t.includes("Array")?[Gx,t]:t.includes("Error")?[TY,t]:[_5,t]},a4=([n,e])=>n===kS&&(e==="function"||e==="symbol"),e3e=(n,e,t,r)=>{const s=(o,a)=>{const l=r.push(o)-1;return t.set(a,l),l},i=o=>{if(t.has(o))return t.get(o);let[a,l]=Iy(o);switch(a){case kS:{let u=o;switch(l){case"bigint":a=AY,u=o.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return s([SY],o)}return s([a,u],o)}case Gx:{if(l){let f=o;return l==="DataView"?f=new Uint8Array(o.buffer):l==="ArrayBuffer"&&(f=new Uint8Array(o)),s([l,[...f]],o)}const u=[],h=s([a,u],o);for(const f of o)u.push(i(f));return h}case _5:{if(l)switch(l){case"BigInt":return s([l,o.toString()],o);case"Boolean":case"Number":case"String":return s([l,o.valueOf()],o)}if(e&&"toJSON"in o)return i(o.toJSON());const u=[],h=s([a,u],o);for(const f of Z5e(o))(n||!a4(Iy(o[f])))&&u.push([i(f),i(o[f])]);return h}case IR:return s([a,o.toISOString()],o);case RR:{const{source:u,flags:h}=o;return s([a,{source:u,flags:h}],o)}case MR:{const u=[],h=s([a,u],o);for(const[f,p]of o)(n||!(a4(Iy(f))||a4(Iy(p))))&&u.push([i(f),i(p)]);return h}case PR:{const u=[],h=s([a,u],o);for(const f of o)(n||!a4(Iy(f)))&&u.push(i(f));return h}}const{message:c}=o;return s([a,{name:l,message:c}],o)};return i},sF=(n,{json:e,lossy:t}={})=>{const r=[];return e3e(!(e||t),!!e,new Map,r)(n),r},S5=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?rF(sF(n,e)):structuredClone(n):(n,e)=>rF(sF(n,e));function t3e(n,e){const t=[{type:"text",value:""}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function n3e(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function r3e(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||t3e,r=n.options.footnoteBackLabel||n3e,s=n.options.footnoteLabel||"Footnotes",i=n.options.footnoteLabelTagName||"h2",o=n.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<n.footnoteOrder.length;){const c=n.footnoteById.get(n.footnoteOrder[l]);if(!c)continue;const u=n.all(c),h=String(c.identifier).toUpperCase(),f=sy(h.toLowerCase());let p=0;const g=[],y=n.footnoteCounts.get(h);for(;y!==void 0&&++p<=y;){g.length>0&&g.push({type:"text",value:" "});let w=typeof t=="string"?t:t(l,p);typeof w=="string"&&(w={type:"text",value:w}),g.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(w)?w:[w]})}const v=u[u.length-1];if(v&&v.type==="element"&&v.tagName==="p"){const w=v.children[v.children.length-1];w&&w.type==="text"?w.value+=" ":v.children.push({type:"text",value:" "}),v.children.push(...g)}else u.push(...g);const b={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:n.wrap(u,!0)};n.patch(c,b),a.push(b)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...S5(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(a,!0)},{type:"text",value:`
`}]}}const s2=function(n){if(n==null)return a3e;if(typeof n=="function")return _S(n);if(typeof n=="object")return Array.isArray(n)?s3e(n):i3e(n);if(typeof n=="string")return o3e(n);throw new Error("Expected function, string, or object as test")};function s3e(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=s2(n[t]);return _S(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function i3e(n){const e=n;return _S(t);function t(r){const s=r;let i;for(i in n)if(s[i]!==e[i])return!1;return!0}}function o3e(n){return _S(e);function e(t){return t&&t.type===n}}function _S(n){return e;function e(t,r,s){return!!(l3e(t)&&n.call(this,t,typeof r=="number"?r:void 0,s||void 0))}}function a3e(){return!0}function l3e(n){return n!==null&&typeof n=="object"&&"type"in n}const EY=[],c3e=!0,VC=!1,CY="skip";function LR(n,e,t,r){let s;typeof e=="function"&&typeof t!="function"?(r=t,t=e):s=e;const i=s2(s),o=r?-1:1;a(n,void 0,[])();function a(l,c,u){const h=l&&typeof l=="object"?l:{};if(typeof h.type=="string"){const p=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return f;function f(){let p=EY,g,y,v;if((!e||i(l,c,u[u.length-1]||void 0))&&(p=u3e(t(l,u)),p[0]===VC))return p;if("children"in l&&l.children){const b=l;if(b.children&&p[0]!==CY)for(y=(r?b.children.length:-1)+o,v=u.concat(b);y>-1&&y<b.children.length;){const w=b.children[y];if(g=a(w,y,v)(),g[0]===VC)return g;y=typeof g[1]=="number"?g[1]:y+o}}return p}}}function u3e(n){return Array.isArray(n)?n:typeof n=="number"?[c3e,n]:n==null?EY:[n]}function DR(n,e,t,r){let s,i,o;typeof e=="function"&&typeof t!="function"?(i=void 0,o=e,s=t):(i=e,o=t,s=r),LR(n,i,a,s);function a(l,c){const u=c[c.length-1],h=u?u.children.indexOf(l):void 0;return o(l,h,u)}}const UC={}.hasOwnProperty,d3e={};function h3e(n,e){const t=e||d3e,r=new Map,s=new Map,i=new Map,o={...X5e,...t.handlers},a={all:c,applyData:p3e,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:o,one:l,options:t,patch:f3e,wrap:g3e};return DR(n,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){const h=u.type==="definition"?r:s,f=String(u.identifier).toUpperCase();h.has(f)||h.set(f,u)}}),a;function l(u,h){const f=u.type,p=a.handlers[f];if(UC.call(a.handlers,f)&&p)return p(a,u,h);if(a.options.passThrough&&a.options.passThrough.includes(f)){if("children"in u){const{children:y,...v}=u,b=S5(v);return b.children=a.all(u),b}return S5(u)}return(a.options.unknownHandler||m3e)(a,u,h)}function c(u){const h=[];if("children"in u){const f=u.children;let p=-1;for(;++p<f.length;){const g=a.one(f[p],u);if(g){if(p&&f[p-1].type==="break"&&(!Array.isArray(g)&&g.type==="text"&&(g.value=iF(g.value)),!Array.isArray(g)&&g.type==="element")){const y=g.children[0];y&&y.type==="text"&&(y.value=iF(y.value))}Array.isArray(g)?h.push(...g):h.push(g)}}}return h}}function f3e(n,e){n.position&&(e.position=nke(n))}function p3e(n,e){let t=e;if(n&&n.data){const r=n.data.hName,s=n.data.hChildren,i=n.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const o="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:o}}t.type==="element"&&i&&Object.assign(t.properties,S5(i)),"children"in t&&t.children&&s!==null&&s!==void 0&&(t.children=s)}return t}function m3e(n,e){const t=e.data||{},r="value"in e&&!(UC.call(t,"hProperties")||UC.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function g3e(n,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<n.length;)r&&t.push({type:"text",value:`
`}),t.push(n[r]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function iF(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function oF(n,e){const t=h3e(n,e),r=t.one(n,void 0),s=r3e(t),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function y3e(n,e){return n&&"run"in n?async function(t,r){const s=oF(t,{file:r,...e});await n.run(s,r)}:function(t,r){return oF(t,{file:r,...n||e})}}function aF(n){if(n)throw n}var ek=Object.prototype.hasOwnProperty,NY=Object.prototype.toString,lF=Object.defineProperty,cF=Object.getOwnPropertyDescriptor,uF=function(e){return typeof Array.isArray=="function"?Array.isArray(e):NY.call(e)==="[object Array]"},dF=function(e){if(!e||NY.call(e)!=="[object Object]")return!1;var t=ek.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&ek.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var s;for(s in e);return typeof s>"u"||ek.call(e,s)},hF=function(e,t){lF&&t.name==="__proto__"?lF(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},fF=function(e,t){if(t==="__proto__")if(ek.call(e,t)){if(cF)return cF(e,t).value}else return;return e[t]},x3e=function n(){var e,t,r,s,i,o,a=arguments[0],l=1,c=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<c;++l)if(e=arguments[l],e!=null)for(t in e)r=fF(a,t),s=fF(e,t),a!==s&&(u&&s&&(dF(s)||(i=uF(s)))?(i?(i=!1,o=r&&uF(r)?r:[]):o=r&&dF(r)?r:{},hF(a,{name:t,newValue:n(u,o,s)})):typeof s<"u"&&hF(a,{name:t,newValue:s}));return a};const MA=xw(x3e);function HC(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function b3e(){const n=[],e={run:t,use:r};return e;function t(...s){let i=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(l,...c){const u=n[++i];let h=-1;if(l){o(l);return}for(;++h<s.length;)(c[h]===null||c[h]===void 0)&&(c[h]=s[h]);s=c,u?v3e(u,a)(...c):o(null,...c)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return n.push(s),e}}function v3e(n,e){let t;return r;function r(...o){const a=n.length>o.length;let l;a&&o.push(s);try{l=n.apply(this,o)}catch(c){const u=c;if(a&&t)throw u;return s(u)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,s):l instanceof Error?s(l):i(l))}function s(o,...a){t||(t=!0,e(o,...a))}function i(o){s(null,o)}}const nc={basename:w3e,dirname:k3e,extname:_3e,join:S3e,sep:"/"};function w3e(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');i2(n);let t=0,r=-1,s=n.length,i;if(e===void 0||e.length===0||e.length>n.length){for(;s--;)if(n.codePointAt(s)===47){if(i){t=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":n.slice(t,r)}if(e===n)return"";let o=-1,a=e.length-1;for(;s--;)if(n.codePointAt(s)===47){if(i){t=s+1;break}}else o<0&&(i=!0,o=s+1),a>-1&&(n.codePointAt(s)===e.codePointAt(a--)?a<0&&(r=s):(a=-1,r=o));return t===r?r=o:r<0&&(r=n.length),n.slice(t,r)}function k3e(n){if(i2(n),n.length===0)return".";let e=-1,t=n.length,r;for(;--t;)if(n.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function _3e(n){i2(n);let e=n.length,t=-1,r=0,s=-1,i=0,o;for(;e--;){const a=n.codePointAt(e);if(a===47){if(o){r=e+1;break}continue}t<0&&(o=!0,t=e+1),a===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||t<0||i===0||i===1&&s===t-1&&s===r+1?"":n.slice(s,t)}function S3e(...n){let e=-1,t;for(;++e<n.length;)i2(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":T3e(t)}function T3e(n){i2(n);const e=n.codePointAt(0)===47;let t=A3e(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function A3e(n,e){let t="",r=0,s=-1,i=0,o=-1,a,l;for(;++o<=n.length;){if(o<n.length)a=n.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||i===1))if(s!==o-1&&i===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(l=t.lastIndexOf("/"),l!==t.length-1){l<0?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=o,i=0;continue}}else if(t.length>0){t="",r=0,s=o,i=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+n.slice(s+1,o):t=n.slice(s+1,o),r=o-s-1;s=o,i=0}else a===46&&i>-1?i++:i=-1}return t}function i2(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const E3e={cwd:C3e};function C3e(){return"/"}function qC(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function N3e(n){if(typeof n=="string")n=new URL(n);else if(!qC(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return I3e(n)}function I3e(n){if(n.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const PA=["history","path","basename","stem","extname","dirname"];class IY{constructor(e){let t;e?qC(e)?t={path:e}:typeof e=="string"||R3e(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":E3e.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<PA.length;){const i=PA[r];i in t&&t[i]!==void 0&&t[i]!==null&&(this[i]=i==="history"?[...t[i]]:t[i])}let s;for(s in t)PA.includes(s)||(this[s]=t[s])}get basename(){return typeof this.path=="string"?nc.basename(this.path):void 0}set basename(e){DA(e,"basename"),LA(e,"basename"),this.path=nc.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?nc.dirname(this.path):void 0}set dirname(e){pF(this.basename,"dirname"),this.path=nc.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?nc.extname(this.path):void 0}set extname(e){if(LA(e,"extname"),pF(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=nc.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){qC(e)&&(e=N3e(e)),DA(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?nc.basename(this.path,this.extname):void 0}set stem(e){DA(e,"stem"),LA(e,"stem"),this.path=nc.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const s=this.message(e,t,r);throw s.fatal=!0,s}info(e,t,r){const s=this.message(e,t,r);return s.fatal=void 0,s}message(e,t,r){const s=new Ii(e,t,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function LA(n,e){if(n&&n.includes(nc.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+nc.sep+"`")}function DA(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function pF(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function R3e(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const M3e=function(n){const r=this.constructor.prototype,s=r[n],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},P3e={}.hasOwnProperty;class jR extends M3e{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=b3e()}copy(){const e=new jR;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(MA(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(FA("data",this.frozen),this.namespace[e]=t,this):P3e.call(this.namespace,e)&&this.namespace[e]||void 0:e?(FA("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=t.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=l4(e),r=this.parser||this.Parser;return jA("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),jA("process",this.parser||this.Parser),OA("process",this.compiler||this.Compiler),t?s(void 0,t):new Promise(s);function s(i,o){const a=l4(e),l=r.parse(a);r.run(l,a,function(u,h,f){if(u||!h||!f)return c(u);const p=h,g=r.stringify(p,f);j3e(g)?f.value=g:f.result=g,c(u,f)});function c(u,h){u||!h?o(u):i?i(h):t(void 0,h)}}}processSync(e){let t=!1,r;return this.freeze(),jA("processSync",this.parser||this.Parser),OA("processSync",this.compiler||this.Compiler),this.process(e,s),gF("processSync","process",t),r;function s(i,o){t=!0,aF(i),r=o}}run(e,t,r){mF(e),this.freeze();const s=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?i(void 0,r):new Promise(i);function i(o,a){const l=l4(t);s.run(e,l,c);function c(u,h,f){const p=h||e;u?a(u):o?o(p):r(void 0,p,f)}}}runSync(e,t){let r=!1,s;return this.run(e,t,i),gF("runSync","run",r),s;function i(o,a){aF(o),s=a,r=!0}}stringify(e,t){this.freeze();const r=l4(t),s=this.compiler||this.Compiler;return OA("stringify",s),mF(e),s(e,r)}use(e,...t){const r=this.attachers,s=this.namespace;if(FA("use",this.frozen),e!=null)if(typeof e=="function")l(e,t);else if(typeof e=="object")Array.isArray(e)?a(e):o(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[u,...h]=c;l(u,h)}else o(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function o(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(s.settings=MA(!0,s.settings,c.settings))}function a(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){const h=c[u];i(h)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,u){let h=-1,f=-1;for(;++h<r.length;)if(r[h][0]===c){f=h;break}if(f===-1)r.push([c,...u]);else if(u.length>0){let[p,...g]=u;const y=r[f][1];HC(y)&&HC(p)&&(p=MA(!0,y,p)),r[f]=[c,p,...g]}}}}const L3e=new jR().freeze();function jA(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function OA(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function FA(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function mF(n){if(!HC(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function gF(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function l4(n){return D3e(n)?n:new IY(n)}function D3e(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function j3e(n){return typeof n=="string"||O3e(n)}function O3e(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const F3e="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",yF=[],xF={allowDangerousHtml:!0},z3e=/^(https?|ircs?|mailto|xmpp)$/i,B3e=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function $3e(n){const e=V3e(n),t=U3e(n);return H3e(e.runSync(e.parse(t),t),n)}function V3e(n){const e=n.rehypePlugins||yF,t=n.remarkPlugins||yF,r=n.remarkRehypeOptions?{...n.remarkRehypeOptions,...xF}:xF;return L3e().use(S5e).use(t).use(y3e,r).use(e)}function U3e(n){const e=n.children||"",t=new IY;return typeof e=="string"&&(t.value=e),t}function H3e(n,e){const t=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,o=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||q3e;for(const u of B3e)Object.hasOwn(e,u.from)&&(""+u.from+(u.to?"use `"+u.to+"` instead":"remove it")+F3e+u.id,void 0);return DR(n,c),ake(n,{Fragment:d.Fragment,components:s,ignoreInvalidStyle:!0,jsx:d.jsx,jsxs:d.jsxs,passKeys:!0,passNode:!0});function c(u,h,f){if(u.type==="raw"&&f&&typeof h=="number")return o?f.children.splice(h,1):f.children[h]={type:"text",value:u.value},h;if(u.type==="element"){let p;for(p in NA)if(Object.hasOwn(NA,p)&&Object.hasOwn(u.properties,p)){const g=u.properties[p],y=NA[p];(y===null||y.includes(u.tagName))&&(u.properties[p]=l(String(g||""),p,u))}}if(u.type==="element"){let p=t?!t.includes(u.tagName):i?i.includes(u.tagName):!1;if(!p&&r&&typeof h=="number"&&(p=!r(u,h,f)),p&&f&&typeof h=="number")return a&&u.children?f.children.splice(h,1,...u.children):f.children.splice(h,1),h}}}function q3e(n){const e=n.indexOf(":"),t=n.indexOf("?"),r=n.indexOf("#"),s=n.indexOf("/");return e===-1||s!==-1&&e>s||t!==-1&&e>t||r!==-1&&e>r||z3e.test(n.slice(0,e))?n:""}function RY(n,e){const t=String(n);let r=t.indexOf(e),s=r,i=0,o=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===s?++i>o&&(o=i):i=1,s=r+e.length,r=t.indexOf(e,s);return o}function G3e(){return{enter:{mathFlow:n,mathFlowFenceMeta:e,mathText:i},exit:{mathFlow:s,mathFlowFence:r,mathFlowFenceMeta:t,mathFlowValue:a,mathText:o,mathTextData:a}};function n(l){const c={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[c]}},l)}function e(){this.buffer()}function t(){const l=this.resume(),c=this.stack[this.stack.length-1];c.type,c.meta=l}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function s(l){const c=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),u=this.stack[this.stack.length-1];u.type,this.exit(l),u.value=c;const h=u.data.hChildren[0];h.type,h.tagName,h.children.push({type:"text",value:c}),this.data.mathFlowInside=void 0}function i(l){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},l),this.buffer()}function o(l){const c=this.resume(),u=this.stack[this.stack.length-1];u.type,this.exit(l),u.value=c,u.data.hChildren.push({type:"text",value:c})}function a(l){this.config.enter.data.call(this,l),this.config.exit.data.call(this,l)}}function W3e(n){let e=(n||{}).singleDollarTextMath;return e==null&&(e=!0),r.peek=s,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:e?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:t,inlineMath:r}};function t(i,o,a,l){const c=i.value||"",u=a.createTracker(l),h="$".repeat(Math.max(RY(c,"$")+1,2)),f=a.enter("mathFlow");let p=u.move(h);if(i.meta){const g=a.enter("mathFlowMeta");p+=u.move(a.safe(i.meta,{after:`
`,before:p,encode:["$"],...u.current()})),g()}return p+=u.move(`
`),c&&(p+=u.move(c+`
`)),p+=u.move(h),f(),p}function r(i,o,a){let l=i.value||"",c=1;for(e||c++;new RegExp("(^|[^$])"+"\\$".repeat(c)+"([^$]|$)").test(l);)c++;const u="$".repeat(c);/[^ \r\n]/.test(l)&&(/^[ \r\n]/.test(l)&&/[ \r\n]$/.test(l)||/^\$|\$$/.test(l))&&(l=" "+l+" ");let h=-1;for(;++h<a.unsafe.length;){const f=a.unsafe[h];if(!f.atBreak)continue;const p=a.compilePattern(f);let g;for(;g=p.exec(l);){let y=g.index;l.codePointAt(y)===10&&l.codePointAt(y-1)===13&&y--,l=l.slice(0,y)+" "+l.slice(g.index+1)}}return u+l+u}function s(){return"$"}}const K3e={tokenize:Y3e,concrete:!0,name:"mathFlow"},bF={tokenize:X3e,partial:!0};function Y3e(n,e,t){const r=this,s=r.events[r.events.length-1],i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0;let o=0;return a;function a(w){return n.enter("mathFlow"),n.enter("mathFlowFence"),n.enter("mathFlowFenceSequence"),l(w)}function l(w){return w===36?(n.consume(w),o++,l):o<2?t(w):(n.exit("mathFlowFenceSequence"),qt(n,c,"whitespace")(w))}function c(w){return w===null||Ke(w)?h(w):(n.enter("mathFlowFenceMeta"),n.enter("chunkString",{contentType:"string"}),u(w))}function u(w){return w===null||Ke(w)?(n.exit("chunkString"),n.exit("mathFlowFenceMeta"),h(w)):w===36?t(w):(n.consume(w),u)}function h(w){return n.exit("mathFlowFence"),r.interrupt?e(w):n.attempt(bF,f,v)(w)}function f(w){return n.attempt({tokenize:b,partial:!0},v,p)(w)}function p(w){return(i?qt(n,g,"linePrefix",i+1):g)(w)}function g(w){return w===null?v(w):Ke(w)?n.attempt(bF,f,v)(w):(n.enter("mathFlowValue"),y(w))}function y(w){return w===null||Ke(w)?(n.exit("mathFlowValue"),g(w)):(n.consume(w),y)}function v(w){return n.exit("mathFlow"),e(w)}function b(w,k,T){let R=0;return qt(w,M,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function M(S){return w.enter("mathFlowFence"),w.enter("mathFlowFenceSequence"),E(S)}function E(S){return S===36?(R++,w.consume(S),E):R<o?T(S):(w.exit("mathFlowFenceSequence"),qt(w,I,"whitespace")(S))}function I(S){return S===null||Ke(S)?(w.exit("mathFlowFence"),k(S)):T(S)}}}function X3e(n,e,t){const r=this;return s;function s(o){return o===null?e(o):(n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),i)}function i(o){return r.parser.lazy[r.now().line]?t(o):e(o)}}function J3e(n){let t=(n||{}).singleDollarTextMath;return t==null&&(t=!0),{tokenize:r,resolve:Q3e,previous:Z3e,name:"mathText"};function r(s,i,o){let a=0,l,c;return u;function u(y){return s.enter("mathText"),s.enter("mathTextSequence"),h(y)}function h(y){return y===36?(s.consume(y),a++,h):a<2&&!t?o(y):(s.exit("mathTextSequence"),f(y))}function f(y){return y===null?o(y):y===36?(c=s.enter("mathTextSequence"),l=0,g(y)):y===32?(s.enter("space"),s.consume(y),s.exit("space"),f):Ke(y)?(s.enter("lineEnding"),s.consume(y),s.exit("lineEnding"),f):(s.enter("mathTextData"),p(y))}function p(y){return y===null||y===32||y===36||Ke(y)?(s.exit("mathTextData"),f(y)):(s.consume(y),p)}function g(y){return y===36?(s.consume(y),l++,g):l===a?(s.exit("mathTextSequence"),s.exit("mathText"),i(y)):(c.type="mathTextData",p(y))}}}function Q3e(n){let e=n.length-4,t=3,r,s;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="mathTextData"){n[e][1].type="mathTextPadding",n[t][1].type="mathTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)s===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(s=r):(r===e||n[r][1].type==="lineEnding")&&(n[s][1].type="mathTextData",r!==s+2&&(n[s][1].end=n[r-1][1].end,n.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return n}function Z3e(n){return n!==36||this.events[this.events.length-1][1].type==="characterEscape"}function eSe(n){return{flow:{36:K3e},text:{36:J3e(n)}}}class _o{constructor(e,t,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=r}static range(e,t){return t?!e||!e.loc||!t.loc||e.loc.lexer!==t.loc.lexer?null:new _o(e.loc.lexer,e.loc.start,t.loc.end):e&&e.loc}}class ha{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new ha(t,_o.range(this,e))}}class _e{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,s,i,o=t&&t.loc;if(o&&o.start<=o.end){var a=o.lexer.input;s=o.start,i=o.end,s===a.length?r+=" at end of input: ":r+=" at position "+(s+1)+": ";var l=a.slice(s,i).replace(/[^]/g,"$&"),c;s>15?c=""+a.slice(s-15,s):c=a.slice(0,s);var u;i+15<a.length?u=a.slice(i,i+15)+"":u=a.slice(i),r+=c+l+u}var h=new Error(r);return h.name="ParseError",h.__proto__=_e.prototype,h.position=s,s!=null&&i!=null&&(h.length=i-s),h.rawMessage=e,h}}_e.prototype.__proto__=Error.prototype;var tSe=function(e,t){return e===void 0?t:e},nSe=/([A-Z])/g,rSe=function(e){return e.replace(nSe,"-$1").toLowerCase()},sSe={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},iSe=/[&><"']/g;function oSe(n){return String(n).replace(iSe,e=>sSe[e])}var MY=function n(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?n(e.body[0]):e:e.type==="font"?n(e.body):e},aSe=function(e){var t=MY(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},lSe=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},cSe=function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?t[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?null:t[1].toLowerCase():"_relative"},gn={deflt:tSe,escape:oSe,hyphenate:rSe,getBaseElem:MY,isCharacterBox:aSe,protocolFromUrl:cSe},tk={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:n=>"#"+n},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(n,e)=>(e.push(n),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:n=>Math.max(0,n),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:n=>Math.max(0,n),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:n=>Math.max(0,n),cli:"-e, --max-expand <n>",cliProcessor:n=>n==="Infinity"?1/0:parseInt(n)},globalGroup:{type:"boolean",cli:!1}};function uSe(n){if(n.default)return n.default;var e=n.type,t=Array.isArray(e)?e[0]:e;if(typeof t!="string")return t.enum[0];switch(t){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class OR{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var t in tk)if(tk.hasOwnProperty(t)){var r=tk[t];this[t]=e[t]!==void 0?r.processor?r.processor(e[t]):e[t]:uSe(r)}}reportNonstrict(e,t,r){var s=this.strict;if(typeof s=="function"&&(s=s(e,t,r)),!(!s||s==="ignore")){if(s===!0||s==="error")throw new _e("LaTeX-incompatible input and strict mode is set to 'error': "+(t+" ["+e+"]"),r);s==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+t+" ["+e+"]"))}}useStrictBehavior(e,t,r){var s=this.strict;if(typeof s=="function")try{s=s(e,t,r)}catch{s="error"}return!s||s==="ignore"?!1:s===!0||s==="error"?!0:s==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+t+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var t=gn.protocolFromUrl(e.url);if(t==null)return!1;e.protocol=t}var r=typeof this.trust=="function"?this.trust(e):this.trust;return!!r}}class Nd{constructor(e,t,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=r}sup(){return kc[dSe[this.id]]}sub(){return kc[hSe[this.id]]}fracNum(){return kc[fSe[this.id]]}fracDen(){return kc[pSe[this.id]]}cramp(){return kc[mSe[this.id]]}text(){return kc[gSe[this.id]]}isTight(){return this.size>=2}}var FR=0,T5=1,ag=2,Gu=3,$b=4,Ga=5,V1=6,Wi=7,kc=[new Nd(FR,0,!1),new Nd(T5,0,!0),new Nd(ag,1,!1),new Nd(Gu,1,!0),new Nd($b,2,!1),new Nd(Ga,2,!0),new Nd(V1,3,!1),new Nd(Wi,3,!0)],dSe=[$b,Ga,$b,Ga,V1,Wi,V1,Wi],hSe=[Ga,Ga,Ga,Ga,Wi,Wi,Wi,Wi],fSe=[ag,Gu,$b,Ga,V1,Wi,V1,Wi],pSe=[Gu,Gu,Ga,Ga,Wi,Wi,Wi,Wi],mSe=[T5,T5,Gu,Gu,Ga,Ga,Wi,Wi],gSe=[FR,T5,ag,Gu,ag,Gu,ag,Gu],at={DISPLAY:kc[FR],TEXT:kc[ag],SCRIPT:kc[$b],SCRIPTSCRIPT:kc[V1]},GC=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function ySe(n){for(var e=0;e<GC.length;e++)for(var t=GC[e],r=0;r<t.blocks.length;r++){var s=t.blocks[r];if(n>=s[0]&&n<=s[1])return t.name}return null}var nk=[];GC.forEach(n=>n.blocks.forEach(e=>nk.push(...e)));function PY(n){for(var e=0;e<nk.length;e+=2)if(n>=nk[e]&&n<=nk[e+1])return!0;return!1}var hm=80,xSe=function(e,t){return"M95,"+(622+e+t)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},bSe=function(e,t){return"M263,"+(601+e+t)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},vSe=function(e,t){return"M983 "+(10+e+t)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},wSe=function(e,t){return"M424,"+(2398+e+t)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+t+`
h400000v`+(40+e)+"h-400000z"},kSe=function(e,t){return"M473,"+(2713+e+t)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"},_Se=function(e){var t=e/2;return"M400000 "+e+" H0 L"+t+" 0 l65 45 L145 "+(e-80)+" H400000z"},SSe=function(e,t,r){var s=r-54-t-e;return"M702 "+(e+t)+"H400000"+(40+e)+`
H742v`+s+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+t+"H400000v"+(40+e)+"H742z"},TSe=function(e,t,r){t=1e3*t;var s="";switch(e){case"sqrtMain":s=xSe(t,hm);break;case"sqrtSize1":s=bSe(t,hm);break;case"sqrtSize2":s=vSe(t,hm);break;case"sqrtSize3":s=wSe(t,hm);break;case"sqrtSize4":s=kSe(t,hm);break;case"sqrtTall":s=SSe(t,hm,r)}return s},ASe=function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z"+("M367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z");case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257z"+("M478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z");default:return""}},vF={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},ESe=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+` v585 h43z
M367 15 v585 v`+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v602 h84z
M403 1759 V0 H319 V1759 v`+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v602 h84z
M347 1759 V0 h-84 V1759 v`+t+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(t+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(t+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(t+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(t+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class o2{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return this.classes.includes(e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){var e=t=>t.toText();return this.children.map(e).join("")}}var Tc={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},c4={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},wF={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function CSe(n,e){Tc[n]=e}function zR(n,e,t){if(!Tc[e])throw new Error("Font metrics not found for font: "+e+".");var r=n.charCodeAt(0),s=Tc[e][r];if(!s&&n[0]in wF&&(r=wF[n[0]].charCodeAt(0),s=Tc[e][r]),!s&&t==="text"&&PY(r)&&(s=Tc[e][77]),s)return{depth:s[0],height:s[1],italic:s[2],skew:s[3],width:s[4]}}var zA={};function NSe(n){var e;if(n>=5?e=0:n>=3?e=1:e=2,!zA[e]){var t=zA[e]={cssEmPerMu:c4.quad[e]/18};for(var r in c4)c4.hasOwnProperty(r)&&(t[r]=c4[r][e])}return zA[e]}var ISe=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],kF=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],_F=function(e,t){return t.size<2?e:ISe[e-1][t.size-1]};class uu{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||uu.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=kF[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return new uu(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:_F(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:kF[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=_F(uu.BASESIZE,e);return this.size===t&&this.textSize===uu.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==uu.BASESIZE?["sizing","reset-size"+this.size,"size"+uu.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=NSe(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}uu.BASESIZE=6;var WC={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},RSe={ex:!0,em:!0,mu:!0},LY=function(e){return typeof e!="string"&&(e=e.unit),e in WC||e in RSe||e==="ex"},yr=function(e,t){var r;if(e.unit in WC)r=WC[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if(e.unit==="mu")r=t.fontMetrics().cssEmPerMu;else{var s;if(t.style.isTight()?s=t.havingStyle(t.style.text()):s=t,e.unit==="ex")r=s.fontMetrics().xHeight;else if(e.unit==="em")r=s.fontMetrics().quad;else throw new _e("Invalid unit: '"+e.unit+"'");s!==t&&(r*=s.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*r,t.maxSize)},Ee=function(e){return+e.toFixed(4)+"em"},uf=function(e){return e.filter(t=>t).join(" ")},DY=function(e,t,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},t){t.style.isTight()&&this.classes.push("mtight");var s=t.getColor();s&&(this.style.color=s)}},jY=function(e){var t=document.createElement(e);t.className=uf(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(t.style[r]=this.style[r]);for(var s in this.attributes)this.attributes.hasOwnProperty(s)&&t.setAttribute(s,this.attributes[s]);for(var i=0;i<this.children.length;i++)t.appendChild(this.children[i].toNode());return t},MSe=/[\s"'>/=\x00-\x1f]/,OY=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+gn.escape(uf(this.classes))+'"');var r="";for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=gn.hyphenate(s)+":"+this.style[s]+";");r&&(t+=' style="'+gn.escape(r)+'"');for(var i in this.attributes)if(this.attributes.hasOwnProperty(i)){if(MSe.test(i))throw new _e("Invalid attribute name '"+i+"'");t+=" "+i+'="'+gn.escape(this.attributes[i])+'"'}t+=">";for(var o=0;o<this.children.length;o++)t+=this.children[o].toMarkup();return t+="</"+e+">",t};class a2{constructor(e,t,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,DY.call(this,e,r,s),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return this.classes.includes(e)}toNode(){return jY.call(this,"span")}toMarkup(){return OY.call(this,"span")}}class BR{constructor(e,t,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,DY.call(this,t,s),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return this.classes.includes(e)}toNode(){return jY.call(this,"a")}toMarkup(){return OY.call(this,"a")}}class PSe{constructor(e,t,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var t in this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+gn.escape(this.src)+'"'+(' alt="'+gn.escape(this.alt)+'"'),t="";for(var r in this.style)this.style.hasOwnProperty(r)&&(t+=gn.hyphenate(r)+":"+this.style[r]+";");return t&&(e+=' style="'+gn.escape(t)+'"'),e+="'/>",e}}var LSe={:"",:"",:"",:""};class rl{constructor(e,t,r,s,i,o,a,l){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=r||0,this.italic=s||0,this.skew=i||0,this.width=o||0,this.classes=a||[],this.style=l||{},this.maxFontSize=0;var c=ySe(this.text.charCodeAt(0));c&&this.classes.push(c+"_fallback"),/[]/.test(this.text)&&(this.text=LSe[this.text])}hasClass(e){return this.classes.includes(e)}toNode(){var e=document.createTextNode(this.text),t=null;this.italic>0&&(t=document.createElement("span"),t.style.marginRight=Ee(this.italic)),this.classes.length>0&&(t=t||document.createElement("span"),t.className=uf(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(t=t||document.createElement("span"),t.style[r]=this.style[r]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=gn.escape(uf(this.classes)),t+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=gn.hyphenate(s)+":"+this.style[s]+";");r&&(e=!0,t+=' style="'+gn.escape(r)+'"');var i=gn.escape(this.text);return e?(t+=">",t+=i,t+="</span>",t):i}}class od{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);for(var s=0;s<this.children.length;s++)t.appendChild(this.children[s].toNode());return t}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+gn.escape(this.attributes[t])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class df{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"path");return this.alternate?t.setAttribute("d",this.alternate):t.setAttribute("d",vF[this.pathName]),t}toMarkup(){return this.alternate?'<path d="'+gn.escape(this.alternate)+'"/>':'<path d="'+gn.escape(vF[this.pathName])+'"/>'}}class KC{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);return t}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+gn.escape(this.attributes[t])+'"');return e+="/>",e}}function SF(n){if(n instanceof rl)return n;throw new Error("Expected symbolNode but got "+String(n)+".")}function DSe(n){if(n instanceof a2)return n;throw new Error("Expected span<HtmlDomNode> but got "+String(n)+".")}var jSe={bin:1,close:1,inner:1,open:1,punct:1,rel:1},OSe={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Kn={math:{},text:{}};function _(n,e,t,r,s,i){Kn[n][s]={font:e,group:t,replace:r},i&&r&&(Kn[n][r]=Kn[n][s])}var C="math",me="text",F="main",K="ams",ar="accent-token",Oe="bin",lo="close",iy="inner",ot="mathord",rs="op-token",va="open",SS="punct",X="rel",xd="spacing",Z="textord";_(C,F,X,"","\\equiv",!0);_(C,F,X,"","\\prec",!0);_(C,F,X,"","\\succ",!0);_(C,F,X,"","\\sim",!0);_(C,F,X,"","\\perp");_(C,F,X,"","\\preceq",!0);_(C,F,X,"","\\succeq",!0);_(C,F,X,"","\\simeq",!0);_(C,F,X,"","\\mid",!0);_(C,F,X,"","\\ll",!0);_(C,F,X,"","\\gg",!0);_(C,F,X,"","\\asymp",!0);_(C,F,X,"","\\parallel");_(C,F,X,"","\\bowtie",!0);_(C,F,X,"","\\smile",!0);_(C,F,X,"","\\sqsubseteq",!0);_(C,F,X,"","\\sqsupseteq",!0);_(C,F,X,"","\\doteq",!0);_(C,F,X,"","\\frown",!0);_(C,F,X,"","\\ni",!0);_(C,F,X,"","\\propto",!0);_(C,F,X,"","\\vdash",!0);_(C,F,X,"","\\dashv",!0);_(C,F,X,"","\\owns");_(C,F,SS,".","\\ldotp");_(C,F,SS,"","\\cdotp");_(C,F,Z,"#","\\#");_(me,F,Z,"#","\\#");_(C,F,Z,"&","\\&");_(me,F,Z,"&","\\&");_(C,F,Z,"","\\aleph",!0);_(C,F,Z,"","\\forall",!0);_(C,F,Z,"","\\hbar",!0);_(C,F,Z,"","\\exists",!0);_(C,F,Z,"","\\nabla",!0);_(C,F,Z,"","\\flat",!0);_(C,F,Z,"","\\ell",!0);_(C,F,Z,"","\\natural",!0);_(C,F,Z,"","\\clubsuit",!0);_(C,F,Z,"","\\wp",!0);_(C,F,Z,"","\\sharp",!0);_(C,F,Z,"","\\diamondsuit",!0);_(C,F,Z,"","\\Re",!0);_(C,F,Z,"","\\heartsuit",!0);_(C,F,Z,"","\\Im",!0);_(C,F,Z,"","\\spadesuit",!0);_(C,F,Z,"","\\S",!0);_(me,F,Z,"","\\S");_(C,F,Z,"","\\P",!0);_(me,F,Z,"","\\P");_(C,F,Z,"","\\dag");_(me,F,Z,"","\\dag");_(me,F,Z,"","\\textdagger");_(C,F,Z,"","\\ddag");_(me,F,Z,"","\\ddag");_(me,F,Z,"","\\textdaggerdbl");_(C,F,lo,"","\\rmoustache",!0);_(C,F,va,"","\\lmoustache",!0);_(C,F,lo,"","\\rgroup",!0);_(C,F,va,"","\\lgroup",!0);_(C,F,Oe,"","\\mp",!0);_(C,F,Oe,"","\\ominus",!0);_(C,F,Oe,"","\\uplus",!0);_(C,F,Oe,"","\\sqcap",!0);_(C,F,Oe,"","\\ast");_(C,F,Oe,"","\\sqcup",!0);_(C,F,Oe,"","\\bigcirc",!0);_(C,F,Oe,"","\\bullet",!0);_(C,F,Oe,"","\\ddagger");_(C,F,Oe,"","\\wr",!0);_(C,F,Oe,"","\\amalg");_(C,F,Oe,"&","\\And");_(C,F,X,"","\\longleftarrow",!0);_(C,F,X,"","\\Leftarrow",!0);_(C,F,X,"","\\Longleftarrow",!0);_(C,F,X,"","\\longrightarrow",!0);_(C,F,X,"","\\Rightarrow",!0);_(C,F,X,"","\\Longrightarrow",!0);_(C,F,X,"","\\leftrightarrow",!0);_(C,F,X,"","\\longleftrightarrow",!0);_(C,F,X,"","\\Leftrightarrow",!0);_(C,F,X,"","\\Longleftrightarrow",!0);_(C,F,X,"","\\mapsto",!0);_(C,F,X,"","\\longmapsto",!0);_(C,F,X,"","\\nearrow",!0);_(C,F,X,"","\\hookleftarrow",!0);_(C,F,X,"","\\hookrightarrow",!0);_(C,F,X,"","\\searrow",!0);_(C,F,X,"","\\leftharpoonup",!0);_(C,F,X,"","\\rightharpoonup",!0);_(C,F,X,"","\\swarrow",!0);_(C,F,X,"","\\leftharpoondown",!0);_(C,F,X,"","\\rightharpoondown",!0);_(C,F,X,"","\\nwarrow",!0);_(C,F,X,"","\\rightleftharpoons",!0);_(C,K,X,"","\\nless",!0);_(C,K,X,"","\\@nleqslant");_(C,K,X,"","\\@nleqq");_(C,K,X,"","\\lneq",!0);_(C,K,X,"","\\lneqq",!0);_(C,K,X,"","\\@lvertneqq");_(C,K,X,"","\\lnsim",!0);_(C,K,X,"","\\lnapprox",!0);_(C,K,X,"","\\nprec",!0);_(C,K,X,"","\\npreceq",!0);_(C,K,X,"","\\precnsim",!0);_(C,K,X,"","\\precnapprox",!0);_(C,K,X,"","\\nsim",!0);_(C,K,X,"","\\@nshortmid");_(C,K,X,"","\\nmid",!0);_(C,K,X,"","\\nvdash",!0);_(C,K,X,"","\\nvDash",!0);_(C,K,X,"","\\ntriangleleft");_(C,K,X,"","\\ntrianglelefteq",!0);_(C,K,X,"","\\subsetneq",!0);_(C,K,X,"","\\@varsubsetneq");_(C,K,X,"","\\subsetneqq",!0);_(C,K,X,"","\\@varsubsetneqq");_(C,K,X,"","\\ngtr",!0);_(C,K,X,"","\\@ngeqslant");_(C,K,X,"","\\@ngeqq");_(C,K,X,"","\\gneq",!0);_(C,K,X,"","\\gneqq",!0);_(C,K,X,"","\\@gvertneqq");_(C,K,X,"","\\gnsim",!0);_(C,K,X,"","\\gnapprox",!0);_(C,K,X,"","\\nsucc",!0);_(C,K,X,"","\\nsucceq",!0);_(C,K,X,"","\\succnsim",!0);_(C,K,X,"","\\succnapprox",!0);_(C,K,X,"","\\ncong",!0);_(C,K,X,"","\\@nshortparallel");_(C,K,X,"","\\nparallel",!0);_(C,K,X,"","\\nVDash",!0);_(C,K,X,"","\\ntriangleright");_(C,K,X,"","\\ntrianglerighteq",!0);_(C,K,X,"","\\@nsupseteqq");_(C,K,X,"","\\supsetneq",!0);_(C,K,X,"","\\@varsupsetneq");_(C,K,X,"","\\supsetneqq",!0);_(C,K,X,"","\\@varsupsetneqq");_(C,K,X,"","\\nVdash",!0);_(C,K,X,"","\\precneqq",!0);_(C,K,X,"","\\succneqq",!0);_(C,K,X,"","\\@nsubseteqq");_(C,K,Oe,"","\\unlhd");_(C,K,Oe,"","\\unrhd");_(C,K,X,"","\\nleftarrow",!0);_(C,K,X,"","\\nrightarrow",!0);_(C,K,X,"","\\nLeftarrow",!0);_(C,K,X,"","\\nRightarrow",!0);_(C,K,X,"","\\nleftrightarrow",!0);_(C,K,X,"","\\nLeftrightarrow",!0);_(C,K,X,"","\\vartriangle");_(C,K,Z,"","\\hslash");_(C,K,Z,"","\\triangledown");_(C,K,Z,"","\\lozenge");_(C,K,Z,"","\\circledS");_(C,K,Z,"","\\circledR");_(me,K,Z,"","\\circledR");_(C,K,Z,"","\\measuredangle",!0);_(C,K,Z,"","\\nexists");_(C,K,Z,"","\\mho");_(C,K,Z,"","\\Finv",!0);_(C,K,Z,"","\\Game",!0);_(C,K,Z,"","\\backprime");_(C,K,Z,"","\\blacktriangle");_(C,K,Z,"","\\blacktriangledown");_(C,K,Z,"","\\blacksquare");_(C,K,Z,"","\\blacklozenge");_(C,K,Z,"","\\bigstar");_(C,K,Z,"","\\sphericalangle",!0);_(C,K,Z,"","\\complement",!0);_(C,K,Z,"","\\eth",!0);_(me,F,Z,"","");_(C,K,Z,"","\\diagup");_(C,K,Z,"","\\diagdown");_(C,K,Z,"","\\square");_(C,K,Z,"","\\Box");_(C,K,Z,"","\\Diamond");_(C,K,Z,"","\\yen",!0);_(me,K,Z,"","\\yen",!0);_(C,K,Z,"","\\checkmark",!0);_(me,K,Z,"","\\checkmark");_(C,K,Z,"","\\beth",!0);_(C,K,Z,"","\\daleth",!0);_(C,K,Z,"","\\gimel",!0);_(C,K,Z,"","\\digamma",!0);_(C,K,Z,"","\\varkappa");_(C,K,va,"","\\@ulcorner",!0);_(C,K,lo,"","\\@urcorner",!0);_(C,K,va,"","\\@llcorner",!0);_(C,K,lo,"","\\@lrcorner",!0);_(C,K,X,"","\\leqq",!0);_(C,K,X,"","\\leqslant",!0);_(C,K,X,"","\\eqslantless",!0);_(C,K,X,"","\\lesssim",!0);_(C,K,X,"","\\lessapprox",!0);_(C,K,X,"","\\approxeq",!0);_(C,K,Oe,"","\\lessdot");_(C,K,X,"","\\lll",!0);_(C,K,X,"","\\lessgtr",!0);_(C,K,X,"","\\lesseqgtr",!0);_(C,K,X,"","\\lesseqqgtr",!0);_(C,K,X,"","\\doteqdot");_(C,K,X,"","\\risingdotseq",!0);_(C,K,X,"","\\fallingdotseq",!0);_(C,K,X,"","\\backsim",!0);_(C,K,X,"","\\backsimeq",!0);_(C,K,X,"","\\subseteqq",!0);_(C,K,X,"","\\Subset",!0);_(C,K,X,"","\\sqsubset",!0);_(C,K,X,"","\\preccurlyeq",!0);_(C,K,X,"","\\curlyeqprec",!0);_(C,K,X,"","\\precsim",!0);_(C,K,X,"","\\precapprox",!0);_(C,K,X,"","\\vartriangleleft");_(C,K,X,"","\\trianglelefteq");_(C,K,X,"","\\vDash",!0);_(C,K,X,"","\\Vvdash",!0);_(C,K,X,"","\\smallsmile");_(C,K,X,"","\\smallfrown");_(C,K,X,"","\\bumpeq",!0);_(C,K,X,"","\\Bumpeq",!0);_(C,K,X,"","\\geqq",!0);_(C,K,X,"","\\geqslant",!0);_(C,K,X,"","\\eqslantgtr",!0);_(C,K,X,"","\\gtrsim",!0);_(C,K,X,"","\\gtrapprox",!0);_(C,K,Oe,"","\\gtrdot");_(C,K,X,"","\\ggg",!0);_(C,K,X,"","\\gtrless",!0);_(C,K,X,"","\\gtreqless",!0);_(C,K,X,"","\\gtreqqless",!0);_(C,K,X,"","\\eqcirc",!0);_(C,K,X,"","\\circeq",!0);_(C,K,X,"","\\triangleq",!0);_(C,K,X,"","\\thicksim");_(C,K,X,"","\\thickapprox");_(C,K,X,"","\\supseteqq",!0);_(C,K,X,"","\\Supset",!0);_(C,K,X,"","\\sqsupset",!0);_(C,K,X,"","\\succcurlyeq",!0);_(C,K,X,"","\\curlyeqsucc",!0);_(C,K,X,"","\\succsim",!0);_(C,K,X,"","\\succapprox",!0);_(C,K,X,"","\\vartriangleright");_(C,K,X,"","\\trianglerighteq");_(C,K,X,"","\\Vdash",!0);_(C,K,X,"","\\shortmid");_(C,K,X,"","\\shortparallel");_(C,K,X,"","\\between",!0);_(C,K,X,"","\\pitchfork",!0);_(C,K,X,"","\\varpropto");_(C,K,X,"","\\blacktriangleleft");_(C,K,X,"","\\therefore",!0);_(C,K,X,"","\\backepsilon");_(C,K,X,"","\\blacktriangleright");_(C,K,X,"","\\because",!0);_(C,K,X,"","\\llless");_(C,K,X,"","\\gggtr");_(C,K,Oe,"","\\lhd");_(C,K,Oe,"","\\rhd");_(C,K,X,"","\\eqsim",!0);_(C,F,X,"","\\Join");_(C,K,X,"","\\Doteq",!0);_(C,K,Oe,"","\\dotplus",!0);_(C,K,Oe,"","\\smallsetminus");_(C,K,Oe,"","\\Cap",!0);_(C,K,Oe,"","\\Cup",!0);_(C,K,Oe,"","\\doublebarwedge",!0);_(C,K,Oe,"","\\boxminus",!0);_(C,K,Oe,"","\\boxplus",!0);_(C,K,Oe,"","\\divideontimes",!0);_(C,K,Oe,"","\\ltimes",!0);_(C,K,Oe,"","\\rtimes",!0);_(C,K,Oe,"","\\leftthreetimes",!0);_(C,K,Oe,"","\\rightthreetimes",!0);_(C,K,Oe,"","\\curlywedge",!0);_(C,K,Oe,"","\\curlyvee",!0);_(C,K,Oe,"","\\circleddash",!0);_(C,K,Oe,"","\\circledast",!0);_(C,K,Oe,"","\\centerdot");_(C,K,Oe,"","\\intercal",!0);_(C,K,Oe,"","\\doublecap");_(C,K,Oe,"","\\doublecup");_(C,K,Oe,"","\\boxtimes",!0);_(C,K,X,"","\\dashrightarrow",!0);_(C,K,X,"","\\dashleftarrow",!0);_(C,K,X,"","\\leftleftarrows",!0);_(C,K,X,"","\\leftrightarrows",!0);_(C,K,X,"","\\Lleftarrow",!0);_(C,K,X,"","\\twoheadleftarrow",!0);_(C,K,X,"","\\leftarrowtail",!0);_(C,K,X,"","\\looparrowleft",!0);_(C,K,X,"","\\leftrightharpoons",!0);_(C,K,X,"","\\curvearrowleft",!0);_(C,K,X,"","\\circlearrowleft",!0);_(C,K,X,"","\\Lsh",!0);_(C,K,X,"","\\upuparrows",!0);_(C,K,X,"","\\upharpoonleft",!0);_(C,K,X,"","\\downharpoonleft",!0);_(C,F,X,"","\\origof",!0);_(C,F,X,"","\\imageof",!0);_(C,K,X,"","\\multimap",!0);_(C,K,X,"","\\leftrightsquigarrow",!0);_(C,K,X,"","\\rightrightarrows",!0);_(C,K,X,"","\\rightleftarrows",!0);_(C,K,X,"","\\twoheadrightarrow",!0);_(C,K,X,"","\\rightarrowtail",!0);_(C,K,X,"","\\looparrowright",!0);_(C,K,X,"","\\curvearrowright",!0);_(C,K,X,"","\\circlearrowright",!0);_(C,K,X,"","\\Rsh",!0);_(C,K,X,"","\\downdownarrows",!0);_(C,K,X,"","\\upharpoonright",!0);_(C,K,X,"","\\downharpoonright",!0);_(C,K,X,"","\\rightsquigarrow",!0);_(C,K,X,"","\\leadsto");_(C,K,X,"","\\Rrightarrow",!0);_(C,K,X,"","\\restriction");_(C,F,Z,"","`");_(C,F,Z,"$","\\$");_(me,F,Z,"$","\\$");_(me,F,Z,"$","\\textdollar");_(C,F,Z,"%","\\%");_(me,F,Z,"%","\\%");_(C,F,Z,"_","\\_");_(me,F,Z,"_","\\_");_(me,F,Z,"_","\\textunderscore");_(C,F,Z,"","\\angle",!0);_(C,F,Z,"","\\infty",!0);_(C,F,Z,"","\\prime");_(C,F,Z,"","\\triangle");_(C,F,Z,"","\\Gamma",!0);_(C,F,Z,"","\\Delta",!0);_(C,F,Z,"","\\Theta",!0);_(C,F,Z,"","\\Lambda",!0);_(C,F,Z,"","\\Xi",!0);_(C,F,Z,"","\\Pi",!0);_(C,F,Z,"","\\Sigma",!0);_(C,F,Z,"","\\Upsilon",!0);_(C,F,Z,"","\\Phi",!0);_(C,F,Z,"","\\Psi",!0);_(C,F,Z,"","\\Omega",!0);_(C,F,Z,"A","");_(C,F,Z,"B","");_(C,F,Z,"E","");_(C,F,Z,"Z","");_(C,F,Z,"H","");_(C,F,Z,"I","");_(C,F,Z,"K","");_(C,F,Z,"M","");_(C,F,Z,"N","");_(C,F,Z,"O","");_(C,F,Z,"P","");_(C,F,Z,"T","");_(C,F,Z,"X","");_(C,F,Z,"","\\neg",!0);_(C,F,Z,"","\\lnot");_(C,F,Z,"","\\top");_(C,F,Z,"","\\bot");_(C,F,Z,"","\\emptyset");_(C,K,Z,"","\\varnothing");_(C,F,ot,"","\\alpha",!0);_(C,F,ot,"","\\beta",!0);_(C,F,ot,"","\\gamma",!0);_(C,F,ot,"","\\delta",!0);_(C,F,ot,"","\\epsilon",!0);_(C,F,ot,"","\\zeta",!0);_(C,F,ot,"","\\eta",!0);_(C,F,ot,"","\\theta",!0);_(C,F,ot,"","\\iota",!0);_(C,F,ot,"","\\kappa",!0);_(C,F,ot,"","\\lambda",!0);_(C,F,ot,"","\\mu",!0);_(C,F,ot,"","\\nu",!0);_(C,F,ot,"","\\xi",!0);_(C,F,ot,"","\\omicron",!0);_(C,F,ot,"","\\pi",!0);_(C,F,ot,"","\\rho",!0);_(C,F,ot,"","\\sigma",!0);_(C,F,ot,"","\\tau",!0);_(C,F,ot,"","\\upsilon",!0);_(C,F,ot,"","\\phi",!0);_(C,F,ot,"","\\chi",!0);_(C,F,ot,"","\\psi",!0);_(C,F,ot,"","\\omega",!0);_(C,F,ot,"","\\varepsilon",!0);_(C,F,ot,"","\\vartheta",!0);_(C,F,ot,"","\\varpi",!0);_(C,F,ot,"","\\varrho",!0);_(C,F,ot,"","\\varsigma",!0);_(C,F,ot,"","\\varphi",!0);_(C,F,Oe,"","*",!0);_(C,F,Oe,"+","+");_(C,F,Oe,"","-",!0);_(C,F,Oe,"","\\cdot",!0);_(C,F,Oe,"","\\circ",!0);_(C,F,Oe,"","\\div",!0);_(C,F,Oe,"","\\pm",!0);_(C,F,Oe,"","\\times",!0);_(C,F,Oe,"","\\cap",!0);_(C,F,Oe,"","\\cup",!0);_(C,F,Oe,"","\\setminus",!0);_(C,F,Oe,"","\\land");_(C,F,Oe,"","\\lor");_(C,F,Oe,"","\\wedge",!0);_(C,F,Oe,"","\\vee",!0);_(C,F,Z,"","\\surd");_(C,F,va,"","\\langle",!0);_(C,F,va,"","\\lvert");_(C,F,va,"","\\lVert");_(C,F,lo,"?","?");_(C,F,lo,"!","!");_(C,F,lo,"","\\rangle",!0);_(C,F,lo,"","\\rvert");_(C,F,lo,"","\\rVert");_(C,F,X,"=","=");_(C,F,X,":",":");_(C,F,X,"","\\approx",!0);_(C,F,X,"","\\cong",!0);_(C,F,X,"","\\ge");_(C,F,X,"","\\geq",!0);_(C,F,X,"","\\gets");_(C,F,X,">","\\gt",!0);_(C,F,X,"","\\in",!0);_(C,F,X,"","\\@not");_(C,F,X,"","\\subset",!0);_(C,F,X,"","\\supset",!0);_(C,F,X,"","\\subseteq",!0);_(C,F,X,"","\\supseteq",!0);_(C,K,X,"","\\nsubseteq",!0);_(C,K,X,"","\\nsupseteq",!0);_(C,F,X,"","\\models");_(C,F,X,"","\\leftarrow",!0);_(C,F,X,"","\\le");_(C,F,X,"","\\leq",!0);_(C,F,X,"<","\\lt",!0);_(C,F,X,"","\\rightarrow",!0);_(C,F,X,"","\\to");_(C,K,X,"","\\ngeq",!0);_(C,K,X,"","\\nleq",!0);_(C,F,xd,"","\\ ");_(C,F,xd,"","\\space");_(C,F,xd,"","\\nobreakspace");_(me,F,xd,"","\\ ");_(me,F,xd,""," ");_(me,F,xd,"","\\space");_(me,F,xd,"","\\nobreakspace");_(C,F,xd,null,"\\nobreak");_(C,F,xd,null,"\\allowbreak");_(C,F,SS,",",",");_(C,F,SS,";",";");_(C,K,Oe,"","\\barwedge",!0);_(C,K,Oe,"","\\veebar",!0);_(C,F,Oe,"","\\odot",!0);_(C,F,Oe,"","\\oplus",!0);_(C,F,Oe,"","\\otimes",!0);_(C,F,Z,"","\\partial",!0);_(C,F,Oe,"","\\oslash",!0);_(C,K,Oe,"","\\circledcirc",!0);_(C,K,Oe,"","\\boxdot",!0);_(C,F,Oe,"","\\bigtriangleup");_(C,F,Oe,"","\\bigtriangledown");_(C,F,Oe,"","\\dagger");_(C,F,Oe,"","\\diamond");_(C,F,Oe,"","\\star");_(C,F,Oe,"","\\triangleleft");_(C,F,Oe,"","\\triangleright");_(C,F,va,"{","\\{");_(me,F,Z,"{","\\{");_(me,F,Z,"{","\\textbraceleft");_(C,F,lo,"}","\\}");_(me,F,Z,"}","\\}");_(me,F,Z,"}","\\textbraceright");_(C,F,va,"{","\\lbrace");_(C,F,lo,"}","\\rbrace");_(C,F,va,"[","\\lbrack",!0);_(me,F,Z,"[","\\lbrack",!0);_(C,F,lo,"]","\\rbrack",!0);_(me,F,Z,"]","\\rbrack",!0);_(C,F,va,"(","\\lparen",!0);_(C,F,lo,")","\\rparen",!0);_(me,F,Z,"<","\\textless",!0);_(me,F,Z,">","\\textgreater",!0);_(C,F,va,"","\\lfloor",!0);_(C,F,lo,"","\\rfloor",!0);_(C,F,va,"","\\lceil",!0);_(C,F,lo,"","\\rceil",!0);_(C,F,Z,"\\","\\backslash");_(C,F,Z,"","|");_(C,F,Z,"","\\vert");_(me,F,Z,"|","\\textbar",!0);_(C,F,Z,"","\\|");_(C,F,Z,"","\\Vert");_(me,F,Z,"","\\textbardbl");_(me,F,Z,"~","\\textasciitilde");_(me,F,Z,"\\","\\textbackslash");_(me,F,Z,"^","\\textasciicircum");_(C,F,X,"","\\uparrow",!0);_(C,F,X,"","\\Uparrow",!0);_(C,F,X,"","\\downarrow",!0);_(C,F,X,"","\\Downarrow",!0);_(C,F,X,"","\\updownarrow",!0);_(C,F,X,"","\\Updownarrow",!0);_(C,F,rs,"","\\coprod");_(C,F,rs,"","\\bigvee");_(C,F,rs,"","\\bigwedge");_(C,F,rs,"","\\biguplus");_(C,F,rs,"","\\bigcap");_(C,F,rs,"","\\bigcup");_(C,F,rs,"","\\int");_(C,F,rs,"","\\intop");_(C,F,rs,"","\\iint");_(C,F,rs,"","\\iiint");_(C,F,rs,"","\\prod");_(C,F,rs,"","\\sum");_(C,F,rs,"","\\bigotimes");_(C,F,rs,"","\\bigoplus");_(C,F,rs,"","\\bigodot");_(C,F,rs,"","\\oint");_(C,F,rs,"","\\oiint");_(C,F,rs,"","\\oiiint");_(C,F,rs,"","\\bigsqcup");_(C,F,rs,"","\\smallint");_(me,F,iy,"","\\textellipsis");_(C,F,iy,"","\\mathellipsis");_(me,F,iy,"","\\ldots",!0);_(C,F,iy,"","\\ldots",!0);_(C,F,iy,"","\\@cdots",!0);_(C,F,iy,"","\\ddots",!0);_(C,F,Z,"","\\varvdots");_(me,F,Z,"","\\varvdots");_(C,F,ar,"","\\acute");_(C,F,ar,"","\\grave");_(C,F,ar,"","\\ddot");_(C,F,ar,"~","\\tilde");_(C,F,ar,"","\\bar");_(C,F,ar,"","\\breve");_(C,F,ar,"","\\check");_(C,F,ar,"^","\\hat");_(C,F,ar,"","\\vec");_(C,F,ar,"","\\dot");_(C,F,ar,"","\\mathring");_(C,F,ot,"","\\@imath");_(C,F,ot,"","\\@jmath");_(C,F,Z,"","");_(C,F,Z,"","");_(me,F,Z,"","\\i",!0);_(me,F,Z,"","\\j",!0);_(me,F,Z,"","\\ss",!0);_(me,F,Z,"","\\ae",!0);_(me,F,Z,"","\\oe",!0);_(me,F,Z,"","\\o",!0);_(me,F,Z,"","\\AE",!0);_(me,F,Z,"","\\OE",!0);_(me,F,Z,"","\\O",!0);_(me,F,ar,"","\\'");_(me,F,ar,"","\\`");_(me,F,ar,"","\\^");_(me,F,ar,"","\\~");_(me,F,ar,"","\\=");_(me,F,ar,"","\\u");_(me,F,ar,"","\\.");_(me,F,ar,"","\\c");_(me,F,ar,"","\\r");_(me,F,ar,"","\\v");_(me,F,ar,"",'\\"');_(me,F,ar,"","\\H");_(me,F,ar,"","\\textcircled");var FY={"--":!0,"---":!0,"``":!0,"''":!0};_(me,F,Z,"","--",!0);_(me,F,Z,"","\\textendash");_(me,F,Z,"","---",!0);_(me,F,Z,"","\\textemdash");_(me,F,Z,"","`",!0);_(me,F,Z,"","\\textquoteleft");_(me,F,Z,"","'",!0);_(me,F,Z,"","\\textquoteright");_(me,F,Z,"","``",!0);_(me,F,Z,"","\\textquotedblleft");_(me,F,Z,"","''",!0);_(me,F,Z,"","\\textquotedblright");_(C,F,Z,"","\\degree",!0);_(me,F,Z,"","\\degree");_(me,F,Z,"","\\textdegree",!0);_(C,F,Z,"","\\pounds");_(C,F,Z,"","\\mathsterling",!0);_(me,F,Z,"","\\pounds");_(me,F,Z,"","\\textsterling",!0);_(C,K,Z,"","\\maltese");_(me,K,Z,"","\\maltese");var TF='0123456789/@."';for(var BA=0;BA<TF.length;BA++){var AF=TF.charAt(BA);_(C,F,Z,AF,AF)}var EF='0123456789!@*()-=+";:?/.,';for(var $A=0;$A<EF.length;$A++){var CF=EF.charAt($A);_(me,F,Z,CF,CF)}var A5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var VA=0;VA<A5.length;VA++){var u4=A5.charAt(VA);_(C,F,ot,u4,u4),_(me,F,Z,u4,u4)}_(C,K,Z,"C","");_(me,K,Z,"C","");_(C,K,Z,"H","");_(me,K,Z,"H","");_(C,K,Z,"N","");_(me,K,Z,"N","");_(C,K,Z,"P","");_(me,K,Z,"P","");_(C,K,Z,"Q","");_(me,K,Z,"Q","");_(C,K,Z,"R","");_(me,K,Z,"R","");_(C,K,Z,"Z","");_(me,K,Z,"Z","");_(C,F,ot,"h","");_(me,F,ot,"h","");var xt="";for(var ji=0;ji<A5.length;ji++){var Nr=A5.charAt(ji);xt=String.fromCharCode(55349,56320+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56372+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56424+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56580+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56684+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56736+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56788+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56840+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56944+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),ji<26&&(xt=String.fromCharCode(55349,56632+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt),xt=String.fromCharCode(55349,56476+ji),_(C,F,ot,Nr,xt),_(me,F,Z,Nr,xt))}xt="";_(C,F,ot,"k",xt);_(me,F,Z,"k",xt);for(var Lf=0;Lf<10;Lf++){var Id=Lf.toString();xt=String.fromCharCode(55349,57294+Lf),_(C,F,ot,Id,xt),_(me,F,Z,Id,xt),xt=String.fromCharCode(55349,57314+Lf),_(C,F,ot,Id,xt),_(me,F,Z,Id,xt),xt=String.fromCharCode(55349,57324+Lf),_(C,F,ot,Id,xt),_(me,F,Z,Id,xt),xt=String.fromCharCode(55349,57334+Lf),_(C,F,ot,Id,xt),_(me,F,Z,Id,xt)}var YC="";for(var UA=0;UA<YC.length;UA++){var d4=YC.charAt(UA);_(C,F,ot,d4,d4),_(me,F,Z,d4,d4)}var h4=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],NF=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],FSe=function(e,t){var r=e.charCodeAt(0),s=e.charCodeAt(1),i=(r-55296)*1024+(s-56320)+65536,o=t==="math"?0:1;if(119808<=i&&i<120484){var a=Math.floor((i-119808)/26);return[h4[a][2],h4[a][o]]}else if(120782<=i&&i<=120831){var l=Math.floor((i-120782)/10);return[NF[l][2],NF[l][o]]}else{if(i===120485||i===120486)return[h4[0][2],h4[0][o]];if(120486<i&&i<120782)return["",""];throw new _e("Unsupported character: "+e)}},TS=function(e,t,r){return Kn[r][e]&&Kn[r][e].replace&&(e=Kn[r][e].replace),{value:e,metrics:zR(e,t,r)}},El=function(e,t,r,s,i){var o=TS(e,t,r),a=o.metrics;e=o.value;var l;if(a){var c=a.italic;(r==="text"||s&&s.font==="mathit")&&(c=0),l=new rl(e,a.height,a.depth,c,a.skew,a.width,i)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+t+"' and mode '"+r+"'")),l=new rl(e,0,0,0,0,0,i);if(s){l.maxFontSize=s.sizeMultiplier,s.style.isTight()&&l.classes.push("mtight");var u=s.getColor();u&&(l.style.color=u)}return l},zSe=function(e,t,r,s){return s===void 0&&(s=[]),r.font==="boldsymbol"&&TS(e,"Main-Bold",t).metrics?El(e,"Main-Bold",t,r,s.concat(["mathbf"])):e==="\\"||Kn[t][e].font==="main"?El(e,"Main-Regular",t,r,s):El(e,"AMS-Regular",t,r,s.concat(["amsrm"]))},BSe=function(e,t,r,s,i){return i!=="textord"&&TS(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},$Se=function(e,t,r){var s=e.mode,i=e.text,o=["mord"],a=s==="math"||s==="text"&&t.font,l=a?t.font:t.fontFamily,c="",u="";if(i.charCodeAt(0)===55349&&([c,u]=FSe(i,s)),c.length>0)return El(i,c,s,t,o.concat(u));if(l){var h,f;if(l==="boldsymbol"){var p=BSe(i,s,t,o,r);h=p.fontName,f=[p.fontClass]}else a?(h=$Y[l].fontName,f=[l]):(h=f4(l,t.fontWeight,t.fontShape),f=[l,t.fontWeight,t.fontShape]);if(TS(i,h,s).metrics)return El(i,h,s,t,o.concat(f));if(FY.hasOwnProperty(i)&&h.slice(0,10)==="Typewriter"){for(var g=[],y=0;y<i.length;y++)g.push(El(i[y],h,s,t,o.concat(f)));return BY(g)}}if(r==="mathord")return El(i,"Math-Italic",s,t,o.concat(["mathnormal"]));if(r==="textord"){var v=Kn[s][i]&&Kn[s][i].font;if(v==="ams"){var b=f4("amsrm",t.fontWeight,t.fontShape);return El(i,b,s,t,o.concat("amsrm",t.fontWeight,t.fontShape))}else if(v==="main"||!v){var w=f4("textrm",t.fontWeight,t.fontShape);return El(i,w,s,t,o.concat(t.fontWeight,t.fontShape))}else{var k=f4(v,t.fontWeight,t.fontShape);return El(i,k,s,t,o.concat(k,t.fontWeight,t.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},VSe=(n,e)=>{if(uf(n.classes)!==uf(e.classes)||n.skew!==e.skew||n.maxFontSize!==e.maxFontSize)return!1;if(n.classes.length===1){var t=n.classes[0];if(t==="mbin"||t==="mord")return!1}for(var r in n.style)if(n.style.hasOwnProperty(r)&&n.style[r]!==e.style[r])return!1;for(var s in e.style)if(e.style.hasOwnProperty(s)&&n.style[s]!==e.style[s])return!1;return!0},USe=n=>{for(var e=0;e<n.length-1;e++){var t=n[e],r=n[e+1];t instanceof rl&&r instanceof rl&&VSe(t,r)&&(t.text+=r.text,t.height=Math.max(t.height,r.height),t.depth=Math.max(t.depth,r.depth),t.italic=r.italic,n.splice(e+1,1),e--)}return n},$R=function(e){for(var t=0,r=0,s=0,i=0;i<e.children.length;i++){var o=e.children[i];o.height>t&&(t=o.height),o.depth>r&&(r=o.depth),o.maxFontSize>s&&(s=o.maxFontSize)}e.height=t,e.depth=r,e.maxFontSize=s},bo=function(e,t,r,s){var i=new a2(e,t,r,s);return $R(i),i},zY=(n,e,t,r)=>new a2(n,e,t,r),HSe=function(e,t,r){var s=bo([e],[],t);return s.height=Math.max(r||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),s.style.borderBottomWidth=Ee(s.height),s.maxFontSize=1,s},qSe=function(e,t,r,s){var i=new BR(e,t,r,s);return $R(i),i},BY=function(e){var t=new o2(e);return $R(t),t},GSe=function(e,t){return e instanceof o2?bo([],[e],t):e},WSe=function(e){if(e.positionType==="individualShift"){for(var t=e.children,r=[t[0]],s=-t[0].shift-t[0].elem.depth,i=s,o=1;o<t.length;o++){var a=-t[o].shift-i-t[o].elem.depth,l=a-(t[o-1].elem.height+t[o-1].elem.depth);i=i+a,r.push({type:"kern",size:l}),r.push(t[o])}return{children:r,depth:s}}var c;if(e.positionType==="top"){for(var u=e.positionData,h=0;h<e.children.length;h++){var f=e.children[h];u-=f.type==="kern"?f.size:f.elem.height+f.elem.depth}c=u}else if(e.positionType==="bottom")c=-e.positionData;else{var p=e.children[0];if(p.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")c=-p.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")c=-p.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:c}},KSe=function(e,t){for(var{children:r,depth:s}=WSe(e),i=0,o=0;o<r.length;o++){var a=r[o];if(a.type==="elem"){var l=a.elem;i=Math.max(i,l.maxFontSize,l.height)}}i+=2;var c=bo(["pstrut"],[]);c.style.height=Ee(i);for(var u=[],h=s,f=s,p=s,g=0;g<r.length;g++){var y=r[g];if(y.type==="kern")p+=y.size;else{var v=y.elem,b=y.wrapperClasses||[],w=y.wrapperStyle||{},k=bo(b,[c,v],void 0,w);k.style.top=Ee(-i-p-v.depth),y.marginLeft&&(k.style.marginLeft=y.marginLeft),y.marginRight&&(k.style.marginRight=y.marginRight),u.push(k),p+=v.height+v.depth}h=Math.min(h,p),f=Math.max(f,p)}var T=bo(["vlist"],u);T.style.height=Ee(f);var R;if(h<0){var M=bo([],[]),E=bo(["vlist"],[M]);E.style.height=Ee(-h);var I=bo(["vlist-s"],[new rl("")]);R=[bo(["vlist-r"],[T,I]),bo(["vlist-r"],[E])]}else R=[bo(["vlist-r"],[T])];var S=bo(["vlist-t"],R);return R.length===2&&S.classes.push("vlist-t2"),S.height=f,S.depth=-h,S},YSe=(n,e)=>{var t=bo(["mspace"],[],e),r=yr(n,e);return t.style.marginRight=Ee(r),t},f4=function(e,t,r){var s="";switch(e){case"amsrm":s="AMS";break;case"textrm":s="Main";break;case"textsf":s="SansSerif";break;case"texttt":s="Typewriter";break;default:s=e}var i;return t==="textbf"&&r==="textit"?i="BoldItalic":t==="textbf"?i="Bold":t==="textit"?i="Italic":i="Regular",s+"-"+i},$Y={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},VY={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},XSe=function(e,t){var[r,s,i]=VY[e],o=new df(r),a=new od([o],{width:Ee(s),height:Ee(i),style:"width:"+Ee(s),viewBox:"0 0 "+1e3*s+" "+1e3*i,preserveAspectRatio:"xMinYMin"}),l=zY(["overlay"],[a],t);return l.height=i,l.style.height=Ee(i),l.style.width=Ee(s),l},ie={fontMap:$Y,makeSymbol:El,mathsym:zSe,makeSpan:bo,makeSvgSpan:zY,makeLineSpan:HSe,makeAnchor:qSe,makeFragment:BY,wrapFragment:GSe,makeVList:KSe,makeOrd:$Se,makeGlue:YSe,staticSvg:XSe,svgData:VY,tryCombineChars:USe},pr={number:3,unit:"mu"},Df={number:4,unit:"mu"},eu={number:5,unit:"mu"},JSe={mord:{mop:pr,mbin:Df,mrel:eu,minner:pr},mop:{mord:pr,mop:pr,mrel:eu,minner:pr},mbin:{mord:Df,mop:Df,mopen:Df,minner:Df},mrel:{mord:eu,mop:eu,mopen:eu,minner:eu},mopen:{},mclose:{mop:pr,mbin:Df,mrel:eu,minner:pr},mpunct:{mord:pr,mop:pr,mrel:eu,mopen:pr,mclose:pr,mpunct:pr,minner:pr},minner:{mord:pr,mop:pr,mbin:Df,mrel:eu,mopen:pr,mpunct:pr,minner:pr}},QSe={mord:{mop:pr},mop:{mord:pr,mop:pr},mbin:{},mrel:{},mopen:{},mclose:{mop:pr},mpunct:{},minner:{mop:pr}},UY={},E5={},C5={};function Pe(n){for(var{type:e,names:t,props:r,handler:s,htmlBuilder:i,mathmlBuilder:o}=n,a={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:s},l=0;l<t.length;++l)UY[t[l]]=a;e&&(i&&(E5[e]=i),o&&(C5[e]=o))}function tm(n){var{type:e,htmlBuilder:t,mathmlBuilder:r}=n;Pe({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:t,mathmlBuilder:r})}var N5=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},Ur=function(e){return e.type==="ordgroup"?e.body:[e]},ad=ie.makeSpan,ZSe=["leftmost","mbin","mopen","mrel","mop","mpunct"],eTe=["rightmost","mrel","mclose","mpunct"],tTe={display:at.DISPLAY,text:at.TEXT,script:at.SCRIPT,scriptscript:at.SCRIPTSCRIPT},nTe={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},xs=function(e,t,r,s){s===void 0&&(s=[null,null]);for(var i=[],o=0;o<e.length;o++){var a=pn(e[o],t);if(a instanceof o2){var l=a.children;i.push(...l)}else i.push(a)}if(ie.tryCombineChars(i),!r)return i;var c=t;if(e.length===1){var u=e[0];u.type==="sizing"?c=t.havingSize(u.size):u.type==="styling"&&(c=t.havingStyle(tTe[u.style]))}var h=ad([s[0]||"leftmost"],[],t),f=ad([s[1]||"rightmost"],[],t),p=r==="root";return IF(i,(g,y)=>{var v=y.classes[0],b=g.classes[0];v==="mbin"&&eTe.includes(b)?y.classes[0]="mord":b==="mbin"&&ZSe.includes(v)&&(g.classes[0]="mord")},{node:h},f,p),IF(i,(g,y)=>{var v=XC(y),b=XC(g),w=v&&b?g.hasClass("mtight")?QSe[v][b]:JSe[v][b]:null;if(w)return ie.makeGlue(w,c)},{node:h},f,p),i},IF=function n(e,t,r,s,i){s&&e.push(s);for(var o=0;o<e.length;o++){var a=e[o],l=HY(a);if(l){n(l.children,t,r,null,i);continue}var c=!a.hasClass("mspace");if(c){var u=t(a,r.node);u&&(r.insertAfter?r.insertAfter(u):(e.unshift(u),o++))}c?r.node=a:i&&a.hasClass("newline")&&(r.node=ad(["leftmost"])),r.insertAfter=(h=>f=>{e.splice(h+1,0,f),o++})(o)}s&&e.pop()},HY=function(e){return e instanceof o2||e instanceof BR||e instanceof a2&&e.hasClass("enclosing")?e:null},rTe=function n(e,t){var r=HY(e);if(r){var s=r.children;if(s.length){if(t==="right")return n(s[s.length-1],"right");if(t==="left")return n(s[0],"left")}}return e},XC=function(e,t){return e?(t&&(e=rTe(e,t)),nTe[e.classes[0]]||null):null},Vb=function(e,t){var r=["nulldelimiter"].concat(e.baseSizingClasses());return ad(t.concat(r))},pn=function(e,t,r){if(!e)return ad();if(E5[e.type]){var s=E5[e.type](e,t);if(r&&t.size!==r.size){s=ad(t.sizingClasses(r),[s],t);var i=t.sizeMultiplier/r.sizeMultiplier;s.height*=i,s.depth*=i}return s}else throw new _e("Got group of unknown type: '"+e.type+"'")};function p4(n,e){var t=ad(["base"],n,e),r=ad(["strut"]);return r.style.height=Ee(t.height+t.depth),t.depth&&(r.style.verticalAlign=Ee(-t.depth)),t.children.unshift(r),t}function JC(n,e){var t=null;n.length===1&&n[0].type==="tag"&&(t=n[0].tag,n=n[0].body);var r=xs(n,e,"root"),s;r.length===2&&r[1].hasClass("tag")&&(s=r.pop());for(var i=[],o=[],a=0;a<r.length;a++)if(o.push(r[a]),r[a].hasClass("mbin")||r[a].hasClass("mrel")||r[a].hasClass("allowbreak")){for(var l=!1;a<r.length-1&&r[a+1].hasClass("mspace")&&!r[a+1].hasClass("newline");)a++,o.push(r[a]),r[a].hasClass("nobreak")&&(l=!0);l||(i.push(p4(o,e)),o=[])}else r[a].hasClass("newline")&&(o.pop(),o.length>0&&(i.push(p4(o,e)),o=[]),i.push(r[a]));o.length>0&&i.push(p4(o,e));var c;t?(c=p4(xs(t,e,!0)),c.classes=["tag"],i.push(c)):s&&i.push(s);var u=ad(["katex-html"],i);if(u.setAttribute("aria-hidden","true"),c){var h=c.children[0];h.style.height=Ee(u.height+u.depth),u.depth&&(h.style.verticalAlign=Ee(-u.depth))}return u}function qY(n){return new o2(n)}class ra{constructor(e,t,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=r||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=uf(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof Ac&&this.children[r+1]instanceof Ac){for(var s=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof Ac;)s+=this.children[++r].toText();e.appendChild(new Ac(s).toNode())}else e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=gn.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+gn.escape(uf(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class Ac{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return gn.escape(this.toText())}toText(){return this.text}}class sTe{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="":e>=.1666&&e<=.1667?this.character="":e>=.2222&&e<=.2223?this.character="":e>=.2777&&e<=.2778?this.character="":e>=-.05556&&e<=-.05555?this.character="":e>=-.1667&&e<=-.1666?this.character="":e>=-.2223&&e<=-.2222?this.character="":e>=-.2778&&e<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",Ee(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+Ee(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var be={MathNode:ra,TextNode:Ac,SpaceNode:sTe,newDocumentFragment:qY},sl=function(e,t,r){return Kn[t][e]&&Kn[t][e].replace&&e.charCodeAt(0)!==55349&&!(FY.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=Kn[t][e].replace),new be.TextNode(e)},VR=function(e){return e.length===1?e[0]:new be.MathNode("mrow",e)},UR=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";var r=t.font;if(!r||r==="mathnormal")return null;var s=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var i=e.text;if(["\\imath","\\jmath"].includes(i))return null;Kn[s][i]&&Kn[s][i].replace&&(i=Kn[s][i].replace);var o=ie.fontMap[r].fontName;return zR(i,o,s)?ie.fontMap[r].variant:null};function HA(n){if(!n)return!1;if(n.type==="mi"&&n.children.length===1){var e=n.children[0];return e instanceof Ac&&e.text==="."}else if(n.type==="mo"&&n.children.length===1&&n.getAttribute("separator")==="true"&&n.getAttribute("lspace")==="0em"&&n.getAttribute("rspace")==="0em"){var t=n.children[0];return t instanceof Ac&&t.text===","}else return!1}var Do=function(e,t,r){if(e.length===1){var s=$n(e[0],t);return r&&s instanceof ra&&s.type==="mo"&&(s.setAttribute("lspace","0em"),s.setAttribute("rspace","0em")),[s]}for(var i=[],o,a=0;a<e.length;a++){var l=$n(e[a],t);if(l instanceof ra&&o instanceof ra){if(l.type==="mtext"&&o.type==="mtext"&&l.getAttribute("mathvariant")===o.getAttribute("mathvariant")){o.children.push(...l.children);continue}else if(l.type==="mn"&&o.type==="mn"){o.children.push(...l.children);continue}else if(HA(l)&&o.type==="mn"){o.children.push(...l.children);continue}else if(l.type==="mn"&&HA(o))l.children=[...o.children,...l.children],i.pop();else if((l.type==="msup"||l.type==="msub")&&l.children.length>=1&&(o.type==="mn"||HA(o))){var c=l.children[0];c instanceof ra&&c.type==="mn"&&(c.children=[...o.children,...c.children],i.pop())}else if(o.type==="mi"&&o.children.length===1){var u=o.children[0];if(u instanceof Ac&&u.text===""&&(l.type==="mo"||l.type==="mi"||l.type==="mn")){var h=l.children[0];h instanceof Ac&&h.text.length>0&&(h.text=h.text.slice(0,1)+""+h.text.slice(1),i.pop())}}}i.push(l),o=l}return i},hf=function(e,t,r){return VR(Do(e,t,r))},$n=function(e,t){if(!e)return new be.MathNode("mrow");if(C5[e.type]){var r=C5[e.type](e,t);return r}else throw new _e("Got group of unknown type: '"+e.type+"'")};function RF(n,e,t,r,s){var i=Do(n,t),o;i.length===1&&i[0]instanceof ra&&["mrow","mtable"].includes(i[0].type)?o=i[0]:o=new be.MathNode("mrow",i);var a=new be.MathNode("annotation",[new be.TextNode(e)]);a.setAttribute("encoding","application/x-tex");var l=new be.MathNode("semantics",[o,a]),c=new be.MathNode("math",[l]);c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&c.setAttribute("display","block");var u=s?"katex":"katex-mathml";return ie.makeSpan([u],[c])}var GY=function(e){return new uu({style:e.displayMode?at.DISPLAY:at.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},WY=function(e,t){if(t.displayMode){var r=["katex-display"];t.leqno&&r.push("leqno"),t.fleqn&&r.push("fleqn"),e=ie.makeSpan(r,[e])}return e},iTe=function(e,t,r){var s=GY(r),i;if(r.output==="mathml")return RF(e,t,s,r.displayMode,!0);if(r.output==="html"){var o=JC(e,s);i=ie.makeSpan(["katex"],[o])}else{var a=RF(e,t,s,r.displayMode,!1),l=JC(e,s);i=ie.makeSpan(["katex"],[a,l])}return WY(i,r)},oTe=function(e,t,r){var s=GY(r),i=JC(e,s),o=ie.makeSpan(["katex"],[i]);return WY(o,r)},aTe={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},lTe=function(e){var t=new be.MathNode("mo",[new be.TextNode(aTe[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},cTe={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},uTe=function(e){return e.type==="ordgroup"?e.body.length:1},dTe=function(e,t){function r(){var a=4e5,l=e.label.slice(1);if(["widehat","widecheck","widetilde","utilde"].includes(l)){var c=e,u=uTe(c.base),h,f,p;if(u>5)l==="widehat"||l==="widecheck"?(h=420,a=2364,p=.42,f=l+"4"):(h=312,a=2340,p=.34,f="tilde4");else{var g=[1,1,2,2,3,3][u];l==="widehat"||l==="widecheck"?(a=[0,1062,2364,2364,2364][g],h=[0,239,300,360,420][g],p=[0,.24,.3,.3,.36,.42][g],f=l+g):(a=[0,600,1033,2339,2340][g],h=[0,260,286,306,312][g],p=[0,.26,.286,.3,.306,.34][g],f="tilde"+g)}var y=new df(f),v=new od([y],{width:"100%",height:Ee(p),viewBox:"0 0 "+a+" "+h,preserveAspectRatio:"none"});return{span:ie.makeSvgSpan([],[v],t),minWidth:0,height:p}}else{var b=[],w=cTe[l],[k,T,R]=w,M=R/1e3,E=k.length,I,S;if(E===1){var N=w[3];I=["hide-tail"],S=[N]}else if(E===2)I=["halfarrow-left","halfarrow-right"],S=["xMinYMin","xMaxYMin"];else if(E===3)I=["brace-left","brace-center","brace-right"],S=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+E+" children.");for(var P=0;P<E;P++){var O=new df(k[P]),D=new od([O],{width:"400em",height:Ee(M),viewBox:"0 0 "+a+" "+R,preserveAspectRatio:S[P]+" slice"}),G=ie.makeSvgSpan([I[P]],[D],t);if(E===1)return{span:G,minWidth:T,height:M};G.style.height=Ee(M),b.push(G)}return{span:ie.makeSpan(["stretchy"],b,t),minWidth:T,height:M}}}var{span:s,minWidth:i,height:o}=r();return s.height=o,s.style.height=Ee(o),i>0&&(s.style.minWidth=Ee(i)),s},hTe=function(e,t,r,s,i){var o,a=e.height+e.depth+r+s;if(/fbox|color|angl/.test(t)){if(o=ie.makeSpan(["stretchy",t],[],i),t==="fbox"){var l=i.color&&i.getColor();l&&(o.style.borderColor=l)}}else{var c=[];/^[bx]cancel$/.test(t)&&c.push(new KC({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&c.push(new KC({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var u=new od(c,{width:"100%",height:Ee(a)});o=ie.makeSvgSpan([],[u],i)}return o.height=a,o.style.height=Ee(a),o},ld={encloseSpan:hTe,mathMLnode:lTe,svgSpan:dTe};function Dt(n,e){if(!n||n.type!==e)throw new Error("Expected node of type "+e+", but got "+(n?"node of type "+n.type:String(n)));return n}function HR(n){var e=AS(n);if(!e)throw new Error("Expected node of symbol group type, but got "+(n?"node of type "+n.type:String(n)));return e}function AS(n){return n&&(n.type==="atom"||OSe.hasOwnProperty(n.type))?n:null}var qR=(n,e)=>{var t,r,s;n&&n.type==="supsub"?(r=Dt(n.base,"accent"),t=r.base,n.base=t,s=DSe(pn(n,e)),n.base=r):(r=Dt(n,"accent"),t=r.base);var i=pn(t,e.havingCrampedStyle()),o=r.isShifty&&gn.isCharacterBox(t),a=0;if(o){var l=gn.getBaseElem(t),c=pn(l,e.havingCrampedStyle());a=SF(c).skew}var u=r.label==="\\c",h=u?i.height+i.depth:Math.min(i.height,e.fontMetrics().xHeight),f;if(r.isStretchy)f=ld.svgSpan(r,e),f=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"elem",elem:f,wrapperClasses:["svg-align"],wrapperStyle:a>0?{width:"calc(100% - "+Ee(2*a)+")",marginLeft:Ee(2*a)}:void 0}]},e);else{var p,g;r.label==="\\vec"?(p=ie.staticSvg("vec",e),g=ie.svgData.vec[1]):(p=ie.makeOrd({mode:r.mode,text:r.label},e,"textord"),p=SF(p),p.italic=0,g=p.width,u&&(h+=p.depth)),f=ie.makeSpan(["accent-body"],[p]);var y=r.label==="\\textcircled";y&&(f.classes.push("accent-full"),h=i.height);var v=a;y||(v-=g/2),f.style.left=Ee(v),r.label==="\\textcircled"&&(f.style.top=".2em"),f=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:-h},{type:"elem",elem:f}]},e)}var b=ie.makeSpan(["mord","accent"],[f],e);return s?(s.children[0]=b,s.height=Math.max(b.height,s.height),s.classes[0]="mord",s):b},KY=(n,e)=>{var t=n.isStretchy?ld.mathMLnode(n.label):new be.MathNode("mo",[sl(n.label,n.mode)]),r=new be.MathNode("mover",[$n(n.base,e),t]);return r.setAttribute("accent","true"),r},fTe=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(n=>"\\"+n).join("|"));Pe({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(n,e)=>{var t=N5(e[0]),r=!fTe.test(n.funcName),s=!r||n.funcName==="\\widehat"||n.funcName==="\\widetilde"||n.funcName==="\\widecheck";return{type:"accent",mode:n.parser.mode,label:n.funcName,isStretchy:r,isShifty:s,base:t}},htmlBuilder:qR,mathmlBuilder:KY});Pe({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(n,e)=>{var t=e[0],r=n.parser.mode;return r==="math"&&(n.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+n.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:n.funcName,isStretchy:!1,isShifty:!0,base:t}},htmlBuilder:qR,mathmlBuilder:KY});Pe({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0];return{type:"accentUnder",mode:t.mode,label:r,base:s}},htmlBuilder:(n,e)=>{var t=pn(n.base,e),r=ld.svgSpan(n,e),s=n.label==="\\utilde"?.12:0,i=ie.makeVList({positionType:"top",positionData:t.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:s},{type:"elem",elem:t}]},e);return ie.makeSpan(["mord","accentunder"],[i],e)},mathmlBuilder:(n,e)=>{var t=ld.mathMLnode(n.label),r=new be.MathNode("munder",[$n(n.base,e),t]);return r.setAttribute("accentunder","true"),r}});var m4=n=>{var e=new be.MathNode("mpadded",n?[n]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};Pe({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r,funcName:s}=n;return{type:"xArrow",mode:r.mode,label:s,body:e[0],below:t[0]}},htmlBuilder(n,e){var t=e.style,r=e.havingStyle(t.sup()),s=ie.wrapFragment(pn(n.body,r,e),e),i=n.label.slice(0,2)==="\\x"?"x":"cd";s.classes.push(i+"-arrow-pad");var o;n.below&&(r=e.havingStyle(t.sub()),o=ie.wrapFragment(pn(n.below,r,e),e),o.classes.push(i+"-arrow-pad"));var a=ld.svgSpan(n,e),l=-e.fontMetrics().axisHeight+.5*a.height,c=-e.fontMetrics().axisHeight-.5*a.height-.111;(s.depth>.25||n.label==="\\xleftequilibrium")&&(c-=s.depth);var u;if(o){var h=-e.fontMetrics().axisHeight+o.height+.5*a.height+.111;u=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:c},{type:"elem",elem:a,shift:l},{type:"elem",elem:o,shift:h}]},e)}else u=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:c},{type:"elem",elem:a,shift:l}]},e);return u.children[0].children[0].children[1].classes.push("svg-align"),ie.makeSpan(["mrel","x-arrow"],[u],e)},mathmlBuilder(n,e){var t=ld.mathMLnode(n.label);t.setAttribute("minsize",n.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(n.body){var s=m4($n(n.body,e));if(n.below){var i=m4($n(n.below,e));r=new be.MathNode("munderover",[t,i,s])}else r=new be.MathNode("mover",[t,s])}else if(n.below){var o=m4($n(n.below,e));r=new be.MathNode("munder",[t,o])}else r=m4(),r=new be.MathNode("mover",[t,r]);return r}});var pTe=ie.makeSpan;function YY(n,e){var t=xs(n.body,e,!0);return pTe([n.mclass],t,e)}function XY(n,e){var t,r=Do(n.body,e);return n.mclass==="minner"?t=new be.MathNode("mpadded",r):n.mclass==="mord"?n.isCharacterBox?(t=r[0],t.type="mi"):t=new be.MathNode("mi",r):(n.isCharacterBox?(t=r[0],t.type="mo"):t=new be.MathNode("mo",r),n.mclass==="mbin"?(t.attributes.lspace="0.22em",t.attributes.rspace="0.22em"):n.mclass==="mpunct"?(t.attributes.lspace="0em",t.attributes.rspace="0.17em"):n.mclass==="mopen"||n.mclass==="mclose"?(t.attributes.lspace="0em",t.attributes.rspace="0em"):n.mclass==="minner"&&(t.attributes.lspace="0.0556em",t.attributes.width="+0.1111em")),t}Pe({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(n,e){var{parser:t,funcName:r}=n,s=e[0];return{type:"mclass",mode:t.mode,mclass:"m"+r.slice(5),body:Ur(s),isCharacterBox:gn.isCharacterBox(s)}},htmlBuilder:YY,mathmlBuilder:XY});var ES=n=>{var e=n.type==="ordgroup"&&n.body.length?n.body[0]:n;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};Pe({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(n,e){var{parser:t}=n;return{type:"mclass",mode:t.mode,mclass:ES(e[0]),body:Ur(e[1]),isCharacterBox:gn.isCharacterBox(e[1])}}});Pe({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(n,e){var{parser:t,funcName:r}=n,s=e[1],i=e[0],o;r!=="\\stackrel"?o=ES(s):o="mrel";var a={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:Ur(s)},l={type:"supsub",mode:i.mode,base:a,sup:r==="\\underset"?null:i,sub:r==="\\underset"?i:null};return{type:"mclass",mode:t.mode,mclass:o,body:[l],isCharacterBox:gn.isCharacterBox(l)}},htmlBuilder:YY,mathmlBuilder:XY});Pe({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"pmb",mode:t.mode,mclass:ES(e[0]),body:Ur(e[0])}},htmlBuilder(n,e){var t=xs(n.body,e,!0),r=ie.makeSpan([n.mclass],t,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(n,e){var t=Do(n.body,e),r=new be.MathNode("mstyle",t);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var mTe={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},MF=()=>({type:"styling",body:[],mode:"math",style:"display"}),PF=n=>n.type==="textord"&&n.text==="@",gTe=(n,e)=>(n.type==="mathord"||n.type==="atom")&&n.text===e;function yTe(n,e,t){var r=mTe[n];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return t.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var s=t.callFunction("\\\\cdleft",[e[0]],[]),i={type:"atom",text:r,mode:"math",family:"rel"},o=t.callFunction("\\Big",[i],[]),a=t.callFunction("\\\\cdright",[e[1]],[]),l={type:"ordgroup",mode:"math",body:[s,o,a]};return t.callFunction("\\\\cdparent",[l],[])}case"\\\\cdlongequal":return t.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var c={type:"textord",text:"\\Vert",mode:"math"};return t.callFunction("\\Big",[c],[])}default:return{type:"textord",text:" ",mode:"math"}}}function xTe(n){var e=[];for(n.gullet.beginGroup(),n.gullet.macros.set("\\cr","\\\\\\relax"),n.gullet.beginGroup();;){e.push(n.parseExpression(!1,"\\\\")),n.gullet.endGroup(),n.gullet.beginGroup();var t=n.fetch().text;if(t==="&"||t==="\\\\")n.consume();else if(t==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new _e("Expected \\\\ or \\cr or \\end",n.nextToken)}for(var r=[],s=[r],i=0;i<e.length;i++){for(var o=e[i],a=MF(),l=0;l<o.length;l++)if(!PF(o[l]))a.body.push(o[l]);else{r.push(a),l+=1;var c=HR(o[l]).text,u=new Array(2);if(u[0]={type:"ordgroup",mode:"math",body:[]},u[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(c)>-1))if("<>AV".indexOf(c)>-1)for(var h=0;h<2;h++){for(var f=!0,p=l+1;p<o.length;p++){if(gTe(o[p],c)){f=!1,l=p;break}if(PF(o[p]))throw new _e("Missing a "+c+" character to complete a CD arrow.",o[p]);u[h].body.push(o[p])}if(f)throw new _e("Missing a "+c+" character to complete a CD arrow.",o[l])}else throw new _e('Expected one of "<>AV=|." after @',o[l]);var g=yTe(c,u,n),y={type:"styling",body:[g],mode:"math",style:"display"};r.push(y),a=MF()}i%2===0?r.push(a):r.shift(),r=[],s.push(r)}n.gullet.endGroup(),n.gullet.endGroup();var v=new Array(s[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:s,arraystretch:1,addJot:!0,rowGaps:[null],cols:v,colSeparationType:"CD",hLinesBeforeRow:new Array(s.length+1).fill([])}}Pe({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"cdlabel",mode:t.mode,side:r.slice(4),label:e[0]}},htmlBuilder(n,e){var t=e.havingStyle(e.style.sup()),r=ie.wrapFragment(pn(n.label,t,e),e);return r.classes.push("cd-label-"+n.side),r.style.bottom=Ee(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(n,e){var t=new be.MathNode("mrow",[$n(n.label,e)]);return t=new be.MathNode("mpadded",[t]),t.setAttribute("width","0"),n.side==="left"&&t.setAttribute("lspace","-1width"),t.setAttribute("voffset","0.7em"),t=new be.MathNode("mstyle",[t]),t.setAttribute("displaystyle","false"),t.setAttribute("scriptlevel","1"),t}});Pe({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(n,e){var{parser:t}=n;return{type:"cdlabelparent",mode:t.mode,fragment:e[0]}},htmlBuilder(n,e){var t=ie.wrapFragment(pn(n.fragment,e),e);return t.classes.push("cd-vert-arrow"),t},mathmlBuilder(n,e){return new be.MathNode("mrow",[$n(n.fragment,e)])}});Pe({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(n,e){for(var{parser:t}=n,r=Dt(e[0],"ordgroup"),s=r.body,i="",o=0;o<s.length;o++){var a=Dt(s[o],"textord");i+=a.text}var l=parseInt(i),c;if(isNaN(l))throw new _e("\\@char has non-numeric argument "+i);if(l<0||l>=1114111)throw new _e("\\@char with invalid code point "+i);return l<=65535?c=String.fromCharCode(l):(l-=65536,c=String.fromCharCode((l>>10)+55296,(l&1023)+56320)),{type:"textord",mode:t.mode,text:c}}});var JY=(n,e)=>{var t=xs(n.body,e.withColor(n.color),!1);return ie.makeFragment(t)},QY=(n,e)=>{var t=Do(n.body,e.withColor(n.color)),r=new be.MathNode("mstyle",t);return r.setAttribute("mathcolor",n.color),r};Pe({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(n,e){var{parser:t}=n,r=Dt(e[0],"color-token").color,s=e[1];return{type:"color",mode:t.mode,color:r,body:Ur(s)}},htmlBuilder:JY,mathmlBuilder:QY});Pe({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(n,e){var{parser:t,breakOnTokenText:r}=n,s=Dt(e[0],"color-token").color;t.gullet.macros.set("\\current@color",s);var i=t.parseExpression(!0,r);return{type:"color",mode:t.mode,color:s,body:i}},htmlBuilder:JY,mathmlBuilder:QY});Pe({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(n,e,t){var{parser:r}=n,s=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,i=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:i,size:s&&Dt(s,"size").value}},htmlBuilder(n,e){var t=ie.makeSpan(["mspace"],[],e);return n.newLine&&(t.classes.push("newline"),n.size&&(t.style.marginTop=Ee(yr(n.size,e)))),t},mathmlBuilder(n,e){var t=new be.MathNode("mspace");return n.newLine&&(t.setAttribute("linebreak","newline"),n.size&&t.setAttribute("height",Ee(yr(n.size,e)))),t}});var QC={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},ZY=n=>{var e=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new _e("Expected a control sequence",n);return e},bTe=n=>{var e=n.gullet.popToken();return e.text==="="&&(e=n.gullet.popToken(),e.text===" "&&(e=n.gullet.popToken())),e},eX=(n,e,t,r)=>{var s=n.gullet.macros.get(t.text);s==null&&(t.noexpand=!0,s={tokens:[t],numArgs:0,unexpandable:!n.gullet.isExpandable(t.text)}),n.gullet.macros.set(e,s,r)};Pe({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e,funcName:t}=n;e.consumeSpaces();var r=e.fetch();if(QC[r.text])return(t==="\\global"||t==="\\\\globallong")&&(r.text=QC[r.text]),Dt(e.parseFunction(),"internal");throw new _e("Invalid token after macro prefix",r)}});Pe({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=e.gullet.popToken(),s=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(s))throw new _e("Expected a control sequence",r);for(var i=0,o,a=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){o=e.gullet.future(),a[i].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new _e('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==i+1)throw new _e('Argument number "'+r.text+'" out of order');i++,a.push([])}else{if(r.text==="EOF")throw new _e("Expected a macro definition");a[i].push(r.text)}var{tokens:l}=e.gullet.consumeArg();return o&&l.unshift(o),(t==="\\edef"||t==="\\xdef")&&(l=e.gullet.expandTokens(l),l.reverse()),e.gullet.macros.set(s,{tokens:l,numArgs:i,delimiters:a},t===QC[t]),{type:"internal",mode:e.mode}}});Pe({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=ZY(e.gullet.popToken());e.gullet.consumeSpaces();var s=bTe(e);return eX(e,r,s,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});Pe({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=ZY(e.gullet.popToken()),s=e.gullet.popToken(),i=e.gullet.popToken();return eX(e,r,i,t==="\\\\globalfuture"),e.gullet.pushToken(i),e.gullet.pushToken(s),{type:"internal",mode:e.mode}}});var Qy=function(e,t,r){var s=Kn.math[e]&&Kn.math[e].replace,i=zR(s||e,t,r);if(!i)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return i},GR=function(e,t,r,s){var i=r.havingBaseStyle(t),o=ie.makeSpan(s.concat(i.sizingClasses(r)),[e],r),a=i.sizeMultiplier/r.sizeMultiplier;return o.height*=a,o.depth*=a,o.maxFontSize=i.sizeMultiplier,o},tX=function(e,t,r){var s=t.havingBaseStyle(r),i=(1-t.sizeMultiplier/s.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=Ee(i),e.height-=i,e.depth+=i},vTe=function(e,t,r,s,i,o){var a=ie.makeSymbol(e,"Main-Regular",i,s),l=GR(a,t,s,o);return r&&tX(l,s,t),l},wTe=function(e,t,r,s){return ie.makeSymbol(e,"Size"+t+"-Regular",r,s)},nX=function(e,t,r,s,i,o){var a=wTe(e,t,i,s),l=GR(ie.makeSpan(["delimsizing","size"+t],[a],s),at.TEXT,s,o);return r&&tX(l,s,at.TEXT),l},qA=function(e,t,r){var s;t==="Size1-Regular"?s="delim-size1":s="delim-size4";var i=ie.makeSpan(["delimsizinginner",s],[ie.makeSpan([],[ie.makeSymbol(e,t,r)])]);return{type:"elem",elem:i}},GA=function(e,t,r){var s=Tc["Size4-Regular"][e.charCodeAt(0)]?Tc["Size4-Regular"][e.charCodeAt(0)][4]:Tc["Size1-Regular"][e.charCodeAt(0)][4],i=new df("inner",ASe(e,Math.round(1e3*t))),o=new od([i],{width:Ee(s),height:Ee(t),style:"width:"+Ee(s),viewBox:"0 0 "+1e3*s+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),a=ie.makeSvgSpan([],[o],r);return a.height=t,a.style.height=Ee(t),a.style.width=Ee(s),{type:"elem",elem:a}},ZC=.008,g4={type:"kern",size:-1*ZC},kTe=["|","\\lvert","\\rvert","\\vert"],_Te=["\\|","\\lVert","\\rVert","\\Vert"],rX=function(e,t,r,s,i,o){var a,l,c,u,h="",f=0;a=c=u=e,l=null;var p="Size1-Regular";e==="\\uparrow"?c=u="":e==="\\Uparrow"?c=u="":e==="\\downarrow"?a=c="":e==="\\Downarrow"?a=c="":e==="\\updownarrow"?(a="\\uparrow",c="",u="\\downarrow"):e==="\\Updownarrow"?(a="\\Uparrow",c="",u="\\Downarrow"):kTe.includes(e)?(c="",h="vert",f=333):_Te.includes(e)?(c="",h="doublevert",f=556):e==="["||e==="\\lbrack"?(a="",c="",u="",p="Size4-Regular",h="lbrack",f=667):e==="]"||e==="\\rbrack"?(a="",c="",u="",p="Size4-Regular",h="rbrack",f=667):e==="\\lfloor"||e===""?(c=a="",u="",p="Size4-Regular",h="lfloor",f=667):e==="\\lceil"||e===""?(a="",c=u="",p="Size4-Regular",h="lceil",f=667):e==="\\rfloor"||e===""?(c=a="",u="",p="Size4-Regular",h="rfloor",f=667):e==="\\rceil"||e===""?(a="",c=u="",p="Size4-Regular",h="rceil",f=667):e==="("||e==="\\lparen"?(a="",c="",u="",p="Size4-Regular",h="lparen",f=875):e===")"||e==="\\rparen"?(a="",c="",u="",p="Size4-Regular",h="rparen",f=875):e==="\\{"||e==="\\lbrace"?(a="",l="",u="",c="",p="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(a="",l="",u="",c="",p="Size4-Regular"):e==="\\lgroup"||e===""?(a="",u="",c="",p="Size4-Regular"):e==="\\rgroup"||e===""?(a="",u="",c="",p="Size4-Regular"):e==="\\lmoustache"||e===""?(a="",u="",c="",p="Size4-Regular"):(e==="\\rmoustache"||e==="")&&(a="",u="",c="",p="Size4-Regular");var g=Qy(a,p,i),y=g.height+g.depth,v=Qy(c,p,i),b=v.height+v.depth,w=Qy(u,p,i),k=w.height+w.depth,T=0,R=1;if(l!==null){var M=Qy(l,p,i);T=M.height+M.depth,R=2}var E=y+k+T,I=Math.max(0,Math.ceil((t-E)/(R*b))),S=E+I*R*b,N=s.fontMetrics().axisHeight;r&&(N*=s.sizeMultiplier);var P=S/2-N,O=[];if(h.length>0){var D=S-y-k,G=Math.round(S*1e3),J=ESe(h,Math.round(D*1e3)),Q=new df(h,J),re=(f/1e3).toFixed(3)+"em",ne=(G/1e3).toFixed(3)+"em",te=new od([Q],{width:re,height:ne,viewBox:"0 0 "+f+" "+G}),H=ie.makeSvgSpan([],[te],s);H.height=G/1e3,H.style.width=re,H.style.height=ne,O.push({type:"elem",elem:H})}else{if(O.push(qA(u,p,i)),O.push(g4),l===null){var ce=S-y-k+2*ZC;O.push(GA(c,ce,s))}else{var xe=(S-y-k-T)/2+2*ZC;O.push(GA(c,xe,s)),O.push(g4),O.push(qA(l,p,i)),O.push(g4),O.push(GA(c,xe,s))}O.push(g4),O.push(qA(a,p,i))}var W=s.havingBaseStyle(at.TEXT),dt=ie.makeVList({positionType:"bottom",positionData:P,children:O},W);return GR(ie.makeSpan(["delimsizing","mult"],[dt],W),at.TEXT,s,o)},WA=80,KA=.08,YA=function(e,t,r,s,i){var o=TSe(e,s,r),a=new df(e,o),l=new od([a],{width:"400em",height:Ee(t),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return ie.makeSvgSpan(["hide-tail"],[l],i)},STe=function(e,t){var r=t.havingBaseSizing(),s=aX("\\surd",e*r.sizeMultiplier,oX,r),i=r.sizeMultiplier,o=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),a,l=0,c=0,u=0,h;return s.type==="small"?(u=1e3+1e3*o+WA,e<1?i=1:e<1.4&&(i=.7),l=(1+o+KA)/i,c=(1+o)/i,a=YA("sqrtMain",l,u,o,t),a.style.minWidth="0.853em",h=.833/i):s.type==="large"?(u=(1e3+WA)*Wx[s.size],c=(Wx[s.size]+o)/i,l=(Wx[s.size]+o+KA)/i,a=YA("sqrtSize"+s.size,l,u,o,t),a.style.minWidth="1.02em",h=1/i):(l=e+o+KA,c=e+o,u=Math.floor(1e3*e+o)+WA,a=YA("sqrtTall",l,u,o,t),a.style.minWidth="0.742em",h=1.056),a.height=c,a.style.height=Ee(l),{span:a,advanceWidth:h,ruleWidth:(t.fontMetrics().sqrtRuleThickness+o)*i}},sX=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],TTe=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],iX=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Wx=[0,1.2,1.8,2.4,3],ATe=function(e,t,r,s,i){if(e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle"),sX.includes(e)||iX.includes(e))return nX(e,t,!1,r,s,i);if(TTe.includes(e))return rX(e,Wx[t],!1,r,s,i);throw new _e("Illegal delimiter: '"+e+"'")},ETe=[{type:"small",style:at.SCRIPTSCRIPT},{type:"small",style:at.SCRIPT},{type:"small",style:at.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],CTe=[{type:"small",style:at.SCRIPTSCRIPT},{type:"small",style:at.SCRIPT},{type:"small",style:at.TEXT},{type:"stack"}],oX=[{type:"small",style:at.SCRIPTSCRIPT},{type:"small",style:at.SCRIPT},{type:"small",style:at.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],NTe=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},aX=function(e,t,r,s){for(var i=Math.min(2,3-s.style.size),o=i;o<r.length&&r[o].type!=="stack";o++){var a=Qy(e,NTe(r[o]),"math"),l=a.height+a.depth;if(r[o].type==="small"){var c=s.havingBaseStyle(r[o].style);l*=c.sizeMultiplier}if(l>t)return r[o]}return r[r.length-1]},lX=function(e,t,r,s,i,o){e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle");var a;iX.includes(e)?a=ETe:sX.includes(e)?a=oX:a=CTe;var l=aX(e,t,a,s);return l.type==="small"?vTe(e,l.style,r,s,i,o):l.type==="large"?nX(e,l.size,r,s,i,o):rX(e,t,r,s,i,o)},ITe=function(e,t,r,s,i,o){var a=s.fontMetrics().axisHeight*s.sizeMultiplier,l=901,c=5/s.fontMetrics().ptPerEm,u=Math.max(t-a,r+a),h=Math.max(u/500*l,2*u-c);return lX(e,h,!0,s,i,o)},Wu={sqrtImage:STe,sizedDelim:ATe,sizeToMaxHeight:Wx,customSizedDelim:lX,leftRightDelim:ITe},LF={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},RTe=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function CS(n,e){var t=AS(n);if(t&&RTe.includes(t.text))return t;throw t?new _e("Invalid delimiter '"+t.text+"' after '"+e.funcName+"'",n):new _e("Invalid delimiter type '"+n.type+"'",n)}Pe({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(n,e)=>{var t=CS(e[0],n);return{type:"delimsizing",mode:n.parser.mode,size:LF[n.funcName].size,mclass:LF[n.funcName].mclass,delim:t.text}},htmlBuilder:(n,e)=>n.delim==="."?ie.makeSpan([n.mclass]):Wu.sizedDelim(n.delim,n.size,e,n.mode,[n.mclass]),mathmlBuilder:n=>{var e=[];n.delim!=="."&&e.push(sl(n.delim,n.mode));var t=new be.MathNode("mo",e);n.mclass==="mopen"||n.mclass==="mclose"?t.setAttribute("fence","true"):t.setAttribute("fence","false"),t.setAttribute("stretchy","true");var r=Ee(Wu.sizeToMaxHeight[n.size]);return t.setAttribute("minsize",r),t.setAttribute("maxsize",r),t}});function DF(n){if(!n.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Pe({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=n.parser.gullet.macros.get("\\current@color");if(t&&typeof t!="string")throw new _e("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:n.parser.mode,delim:CS(e[0],n).text,color:t}}});Pe({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=CS(e[0],n),r=n.parser;++r.leftrightDepth;var s=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var i=Dt(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:s,left:t.text,right:i.delim,rightColor:i.color}},htmlBuilder:(n,e)=>{DF(n);for(var t=xs(n.body,e,!0,["mopen","mclose"]),r=0,s=0,i=!1,o=0;o<t.length;o++)t[o].isMiddle?i=!0:(r=Math.max(t[o].height,r),s=Math.max(t[o].depth,s));r*=e.sizeMultiplier,s*=e.sizeMultiplier;var a;if(n.left==="."?a=Vb(e,["mopen"]):a=Wu.leftRightDelim(n.left,r,s,e,n.mode,["mopen"]),t.unshift(a),i)for(var l=1;l<t.length;l++){var c=t[l],u=c.isMiddle;u&&(t[l]=Wu.leftRightDelim(u.delim,r,s,u.options,n.mode,[]))}var h;if(n.right===".")h=Vb(e,["mclose"]);else{var f=n.rightColor?e.withColor(n.rightColor):e;h=Wu.leftRightDelim(n.right,r,s,f,n.mode,["mclose"])}return t.push(h),ie.makeSpan(["minner"],t,e)},mathmlBuilder:(n,e)=>{DF(n);var t=Do(n.body,e);if(n.left!=="."){var r=new be.MathNode("mo",[sl(n.left,n.mode)]);r.setAttribute("fence","true"),t.unshift(r)}if(n.right!=="."){var s=new be.MathNode("mo",[sl(n.right,n.mode)]);s.setAttribute("fence","true"),n.rightColor&&s.setAttribute("mathcolor",n.rightColor),t.push(s)}return VR(t)}});Pe({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=CS(e[0],n);if(!n.parser.leftrightDepth)throw new _e("\\middle without preceding \\left",t);return{type:"middle",mode:n.parser.mode,delim:t.text}},htmlBuilder:(n,e)=>{var t;if(n.delim===".")t=Vb(e,[]);else{t=Wu.sizedDelim(n.delim,1,e,n.mode,[]);var r={delim:n.delim,options:e};t.isMiddle=r}return t},mathmlBuilder:(n,e)=>{var t=n.delim==="\\vert"||n.delim==="|"?sl("|","text"):sl(n.delim,n.mode),r=new be.MathNode("mo",[t]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var WR=(n,e)=>{var t=ie.wrapFragment(pn(n.body,e),e),r=n.label.slice(1),s=e.sizeMultiplier,i,o=0,a=gn.isCharacterBox(n.body);if(r==="sout")i=ie.makeSpan(["stretchy","sout"]),i.height=e.fontMetrics().defaultRuleThickness/s,o=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var l=yr({number:.6,unit:"pt"},e),c=yr({number:.35,unit:"ex"},e),u=e.havingBaseSizing();s=s/u.sizeMultiplier;var h=t.height+t.depth+l+c;t.style.paddingLeft=Ee(h/2+l);var f=Math.floor(1e3*h*s),p=_Se(f),g=new od([new df("phase",p)],{width:"400em",height:Ee(f/1e3),viewBox:"0 0 400000 "+f,preserveAspectRatio:"xMinYMin slice"});i=ie.makeSvgSpan(["hide-tail"],[g],e),i.style.height=Ee(h),o=t.depth+l+c}else{/cancel/.test(r)?a||t.classes.push("cancel-pad"):r==="angl"?t.classes.push("anglpad"):t.classes.push("boxpad");var y=0,v=0,b=0;/box/.test(r)?(b=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),y=e.fontMetrics().fboxsep+(r==="colorbox"?0:b),v=y):r==="angl"?(b=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),y=4*b,v=Math.max(0,.25-t.depth)):(y=a?.2:0,v=y),i=ld.encloseSpan(t,r,y,v,e),/fbox|boxed|fcolorbox/.test(r)?(i.style.borderStyle="solid",i.style.borderWidth=Ee(b)):r==="angl"&&b!==.049&&(i.style.borderTopWidth=Ee(b),i.style.borderRightWidth=Ee(b)),o=t.depth+v,n.backgroundColor&&(i.style.backgroundColor=n.backgroundColor,n.borderColor&&(i.style.borderColor=n.borderColor))}var w;if(n.backgroundColor)w=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:o},{type:"elem",elem:t,shift:0}]},e);else{var k=/cancel|phase/.test(r)?["svg-align"]:[];w=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:t,shift:0},{type:"elem",elem:i,shift:o,wrapperClasses:k}]},e)}return/cancel/.test(r)&&(w.height=t.height,w.depth=t.depth),/cancel/.test(r)&&!a?ie.makeSpan(["mord","cancel-lap"],[w],e):ie.makeSpan(["mord"],[w],e)},KR=(n,e)=>{var t=0,r=new be.MathNode(n.label.indexOf("colorbox")>-1?"mpadded":"menclose",[$n(n.body,e)]);switch(n.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(t=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*t+"pt"),r.setAttribute("height","+"+2*t+"pt"),r.setAttribute("lspace",t+"pt"),r.setAttribute("voffset",t+"pt"),n.label==="\\fcolorbox"){var s=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+s+"em solid "+String(n.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return n.backgroundColor&&r.setAttribute("mathbackground",n.backgroundColor),r};Pe({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(n,e,t){var{parser:r,funcName:s}=n,i=Dt(e[0],"color-token").color,o=e[1];return{type:"enclose",mode:r.mode,label:s,backgroundColor:i,body:o}},htmlBuilder:WR,mathmlBuilder:KR});Pe({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(n,e,t){var{parser:r,funcName:s}=n,i=Dt(e[0],"color-token").color,o=Dt(e[1],"color-token").color,a=e[2];return{type:"enclose",mode:r.mode,label:s,backgroundColor:o,borderColor:i,body:a}},htmlBuilder:WR,mathmlBuilder:KR});Pe({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\fbox",body:e[0]}}});Pe({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n,s=e[0];return{type:"enclose",mode:t.mode,label:r,body:s}},htmlBuilder:WR,mathmlBuilder:KR});Pe({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\angl",body:e[0]}}});var cX={};function Hc(n){for(var{type:e,names:t,props:r,handler:s,htmlBuilder:i,mathmlBuilder:o}=n,a={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:s},l=0;l<t.length;++l)cX[t[l]]=a;i&&(E5[e]=i),o&&(C5[e]=o)}var uX={};function U(n,e){uX[n]=e}function jF(n){var e=[];n.consumeSpaces();var t=n.fetch().text;for(t==="\\relax"&&(n.consume(),n.consumeSpaces(),t=n.fetch().text);t==="\\hline"||t==="\\hdashline";)n.consume(),e.push(t==="\\hdashline"),n.consumeSpaces(),t=n.fetch().text;return e}var NS=n=>{var e=n.parser.settings;if(!e.displayMode)throw new _e("{"+n.envName+"} can be used only in display mode.")};function YR(n){if(n.indexOf("ed")===-1)return n.indexOf("*")===-1}function Ef(n,e,t){var{hskipBeforeAndAfter:r,addJot:s,cols:i,arraystretch:o,colSeparationType:a,autoTag:l,singleRow:c,emptySingleRow:u,maxNumCols:h,leqno:f}=e;if(n.gullet.beginGroup(),c||n.gullet.macros.set("\\cr","\\\\\\relax"),!o){var p=n.gullet.expandMacroAsText("\\arraystretch");if(p==null)o=1;else if(o=parseFloat(p),!o||o<0)throw new _e("Invalid \\arraystretch: "+p)}n.gullet.beginGroup();var g=[],y=[g],v=[],b=[],w=l!=null?[]:void 0;function k(){l&&n.gullet.macros.set("\\@eqnsw","1",!0)}function T(){w&&(n.gullet.macros.get("\\df@tag")?(w.push(n.subparse([new ha("\\df@tag")])),n.gullet.macros.set("\\df@tag",void 0,!0)):w.push(!!l&&n.gullet.macros.get("\\@eqnsw")==="1"))}for(k(),b.push(jF(n));;){var R=n.parseExpression(!1,c?"\\end":"\\\\");n.gullet.endGroup(),n.gullet.beginGroup(),R={type:"ordgroup",mode:n.mode,body:R},t&&(R={type:"styling",mode:n.mode,style:t,body:[R]}),g.push(R);var M=n.fetch().text;if(M==="&"){if(h&&g.length===h){if(c||a)throw new _e("Too many tab characters: &",n.nextToken);n.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}n.consume()}else if(M==="\\end"){T(),g.length===1&&R.type==="styling"&&R.body[0].body.length===0&&(y.length>1||!u)&&y.pop(),b.length<y.length+1&&b.push([]);break}else if(M==="\\\\"){n.consume();var E=void 0;n.gullet.future().text!==" "&&(E=n.parseSizeGroup(!0)),v.push(E?E.value:null),T(),b.push(jF(n)),g=[],y.push(g),k()}else throw new _e("Expected & or \\\\ or \\cr or \\end",n.nextToken)}return n.gullet.endGroup(),n.gullet.endGroup(),{type:"array",mode:n.mode,addJot:s,arraystretch:o,body:y,cols:i,rowGaps:v,hskipBeforeAndAfter:r,hLinesBeforeRow:b,colSeparationType:a,tags:w,leqno:f}}function XR(n){return n.slice(0,1)==="d"?"display":"text"}var qc=function(e,t){var r,s,i=e.body.length,o=e.hLinesBeforeRow,a=0,l=new Array(i),c=[],u=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),h=1/t.fontMetrics().ptPerEm,f=5*h;if(e.colSeparationType&&e.colSeparationType==="small"){var p=t.havingStyle(at.SCRIPT).sizeMultiplier;f=.2778*(p/t.sizeMultiplier)}var g=e.colSeparationType==="CD"?yr({number:3,unit:"ex"},t):12*h,y=3*h,v=e.arraystretch*g,b=.7*v,w=.3*v,k=0;function T(Dn){for(var bt=0;bt<Dn.length;++bt)bt>0&&(k+=.25),c.push({pos:k,isDashed:Dn[bt]})}for(T(o[0]),r=0;r<e.body.length;++r){var R=e.body[r],M=b,E=w;a<R.length&&(a=R.length);var I=new Array(R.length);for(s=0;s<R.length;++s){var S=pn(R[s],t);E<S.depth&&(E=S.depth),M<S.height&&(M=S.height),I[s]=S}var N=e.rowGaps[r],P=0;N&&(P=yr(N,t),P>0&&(P+=w,E<P&&(E=P),P=0)),e.addJot&&(E+=y),I.height=M,I.depth=E,k+=M,I.pos=k,k+=E+P,l[r]=I,T(o[r+1])}var O=k/2+t.fontMetrics().axisHeight,D=e.cols||[],G=[],J,Q,re=[];if(e.tags&&e.tags.some(Dn=>Dn))for(r=0;r<i;++r){var ne=l[r],te=ne.pos-O,H=e.tags[r],ce=void 0;H===!0?ce=ie.makeSpan(["eqn-num"],[],t):H===!1?ce=ie.makeSpan([],[],t):ce=ie.makeSpan([],xs(H,t,!0),t),ce.depth=ne.depth,ce.height=ne.height,re.push({type:"elem",elem:ce,shift:te})}for(s=0,Q=0;s<a||Q<D.length;++s,++Q){for(var xe=D[Q]||{},W=!0;xe.type==="separator";){if(W||(J=ie.makeSpan(["arraycolsep"],[]),J.style.width=Ee(t.fontMetrics().doubleRuleSep),G.push(J)),xe.separator==="|"||xe.separator===":"){var dt=xe.separator==="|"?"solid":"dashed",Me=ie.makeSpan(["vertical-separator"],[],t);Me.style.height=Ee(k),Me.style.borderRightWidth=Ee(u),Me.style.borderRightStyle=dt,Me.style.margin="0 "+Ee(-u/2);var Fe=k-O;Fe&&(Me.style.verticalAlign=Ee(-Fe)),G.push(Me)}else throw new _e("Invalid separator type: "+xe.separator);Q++,xe=D[Q]||{},W=!1}if(!(s>=a)){var Ae=void 0;(s>0||e.hskipBeforeAndAfter)&&(Ae=gn.deflt(xe.pregap,f),Ae!==0&&(J=ie.makeSpan(["arraycolsep"],[]),J.style.width=Ee(Ae),G.push(J)));var lt=[];for(r=0;r<i;++r){var sn=l[r],un=sn[s];if(un){var Sr=sn.pos-O;un.depth=sn.depth,un.height=sn.height,lt.push({type:"elem",elem:un,shift:Sr})}}lt=ie.makeVList({positionType:"individualShift",children:lt},t),lt=ie.makeSpan(["col-align-"+(xe.align||"c")],[lt]),G.push(lt),(s<a-1||e.hskipBeforeAndAfter)&&(Ae=gn.deflt(xe.postgap,f),Ae!==0&&(J=ie.makeSpan(["arraycolsep"],[]),J.style.width=Ee(Ae),G.push(J)))}}if(l=ie.makeSpan(["mtable"],G),c.length>0){for(var ri=ie.makeLineSpan("hline",t,u),Yn=ie.makeLineSpan("hdashline",t,u),Or=[{type:"elem",elem:l,shift:0}];c.length>0;){var ht=c.pop(),Tn=ht.pos-O;ht.isDashed?Or.push({type:"elem",elem:Yn,shift:Tn}):Or.push({type:"elem",elem:ri,shift:Tn})}l=ie.makeVList({positionType:"individualShift",children:Or},t)}if(re.length===0)return ie.makeSpan(["mord"],[l],t);var Gt=ie.makeVList({positionType:"individualShift",children:re},t);return Gt=ie.makeSpan(["tag"],[Gt],t),ie.makeFragment([l,Gt])},MTe={c:"center ",l:"left ",r:"right "},Gc=function(e,t){for(var r=[],s=new be.MathNode("mtd",[],["mtr-glue"]),i=new be.MathNode("mtd",[],["mml-eqn-num"]),o=0;o<e.body.length;o++){for(var a=e.body[o],l=[],c=0;c<a.length;c++)l.push(new be.MathNode("mtd",[$n(a[c],t)]));e.tags&&e.tags[o]&&(l.unshift(s),l.push(s),e.leqno?l.unshift(i):l.push(i)),r.push(new be.MathNode("mtr",l))}var u=new be.MathNode("mtable",r),h=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);u.setAttribute("rowspacing",Ee(h));var f="",p="";if(e.cols&&e.cols.length>0){var g=e.cols,y="",v=!1,b=0,w=g.length;g[0].type==="separator"&&(f+="top ",b=1),g[g.length-1].type==="separator"&&(f+="bottom ",w-=1);for(var k=b;k<w;k++)g[k].type==="align"?(p+=MTe[g[k].align],v&&(y+="none "),v=!0):g[k].type==="separator"&&v&&(y+=g[k].separator==="|"?"solid ":"dashed ",v=!1);u.setAttribute("columnalign",p.trim()),/[sd]/.test(y)&&u.setAttribute("columnlines",y.trim())}if(e.colSeparationType==="align"){for(var T=e.cols||[],R="",M=1;M<T.length;M++)R+=M%2?"0em ":"1em ";u.setAttribute("columnspacing",R.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?u.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?u.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?u.setAttribute("columnspacing","0.5em"):u.setAttribute("columnspacing","1em");var E="",I=e.hLinesBeforeRow;f+=I[0].length>0?"left ":"",f+=I[I.length-1].length>0?"right ":"";for(var S=1;S<I.length-1;S++)E+=I[S].length===0?"none ":I[S][0]?"dashed ":"solid ";return/[sd]/.test(E)&&u.setAttribute("rowlines",E.trim()),f!==""&&(u=new be.MathNode("menclose",[u]),u.setAttribute("notation",f.trim())),e.arraystretch&&e.arraystretch<1&&(u=new be.MathNode("mstyle",[u]),u.setAttribute("scriptlevel","1")),u},dX=function(e,t){e.envName.indexOf("ed")===-1&&NS(e);var r=[],s=e.envName.indexOf("at")>-1?"alignat":"align",i=e.envName==="split",o=Ef(e.parser,{cols:r,addJot:!0,autoTag:i?void 0:YR(e.envName),emptySingleRow:!0,colSeparationType:s,maxNumCols:i?2:void 0,leqno:e.parser.settings.leqno},"display"),a,l=0,c={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&t[0].type==="ordgroup"){for(var u="",h=0;h<t[0].body.length;h++){var f=Dt(t[0].body[h],"textord");u+=f.text}a=Number(u),l=a*2}var p=!l;o.body.forEach(function(b){for(var w=1;w<b.length;w+=2){var k=Dt(b[w],"styling"),T=Dt(k.body[0],"ordgroup");T.body.unshift(c)}if(p)l<b.length&&(l=b.length);else{var R=b.length/2;if(a<R)throw new _e("Too many math in a row: "+("expected "+a+", but got "+R),b[0])}});for(var g=0;g<l;++g){var y="r",v=0;g%2===1?y="l":g>0&&p&&(v=1),r[g]={type:"align",align:y,pregap:v,postgap:0}}return o.colSeparationType=p?"align":"alignat",o};Hc({type:"array",names:["array","darray"],props:{numArgs:1},handler(n,e){var t=AS(e[0]),r=t?[e[0]]:Dt(e[0],"ordgroup").body,s=r.map(function(o){var a=HR(o),l=a.text;if("lcr".indexOf(l)!==-1)return{type:"align",align:l};if(l==="|")return{type:"separator",separator:"|"};if(l===":")return{type:"separator",separator:":"};throw new _e("Unknown column alignment: "+l,o)}),i={cols:s,hskipBeforeAndAfter:!0,maxNumCols:s.length};return Ef(n.parser,i,XR(n.envName))},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(n){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[n.envName.replace("*","")],t="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:t}]};if(n.envName.charAt(n.envName.length-1)==="*"){var s=n.parser;if(s.consumeSpaces(),s.fetch().text==="["){if(s.consume(),s.consumeSpaces(),t=s.fetch().text,"lcr".indexOf(t)===-1)throw new _e("Expected l or c or r",s.nextToken);s.consume(),s.consumeSpaces(),s.expect("]"),s.consume(),r.cols=[{type:"align",align:t}]}}var i=Ef(n.parser,r,XR(n.envName)),o=Math.max(0,...i.body.map(a=>a.length));return i.cols=new Array(o).fill({type:"align",align:t}),e?{type:"leftright",mode:n.mode,body:[i],left:e[0],right:e[1],rightColor:void 0}:i},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(n){var e={arraystretch:.5},t=Ef(n.parser,e,"script");return t.colSeparationType="small",t},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["subarray"],props:{numArgs:1},handler(n,e){var t=AS(e[0]),r=t?[e[0]]:Dt(e[0],"ordgroup").body,s=r.map(function(o){var a=HR(o),l=a.text;if("lc".indexOf(l)!==-1)return{type:"align",align:l};throw new _e("Unknown column alignment: "+l,o)});if(s.length>1)throw new _e("{subarray} can contain only one column");var i={cols:s,hskipBeforeAndAfter:!1,arraystretch:.5};if(i=Ef(n.parser,i,"script"),i.body.length>0&&i.body[0].length>1)throw new _e("{subarray} can contain only one column");return i},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(n){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},t=Ef(n.parser,e,XR(n.envName));return{type:"leftright",mode:n.mode,body:[t],left:n.envName.indexOf("r")>-1?".":"\\{",right:n.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:dX,htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(n){["gather","gather*"].includes(n.envName)&&NS(n);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:YR(n.envName),emptySingleRow:!0,leqno:n.parser.settings.leqno};return Ef(n.parser,e,"display")},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:dX,htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(n){NS(n);var e={autoTag:YR(n.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:n.parser.settings.leqno};return Ef(n.parser,e,"display")},htmlBuilder:qc,mathmlBuilder:Gc});Hc({type:"array",names:["CD"],props:{numArgs:0},handler(n){return NS(n),xTe(n.parser)},htmlBuilder:qc,mathmlBuilder:Gc});U("\\nonumber","\\gdef\\@eqnsw{0}");U("\\notag","\\nonumber");Pe({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(n,e){throw new _e(n.funcName+" valid only within array environment")}});var OF=cX;Pe({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(n,e){var{parser:t,funcName:r}=n,s=e[0];if(s.type!=="ordgroup")throw new _e("Invalid environment name",s);for(var i="",o=0;o<s.body.length;++o)i+=Dt(s.body[o],"textord").text;if(r==="\\begin"){if(!OF.hasOwnProperty(i))throw new _e("No such environment: "+i,s);var a=OF[i],{args:l,optArgs:c}=t.parseArguments("\\begin{"+i+"}",a),u={mode:t.mode,envName:i,parser:t},h=a.handler(u,l,c);t.expect("\\end",!1);var f=t.nextToken,p=Dt(t.parseFunction(),"environment");if(p.name!==i)throw new _e("Mismatch: \\begin{"+i+"} matched by \\end{"+p.name+"}",f);return h}return{type:"environment",mode:t.mode,name:i,nameGroup:s}}});var hX=(n,e)=>{var t=n.font,r=e.withFont(t);return pn(n.body,r)},fX=(n,e)=>{var t=n.font,r=e.withFont(t);return $n(n.body,r)},FF={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Pe({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=N5(e[0]),i=r;return i in FF&&(i=FF[i]),{type:"font",mode:t.mode,font:i.slice(1),body:s}},htmlBuilder:hX,mathmlBuilder:fX});Pe({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(n,e)=>{var{parser:t}=n,r=e[0],s=gn.isCharacterBox(r);return{type:"mclass",mode:t.mode,mclass:ES(r),body:[{type:"font",mode:t.mode,font:"boldsymbol",body:r}],isCharacterBox:s}}});Pe({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,breakOnTokenText:s}=n,{mode:i}=t,o=t.parseExpression(!0,s),a="math"+r.slice(1);return{type:"font",mode:i,font:a,body:{type:"ordgroup",mode:t.mode,body:o}}},htmlBuilder:hX,mathmlBuilder:fX});var pX=(n,e)=>{var t=e;return n==="display"?t=t.id>=at.SCRIPT.id?t.text():at.DISPLAY:n==="text"&&t.size===at.DISPLAY.size?t=at.TEXT:n==="script"?t=at.SCRIPT:n==="scriptscript"&&(t=at.SCRIPTSCRIPT),t},JR=(n,e)=>{var t=pX(n.size,e.style),r=t.fracNum(),s=t.fracDen(),i;i=e.havingStyle(r);var o=pn(n.numer,i,e);if(n.continued){var a=8.5/e.fontMetrics().ptPerEm,l=3.5/e.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<l?l:o.depth}i=e.havingStyle(s);var c=pn(n.denom,i,e),u,h,f;n.hasBarLine?(n.barSize?(h=yr(n.barSize,e),u=ie.makeLineSpan("frac-line",e,h)):u=ie.makeLineSpan("frac-line",e),h=u.height,f=u.height):(u=null,h=0,f=e.fontMetrics().defaultRuleThickness);var p,g,y;t.size===at.DISPLAY.size||n.size==="display"?(p=e.fontMetrics().num1,h>0?g=3*f:g=7*f,y=e.fontMetrics().denom1):(h>0?(p=e.fontMetrics().num2,g=f):(p=e.fontMetrics().num3,g=3*f),y=e.fontMetrics().denom2);var v;if(u){var w=e.fontMetrics().axisHeight;p-o.depth-(w+.5*h)<g&&(p+=g-(p-o.depth-(w+.5*h))),w-.5*h-(c.height-y)<g&&(y+=g-(w-.5*h-(c.height-y)));var k=-(w-.5*h);v=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:c,shift:y},{type:"elem",elem:u,shift:k},{type:"elem",elem:o,shift:-p}]},e)}else{var b=p-o.depth-(c.height-y);b<g&&(p+=.5*(g-b),y+=.5*(g-b)),v=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:c,shift:y},{type:"elem",elem:o,shift:-p}]},e)}i=e.havingStyle(t),v.height*=i.sizeMultiplier/e.sizeMultiplier,v.depth*=i.sizeMultiplier/e.sizeMultiplier;var T;t.size===at.DISPLAY.size?T=e.fontMetrics().delim1:t.size===at.SCRIPTSCRIPT.size?T=e.havingStyle(at.SCRIPT).fontMetrics().delim2:T=e.fontMetrics().delim2;var R,M;return n.leftDelim==null?R=Vb(e,["mopen"]):R=Wu.customSizedDelim(n.leftDelim,T,!0,e.havingStyle(t),n.mode,["mopen"]),n.continued?M=ie.makeSpan([]):n.rightDelim==null?M=Vb(e,["mclose"]):M=Wu.customSizedDelim(n.rightDelim,T,!0,e.havingStyle(t),n.mode,["mclose"]),ie.makeSpan(["mord"].concat(i.sizingClasses(e)),[R,ie.makeSpan(["mfrac"],[v]),M],e)},QR=(n,e)=>{var t=new be.MathNode("mfrac",[$n(n.numer,e),$n(n.denom,e)]);if(!n.hasBarLine)t.setAttribute("linethickness","0px");else if(n.barSize){var r=yr(n.barSize,e);t.setAttribute("linethickness",Ee(r))}var s=pX(n.size,e.style);if(s.size!==e.style.size){t=new be.MathNode("mstyle",[t]);var i=s.size===at.DISPLAY.size?"true":"false";t.setAttribute("displaystyle",i),t.setAttribute("scriptlevel","0")}if(n.leftDelim!=null||n.rightDelim!=null){var o=[];if(n.leftDelim!=null){var a=new be.MathNode("mo",[new be.TextNode(n.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(t),n.rightDelim!=null){var l=new be.MathNode("mo",[new be.TextNode(n.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),o.push(l)}return VR(o)}return t};Pe({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0],i=e[1],o,a=null,l=null,c="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":o=!0;break;case"\\\\atopfrac":o=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":o=!1,a="(",l=")";break;case"\\\\bracefrac":o=!1,a="\\{",l="\\}";break;case"\\\\brackfrac":o=!1,a="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text";break}return{type:"genfrac",mode:t.mode,continued:!1,numer:s,denom:i,hasBarLine:o,leftDelim:a,rightDelim:l,size:c,barSize:null}},htmlBuilder:JR,mathmlBuilder:QR});Pe({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0],i=e[1];return{type:"genfrac",mode:t.mode,continued:!0,numer:s,denom:i,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});Pe({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(n){var{parser:e,funcName:t,token:r}=n,s;switch(t){case"\\over":s="\\frac";break;case"\\choose":s="\\binom";break;case"\\atop":s="\\\\atopfrac";break;case"\\brace":s="\\\\bracefrac";break;case"\\brack":s="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:s,token:r}}});var zF=["display","text","script","scriptscript"],BF=function(e){var t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};Pe({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(n,e){var{parser:t}=n,r=e[4],s=e[5],i=N5(e[0]),o=i.type==="atom"&&i.family==="open"?BF(i.text):null,a=N5(e[1]),l=a.type==="atom"&&a.family==="close"?BF(a.text):null,c=Dt(e[2],"size"),u,h=null;c.isBlank?u=!0:(h=c.value,u=h.number>0);var f="auto",p=e[3];if(p.type==="ordgroup"){if(p.body.length>0){var g=Dt(p.body[0],"textord");f=zF[Number(g.text)]}}else p=Dt(p,"textord"),f=zF[Number(p.text)];return{type:"genfrac",mode:t.mode,numer:r,denom:s,continued:!1,hasBarLine:u,barSize:h,leftDelim:o,rightDelim:l,size:f}},htmlBuilder:JR,mathmlBuilder:QR});Pe({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(n,e){var{parser:t,funcName:r,token:s}=n;return{type:"infix",mode:t.mode,replaceWith:"\\\\abovefrac",size:Dt(e[0],"size").value,token:s}}});Pe({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0],i=lSe(Dt(e[1],"infix").size),o=e[2],a=i.number>0;return{type:"genfrac",mode:t.mode,numer:s,denom:o,continued:!1,hasBarLine:a,barSize:i,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:JR,mathmlBuilder:QR});var mX=(n,e)=>{var t=e.style,r,s;n.type==="supsub"?(r=n.sup?pn(n.sup,e.havingStyle(t.sup()),e):pn(n.sub,e.havingStyle(t.sub()),e),s=Dt(n.base,"horizBrace")):s=Dt(n,"horizBrace");var i=pn(s.base,e.havingBaseStyle(at.DISPLAY)),o=ld.svgSpan(s,e),a;if(s.isOver?(a=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:i},{type:"kern",size:.1},{type:"elem",elem:o}]},e),a.children[0].children[0].children[1].classes.push("svg-align")):(a=ie.makeVList({positionType:"bottom",positionData:i.depth+.1+o.height,children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:i}]},e),a.children[0].children[0].children[0].classes.push("svg-align")),r){var l=ie.makeSpan(["mord",s.isOver?"mover":"munder"],[a],e);s.isOver?a=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:r}]},e):a=ie.makeVList({positionType:"bottom",positionData:l.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:l}]},e)}return ie.makeSpan(["mord",s.isOver?"mover":"munder"],[a],e)},PTe=(n,e)=>{var t=ld.mathMLnode(n.label);return new be.MathNode(n.isOver?"mover":"munder",[$n(n.base,e),t])};Pe({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"horizBrace",mode:t.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:mX,mathmlBuilder:PTe});Pe({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[1],s=Dt(e[0],"url").url;return t.settings.isTrusted({command:"\\href",url:s})?{type:"href",mode:t.mode,href:s,body:Ur(r)}:t.formatUnsupportedCmd("\\href")},htmlBuilder:(n,e)=>{var t=xs(n.body,e,!1);return ie.makeAnchor(n.href,[],t,e)},mathmlBuilder:(n,e)=>{var t=hf(n.body,e);return t instanceof ra||(t=new ra("mrow",[t])),t.setAttribute("href",n.href),t}});Pe({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=Dt(e[0],"url").url;if(!t.settings.isTrusted({command:"\\url",url:r}))return t.formatUnsupportedCmd("\\url");for(var s=[],i=0;i<r.length;i++){var o=r[i];o==="~"&&(o="\\textasciitilde"),s.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:t.mode,font:"\\texttt",body:s};return{type:"href",mode:t.mode,href:r,body:Ur(a)}}});Pe({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(n,e){var{parser:t}=n;return{type:"hbox",mode:t.mode,body:Ur(e[0])}},htmlBuilder(n,e){var t=xs(n.body,e,!1);return ie.makeFragment(t)},mathmlBuilder(n,e){return new be.MathNode("mrow",Do(n.body,e))}});Pe({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,token:s}=n,i=Dt(e[0],"raw").string,o=e[1];t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var a,l={};switch(r){case"\\htmlClass":l.class=i,a={command:"\\htmlClass",class:i};break;case"\\htmlId":l.id=i,a={command:"\\htmlId",id:i};break;case"\\htmlStyle":l.style=i,a={command:"\\htmlStyle",style:i};break;case"\\htmlData":{for(var c=i.split(","),u=0;u<c.length;u++){var h=c[u],f=h.indexOf("=");if(f<0)throw new _e("\\htmlData key/value '"+h+"' missing equals sign");var p=h.slice(0,f),g=h.slice(f+1);l["data-"+p.trim()]=g}a={command:"\\htmlData",attributes:l};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(a)?{type:"html",mode:t.mode,attributes:l,body:Ur(o)}:t.formatUnsupportedCmd(r)},htmlBuilder:(n,e)=>{var t=xs(n.body,e,!1),r=["enclosing"];n.attributes.class&&r.push(...n.attributes.class.trim().split(/\s+/));var s=ie.makeSpan(r,t,e);for(var i in n.attributes)i!=="class"&&n.attributes.hasOwnProperty(i)&&s.setAttribute(i,n.attributes[i]);return s},mathmlBuilder:(n,e)=>hf(n.body,e)});Pe({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"htmlmathml",mode:t.mode,html:Ur(e[0]),mathml:Ur(e[1])}},htmlBuilder:(n,e)=>{var t=xs(n.html,e,!1);return ie.makeFragment(t)},mathmlBuilder:(n,e)=>hf(n.mathml,e)});var XA=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new _e("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(t[1]+t[2]),unit:t[3]};if(!LY(r))throw new _e("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};Pe({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(n,e,t)=>{var{parser:r}=n,s={number:0,unit:"em"},i={number:.9,unit:"em"},o={number:0,unit:"em"},a="";if(t[0])for(var l=Dt(t[0],"raw").string,c=l.split(","),u=0;u<c.length;u++){var h=c[u].split("=");if(h.length===2){var f=h[1].trim();switch(h[0].trim()){case"alt":a=f;break;case"width":s=XA(f);break;case"height":i=XA(f);break;case"totalheight":o=XA(f);break;default:throw new _e("Invalid key: '"+h[0]+"' in \\includegraphics.")}}}var p=Dt(e[0],"url").url;return a===""&&(a=p,a=a.replace(/^.*[\\/]/,""),a=a.substring(0,a.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:p})?{type:"includegraphics",mode:r.mode,alt:a,width:s,height:i,totalheight:o,src:p}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(n,e)=>{var t=yr(n.height,e),r=0;n.totalheight.number>0&&(r=yr(n.totalheight,e)-t);var s=0;n.width.number>0&&(s=yr(n.width,e));var i={height:Ee(t+r)};s>0&&(i.width=Ee(s)),r>0&&(i.verticalAlign=Ee(-r));var o=new PSe(n.src,n.alt,i);return o.height=t,o.depth=r,o},mathmlBuilder:(n,e)=>{var t=new be.MathNode("mglyph",[]);t.setAttribute("alt",n.alt);var r=yr(n.height,e),s=0;if(n.totalheight.number>0&&(s=yr(n.totalheight,e)-r,t.setAttribute("valign",Ee(-s))),t.setAttribute("height",Ee(r+s)),n.width.number>0){var i=yr(n.width,e);t.setAttribute("width",Ee(i))}return t.setAttribute("src",n.src),t}});Pe({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,s=Dt(e[0],"size");if(t.settings.strict){var i=r[1]==="m",o=s.value.unit==="mu";i?(o||t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+s.value.unit+" units")),t.mode!=="math"&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):o&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:t.mode,dimension:s.value}},htmlBuilder(n,e){return ie.makeGlue(n.dimension,e)},mathmlBuilder(n,e){var t=yr(n.dimension,e);return new be.SpaceNode(t)}});Pe({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0];return{type:"lap",mode:t.mode,alignment:r.slice(5),body:s}},htmlBuilder:(n,e)=>{var t;n.alignment==="clap"?(t=ie.makeSpan([],[pn(n.body,e)]),t=ie.makeSpan(["inner"],[t],e)):t=ie.makeSpan(["inner"],[pn(n.body,e)]);var r=ie.makeSpan(["fix"],[]),s=ie.makeSpan([n.alignment],[t,r],e),i=ie.makeSpan(["strut"]);return i.style.height=Ee(s.height+s.depth),s.depth&&(i.style.verticalAlign=Ee(-s.depth)),s.children.unshift(i),s=ie.makeSpan(["thinbox"],[s],e),ie.makeSpan(["mord","vbox"],[s],e)},mathmlBuilder:(n,e)=>{var t=new be.MathNode("mpadded",[$n(n.body,e)]);if(n.alignment!=="rlap"){var r=n.alignment==="llap"?"-1":"-0.5";t.setAttribute("lspace",r+"width")}return t.setAttribute("width","0px"),t}});Pe({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){var{funcName:t,parser:r}=n,s=r.mode;r.switchMode("math");var i=t==="\\("?"\\)":"$",o=r.parseExpression(!1,i);return r.expect(i),r.switchMode(s),{type:"styling",mode:r.mode,style:"text",body:o}}});Pe({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){throw new _e("Mismatched "+n.funcName)}});var $F=(n,e)=>{switch(e.style.size){case at.DISPLAY.size:return n.display;case at.TEXT.size:return n.text;case at.SCRIPT.size:return n.script;case at.SCRIPTSCRIPT.size:return n.scriptscript;default:return n.text}};Pe({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"mathchoice",mode:t.mode,display:Ur(e[0]),text:Ur(e[1]),script:Ur(e[2]),scriptscript:Ur(e[3])}},htmlBuilder:(n,e)=>{var t=$F(n,e),r=xs(t,e,!1);return ie.makeFragment(r)},mathmlBuilder:(n,e)=>{var t=$F(n,e);return hf(t,e)}});var gX=(n,e,t,r,s,i,o)=>{n=ie.makeSpan([],[n]);var a=t&&gn.isCharacterBox(t),l,c;if(e){var u=pn(e,r.havingStyle(s.sup()),r);c={elem:u,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-u.depth)}}if(t){var h=pn(t,r.havingStyle(s.sub()),r);l={elem:h,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-h.height)}}var f;if(c&&l){var p=r.fontMetrics().bigOpSpacing5+l.elem.height+l.elem.depth+l.kern+n.depth+o;f=ie.makeVList({positionType:"bottom",positionData:p,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:Ee(-i)},{type:"kern",size:l.kern},{type:"elem",elem:n},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:Ee(i)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(l){var g=n.height-o;f=ie.makeVList({positionType:"top",positionData:g,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:l.elem,marginLeft:Ee(-i)},{type:"kern",size:l.kern},{type:"elem",elem:n}]},r)}else if(c){var y=n.depth+o;f=ie.makeVList({positionType:"bottom",positionData:y,children:[{type:"elem",elem:n},{type:"kern",size:c.kern},{type:"elem",elem:c.elem,marginLeft:Ee(i)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return n;var v=[f];if(l&&i!==0&&!a){var b=ie.makeSpan(["mspace"],[],r);b.style.marginRight=Ee(i),v.unshift(b)}return ie.makeSpan(["mop","op-limits"],v,r)},yX=["\\smallint"],oy=(n,e)=>{var t,r,s=!1,i;n.type==="supsub"?(t=n.sup,r=n.sub,i=Dt(n.base,"op"),s=!0):i=Dt(n,"op");var o=e.style,a=!1;o.size===at.DISPLAY.size&&i.symbol&&!yX.includes(i.name)&&(a=!0);var l;if(i.symbol){var c=a?"Size2-Regular":"Size1-Regular",u="";if((i.name==="\\oiint"||i.name==="\\oiiint")&&(u=i.name.slice(1),i.name=u==="oiint"?"\\iint":"\\iiint"),l=ie.makeSymbol(i.name,c,"math",e,["mop","op-symbol",a?"large-op":"small-op"]),u.length>0){var h=l.italic,f=ie.staticSvg(u+"Size"+(a?"2":"1"),e);l=ie.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:0},{type:"elem",elem:f,shift:a?.08:0}]},e),i.name="\\"+u,l.classes.unshift("mop"),l.italic=h}}else if(i.body){var p=xs(i.body,e,!0);p.length===1&&p[0]instanceof rl?(l=p[0],l.classes[0]="mop"):l=ie.makeSpan(["mop"],p,e)}else{for(var g=[],y=1;y<i.name.length;y++)g.push(ie.mathsym(i.name[y],i.mode,e));l=ie.makeSpan(["mop"],g,e)}var v=0,b=0;return(l instanceof rl||i.name==="\\oiint"||i.name==="\\oiiint")&&!i.suppressBaseShift&&(v=(l.height-l.depth)/2-e.fontMetrics().axisHeight,b=l.italic),s?gX(l,t,r,e,o,b,v):(v&&(l.style.position="relative",l.style.top=Ee(v)),l)},l2=(n,e)=>{var t;if(n.symbol)t=new ra("mo",[sl(n.name,n.mode)]),yX.includes(n.name)&&t.setAttribute("largeop","false");else if(n.body)t=new ra("mo",Do(n.body,e));else{t=new ra("mi",[new Ac(n.name.slice(1))]);var r=new ra("mo",[sl("","text")]);n.parentIsSupSub?t=new ra("mrow",[t,r]):t=qY([t,r])}return t},LTe={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Pe({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=r;return s.length===1&&(s=LTe[s]),{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:s}},htmlBuilder:oy,mathmlBuilder:l2});Pe({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Ur(r)}},htmlBuilder:oy,mathmlBuilder:l2});var DTe={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Pe({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:oy,mathmlBuilder:l2});Pe({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:oy,mathmlBuilder:l2});Pe({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0,allowedInArgument:!0},handler(n){var{parser:e,funcName:t}=n,r=t;return r.length===1&&(r=DTe[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:oy,mathmlBuilder:l2});var xX=(n,e)=>{var t,r,s=!1,i;n.type==="supsub"?(t=n.sup,r=n.sub,i=Dt(n.base,"operatorname"),s=!0):i=Dt(n,"operatorname");var o;if(i.body.length>0){for(var a=i.body.map(h=>{var f=h.text;return typeof f=="string"?{type:"textord",mode:h.mode,text:f}:h}),l=xs(a,e.withFont("mathrm"),!0),c=0;c<l.length;c++){var u=l[c];u instanceof rl&&(u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}o=ie.makeSpan(["mop"],l,e)}else o=ie.makeSpan(["mop"],[],e);return s?gX(o,t,r,e,e.style,0,0):o},jTe=(n,e)=>{for(var t=Do(n.body,e.withFont("mathrm")),r=!0,s=0;s<t.length;s++){var i=t[s];if(!(i instanceof be.SpaceNode))if(i instanceof be.MathNode)switch(i.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var o=i.children[0];i.children.length===1&&o instanceof be.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var a=t.map(u=>u.toText()).join("");t=[new be.TextNode(a)]}var l=new be.MathNode("mi",t);l.setAttribute("mathvariant","normal");var c=new be.MathNode("mo",[sl("","text")]);return n.parentIsSupSub?new be.MathNode("mrow",[l,c]):be.newDocumentFragment([l,c])};Pe({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,s=e[0];return{type:"operatorname",mode:t.mode,body:Ur(s),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:xX,mathmlBuilder:jTe});U("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");tm({type:"ordgroup",htmlBuilder(n,e){return n.semisimple?ie.makeFragment(xs(n.body,e,!1)):ie.makeSpan(["mord"],xs(n.body,e,!0),e)},mathmlBuilder(n,e){return hf(n.body,e,!0)}});Pe({type:"overline",names:["\\overline"],props:{numArgs:1},handler(n,e){var{parser:t}=n,r=e[0];return{type:"overline",mode:t.mode,body:r}},htmlBuilder(n,e){var t=pn(n.body,e.havingCrampedStyle()),r=ie.makeLineSpan("overline-line",e),s=e.fontMetrics().defaultRuleThickness,i=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t},{type:"kern",size:3*s},{type:"elem",elem:r},{type:"kern",size:s}]},e);return ie.makeSpan(["mord","overline"],[i],e)},mathmlBuilder(n,e){var t=new be.MathNode("mo",[new be.TextNode("")]);t.setAttribute("stretchy","true");var r=new be.MathNode("mover",[$n(n.body,e),t]);return r.setAttribute("accent","true"),r}});Pe({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"phantom",mode:t.mode,body:Ur(r)}},htmlBuilder:(n,e)=>{var t=xs(n.body,e.withPhantom(),!1);return ie.makeFragment(t)},mathmlBuilder:(n,e)=>{var t=Do(n.body,e);return new be.MathNode("mphantom",t)}});Pe({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"hphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=ie.makeSpan([],[pn(n.body,e.withPhantom())]);if(t.height=0,t.depth=0,t.children)for(var r=0;r<t.children.length;r++)t.children[r].height=0,t.children[r].depth=0;return t=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e),ie.makeSpan(["mord"],[t],e)},mathmlBuilder:(n,e)=>{var t=Do(Ur(n.body),e),r=new be.MathNode("mphantom",t),s=new be.MathNode("mpadded",[r]);return s.setAttribute("height","0px"),s.setAttribute("depth","0px"),s}});Pe({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"vphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=ie.makeSpan(["inner"],[pn(n.body,e.withPhantom())]),r=ie.makeSpan(["fix"],[]);return ie.makeSpan(["mord","rlap"],[t,r],e)},mathmlBuilder:(n,e)=>{var t=Do(Ur(n.body),e),r=new be.MathNode("mphantom",t),s=new be.MathNode("mpadded",[r]);return s.setAttribute("width","0px"),s}});Pe({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n,r=Dt(e[0],"size").value,s=e[1];return{type:"raisebox",mode:t.mode,dy:r,body:s}},htmlBuilder(n,e){var t=pn(n.body,e),r=yr(n.dy,e);return ie.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){var t=new be.MathNode("mpadded",[$n(n.body,e)]),r=n.dy.number+n.dy.unit;return t.setAttribute("voffset",r),t}});Pe({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(n){var{parser:e}=n;return{type:"internal",mode:e.mode}}});Pe({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(n,e,t){var{parser:r}=n,s=t[0],i=Dt(e[0],"size"),o=Dt(e[1],"size");return{type:"rule",mode:r.mode,shift:s&&Dt(s,"size").value,width:i.value,height:o.value}},htmlBuilder(n,e){var t=ie.makeSpan(["mord","rule"],[],e),r=yr(n.width,e),s=yr(n.height,e),i=n.shift?yr(n.shift,e):0;return t.style.borderRightWidth=Ee(r),t.style.borderTopWidth=Ee(s),t.style.bottom=Ee(i),t.width=r,t.height=s+i,t.depth=-i,t.maxFontSize=s*1.125*e.sizeMultiplier,t},mathmlBuilder(n,e){var t=yr(n.width,e),r=yr(n.height,e),s=n.shift?yr(n.shift,e):0,i=e.color&&e.getColor()||"black",o=new be.MathNode("mspace");o.setAttribute("mathbackground",i),o.setAttribute("width",Ee(t)),o.setAttribute("height",Ee(r));var a=new be.MathNode("mpadded",[o]);return s>=0?a.setAttribute("height",Ee(s)):(a.setAttribute("height",Ee(s)),a.setAttribute("depth",Ee(-s))),a.setAttribute("voffset",Ee(s)),a}});function bX(n,e,t){for(var r=xs(n,e,!1),s=e.sizeMultiplier/t.sizeMultiplier,i=0;i<r.length;i++){var o=r[i].classes.indexOf("sizing");o<0?Array.prototype.push.apply(r[i].classes,e.sizingClasses(t)):r[i].classes[o+1]==="reset-size"+e.size&&(r[i].classes[o+1]="reset-size"+t.size),r[i].height*=s,r[i].depth*=s}return ie.makeFragment(r)}var VF=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],OTe=(n,e)=>{var t=e.havingSize(n.size);return bX(n.body,t,e)};Pe({type:"sizing",names:VF,props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{breakOnTokenText:t,funcName:r,parser:s}=n,i=s.parseExpression(!1,t);return{type:"sizing",mode:s.mode,size:VF.indexOf(r)+1,body:i}},htmlBuilder:OTe,mathmlBuilder:(n,e)=>{var t=e.havingSize(n.size),r=Do(n.body,t),s=new be.MathNode("mstyle",r);return s.setAttribute("mathsize",Ee(t.sizeMultiplier)),s}});Pe({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(n,e,t)=>{var{parser:r}=n,s=!1,i=!1,o=t[0]&&Dt(t[0],"ordgroup");if(o)for(var a="",l=0;l<o.body.length;++l){var c=o.body[l];if(a=c.text,a==="t")s=!0;else if(a==="b")i=!0;else{s=!1,i=!1;break}}else s=!0,i=!0;var u=e[0];return{type:"smash",mode:r.mode,body:u,smashHeight:s,smashDepth:i}},htmlBuilder:(n,e)=>{var t=ie.makeSpan([],[pn(n.body,e)]);if(!n.smashHeight&&!n.smashDepth)return t;if(n.smashHeight&&(t.height=0,t.children))for(var r=0;r<t.children.length;r++)t.children[r].height=0;if(n.smashDepth&&(t.depth=0,t.children))for(var s=0;s<t.children.length;s++)t.children[s].depth=0;var i=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e);return ie.makeSpan(["mord"],[i],e)},mathmlBuilder:(n,e)=>{var t=new be.MathNode("mpadded",[$n(n.body,e)]);return n.smashHeight&&t.setAttribute("height","0px"),n.smashDepth&&t.setAttribute("depth","0px"),t}});Pe({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r}=n,s=t[0],i=e[0];return{type:"sqrt",mode:r.mode,body:i,index:s}},htmlBuilder(n,e){var t=pn(n.body,e.havingCrampedStyle());t.height===0&&(t.height=e.fontMetrics().xHeight),t=ie.wrapFragment(t,e);var r=e.fontMetrics(),s=r.defaultRuleThickness,i=s;e.style.id<at.TEXT.id&&(i=e.fontMetrics().xHeight);var o=s+i/4,a=t.height+t.depth+o+s,{span:l,ruleWidth:c,advanceWidth:u}=Wu.sqrtImage(a,e),h=l.height-c;h>t.height+t.depth+o&&(o=(o+h-t.height-t.depth)/2);var f=l.height-t.height-o-c;t.style.paddingLeft=Ee(u);var p=ie.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t,wrapperClasses:["svg-align"]},{type:"kern",size:-(t.height+f)},{type:"elem",elem:l},{type:"kern",size:c}]},e);if(n.index){var g=e.havingStyle(at.SCRIPTSCRIPT),y=pn(n.index,g,e),v=.6*(p.height-p.depth),b=ie.makeVList({positionType:"shift",positionData:-v,children:[{type:"elem",elem:y}]},e),w=ie.makeSpan(["root"],[b]);return ie.makeSpan(["mord","sqrt"],[w,p],e)}else return ie.makeSpan(["mord","sqrt"],[p],e)},mathmlBuilder(n,e){var{body:t,index:r}=n;return r?new be.MathNode("mroot",[$n(t,e),$n(r,e)]):new be.MathNode("msqrt",[$n(t,e)])}});var UF={display:at.DISPLAY,text:at.TEXT,script:at.SCRIPT,scriptscript:at.SCRIPTSCRIPT};Pe({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n,e){var{breakOnTokenText:t,funcName:r,parser:s}=n,i=s.parseExpression(!0,t),o=r.slice(1,r.length-5);return{type:"styling",mode:s.mode,style:o,body:i}},htmlBuilder(n,e){var t=UF[n.style],r=e.havingStyle(t).withFont("");return bX(n.body,r,e)},mathmlBuilder(n,e){var t=UF[n.style],r=e.havingStyle(t),s=Do(n.body,r),i=new be.MathNode("mstyle",s),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},a=o[n.style];return i.setAttribute("scriptlevel",a[0]),i.setAttribute("displaystyle",a[1]),i}});var FTe=function(e,t){var r=e.base;if(r)if(r.type==="op"){var s=r.limits&&(t.style.size===at.DISPLAY.size||r.alwaysHandleSupSub);return s?oy:null}else if(r.type==="operatorname"){var i=r.alwaysHandleSupSub&&(t.style.size===at.DISPLAY.size||r.limits);return i?xX:null}else{if(r.type==="accent")return gn.isCharacterBox(r.base)?qR:null;if(r.type==="horizBrace"){var o=!e.sub;return o===r.isOver?mX:null}else return null}else return null};tm({type:"supsub",htmlBuilder(n,e){var t=FTe(n,e);if(t)return t(n,e);var{base:r,sup:s,sub:i}=n,o=pn(r,e),a,l,c=e.fontMetrics(),u=0,h=0,f=r&&gn.isCharacterBox(r);if(s){var p=e.havingStyle(e.style.sup());a=pn(s,p,e),f||(u=o.height-p.fontMetrics().supDrop*p.sizeMultiplier/e.sizeMultiplier)}if(i){var g=e.havingStyle(e.style.sub());l=pn(i,g,e),f||(h=o.depth+g.fontMetrics().subDrop*g.sizeMultiplier/e.sizeMultiplier)}var y;e.style===at.DISPLAY?y=c.sup1:e.style.cramped?y=c.sup3:y=c.sup2;var v=e.sizeMultiplier,b=Ee(.5/c.ptPerEm/v),w=null;if(l){var k=n.base&&n.base.type==="op"&&n.base.name&&(n.base.name==="\\oiint"||n.base.name==="\\oiiint");(o instanceof rl||k)&&(w=Ee(-o.italic))}var T;if(a&&l){u=Math.max(u,y,a.depth+.25*c.xHeight),h=Math.max(h,c.sub2);var R=c.defaultRuleThickness,M=4*R;if(u-a.depth-(l.height-h)<M){h=M-(u-a.depth)+l.height;var E=.8*c.xHeight-(u-a.depth);E>0&&(u+=E,h-=E)}var I=[{type:"elem",elem:l,shift:h,marginRight:b,marginLeft:w},{type:"elem",elem:a,shift:-u,marginRight:b}];T=ie.makeVList({positionType:"individualShift",children:I},e)}else if(l){h=Math.max(h,c.sub1,l.height-.8*c.xHeight);var S=[{type:"elem",elem:l,marginLeft:w,marginRight:b}];T=ie.makeVList({positionType:"shift",positionData:h,children:S},e)}else if(a)u=Math.max(u,y,a.depth+.25*c.xHeight),T=ie.makeVList({positionType:"shift",positionData:-u,children:[{type:"elem",elem:a,marginRight:b}]},e);else throw new Error("supsub must have either sup or sub.");var N=XC(o,"right")||"mord";return ie.makeSpan([N],[o,ie.makeSpan(["msupsub"],[T])],e)},mathmlBuilder(n,e){var t=!1,r,s;n.base&&n.base.type==="horizBrace"&&(s=!!n.sup,s===n.base.isOver&&(t=!0,r=n.base.isOver)),n.base&&(n.base.type==="op"||n.base.type==="operatorname")&&(n.base.parentIsSupSub=!0);var i=[$n(n.base,e)];n.sub&&i.push($n(n.sub,e)),n.sup&&i.push($n(n.sup,e));var o;if(t)o=r?"mover":"munder";else if(n.sub)if(n.sup){var c=n.base;c&&c.type==="op"&&c.limits&&e.style===at.DISPLAY||c&&c.type==="operatorname"&&c.alwaysHandleSupSub&&(e.style===at.DISPLAY||c.limits)?o="munderover":o="msubsup"}else{var l=n.base;l&&l.type==="op"&&l.limits&&(e.style===at.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===at.DISPLAY)?o="munder":o="msub"}else{var a=n.base;a&&a.type==="op"&&a.limits&&(e.style===at.DISPLAY||a.alwaysHandleSupSub)||a&&a.type==="operatorname"&&a.alwaysHandleSupSub&&(a.limits||e.style===at.DISPLAY)?o="mover":o="msup"}return new be.MathNode(o,i)}});tm({type:"atom",htmlBuilder(n,e){return ie.mathsym(n.text,n.mode,e,["m"+n.family])},mathmlBuilder(n,e){var t=new be.MathNode("mo",[sl(n.text,n.mode)]);if(n.family==="bin"){var r=UR(n,e);r==="bold-italic"&&t.setAttribute("mathvariant",r)}else n.family==="punct"?t.setAttribute("separator","true"):(n.family==="open"||n.family==="close")&&t.setAttribute("stretchy","false");return t}});var vX={mi:"italic",mn:"normal",mtext:"normal"};tm({type:"mathord",htmlBuilder(n,e){return ie.makeOrd(n,e,"mathord")},mathmlBuilder(n,e){var t=new be.MathNode("mi",[sl(n.text,n.mode,e)]),r=UR(n,e)||"italic";return r!==vX[t.type]&&t.setAttribute("mathvariant",r),t}});tm({type:"textord",htmlBuilder(n,e){return ie.makeOrd(n,e,"textord")},mathmlBuilder(n,e){var t=sl(n.text,n.mode,e),r=UR(n,e)||"normal",s;return n.mode==="text"?s=new be.MathNode("mtext",[t]):/[0-9]/.test(n.text)?s=new be.MathNode("mn",[t]):n.text==="\\prime"?s=new be.MathNode("mo",[t]):s=new be.MathNode("mi",[t]),r!==vX[s.type]&&s.setAttribute("mathvariant",r),s}});var JA={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},QA={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};tm({type:"spacing",htmlBuilder(n,e){if(QA.hasOwnProperty(n.text)){var t=QA[n.text].className||"";if(n.mode==="text"){var r=ie.makeOrd(n,e,"textord");return r.classes.push(t),r}else return ie.makeSpan(["mspace",t],[ie.mathsym(n.text,n.mode,e)],e)}else{if(JA.hasOwnProperty(n.text))return ie.makeSpan(["mspace",JA[n.text]],[],e);throw new _e('Unknown type of space "'+n.text+'"')}},mathmlBuilder(n,e){var t;if(QA.hasOwnProperty(n.text))t=new be.MathNode("mtext",[new be.TextNode("")]);else{if(JA.hasOwnProperty(n.text))return new be.MathNode("mspace");throw new _e('Unknown type of space "'+n.text+'"')}return t}});var HF=()=>{var n=new be.MathNode("mtd",[]);return n.setAttribute("width","50%"),n};tm({type:"tag",mathmlBuilder(n,e){var t=new be.MathNode("mtable",[new be.MathNode("mtr",[HF(),new be.MathNode("mtd",[hf(n.body,e)]),HF(),new be.MathNode("mtd",[hf(n.tag,e)])])]);return t.setAttribute("width","100%"),t}});var qF={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},GF={"\\textbf":"textbf","\\textmd":"textmd"},zTe={"\\textit":"textit","\\textup":"textup"},WF=(n,e)=>{var t=n.font;if(t){if(qF[t])return e.withTextFontFamily(qF[t]);if(GF[t])return e.withTextFontWeight(GF[t]);if(t==="\\emph")return e.fontShape==="textit"?e.withTextFontShape("textup"):e.withTextFontShape("textit")}else return e;return e.withTextFontShape(zTe[t])};Pe({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,s=e[0];return{type:"text",mode:t.mode,body:Ur(s),font:r}},htmlBuilder(n,e){var t=WF(n,e),r=xs(n.body,t,!0);return ie.makeSpan(["mord","text"],r,t)},mathmlBuilder(n,e){var t=WF(n,e);return hf(n.body,t)}});Pe({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"underline",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=pn(n.body,e),r=ie.makeLineSpan("underline-line",e),s=e.fontMetrics().defaultRuleThickness,i=ie.makeVList({positionType:"top",positionData:t.height,children:[{type:"kern",size:s},{type:"elem",elem:r},{type:"kern",size:3*s},{type:"elem",elem:t}]},e);return ie.makeSpan(["mord","underline"],[i],e)},mathmlBuilder(n,e){var t=new be.MathNode("mo",[new be.TextNode("")]);t.setAttribute("stretchy","true");var r=new be.MathNode("munder",[$n(n.body,e),t]);return r.setAttribute("accentunder","true"),r}});Pe({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"vcenter",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=pn(n.body,e),r=e.fontMetrics().axisHeight,s=.5*(t.height-r-(t.depth+r));return ie.makeVList({positionType:"shift",positionData:s,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){return new be.MathNode("mpadded",[$n(n.body,e)],["vcenter"])}});Pe({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(n,e,t){throw new _e("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(n,e){for(var t=KF(n),r=[],s=e.havingStyle(e.style.text()),i=0;i<t.length;i++){var o=t[i];o==="~"&&(o="\\textasciitilde"),r.push(ie.makeSymbol(o,"Typewriter-Regular",n.mode,s,["mord","texttt"]))}return ie.makeSpan(["mord","text"].concat(s.sizingClasses(e)),ie.tryCombineChars(r),s)},mathmlBuilder(n,e){var t=new be.TextNode(KF(n)),r=new be.MathNode("mtext",[t]);return r.setAttribute("mathvariant","monospace"),r}});var KF=n=>n.body.replace(/ /g,n.star?"":""),Ih=UY,wX=`[ \r
	]`,BTe="\\\\[a-zA-Z@]+",$Te="\\\\[^\uD800-\uDFFF]",VTe="("+BTe+")"+wX+"*",UTe=`\\\\(
|[ \r	]+
?)[ \r	]*`,eN="[-]",HTe=new RegExp(eN+"+$"),qTe="("+wX+"+)|"+(UTe+"|")+"([!-\\[\\]---]"+(eN+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(eN+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+VTe)+("|"+$Te+")");class YF{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(qTe,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new ha("EOF",new _o(this,t,t));var r=this.tokenRegex.exec(e);if(r===null||r.index!==t)throw new _e("Unexpected character: '"+e[t]+"'",new ha(e[t],new _o(this,t,t+1)));var s=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[s]===14){var i=e.indexOf(`
`,this.tokenRegex.lastIndex);return i===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=i+1,this.lex()}return new ha(s,new _o(this,t,this.tokenRegex.lastIndex))}}class GTe{constructor(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new _e("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(e[t]==null?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,r){if(r===void 0&&(r=!1),r){for(var s=0;s<this.undefStack.length;s++)delete this.undefStack[s][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var i=this.undefStack[this.undefStack.length-1];i&&!i.hasOwnProperty(e)&&(i[e]=this.current[e])}t==null?delete this.current[e]:this.current[e]=t}}var WTe=uX;U("\\noexpand",function(n){var e=n.popToken();return n.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});U("\\expandafter",function(n){var e=n.popToken();return n.expandOnce(!0),{tokens:[e],numArgs:0}});U("\\@firstoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[0],numArgs:0}});U("\\@secondoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[1],numArgs:0}});U("\\@ifnextchar",function(n){var e=n.consumeArgs(3);n.consumeSpaces();var t=n.future();return e[0].length===1&&e[0][0].text===t.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});U("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");U("\\TextOrMath",function(n){var e=n.consumeArgs(2);return n.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var XF={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};U("\\char",function(n){var e=n.popToken(),t,r="";if(e.text==="'")t=8,e=n.popToken();else if(e.text==='"')t=16,e=n.popToken();else if(e.text==="`")if(e=n.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new _e("\\char` missing argument");r=e.text.charCodeAt(0)}else t=10;if(t){if(r=XF[e.text],r==null||r>=t)throw new _e("Invalid base-"+t+" digit "+e.text);for(var s;(s=XF[n.future().text])!=null&&s<t;)r*=t,r+=s,n.popToken()}return"\\@char{"+r+"}"});var ZR=(n,e,t,r)=>{var s=n.consumeArg().tokens;if(s.length!==1)throw new _e("\\newcommand's first argument must be a macro name");var i=s[0].text,o=n.isDefined(i);if(o&&!e)throw new _e("\\newcommand{"+i+"} attempting to redefine "+(i+"; use \\renewcommand"));if(!o&&!t)throw new _e("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var a=0;if(s=n.consumeArg().tokens,s.length===1&&s[0].text==="["){for(var l="",c=n.expandNextToken();c.text!=="]"&&c.text!=="EOF";)l+=c.text,c=n.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new _e("Invalid number of arguments: "+l);a=parseInt(l),s=n.consumeArg().tokens}return o&&r||n.macros.set(i,{tokens:s,numArgs:a}),""};U("\\newcommand",n=>ZR(n,!1,!0,!1));U("\\renewcommand",n=>ZR(n,!0,!1,!1));U("\\providecommand",n=>ZR(n,!0,!0,!0));U("\\message",n=>{var e=n.consumeArgs(1)[0];return console.log(e.reverse().map(t=>t.text).join("")),""});U("\\errmessage",n=>{var e=n.consumeArgs(1)[0];return console.error(e.reverse().map(t=>t.text).join("")),""});U("\\show",n=>{var e=n.popToken(),t=e.text;return console.log(e,n.macros.get(t),Ih[t],Kn.math[t],Kn.text[t]),""});U("\\bgroup","{");U("\\egroup","}");U("~","\\nobreakspace");U("\\lq","`");U("\\rq","'");U("\\aa","\\r a");U("\\AA","\\r A");U("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");U("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");U("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");U("","\\mathscr{B}");U("","\\mathscr{E}");U("","\\mathscr{F}");U("","\\mathscr{H}");U("","\\mathscr{I}");U("","\\mathscr{L}");U("","\\mathscr{M}");U("","\\mathscr{R}");U("","\\mathfrak{C}");U("","\\mathfrak{H}");U("","\\mathfrak{Z}");U("\\Bbbk","\\Bbb{k}");U("","\\cdotp");U("\\llap","\\mathllap{\\textrm{#1}}");U("\\rlap","\\mathrlap{\\textrm{#1}}");U("\\clap","\\mathclap{\\textrm{#1}}");U("\\mathstrut","\\vphantom{(}");U("\\underbar","\\underline{\\text{#1}}");U("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');U("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");U("\\ne","\\neq");U("","\\neq");U("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");U("","\\notin");U("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");U("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");U("","\\perp");U("","\\mathclose{!\\mkern-0.8mu!}");U("","\\notni");U("","\\ulcorner");U("","\\urcorner");U("","\\llcorner");U("","\\lrcorner");U("","\\copyright");U("","\\textregistered");U("","\\textregistered");U("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');U("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');U("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');U("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');U("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");U("","\\vdots");U("\\varGamma","\\mathit{\\Gamma}");U("\\varDelta","\\mathit{\\Delta}");U("\\varTheta","\\mathit{\\Theta}");U("\\varLambda","\\mathit{\\Lambda}");U("\\varXi","\\mathit{\\Xi}");U("\\varPi","\\mathit{\\Pi}");U("\\varSigma","\\mathit{\\Sigma}");U("\\varUpsilon","\\mathit{\\Upsilon}");U("\\varPhi","\\mathit{\\Phi}");U("\\varPsi","\\mathit{\\Psi}");U("\\varOmega","\\mathit{\\Omega}");U("\\substack","\\begin{subarray}{c}#1\\end{subarray}");U("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");U("\\boxed","\\fbox{$\\displaystyle{#1}$}");U("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");U("\\implies","\\DOTSB\\;\\Longrightarrow\\;");U("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");U("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");U("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var JF={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};U("\\dots",function(n){var e="\\dotso",t=n.expandAfterFuture().text;return t in JF?e=JF[t]:(t.slice(0,4)==="\\not"||t in Kn.math&&["bin","rel"].includes(Kn.math[t].group))&&(e="\\dotsb"),e});var eM={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};U("\\dotso",function(n){var e=n.future().text;return e in eM?"\\ldots\\,":"\\ldots"});U("\\dotsc",function(n){var e=n.future().text;return e in eM&&e!==","?"\\ldots\\,":"\\ldots"});U("\\cdots",function(n){var e=n.future().text;return e in eM?"\\@cdots\\,":"\\@cdots"});U("\\dotsb","\\cdots");U("\\dotsm","\\cdots");U("\\dotsi","\\!\\cdots");U("\\dotsx","\\ldots\\,");U("\\DOTSI","\\relax");U("\\DOTSB","\\relax");U("\\DOTSX","\\relax");U("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");U("\\,","\\tmspace+{3mu}{.1667em}");U("\\thinspace","\\,");U("\\>","\\mskip{4mu}");U("\\:","\\tmspace+{4mu}{.2222em}");U("\\medspace","\\:");U("\\;","\\tmspace+{5mu}{.2777em}");U("\\thickspace","\\;");U("\\!","\\tmspace-{3mu}{.1667em}");U("\\negthinspace","\\!");U("\\negmedspace","\\tmspace-{4mu}{.2222em}");U("\\negthickspace","\\tmspace-{5mu}{.277em}");U("\\enspace","\\kern.5em ");U("\\enskip","\\hskip.5em\\relax");U("\\quad","\\hskip1em\\relax");U("\\qquad","\\hskip2em\\relax");U("\\tag","\\@ifstar\\tag@literal\\tag@paren");U("\\tag@paren","\\tag@literal{({#1})}");U("\\tag@literal",n=>{if(n.macros.get("\\df@tag"))throw new _e("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});U("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");U("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");U("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");U("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");U("\\newline","\\\\\\relax");U("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var kX=Ee(Tc["Main-Regular"][84][1]-.7*Tc["Main-Regular"][65][1]);U("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+kX+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");U("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+kX+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");U("\\hspace","\\@ifstar\\@hspacer\\@hspace");U("\\@hspace","\\hskip #1\\relax");U("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");U("\\ordinarycolon",":");U("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");U("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');U("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');U("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');U("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');U("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');U("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');U("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');U("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');U("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');U("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');U("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');U("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');U("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');U("","\\dblcolon");U("","\\eqcolon");U("","\\coloneqq");U("","\\eqqcolon");U("","\\Coloneqq");U("\\ratio","\\vcentcolon");U("\\coloncolon","\\dblcolon");U("\\colonequals","\\coloneqq");U("\\coloncolonequals","\\Coloneqq");U("\\equalscolon","\\eqqcolon");U("\\equalscoloncolon","\\Eqqcolon");U("\\colonminus","\\coloneq");U("\\coloncolonminus","\\Coloneq");U("\\minuscolon","\\eqcolon");U("\\minuscoloncolon","\\Eqcolon");U("\\coloncolonapprox","\\Colonapprox");U("\\coloncolonsim","\\Colonsim");U("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");U("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");U("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");U("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");U("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");U("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");U("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");U("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");U("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");U("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");U("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");U("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");U("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");U("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");U("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");U("\\ngeqq","\\html@mathml{\\@ngeqq}{}");U("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");U("\\nleqq","\\html@mathml{\\@nleqq}{}");U("\\nleqslant","\\html@mathml{\\@nleqslant}{}");U("\\nshortmid","\\html@mathml{\\@nshortmid}{}");U("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");U("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");U("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");U("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");U("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");U("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");U("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");U("\\imath","\\html@mathml{\\@imath}{}");U("\\jmath","\\html@mathml{\\@jmath}{}");U("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");U("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");U("","\\llbracket");U("","\\rrbracket");U("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");U("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");U("","\\lBrace");U("","\\rBrace");U("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");U("","\\minuso");U("\\darr","\\downarrow");U("\\dArr","\\Downarrow");U("\\Darr","\\Downarrow");U("\\lang","\\langle");U("\\rang","\\rangle");U("\\uarr","\\uparrow");U("\\uArr","\\Uparrow");U("\\Uarr","\\Uparrow");U("\\N","\\mathbb{N}");U("\\R","\\mathbb{R}");U("\\Z","\\mathbb{Z}");U("\\alef","\\aleph");U("\\alefsym","\\aleph");U("\\Alpha","\\mathrm{A}");U("\\Beta","\\mathrm{B}");U("\\bull","\\bullet");U("\\Chi","\\mathrm{X}");U("\\clubs","\\clubsuit");U("\\cnums","\\mathbb{C}");U("\\Complex","\\mathbb{C}");U("\\Dagger","\\ddagger");U("\\diamonds","\\diamondsuit");U("\\empty","\\emptyset");U("\\Epsilon","\\mathrm{E}");U("\\Eta","\\mathrm{H}");U("\\exist","\\exists");U("\\harr","\\leftrightarrow");U("\\hArr","\\Leftrightarrow");U("\\Harr","\\Leftrightarrow");U("\\hearts","\\heartsuit");U("\\image","\\Im");U("\\infin","\\infty");U("\\Iota","\\mathrm{I}");U("\\isin","\\in");U("\\Kappa","\\mathrm{K}");U("\\larr","\\leftarrow");U("\\lArr","\\Leftarrow");U("\\Larr","\\Leftarrow");U("\\lrarr","\\leftrightarrow");U("\\lrArr","\\Leftrightarrow");U("\\Lrarr","\\Leftrightarrow");U("\\Mu","\\mathrm{M}");U("\\natnums","\\mathbb{N}");U("\\Nu","\\mathrm{N}");U("\\Omicron","\\mathrm{O}");U("\\plusmn","\\pm");U("\\rarr","\\rightarrow");U("\\rArr","\\Rightarrow");U("\\Rarr","\\Rightarrow");U("\\real","\\Re");U("\\reals","\\mathbb{R}");U("\\Reals","\\mathbb{R}");U("\\Rho","\\mathrm{P}");U("\\sdot","\\cdot");U("\\sect","\\S");U("\\spades","\\spadesuit");U("\\sub","\\subset");U("\\sube","\\subseteq");U("\\supe","\\supseteq");U("\\Tau","\\mathrm{T}");U("\\thetasym","\\vartheta");U("\\weierp","\\wp");U("\\Zeta","\\mathrm{Z}");U("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");U("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");U("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");U("\\bra","\\mathinner{\\langle{#1}|}");U("\\ket","\\mathinner{|{#1}\\rangle}");U("\\braket","\\mathinner{\\langle{#1}\\rangle}");U("\\Bra","\\left\\langle#1\\right|");U("\\Ket","\\left|#1\\right\\rangle");var _X=n=>e=>{var t=e.consumeArg().tokens,r=e.consumeArg().tokens,s=e.consumeArg().tokens,i=e.consumeArg().tokens,o=e.macros.get("|"),a=e.macros.get("\\|");e.macros.beginGroup();var l=h=>f=>{n&&(f.macros.set("|",o),s.length&&f.macros.set("\\|",a));var p=h;if(!h&&s.length){var g=f.future();g.text==="|"&&(f.popToken(),p=!0)}return{tokens:p?s:r,numArgs:0}};e.macros.set("|",l(!1)),s.length&&e.macros.set("\\|",l(!0));var c=e.consumeArg().tokens,u=e.expandTokens([...i,...c,...t]);return e.macros.endGroup(),{tokens:u.reverse(),numArgs:0}};U("\\bra@ket",_X(!1));U("\\bra@set",_X(!0));U("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");U("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");U("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");U("\\angln","{\\angl n}");U("\\blue","\\textcolor{##6495ed}{#1}");U("\\orange","\\textcolor{##ffa500}{#1}");U("\\pink","\\textcolor{##ff00af}{#1}");U("\\red","\\textcolor{##df0030}{#1}");U("\\green","\\textcolor{##28ae7b}{#1}");U("\\gray","\\textcolor{gray}{#1}");U("\\purple","\\textcolor{##9d38bd}{#1}");U("\\blueA","\\textcolor{##ccfaff}{#1}");U("\\blueB","\\textcolor{##80f6ff}{#1}");U("\\blueC","\\textcolor{##63d9ea}{#1}");U("\\blueD","\\textcolor{##11accd}{#1}");U("\\blueE","\\textcolor{##0c7f99}{#1}");U("\\tealA","\\textcolor{##94fff5}{#1}");U("\\tealB","\\textcolor{##26edd5}{#1}");U("\\tealC","\\textcolor{##01d1c1}{#1}");U("\\tealD","\\textcolor{##01a995}{#1}");U("\\tealE","\\textcolor{##208170}{#1}");U("\\greenA","\\textcolor{##b6ffb0}{#1}");U("\\greenB","\\textcolor{##8af281}{#1}");U("\\greenC","\\textcolor{##74cf70}{#1}");U("\\greenD","\\textcolor{##1fab54}{#1}");U("\\greenE","\\textcolor{##0d923f}{#1}");U("\\goldA","\\textcolor{##ffd0a9}{#1}");U("\\goldB","\\textcolor{##ffbb71}{#1}");U("\\goldC","\\textcolor{##ff9c39}{#1}");U("\\goldD","\\textcolor{##e07d10}{#1}");U("\\goldE","\\textcolor{##a75a05}{#1}");U("\\redA","\\textcolor{##fca9a9}{#1}");U("\\redB","\\textcolor{##ff8482}{#1}");U("\\redC","\\textcolor{##f9685d}{#1}");U("\\redD","\\textcolor{##e84d39}{#1}");U("\\redE","\\textcolor{##bc2612}{#1}");U("\\maroonA","\\textcolor{##ffbde0}{#1}");U("\\maroonB","\\textcolor{##ff92c6}{#1}");U("\\maroonC","\\textcolor{##ed5fa6}{#1}");U("\\maroonD","\\textcolor{##ca337c}{#1}");U("\\maroonE","\\textcolor{##9e034e}{#1}");U("\\purpleA","\\textcolor{##ddd7ff}{#1}");U("\\purpleB","\\textcolor{##c6b9fc}{#1}");U("\\purpleC","\\textcolor{##aa87ff}{#1}");U("\\purpleD","\\textcolor{##7854ab}{#1}");U("\\purpleE","\\textcolor{##543b78}{#1}");U("\\mintA","\\textcolor{##f5f9e8}{#1}");U("\\mintB","\\textcolor{##edf2df}{#1}");U("\\mintC","\\textcolor{##e0e5cc}{#1}");U("\\grayA","\\textcolor{##f6f7f7}{#1}");U("\\grayB","\\textcolor{##f0f1f2}{#1}");U("\\grayC","\\textcolor{##e3e5e6}{#1}");U("\\grayD","\\textcolor{##d6d8da}{#1}");U("\\grayE","\\textcolor{##babec2}{#1}");U("\\grayF","\\textcolor{##888d93}{#1}");U("\\grayG","\\textcolor{##626569}{#1}");U("\\grayH","\\textcolor{##3b3e40}{#1}");U("\\grayI","\\textcolor{##21242c}{#1}");U("\\kaBlue","\\textcolor{##314453}{#1}");U("\\kaGreen","\\textcolor{##71B307}{#1}");var SX={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class KTe{constructor(e,t,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new GTe(WTe,t.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new YF(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,r,s;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;t=this.popToken(),{tokens:s,end:r}=this.consumeArg(["]"])}else({tokens:s,start:t,end:r}=this.consumeArg());return this.pushToken(new ha("EOF",r.loc)),this.pushTokens(s),new ha("",_o.range(t,r))}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var t=[],r=e&&e.length>0;r||this.consumeSpaces();var s=this.future(),i,o=0,a=0;do{if(i=this.popToken(),t.push(i),i.text==="{")++o;else if(i.text==="}"){if(--o,o===-1)throw new _e("Extra }",i)}else if(i.text==="EOF")throw new _e("Unexpected end of input in a macro argument, expected '"+(e&&r?e[a]:"}")+"'",i);if(e&&r)if((o===0||o===1&&e[a]==="{")&&i.text===e[a]){if(++a,a===e.length){t.splice(-a,a);break}}else a=0}while(o!==0||r);return s.text==="{"&&t[t.length-1].text==="}"&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:s,end:i}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new _e("The length of delimiters doesn't match the number of args!");for(var r=t[0],s=0;s<r.length;s++){var i=this.popToken();if(r[s]!==i.text)throw new _e("Use of the macro doesn't match its definition",i)}}for(var o=[],a=0;a<e;a++)o.push(this.consumeArg(t&&t[a+1]).tokens);return o}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new _e("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),r=t.text,s=t.noexpand?null:this._getExpansion(r);if(s==null||e&&s.unexpandable){if(e&&s==null&&r[0]==="\\"&&!this.isDefined(r))throw new _e("Undefined control sequence: "+r);return this.pushToken(t),!1}this.countExpansion(1);var i=s.tokens,o=this.consumeArgs(s.numArgs,s.delimiters);if(s.numArgs){i=i.slice();for(var a=i.length-1;a>=0;--a){var l=i[a];if(l.text==="#"){if(a===0)throw new _e("Incomplete placeholder at end of macro body",l);if(l=i[--a],l.text==="#")i.splice(a+1,1);else if(/^[1-9]$/.test(l.text))i.splice(a,2,...o[+l.text-1]);else throw new _e("Not a valid argument number",l)}}}return this.pushTokens(i),i.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new ha(e)]):void 0}expandTokens(e){var t=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;)if(this.expandOnce(!0)===!1){var s=this.stack.pop();s.treatAsRelax&&(s.noexpand=!1,s.treatAsRelax=!1),t.push(s)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t&&t.map(r=>r.text).join("")}_getExpansion(e){var t=this.macros.get(e);if(t==null)return t;if(e.length===1){var r=this.lexer.catcodes[e];if(r!=null&&r!==13)return}var s=typeof t=="function"?t(this):t;if(typeof s=="string"){var i=0;if(s.indexOf("#")!==-1)for(var o=s.replace(/##/g,"");o.indexOf("#"+(i+1))!==-1;)++i;for(var a=new YF(s,this.settings),l=[],c=a.lex();c.text!=="EOF";)l.push(c),c=a.lex();l.reverse();var u={tokens:l,numArgs:i};return u}return s}isDefined(e){return this.macros.has(e)||Ih.hasOwnProperty(e)||Kn.math.hasOwnProperty(e)||Kn.text.hasOwnProperty(e)||SX.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return t!=null?typeof t=="string"||typeof t=="function"||!t.unexpandable:Ih.hasOwnProperty(e)&&!Ih[e].primitive}}var QF=/^[]/,y4=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"a","":"e","":"h","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"v","":"x","":"","":"","":"","":"","":"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"A","":"B","":"D","":"E","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"T","":"U","":"V","":"W","":"a","":"b","":"c","":"d","":"e","":"f","":"g",:"h","":"i",:"j","":"k",:"l","":"m",:"n","":"o","":"p",:"r",:"s","":"t","":"u","":"v",:"w",:"x",:"y","":"z","":"","":"","":"","":"","":"","":""}),ZA={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},ZF={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};class IS{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new KTe(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(t===void 0&&(t=!0),this.fetch().text!==e)throw new _e("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new ha("}")),this.gullet.pushTokens(e);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,r}parseExpression(e,t){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var s=this.fetch();if(IS.endOfExpression.indexOf(s.text)!==-1||t&&s.text===t||e&&Ih[s.text]&&Ih[s.text].infix)break;var i=this.parseAtom(t);if(i){if(i.type==="internal")continue}else break;r.push(i)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(e){for(var t=-1,r,s=0;s<e.length;s++)if(e[s].type==="infix"){if(t!==-1)throw new _e("only one infix operator per group",e[s].token);t=s,r=e[s].replaceWith}if(t!==-1&&r){var i,o,a=e.slice(0,t),l=e.slice(t+1);a.length===1&&a[0].type==="ordgroup"?i=a[0]:i={type:"ordgroup",mode:this.mode,body:a},l.length===1&&l[0].type==="ordgroup"?o=l[0]:o={type:"ordgroup",mode:this.mode,body:l};var c;return r==="\\\\abovefrac"?c=this.callFunction(r,[i,e[t],o],[]):c=this.callFunction(r,[i,o],[]),[c]}else return e}handleSupSubscript(e){var t=this.fetch(),r=t.text;this.consume(),this.consumeSpaces();var s;do{var i;s=this.parseGroup(e)}while(((i=s)==null?void 0:i.type)==="internal");if(!s)throw new _e("Expected group after '"+r+"'",t);return s}formatUnsupportedCmd(e){for(var t=[],r=0;r<e.length;r++)t.push({type:"textord",mode:"text",text:e[r]});var s={type:"text",mode:this.mode,body:t},i={type:"color",mode:this.mode,color:this.settings.errorColor,body:[s]};return i}parseAtom(e){var t=this.parseGroup("atom",e);if((t==null?void 0:t.type)==="internal"||this.mode==="text")return t;for(var r,s;;){this.consumeSpaces();var i=this.fetch();if(i.text==="\\limits"||i.text==="\\nolimits"){if(t&&t.type==="op"){var o=i.text==="\\limits";t.limits=o,t.alwaysHandleSupSub=!0}else if(t&&t.type==="operatorname")t.alwaysHandleSupSub&&(t.limits=i.text==="\\limits");else throw new _e("Limit controls must follow a math operator",i);this.consume()}else if(i.text==="^"){if(r)throw new _e("Double superscript",i);r=this.handleSupSubscript("superscript")}else if(i.text==="_"){if(s)throw new _e("Double subscript",i);s=this.handleSupSubscript("subscript")}else if(i.text==="'"){if(r)throw new _e("Double superscript",i);var a={type:"textord",mode:this.mode,text:"\\prime"},l=[a];for(this.consume();this.fetch().text==="'";)l.push(a),this.consume();this.fetch().text==="^"&&l.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:l}}else if(y4[i.text]){var c=QF.test(i.text),u=[];for(u.push(new ha(y4[i.text])),this.consume();;){var h=this.fetch().text;if(!y4[h]||QF.test(h)!==c)break;u.unshift(new ha(y4[h])),this.consume()}var f=this.subparse(u);c?s={type:"ordgroup",mode:"math",body:f}:r={type:"ordgroup",mode:"math",body:f}}else break}return r||s?{type:"supsub",mode:this.mode,base:t,sup:r,sub:s}:t}parseFunction(e,t){var r=this.fetch(),s=r.text,i=Ih[s];if(!i)return null;if(this.consume(),t&&t!=="atom"&&!i.allowedInArgument)throw new _e("Got function '"+s+"' with no arguments"+(t?" as "+t:""),r);if(this.mode==="text"&&!i.allowedInText)throw new _e("Can't use function '"+s+"' in text mode",r);if(this.mode==="math"&&i.allowedInMath===!1)throw new _e("Can't use function '"+s+"' in math mode",r);var{args:o,optArgs:a}=this.parseArguments(s,i);return this.callFunction(s,o,a,r,e)}callFunction(e,t,r,s,i){var o={funcName:e,parser:this,token:s,breakOnTokenText:i},a=Ih[e];if(a&&a.handler)return a.handler(o,t,r);throw new _e("No function handler for "+e)}parseArguments(e,t){var r=t.numArgs+t.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var s=[],i=[],o=0;o<r;o++){var a=t.argTypes&&t.argTypes[o],l=o<t.numOptionalArgs;(t.primitive&&a==null||t.type==="sqrt"&&o===1&&i[0]==null)&&(a="primitive");var c=this.parseGroupOfType("argument to '"+e+"'",a,l);if(l)i.push(c);else if(c!=null)s.push(c);else throw new _e("Null argument, please report this as a bug")}return{args:s,optArgs:i}}parseGroupOfType(e,t,r){switch(t){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,t);case"hbox":{var s=this.parseArgumentGroup(r,"text");return s!=null?{type:"styling",mode:s.mode,body:[s],style:"text"}:null}case"raw":{var i=this.parseStringGroup("raw",r);return i!=null?{type:"raw",mode:"text",string:i.text}:null}case"primitive":{if(r)throw new _e("A primitive argument cannot be optional");var o=this.parseGroup(e);if(o==null)throw new _e("Expected group as "+e,this.fetch());return o}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new _e("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,t){var r=this.gullet.scanArgument(t);if(r==null)return null;for(var s="",i;(i=this.fetch()).text!=="EOF";)s+=i.text,this.consume();return this.consume(),r.text=s,r}parseRegexGroup(e,t){for(var r=this.fetch(),s=r,i="",o;(o=this.fetch()).text!=="EOF"&&e.test(i+o.text);)s=o,i+=s.text,this.consume();if(i==="")throw new _e("Invalid "+t+": '"+r.text+"'",r);return r.range(s,i)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(t==null)return null;var r=/^(#[a-f0-9]{3,4}|#[a-f0-9]{6}|#[a-f0-9]{8}|[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!r)throw new _e("Invalid color: '"+t.text+"'",t);var s=r[0];return/^[0-9a-f]{6}$/i.test(s)&&(s="#"+s),{type:"color-token",mode:this.mode,color:s}}parseSizeGroup(e){var t,r=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?t=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):t=this.parseStringGroup("size",e),!t)return null;!e&&t.text.length===0&&(t.text="0pt",r=!0);var s=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!s)throw new _e("Invalid size: '"+t.text+"'",t);var i={number:+(s[1]+s[2]),unit:s[3]};if(!LY(i))throw new _e("Invalid unit: '"+i.unit+"'",t);return{type:"size",mode:this.mode,value:i,isBlank:r}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),t==null)return null;var r=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,t){var r=this.gullet.scanArgument(e);if(r==null)return null;var s=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var i=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var o={type:"ordgroup",mode:this.mode,loc:r.loc,body:i};return t&&this.switchMode(s),o}parseGroup(e,t){var r=this.fetch(),s=r.text,i;if(s==="{"||s==="\\begingroup"){this.consume();var o=s==="{"?"}":"\\endgroup";this.gullet.beginGroup();var a=this.parseExpression(!1,o),l=this.fetch();this.expect(o),this.gullet.endGroup(),i={type:"ordgroup",mode:this.mode,loc:_o.range(r,l),body:a,semisimple:s==="\\begingroup"||void 0}}else if(i=this.parseFunction(t,e)||this.parseSymbol(),i==null&&s[0]==="\\"&&!SX.hasOwnProperty(s)){if(this.settings.throwOnError)throw new _e("Undefined control sequence: "+s,r);i=this.formatUnsupportedCmd(s),this.consume()}return i}formLigatures(e){for(var t=e.length-1,r=0;r<t;++r){var s=e[r],i=s.text;i==="-"&&e[r+1].text==="-"&&(r+1<t&&e[r+2].text==="-"?(e.splice(r,3,{type:"textord",mode:"text",loc:_o.range(s,e[r+2]),text:"---"}),t-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:_o.range(s,e[r+1]),text:"--"}),t-=1)),(i==="'"||i==="`")&&e[r+1].text===i&&(e.splice(r,2,{type:"textord",mode:"text",loc:_o.range(s,e[r+1]),text:i+i}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var r=t.slice(5),s=r.charAt(0)==="*";if(s&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new _e(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:s}}ZF.hasOwnProperty(t[0])&&!Kn[this.mode][t[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=ZF[t[0]]+t.slice(1));var i=HTe.exec(t);i&&(t=t.substring(0,i.index),t==="i"?t="":t==="j"&&(t=""));var o;if(Kn[this.mode][t]){this.settings.strict&&this.mode==="math"&&YC.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var a=Kn[this.mode][t].group,l=_o.range(e),c;if(jSe.hasOwnProperty(a)){var u=a;c={type:"atom",mode:this.mode,family:u,loc:l,text:t}}else c={type:a,mode:this.mode,loc:l,text:t};o=c}else if(t.charCodeAt(0)>=128)this.settings.strict&&(PY(t.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'"'+(" ("+t.charCodeAt(0)+")"),e)),o={type:"textord",mode:"text",loc:_o.range(e),text:t};else return null;if(this.consume(),i)for(var h=0;h<i[0].length;h++){var f=i[0][h];if(!ZA[f])throw new _e("Unknown accent ' "+f+"'",e);var p=ZA[f][this.mode]||ZA[f].text;if(!p)throw new _e("Accent "+f+" unsupported in "+this.mode+" mode",e);o={type:"accent",mode:this.mode,loc:_o.range(e),label:p,isStretchy:!1,isShifty:!0,base:o}}return o}}IS.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var tM=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new IS(e,t);delete r.gullet.macros.current["\\df@tag"];var s=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new _e("\\tag works only in display equations");s=[{type:"tag",mode:"text",body:s,tag:r.subparse([new ha("\\df@tag")])}]}return s},TX=function(e,t,r){t.textContent="";var s=nM(e,r).toNode();t.appendChild(s)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),TX=function(){throw new _e("KaTeX doesn't work in quirks mode.")});var YTe=function(e,t){var r=nM(e,t).toMarkup();return r},XTe=function(e,t){var r=new OR(t);return tM(e,r)},AX=function(e,t,r){if(r.throwOnError||!(e instanceof _e))throw e;var s=ie.makeSpan(["katex-error"],[new rl(t)]);return s.setAttribute("title",e.toString()),s.setAttribute("style","color:"+r.errorColor),s},nM=function(e,t){var r=new OR(t);try{var s=tM(e,r);return iTe(s,e,r)}catch(i){return AX(i,e,r)}},JTe=function(e,t){var r=new OR(t);try{var s=tM(e,r);return oTe(s,e,r)}catch(i){return AX(i,e,r)}},QTe="0.16.27",ZTe={Span:a2,Anchor:BR,SymbolNode:rl,SvgNode:od,PathNode:df,LineNode:KC},ez={version:QTe,render:TX,renderToString:YTe,ParseError:_e,SETTINGS_SCHEMA:tk,__parse:XTe,__renderToDomTree:nM,__renderToHTMLTree:JTe,__setFontMetrics:CSe,__defineSymbol:_,__defineFunction:Pe,__defineMacro:U,__domTree:ZTe};const eAe={};function tAe(n){const e=this,t=n||eAe,r=e.data(),s=r.micromarkExtensions||(r.micromarkExtensions=[]),i=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),o=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);s.push(eSe(t)),i.push(G3e()),o.push(W3e(t))}const tz=/[#.]/g;function nAe(n,e){const t=n||"",r={};let s=0,i,o;for(;s<t.length;){tz.lastIndex=s;const a=tz.exec(t),l=t.slice(s,a?a.index:t.length);l&&(i?i==="#"?r.id=l:Array.isArray(r.className)?r.className.push(l):r.className=[l]:o=l,s+=l.length),a&&(i=a[0],s++)}return{type:"element",tagName:o||e||"div",properties:r,children:[]}}function EX(n,e,t){const r=t?oAe(t):void 0;function s(i,o,...a){let l;if(i==null){l={type:"root",children:[]};const c=o;a.unshift(c)}else{l=nAe(i,e);const c=l.tagName.toLowerCase(),u=r?r.get(c):void 0;if(l.tagName=u||c,rAe(o))a.unshift(o);else for(const[h,f]of Object.entries(o))sAe(n,l.properties,h,f)}for(const c of a)tN(l.children,c);return l.type==="element"&&l.tagName==="template"&&(l.content={type:"root",children:l.children},l.children=[]),l}return s}function rAe(n){if(n===null||typeof n!="object"||Array.isArray(n))return!0;if(typeof n.type!="string")return!1;const e=n,t=Object.keys(n);for(const r of t){const s=e[r];if(s&&typeof s=="object"){if(!Array.isArray(s))return!0;const i=s;for(const o of i)if(typeof o!="number"&&typeof o!="string")return!0}}return!!("children"in n&&Array.isArray(n.children))}function sAe(n,e,t,r){const s=eY(n,t);let i;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;i=r}else typeof r=="boolean"?i=r:typeof r=="string"?s.spaceSeparated?i=LO(r):s.commaSeparated?i=NO(r):s.commaOrSpaceSeparated?i=LO(NO(r).join(" ")):i=nz(s,s.property,r):Array.isArray(r)?i=[...r]:i=s.property==="style"?iAe(r):String(r);if(Array.isArray(i)){const o=[];for(const a of i)o.push(nz(s,s.property,a));i=o}s.property==="className"&&Array.isArray(e.className)&&(i=e.className.concat(i)),e[s.property]=i}}function tN(n,e){if(e!=null)if(typeof e=="number"||typeof e=="string")n.push({type:"text",value:String(e)});else if(Array.isArray(e))for(const t of e)tN(n,t);else if(typeof e=="object"&&"type"in e)e.type==="root"?tN(n,e.children):n.push(e);else throw new Error("Expected node, nodes, or string, got `"+e+"`")}function nz(n,e,t){if(typeof t=="string"){if(n.number&&t&&!Number.isNaN(Number(t)))return Number(t);if((n.boolean||n.overloadedBoolean)&&(t===""||zb(t)===zb(e)))return!0}return t}function iAe(n){const e=[];for(const[t,r]of Object.entries(n))e.push([t,r].join(": "));return e.join("; ")}function oAe(n){const e=new Map;for(const t of n)e.set(t.toLowerCase(),t);return e}const aAe=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],lAe=EX(tY,"div"),cAe=EX(xS,"g",aAe),eE={html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg"};function uAe(n,e){return CX(n,{})||{type:"root",children:[]}}function CX(n,e){const t=dAe(n,e);return t&&e.afterTransform&&e.afterTransform(n,t),t}function dAe(n,e){switch(n.nodeType){case 1:return mAe(n,e);case 3:return fAe(n);case 8:return pAe(n);case 9:return rz(n,e);case 10:return hAe();case 11:return rz(n,e);default:return}}function rz(n,e){return{type:"root",children:NX(n,e)}}function hAe(){return{type:"doctype"}}function fAe(n){return{type:"text",value:n.nodeValue||""}}function pAe(n){return{type:"comment",value:n.nodeValue||""}}function mAe(n,e){const t=n.namespaceURI,r=t===eE.svg?cAe:lAe,s=t===eE.html?n.tagName.toLowerCase():n.tagName,i=t===eE.html&&s==="template"?n.content:n,o=n.getAttributeNames(),a={};let l=-1;for(;++l<o.length;)a[o[l]]=n.getAttribute(o[l])||"";return r(s,a,NX(i,e))}function NX(n,e){const t=n.childNodes,r=[];let s=-1;for(;++s<t.length;){const i=CX(t[s],e);i!==void 0&&r.push(i)}return r}new DOMParser;function gAe(n,e){const t=yAe(n);return uAe(t)}function yAe(n){const e=document.createElement("template");return e.innerHTML=n,e.content}const sz=function(n,e,t){const r=s2(t);if(!n||!n.type||!n.children)throw new Error("Expected parent node");if(typeof e=="number"){if(e<0||e===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(e=n.children.indexOf(e),e<0)throw new Error("Expected child node or index");for(;++e<n.children.length;)if(r(n.children[e],e,n))return n.children[e]},nm=function(n){if(n==null)return vAe;if(typeof n=="string")return bAe(n);if(typeof n=="object")return xAe(n);if(typeof n=="function")return rM(n);throw new Error("Expected function, string, or array as `test`")};function xAe(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=nm(n[t]);return rM(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function bAe(n){return rM(e);function e(t){return t.tagName===n}}function rM(n){return e;function e(t,r,s){return!!(wAe(t)&&n.call(this,t,typeof r=="number"?r:void 0,s||void 0))}}function vAe(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="element"&&"tagName"in n&&typeof n.tagName=="string")}function wAe(n){return n!==null&&typeof n=="object"&&"type"in n&&"tagName"in n}const iz=/\n/g,oz=/[\t ]+/g,nN=nm("br"),az=nm(NAe),kAe=nm("p"),lz=nm("tr"),_Ae=nm(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",CAe,IAe]),IX=nm(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function SAe(n,e){const t=e||{},r="children"in n?n.children:[],s=IX(n),i=PX(n,{whitespace:t.whitespace||"normal"}),o=[];(n.type==="text"||n.type==="comment")&&o.push(...MX(n,{breakBefore:!0,breakAfter:!0}));let a=-1;for(;++a<r.length;)o.push(...RX(r[a],n,{whitespace:i,breakBefore:a?void 0:s,breakAfter:a<r.length-1?nN(r[a+1]):s}));const l=[];let c;for(a=-1;++a<o.length;){const u=o[a];typeof u=="number"?c!==void 0&&u>c&&(c=u):u&&(c!==void 0&&c>-1&&l.push(`
`.repeat(c)||" "),c=-1,l.push(u))}return l.join("")}function RX(n,e,t){return n.type==="element"?TAe(n,e,t):n.type==="text"?t.whitespace==="normal"?MX(n,t):AAe(n):[]}function TAe(n,e,t){const r=PX(n,t),s=n.children||[];let i=-1,o=[];if(_Ae(n))return o;let a,l;for(nN(n)||lz(n)&&sz(e,n,lz)?l=`
`:kAe(n)?(a=2,l=2):IX(n)&&(a=1,l=1);++i<s.length;)o=o.concat(RX(s[i],n,{whitespace:r,breakBefore:i?void 0:a,breakAfter:i<s.length-1?nN(s[i+1]):l}));return az(n)&&sz(e,n,az)&&o.push("	"),a&&o.unshift(a),l&&o.push(l),o}function MX(n,e){const t=String(n.value),r=[],s=[];let i=0;for(;i<=t.length;){iz.lastIndex=i;const l=iz.exec(t),c=l&&"index"in l?l.index:t.length;r.push(EAe(t.slice(i,c).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),i===0?e.breakBefore:!0,c===t.length?e.breakAfter:!0)),i=c+1}let o=-1,a;for(;++o<r.length;)r[o].charCodeAt(r[o].length-1)===8203||o<r.length-1&&r[o+1].charCodeAt(0)===8203?(s.push(r[o]),a=void 0):r[o]?(typeof a=="number"&&s.push(a),s.push(r[o]),a=0):(o===0||o===r.length-1)&&s.push(0);return s}function AAe(n){return[String(n.value)]}function EAe(n,e,t){const r=[];let s=0,i;for(;s<n.length;){oz.lastIndex=s;const o=oz.exec(n);i=o?o.index:n.length,!s&&!i&&o&&!e&&r.push(""),s!==i&&r.push(n.slice(s,i)),s=o?i+o[0].length:i}return s!==i&&!t&&r.push(""),r.join(" ")}function PX(n,e){if(n.type==="element"){const t=n.properties||{};switch(n.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return t.wrap?"pre-wrap":"pre";case"td":case"th":return t.noWrap?"nowrap":e.whitespace;case"textarea":return"pre-wrap"}}return e.whitespace}function CAe(n){return!!(n.properties||{}).hidden}function NAe(n){return n.tagName==="td"||n.tagName==="th"}function IAe(n){return n.tagName==="dialog"&&!(n.properties||{}).open}const RAe={},MAe=[];function PAe(n){const e=n||RAe;return function(t,r){LR(t,"element",function(s,i){const o=Array.isArray(s.properties.className)?s.properties.className:MAe,a=o.includes("language-math"),l=o.includes("math-display"),c=o.includes("math-inline");let u=l;if(!a&&!l&&!c)return;let h=i[i.length-1],f=s;if(s.tagName==="code"&&a&&h&&h.type==="element"&&h.tagName==="pre"&&(f=h,h=i[i.length-2],u=!0),!h)return;const p=SAe(f,{whitespace:"pre"});let g;try{g=ez.renderToString(p,{...e,displayMode:u,throwOnError:!0})}catch(v){const b=v,w=b.name.toLowerCase();r.message("Could not render math with KaTeX",{ancestors:[...i,s],cause:b,place:s.position,ruleId:w,source:"rehype-katex"});try{g=ez.renderToString(p,{...e,displayMode:u,strict:"ignore",throwOnError:!1})}catch{g=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(e.errorColor||"#cc0000"),title:String(v)},children:[{type:"text",value:p}]}]}}typeof g=="string"&&(g=gAe(g).children);const y=h.children.indexOf(f);return h.children.splice(y,1,...g),CY})}}function cz(n,e){const t=String(n);if(typeof e!="string")throw new TypeError("Expected character");let r=0,s=t.indexOf(e);for(;s!==-1;)r++,s=t.indexOf(e,s+e.length);return r}function LAe(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function DAe(n,e,t){const s=s2((t||{}).ignore||[]),i=jAe(e);let o=-1;for(;++o<i.length;)LR(n,"text",a);function a(c,u){let h=-1,f;for(;++h<u.length;){const p=u[h],g=f?f.children:void 0;if(s(p,g?g.indexOf(p):void 0,f))return;f=p}if(f)return l(c,u)}function l(c,u){const h=u[u.length-1],f=i[o][0],p=i[o][1];let g=0;const v=h.children.indexOf(c);let b=!1,w=[];f.lastIndex=0;let k=f.exec(c.value);for(;k;){const T=k.index,R={index:k.index,input:k.input,stack:[...u,c]};let M=p(...k,R);if(typeof M=="string"&&(M=M.length>0?{type:"text",value:M}:void 0),M===!1?f.lastIndex=T+1:(g!==T&&w.push({type:"text",value:c.value.slice(g,T)}),Array.isArray(M)?w.push(...M):M&&w.push(M),g=T+k[0].length,b=!0),!f.global)break;k=f.exec(c.value)}return b?(g<c.value.length&&w.push({type:"text",value:c.value.slice(g)}),h.children.splice(v,1,...w)):w=[c],v+w.length}}function jAe(n){const e=[];if(!Array.isArray(n))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!n[0]||Array.isArray(n[0])?n:[n];let r=-1;for(;++r<t.length;){const s=t[r];e.push([OAe(s[0]),FAe(s[1])])}return e}function OAe(n){return typeof n=="string"?new RegExp(LAe(n),"g"):n}function FAe(n){return typeof n=="function"?n:function(){return n}}const tE="phrasing",nE=["autolink","link","image","label"];function zAe(){return{transforms:[GAe],enter:{literalAutolink:$Ae,literalAutolinkEmail:rE,literalAutolinkHttp:rE,literalAutolinkWww:rE},exit:{literalAutolink:qAe,literalAutolinkEmail:HAe,literalAutolinkHttp:VAe,literalAutolinkWww:UAe}}}function BAe(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:tE,notInConstruct:nE},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:tE,notInConstruct:nE},{character:":",before:"[ps]",after:"\\/",inConstruct:tE,notInConstruct:nE}]}}function $Ae(n){this.enter({type:"link",title:null,url:"",children:[]},n)}function rE(n){this.config.enter.autolinkProtocol.call(this,n)}function VAe(n){this.config.exit.autolinkProtocol.call(this,n)}function UAe(n){this.config.exit.data.call(this,n);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(n)}function HAe(n){this.config.exit.autolinkEmail.call(this,n)}function qAe(n){this.exit(n)}function GAe(n){DAe(n,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,WAe],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),KAe]],{ignore:["link","linkReference"]})}function WAe(n,e,t,r,s){let i="";if(!LX(s)||(/^w/i.test(e)&&(t=e+t,e="",i="http://"),!YAe(t)))return!1;const o=XAe(t+r);if(!o[0])return!1;const a={type:"link",title:null,url:i+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function KAe(n,e,t,r){return!LX(r,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+t,children:[{type:"text",value:e+"@"+t}]}}function YAe(n){const e=n.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function XAe(n){const e=/[!"&'),.:;<>?\]}]+$/.exec(n);if(!e)return[n,void 0];n=n.slice(0,e.index);let t=e[0],r=t.indexOf(")");const s=cz(n,"(");let i=cz(n,")");for(;r!==-1&&s>i;)n+=t.slice(0,r+1),t=t.slice(r+1),r=t.indexOf(")"),i++;return[n,t]}function LX(n,e){const t=n.input.charCodeAt(n.index-1);return(n.index===0||j0(t)||vS(t))&&(!e||t!==47)}DX.peek=iEe;function JAe(){this.buffer()}function QAe(n){this.enter({type:"footnoteReference",identifier:"",label:""},n)}function ZAe(){this.buffer()}function eEe(n){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},n)}function tEe(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Ol(this.sliceSerialize(n)).toLowerCase(),t.label=e}function nEe(n){this.exit(n)}function rEe(n){const e=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Ol(this.sliceSerialize(n)).toLowerCase(),t.label=e}function sEe(n){this.exit(n)}function iEe(){return"["}function DX(n,e,t,r){const s=t.createTracker(r);let i=s.move("[^");const o=t.enter("footnoteReference"),a=t.enter("reference");return i+=s.move(t.safe(t.associationId(n),{after:"]",before:i})),a(),o(),i+=s.move("]"),i}function oEe(){return{enter:{gfmFootnoteCallString:JAe,gfmFootnoteCall:QAe,gfmFootnoteDefinitionLabelString:ZAe,gfmFootnoteDefinition:eEe},exit:{gfmFootnoteCallString:tEe,gfmFootnoteCall:nEe,gfmFootnoteDefinitionLabelString:rEe,gfmFootnoteDefinition:sEe}}}function aEe(n){let e=!1;return n&&n.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:t,footnoteReference:DX},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(r,s,i,o){const a=i.createTracker(o);let l=a.move("[^");const c=i.enter("footnoteDefinition"),u=i.enter("label");return l+=a.move(i.safe(i.associationId(r),{before:l,after:"]"})),u(),l+=a.move("]:"),r.children&&r.children.length>0&&(a.shift(4),l+=a.move((e?`
`:" ")+i.indentLines(i.containerFlow(r,a.current()),e?jX:lEe))),c(),l}}function lEe(n,e,t){return e===0?n:jX(n,e,t)}function jX(n,e,t){return(t?"":"    ")+n}const cEe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];OX.peek=pEe;function uEe(){return{canContainEols:["delete"],enter:{strikethrough:hEe},exit:{strikethrough:fEe}}}function dEe(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:cEe}],handlers:{delete:OX}}}function hEe(n){this.enter({type:"delete",children:[]},n)}function fEe(n){this.exit(n)}function OX(n,e,t,r){const s=t.createTracker(r),i=t.enter("strikethrough");let o=s.move("~~");return o+=t.containerPhrasing(n,{...s.current(),before:o,after:"~"}),o+=s.move("~~"),i(),o}function pEe(){return"~"}function mEe(n){return n.length}function gEe(n,e){const t=e||{},r=(t.align||[]).concat(),s=t.stringLength||mEe,i=[],o=[],a=[],l=[];let c=0,u=-1;for(;++u<n.length;){const y=[],v=[];let b=-1;for(n[u].length>c&&(c=n[u].length);++b<n[u].length;){const w=yEe(n[u][b]);if(t.alignDelimiters!==!1){const k=s(w);v[b]=k,(l[b]===void 0||k>l[b])&&(l[b]=k)}y.push(w)}o[u]=y,a[u]=v}let h=-1;if(typeof r=="object"&&"length"in r)for(;++h<c;)i[h]=uz(r[h]);else{const y=uz(r);for(;++h<c;)i[h]=y}h=-1;const f=[],p=[];for(;++h<c;){const y=i[h];let v="",b="";y===99?(v=":",b=":"):y===108?v=":":y===114&&(b=":");let w=t.alignDelimiters===!1?1:Math.max(1,l[h]-v.length-b.length);const k=v+"-".repeat(w)+b;t.alignDelimiters!==!1&&(w=v.length+w+b.length,w>l[h]&&(l[h]=w),p[h]=w),f[h]=k}o.splice(1,0,f),a.splice(1,0,p),u=-1;const g=[];for(;++u<o.length;){const y=o[u],v=a[u];h=-1;const b=[];for(;++h<c;){const w=y[h]||"";let k="",T="";if(t.alignDelimiters!==!1){const R=l[h]-(v[h]||0),M=i[h];M===114?k=" ".repeat(R):M===99?R%2?(k=" ".repeat(R/2+.5),T=" ".repeat(R/2-.5)):(k=" ".repeat(R/2),T=k):T=" ".repeat(R)}t.delimiterStart!==!1&&!h&&b.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&w==="")&&(t.delimiterStart!==!1||h)&&b.push(" "),t.alignDelimiters!==!1&&b.push(k),b.push(w),t.alignDelimiters!==!1&&b.push(T),t.padding!==!1&&b.push(" "),(t.delimiterEnd!==!1||h!==c-1)&&b.push("|")}g.push(t.delimiterEnd===!1?b.join("").replace(/ +$/,""):b.join(""))}return g.join(`
`)}function yEe(n){return n==null?"":String(n)}function uz(n){const e=typeof n=="string"?n.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function xEe(n,e,t,r){const s=t.enter("blockquote"),i=t.createTracker(r);i.move("> "),i.shift(2);const o=t.indentLines(t.containerFlow(n,i.current()),bEe);return s(),o}function bEe(n,e,t){return">"+(t?"":" ")+n}function vEe(n,e){return dz(n,e.inConstruct,!0)&&!dz(n,e.notInConstruct,!1)}function dz(n,e,t){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return t;let r=-1;for(;++r<e.length;)if(n.includes(e[r]))return!0;return!1}function hz(n,e,t,r){let s=-1;for(;++s<t.unsafe.length;)if(t.unsafe[s].character===`
`&&vEe(t.stack,t.unsafe[s]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function wEe(n,e){return!!(e.options.fences===!1&&n.value&&!n.lang&&/[^ \r\n]/.test(n.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(n.value))}function kEe(n){const e=n.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function _Ee(n,e,t,r){const s=kEe(t),i=n.value||"",o=s==="`"?"GraveAccent":"Tilde";if(wEe(n,t)){const h=t.enter("codeIndented"),f=t.indentLines(i,SEe);return h(),f}const a=t.createTracker(r),l=s.repeat(Math.max(RY(i,s)+1,3)),c=t.enter("codeFenced");let u=a.move(l);if(n.lang){const h=t.enter(`codeFencedLang${o}`);u+=a.move(t.safe(n.lang,{before:u,after:" ",encode:["`"],...a.current()})),h()}if(n.lang&&n.meta){const h=t.enter(`codeFencedMeta${o}`);u+=a.move(" "),u+=a.move(t.safe(n.meta,{before:u,after:`
`,encode:["`"],...a.current()})),h()}return u+=a.move(`
`),i&&(u+=a.move(i+`
`)),u+=a.move(l),c(),u}function SEe(n,e,t){return(t?"":"    ")+n}function sM(n){const e=n.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function TEe(n,e,t,r){const s=sM(t),i=s==='"'?"Quote":"Apostrophe",o=t.enter("definition");let a=t.enter("label");const l=t.createTracker(r);let c=l.move("[");return c+=l.move(t.safe(t.associationId(n),{before:c,after:"]",...l.current()})),c+=l.move("]: "),a(),!n.url||/[\0- \u007F]/.test(n.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(n.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(n.url,{before:c,after:n.title?" ":`
`,...l.current()}))),a(),n.title&&(a=t.enter(`title${i}`),c+=l.move(" "+s),c+=l.move(t.safe(n.title,{before:c,after:s,...l.current()})),c+=l.move(s),a()),o(),c}function AEe(n){const e=n.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function Ub(n){return"&#x"+n.toString(16).toUpperCase()+";"}function I5(n,e,t){const r=$1(n),s=$1(e);return r===void 0?s===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}FX.peek=EEe;function FX(n,e,t,r){const s=AEe(t),i=t.enter("emphasis"),o=t.createTracker(r),a=o.move(s);let l=o.move(t.containerPhrasing(n,{after:s,before:a,...o.current()}));const c=l.charCodeAt(0),u=I5(r.before.charCodeAt(r.before.length-1),c,s);u.inside&&(l=Ub(c)+l.slice(1));const h=l.charCodeAt(l.length-1),f=I5(r.after.charCodeAt(0),h,s);f.inside&&(l=l.slice(0,-1)+Ub(h));const p=o.move(s);return i(),t.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},a+l+p}function EEe(n,e,t){return t.options.emphasis||"*"}function CEe(n,e){let t=!1;return DR(n,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,VC}),!!((!n.depth||n.depth<3)&&ER(n)&&(e.options.setext||t))}function NEe(n,e,t,r){const s=Math.max(Math.min(6,n.depth||1),1),i=t.createTracker(r);if(CEe(n,t)){const u=t.enter("headingSetext"),h=t.enter("phrasing"),f=t.containerPhrasing(n,{...i.current(),before:`
`,after:`
`});return h(),u(),f+`
`+(s===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const o="#".repeat(s),a=t.enter("headingAtx"),l=t.enter("phrasing");i.move(o+" ");let c=t.containerPhrasing(n,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(c)&&(c=Ub(c.charCodeAt(0))+c.slice(1)),c=c?o+" "+c:o,t.options.closeAtx&&(c+=" "+o),l(),a(),c}zX.peek=IEe;function zX(n){return n.value||""}function IEe(){return"<"}BX.peek=REe;function BX(n,e,t,r){const s=sM(t),i=s==='"'?"Quote":"Apostrophe",o=t.enter("image");let a=t.enter("label");const l=t.createTracker(r);let c=l.move("![");return c+=l.move(t.safe(n.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),a(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(a=t.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(t.safe(n.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=t.enter("destinationRaw"),c+=l.move(t.safe(n.url,{before:c,after:n.title?" ":")",...l.current()}))),a(),n.title&&(a=t.enter(`title${i}`),c+=l.move(" "+s),c+=l.move(t.safe(n.title,{before:c,after:s,...l.current()})),c+=l.move(s),a()),c+=l.move(")"),o(),c}function REe(){return"!"}$X.peek=MEe;function $X(n,e,t,r){const s=n.referenceType,i=t.enter("imageReference");let o=t.enter("label");const a=t.createTracker(r);let l=a.move("![");const c=t.safe(n.alt,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=t.stack;t.stack=[],o=t.enter("reference");const h=t.safe(t.associationId(n),{before:l,after:"]",...a.current()});return o(),t.stack=u,i(),s==="full"||!c||c!==h?l+=a.move(h+"]"):s==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function MEe(){return"!"}VX.peek=PEe;function VX(n,e,t){let r=n.value||"",s="`",i=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(r);)s+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++i<t.unsafe.length;){const o=t.unsafe[i],a=t.compilePattern(o);let l;if(o.atBreak)for(;l=a.exec(r);){let c=l.index;r.charCodeAt(c)===10&&r.charCodeAt(c-1)===13&&c--,r=r.slice(0,c)+" "+r.slice(l.index+1)}}return s+r+s}function PEe(){return"`"}function UX(n,e){const t=ER(n);return!!(!e.options.resourceLink&&n.url&&!n.title&&n.children&&n.children.length===1&&n.children[0].type==="text"&&(t===n.url||"mailto:"+t===n.url)&&/^[a-z][a-z+.-]+:/i.test(n.url)&&!/[\0- <>\u007F]/.test(n.url))}HX.peek=LEe;function HX(n,e,t,r){const s=sM(t),i=s==='"'?"Quote":"Apostrophe",o=t.createTracker(r);let a,l;if(UX(n,t)){const u=t.stack;t.stack=[],a=t.enter("autolink");let h=o.move("<");return h+=o.move(t.containerPhrasing(n,{before:h,after:">",...o.current()})),h+=o.move(">"),a(),t.stack=u,h}a=t.enter("link"),l=t.enter("label");let c=o.move("[");return c+=o.move(t.containerPhrasing(n,{before:c,after:"](",...o.current()})),c+=o.move("]("),l(),!n.url&&n.title||/[\0- \u007F]/.test(n.url)?(l=t.enter("destinationLiteral"),c+=o.move("<"),c+=o.move(t.safe(n.url,{before:c,after:">",...o.current()})),c+=o.move(">")):(l=t.enter("destinationRaw"),c+=o.move(t.safe(n.url,{before:c,after:n.title?" ":")",...o.current()}))),l(),n.title&&(l=t.enter(`title${i}`),c+=o.move(" "+s),c+=o.move(t.safe(n.title,{before:c,after:s,...o.current()})),c+=o.move(s),l()),c+=o.move(")"),a(),c}function LEe(n,e,t){return UX(n,t)?"<":"["}qX.peek=DEe;function qX(n,e,t,r){const s=n.referenceType,i=t.enter("linkReference");let o=t.enter("label");const a=t.createTracker(r);let l=a.move("[");const c=t.containerPhrasing(n,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const u=t.stack;t.stack=[],o=t.enter("reference");const h=t.safe(t.associationId(n),{before:l,after:"]",...a.current()});return o(),t.stack=u,i(),s==="full"||!c||c!==h?l+=a.move(h+"]"):s==="shortcut"?l=l.slice(0,-1):l+=a.move("]"),l}function DEe(){return"["}function iM(n){const e=n.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function jEe(n){const e=iM(n),t=n.options.bulletOther;if(!t)return e==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+t+"`) to be different");return t}function OEe(n){const e=n.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function GX(n){const e=n.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function FEe(n,e,t,r){const s=t.enter("list"),i=t.bulletCurrent;let o=n.ordered?OEe(t):iM(t);const a=n.ordered?o==="."?")":".":jEe(t);let l=e&&t.bulletLastUsed?o===t.bulletLastUsed:!1;if(!n.ordered){const u=n.children?n.children[0]:void 0;if((o==="*"||o==="-")&&u&&(!u.children||!u.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(l=!0),GX(t)===o&&u){let h=-1;for(;++h<n.children.length;){const f=n.children[h];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){l=!0;break}}}}l&&(o=a),t.bulletCurrent=o;const c=t.containerFlow(n,r);return t.bulletLastUsed=o,t.bulletCurrent=i,s(),c}function zEe(n){const e=n.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function BEe(n,e,t,r){const s=zEe(t);let i=t.bulletCurrent||iM(t);e&&e.type==="list"&&e.ordered&&(i=(typeof e.start=="number"&&e.start>-1?e.start:1)+(t.options.incrementListMarker===!1?0:e.children.indexOf(n))+i);let o=i.length+1;(s==="tab"||s==="mixed"&&(e&&e.type==="list"&&e.spread||n.spread))&&(o=Math.ceil(o/4)*4);const a=t.createTracker(r);a.move(i+" ".repeat(o-i.length)),a.shift(o);const l=t.enter("listItem"),c=t.indentLines(t.containerFlow(n,a.current()),u);return l(),c;function u(h,f,p){return f?(p?"":" ".repeat(o))+h:(p?i:i+" ".repeat(o-i.length))+h}}function $Ee(n,e,t,r){const s=t.enter("paragraph"),i=t.enter("phrasing"),o=t.containerPhrasing(n,r);return i(),s(),o}const VEe=s2(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function UEe(n,e,t,r){return(n.children.some(function(o){return VEe(o)})?t.containerPhrasing:t.containerFlow).call(t,n,r)}function HEe(n){const e=n.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}WX.peek=qEe;function WX(n,e,t,r){const s=HEe(t),i=t.enter("strong"),o=t.createTracker(r),a=o.move(s+s);let l=o.move(t.containerPhrasing(n,{after:s,before:a,...o.current()}));const c=l.charCodeAt(0),u=I5(r.before.charCodeAt(r.before.length-1),c,s);u.inside&&(l=Ub(c)+l.slice(1));const h=l.charCodeAt(l.length-1),f=I5(r.after.charCodeAt(0),h,s);f.inside&&(l=l.slice(0,-1)+Ub(h));const p=o.move(s+s);return i(),t.attentionEncodeSurroundingInfo={after:f.outside,before:u.outside},a+l+p}function qEe(n,e,t){return t.options.strong||"*"}function GEe(n,e,t,r){return t.safe(n.value,r)}function WEe(n){const e=n.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function KEe(n,e,t){const r=(GX(t)+(t.options.ruleSpaces?" ":"")).repeat(WEe(t));return t.options.ruleSpaces?r.slice(0,-1):r}const KX={blockquote:xEe,break:hz,code:_Ee,definition:TEe,emphasis:FX,hardBreak:hz,heading:NEe,html:zX,image:BX,imageReference:$X,inlineCode:VX,link:HX,linkReference:qX,list:FEe,listItem:BEe,paragraph:$Ee,root:UEe,strong:WX,text:GEe,thematicBreak:KEe};function YEe(){return{enter:{table:XEe,tableData:fz,tableHeader:fz,tableRow:QEe},exit:{codeText:ZEe,table:JEe,tableData:sE,tableHeader:sE,tableRow:sE}}}function XEe(n){const e=n._align;this.enter({type:"table",align:e.map(function(t){return t==="none"?null:t}),children:[]},n),this.data.inTable=!0}function JEe(n){this.exit(n),this.data.inTable=void 0}function QEe(n){this.enter({type:"tableRow",children:[]},n)}function sE(n){this.exit(n)}function fz(n){this.enter({type:"tableCell",children:[]},n)}function ZEe(n){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,e6e));const t=this.stack[this.stack.length-1];t.type,t.value=e,this.exit(n)}function e6e(n,e){return e==="|"?e:n}function t6e(n){const e=n||{},t=e.tableCellPadding,r=e.tablePipeAlign,s=e.stringLength,i=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:o,tableCell:l,tableRow:a}};function o(p,g,y,v){return c(u(p,y,v),p.align)}function a(p,g,y,v){const b=h(p,y,v),w=c([b]);return w.slice(0,w.indexOf(`
`))}function l(p,g,y,v){const b=y.enter("tableCell"),w=y.enter("phrasing"),k=y.containerPhrasing(p,{...v,before:i,after:i});return w(),b(),k}function c(p,g){return gEe(p,{align:g,alignDelimiters:r,padding:t,stringLength:s})}function u(p,g,y){const v=p.children;let b=-1;const w=[],k=g.enter("table");for(;++b<v.length;)w[b]=h(v[b],g,y);return k(),w}function h(p,g,y){const v=p.children;let b=-1;const w=[],k=g.enter("tableRow");for(;++b<v.length;)w[b]=l(v[b],p,g,y);return k(),w}function f(p,g,y){let v=KX.inlineCode(p,g,y);return y.stack.includes("tableCell")&&(v=v.replace(/\|/g,"\\$&")),v}}function n6e(){return{exit:{taskListCheckValueChecked:pz,taskListCheckValueUnchecked:pz,paragraph:s6e}}}function r6e(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:i6e}}}function pz(n){const e=this.stack[this.stack.length-2];e.type,e.checked=n.type==="taskListCheckValueChecked"}function s6e(n){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const r=t.children[0];if(r&&r.type==="text"){const s=e.children;let i=-1,o;for(;++i<s.length;){const a=s[i];if(a.type==="paragraph"){o=a;break}}o===t&&(r.value=r.value.slice(1),r.value.length===0?t.children.shift():t.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,t.position.start=Object.assign({},r.position.start)))}}this.exit(n)}function i6e(n,e,t,r){const s=n.children[0],i=typeof n.checked=="boolean"&&s&&s.type==="paragraph",o="["+(n.checked?"x":" ")+"] ",a=t.createTracker(r);i&&a.move(o);let l=KX.listItem(n,e,t,{...r,...a.current()});return i&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,c)),l;function c(u){return u+o}}function o6e(){return[zAe(),oEe(),uEe(),YEe(),n6e()]}function a6e(n){return{extensions:[BAe(),aEe(n),dEe(),t6e(n),r6e()]}}const l6e={tokenize:p6e,partial:!0},YX={tokenize:m6e,partial:!0},XX={tokenize:g6e,partial:!0},JX={tokenize:y6e,partial:!0},c6e={tokenize:x6e,partial:!0},QX={name:"wwwAutolink",tokenize:h6e,previous:eJ},ZX={name:"protocolAutolink",tokenize:f6e,previous:tJ},bd={name:"emailAutolink",tokenize:d6e,previous:nJ},Wc={};function u6e(){return{text:Wc}}let jf=48;for(;jf<123;)Wc[jf]=bd,jf++,jf===58?jf=65:jf===91&&(jf=97);Wc[43]=bd;Wc[45]=bd;Wc[46]=bd;Wc[95]=bd;Wc[72]=[bd,ZX];Wc[104]=[bd,ZX];Wc[87]=[bd,QX];Wc[119]=[bd,QX];function d6e(n,e,t){const r=this;let s,i;return o;function o(h){return!rN(h)||!nJ.call(r,r.previous)||oM(r.events)?t(h):(n.enter("literalAutolink"),n.enter("literalAutolinkEmail"),a(h))}function a(h){return rN(h)?(n.consume(h),a):h===64?(n.consume(h),l):t(h)}function l(h){return h===46?n.check(c6e,u,c)(h):h===45||h===95||_i(h)?(i=!0,n.consume(h),l):u(h)}function c(h){return n.consume(h),s=!0,l}function u(h){return i&&s&&qi(r.previous)?(n.exit("literalAutolinkEmail"),n.exit("literalAutolink"),e(h)):t(h)}}function h6e(n,e,t){const r=this;return s;function s(o){return o!==87&&o!==119||!eJ.call(r,r.previous)||oM(r.events)?t(o):(n.enter("literalAutolink"),n.enter("literalAutolinkWww"),n.check(l6e,n.attempt(YX,n.attempt(XX,i),t),t)(o))}function i(o){return n.exit("literalAutolinkWww"),n.exit("literalAutolink"),e(o)}}function f6e(n,e,t){const r=this;let s="",i=!1;return o;function o(h){return(h===72||h===104)&&tJ.call(r,r.previous)&&!oM(r.events)?(n.enter("literalAutolink"),n.enter("literalAutolinkHttp"),s+=String.fromCodePoint(h),n.consume(h),a):t(h)}function a(h){if(qi(h)&&s.length<5)return s+=String.fromCodePoint(h),n.consume(h),a;if(h===58){const f=s.toLowerCase();if(f==="http"||f==="https")return n.consume(h),l}return t(h)}function l(h){return h===47?(n.consume(h),i?c:(i=!0,l)):t(h)}function c(h){return h===null||k5(h)||Bn(h)||j0(h)||vS(h)?t(h):n.attempt(YX,n.attempt(XX,u),t)(h)}function u(h){return n.exit("literalAutolinkHttp"),n.exit("literalAutolink"),e(h)}}function p6e(n,e,t){let r=0;return s;function s(o){return(o===87||o===119)&&r<3?(r++,n.consume(o),s):o===46&&r===3?(n.consume(o),i):t(o)}function i(o){return o===null?t(o):e(o)}}function m6e(n,e,t){let r,s,i;return o;function o(c){return c===46||c===95?n.check(JX,l,a)(c):c===null||Bn(c)||j0(c)||c!==45&&vS(c)?l(c):(i=!0,n.consume(c),o)}function a(c){return c===95?r=!0:(s=r,r=void 0),n.consume(c),o}function l(c){return s||r||!i?t(c):e(c)}}function g6e(n,e){let t=0,r=0;return s;function s(o){return o===40?(t++,n.consume(o),s):o===41&&r<t?i(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?n.check(JX,e,i)(o):o===null||Bn(o)||j0(o)?e(o):(n.consume(o),s)}function i(o){return o===41&&r++,n.consume(o),s}}function y6e(n,e,t){return r;function r(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(n.consume(a),r):a===38?(n.consume(a),i):a===93?(n.consume(a),s):a===60||a===null||Bn(a)||j0(a)?e(a):t(a)}function s(a){return a===null||a===40||a===91||Bn(a)||j0(a)?e(a):r(a)}function i(a){return qi(a)?o(a):t(a)}function o(a){return a===59?(n.consume(a),r):qi(a)?(n.consume(a),o):t(a)}}function x6e(n,e,t){return r;function r(i){return n.consume(i),s}function s(i){return _i(i)?t(i):e(i)}}function eJ(n){return n===null||n===40||n===42||n===95||n===91||n===93||n===126||Bn(n)}function tJ(n){return!qi(n)}function nJ(n){return!(n===47||rN(n))}function rN(n){return n===43||n===45||n===46||n===95||_i(n)}function oM(n){let e=n.length,t=!1;for(;e--;){const r=n[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){t=!0;break}if(r._gfmAutolinkLiteralWalkedInto){t=!1;break}}return n.length>0&&!t&&(n[n.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}const b6e={tokenize:E6e,partial:!0};function v6e(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:S6e,continuation:{tokenize:T6e},exit:A6e}},text:{91:{name:"gfmFootnoteCall",tokenize:_6e},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:w6e,resolveTo:k6e}}}}function w6e(n,e,t){const r=this;let s=r.events.length;const i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o;for(;s--;){const l=r.events[s][1];if(l.type==="labelImage"){o=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return a;function a(l){if(!o||!o._balanced)return t(l);const c=Ol(r.sliceSerialize({start:o.end,end:r.now()}));return c.codePointAt(0)!==94||!i.includes(c.slice(1))?t(l):(n.enter("gfmFootnoteCallLabelMarker"),n.consume(l),n.exit("gfmFootnoteCallLabelMarker"),e(l))}}function k6e(n,e){let t=n.length;for(;t--;)if(n[t][1].type==="labelImage"&&n[t][0]==="enter"){n[t][1];break}n[t+1][1].type="data",n[t+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},n[t+3][1].start),end:Object.assign({},n[n.length-1][1].end)},s={type:"gfmFootnoteCallMarker",start:Object.assign({},n[t+3][1].end),end:Object.assign({},n[t+3][1].end)};s.end.column++,s.end.offset++,s.end._bufferIndex++;const i={type:"gfmFootnoteCallString",start:Object.assign({},s.end),end:Object.assign({},n[n.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},i.start),end:Object.assign({},i.end)},a=[n[t+1],n[t+2],["enter",r,e],n[t+3],n[t+4],["enter",s,e],["exit",s,e],["enter",i,e],["enter",o,e],["exit",o,e],["exit",i,e],n[n.length-2],n[n.length-1],["exit",r,e]];return n.splice(t,n.length-t+1,...a),n}function _6e(n,e,t){const r=this,s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i=0,o;return a;function a(h){return n.enter("gfmFootnoteCall"),n.enter("gfmFootnoteCallLabelMarker"),n.consume(h),n.exit("gfmFootnoteCallLabelMarker"),l}function l(h){return h!==94?t(h):(n.enter("gfmFootnoteCallMarker"),n.consume(h),n.exit("gfmFootnoteCallMarker"),n.enter("gfmFootnoteCallString"),n.enter("chunkString").contentType="string",c)}function c(h){if(i>999||h===93&&!o||h===null||h===91||Bn(h))return t(h);if(h===93){n.exit("chunkString");const f=n.exit("gfmFootnoteCallString");return s.includes(Ol(r.sliceSerialize(f)))?(n.enter("gfmFootnoteCallLabelMarker"),n.consume(h),n.exit("gfmFootnoteCallLabelMarker"),n.exit("gfmFootnoteCall"),e):t(h)}return Bn(h)||(o=!0),i++,n.consume(h),h===92?u:c}function u(h){return h===91||h===92||h===93?(n.consume(h),i++,c):c(h)}}function S6e(n,e,t){const r=this,s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i,o=0,a;return l;function l(g){return n.enter("gfmFootnoteDefinition")._container=!0,n.enter("gfmFootnoteDefinitionLabel"),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(g){return g===94?(n.enter("gfmFootnoteDefinitionMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionMarker"),n.enter("gfmFootnoteDefinitionLabelString"),n.enter("chunkString").contentType="string",u):t(g)}function u(g){if(o>999||g===93&&!a||g===null||g===91||Bn(g))return t(g);if(g===93){n.exit("chunkString");const y=n.exit("gfmFootnoteDefinitionLabelString");return i=Ol(r.sliceSerialize(y)),n.enter("gfmFootnoteDefinitionLabelMarker"),n.consume(g),n.exit("gfmFootnoteDefinitionLabelMarker"),n.exit("gfmFootnoteDefinitionLabel"),f}return Bn(g)||(a=!0),o++,n.consume(g),g===92?h:u}function h(g){return g===91||g===92||g===93?(n.consume(g),o++,u):u(g)}function f(g){return g===58?(n.enter("definitionMarker"),n.consume(g),n.exit("definitionMarker"),s.includes(i)||s.push(i),qt(n,p,"gfmFootnoteDefinitionWhitespace")):t(g)}function p(g){return e(g)}}function T6e(n,e,t){return n.check(r2,e,n.attempt(b6e,e,t))}function A6e(n){n.exit("gfmFootnoteDefinition")}function E6e(n,e,t){const r=this;return qt(n,s,"gfmFootnoteDefinitionIndent",5);function s(i){const o=r.events[r.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?e(i):t(i)}}function C6e(n){let t=(n||{}).singleTilde;const r={name:"strikethrough",tokenize:i,resolveAll:s};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function s(o,a){let l=-1;for(;++l<o.length;)if(o[l][0]==="enter"&&o[l][1].type==="strikethroughSequenceTemporary"&&o[l][1]._close){let c=l;for(;c--;)if(o[c][0]==="exit"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._open&&o[l][1].end.offset-o[l][1].start.offset===o[c][1].end.offset-o[c][1].start.offset){o[l][1].type="strikethroughSequence",o[c][1].type="strikethroughSequence";const u={type:"strikethrough",start:Object.assign({},o[c][1].start),end:Object.assign({},o[l][1].end)},h={type:"strikethroughText",start:Object.assign({},o[c][1].end),end:Object.assign({},o[l][1].start)},f=[["enter",u,a],["enter",o[c][1],a],["exit",o[c][1],a],["enter",h,a]],p=a.parser.constructs.insideSpan.null;p&&da(f,f.length,0,wS(p,o.slice(c+1,l),a)),da(f,f.length,0,[["exit",h,a],["enter",o[l][1],a],["exit",o[l][1],a],["exit",u,a]]),da(o,c-1,l-c+3,f),l=c+f.length-2;break}}for(l=-1;++l<o.length;)o[l][1].type==="strikethroughSequenceTemporary"&&(o[l][1].type="data");return o}function i(o,a,l){const c=this.previous,u=this.events;let h=0;return f;function f(g){return c===126&&u[u.length-1][1].type!=="characterEscape"?l(g):(o.enter("strikethroughSequenceTemporary"),p(g))}function p(g){const y=$1(c);if(g===126)return h>1?l(g):(o.consume(g),h++,p);if(h<2&&!t)return l(g);const v=o.exit("strikethroughSequenceTemporary"),b=$1(g);return v._open=!b||b===2&&!!y,v._close=!y||y===2&&!!b,a(g)}}}class N6e{constructor(){this.map=[]}add(e,t,r){I6e(this,e,t,r)}consume(e){if(this.map.sort(function(i,o){return i[0]-o[0]}),this.map.length===0)return;let t=this.map.length;const r=[];for(;t>0;)t-=1,r.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];r.push(e.slice()),e.length=0;let s=r.pop();for(;s;){for(const i of s)e.push(i);s=r.pop()}this.map.length=0}}function I6e(n,e,t,r){let s=0;if(!(t===0&&r.length===0)){for(;s<n.map.length;){if(n.map[s][0]===e){n.map[s][1]+=t,n.map[s][2].push(...r);return}s+=1}n.map.push([e,t,r])}}function R6e(n,e){let t=!1;const r=[];for(;e<n.length;){const s=n[e];if(t){if(s[0]==="enter")s[1].type==="tableContent"&&r.push(n[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(s[1].type==="tableContent"){if(n[e-1][1].type==="tableDelimiterMarker"){const i=r.length-1;r[i]=r[i]==="left"?"center":"right"}}else if(s[1].type==="tableDelimiterRow")break}else s[0]==="enter"&&s[1].type==="tableDelimiterRow"&&(t=!0);e+=1}return r}function M6e(){return{flow:{null:{name:"table",tokenize:P6e,resolveAll:L6e}}}}function P6e(n,e,t){const r=this;let s=0,i=0,o;return a;function a(N){let P=r.events.length-1;for(;P>-1;){const G=r.events[P][1].type;if(G==="lineEnding"||G==="linePrefix")P--;else break}const O=P>-1?r.events[P][1].type:null,D=O==="tableHead"||O==="tableRow"?M:l;return D===M&&r.parser.lazy[r.now().line]?t(N):D(N)}function l(N){return n.enter("tableHead"),n.enter("tableRow"),c(N)}function c(N){return N===124||(o=!0,i+=1),u(N)}function u(N){return N===null?t(N):Ke(N)?i>1?(i=0,r.interrupt=!0,n.exit("tableRow"),n.enter("lineEnding"),n.consume(N),n.exit("lineEnding"),p):t(N):Wt(N)?qt(n,u,"whitespace")(N):(i+=1,o&&(o=!1,s+=1),N===124?(n.enter("tableCellDivider"),n.consume(N),n.exit("tableCellDivider"),o=!0,u):(n.enter("data"),h(N)))}function h(N){return N===null||N===124||Bn(N)?(n.exit("data"),u(N)):(n.consume(N),N===92?f:h)}function f(N){return N===92||N===124?(n.consume(N),h):h(N)}function p(N){return r.interrupt=!1,r.parser.lazy[r.now().line]?t(N):(n.enter("tableDelimiterRow"),o=!1,Wt(N)?qt(n,g,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(N):g(N))}function g(N){return N===45||N===58?v(N):N===124?(o=!0,n.enter("tableCellDivider"),n.consume(N),n.exit("tableCellDivider"),y):R(N)}function y(N){return Wt(N)?qt(n,v,"whitespace")(N):v(N)}function v(N){return N===58?(i+=1,o=!0,n.enter("tableDelimiterMarker"),n.consume(N),n.exit("tableDelimiterMarker"),b):N===45?(i+=1,b(N)):N===null||Ke(N)?T(N):R(N)}function b(N){return N===45?(n.enter("tableDelimiterFiller"),w(N)):R(N)}function w(N){return N===45?(n.consume(N),w):N===58?(o=!0,n.exit("tableDelimiterFiller"),n.enter("tableDelimiterMarker"),n.consume(N),n.exit("tableDelimiterMarker"),k):(n.exit("tableDelimiterFiller"),k(N))}function k(N){return Wt(N)?qt(n,T,"whitespace")(N):T(N)}function T(N){return N===124?g(N):N===null||Ke(N)?!o||s!==i?R(N):(n.exit("tableDelimiterRow"),n.exit("tableHead"),e(N)):R(N)}function R(N){return t(N)}function M(N){return n.enter("tableRow"),E(N)}function E(N){return N===124?(n.enter("tableCellDivider"),n.consume(N),n.exit("tableCellDivider"),E):N===null||Ke(N)?(n.exit("tableRow"),e(N)):Wt(N)?qt(n,E,"whitespace")(N):(n.enter("data"),I(N))}function I(N){return N===null||N===124||Bn(N)?(n.exit("data"),E(N)):(n.consume(N),N===92?S:I)}function S(N){return N===92||N===124?(n.consume(N),I):I(N)}}function L6e(n,e){let t=-1,r=!0,s=0,i=[0,0,0,0],o=[0,0,0,0],a=!1,l=0,c,u,h;const f=new N6e;for(;++t<n.length;){const p=n[t],g=p[1];p[0]==="enter"?g.type==="tableHead"?(a=!1,l!==0&&(mz(f,e,l,c,u),u=void 0,l=0),c={type:"table",start:Object.assign({},g.start),end:Object.assign({},g.end)},f.add(t,0,[["enter",c,e]])):g.type==="tableRow"||g.type==="tableDelimiterRow"?(r=!0,h=void 0,i=[0,0,0,0],o=[0,t+1,0,0],a&&(a=!1,u={type:"tableBody",start:Object.assign({},g.start),end:Object.assign({},g.end)},f.add(t,0,[["enter",u,e]])),s=g.type==="tableDelimiterRow"?2:u?3:1):s&&(g.type==="data"||g.type==="tableDelimiterMarker"||g.type==="tableDelimiterFiller")?(r=!1,o[2]===0&&(i[1]!==0&&(o[0]=o[1],h=x4(f,e,i,s,void 0,h),i=[0,0,0,0]),o[2]=t)):g.type==="tableCellDivider"&&(r?r=!1:(i[1]!==0&&(o[0]=o[1],h=x4(f,e,i,s,void 0,h)),i=o,o=[i[1],t,0,0])):g.type==="tableHead"?(a=!0,l=t):g.type==="tableRow"||g.type==="tableDelimiterRow"?(l=t,i[1]!==0?(o[0]=o[1],h=x4(f,e,i,s,t,h)):o[1]!==0&&(h=x4(f,e,o,s,t,h)),s=0):s&&(g.type==="data"||g.type==="tableDelimiterMarker"||g.type==="tableDelimiterFiller")&&(o[3]=t)}for(l!==0&&mz(f,e,l,c,u),f.consume(e.events),t=-1;++t<e.events.length;){const p=e.events[t];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=R6e(e.events,t))}return n}function x4(n,e,t,r,s,i){const o=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",a="tableContent";t[0]!==0&&(i.end=Object.assign({},wm(e.events,t[0])),n.add(t[0],0,[["exit",i,e]]));const l=wm(e.events,t[1]);if(i={type:o,start:Object.assign({},l),end:Object.assign({},l)},n.add(t[1],0,[["enter",i,e]]),t[2]!==0){const c=wm(e.events,t[2]),u=wm(e.events,t[3]),h={type:a,start:Object.assign({},c),end:Object.assign({},u)};if(n.add(t[2],0,[["enter",h,e]]),r!==2){const f=e.events[t[2]],p=e.events[t[3]];if(f[1].end=Object.assign({},p[1].end),f[1].type="chunkText",f[1].contentType="text",t[3]>t[2]+1){const g=t[2]+1,y=t[3]-t[2]-1;n.add(g,y,[])}}n.add(t[3]+1,0,[["exit",h,e]])}return s!==void 0&&(i.end=Object.assign({},wm(e.events,s)),n.add(s,0,[["exit",i,e]]),i=void 0),i}function mz(n,e,t,r,s){const i=[],o=wm(e.events,t);s&&(s.end=Object.assign({},o),i.push(["exit",s,e])),r.end=Object.assign({},o),i.push(["exit",r,e]),n.add(t+1,0,i)}function wm(n,e){const t=n[e],r=t[0]==="enter"?"start":"end";return t[1][r]}const D6e={name:"tasklistCheck",tokenize:O6e};function j6e(){return{text:{91:D6e}}}function O6e(n,e,t){const r=this;return s;function s(l){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(l):(n.enter("taskListCheck"),n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),i)}function i(l){return Bn(l)?(n.enter("taskListCheckValueUnchecked"),n.consume(l),n.exit("taskListCheckValueUnchecked"),o):l===88||l===120?(n.enter("taskListCheckValueChecked"),n.consume(l),n.exit("taskListCheckValueChecked"),o):t(l)}function o(l){return l===93?(n.enter("taskListCheckMarker"),n.consume(l),n.exit("taskListCheckMarker"),n.exit("taskListCheck"),a):t(l)}function a(l){return Ke(l)?e(l):Wt(l)?n.check({tokenize:F6e},e,t)(l):t(l)}}function F6e(n,e,t){return qt(n,r,"whitespace");function r(s){return s===null?t(s):e(s)}}function z6e(n){return cY([u6e(),v6e(),C6e(n),M6e(),j6e()])}const B6e={};function $6e(n){const e=this,t=n||B6e,r=e.data(),s=r.micromarkExtensions||(r.micromarkExtensions=[]),i=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),o=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);s.push(z6e(t)),i.push(o6e()),o.push(a6e(t))}function U1({content:n,className:e,components:t}){const r=V.useMemo(()=>n||"",[n]);return r?d.jsx($3e,{className:e,remarkPlugins:[$6e,tAe],rehypePlugins:[PAe],components:t,children:r}):null}const V6e=({block:n,onAnswer:e,initialAnswer:t,isReviewMode:r=!1,isExamMode:s=!1})=>{var w;const[i,o]=V.useState(t||null),[a,l]=V.useState(!!t&&(r||!s)),c=V.useRef(Date.now()),u=V.useRef(0),h=V.useRef(0);V.useEffect(()=>{c.current=Date.now()},[n.id]);const f=k=>{if(!r&&!(a&&!s)&&(o(k),s)){const T=(Date.now()-c.current)/1e3;e(k,{timeSeconds:Math.round(T),attempts:u.current,hintsUsed:h.current,lastAnswer:k})}},p=()=>{if(!i)return;l(!0),u.current+=1;const k=(Date.now()-c.current)/1e3;e(i,{timeSeconds:Math.round(k),attempts:u.current,hintsUsed:h.current,lastAnswer:i})},g=k=>typeof k=="string"?k:k.text,y=r||a&&!s,v=k=>(k==null?void 0:k.includes("$"))||(k==null?void 0:k.includes("\\")),b=k=>v(k)?d.jsx(U1,{content:k,className:"inline"}):d.jsx("span",{children:k});return d.jsxs("div",{className:"mb-8 glass bg-white/80 dark:bg-slate-800/80 p-6 rounded-2xl border border-white/50 dark:border-slate-700 shadow-sm",role:"group","aria-labelledby":`question-${n.id}`,children:[d.jsx("h3",{id:`question-${n.id}`,className:"text-xl font-bold mb-4 text-slate-800 dark:text-white",children:v(n.content.question)?d.jsx(U1,{content:n.content.question}):d.jsx("span",{dangerouslySetInnerHTML:{__html:ko(n.content.question||"")}})}),d.jsx("div",{className:"space-y-3",role:"radiogroup","aria-label":" ",children:(w=n.content.options)==null?void 0:w.map((k,T)=>{const R=g(k),M=i===R,E=R===n.content.correctAnswer,I=M&&!E;let S="w-full text-right p-4 min-h-[44px] rounded-xl border transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 ";return y?E?S+="bg-green-50 dark:bg-green-900/30 border-green-500 text-green-900 dark:text-green-200":I?S+="bg-red-50 dark:bg-red-900/30 border-red-300 text-red-900 dark:text-red-200":S+="opacity-50 dark:opacity-40":S+=M?"border-wizdi-action bg-wizdi-action-light dark:bg-wizdi-action/20 shadow-sm ring-1 ring-wizdi-action/30":"border-gray-200 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700 text-slate-800 dark:text-slate-200",d.jsx("button",{onClick:()=>f(R),className:S,disabled:!!y&&!s,role:"radio","aria-checked":M,"aria-disabled":!!y&&!s,"aria-describedby":y?`feedback-${n.id}-${T}`:void 0,children:d.jsxs("div",{className:"flex justify-between items-center",children:[b(R),y&&E&&d.jsxs(d.Fragment,{children:[d.jsx(br,{className:"w-5 h-5 text-green-600 dark:text-green-400","aria-hidden":"true"}),d.jsx("span",{id:`feedback-${n.id}-${T}`,className:"sr-only",children:" "})]}),y&&I&&d.jsxs(d.Fragment,{children:[d.jsx(No,{className:"w-5 h-5 text-red-600 dark:text-red-400","aria-hidden":"true"}),d.jsx("span",{id:`feedback-${n.id}-${T}`,className:"sr-only",children:" "})]})]})},T)})}),!s&&!y&&!r&&d.jsx("button",{onClick:p,disabled:!i,"aria-disabled":!i,className:"mt-4 text-sm btn-lip-action px-6 py-2 min-h-[44px] rounded-full font-bold disabled:opacity-50 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2",children:" "})]})},rJ=({block:n,onComplete:e,isExamMode:t=!1,hints:r=[],onHintUsed:s})=>{const i=nt.useRef(Date.now()),o=nt.useRef(0),a=nt.useRef(0),l=nt.useMemo(()=>{var Q,re;let O="",D,G;if(typeof n.content=="string")O=n.content;else if(n.content&&typeof n.content=="object"){const ne=n.content;O=ne.sentence||ne.text||"",D=ne.hidden_words,G=ne.distractors}const J=/\[(.*?)\]/.test(O);if(J&&(!D||D.length===0)){const te=(O.match(/\[(.*?)\]/g)||[]).map(ce=>ce.slice(1,-1));return{sentence:O.replace(/\[(.*?)\]/g,"_____"),hidden_words:te,distractors:G||[]}}if((!D||D.length===0)&&!J&&((Q=n.metadata)!=null&&Q.wordBank)){const ne=(O.match(/_____/g)||[]).length;if(ne>0&&n.metadata.wordBank.length>=ne){const te=n.metadata.wordBank.slice(0,ne),H=n.metadata.wordBank.slice(ne);return{sentence:O,hidden_words:te,distractors:H}}}if((!D||D.length===0)&&!J&&(!((re=n.metadata)!=null&&re.wordBank)||n.metadata.wordBank.length===0)){const ne=O.split(" ");if(ne.length>5){const te=[];ne.forEach((xe,W)=>{xe.length>3&&te.length<3&&Math.random()>.7&&te.push(W)}),te.length===0&&te.push(Math.floor(Math.random()*ne.length));const H=[];return{sentence:ne.map((xe,W)=>te.includes(W)?(H.push(xe),"_____"):xe).join(" "),hidden_words:H,distractors:[]}}}return{sentence:O,hidden_words:D||[],distractors:G||[]}},[n.content,n.metadata]),{sentence:c="",hidden_words:u=[],distractors:h=[]}=l||{};console.log("Cloze Debug:",{rawContent:n.content,sentence:c,hidden_words:u,distractors:h});const[f,p]=V.useState([]),[g,y]=V.useState([]),[v,b]=V.useState(!1),[w,k]=V.useState(0),[T,R]=V.useState(!1);V.useEffect(()=>{if(i.current=Date.now(),o.current=0,!c)return;const O=(c.match(/_____/g)||[]).length;p(new Array(O).fill(null));const D=[...u,...h||[]];y(D.sort(()=>Math.random()-.5))},[n,c,u,h]);const M=(O,D)=>{O.dataTransfer.setData("text/plain",D)},E=(O,D)=>{O.preventDefault();const G=O.dataTransfer.getData("text/plain");v||p(J=>{const Q=[...J];return Q[D]=G,Q})},I=O=>{O.preventDefault()},S=O=>{v||p(D=>{const G=[...D];return G[O]=null,G})},N=()=>{R(!0),o.current+=1;let O=0;f.forEach((Q,re)=>{Q===u[re]&&O++});const D=O/u.length,G=D===1,J=Ui.MAX_ATTEMPTS;if(G||o.current>=J){b(!0);const Q=Ww({isCorrect:G,attempts:o.current,hintsUsed:a.current,responseTimeSec:(Date.now()-i.current)/1e3}),re=G?Q:Math.round(Q*D),ne=(Date.now()-i.current)/1e3;e&&e(re,{timeSeconds:Math.round(ne),attempts:o.current,hintsUsed:a.current,lastAnswer:f})}else w<r.length&&(k(Q=>Q+1),a.current+=1,s==null||s()),p(Q=>Q.map((re,ne)=>re===u[ne]?re:null))},P=c.split("_____");return d.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700",role:"region","aria-labelledby":"cloze-title",children:[d.jsx("h3",{id:"cloze-title",className:"text-xl font-bold mb-6 text-gray-800 dark:text-white",children:"  "}),d.jsx("p",{className:"sr-only",children:"           "}),d.jsx("div",{className:"mb-8 text-lg leading-loose text-center",dir:"rtl",role:"group","aria-label":" ",children:P.map((O,D)=>d.jsxs(nt.Fragment,{children:[O.includes("$")||O.includes("\\")?d.jsx(U1,{content:O,className:"inline"}):d.jsx("span",{dangerouslySetInnerHTML:{__html:ko(O)}}),D<P.length-1&&d.jsx("button",{onDrop:G=>E(G,D),onDragOver:I,onClick:()=>S(D),type:"button","aria-label":f[D]?` ${D+1}: ${f[D]}.  `:`  ${D+1}.   `,className:`inline-block min-w-[100px] min-h-[44px] mx-2 border-b-2 align-middle text-center px-2 cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 rounded
                                    ${f[D]?v?f[D]===u[D]?"border-green-500 text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30":"border-red-500 text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-900/30":"border-blue-500 text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30":"border-gray-300 dark:border-slate-500 bg-gray-50 dark:bg-slate-700 text-gray-700 dark:text-slate-200"}
                                `,children:f[D]||d.jsx("span",{className:"text-gray-300 dark:text-slate-500 text-sm select-none",children:" "})})]},D))}),d.jsx("div",{className:"flex flex-wrap gap-3 justify-center mb-8 bg-gray-50 dark:bg-slate-700/50 p-4 rounded-xl",role:"list","aria-label":" ",children:g.map((O,D)=>{const G=f.includes(O);return d.jsx("button",{type:"button",role:"listitem",draggable:!v&&!G,onDragStart:J=>M(J,O),onClick:()=>{if(v||G)return;const J=f.findIndex(Q=>Q===null);J!==-1&&p(Q=>{const re=[...Q];return re[J]=O,re})},disabled:v||G,"aria-label":G?`${O} -  `:`${O} -  `,className:`px-4 py-2 min-h-[44px] rounded-lg font-medium shadow-sm border select-none transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2
                                ${G?"bg-gray-100 dark:bg-slate-600 text-gray-400 dark:text-slate-400 border-gray-100 dark:border-slate-500 cursor-not-allowed":"bg-white dark:bg-slate-700 text-gray-700 dark:text-slate-200 border-gray-200 dark:border-slate-600 hover:border-blue-400 dark:hover:border-wizdi-cyan hover:shadow-md cursor-pointer active:scale-95 motion-reduce:active:scale-100"}
                            `,children:O},D)})}),!t&&r.length>0&&w>0&&!v&&d.jsx("div",{className:"mb-6 space-y-2",children:r.slice(0,w).map((O,D)=>d.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 animate-fade-in",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"text-xs text-yellow-700 font-bold mb-1",children:[" ",D+1]}),d.jsx("div",{className:"text-gray-700",children:O})]})]})},D))}),!v&&d.jsxs("div",{className:"text-center",children:[d.jsx("button",{onClick:N,"aria-label":" ",className:"bg-blue-600 dark:bg-wizdi-action text-white px-8 py-3 min-h-[44px] rounded-full font-bold shadow-lg hover:bg-blue-700 dark:hover:bg-wizdi-action-hover transition-transform active:scale-95 motion-reduce:transition-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2",children:""}),f.some(O=>O===null)&&d.jsx("p",{className:"text-xs text-gray-400 dark:text-slate-500 mt-2",children:"    "})]}),v&&d.jsx("div",{className:"mt-6 text-center animate-fade-in motion-reduce:animate-none",role:"alert","aria-live":"polite",children:d.jsx("div",{className:"text-lg font-bold mb-4",children:f.every((O,D)=>O===u[D])?d.jsxs("span",{className:"text-green-600 dark:text-green-400 flex items-center justify-center gap-2",children:[d.jsx(br,{className:"w-6 h-6","aria-hidden":"true"})," !   "]}):d.jsxs("div",{className:"flex flex-col items-center gap-2",children:[d.jsxs("span",{className:"text-red-500 dark:text-red-400 flex items-center justify-center gap-2",children:[d.jsx(No,{className:"w-6 h-6","aria-hidden":"true"}),"  "]}),d.jsx("button",{onClick:()=>{b(!1),p(new Array(u.length).fill(null))},className:"text-blue-600 dark:text-wizdi-cyan text-sm hover:underline mt-2 min-h-[44px] px-4 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 rounded",children:" "})]})})})]})},sJ=({block:n,onComplete:e,isExamMode:t=!1,hints:r=[],onHintUsed:s})=>{const i=V.useRef(Date.now()),o=V.useRef(0),a=V.useRef(0),l=nt.useMemo(()=>{if(typeof n.content=="string")return{instruction:"  :",correct_order:n.content.split(`
`).map(ne=>ne.trim()).filter(ne=>ne)};const G=n.content;let J=[];Array.isArray(G.correct_order)?J=G.correct_order:Array.isArray(G.items)&&(J=G.items);const Q=G.instruction||G.question||"  :";return J.length<2&&Q&&Q.length>10&&(J=Q.split(" ").filter(re=>re.length>1)),{instruction:Q,correct_order:J}},[n.content]),{instruction:c,correct_order:u}=l,[h,f]=V.useState([]),[p,g]=V.useState(!1),y=V.useRef(null),v=V.useRef(null),[b,w]=V.useState(null),[k,T]=V.useState(null),[R,M]=V.useState(0),[E,I]=V.useState(!1);V.useEffect(()=>{if(i.current=Date.now(),o.current=0,u.length>0){const G=[...u].sort(()=>Math.random()-.5);f(G)}else f([])},[JSON.stringify(u)]);const S=(G,J)=>{y.current=J,w(J),G.dataTransfer.effectAllowed="move",G.currentTarget instanceof HTMLElement&&(G.currentTarget.style.opacity="0.5")},N=(G,J)=>{v.current=J,T(J)},P=()=>{},O=G=>{G.currentTarget instanceof HTMLElement&&(G.currentTarget.style.opacity="1");const J=y.current,Q=v.current;if(J!==null&&Q!==null&&J!==Q&&!p){const re=[...h],ne=re[J];re.splice(J,1),re.splice(Q,0,ne),f(re)}y.current=null,v.current=null,w(null),T(null)},D=()=>{I(!0),o.current+=1;const G=JSON.stringify(h)===JSON.stringify(u),J=Ui.MAX_ATTEMPTS;if(G||o.current>=J){g(!0);const Q=Ww({isCorrect:G,attempts:o.current,hintsUsed:a.current,responseTimeSec:(Date.now()-i.current)/1e3}),re=(Date.now()-i.current)/1e3;e&&e(Q,{timeSeconds:Math.round(re),attempts:o.current,hintsUsed:a.current,lastAnswer:h})}else R<r.length&&(M(Q=>Q+1),a.current+=1,s==null||s())};return d.jsxs("div",{className:"w-full mx-auto",role:"region","aria-label":" ",children:[d.jsx("p",{className:"text-lg text-indigo-800 dark:text-white/90 mb-6 text-right font-bold",children:c}),d.jsx("div",{className:"space-y-3 mb-8",role:"list","aria-label":"  -    ",children:h.map((G,J)=>{const Q=h[J]===u[J],re=b===J,ne=k===J&&b!==null&&b!==J;return d.jsxs("div",{draggable:!p,onDragStart:te=>S(te,J),onDragEnter:te=>N(te,J),onDragLeave:P,onDragEnd:O,onDragOver:te=>te.preventDefault(),role:"listitem","aria-grabbed":y.current===J,"aria-label":` ${J+1}: ${G}${p?Q?",  ":",  ":""}`,tabIndex:p?-1:0,onKeyDown:te=>{if(!p){if(te.key==="ArrowUp"&&J>0){te.preventDefault();const H=[...h];[H[J],H[J-1]]=[H[J-1],H[J]],f(H)}else if(te.key==="ArrowDown"&&J<h.length-1){te.preventDefault();const H=[...h];[H[J],H[J+1]]=[H[J+1],H[J]],f(H)}}},className:`p-4 min-h-[56px] bg-white dark:bg-slate-700 border-2 rounded-xl shadow-sm flex items-center gap-4 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2
                                ${re?"opacity-50 border-dashed border-blue-400 bg-blue-50 dark:bg-blue-900/30":ne?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02] shadow-lg":p?Q?"border-green-300 bg-green-50 dark:bg-green-900/30":"border-red-300 bg-red-50 dark:bg-red-900/30":"border-gray-200 dark:border-slate-600 cursor-grab active:cursor-grabbing hover:border-wizdi-action hover:shadow-md"}
                                transition-[transform,box-shadow,border-color,background-color] duration-150 ease-out
                            `,style:{transform:ne?"scale(1.02)":"scale(1)",willChange:b!==null?"transform":"auto"},children:[d.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm
                                ${p?Q?"bg-green-200 text-green-700 dark:bg-green-800 dark:text-green-200":"bg-red-200 text-red-700 dark:bg-red-800 dark:text-red-200":"bg-gray-100 text-gray-500 dark:bg-slate-600 dark:text-slate-300"}
                            `,"aria-hidden":"true",children:J+1}),d.jsx("div",{className:"flex-1 font-medium text-gray-700 dark:text-slate-200 select-none",children:G.includes("$")||G.includes("\\")?d.jsx(U1,{content:G,className:"inline"}):G}),!p&&d.jsx("div",{className:"text-gray-300 dark:text-slate-500 text-xl font-light","aria-hidden":"true",children:""})]},G)})}),d.jsx("p",{className:"sr-only",children:"        "}),!t&&r.length>0&&R>0&&!p&&d.jsx("div",{className:"mb-6 space-y-2",children:r.slice(0,R).map((G,J)=>d.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 animate-fade-in",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"text-xs text-yellow-700 font-bold mb-1",children:[" ",J+1]}),d.jsx("div",{className:"text-gray-700",children:G})]})]})},J))}),!p&&d.jsx("div",{className:"text-center",children:d.jsx("button",{onClick:D,className:"bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition-transform active:scale-95",children:""})}),p&&d.jsx("div",{className:"mt-6 text-center animate-fade-in",children:d.jsx("div",{className:"text-lg font-bold",children:JSON.stringify(h)===JSON.stringify(u)?d.jsxs("span",{className:"text-green-600 flex items-center justify-center gap-2",children:[d.jsx(br,{className:"w-6 h-6"}),"  !  "]}):d.jsxs("div",{className:"space-y-4",children:[d.jsxs("span",{className:"text-red-500 flex items-center justify-center gap-2",children:[d.jsx(No,{className:"w-6 h-6"}),"  ,  "]}),d.jsx("button",{onClick:()=>g(!1),className:"bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700 transition-transform active:scale-95",children:" "})]})})})]})},iJ=({block:n,onComplete:e,isExamMode:t=!1,hints:r=[],onHintUsed:s})=>{const i=V.useRef(Date.now()),o=V.useRef(0),a=V.useRef(0),l=nt.useMemo(()=>typeof n.content=="string"?{categories:[],items:[]}:n.content,[n.content]),{categories:c=[],items:u=[]}=l||{},[h,f]=V.useState([]),[p,g]=V.useState({}),[y,v]=V.useState(!1),[b,w]=V.useState(0),[k,T]=V.useState(null),[R,M]=V.useState(null);V.useEffect(()=>{i.current=Date.now(),o.current=0;const D=(Array.isArray(u)?u:[]).map((J,Q)=>({...J,text:(J==null?void 0:J.text)||"?",category:(J==null?void 0:J.category)||"Uncategorized",id:`item-${Q}`})).sort(()=>Math.random()-.5);f(D);const G={};c.forEach(J=>G[J]=[]),g(G)},[n]);const E=(O,D,G)=>{v(!1),T(D),O.dataTransfer.setData("itemId",D),O.dataTransfer.setData("source",G),O.dataTransfer.effectAllowed="move"},I=()=>{T(null)},S=(O,D)=>{O.preventDefault();const G=O.dataTransfer.getData("itemId"),J=O.dataTransfer.getData("source");if(!G||!J||J===D||y)return;let Q,re=[...h];const ne={...p};if(J==="bank"){const te=re.findIndex(H=>H.id===G);if(te===-1)return;Q=re[te],re.splice(te,1)}else{if(!ne[J])return;const te=[...ne[J]],H=te.findIndex(ce=>ce.id===G);if(H===-1)return;Q=te[H],te.splice(H,1),ne[J]=te}if(Q){if(D==="bank")re.push(Q);else{const te=[...ne[D]||[]];te.push(Q),ne[D]=te}f(re),g(ne),Q&&(M(Q.id),setTimeout(()=>M(null),400))}},N=O=>{O.preventDefault()},P=()=>{if(y){v(!1);return}o.current+=1;let O=0,D=0;Object.entries(p).forEach(([Q,re])=>{re.forEach(ne=>{D++,ne.category===Q&&O++})}),D=u.length;const G=O===D,J=Ui.MAX_ATTEMPTS;if(G||o.current>=J){v(!0);const Q=Math.round(O/D*100),re=(Date.now()-i.current)/1e3;e&&e(Q,{timeSeconds:Math.round(re),attempts:o.current,hintsUsed:a.current,lastAnswer:p})}else b<r.length&&(w(Q=>Q+1),a.current+=1,s==null||s())};return d.jsxs("div",{className:"w-full mx-auto",role:"region","aria-label":"   ",children:[d.jsx("p",{className:"sr-only",children:"    "}),d.jsxs("div",{className:"min-h-[100px] p-4 bg-gray-50 dark:bg-slate-800 rounded-xl mb-8 border-2 border-dashed border-gray-200 dark:border-slate-600 flex flex-wrap gap-3 justify-center items-center transition-colors",onDrop:O=>S(O,"bank"),onDragOver:N,role:"list","aria-label":"  -   ",children:[h.length===0&&!y&&d.jsx("span",{className:"text-gray-400 dark:text-slate-500 text-sm",children:"  (    )"}),h.map(O=>d.jsx("div",{role:"listitem",draggable:!y,onDragStart:D=>E(D,O.id,"bank"),onDragEnd:I,tabIndex:y?-1:0,"aria-label":`: ${O.text}`,className:`px-4 py-2.5 min-h-[48px] flex items-center bg-white dark:bg-slate-700 border-2 border-gray-200 dark:border-slate-600 rounded-xl cursor-grab active:cursor-grabbing select-none transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2
                            ${k===O.id?"shadow-xl scale-105 rotate-2 border-indigo-400 opacity-90 z-10":R===O.id?"animate-bounce-land shadow-lg":"shadow-md hover:shadow-lg hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-[1.02]"}
                        `,children:d.jsx("span",{className:"text-gray-700 dark:text-slate-200 font-medium",children:O.text})},O.id))]}),d.jsx("div",{className:`grid gap-4 mb-8 ${c.length===2?"grid-cols-2":c.length===3?"grid-cols-1 md:grid-cols-3":"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}`,children:c.map(O=>{const D=p[O]||[];return d.jsxs("div",{className:"flex flex-col h-full",role:"group","aria-labelledby":`category-${O}`,children:[d.jsx("div",{id:`category-${O}`,className:"bg-indigo-600 dark:bg-indigo-700 text-white py-3 px-4 min-h-[48px] flex items-center justify-center rounded-t-xl font-bold text-center shadow-md text-sm md:text-base",children:O}),d.jsxs("div",{className:`flex-1 min-h-[180px] bg-white dark:bg-slate-800 border-2 border-t-0 border-indigo-200 dark:border-slate-600 rounded-b-xl p-3 flex flex-col gap-2 transition-all shadow-inner
                                    ${!y&&"hover:bg-indigo-50/70 dark:hover:bg-indigo-900/40 hover:border-indigo-300"}
                                `,onDrop:G=>S(G,O),onDragOver:N,role:"list","aria-label":` ${O} -   `,children:[D.length===0&&d.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 dark:text-slate-500 text-sm italic",children:"  "}),D.map(G=>d.jsxs("div",{role:"listitem",draggable:!y,onDragStart:J=>E(J,G.id,O),onDragEnd:I,tabIndex:y?-1:0,"aria-label":`${G.text}${y?G.category===O?",  ":",  ":""}`,className:`px-3 py-2.5 min-h-[46px] rounded-xl text-sm font-medium border-2 flex justify-between items-center transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2
                                            ${y?G.category===O?"border-green-400 bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-300 shadow-md":"border-red-400 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-300 shadow-md":k===G.id?"shadow-xl scale-105 -rotate-2 border-indigo-400 bg-white dark:bg-slate-600 opacity-90 z-10":R===G.id?"animate-bounce-land shadow-lg bg-white dark:bg-slate-700 border-indigo-300":"cursor-grab active:cursor-grabbing text-gray-700 dark:text-slate-200 bg-white dark:bg-slate-700 border-gray-200 dark:border-slate-600 shadow-md hover:shadow-lg hover:border-indigo-400 hover:-translate-y-0.5 hover:scale-[1.02]"}
                                        `,children:[d.jsx("span",{children:G.text}),y&&(G.category===O?d.jsx(br,{className:"w-5 h-5 text-green-600 dark:text-green-400","aria-hidden":"true"}):d.jsx(No,{className:"w-5 h-5 text-red-600 dark:text-red-400","aria-hidden":"true"}))]},G.id))]})]},O)})}),!t&&r.length>0&&b>0&&!y&&d.jsx("div",{className:"mb-6 space-y-2",children:r.slice(0,b).map((O,D)=>d.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 animate-fade-in",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"text-xs text-yellow-700 font-bold mb-1",children:[" ",D+1]}),d.jsx("div",{className:"text-gray-700",children:O})]})]})},D))}),d.jsx("div",{className:"text-center",children:d.jsx("button",{onClick:P,"aria-label":y?" ":" ",className:"bg-blue-600 dark:bg-wizdi-action text-white px-8 py-3 min-h-[44px] rounded-full font-bold shadow-lg hover:bg-blue-700 dark:hover:bg-wizdi-action-hover disabled:opacity-50 disabled:cursor-not-allowed transition-transform active:scale-95 motion-reduce:transition-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2",children:y?" ":""})})]})},oJ=({block:n,onComplete:e})=>{const t=V.useRef(Date.now()),r=nt.useMemo(()=>{const k=n.content;return{pairs:(Array.isArray(k.pairs)?k.pairs:[]).map(M=>({card_a:M.card_a||M.front||"?",card_b:M.card_b||M.back||"?"})),cardBackEmoji:k.cardBackEmoji||k.card_back_emoji,cardBackImage:k.cardBackImage||k.card_back_image}},[n.content]),{pairs:s=[],cardBackEmoji:i,cardBackImage:o}=r||{},[a,l]=V.useState([]),[c,u]=V.useState([]),[h,f]=V.useState(!1),[p,g]=V.useState(!1),[y,v]=V.useState(0);V.useEffect(()=>{t.current=Date.now();const k=[];Array.isArray(s)&&s.forEach((T,R)=>{T&&(k.push({id:R*2,content:T.card_a||"?",pairId:R,isFlipped:!1,isMatched:!1}),k.push({id:R*2+1,content:T.card_b||"?",pairId:R,isFlipped:!1,isMatched:!1}))}),l(k.sort(()=>Math.random()-.5))},[n]);const b=k=>{if(h||a[k].isFlipped||a[k].isMatched||c.includes(k))return;const T=[...a];T[k].isFlipped=!0,l(T);const R=[...c,k];u(R),R.length===2&&(f(!0),v(M=>M+1),w(R))},w=k=>{const[T,R]=k,M=a[T].pairId===a[R].pairId;setTimeout(()=>{const E=[...a];if(M?(E[T].isMatched=!0,E[R].isMatched=!0):(E[T].isFlipped=!1,E[R].isFlipped=!1),l(E),u([]),f(!1),E.every(I=>I.isMatched)){g(!0);const I=Ww({isCorrect:!0,attempts:Math.min(y,3),hintsUsed:0,responseTimeSec:(Date.now()-t.current)/1e3}),S=(Date.now()-t.current)/1e3;e&&e(I,{timeSeconds:Math.round(S),attempts:y,hintsUsed:0,lastAnswer:y})}},1e3)};return d.jsxs("div",{className:"w-full mx-auto",role:"region","aria-labelledby":"memory-title",children:[d.jsx("h3",{id:"memory-title",className:"text-3xl font-black mb-4 text-indigo-800 dark:text-white text-center",children:" "}),d.jsxs("div",{className:"text-gray-600 dark:text-white/70 mb-6 text-sm flex justify-between px-4",children:[d.jsx("span",{children:"   "}),d.jsx("span",{className:"sr-only",children:"     .   ."})]}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4 mb-8",role:"grid","aria-label":"  ",children:a.map((k,T)=>d.jsx("button",{onClick:()=>b(T),disabled:h||k.isMatched,"aria-label":k.isFlipped||k.isMatched?k.content:" ","aria-pressed":k.isFlipped,className:`aspect-[3/4] min-h-[100px] cursor-pointer perspective-1000 relative group focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 rounded-xl ${k.isMatched?"cursor-default":""}`,children:d.jsxs("div",{className:`w-full h-full transition-all duration-500 motion-reduce:duration-0 relative rounded-xl shadow-md border border-gray-200 dark:border-slate-600
                            ${k.isFlipped||k.isMatched?"[transform:rotateY(180deg)]":"hover:-translate-y-1 hover:shadow-lg motion-reduce:hover:translate-y-0"}
                        `,style:{transformStyle:"preserve-3d"},children:[d.jsx("div",{className:"absolute inset-0 w-full h-full bg-indigo-600 dark:bg-indigo-700 rounded-xl flex items-center justify-center shadow-inner overflow-hidden",style:{backfaceVisibility:"hidden"},"aria-hidden":"true",children:o?d.jsx("img",{src:o,alt:"",className:"w-full h-full object-cover opacity-40"}):i?d.jsx("div",{className:"text-5xl select-none opacity-80",children:i}):d.jsx("div",{className:"text-white text-4xl opacity-20 font-bold select-none",children:"?"})}),d.jsxs("div",{className:"absolute inset-0 w-full h-full bg-white dark:bg-slate-700 rounded-xl flex items-center justify-center p-3 text-center border-2 border-indigo-100 dark:border-indigo-500/30",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:[d.jsx("span",{className:"font-bold text-gray-800 dark:text-slate-100 text-base leading-tight break-words hyphens-auto select-none max-w-full overflow-hidden",children:k.content}),k.isMatched&&d.jsx("div",{className:"absolute top-2 right-2","aria-hidden":"true",children:d.jsx(br,{className:"w-4 h-4 text-green-500"})})]})]})},k.id))}),p&&d.jsx("div",{className:"text-center animate-fade-in motion-reduce:animate-none",role:"alert","aria-live":"polite",children:d.jsxs("div",{className:"text-xl font-bold text-green-600 dark:text-green-400 flex items-center justify-center gap-2",children:[d.jsx(br,{className:"w-8 h-8","aria-hidden":"true"}),d.jsx("span",{children:" !   "})]})})]})},U6e=nt.lazy(()=>Ln(()=>import("./CoursePlayer-Bq7ZKb2I.js").then(n=>n.j),__vite__mapDeps([0,1]))),H6e=nt.lazy(()=>Ln(()=>import("./SendActivitiesModal-B0HEUCEv.js"),__vite__mapDeps([2,3,4]))),q6e=nt.lazy(()=>Ln(()=>import("./PresentationMode-DPiMPQJt.js"),[])),dr={text:" / ",image:"",video:"",infographic:"","multiple-choice":" ","open-question":" ","interactive-chat":" ",fill_in_blanks:" ",ordering:" ",categorization:" ",memory_game:" ",true_false_speed:"  ",drag_and_drop:" ",hotspot:" ",matching:"","audio-response":" ",podcast:" AI",highlight:" ",sentence_builder:" ",image_labeling:" ",table_completion:" ",text_selection:" ",rating_scale:" ",matrix:""},iE=n=>{var e,t;if(n.type==="text"){const r=typeof n.content=="string"?n.content:((e=n.content)==null?void 0:e.teach_content)||((t=n.content)==null?void 0:t.text)||"";if(!r)return null;let s=null;const i=r.match(/<h3[^>]*>(.*?)<\/h3>/i);if(i&&i[1]&&(s=i[1].replace(/<[^>]+>/g,"").trim()),!s){const a=r.split(`
`).find(l=>l.trim().startsWith("#"));a&&(s=a.replace(/^#+\s*/,"").trim())}return s&&(s=s.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]|[\u{FE00}-\u{FE0F}]|[\u{20D0}-\u{20FF}]/gu,"").trim()),s}return null},gz=({blockType:n,blockIndex:e,totalBlocks:t,className:r="w-5 h-5"})=>{const s=Bf(e,t,n),i=Xq[s].icon;return d.jsx(i,{className:r})},G6e=2e3,W6e=({unit:n,courseId:e,course:t,onExit:r,onEdit:s,onUpdateBlock:i,onUnitUpdate:o,embedded:a=!1})=>{var is,ve,Ne,Qe,it,Nt,we,Y,le,he,qe,jt,Le,yt,Xe,It,pt,ye,Jt,tn,kn,on,vt;const[l,c]=V.useState("all"),[u,h]=V.useState(null),[f,p]=V.useState(null),[g,y]=V.useState(!1),[v,b]=V.useState(""),w=V.useRef({}),k=V.useRef({}),[T,R]=V.useState(null),[M,E]=V.useState(null),[I,S]=V.useState(!1),N=nt.useRef(null),[P,O]=V.useState(!1),[D,G]=V.useState(!1),[J,Q]=V.useState(n.goals||[]),[re,ne]=V.useState({}),[te,H]=V.useState({}),[ce,xe]=V.useState(null),[W,dt]=V.useState(null),[Me,Fe]=V.useState(null),[Ae,lt]=V.useState(null),[sn,un]=V.useState({}),[Sr,ri]=V.useState({}),[Yn,Or]=V.useState(new Set),[ht,Tn]=V.useState(null),[Gt,Dn]=V.useState(null),[bt,$t]=V.useState(null),[er,js]=V.useState(null),[co,Rn]=V.useState(null),[Ct,oe]=V.useState(!1),[pe,Ge]=V.useState(!1);V.useEffect(()=>()=>{N.current&&clearTimeout(N.current)},[]),V.useEffect(()=>{Q(n.goals||[])},[n.goals]);const ft=()=>{S(!0),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{S(!1)},G6e+500)},Ye=$=>{console.log("[updateUnitBlocks] Called with",$.length,"blocks"),console.log("[updateUnitBlocks] onUnitUpdate:",!!o,"onUpdateBlock:",!!i),o?(console.log("[updateUnitBlocks] Calling onUnitUpdate..."),o({...n,activityBlocks:$}),ft()):i?console.warn("Using Legacy onUpdateBlock - Full CRUD not supported properly without onUnitUpdate"):console.error("[updateUnitBlocks] No update handler available!")},tt=async($,ee)=>{var si,kt,cr;console.log("[addBlockAtIndex] Adding block:",$,"at index:",ee),console.log("[addBlockAtIndex] onUnitUpdate exists:",!!o);const de=n.title||" ",ze=((si=n.metadata)==null?void 0:si.gradeLevel)||" ",je=((kt=n.metadata)==null?void 0:kt.subject)||"",wt=((cr=n.activityBlocks)==null?void 0:cr.filter(An=>An.type==="text").map(An=>{var Fr,ur;return typeof An.content=="string"?An.content:((Fr=An.content)==null?void 0:Fr.text)||((ur=An.content)==null?void 0:ur.teach_content)||""}).join(`
`).substring(0,2e3))||"",dn=qD($,"socratic"),Ar=[...n.activityBlocks||[]];if(Ar.splice(ee,0,dn),Ye(Ar),E(null),Rn(ee),["multiple-choice","open-question","categorization","ordering","fill_in_blanks","memory_game","infographic"].includes($))try{let An=null;switch($){case"multiple-choice":An=await spe(de,ze,wt,je);break;case"open-question":An=await ipe(de,ze,wt,je);break;case"categorization":An=await epe(de,ze,wt,je);break;case"ordering":An=await tpe(de,ze,wt,je);break;case"fill_in_blanks":An=await npe(de,ze,wt,je);break;case"memory_game":An=await rpe(de,ze,wt,je);break;case"infographic":if(wt&&wt.length>50){setIsGeneratingInfographic(!0);try{const Fr=U6(wt),ur=(Fr==null?void 0:Fr.suggestedType)||"flowchart";console.log("[addBlockAtIndex] Generating infographic, type:",ur);const ii=await V6(wt,ur,de);if(ii){const Ta=new FileReader;An={imageUrl:await new Promise(Nf=>{Ta.onloadend=()=>Nf(Ta.result),Ta.readAsDataURL(ii)}),title:`: ${de}`,caption:"",visualType:ur}}}finally{setIsGeneratingInfographic(!1)}}else console.log("[addBlockAtIndex] Not enough source text for infographic");break}if(An){console.log("[addBlockAtIndex] AI generated content:",An);const Fr=[...n.activityBlocks||[]],ur=Fr.findIndex(ii=>ii.id===dn.id);ur!==-1&&(Fr[ur]={...Fr[ur],content:An},Ye(Fr))}}catch(An){console.error("[addBlockAtIndex] AI generation failed:",An)}Rn(null),$==="text"&&h(dn.id)},bn=$=>{var ee;if(confirm("  ?")){const de=((ee=n.activityBlocks)==null?void 0:ee.filter(ze=>ze.id!==$))||[];Ye(de)}},vn=($,ee)=>{const de=[...n.activityBlocks||[]];ee==="up"&&$>0?[de[$],de[$-1]]=[de[$-1],de[$]]:ee==="down"&&$<de.length-1&&([de[$],de[$+1]]=[de[$+1],de[$]]),Ye(de)},wn=($,ee,de)=>{var je;const ze=((je=n.activityBlocks)==null?void 0:je.map(wt=>wt.id===$?{...wt,content:ee,metadata:de?{...wt.metadata,...de}:wt.metadata}:wt))||[];Ye(ze)},tr=($,ee)=>{var je;if(ee==="")return $.content;const de=ee===""?"scaffolding_variant":"enrichment_variant",ze=(je=$.metadata)==null?void 0:je[de];return(ze==null?void 0:ze.content)||$.content},Xt=$=>{ht&&(Dn($),$t(tr(ht,$)))},ss=()=>{var $;if(!(!ht||!Gt)){if(Gt==="")wn(ht.id,bt);else{const ee=Gt===""?"scaffolding_variant":"enrichment_variant",de=(($=ht.metadata)==null?void 0:$[ee])||{};wn(ht.id,ht.content,{[ee]:{...de,content:bt}})}Tn(ee=>{var ze;if(!ee)return null;if(Gt==="")return{...ee,content:bt};const de=Gt===""?"scaffolding_variant":"enrichment_variant";return{...ee,metadata:{...ee.metadata,[de]:{...(ze=ee.metadata)==null?void 0:ze[de],content:bt}}}}),Dn(null),$t(null)}},mn=()=>{Dn(null),$t(null)},il=async $=>{if(ht){js($);try{const ee=n.title||" ";let de=null;if($===""?de=await Hq(ht,ee):de=await qq(ht,ee),de){const ze=$===""?"scaffolding_variant":"enrichment_variant";wn(ht.id,ht.content,{[ze]:de,has_variants:!0}),Tn(je=>je?{...je,metadata:{...je.metadata,[ze]:de,has_variants:!0}}:null)}}catch(ee){console.error(`Failed to regenerate ${$} variant:`,ee)}finally{js(null)}}},uo=()=>{if(o){const $=J.filter(ee=>ee.trim()!=="");o({...n,goals:$}),ft()}G(!1)},jo=()=>{Q([...J,""])},lr=($,ee)=>{const de=[...J];de[$]=ee,Q(de)},wa=$=>{const ee=J.filter((de,ze)=>ze!==$);Q(ee)},ol=$=>{const ee=document.getElementById($);ee&&(ee.scrollIntoView({behavior:"smooth"}),c($))},al=async()=>{var Ar,as,si;const $=kt=>{if(kt.type==="text"){const cr=kt.content;if(typeof cr=="string")return cr;if(cr&&typeof cr=="object")return cr.teach_content||cr.text||""}return""},ee=kt=>{const cr=document.createElement("div");return cr.innerHTML=kt,cr.textContent||cr.innerText||""},de=n.activityBlocks.filter(kt=>kt.type==="text"),ze=de.map((kt,cr)=>{const An=$(kt),Fr=iE(kt)||` ${cr+1}`,ur=ee(An),Ta=ur.split(/\n+/).filter(vd=>vd.trim()).slice(0,5);return{slide_title:Fr,bullet_points_for_board:Ta.length>0?Ta:[ur.slice(0,200)+"..."],script_to_say:ur,timing_estimate:"5 "}}),wt=n.activityBlocks.filter(kt=>["multiple-choice","open-question"].includes(kt.type)).slice(0,5).map(kt=>(kt.type==="multiple-choice"&&kt.content&&typeof kt.content=="object"||kt.type==="open-question"&&kt.content&&typeof kt.content=="object")&&kt.content.question||"").filter(kt=>kt),dn=((Ar=n.metadata)==null?void 0:Ar.lessonPlan)||{lesson_metadata:{title:n.title,target_audience:((as=n.metadata)==null?void 0:as.gradeLevel)||" ",duration:"45 ",subject:(si=n.metadata)==null?void 0:si.subject,learning_objectives:n.goals||[]},hook:{script_for_teacher:n.baseContent||ee($(de[0])||"  ")},direct_instruction:{slides:ze.length>0?ze:[{slide_title:n.title,bullet_points_for_board:n.goals||[" "],script_to_say:n.baseContent||"  ",timing_estimate:"10 "}]},guided_practice:{teacher_facilitation_script:"        .     .",example_questions:[{question_text:"      ?",expected_answer:"    ",common_mistakes:["  ","   "],follow_up_prompt:"     ?"}],suggested_activities:n.activityBlocks.filter(kt=>["multiple-choice","memory_game","fill_in_blanks","ordering","categorization","drag_and_drop","hotspot","open-question"].includes(kt.type)).map(kt=>({activity_type:kt.type,description:` ${dr[kt.type]||kt.type} `,facilitation_tip:"       "})),differentiation_strategies:{for_struggling_students:"        ",for_advanced_students:"      "},assessment_tips:["    ","   "]},independent_practice:{introduction_text:"   ",interactive_blocks:n.activityBlocks.filter(kt=>["multiple-choice","memory_game","fill_in_blanks","ordering","categorization","drag_and_drop","hotspot","open-question"].includes(kt.type)).map(kt=>({type:kt.type,data:kt.content})),estimated_duration:"10-15 "},discussion:{questions:wt.length>0?wt:["  ?","    ?"]},summary:{takeaway_sentence:`: ${n.title}`}};await Eme(dn,`${n.title} -  .pdf`)},Vn=async()=>{if(I&&!confirm(`    !

  ,       .

    ,   ""   .`))return;let $=window.location.href;if(e){const ee=`${window.location.origin}/?studentCourseId=${e}`;$=n.id?`${ee}&unit=${n.id}`:ee}try{navigator.share?await navigator.share({title:n.title,text:` : ${n.title}`,url:$}):(await navigator.clipboard.writeText($),alert("  ! "))}catch(ee){console.error("Share failed:",ee)}},Oo=($,ee)=>{var je;const de=(je=$.target.files)==null?void 0:je[0];if(!de)return;const ze=new FileReader;ze.onloadend=()=>{wn(ee,ze.result)},ze.readAsDataURL(de)},Ri=async $=>{const ee=te[$];if(ee){xe($);try{const de=await $q(ee);if(de){const ze=await Q6(de,"ai-image",e,n.id);wn($,ze),ne(je=>({...je,[$]:null}))}else alert("  .  .")}catch(de){console.error("Image Gen Error:",de),alert("  .  .")}finally{xe(null)}}},Kc=async($,ee,de)=>{var ze,je,wt;Fe($.id),dt(null);try{let dn=de||"";if(dn||($.type==="text"?dn=typeof $.content=="string"?$.content:((ze=$.content)==null?void 0:ze.teach_content)||((je=$.content)==null?void 0:je.text)||"":$.type==="infographic"?(console.log("[handleGenerateInfographic] Infographic block detected, gathering text from unit..."),dn=((wt=n.activityBlocks)==null?void 0:wt.filter(as=>as.type==="text").map(as=>{var si,kt;return typeof as.content=="string"?as.content:((si=as.content)==null?void 0:si.teach_content)||((kt=as.content)==null?void 0:kt.text)||""}).join(`
`).substring(0,2e3))||""):$.content&&typeof $.content=="object"&&(dn=JSON.stringify($.content))),console.log("[handleGenerateInfographic] textContent length:",dn.length,"type:",ee),!dn||dn.length<3){alert("    ");return}const Ar=await V6(dn,ee,n.title);if(Ar){const as=await Q6(Ar,"infographic",e,n.id);lt({imageUrl:as,block:$,visualType:ee}),Rfe(ee)}else alert("  .  .")}catch(dn){console.error("Infographic Generation Error:",dn),alert("  ")}finally{Fe(null)}},Ul=async()=>{if(!Ae)return;Mfe(Ae.visualType);const $=[...n.activityBlocks||[]],ee=$.findIndex(de=>de.id===Ae.block.id);if(Ae.block.type==="infographic")ee!==-1&&($[ee]={...$[ee],content:{imageUrl:Ae.imageUrl,title:`: ${n.title}`,caption:"",visualType:Ae.visualType},metadata:{...$[ee].metadata,infographicType:Ae.visualType}},Ye($));else{const de=qD("image","socratic");de.content=Ae.imageUrl,de.metadata={...de.metadata,infographicType:Ae.visualType,generatedFrom:Ae.block.id},$.splice(ee+1,0,de),Ye($)}lt(null)},ka=Object.values(Xq).map($=>({id:$.id,label:$.label,icon:$.icon})),_a=async($,ee)=>{if(!(!i&&!o)){y(!0),k.current[$.id]=JSON.parse(JSON.stringify($.content)),console.log(` Saved content before refinement for block ${$.id}`);try{console.log(` Refining block ${$.id} (type: ${$.type}) with instruction: "${ee}"`),console.log(" Original content:",typeof $.content=="string"?$.content.substring(0,100)+"...":$.content);const de=await Ofe($.type,$.content,ee);let ze=de;$.type==="text"&&(typeof de=="string"?ze=de:de&&typeof de=="object"&&(ze=de.text||de.content||de.teach_content||de)),$.type==="text"&&typeof $.content=="object"&&$.content.teacher_tip&&typeof ze=="string"&&(ze={text:ze,teacher_tip:$.content.teacher_tip}),console.log(" Final content to apply:",typeof ze=="string"?ze.substring(0,100)+"...":ze),wn($.id,ze),p(null),b(""),R($.id)}catch(de){console.error("Refine Error:",de),alert("  "),delete k.current[$.id]}finally{y(!1)}}},Hl=$=>{const ee=k.current[$];ee&&(console.log(` Reverting block ${$} to pre-refinement content`),wn($,ee),delete k.current[$],R(null))},Tr=({index:$})=>d.jsxs("div",{className:"flex justify-center my-8 print:hidden group relative z-10 w-full",children:[d.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:d.jsx("div",{className:"w-full border-t border-dashed border-slate-300"})}),d.jsx("div",{className:"relative bg-[#f0f4f8] px-4",children:co===$?d.jsx("div",{className:"glass border border-indigo-200 shadow-xl rounded-2xl p-6 flex flex-col items-center gap-3 backdrop-blur-xl bg-indigo-50/95 ring-4 ring-indigo-100/50",children:d.jsx(DC,{contentType:"activity",isVisible:!0,showSpinner:!0})}):M===$?d.jsxs("div",{className:"glass border border-white/60 shadow-xl rounded-2xl p-4 grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2 animate-scale-in backdrop-blur-xl bg-white/95 ring-4 ring-blue-50/50 max-w-3xl mx-auto",onClick:ee=>ee.stopPropagation(),children:[d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("text",$)},className:"insert-btn",children:[d.jsx(_D,{className:"w-4 h-4"}),d.jsx("span",{children:dr.text})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("image",$)},className:"insert-btn",children:[d.jsx(kD,{className:"w-4 h-4"}),d.jsx("span",{children:dr.image})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("video",$)},className:"insert-btn",children:[d.jsx(R_,{className:"w-4 h-4"}),d.jsx("span",{children:dr.video})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("multiple-choice",$)},className:"insert-btn",children:[d.jsx(p0,{className:"w-4 h-4"}),d.jsx("span",{children:dr["multiple-choice"]})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("open-question",$)},className:"insert-btn",children:[d.jsx(Yl,{className:"w-4 h-4"}),d.jsx("span",{children:dr["open-question"]})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("interactive-chat",$)},className:"insert-btn",children:[d.jsx(Wq,{className:"w-4 h-4"}),d.jsx("span",{children:dr["interactive-chat"]})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("fill_in_blanks",$)},className:"insert-btn",children:[d.jsx(Yl,{className:"w-4 h-4"}),d.jsx("span",{children:dr.fill_in_blanks})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("ordering",$)},className:"insert-btn",children:[d.jsx(p0,{className:"w-4 h-4"}),d.jsx("span",{children:dr.ordering})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("categorization",$)},className:"insert-btn",children:[d.jsx(AD,{className:"w-4 h-4"}),d.jsx("span",{children:dr.categorization})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("memory_game",$)},className:"insert-btn",children:[d.jsx(Mx,{className:"w-4 h-4"}),d.jsx("span",{children:dr.memory_game})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("true_false_speed",$)},className:"insert-btn",children:[d.jsx(dpe,{className:"w-4 h-4"}),d.jsx("span",{children:dr.true_false_speed})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("audio-response",$)},className:"insert-btn",children:[d.jsx(hpe,{className:"w-4 h-4"}),d.jsx("span",{children:dr["audio-response"]})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("podcast",$)},className:"insert-btn",children:[d.jsx(R8,{className:"w-4 h-4"}),d.jsx("span",{children:" AI"})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("infographic",$)},className:"insert-btn",children:[d.jsx(H2,{className:"w-4 h-4"}),d.jsx("span",{children:""})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("mindmap",$)},className:"insert-btn bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-200 hover:border-purple-300",children:[d.jsx(Mx,{className:"w-4 h-4 text-purple-600"}),d.jsx("span",{className:"text-purple-700",children:dr.mindmap})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("matching",$)},className:"insert-btn",children:[d.jsx(I_,{className:"w-4 h-4"}),d.jsx("span",{children:dr.matching})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("highlight",$)},className:"insert-btn",children:[d.jsx(Yl,{className:"w-4 h-4"}),d.jsx("span",{children:dr.highlight})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("sentence_builder",$)},className:"insert-btn",children:[d.jsx(_D,{className:"w-4 h-4"}),d.jsx("span",{children:dr.sentence_builder})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("image_labeling",$)},className:"insert-btn",children:[d.jsx(kD,{className:"w-4 h-4"}),d.jsx("span",{children:dr.image_labeling})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("table_completion",$)},className:"insert-btn",children:[d.jsx(p0,{className:"w-4 h-4"}),d.jsx("span",{children:dr.table_completion})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("text_selection",$)},className:"insert-btn",children:[d.jsx(br,{className:"w-4 h-4"}),d.jsx("span",{children:dr.text_selection})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("rating_scale",$)},className:"insert-btn",children:[d.jsx(upe,{className:"w-4 h-4"}),d.jsx("span",{children:dr.rating_scale})]}),d.jsxs("button",{onClick:ee=>{ee.stopPropagation(),tt("matrix",$)},className:"insert-btn",children:[d.jsx(AD,{className:"w-4 h-4"}),d.jsx("span",{children:dr.matrix})]}),d.jsx("div",{className:"w-px bg-slate-200 mx-2"}),d.jsx("button",{onClick:ee=>{ee.stopPropagation(),E(null)},className:"text-gray-400 hover:text-red-500 p-2 hover:bg-red-50 rounded-full transition-colors",children:d.jsx(No,{className:"w-5 h-5"})})]}):d.jsxs("button",{onClick:()=>E($),className:"bg-white text-slate-500 border border-slate-300 rounded-full px-4 py-1.5 flex items-center gap-2 shadow-sm hover:shadow-md hover:scale-105 transition-all hover:bg-blue-600 hover:text-white hover:border-blue-600",children:[d.jsx($T,{className:"w-4 h-4"}),d.jsx("span",{className:"text-xs font-bold",children:" "})]})}),d.jsx("style",{children:`
                .insert-btn { @apply w-20 h-20 p-2 bg-white/50 border border-white/60 rounded-xl text-[10px] font-bold text-gray-600 hover:bg-blue-50 hover:text-blue-600 hover:border-blue-200 transition-all flex flex-col items-center justify-center gap-1.5 shadow-sm text-center leading-tight; }
                .insert-btn svg { @apply w-6 h-6 flex-shrink-0; }
            `})]}),vs=$=>{const ee=$.type,de=$.content,ze=()=>!de||typeof de=="string"?0:(de.options||[]).length,je=()=>!de||typeof de=="string"?0:(de.items||de.pairs||[]).length;switch(ee){case"multiple-choice":{const wt=ze();return wt<4?`  ${4-wt}    `:"     -    "}case"open-question":return"        ";case"categorization":return je()<6?"    ":"     ";case"memory_game":return je()<6?"  3  ":"        ";case"ordering":return je()<5?"   ":"    ";case"fill_in_blanks":return"      ";case"text":return"      ";case"video":return" 3    ";case"image":return"     ";case"interactive-chat":return"   ";case"podcast":return"     ";case"infographic":return"    ";case"matching":return"  2  ";case"highlight":return"  2    ";case"sentence_builder":return"    ";case"image_labeling":return"  2  ";case"table_completion":return"    ";case"text_selection":return"    ";case"rating_scale":return"    ";case"matrix":return"    ";default:return"    "}},Yc=($,ee)=>{b(ee),w.current[$]=ee};V.useEffect(()=>{if(f){const $=w.current[f];if($!==void 0)b($);else{const ee=n.activityBlocks.find(de=>de.id===f);if(ee){const de=vs(ee);b(de)}}}},[f,n.activityBlocks]);const Os=$=>{if(f!==$.id)return null;const ee=[" "," "," "," "];return d.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-white/95 backdrop-blur-sm z-20 flex flex-col items-center justify-center p-6 animate-fade-in rounded-b-3xl border-t border-slate-100",children:[d.jsx("button",{onClick:()=>p(null),className:"absolute top-3 left-3 p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"",children:d.jsx(No,{className:"w-4 h-4"})}),d.jsxs("h4",{className:"font-bold text-sm mb-3 flex items-center gap-2 text-wizdi-royal",children:[d.jsx(Gy,{className:"w-4 h-4"}),"  AI"]}),d.jsx("div",{className:"flex flex-wrap gap-2 justify-center mb-3 max-w-lg",children:ee.map(de=>d.jsx("button",{onClick:()=>_a($,de),disabled:g,className:"px-3 py-1.5 bg-slate-50 hover:bg-wizdi-royal hover:text-white rounded-full text-xs font-bold transition-colors border border-slate-200",children:de},de))}),d.jsxs("div",{className:"flex flex-col gap-2 w-full max-w-lg",children:[d.jsx("textarea",{value:v,onChange:de=>Yc($.id,de.target.value),placeholder:"   ...",className:"w-full p-3 border border-slate-200 rounded-lg focus:border-wizdi-royal outline-none text-sm min-h-[100px] resize-y",onKeyDown:de=>{de.key==="Enter"&&!de.shiftKey&&(de.preventDefault(),v&&_a($,v))}}),d.jsx("button",{onClick:()=>_a($,v),disabled:!v||g,className:"bg-wizdi-royal text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 font-bold text-sm self-end",children:g?d.jsxs(d.Fragment,{children:[d.jsx(Hi,{className:"animate-spin w-4 h-4"}),"..."]}):d.jsxs(d.Fragment,{children:[d.jsx(br,{className:"w-4 h-4"})," "]})})]})]})},Sa=$=>{var ze,je,wt,dn,Ar,as,si,kt,cr,An,Fr,ur,ii,Ta,vd,sm,Nf,ay;if((ze=$.metadata)!=null&&ze.isLoading)return(je=$.metadata)!=null&&je.isMainLoader?d.jsxs("div",{className:"py-8 flex flex-col items-center justify-center min-h-[200px]",children:[d.jsx(DC,{contentType:"lesson",isVisible:!0}),d.jsxs("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:[d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:"  "}),d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:"  "}),d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:"  "}),d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:"  "}),d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:" "}),d.jsx("span",{className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 rounded-full text-xs font-medium",children:" "})]})]}):d.jsxs("div",{className:"animate-pulse space-y-3",children:[d.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"}),d.jsx("div",{className:"h-4 bg-slate-200 rounded w-1/2"}),d.jsx("div",{className:"h-4 bg-slate-200 rounded w-5/6"})]});if($.type==="image")return $.content?ce===$.id?d.jsx(CO,{height:"h-80",prompt:te[$.id]}):d.jsxs("div",{className:"relative group",children:[d.jsx("img",{src:$.content,className:"w-full h-80 object-cover rounded-2xl shadow-md",alt:"Lesson Visual",loading:"lazy",decoding:"async"}),d.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[d.jsx("button",{onClick:()=>ne({...re,[$.id]:"ai"}),className:"bg-white/90 p-2 rounded-full text-blue-500 hover:bg-blue-50 hover:text-blue-600 shadow-sm transition-all",title:"    AI",children:d.jsx(Gy,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>wn($.id,""),className:"bg-white/90 p-2 rounded-full text-red-500 hover:bg-red-50 hover:text-red-600 shadow-sm transition-all",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]}),re[$.id]==="ai"&&d.jsxs("div",{className:"absolute inset-0 bg-white/95 backdrop-blur-sm rounded-2xl p-6 flex flex-col justify-center z-20",children:[d.jsx("h4",{className:"text-sm font-bold text-blue-700 mb-2",children:"   :"}),d.jsx("textarea",{className:"w-full p-3 border border-blue-200 rounded-lg mb-3 text-sm focus:border-blue-400 outline-none",rows:3,placeholder:":    ...",onChange:an=>H({...te,[$.id]:an.target.value}),autoFocus:!0}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:()=>ne({...re,[$.id]:null}),className:"text-gray-500 text-sm px-3 py-2 hover:bg-gray-100 rounded-lg",children:""}),d.jsx("button",{onClick:()=>Ri($.id),disabled:ce===$.id,className:"bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:ce===$.id?d.jsxs(d.Fragment,{children:[d.jsx(Hi,{className:"w-4 h-4 animate-spin"})," ..."]}):d.jsxs(d.Fragment,{children:[d.jsx(TD,{className:"w-4 h-4"}),"  "]})})]})]})]}):ce===$.id?d.jsx(CO,{height:"h-48",prompt:te[$.id]}):d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-48",children:[d.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all group",children:[d.jsx(SD,{className:"w-8 h-8 text-gray-400 group-hover:text-blue-500 mb-2"}),d.jsx("span",{className:"font-bold text-gray-500 group-hover:text-blue-600",children:" "}),d.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:an=>Oo(an,$.id)})]}),d.jsxs("button",{onClick:()=>ne({...re,[$.id]:"ai"}),className:"flex flex-col items-center justify-center border-2 border-dashed border-blue-200 rounded-xl bg-blue-50/50 hover:bg-blue-50 hover:border-blue-300 transition-all group relative",children:[d.jsx(TD,{className:"w-8 h-8 text-blue-400 group-hover:text-blue-600 mb-2"}),d.jsx("span",{className:"font-bold text-blue-500 group-hover:text-blue-700",children:" -AI"}),re[$.id]==="ai"&&d.jsxs("div",{className:"absolute inset-0 bg-white p-4 rounded-xl z-20 flex flex-col justify-center",onClick:an=>an.stopPropagation(),children:[d.jsx("h4",{className:"text-sm font-bold text-blue-700 mb-2",children:"  :"}),d.jsx("textarea",{className:"w-full p-2 border rounded-lg mb-2 text-sm focus:border-blue-400 outline-none",rows:2,placeholder:":    ...",onChange:an=>H({...te,[$.id]:an.target.value}),autoFocus:!0}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:an=>{an.stopPropagation(),ne({...re,[$.id]:null})},className:"text-gray-500 text-xs px-2",children:""}),d.jsx("button",{onClick:an=>{an.stopPropagation(),Ri($.id)},disabled:ce===$.id,className:"bg-blue-600 text-white text-xs px-3 py-1 rounded-lg",children:ce===$.id?"...":""})]})]})]})]});if($.type==="infographic"){const an=typeof $.content=="string"?$.content:((wt=$.content)==null?void 0:wt.imageUrl)||((dn=$.metadata)==null?void 0:dn.uploadedFileUrl)||"",st=((Ar=$.metadata)==null?void 0:Ar.infographicType)||(typeof $.content=="object"?(as=$.content)==null?void 0:as.visualType:void 0),jn=(si=$.metadata)==null?void 0:si.generatedFrom;if(!an){const Fo=(kt=n.activityBlocks)==null?void 0:kt.some(Fs=>{var Mi,wd;return Fs.type==="text"&&(typeof Fs.content=="string"?Fs.content:((Mi=Fs.content)==null?void 0:Mi.teach_content)||((wd=Fs.content)==null?void 0:wd.text)||"").length>50}),ls=sn[$.id]||"",Xc=Sr[$.id]||"auto";return d.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-purple-200 rounded-xl bg-purple-50/50 relative",children:[d.jsx(H2,{className:"w-8 h-8 text-purple-400 mb-2"}),d.jsx("span",{className:"text-purple-600 font-bold mb-1",children:" "}),d.jsx("span",{className:"text-sm text-purple-500 mb-4",children:"     "}),d.jsx("textarea",{value:ls,onChange:Fs=>un(Mi=>({...Mi,[$.id]:Fs.target.value})),placeholder:":   ,   ,    ...",className:"w-full max-w-md h-24 p-3 border border-purple-200 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent mb-3",dir:"rtl"}),d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("span",{className:"text-sm text-purple-600",children:":"}),d.jsxs("select",{value:Xc,onChange:Fs=>ri(Mi=>({...Mi,[$.id]:Fs.target.value})),className:"px-3 py-1.5 border border-purple-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-400 bg-white",dir:"rtl",children:[d.jsx("option",{value:"auto",children:"  "}),d.jsx("option",{value:"flowchart",children:"  "}),d.jsx("option",{value:"timeline",children:"  "}),d.jsx("option",{value:"comparison",children:" "}),d.jsx("option",{value:"cycle",children:" "})]})]}),d.jsx("button",{onClick:()=>{var wd;const Fs=ls.trim()||(Fo?void 0:"");if(!Fs&&!Fo){alert("    ");return}let Mi;if(Xc==="auto"){const If=Fs||((wd=$.content)==null?void 0:wd.text)||"";Mi=U6(If).suggestedType}else Mi=Xc;Kc($,Mi,Fs||void 0)},disabled:Me===$.id,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors font-bold text-sm disabled:opacity-50",children:Me===$.id?d.jsxs(d.Fragment,{children:[d.jsx(H2,{className:"w-4 h-4 animate-spin"}),d.jsx("span",{children:"..."})]}):d.jsxs(d.Fragment,{children:[d.jsx(Hi,{className:"w-4 h-4"}),d.jsx("span",{children:"  "})]})}),Fo&&!ls&&d.jsx("span",{className:"text-xs text-purple-400 mt-2",children:"   "})]})}return d.jsxs("div",{className:"relative group",children:[d.jsx("img",{src:an,className:"w-full rounded-2xl shadow-md",alt:"",loading:"lazy",decoding:"async"}),st&&d.jsx("div",{className:"absolute bottom-3 left-3 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-purple-700 shadow-sm",children:st==="flowchart"?"  ":st==="timeline"?"  ":st==="comparison"?" ":" "}),d.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[jn&&d.jsx("button",{onClick:()=>{var ls;const Fo=(ls=n.activityBlocks)==null?void 0:ls.find(Xc=>Xc.id===jn);Fo&&dt(Fo.id)},className:"bg-white/90 p-2 rounded-full text-purple-500 hover:bg-purple-50 hover:text-purple-600 shadow-sm transition-all",title:"  ",children:d.jsx(Gy,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>bn($.id),className:"bg-white/90 p-2 rounded-full text-red-500 hover:bg-red-50 hover:text-red-600 shadow-sm transition-all",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]})]})}if($.type==="video"){if(!$.content)return d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 h-48",children:[d.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all group",children:[d.jsx(SD,{className:"w-8 h-8 text-gray-400 group-hover:text-blue-500 mb-2"}),d.jsx("span",{className:"font-bold text-gray-500 group-hover:text-blue-600",children:" "}),d.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:st=>Oo(st,$.id)})]}),d.jsxs("button",{onClick:()=>ne({...re,[$.id]:"link"}),className:"flex flex-col items-center justify-center border-2 border-dashed border-red-200 rounded-xl bg-red-50/50 hover:bg-red-50 hover:border-red-300 transition-all group relative",children:[d.jsx(I_,{className:"w-8 h-8 text-red-400 group-hover:text-red-600 mb-2"}),d.jsx("span",{className:"font-bold text-red-500 group-hover:text-red-700",children:"YouTube"}),re[$.id]==="link"&&d.jsxs("div",{className:"absolute inset-0 bg-white p-4 rounded-xl z-20 flex flex-col justify-center",onClick:st=>st.stopPropagation(),children:[d.jsx("h4",{className:"text-sm font-bold text-red-700 mb-2",children:" :"}),d.jsx("input",{type:"text",dir:"ltr",className:"w-full p-2 border rounded-lg mb-2 text-sm text-left focus:border-red-400 outline-none",placeholder:"https://youtu.be/...",onChange:st=>H({...te,[$.id]:st.target.value}),autoFocus:!0}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:st=>{st.stopPropagation(),ne({...re,[$.id]:null})},className:"text-gray-500 text-xs px-2",children:""}),d.jsx("button",{onClick:st=>{st.stopPropagation(),wn($.id,te[$.id]),ne({...re,[$.id]:null})},className:"bg-red-600 text-white text-xs px-3 py-1 rounded-lg",children:""})]})]})]})]});const an=$.content.includes("youtube")||$.content.includes("youtu.be");return d.jsxs("div",{className:"relative aspect-video rounded-2xl overflow-hidden shadow-md bg-black group",children:[an?d.jsx("iframe",{src:$.content.replace("watch?v=","embed/").split("&")[0],className:"w-full h-full",allowFullScreen:!0}):d.jsx("video",{src:$.content,controls:!0,className:"w-full h-full"}),d.jsx("button",{onClick:()=>wn($.id,""),className:"absolute top-2 right-2 bg-white/80 p-2 rounded-full text-red-500 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-white z-10",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]})}if(u===$.id&&$.type==="text"){const an=typeof $.content=="string"?$.content:((cr=$.content)==null?void 0:cr.teach_content)||((An=$.content)==null?void 0:An.text)||"";return d.jsxs("div",{className:"relative",children:[d.jsx(_y,{value:an,onChange:st=>wn($.id,st),placeholder:"    ...",minHeight:"300px",autoFocus:!0}),d.jsx("div",{className:"mt-3 flex gap-2 justify-end",children:d.jsx("button",{onClick:()=>h(null),className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition-all",children:" "})})]})}if($.type==="text"){const an=typeof $.content=="string"?$.content:((Fr=$.content)==null?void 0:Fr.teach_content)||((ur=$.content)==null?void 0:ur.text)||"";if(!an)return d.jsx("div",{className:"text-slate-400 italic p-4 text-center border-2 border-dashed border-slate-200 rounded-xl cursor-text",onClick:()=>h($.id),children:"   "});if(/<(div|p|h[1-6]|ul|ol|li|strong|em|span|br|table|tr|td|th)[^>]*>/i.test(an.trim())){const jn=an.replace(/<h3[^>]*>.*?<\/h3>/gi,"");return d.jsx("div",{onClick:()=>h($.id),className:"teacher-lesson-content cursor-text hover:ring-2 hover:ring-blue-100 rounded-xl transition-all relative p-2 -m-2",title:" ",children:d.jsx("div",{dangerouslySetInnerHTML:{__html:ko(jn)}})})}return d.jsx("div",{onClick:()=>h($.id),className:"cursor-text hover:ring-2 hover:ring-slate-100 rounded-lg p-2 transition-all -m-2",children:an.split(`
`).map((jn,Fo)=>jn.startsWith("#")?null:d.jsx("p",{className:"mb-2",children:jn},Fo))})}const ee=["multiple-choice","fill_in_blanks","ordering","categorization","memory_game","true_false_speed"].includes($.type),de=Yn.has($.id);if(ee){const an=()=>{Or(st=>{const jn=new Set(st);return jn.has($.id)?jn.delete($.id):jn.add($.id),jn})};return de?d.jsxs("div",{className:"relative",children:[d.jsxs("button",{onClick:an,className:"absolute -top-2 -left-2 z-20 flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white rounded-full text-xs font-bold shadow-lg hover:bg-blue-700 transition-all",children:[d.jsx(Yl,{className:"w-3.5 h-3.5"})," "]}),d.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-xl border-2 border-blue-200",children:[d.jsxs("div",{className:"text-xs text-blue-600 font-bold mb-3 flex items-center gap-2",children:[d.jsx(H6,{className:"w-4 h-4"}),"   -   "]}),$.type==="multiple-choice"&&d.jsx(V6e,{block:$,onAnswer:()=>{},isReviewMode:!0}),$.type==="fill_in_blanks"&&d.jsx(rJ,{block:$,onComplete:()=>{}}),$.type==="ordering"&&d.jsx(sJ,{block:$,onComplete:()=>{}}),$.type==="categorization"&&d.jsx(iJ,{block:$,onComplete:()=>{}}),$.type==="memory_game"&&d.jsx(oJ,{block:$,onComplete:()=>{}})]})]}):d.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-100 transition-colors",onClick:()=>h($.id),children:[$.type==="multiple-choice"&&d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-bold mb-4",dangerouslySetInnerHTML:{__html:ko($.content.question||"")}}),d.jsx("ul",{className:"list-disc pr-5 space-y-2",children:(ii=$.content.options)==null?void 0:ii.map((st,jn)=>d.jsxs("li",{className:st===$.content.correctAnswer?"text-green-600 font-bold":"",children:[typeof st=="string"?st:st.value,st===$.content.correctAnswer&&d.jsx("span",{className:"mr-2 text-xs bg-green-100 px-2 py-0.5 rounded-full",children:"  "})]},jn))})]}),$.type==="fill_in_blanks"&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" "}),d.jsx("p",{className:"text-lg leading-relaxed dir-rtl text-slate-800",children:(((Ta=$.content)==null?void 0:Ta.text)||"").split(/(\[.*?\])/g).map((st,jn)=>st.startsWith("[")?d.jsx("span",{className:"inline-block bg-yellow-100 border-b-2 border-yellow-400 px-2 mx-1 font-bold text-yellow-800",children:st.replace(/[\[\]]/g,"")},jn):d.jsx("span",{dangerouslySetInnerHTML:{__html:ko(st)}},jn))})]}),$.type==="ordering"&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" "}),d.jsx("p",{className:"text-sm text-slate-500 mb-3",children:$.content.instruction||$.content.question}),d.jsx("ol",{className:"list-decimal list-inside space-y-1 text-slate-600 bg-white p-3 rounded-lg border",children:($.content.correct_order||$.content.items||[]).map((st,jn)=>d.jsx("li",{className:"py-1 border-b border-slate-100 last:border-0",children:d.jsx("span",{className:"font-medium",children:typeof st=="string"?st:st.text||st})},jn))}),d.jsx("p",{className:"text-xs text-green-600 mt-2",children:"     "})]}),$.type==="categorization"&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" "}),d.jsx("div",{className:"grid grid-cols-2 gap-4 mt-3",children:(((vd=$.content)==null?void 0:vd.categories)||[]).map((st,jn)=>{var Fo;return d.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[d.jsx("h5",{className:"font-bold text-blue-700 mb-2",children:st}),d.jsx("ul",{className:"text-sm text-slate-600 space-y-1",children:(((Fo=$.content)==null?void 0:Fo.items)||[]).filter(ls=>ls.category===st).map((ls,Xc)=>d.jsx("li",{className:"bg-slate-50 px-2 py-1 rounded",children:ls.text},Xc))})]},jn)})})]}),$.type==="memory_game"&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:" "}),d.jsx("div",{className:"grid grid-cols-2 gap-2 mt-3",children:(((sm=$.content)==null?void 0:sm.pairs)||[]).map((st,jn)=>d.jsxs("div",{className:"flex gap-2 items-center bg-white p-2 rounded-lg border",children:[d.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm font-medium flex-1 text-center",children:st.card_a||st.front}),d.jsx("span",{className:"text-slate-400",children:""}),d.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium flex-1 text-center",children:st.card_b||st.back})]},jn))})]}),$.type==="true_false_speed"&&d.jsxs("div",{children:[d.jsx("h4",{className:"font-bold text-slate-700 mb-2",children:"  "}),d.jsx("ul",{className:"space-y-2 mt-3",children:(((Nf=$.content)==null?void 0:Nf.statements)||[]).map((st,jn)=>d.jsxs("li",{className:"flex items-center gap-3 bg-white p-2 rounded-lg border",children:[d.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${st.isTrue||st.is_true?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:st.isTrue||st.is_true?"":""}),d.jsx("span",{className:"text-slate-700",children:st.text||st.statement})]},jn))})]})]})}if($.type==="open-question")return d.jsxs("div",{onClick:()=>h($.id),className:"cursor-pointer hover:ring-2 hover:ring-blue-100 rounded-xl p-2 transition-all -m-2",children:[d.jsxs("h3",{className:"text-lg font-bold mb-4",children:[" : ",d.jsx("span",{dangerouslySetInnerHTML:{__html:ko($.content.question||"")}})]}),d.jsx("div",{className:"text-sm bg-slate-50 p-4 rounded-lg border-r-2 border-slate-300 leading-relaxed",dangerouslySetInnerHTML:{__html:Jy($.content.model_answer||$.content.modelAnswer)||"   "}})]});if(u===$.id&&$.type==="fill_in_blanks"){const an=((ay=$.content)==null?void 0:ay.text)||"";return d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"mb-2 text-sm text-slate-500",children:"    []    "}),d.jsx(_y,{value:an,onChange:st=>wn($.id,{...$.content,text:st}),placeholder:"     -[ ]  ...",minHeight:"200px",autoFocus:!0}),d.jsx("div",{className:"mt-3 flex gap-2 justify-end",children:d.jsx("button",{onClick:()=>h(null),className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md transition-all",children:" "})})]})}return d.jsxs("div",{className:"bg-slate-50 p-6 rounded-xl border border-slate-200 cursor-pointer hover:bg-slate-100 transition-colors",onClick:()=>h($.id),children:[d.jsx("h3",{className:"font-bold text-slate-700 mb-2",children:dr[$.type]||$.type}),d.jsx("p",{className:"text-slate-500 italic",children:"[ ]"})]})},ll=$=>null;return a?d.jsx("div",{className:"w-full bg-slate-50 border-t border-slate-100 p-4 md:p-8 animate-fade-in",dir:"rtl",children:d.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between mb-6",children:[d.jsxs("h2",{className:"text-xl font-bold text-slate-700 flex items-center gap-2",children:[d.jsx(Yl,{className:"w-5 h-5 text-indigo-500"}),"  "]}),d.jsxs("div",{className:"flex items-center gap-3",children:[I&&d.jsxs("span",{className:"text-xs text-amber-600 font-medium flex items-center gap-1 animate-pulse",children:[d.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"..."]}),!I&&o&&d.jsxs("span",{className:"text-xs text-green-600 font-medium flex items-center gap-1",children:[d.jsx(br,{className:"w-3 h-3"}),""]}),s&&d.jsx("button",{onClick:s,className:"text-sm text-indigo-600 font-bold hover:underline",children:" "})]})]}),d.jsx(Tr,{index:0}),d.jsx("div",{className:"space-y-6",children:(is=n.activityBlocks)==null?void 0:is.map(($,ee)=>{var de,ze,je,wt,dn;return d.jsxs(nt.Fragment,{children:[d.jsxs("div",{className:"bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-slate-100 relative overflow-hidden group hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"absolute top-4 left-4 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 backdrop-blur border border-slate-100 rounded-lg p-1 z-20 shadow-sm",children:[d.jsx("button",{onClick:()=>vn(ee,"up"),disabled:ee===0,className:"p-1 hover:text-blue-600 disabled:opacity-30 rounded hover:bg-blue-50 transition-colors",title:" ",children:d.jsx(U2,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>vn(ee,"down"),disabled:ee===(((de=n.activityBlocks)==null?void 0:de.length)||0)-1,className:"p-1 hover:text-blue-600 disabled:opacity-30 rounded hover:bg-blue-50 transition-colors",title:" ",children:d.jsx(vD,{className:"w-4 h-4"})}),d.jsx("div",{className:"w-px bg-slate-200 my-1 mx-1"}),d.jsx("button",{onClick:()=>bn($.id),className:"p-1 hover:text-red-600 rounded hover:bg-red-50 transition-colors",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]}),d.jsxs("div",{className:"flex items-center gap-3 mb-6 border-b border-slate-50 pb-4",children:[d.jsx("span",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-lg font-black shadow-blue-200 shadow-lg glow",children:d.jsx(gz,{blockType:$.type,blockIndex:ee,totalBlocks:((ze=n.activityBlocks)==null?void 0:ze.length)||1,className:"w-5 h-5"})}),d.jsx("h3",{className:"text-lg font-bold text-slate-800",children:iE($)}),((je=$.metadata)==null?void 0:je.has_variants)&&d.jsxs("div",{className:"flex items-center gap-1.5",children:[d.jsxs("button",{onClick:()=>Tn($),className:"px-2 py-0.5 text-[10px] font-bold bg-blue-100 text-blue-700 rounded-full flex items-center gap-1 hover:bg-blue-200 transition-colors cursor-pointer",title:" -3 ",children:[d.jsx("span",{children:""})," "]}),((wt=$.metadata)==null?void 0:wt.scaffolding_variant)&&d.jsxs("button",{onClick:()=>Tn($),className:"px-2 py-0.5 text-[10px] font-bold bg-emerald-100 text-emerald-700 rounded-full flex items-center gap-1 hover:bg-emerald-200 transition-colors cursor-pointer",title:"  ",children:[d.jsx("span",{children:""})," "]}),((dn=$.metadata)==null?void 0:dn.enrichment_variant)&&d.jsxs("button",{onClick:()=>Tn($),className:"px-2 py-0.5 text-[10px] font-bold bg-purple-100 text-purple-700 rounded-full flex items-center gap-1 hover:bg-purple-200 transition-colors cursor-pointer",title:"  ",children:[d.jsx("span",{children:""})," "]})]}),d.jsxs("button",{onClick:()=>p($.id),className:"mr-auto flex items-center gap-2 px-3 py-1.5 text-slate-500 hover:text-white hover:bg-wizdi-royal rounded-lg transition-all text-xs font-bold bg-slate-50",children:[d.jsx(Hi,{className:"w-3.5 h-3.5"}),"  AI"]}),T===$.id&&k.current[$.id]&&d.jsxs("button",{onClick:()=>Hl($.id),className:"flex items-center gap-2 px-3 py-1.5 text-orange-600 hover:text-white hover:bg-orange-500 rounded-lg transition-all text-xs font-bold bg-orange-50 border border-orange-200",title:"  ",children:[d.jsx(U2,{className:"w-3.5 h-3.5 rotate-180"})," "]})]}),Os($),d.jsx("div",{className:"prose prose-lg max-w-none prose-headings:font-black prose-p:text-slate-600 prose-li:text-slate-600",children:Sa($)}),ll()]}),d.jsx(Tr,{index:ee+1})]},$.id)})}),(!n.activityBlocks||n.activityBlocks.length===0)&&d.jsxs("div",{className:"text-center py-12 text-slate-400",children:[d.jsx($T,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),d.jsx("p",{children:'   .   " " .'})]})]})}):d.jsxs("div",{className:"fixed inset-0 bg-[#f0f4f8] flex font-sans text-slate-800 z-50",dir:"rtl",children:[d.jsxs("div",{className:"w-20 md:w-32 bg-white border-l border-slate-200 flex flex-col items-center py-8 shadow-sm z-10 print:hidden relative",children:[d.jsx("div",{className:"mb-8 p-3 bg-blue-50 rounded-2xl text-blue-600",children:d.jsx(I1,{className:"w-8 h-8"})}),d.jsxs("div",{className:"flex-1 w-full space-y-4 px-2",children:[ka.map($=>{const ee=$.icon;return d.jsxs("button",{onClick:()=>ol($.id),className:`w-full flex flex-col items-center gap-2 p-3 rounded-xl transition-all ${l===$.id?"bg-blue-600 text-white shadow-md":"hover:bg-slate-50 text-slate-400"}`,children:[d.jsx(ee,{className:"w-6 h-6"}),d.jsx("span",{className:"text-[10px] font-bold",children:$.label})]},$.id)}),d.jsx("div",{className:"hidden md:block absolute bottom-8 right-1/2 translate-x-1/2 w-1 h-32 bg-slate-100 rounded-full overflow-hidden",children:d.jsx("div",{className:"w-full h-1/3 bg-green-400 absolute bottom-0"})})]})]}),d.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden relative",children:[d.jsxs("div",{className:"h-20 bg-white border-b border-slate-200 flex items-center justify-between px-8 shadow-sm print:hidden shrink-0 z-20",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("button",{onClick:()=>{console.log(" Back button clicked, onExit:",typeof r),r?r():window.location.href="/"},className:"flex items-center gap-2 p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors",title:" ",children:[d.jsx(G6,{className:"w-5 h-5"}),d.jsx("span",{className:"font-bold text-sm hidden md:inline ml-2",children:""})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-xs font-bold text-blue-600 uppercase tracking-widest",children:((ve=n.metadata)==null?void 0:ve.status)==="generating"?"  ...":"  "}),d.jsx("h1",{className:"text-2xl font-black text-slate-800",children:(Ne=n.title)==null?void 0:Ne.replace(/^ :\s*/i,"")})]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[t&&d.jsxs("button",{onClick:()=>O(!0),className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition shadow-sm border text-indigo-600 bg-indigo-50 border-indigo-200 hover:bg-indigo-100",title:"  ",children:[d.jsx(lpe,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:" "})]}),d.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition shadow-sm border text-emerald-600 bg-emerald-50 border-emerald-200 hover:bg-emerald-100",title:"  -      ",children:[d.jsx(H6,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:" "})]}),d.jsxs("button",{onClick:()=>Ge(!0),className:"flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition shadow-sm border text-purple-600 bg-purple-50 border-purple-200 hover:bg-purple-100",title:"  -      ",children:[d.jsx(ape,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:" "})]}),d.jsxs("button",{onClick:Vn,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition shadow-sm border ${I?"text-amber-600 bg-amber-50 border-amber-200 hover:bg-amber-100":"text-slate-600 hover:bg-slate-50 border-transparent hover:border-slate-200"}`,title:I?"   ...":"  ",children:[d.jsx(xpe,{className:`w-5 h-5 ${I?"animate-pulse":""}`}),d.jsx("span",{className:"hidden md:inline",children:I?"...":""})]}),d.jsxs("button",{onClick:al,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full font-bold transition shadow-sm",title:" -PDF",children:[d.jsx(ype,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:" PDF"})]})]})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-12 print:p-0 bg-[#f0f4f8]",children:d.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 print:max-w-none pb-32",children:[((Qe=n.metadata)==null?void 0:Qe.status)==="generating"&&d.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 p-4 rounded-xl flex items-center gap-4 animate-in fade-in slide-in-from-top-4",children:[d.jsx("div",{className:"p-2 bg-white rounded-full shadow-sm",children:d.jsx(Hi,{className:"w-5 h-5 text-amber-500 animate-spin"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-bold text-amber-800",children:" "}),d.jsx("p",{className:"text-sm text-amber-700",children:"-AI     .   ."})]})]}),d.jsxs("div",{id:"goals",className:"bg-white p-8 rounded-3xl shadow-sm border-t-8 border-blue-500 print:shadow-none print:border scroll-mt-32 relative group hover:shadow-md transition-shadow",children:[!D&&d.jsxs("button",{onClick:()=>G(!0),className:"absolute top-4 left-4 flex items-center gap-2 px-3 py-1.5 text-slate-500 hover:text-white hover:bg-blue-600 rounded-lg transition-all text-xs font-bold bg-slate-50 border border-slate-100 opacity-0 group-hover:opacity-100 print:hidden",children:[d.jsx(Yl,{className:"w-3.5 h-3.5"}),""]}),d.jsxs("h2",{className:"text-xl font-bold text-slate-800 mb-4 flex items-center gap-2",children:[d.jsx(Yq,{className:"text-blue-500 w-6 h-6"})," "]}),D?d.jsxs("div",{className:"space-y-3",children:[J.map(($,ee)=>d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("input",{type:"text",value:$,onChange:de=>lr(ee,de.target.value),className:"flex-1 p-2 border border-slate-200 rounded-lg focus:border-blue-400 outline-none text-slate-600",placeholder:" ...",autoFocus:ee===J.length-1}),d.jsx("button",{onClick:()=>wa(ee),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]},ee)),d.jsxs("div",{className:"flex gap-2 mt-4",children:[d.jsxs("button",{onClick:jo,className:"flex items-center gap-2 px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors text-sm font-bold border border-blue-200",children:[d.jsx($T,{className:"w-4 h-4"})," "]}),d.jsx("div",{className:"flex-1"}),d.jsx("button",{onClick:()=>{Q(n.goals||[]),G(!1)},className:"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-lg transition-colors text-sm font-bold",children:""}),d.jsx("button",{onClick:uo,className:"px-6 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors text-sm font-bold shadow-sm",children:""})]})]}):d.jsx("ul",{className:"space-y-2 text-slate-600 list-disc list-inside cursor-pointer hover:bg-slate-50 rounded-lg p-2 -m-2 transition-colors",onClick:()=>G(!0),children:n.goals&&n.goals.length>0?n.goals.map(($,ee)=>d.jsx("li",{children:$},ee)):d.jsxs(d.Fragment,{children:[d.jsxs("li",{children:["     (",n.title,")."]}),d.jsx("li",{children:"      ."}),d.jsx("li",{children:"     ."})]})})]}),d.jsx(Tr,{index:0}),d.jsx("div",{className:"space-y-8",children:(it=n.activityBlocks)==null?void 0:it.filter($=>$!=null).map(($,ee)=>{var kt,cr,An,Fr;const de=((kt=n.activityBlocks)==null?void 0:kt.length)||0,ze=Bf(ee,de,$.type),je=ee>0?(cr=n.activityBlocks)==null?void 0:cr[ee-1]:null,wt=je?Bf(ee-1,de,je.type):null,dn=ee===0,Ar=ze==="instruction"&&wt!=="instruction"&&wt!==null,as=ze==="practice"&&wt!=="practice",si=ze==="summary"&&wt!=="summary";return d.jsxs(nt.Fragment,{children:[dn&&d.jsx("div",{id:"opening",className:"scroll-mt-32"}),Ar&&d.jsx("div",{id:"instruction",className:"scroll-mt-32"}),as&&d.jsx("div",{id:"practice",className:"scroll-mt-32"}),si&&d.jsx("div",{id:"summary",className:"scroll-mt-32"}),d.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-sm border border-slate-100 print:shadow-none print:break-inside-avoid relative overflow-hidden group hover:shadow-md transition-shadow",children:[d.jsxs("div",{className:"absolute top-4 left-4 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 backdrop-blur border border-slate-100 rounded-lg p-1 z-20 shadow-sm print:hidden",children:[d.jsx("button",{onClick:()=>vn(ee,"up"),disabled:ee===0,className:"p-1 hover:text-blue-600 disabled:opacity-30 rounded hover:bg-blue-50 transition-colors",title:" ",children:d.jsx(U2,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>vn(ee,"down"),disabled:ee===(((An=n.activityBlocks)==null?void 0:An.length)||0)-1,className:"p-1 hover:text-blue-600 disabled:opacity-30 rounded hover:bg-blue-50 transition-colors",title:" ",children:d.jsx(vD,{className:"w-4 h-4"})}),d.jsx("div",{className:"w-px bg-slate-200 my-1 mx-1"}),d.jsx("button",{onClick:()=>bn($.id),className:"p-1 hover:text-red-500 rounded hover:bg-red-50 transition-colors",title:" ",children:d.jsx(lm,{className:"w-4 h-4"})})]}),Me===$.id?d.jsxs("div",{className:"absolute top-6 left-6 bg-purple-100 text-purple-700 text-xs font-bold px-3 py-1 rounded-full print:hidden animate-pulse flex items-center gap-2",children:[d.jsx(H2,{className:"w-4 h-4 animate-spin"}),d.jsx("span",{children:" ..."})]}):d.jsx("div",{className:"absolute top-6 left-6 bg-slate-100 text-slate-500 text-xs font-bold px-3 py-1 rounded-full print:hidden",children:" 5 '"}),d.jsxs("div",{className:"flex items-center gap-3 mb-6 border-b border-slate-50 pb-4",children:[d.jsx("span",{className:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white w-8 h-8 flex items-center justify-center rounded-lg font-black shadow-blue-200 shadow-lg glow",children:d.jsx(gz,{blockType:$.type,blockIndex:ee,totalBlocks:((Fr=n.activityBlocks)==null?void 0:Fr.length)||1,className:"w-5 h-5"})}),d.jsx("h3",{className:"text-lg font-bold text-slate-800",children:iE($)})]}),d.jsx("div",{className:"prose prose-lg max-w-none prose-headings:font-black prose-p:text-slate-600 prose-li:text-slate-600 mb-6",children:Sa($)}),f===$.id&&Os($),f!==$.id&&d.jsxs("div",{className:"flex justify-end gap-2 -mt-4 mb-4",children:[d.jsxs("button",{onClick:()=>p($.id),className:"flex items-center gap-2 px-4 py-2 text-blue-500 hover:text-white hover:bg-blue-600 rounded-lg transition-all text-xs font-bold bg-blue-50 border border-blue-100",children:[d.jsx(Hi,{className:"w-4 h-4"}),"  AI"]}),T===$.id&&k.current[$.id]&&d.jsxs("button",{onClick:()=>Hl($.id),className:"flex items-center gap-2 px-4 py-2 text-orange-600 hover:text-white hover:bg-orange-500 rounded-lg transition-all text-xs font-bold bg-orange-50 border border-orange-200",title:"  ",children:[d.jsx(U2,{className:"w-4 h-4 rotate-180"})," "]})]}),ll()]}),d.jsx(Tr,{index:ee+1})]},$.id)})}),!((Nt=n.activityBlocks)!=null&&Nt.some(($,ee)=>{var dn,Ar;const de=((dn=n.activityBlocks)==null?void 0:dn.length)||0,ze=Bf(ee,de,($==null?void 0:$.type)||""),je=ee>0?(Ar=n.activityBlocks)==null?void 0:Ar[ee-1]:null,wt=je?Bf(ee-1,de,(je==null?void 0:je.type)||""):null;return ze==="instruction"&&wt!=="instruction"&&wt!==null}))&&d.jsx("div",{id:"instruction",className:"scroll-mt-32"}),!((we=n.activityBlocks)!=null&&we.some(($,ee)=>{var ze;const de=((ze=n.activityBlocks)==null?void 0:ze.length)||0;return Bf(ee,de,($==null?void 0:$.type)||"")==="practice"}))&&d.jsx("div",{id:"practice",className:"scroll-mt-32"}),!((Y=n.activityBlocks)!=null&&Y.some(($,ee)=>{var ze;const de=((ze=n.activityBlocks)==null?void 0:ze.length)||0;return Bf(ee,de,($==null?void 0:$.type)||"")==="summary"}))&&d.jsx("div",{id:"summary",className:"scroll-mt-32"})]})})]}),Ae&&d.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:d.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto animate-scale-in",children:[d.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 rounded-t-2xl",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-2xl font-bold",children:"  - "}),d.jsxs("p",{className:"text-sm opacity-90 mt-1",children:[": ",Ae.visualType==="flowchart"?" ":Ae.visualType==="timeline"?" ":Ae.visualType==="comparison"?"":""]})]}),d.jsx("button",{onClick:()=>lt(null),className:"p-2 hover:bg-white/20 rounded-full transition-colors",title:"",children:d.jsx(No,{className:"w-6 h-6"})})]})}),d.jsx("div",{className:"p-6",children:d.jsx("div",{className:"bg-slate-50 rounded-xl p-4 border-2 border-slate-200",children:d.jsx("img",{src:Ae.imageUrl,alt:"   ",className:"w-full h-auto rounded-lg shadow-lg",loading:"lazy",decoding:"async"})})}),d.jsxs("div",{className:"p-6 bg-slate-50 rounded-b-2xl flex gap-3 justify-end border-t",children:[d.jsx("button",{onClick:()=>{Pfe(Ae.visualType),lt(null)},className:"px-6 py-3 bg-white text-slate-700 rounded-lg hover:bg-slate-100 transition-colors font-semibold border border-slate-300",children:""}),d.jsxs("button",{onClick:()=>{const $=Ae.visualType;lt(null),dt(Ae.block.id),console.log(`User wants to try different type from ${$}`)},className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-semibold flex items-center gap-2",children:[d.jsx(Gy,{className:"w-5 h-5"}),"  "]}),d.jsxs("button",{onClick:Ul,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-colors font-semibold flex items-center gap-2 shadow-lg",children:[d.jsx(br,{className:"w-5 h-5"})," "]})]})]})}),ht&&d.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>{Tn(null),mn()},children:d.jsxs("div",{className:"bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",onClick:$=>$.stopPropagation(),children:[d.jsx("div",{className:"bg-gradient-to-r from-blue-600 via-amber-500 to-purple-600 text-white p-6",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsxs("h2",{className:"text-2xl font-bold mb-1 flex items-center gap-3",children:[d.jsx(HT,{className:"w-6 h-6"}),d.jsx(qT,{className:"w-6 h-6"}),d.jsx(GT,{className:"w-6 h-6"})," 3  "]}),d.jsx("p",{className:"text-white/80 text-sm",children:Gt?`  ${Gt===""?"":Gt===""?"":""}`:'  ""    '})]}),d.jsx("button",{onClick:()=>{Tn(null),mn()},className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:d.jsx(No,{className:"w-6 h-6"})})]})}),d.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6 overflow-y-auto max-h-[calc(90vh-180px)]",children:[d.jsxs("div",{className:`bg-blue-50 rounded-xl border-2 overflow-hidden transition-all ${Gt===""?"border-blue-500 ring-2 ring-blue-400":"border-blue-200"}`,children:[d.jsx("div",{className:"bg-blue-500 text-white p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(HT,{className:"w-6 h-6"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold",children:""}),d.jsx("p",{className:"text-xs text-white/80",children:" "})]})]}),d.jsx("div",{className:"flex gap-1",children:!Gt&&d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>Xt(""),className:"p-1.5 hover:bg-white/20 rounded transition-colors",title:"",children:d.jsx(Yl,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>il(""),disabled:er==="",className:"p-1.5 hover:bg-white/20 rounded transition-colors disabled:opacity-50",title:" ",children:er===""?d.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):d.jsx(CD,{className:"w-4 h-4"})})]})})]})}),d.jsx("div",{className:"p-4",children:Gt===""?d.jsxs("div",{className:"space-y-3",children:[typeof bt=="string"?d.jsx(_y,{value:bt,onChange:$t,placeholder:"  ..."}):d.jsx("textarea",{value:JSON.stringify(bt,null,2),onChange:$=>{try{$t(JSON.parse($.target.value))}catch{}},className:"w-full h-48 p-3 text-sm font-mono border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400",dir:"ltr"}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:mn,className:"px-3 py-1.5 text-sm text-slate-600 hover:bg-slate-100 rounded-lg",children:""}),d.jsx("button",{onClick:ss,className:"px-3 py-1.5 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:""})]})]}):(le=ht.metadata)!=null&&le.scaffolding_variant?d.jsxs("div",{className:"prose prose-sm max-w-none",children:[((jt=(qe=(he=ht.metadata)==null?void 0:he.scaffolding_variant)==null?void 0:qe.metadata)==null?void 0:jt.preContext)&&d.jsxs("div",{className:"bg-blue-100 p-3 rounded-lg mb-3 text-sm",children:[d.jsx("strong",{children:" :"})," ",ht.metadata.scaffolding_variant.metadata.preContext]}),d.jsx("div",{className:"text-slate-700",children:typeof ht.metadata.scaffolding_variant.content=="string"?d.jsx("div",{dangerouslySetInnerHTML:{__html:ko(ht.metadata.scaffolding_variant.content)}}):d.jsx("pre",{className:"text-xs bg-slate-100 p-2 rounded overflow-auto",children:JSON.stringify(ht.metadata.scaffolding_variant.content,null,2)})}),((It=(Xe=(yt=(Le=ht.metadata)==null?void 0:Le.scaffolding_variant)==null?void 0:yt.metadata)==null?void 0:Xe.progressiveHints)==null?void 0:It.length)>0&&d.jsxs("div",{className:"mt-3 space-y-2",children:[d.jsx("p",{className:"text-xs font-bold text-blue-700",children:" :"}),ht.metadata.scaffolding_variant.metadata.progressiveHints.map(($,ee)=>d.jsxs("div",{className:"text-xs bg-white p-2 rounded border border-blue-200",children:[ee+1,". ",$]},ee))]})]}):d.jsxs("div",{className:"text-center py-6",children:[d.jsx("p",{className:"text-slate-400 text-sm mb-3",children:"   "}),d.jsx("button",{onClick:()=>il(""),disabled:er==="",className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors disabled:opacity-50",children:er===""?"...":"  "})]})})]}),d.jsxs("div",{className:`bg-amber-50 rounded-xl border-2 overflow-hidden transition-all ${Gt===""?"border-amber-500 ring-2 ring-amber-400":"border-amber-200"}`,children:[d.jsx("div",{className:"bg-amber-500 text-white p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(qT,{className:"w-6 h-6"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold",children:""}),d.jsx("p",{className:"text-xs text-white/80",children:" "})]})]}),!Gt&&d.jsx("button",{onClick:()=>Xt(""),className:"p-1.5 hover:bg-white/20 rounded transition-colors",title:"",children:d.jsx(Yl,{className:"w-4 h-4"})})]})}),d.jsx("div",{className:"p-4",children:Gt===""?d.jsxs("div",{className:"space-y-3",children:[typeof bt=="string"?d.jsx(_y,{value:bt,onChange:$t,placeholder:"  ..."}):d.jsx("textarea",{value:JSON.stringify(bt,null,2),onChange:$=>{try{$t(JSON.parse($.target.value))}catch{}},className:"w-full h-48 p-3 text-sm font-mono border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-400 focus:border-amber-400",dir:"ltr"}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:mn,className:"px-3 py-1.5 text-sm text-slate-600 hover:bg-slate-100 rounded-lg",children:""}),d.jsx("button",{onClick:ss,className:"px-3 py-1.5 text-sm bg-amber-500 text-white rounded-lg hover:bg-amber-600",children:""})]})]}):d.jsx("div",{className:"prose prose-sm max-w-none text-slate-700",children:typeof ht.content=="string"?d.jsx("div",{dangerouslySetInnerHTML:{__html:ko(ht.content)}}):d.jsx("pre",{className:"text-xs bg-slate-100 p-2 rounded overflow-auto",children:JSON.stringify(ht.content,null,2)})})})]}),d.jsxs("div",{className:`bg-purple-50 rounded-xl border-2 overflow-hidden transition-all ${Gt===""?"border-purple-500 ring-2 ring-purple-400":"border-purple-200"}`,children:[d.jsx("div",{className:"bg-purple-500 text-white p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(GT,{className:"w-6 h-6"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold",children:""}),d.jsx("p",{className:"text-xs text-white/80",children:" "})]})]}),d.jsx("div",{className:"flex gap-1",children:!Gt&&d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>Xt(""),className:"p-1.5 hover:bg-white/20 rounded transition-colors",title:"",children:d.jsx(Yl,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>il(""),disabled:er==="",className:"p-1.5 hover:bg-white/20 rounded transition-colors disabled:opacity-50",title:" ",children:er===""?d.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):d.jsx(CD,{className:"w-4 h-4"})})]})})]})}),d.jsx("div",{className:"p-4",children:Gt===""?d.jsxs("div",{className:"space-y-3",children:[typeof bt=="string"?d.jsx(_y,{value:bt,onChange:$t,placeholder:"  ..."}):d.jsx("textarea",{value:JSON.stringify(bt,null,2),onChange:$=>{try{$t(JSON.parse($.target.value))}catch{}},className:"w-full h-48 p-3 text-sm font-mono border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:border-purple-400",dir:"ltr"}),d.jsxs("div",{className:"flex gap-2 justify-end",children:[d.jsx("button",{onClick:mn,className:"px-3 py-1.5 text-sm text-slate-600 hover:bg-slate-100 rounded-lg",children:""}),d.jsx("button",{onClick:ss,className:"px-3 py-1.5 text-sm bg-purple-500 text-white rounded-lg hover:bg-purple-600",children:""})]})]}):(pt=ht.metadata)!=null&&pt.enrichment_variant?d.jsxs("div",{className:"prose prose-sm max-w-none",children:[d.jsx("div",{className:"text-slate-700",children:typeof ht.metadata.enrichment_variant.content=="string"?d.jsx("div",{dangerouslySetInnerHTML:{__html:ko(ht.metadata.enrichment_variant.content)}}):d.jsx("pre",{className:"text-xs bg-slate-100 p-2 rounded overflow-auto",children:JSON.stringify(ht.metadata.enrichment_variant.content,null,2)})}),((tn=(Jt=(ye=ht.metadata)==null?void 0:ye.enrichment_variant)==null?void 0:Jt.metadata)==null?void 0:tn.extensionQuestion)&&d.jsxs("div",{className:"mt-3 bg-purple-100 p-3 rounded-lg text-sm",children:[d.jsx("strong",{children:"  :"})," ",ht.metadata.enrichment_variant.metadata.extensionQuestion]}),((vt=(on=(kn=ht.metadata)==null?void 0:kn.enrichment_variant)==null?void 0:on.metadata)==null?void 0:vt.connectionNote)&&d.jsx("div",{className:"mt-2 text-xs text-purple-600",children:d.jsxs("em",{children:["  : ",ht.metadata.enrichment_variant.metadata.connectionNote]})})]}):d.jsxs("div",{className:"text-center py-6",children:[d.jsx("p",{className:"text-slate-400 text-sm mb-3",children:"   "}),d.jsx("button",{onClick:()=>il(""),disabled:er==="",className:"px-4 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition-colors disabled:opacity-50",children:er===""?"...":"  "})]})})]})]}),d.jsx("div",{className:"bg-slate-100 p-4 text-center text-sm text-slate-600",children:d.jsxs("div",{className:"flex items-center justify-center gap-4 flex-wrap",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(HT,{className:"w-4 h-4 text-blue-500"}),d.jsxs("span",{children:[d.jsx("strong",{children:":"}),"  "]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(qT,{className:"w-4 h-4 text-amber-500"}),d.jsxs("span",{children:[d.jsx("strong",{children:":"}),"  "]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(GT,{className:"w-4 h-4 text-purple-500"}),d.jsxs("span",{children:[d.jsx("strong",{children:":"}),"  "]})]})]})})]})}),Ct&&d.jsx("div",{className:"fixed inset-0 bg-white z-[100] animate-fade-in flex flex-col overflow-y-auto",children:d.jsx(nt.Suspense,{fallback:d.jsx("div",{className:"flex-1 flex items-center justify-center text-blue-600 font-bold",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),"  ..."]})}),children:d.jsx(U6e,{reviewMode:!0,hideReviewHeader:!0,simulateGuest:!0,unitOverride:n,onExitReview:()=>oe(!1)})})}),pe&&d.jsx(nt.Suspense,{fallback:d.jsx("div",{className:"fixed inset-0 bg-gray-900 z-[200] flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-white border-t-transparent rounded-full mx-auto mb-4"}),"  ..."]})}),children:d.jsx(q6e,{unit:n,onClose:()=>Ge(!1)})}),P&&t&&d.jsx(nt.Suspense,{fallback:d.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[d.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto mb-4"}),d.jsx("p",{className:"text-slate-600",children:"..."})]})}),children:d.jsx(H6e,{unit:n,course:t,onClose:()=>O(!1),onSuccess:($,ee)=>{console.log("Activity created:",$,ee)}})})]})},K6e=async n=>{try{const e=await Fw(Zs(Kt,"submissions"),{...n,submittedAt:rd(),status:"submitted",analysisStatus:"pending"});try{const t=or(Kt,"student_assignments",n.assignmentId);await Tb(t,{status:"completed",completedAt:rd(),score:n.score})}catch{}return jfe(n.studentName,n.answers,n.courseTopic||"General Topic").then(async t=>{t&&await Tb(e,{analytics:t,analysisStatus:"completed"})}).catch(t=>console.error("Analysis trigger failed:",t)),{success:!0,id:e.id}}catch(e){throw console.error("Error submitting assignment:",e),e}},Y6e=({block:n,onComplete:e,readOnly:t=!1})=>{const r=nt.useMemo(()=>typeof n.content=="string"?{statement:n.content,answer:!0}:{statement:n.content.statement||n.content.question||"  ?",answer:n.content.answer},[n.content]),{statement:s,answer:i}=r,[o,a]=V.useState(null),[l,c]=V.useState(!1),[u,h]=V.useState(0),f=p=>{if(l||t)return;a(p),c(!0);const y=p===i?100:0;h(y),e&&e(y)};return d.jsxs("div",{className:"max-w-2xl mx-auto p-8 rounded-3xl shadow-xl bg-gradient-to-br from-indigo-600 to-violet-700 dark:from-indigo-800 dark:to-violet-900 text-white relative overflow-hidden",role:"group","aria-labelledby":"truefalse-statement",children:[d.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 motion-reduce:hidden","aria-hidden":"true"}),d.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-pink-500/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 motion-reduce:hidden","aria-hidden":"true"}),d.jsxs("div",{className:"relative z-10 text-center",children:[d.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 px-4 py-1.5 rounded-full text-sm font-bold mb-6 border border-white/20 backdrop-blur-sm shadow-sm",children:[d.jsx(Hi,{className:"w-4 h-4 text-yellow-300","aria-hidden":"true"}),d.jsx("span",{children:"   "})]}),d.jsxs("h3",{id:"truefalse-statement",className:"text-2xl md:text-4xl font-black mb-12 leading-tight drop-shadow-md",children:['"',s,'"']}),d.jsxs("div",{className:"grid grid-cols-2 gap-6 max-w-md mx-auto",role:"radiogroup","aria-label":" ",children:[d.jsxs("button",{onClick:()=>f(!0),disabled:l||t,role:"radio","aria-checked":o===!0,"aria-label":`${l?i===!0?",  ":",  ":""}`,className:`group relative min-h-[128px] rounded-2xl border-b-8 transition-all active:scale-95 active:border-b-0 motion-reduce:transition-none focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-white/50 focus-visible:ring-offset-2 focus-visible:ring-offset-violet-700
                            ${l?i===!0?"bg-green-500 border-green-700 opacity-100 scale-105 shadow-[0_0_30px_rgba(34,197,94,0.5)]":o===!0?"bg-gray-400 border-gray-600 opacity-50":"bg-green-500 border-green-700 opacity-30":"bg-green-500 border-green-700 hover:bg-green-400"}
                        `,children:[d.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[d.jsx("span",{className:"text-3xl mb-1","aria-hidden":"true",children:""}),d.jsx("span",{className:"text-2xl font-black uppercase tracking-wider",children:""})]}),l&&i===!0&&d.jsx("div",{className:"absolute -top-3 -right-3 bg-white text-green-600 w-8 h-8 rounded-full flex items-center justify-center shadow-lg animate-bounce motion-reduce:animate-none","aria-hidden":"true",children:d.jsx(br,{className:"w-5 h-5 stroke-[3]"})})]}),d.jsxs("button",{onClick:()=>f(!1),disabled:l||t,role:"radio","aria-checked":o===!1,"aria-label":` ${l?i===!1?",  ":",  ":""}`,className:`group relative min-h-[128px] rounded-2xl border-b-8 transition-all active:scale-95 active:border-b-0 motion-reduce:transition-none focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-white/50 focus-visible:ring-offset-2 focus-visible:ring-offset-violet-700
                            ${l?i===!1?"bg-red-500 border-red-700 opacity-100 scale-105 shadow-[0_0_30px_rgba(239,68,68,0.5)]":o===!1?"bg-gray-400 border-gray-600 opacity-50":"bg-red-500 border-red-700 opacity-30":"bg-red-500 border-red-700 hover:bg-red-400"}
                        `,children:[d.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[d.jsx("span",{className:"text-3xl mb-1","aria-hidden":"true",children:""}),d.jsx("span",{className:"text-2xl font-black uppercase tracking-wider",children:" "})]}),l&&i===!1&&d.jsx("div",{className:"absolute -top-3 -right-3 bg-white text-red-600 w-8 h-8 rounded-full flex items-center justify-center shadow-lg animate-bounce motion-reduce:animate-none","aria-hidden":"true",children:d.jsx(br,{className:"w-5 h-5 stroke-[3]"})})]})]}),l&&d.jsx("div",{className:"mt-8 animate-fade-in motion-reduce:animate-none",role:"alert","aria-live":"polite",children:d.jsx("div",{className:`inline-block px-6 py-3 min-h-[44px] rounded-xl font-bold text-lg shadow-lg
                            ${o===i?"bg-white text-green-600":"bg-white text-red-500"}
                        `,children:o===i?d.jsxs("span",{className:"flex items-center gap-2",children:[d.jsx("span",{"aria-hidden":"true",children:""}),"  !"]}):d.jsxs("span",{className:"flex items-center gap-2",children:[d.jsx("span",{"aria-hidden":"true",children:""})," ,   ",i?"":" "]})})})]})]})},X6e=({block:n,onComplete:e,isExamMode:t=!1,hints:r=[],onHintUsed:s})=>{const i=V.useRef(Date.now()),o=V.useRef(0),a=V.useRef(0),l=V.useRef(null),c=n.content,{instruction:u,leftItems:h,rightItems:f,correctMatches:p}=c,[g,y]=V.useState([]),[v,b]=V.useState(null),[w,k]=V.useState(!1),[T,R]=V.useState({}),[M,E]=V.useState(0),[I,S]=V.useState(!1),[N,P]=V.useState([]);V.useEffect(()=>{i.current=Date.now(),o.current=0,y([]),b(null),k(!1),R({}),P([...f].sort(()=>Math.random()-.5))},[f]);const O=te=>{if(w)return;if(g.find(ce=>ce.leftId===te)){y(g.filter(ce=>ce.leftId!==te));return}b(te)},D=te=>{if(w||!v)return;const H=g.filter(ce=>ce.rightId!==te&&ce.leftId!==v);H.push({leftId:v,rightId:te}),y(H),b(null)},G=()=>{k(!0),S(!0),o.current+=1;const te={};let H=0;if(g.forEach(xe=>{const W=p.some(dt=>dt.left===xe.leftId&&dt.right===xe.rightId);te[xe.leftId]=W,W&&H++}),R(te),H===p.length&&g.length===p.length&&e){const xe=Ww({isCorrect:!0,attempts:o.current,hintsUsed:a.current,responseTimeSec:(Date.now()-i.current)/1e3});e(xe,{timeSeconds:Math.round((Date.now()-i.current)/1e3),attempts:o.current,hintsUsed:a.current,lastAnswer:g})}},J=()=>{M<r.length&&(E(te=>te+1),a.current+=1,s==null||s())},Q=()=>{k(!1),y([]),b(null),R({})},re=te=>g.some(H=>H.leftId===te),ne=te=>g.some(H=>H.rightId===te);return d.jsxs("div",{className:"w-full mx-auto",ref:l,children:[d.jsx("p",{className:"text-lg text-indigo-800 dark:text-white/90 mb-6 text-right font-bold",children:u}),d.jsxs("div",{className:"flex justify-between gap-8 mb-8",children:[d.jsx("div",{className:"flex-1 space-y-3",children:h.map(te=>{const H=re(te.id),ce=v===te.id;return d.jsx("button",{onClick:()=>O(te.id),disabled:w,className:`w-full p-4 rounded-xl border-2 transition-all text-right font-medium
                                    ${w?T[te.id]===!0?"bg-green-50 border-green-400 text-green-700":T[te.id]===!1?"bg-red-50 border-red-400 text-red-700":"bg-gray-50 border-gray-300 text-gray-600":ce?"bg-blue-100 border-blue-500 text-blue-700 shadow-lg":H?"bg-blue-50 border-blue-400 text-blue-700":"bg-white border-gray-200 hover:border-blue-400 hover:shadow-md text-gray-700"}
                                `,children:d.jsxs("div",{className:"flex items-center justify-between gap-2",children:[d.jsx("span",{children:te.text.includes("$")?d.jsx(U1,{content:te.text,className:"inline"}):te.text}),H&&!w&&d.jsx("span",{className:"text-blue-500",children:""}),w&&T[te.id]===!0&&d.jsx(br,{className:"w-5 h-5 text-green-600"}),w&&T[te.id]===!1&&d.jsx(No,{className:"w-5 h-5 text-red-600"})]})},te.id)})}),d.jsx("div",{className:"flex flex-col justify-center items-center",children:v&&d.jsx("div",{className:"text-blue-500 animate-pulse text-2xl",children:""})}),d.jsx("div",{className:"flex-1 space-y-3",children:N.map(te=>{var xe;const H=ne(te.id),ce=(xe=g.find(W=>W.rightId===te.id))==null?void 0:xe.leftId;return d.jsx("button",{onClick:()=>D(te.id),disabled:w||!v,className:`w-full p-4 rounded-xl border-2 transition-all text-right font-medium
                                    ${w?ce&&T[ce]===!0?"bg-green-50 border-green-400 text-green-700":ce&&T[ce]===!1?"bg-red-50 border-red-400 text-red-700":"bg-gray-50 border-gray-300 text-gray-600":H?"bg-blue-50 border-blue-400 text-blue-700":v?"bg-white border-gray-200 hover:border-blue-400 hover:shadow-md text-gray-700 cursor-pointer":"bg-white border-gray-200 text-gray-700 opacity-60"}
                                `,children:d.jsxs("div",{className:"flex items-center justify-between gap-2",children:[H&&!w&&d.jsx("span",{className:"text-blue-500",children:""}),d.jsx("span",{className:"flex-1",children:te.text.includes("$")?d.jsx(U1,{content:te.text,className:"inline"}):te.text})]})},te.id)})})]}),g.length>0&&!w&&d.jsxs("div",{className:"mb-6 p-4 bg-white/10 rounded-xl",children:[d.jsxs("p",{className:"text-white/80 text-sm mb-2",children:[" (",g.length,"/",h.length,"):"]}),d.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(te=>{const H=h.find(xe=>xe.id===te.leftId),ce=f.find(xe=>xe.id===te.rightId);return d.jsxs("span",{className:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm",children:[H==null?void 0:H.text,"  ",ce==null?void 0:ce.text]},te.leftId)})})]}),!t&&r.length>0&&!w&&d.jsx("div",{className:"mb-6",children:M===0?d.jsx("div",{className:"text-center",children:d.jsx("button",{onClick:J,disabled:!I,className:`px-6 py-2 rounded-full font-medium transition-all ${I?"bg-yellow-500 text-white hover:bg-yellow-600 shadow-md":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:I?"":" (   )"})}):d.jsxs("div",{className:"space-y-2",children:[r.slice(0,M).map((te,H)=>d.jsx("div",{className:"bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsxs("div",{children:[d.jsxs("div",{className:"text-xs text-yellow-700 font-bold mb-1",children:[" ",H+1]}),d.jsx("div",{className:"text-gray-700",children:te})]})]})},H)),M<r.length&&d.jsx("div",{className:"text-center",children:d.jsxs("button",{onClick:J,className:"px-6 py-2 rounded-full font-medium bg-yellow-500 text-white hover:bg-yellow-600",children:["  (",M,"/",r.length,")"]})})]})}),!w&&d.jsx("div",{className:"text-center",children:d.jsx("button",{onClick:G,disabled:g.length===0,className:`px-8 py-3 rounded-full font-bold shadow-lg transition-transform active:scale-95
                            ${g.length>0?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}
                        `,children:""})}),w&&d.jsx("div",{className:"mt-6 animate-fade-in",children:Object.values(T).every(te=>te)&&g.length===p.length?d.jsx("div",{className:"text-center",children:d.jsxs("span",{className:"text-green-400 flex items-center justify-center gap-2 text-lg font-bold",children:[d.jsx(br,{className:"w-6 h-6"}),"  !   "]})}):d.jsxs("div",{className:"space-y-4",children:[d.jsx("div",{className:"text-center",children:d.jsxs("span",{className:"text-red-400 flex items-center justify-center gap-2 text-lg font-bold",children:[d.jsx(No,{className:"w-6 h-6"}),"   "]})}),d.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 space-y-3",children:[d.jsx("p",{className:"text-white/80 text-sm font-medium text-center",children:"   :"}),d.jsx("div",{className:"space-y-2",children:g.map(te=>{const H=h.find(W=>W.id===te.leftId),ce=f.find(W=>W.id===te.rightId),xe=T[te.leftId];return d.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg ${xe?"bg-green-500/20 border border-green-400/50":"bg-red-500/20 border border-red-400/50"}`,children:[d.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[xe?d.jsx(br,{className:"w-5 h-5 text-green-400 flex-shrink-0"}):d.jsx(No,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),d.jsxs("span",{className:"text-white text-sm",children:[H==null?void 0:H.text,"  ",ce==null?void 0:ce.text]})]}),!xe&&d.jsx("span",{className:"text-red-300 text-xs mr-2",children:"  "})]},te.leftId)})}),d.jsx("p",{className:"text-white/70 text-sm text-center mt-3",children:Object.values(T).filter(te=>te).length>0?`! ${Object.values(T).filter(te=>te).length}  ${p.length}  .    .`:"        ."})]}),!t&&r.length>0&&M<r.length&&d.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-400/50 rounded-xl p-4 text-center",children:[d.jsx("p",{className:"text-yellow-200 text-sm mb-2",children:" ?      ."}),d.jsx("button",{onClick:()=>{J(),Q()},className:"bg-yellow-500 text-white px-6 py-2 rounded-full font-medium hover:bg-yellow-600 transition-colors",children:"    "})]}),d.jsx("div",{className:"text-center",children:d.jsxs("button",{onClick:Q,className:"bg-blue-600 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-blue-700",children:["  ",!t&&r.length>0&&M<r.length?" ":""]})})]})})]})},J6e={Dan:"Hcr1PUBJC4hYJ9PyCCpi",Noa:"15jgdbYN49TalaJRlJJw"},Q6e={Dan:"pNInz6obpgDQGcFmaJgB",Noa:"kPzsL2i3teMYv0FxEYQ6"};function aJ(n){const e=(n.match(/[\u0590-\u05FF]/g)||[]).length;(n.match(/[a-zA-Z]/g)||[]).length;const t=n.length;return e/t>.3?"he":"en"}function Z6e(n){return aJ(n)==="he"?J6e:Q6e}const yz={isConfigured:()=>!!jc.currentUser,generateAudioSegment:async n=>{const e=jc.currentUser;if(!e)return console.error("User not authenticated for TTS"),null;const r=Z6e(n.text)[n.speaker],s=aJ(n.text),i=s==="he"?"eleven_multilingual_v2":"eleven_turbo_v2_5";console.log(` Generating audio: ${n.speaker} (${s}) - "${n.text.substring(0,30)}..."`);try{const o=await e.getIdToken(),a=await fetch("/api/elevenlabs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({voiceId:r,text:n.text,modelId:i,voiceSettings:{stability:.5,similarity_boost:.75,style:n.emotion==="Excited"?.8:0}})});if(!a.ok){const c=await a.json().catch(()=>({error:a.statusText}));return console.error("ElevenLabs Proxy Error:",c),null}const l=await a.blob();return URL.createObjectURL(l)}catch(o){return console.error("TTS Network Error:",o),null}}},eCe=({script:n,initialAudioUrl:e,title:t,onAudioGenerated:r})=>{const[s,i]=V.useState(0),[o,a]=V.useState(!1),[l,c]=V.useState(e?{0:e}:{}),[u,h]=V.useState(null),f=V.useRef(null),p=()=>{s<n.lines.length-1?i(v=>v+1):(a(!1),i(0))};V.useEffect(()=>{if(!o)return;(async()=>{const b=n.lines[s];if(l[s]){f.current&&(f.current.src=l[s],f.current.play());return}h(s);const w=await yz.generateAudioSegment(b);h(null),w?(c(k=>({...k,[s]:w})),r&&r(w),f.current&&(f.current.src=w,f.current.play())):(console.error("Failed to generate audio for line",s),a(!1))})()},[s,o]);const g=()=>{var v;o?((v=f.current)==null||v.pause(),a(!1)):a(!0)};if(!yz.isConfigured())return d.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-xl text-center text-sm border border-red-200",children:"   ."});const y=n.lines[s];return d.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 text-white rounded-2xl p-6 shadow-2xl max-w-md mx-auto my-6 border border-gray-700",children:[d.jsxs("div",{className:"flex items-center gap-4 mb-6 border-b border-gray-700 pb-4",children:[d.jsx("div",{className:"bg-purple-500/20 p-3 rounded-full",children:d.jsx(R8,{className:"w-6 h-6 text-purple-400"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-lg",children:t||n.title||"Audio Overview"}),d.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-widest",children:"NotebookLM Deep Dive"})]})]}),d.jsxs("div",{className:"flex justify-between items-end h-32 mb-8 px-4 relative",children:[d.jsxs("div",{className:`transition-all duration-500 flex flex-col items-center gap-2 ${y.speaker==="Dan"?"opacity-100 scale-110":"opacity-40 scale-90 grayscale"}`,children:[d.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center text-2xl shadow-lg shadow-blue-500/50",children:""}),d.jsx("span",{className:"text-xs font-bold text-blue-300",children:""})]}),d.jsx("div",{className:"flex gap-1 items-end h-16 opacity-80 pb-4",children:o&&!u&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-1 bg-purple-500 animate-[bounce_1s_infinite] h-8"}),d.jsx("div",{className:"w-1 bg-purple-500 animate-[bounce_1.2s_infinite] h-12"}),d.jsx("div",{className:"w-1 bg-purple-500 animate-[bounce_0.8s_infinite] h-6"}),d.jsx("div",{className:"w-1 bg-purple-500 animate-[bounce_1.5s_infinite] h-10"})]})}),d.jsxs("div",{className:`transition-all duration-500 flex flex-col items-center gap-2 ${y.speaker==="Noa"?"opacity-100 scale-110":"opacity-40 scale-90 grayscale"}`,children:[d.jsx("div",{className:"w-16 h-16 rounded-full bg-pink-500 flex items-center justify-center text-2xl shadow-lg shadow-pink-500/50",children:""}),d.jsx("span",{className:"text-xs font-bold text-pink-300",children:""})]})]}),d.jsx("div",{className:"bg-black/30 rounded-xl p-4 min-h-[80px] text-center mb-6 relative border border-white/5",children:u===s?d.jsxs("div",{className:"flex justify-center items-center gap-2 text-gray-400 text-sm h-full",children:[d.jsx(Kq,{className:"animate-spin w-4 h-4"}),"  ..."]}):d.jsxs("p",{className:"text-sm md:text-base font-light leading-relaxed direction-rtl",children:['"',y.text,'"']})}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:g,className:`w-14 h-14 rounded-full flex items-center justify-center transition-all bg-white text-black hover:scale-105 active:scale-95 shadow-xl ${o?"bg-purple-400":""}`,children:o?d.jsx("div",{className:"w-4 h-4 bg-black rounded-sm"}):d.jsx("div",{className:"w-0 h-0 border-t-[8px] border-t-transparent border-l-[14px] border-l-black border-b-[8px] border-b-transparent ml-1"})})}),d.jsx("p",{className:"text-center text-[10px] text-gray-500 mt-4",children:"Powered by ElevenLabs & Gemini 1.5 Pro  Auto-detects Hebrew/English"}),d.jsx("audio",{ref:f,onEnded:p,className:"hidden"})]})},tCe=({block:n,onAnswer:e,userAnswer:t,isReadOnly:r})=>{const[s,i]=V.useState(!1),[o,a]=V.useState(null),[l,c]=V.useState(t||null),[u,h]=V.useState(!1),[f,p]=V.useState(0),[g,y]=V.useState(null),v=V.useRef(null),b=V.useRef([]),w=V.useRef(null),k=n.content.maxDuration||60;V.useEffect(()=>()=>{l&&!t&&l.startsWith("blob:")&&URL.revokeObjectURL(l)},[l,t]);const T=async()=>{y(null);try{const I=await navigator.mediaDevices.getUserMedia({audio:!0}),S=new MediaRecorder(I,{mimeType:"audio/webm"});v.current=S,b.current=[],S.ondataavailable=N=>{N.data.size>0&&b.current.push(N.data)},S.onstop=()=>{const N=new Blob(b.current,{type:"audio/webm"});a(N);const P=URL.createObjectURL(N);c(P),I.getTracks().forEach(O=>O.stop())},S.start(),i(!0),p(0),w.current=window.setInterval(()=>{p(N=>N>=k?(R(),N):N+1)},1e3)}catch(I){console.error("Mic Error:",I),y("     .")}},R=()=>{v.current&&s&&(v.current.stop(),i(!1),w.current&&(clearInterval(w.current),w.current=null))},M=()=>{a(null),c(null),y(null),p(0)},E=async()=>{if(o){h(!0),y(null);try{const I="student_"+(Math.random()*1e4).toFixed(0),S=await nG(o,I,"assignment_context");e(S)}catch(I){y(I.message||"  .")}finally{h(!1)}}};return r&&t?d.jsxs("div",{className:"p-4 bg-gray-50 border rounded-lg",children:[d.jsx("h3",{className:"font-bold text-lg mb-2",dangerouslySetInnerHTML:{__html:ko(n.content.question||"")}}),d.jsx("p",{className:"text-sm text-gray-600 mb-4",children:n.content.description}),d.jsx("div",{className:"flex items-center gap-2",children:d.jsx("audio",{controls:!0,src:t,className:"w-full"})})]}):d.jsxs("div",{className:"p-6 bg-white border border-gray-200 rounded-xl shadow-sm",children:[d.jsx("h3",{className:"font-bold text-xl mb-2 text-gray-800",dangerouslySetInnerHTML:{__html:ko(n.content.question||"")}}),n.content.description&&d.jsx("p",{className:"text-gray-600 mb-4",children:n.content.description}),g&&d.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm",children:g}),d.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s&&d.jsxs("div",{className:"text-red-600 font-mono text-xl animate-pulse",children:[f,"s / ",k,"s"]}),l?d.jsxs("div",{className:"w-full flex flex-col gap-4",children:[d.jsx("audio",{controls:!0,src:l,className:"w-full"}),!t&&d.jsxs("div",{className:"flex justify-center gap-4",children:[d.jsx("button",{onClick:M,disabled:u,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200",children:" "}),d.jsx("button",{onClick:E,disabled:u,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:u?"...":" "})]})]}):s?d.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-6 py-3 bg-gray-800 text-white rounded-full hover:bg-gray-900 transition-all shadow-md",children:[d.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-sm"})," "]}):d.jsxs("button",{onClick:T,className:"flex items-center gap-2 px-6 py-3 bg-red-600 text-white rounded-full hover:bg-red-700 transition-all transform hover:scale-105 shadow-md",children:[d.jsx("span",{className:"w-3 h-3 bg-white rounded-full animate-pulse"})," "]})]})]})},nCe={flowchart:{label:" ",emoji:""},timeline:{label:" ",emoji:""},comparison:{label:"",emoji:""},cycle:{label:"",emoji:""}},rCe=({src:n,title:e,caption:t,infographicType:r,className:s=""})=>{const[i,o]=V.useState(!1),[a,l]=V.useState(1),c=r?nCe[r]:null;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 overflow-hidden shadow-sm ${s}`,dir:"rtl",children:[(e||c)&&d.jsxs("div",{className:"p-4 bg-white/80 border-b border-blue-100 flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[c&&d.jsx("span",{className:"text-2xl",children:c.emoji}),d.jsxs("div",{children:[e&&d.jsx("h3",{className:"font-bold text-gray-800",children:e}),c&&d.jsx("span",{className:"text-xs text-blue-600 font-medium",children:c.label})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>l(u=>Math.max(u-.25,.5)),className:"p-2 hover:bg-blue-100 rounded-lg text-gray-600 font-bold",children:""}),d.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[Math.round(a*100),"%"]}),d.jsx("button",{onClick:()=>l(u=>Math.min(u+.25,3)),className:"p-2 hover:bg-blue-100 rounded-lg text-gray-600 font-bold",children:"+"}),d.jsx("button",{onClick:()=>o(!0),className:"p-2 hover:bg-blue-100 rounded-lg text-gray-600",children:""})]})]}),d.jsx("div",{className:"p-4 overflow-auto max-h-[500px] bg-white/50",children:d.jsx("div",{className:"flex justify-center transition-transform",style:{transform:`scale(${a})`,transformOrigin:"center top"},children:d.jsx("img",{src:n,alt:e||"",className:"rounded-xl shadow-lg max-w-full cursor-pointer",onClick:()=>o(!0),loading:"lazy",decoding:"async"})})}),t&&d.jsx("div",{className:"p-3 bg-white/80 border-t border-blue-100 text-center",children:d.jsx("p",{className:"text-sm text-gray-600 italic",children:t})})]}),i&&d.jsxs("div",{className:"fixed inset-0 z-[200] bg-black/90 flex items-center justify-center p-4",onClick:()=>o(!1),children:[d.jsx("button",{onClick:()=>o(!1),className:"absolute top-4 right-4 p-3 bg-white/20 hover:bg-white/30 rounded-full text-white text-xl",children:""}),d.jsx("img",{src:n,alt:e||"",className:"max-w-[90vw] max-h-[85vh] object-contain rounded-lg shadow-2xl",onClick:u=>u.stopPropagation(),loading:"lazy",decoding:"async"})]})]})},sCe=({amount:n,onComplete:e})=>(V.useEffect(()=>{const t=setTimeout(e,1e3);return()=>clearTimeout(t)},[e]),d.jsx("div",{className:"absolute top-1/4 right-10 pointer-events-none z-50 animate-bounce-up",children:d.jsxs("span",{className:"text-4xl font-black text-yellow-400 drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)] header-font",children:["+",n," XP"]})})),iCe=({count:n})=>d.jsxs("div",{className:`flex items-center gap-1 transition-all transform ${n>0?"scale-110":"scale-100 opacity-50"} ${n>=3?"animate-bounce":""}`,children:[d.jsx("span",{className:"text-2xl filter drop-shadow-md",children:""}),d.jsx("span",{className:`text-xl font-black ${n>=3?"text-red-500 drop-shadow-lg":n>0?"text-orange-500":"text-gray-400"}`,children:n})]}),oCe=({assignment:n,onExit:e,onEdit:t,simulateGuest:r=!1})=>{var Ul,ka,_a,Hl,Tr,vs,Yc,Os,Sa,ll,is;const{course:s}=I8(),i=nt.useRef(0);i.current++,V.useEffect(()=>(console.log(` SequentialCoursePlayer MOUNTED. CourseId: ${s==null?void 0:s.id}`),()=>console.log(` SequentialCoursePlayer UNMOUNTED. CourseId: ${s==null?void 0:s.id}`)),[]),(i.current<10||i.current%100===0)&&console.log(` SequentialCoursePlayer Render #${i.current}`,{courseId:s==null?void 0:s.id});const o=Ipe(),{currentUser:a}=kf(),[l,c]=V.useState([]),[u,h]=V.useState(!1),[f,p]=V.useState(!1),g=f||(s==null?void 0:s.mode)==="exam",[y,v]=V.useState(!1),b=!!(s!=null&&s.pdfSource||s!=null&&s.fullBookContent),w=(s==null?void 0:s.showSourceToStudent)&&b;V.useEffect(()=>{if(typeof window<"u"){const ve=new URLSearchParams(window.location.search);ve.get("inspector")==="true"&&h(!0),ve.get("forceExam")==="true"&&(p(!0),console.warn(" Force Exam Mode Active via URL Parameter"))}},[]),V.useEffect(()=>{if(s!=null&&s.syllabus&&s.id!=="loading"){const ve=s.syllabus.flatMap(Ne=>Ne.learningUnits.flatMap(Qe=>Qe.activityBlocks||[]));c(ve)}},[s==null?void 0:s.id]);const[k,T]=V.useState(0),[R,M]=V.useState([]),[E,I]=V.useState(!1),S=l[k],N=k===l.length-1,[P,O]=V.useState({}),[D,G]=V.useState("idle"),[J,Q]=V.useState(null),[re,ne]=V.useState(!1),[te,H]=V.useState(!1),[ce,xe]=V.useState({}),[W,dt]=V.useState({}),[Me,Fe]=V.useState({}),[Ae,lt]=V.useState({}),[sn,un]=V.useState(N1),[Sr,ri]=V.useState(!1),[Yn,Or]=V.useState(!1),[ht,Tn]=V.useState(0),[Gt,Dn]=V.useState(null),[bt,$t]=V.useState(!1),er=((Hl=(_a=(ka=(Ul=s==null?void 0:s.syllabus)==null?void 0:Ul[0])==null?void 0:ka.learningUnits)==null?void 0:_a[0])==null?void 0:Hl.id)||"unknown_lesson",js=qpe((a==null?void 0:a.uid)||"guest",er),[co,Rn]=V.useState([]),[Ct,oe]=V.useState(null),[pe,Ge]=V.useState(.5),[ft,Ye]=V.useState(.5),[tt,bn]=V.useState({});V.useEffect(()=>{var ve,Ne,Qe,it,Nt;if(a!=null&&a.uid){lfe(a.uid).then(Y=>{un(le=>({...le,currentStreak:Y.currentStreak,frozenDays:Y.frozenDays}))});const we=((Qe=(Ne=(ve=l[0])==null?void 0:ve.metadata)==null?void 0:Ne.tags)==null?void 0:Qe[0])||((Nt=(it=l[0])==null?void 0:it.metadata)==null?void 0:Nt.topic)||"general";Qpe(a.uid,we).then(({mastery:Y,accuracy:le})=>{Ge(Y),Ye(le),(Y!==.5||le!==.5)&&(console.log(` Loaded profile: Starting with mastery=${Y.toFixed(2)}, accuracy=${le.toFixed(2)}`),Y>.7?(oe({show:!0,type:"challenge",title:"   ",description:"       !"}),setTimeout(()=>oe(null),3e3)):Y<.35&&(oe({show:!0,type:"info",title:"   ",description:"       "}),setTimeout(()=>oe(null),3e3)))})}},[a==null?void 0:a.uid]),V.useEffect(()=>{var we,Y,le,he,qe,jt,Le,yt;if(!S)return;if(["multiple-choice","open-question","fill_in_blanks","ordering","categorization","memory_game","true_false_speed","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","rating_scale","matrix"].includes(S.type)&&!tt[S.id]){const Xe=!!((we=S.metadata)!=null&&we._id)||!!((Y=S.metadata)!=null&&Y.scaffolding_id),It=!!((le=S.metadata)!=null&&le._id)||!!((he=S.metadata)!=null&&he.enrichment_id);if(Xe||It){const pt=Jpe(S,pe,ft);if(pt!==""){const ye=pt===""?((qe=S.metadata)==null?void 0:qe._variant)||((jt=S.metadata)==null?void 0:jt.scaffolding_variant):((Le=S.metadata)==null?void 0:Le._variant)||((yt=S.metadata)==null?void 0:yt.enrichment_variant);if(ye){const Jt=[...l];Jt[k]=ye,c(Jt),bn(tn=>({...tn,[S.id]:pt})),console.log(` Adaptive: Selected ${pt} variant for block ${S.id}`),console.log("   Original content:",S.content),console.log("   Variant content:",ye.content),auth.currentUser&&(s!=null&&s.id)&&e0e(auth.currentUser.uid,s.id,S.id,pt,pe,ft),pt===""?(oe({show:!0,type:"info",title:"  ",description:"     "}),setTimeout(()=>oe(null),2500)):pt===""&&(oe({show:!0,type:"challenge",title:"  !",description:"   "}),setTimeout(()=>oe(null),2500))}else console.warn(` Variant ${pt} selected but variant block not found in metadata`),bn(Jt=>({...Jt,[S.id]:""}))}else bn(ye=>({...ye,[S.id]:""}))}}const Ne=["text","pdf"],Qe=["multiple-choice","open-question","fill_in_blanks","ordering","categorization","memory_game","true_false_speed","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","rating_scale","matrix"],it=l[k+1];if(!E&&Ne.includes(S.type)&&it&&Qe.includes(it.type)){Fe(Xe=>({...Xe,[S.id]:"viewed"})),M(Xe=>[...Xe,k]),T(Xe=>Xe+1);return}E&&I(!1);const Nt=Me[S.id];Nt?Nt==="viewed"?(G("idle"),Q(null)):(G(Nt),Q(Nt==="success"?"!     .":Nt==="partial"?"!      .":"    .")):(G("idle"),Q(null),lt(It=>({...It,[S.id]:0})),["multiple-choice","open-question","fill_in_blanks","ordering","categorization","memory_game","true_false_speed","matching","highlight","sentence_builder","image_labeling","table_completion","text_selection","rating_scale","matrix"].includes(S.type)&&js.onQuestionStart(S.id,S.type))},[k,S==null?void 0:S.id]);const vn=ve=>{const Ne=(Ae[ve]||0)+1;lt(Qe=>({...Qe,[ve]:Ne})),js.onHintRequested()},wn=ve=>{D==="success"||D==="failure"||D==="partial"||(O(Ne=>({...Ne,[S.id]:ve})),G("ready_to_check"))},tr=V.useCallback(async()=>{var Nt,we,Y,le,he,qe,jt,Le,yt,Xe,It;const ve=P[S.id];if(!ve||ve.trim().length<3)return;H(!0);const Ne=(ce[S.id]||0)+1;xe(pt=>({...pt,[S.id]:Ne}));const Qe=Ui.MAX_ATTEMPTS,it=((Nt=S.metadata)==null?void 0:Nt.progressiveHints)||[];try{const pt=((Le=(jt=(qe=(he=(le=(Y=(we=s==null?void 0:s.syllabus)==null?void 0:we[0])==null?void 0:Y.learningUnits)==null?void 0:le[0])==null?void 0:he.activityBlocks)==null?void 0:qe.filter(kn=>kn.type==="text"))==null?void 0:jt.map(kn=>kn.content))==null?void 0:Le.join(`
`))||"",ye=((yt=S.content)==null?void 0:yt.question)||"",Jt=((Xe=S.metadata)==null?void 0:Xe.modelAnswer)||((It=S.content)==null?void 0:It.modelAnswer)||"";console.log(" Checking open question:",{question:ye,answer:ve,modelAnswer:Jt==null?void 0:Jt.substring(0,50),sourceTextLength:pt.length,attempt:`${Ne}/${Qe}`});const tn=await Dfe(ye,ve,Jt,pt,g?"exam":"learning");if(console.log(" AI Response:",tn),tn.status==="correct"){G("success"),o("success"),Q(tn.feedback||"!  ."),Fe(on=>({...on,[S.id]:"success"}));const kn=Math.max(100-(Ne-1)*20,40);un(on=>({...on,xp:on.xp+kn,gems:on.gems+(Ne===1?2:1)})),Dn({id:Date.now(),amount:kn})}else if(tn.status==="partial")if(Ne>=Qe){G("partial"),Fe(on=>({...on,[S.id]:"partial"})),o("success");const kn=Math.max(50-(Ne-1)*10,25);un(on=>({...on,xp:on.xp+kn,gems:on.gems+1})),Dn({id:Date.now(),amount:kn}),Q(tn.feedback||"  -    !")}else{G("ready_to_check"),o("failure");const kn=Qe-Ne,on=Ae[S.id]||0;on<it.length?(lt(vt=>({...vt,[S.id]:on+1})),Q(`${tn.feedback||"!    ."}
 ${kn} .
  ${on+1}: ${it[on]}`)):Q(`${tn.feedback||"!    ."}
 ${kn} .`)}else if(Ne>=Qe)G("failure"),Fe(kn=>({...kn,[S.id]:"failure"})),o("failure"),it.length>0&&lt(kn=>({...kn,[S.id]:it.length})),Q(` . ${Jt?` : ${c4e(Jt)}`:tn.feedback||"  ."}`);else{G("ready_to_check"),o("failure");const kn=Qe-Ne,on=Ae[S.id]||0;on<it.length?(lt(vt=>({...vt,[S.id]:on+1})),Q(`${tn.feedback||" ."}
 ${kn} .
  ${on+1}: ${it[on]}`)):Q(`${tn.feedback||" ."}
 ${kn} .`)}}catch(pt){console.error(" Error checking open question:",pt),console.error("Error details:",pt==null?void 0:pt.message,pt==null?void 0:pt.code),Q(" .  . "+((pt==null?void 0:pt.message)||""))}finally{H(!1)}},[S,P,s,g,ce,Ae,o]),Xt=V.useCallback(()=>{if(["text","video","image","pdf","gem-link","podcast","activity-intro","scenario-image"].includes(S.type)){Fe(it=>({...it,[S.id]:"viewed"})),lr();return}if(D==="success"||D==="failure"||D==="partial"){lr();return}const Ne=P[S.id];let Qe=!1;if(S.type==="multiple-choice"){if(!Ne)return;Qe=Ne===S.content.correctAnswer}else if(S.type==="open-question"){tr();return}else return;ss(Qe)},[S,P,D,tr]),ss=async ve=>{var Nt,we,Y,le,he,qe,jt;const Ne=(W[S.id]||0)+1;dt(Le=>({...Le,[S.id]:Ne})),Fe(Le=>({...Le,[S.id]:ve?"success":"failure"}));const Qe=Ae[S.id]||0;if(js.onAnswerSubmitted(ve,Ne),!ve&&((we=(Nt=S.metadata)==null?void 0:Nt.adaptive_analysis)!=null&&we.distractor_analysis)){const Le=P[S.id],yt=S.metadata.adaptive_analysis.distractor_analysis.find(Xe=>Xe.option_text===Le);yt!=null&&yt.error_tag&&Rn(Xe=>[...Xe,yt.error_tag])}const it=Ww({isCorrect:ve,attempts:Ne,hintsUsed:Qe});if(console.log(` Scoring: isCorrect=${ve}, attempts=${Ne}/${Ui.MAX_ATTEMPTS}, hints=${Qe}, score=${it}`),ve){G("success"),o("success");const Le=it;let yt=0;it===Ui.CORRECT_FIRST_TRY?yt=2:it>=Ui.RETRY_PARTIAL&&(yt=1),un(It=>({...It,xp:It.xp+Le,gems:It.gems+yt,currentStreak:It.currentStreak+1})),Tn(It=>It+1),Dn({id:Date.now(),amount:Le});let Xe;it===Ui.CORRECT_FIRST_TRY?Xe=["!"," !"," !","!"][Math.floor(Math.random()*4)]:it>=Ui.RETRY_PARTIAL?Qe>0?Xe=`! (${Ui.CORRECT_FIRST_TRY-it}    ${Qe} )`:Xe="! (   )":Xe="!",Q(Xe),a!=null&&a.uid&&lD(a.uid,Le,yt).then(It=>{It&&un(It)})}else{const Le=Ui.MAX_ATTEMPTS,yt=((Y=S.metadata)==null?void 0:Y.progressiveHints)||[];if(Ne>=Le){G("failure"),o("failure"),Tn(0),yt.length>0&&lt(It=>({...It,[S.id]:yt.length}));const Xe=((le=S.content)==null?void 0:le.correctAnswer)||((he=S.content)==null?void 0:he.correct);Q(S.type==="multiple-choice"?` .  : ${Xe}`:` . ${Xe?` : ${Xe}`:"  ."}`)}else{G("ready_to_check"),o("failure"),Tn(0);const It=Ae[S.id]||0;if(It<yt.length){lt(Jt=>({...Jt,[S.id]:It+1}));const pt=yt[It],ye=Le-Ne;Q(` .  ${ye} .
  ${It+1}: ${pt}`)}else{const pt=Le-Ne;Q(` .  ${pt} .  !`)}O(pt=>({...pt,[S.id]:void 0}))}}try{const Le=A_(),Xe=D6().currentUser;Xe&&(s!=null&&s.id)&&zc(Le,"submitAdaptiveAnswer")({userId:Xe.uid,unitId:((jt=(qe=s.syllabus[0])==null?void 0:qe.learningUnits[0])==null?void 0:jt.id)||"unknown_unit",blockId:S.id,score:ve?100:0,isCorrect:ve,metadata:S.metadata}).then(async pt=>{const ye=pt.data;if(ye){console.log(" BKT Update:",ye);const Jt=await zD(S,s==null?void 0:s.targetAudience,(s==null?void 0:s.subject)||"math");FD(Xe.uid,s.id,S.id,pe,ye.mastery||0,ye.action||"continue",ve,Jt),ye.mastery!==void 0&&Xe&&(DD(Xe.uid,Jt,ye.mastery).catch(vt=>console.error("Proficiency Vector update failed:",vt)),Ge(ye.mastery));const tn=Object.values(Me).slice(-5),kn=tn.filter(vt=>vt==="success").length,on=tn.length>0?kn/tn.length:.5;if(Ye(on),ye.action==="remediate"){ne(!0),Q(vt=>(vt||"")+`
   .  ...`);try{const vt=await xD(S,s.title||"General",P[S.id]);vt&&(c($=>{const ee=[...$];return ee.splice(k+1,0,vt),ee}),Q("    .   ."),r0e(Xe.uid,s.id,S.id,vt.id||"remedial",P[S.id]))}catch(vt){console.error("Factory Error:",vt)}finally{ne(!1)}}else if(ye.action==="challenge"||ye.action==="mastered")try{const vt=await jD(ye.action,ye.mastery||0,l,k,S,Xe.uid);console.log(` Adaptive Decision: ${vt.action}`,vt),vt.action==="skip"||vt.action==="skip_to_topic"?(ye.action==="challenge"?t0e(Xe.uid,s.id,vt.skipCount||1):ye.action==="mastered"&&n0e(Xe.uid,s.id,vt.targetTopicId||Jt,ye.mastery||0),vt.toast&&(oe({show:!0,...vt.toast}),setTimeout(()=>oe(null),3e3)),setTimeout(()=>{const $=OD(vt,k,l.length);M(ee=>[...ee,k]),T($)},1500),Q(vt.message||"")):(vt.toast&&(oe({show:!0,...vt.toast}),setTimeout(()=>oe(null),3e3)),Q($=>($||"")+`
`+(vt.message||"")))}catch(vt){console.error("Policy decision error:",vt),ye.action==="challenge"?Q($=>($||"")+`
 !    .`):Q($=>($||"")+`
  !   .`)}}}).catch(pt=>console.error("BKT Sync Failed",pt))}catch(Le){console.error("Adaptive connection error",Le)}},mn=(ve,Ne)=>{Ne!=null&&Ne.hintsUsed&&Ne.hintsUsed>0&&lt(Qe=>({...Qe,[S.id]:Ne.hintsUsed??0})),il(ve)},il=async(ve,Ne)=>{var Nt,we;const Qe=ve===100,it=ve>60;if(Fe(Y=>({...Y,[S.id]:it?"success":"failure"})),it){G("success"),o("success");const Y=ve;let le=0;Qe?le=2:it&&(le=1),un(qe=>({...qe,xp:qe.xp+Y,gems:qe.gems+le,currentStreak:qe.currentStreak+1})),Tn(qe=>qe+1),Dn({id:Date.now(),amount:Y});let he;Qe?he=["!"," !"," !","!"][Math.floor(Math.random()*4)]:ve>=80?he=` !  ${ve} .`:ve>=60?he=`!  ${ve} .    .`:he="!",Q(he),a!=null&&a.uid&&lD(a.uid,Y,le).then(qe=>{qe&&un(qe)})}else G("failure"),o("failure"),Tn(0),Q(` ${ve} .   61  .  !`);try{const Y=A_(),he=D6().currentUser;he&&(s!=null&&s.id)&&zc(Y,"submitAdaptiveAnswer")({userId:he.uid,unitId:((we=(Nt=s.syllabus[0])==null?void 0:Nt.learningUnits[0])==null?void 0:we.id)||"unknown_unit",blockId:S.id,score:ve,isCorrect:it,metadata:S.metadata}).then(async jt=>{const Le=jt.data;if(Le){console.log(" BKT Update:",Le);const yt=await zD(S,s==null?void 0:s.targetAudience,(s==null?void 0:s.subject)||"math");FD(he.uid,s.id,S.id,pe,Le.mastery||0,Le.action||"continue",isCorrect,yt),Le.mastery!==void 0&&he&&(DD(he.uid,yt,Le.mastery).catch(ye=>console.error("Proficiency Vector update failed:",ye)),Ge(Le.mastery));const Xe=Object.values(Me).slice(-5),It=Xe.filter(ye=>ye==="success").length,pt=Xe.length>0?It/Xe.length:.5;if(Ye(pt),Le.action==="remediate"){ne(!0),Q(ye=>(ye||"")+`
   .  ...`);try{const ye=await xD(S,s.title||"General",P[S.id]);ye&&(c(Jt=>{const tn=[...Jt];return tn.splice(k+1,0,ye),tn}),Q("    .   ."))}catch(ye){console.error("Factory Error:",ye)}finally{ne(!1)}}else if(Le.action==="challenge"||Le.action==="mastered")try{const ye=await jD(Le.action,Le.mastery||0,l,k,S,he.uid);console.log(` Adaptive Decision (Complex): ${ye.action}`,ye),ye.action==="skip"||ye.action==="skip_to_topic"?(ye.toast&&(oe({show:!0,...ye.toast}),setTimeout(()=>oe(null),3e3)),setTimeout(()=>{const Jt=OD(ye,k,l.length);M(tn=>[...tn,k]),T(Jt)},1500),Q(ye.message||"")):(ye.toast&&(oe({show:!0,...ye.toast}),setTimeout(()=>oe(null),3e3)),Q(Jt=>(Jt||"")+`
`+(ye.message||"")))}catch(ye){console.error("Policy decision error:",ye),Q(Jt=>(Jt||"")+`
 !`)}}}).catch(jt=>console.error("BKT Sync Failed",jt))}catch(Y){console.error("Adaptive connection error",Y)}},[uo,jo]=V.useState(!1),lr=()=>{N?jo(!0):(M(ve=>[...ve,k]),T(ve=>ve+1))},wa=()=>{if(R.length===0)return;const ve=R[R.length-1];M(Ne=>Ne.slice(0,-1)),I(!0),T(ve)};V.useEffect(()=>{const ve=Ne=>{Ne.key==="Enter"&&Xt()};return window.addEventListener("keydown",ve),()=>window.removeEventListener("keydown",ve)},[Xt]);const ol=()=>{const ve=D==="success"||D==="failure"||D==="partial";let Ne="",Qe="bg-[#0056b3] text-white border-blue-800 hover:bg-blue-700";return["text","video","image","pdf","gem-link","podcast","activity-intro","scenario-image","infographic"].includes(S.type)||["fill_in_blanks","ordering","categorization","memory_game","true_false_speed","audio-response"].includes(S.type)&&!ve?null:(ve?(Ne="",Qe=D==="success"?"bg-[#0056b3] text-white border-blue-800 hover:bg-blue-700":D==="partial"?"bg-amber-500 text-white border-amber-700 hover:bg-amber-400":"bg-orange-500 text-white border-orange-700 hover:bg-orange-400"):D==="idle"&&S.type==="multiple-choice"&&!P[S.id]&&(Qe="bg-slate-700 text-slate-500 border-slate-700 cursor-not-allowed transform-none"),d.jsx("button",{onClick:Xt,disabled:!ve&&D==="idle"&&S.type==="multiple-choice"&&!P[S.id],className:`w-full py-4 rounded-2xl font-black text-xl tracking-wide uppercase transition-all active:translate-y-1 active:border-b-0 border-b-4 shadow-lg animate-pop ${Qe}`,children:Ne},D))},al=ve=>{var Y;const Ne=(Y=ve.metadata)==null?void 0:Y.progressiveHints;if(!Ne||Ne.length===0||g)return null;const Qe=Ae[ve.id]||0,it=Qe>=Ne.length;Me[ve.id];const Nt=!!P[ve.id]||D!=="idle";return Qe===0&&!Nt?null:d.jsxs("div",{className:"mb-6 flex flex-col items-start gap-2 animate-in slide-in-from-top-2",children:[d.jsxs("button",{onClick:()=>vn(ve.id),disabled:it,className:`flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm ${it?"bg-gray-100 text-gray-400 cursor-default":"bg-blue-50 text-blue-600 border border-blue-200 hover:bg-blue-100 hover:scale-105 active:scale-95"}`,children:[d.jsx(Hi,{className:"w-4 h-4"}),Qe===0?" ":it?"  ":" "]}),Qe>0&&d.jsx("div",{className:"space-y-2 w-full max-w-md animate-fade-in mt-2",children:Ne.slice(0,Qe).map((le,he)=>d.jsxs("div",{className:"relative bg-blue-50 border border-blue-200 p-3 pr-4 rounded-xl text-blue-900 text-sm shadow-sm flex gap-3 items-start",children:[d.jsx("span",{className:"font-bold bg-blue-200 text-blue-800 w-5 h-5 rounded-full flex items-center justify-center text-xs flex-shrink-0 mt-0.5",children:he+1}),d.jsx("span",{className:"flex-1",children:le})]},he))})]})},Vn=()=>{var ve,Ne,Qe,it,Nt,we,Y,le,he,qe;switch(S.type){case"multiple-choice":return d.jsxs("div",{className:"space-y-6",children:[al(S),d.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-slate-800 leading-relaxed text-center",dir:"auto",dangerouslySetInnerHTML:{__html:Jy(S.content.question||"")}}),d.jsx("div",{className:"grid gap-4",children:(ve=S.content.options)==null?void 0:ve.map((ye,Jt)=>{const tn=typeof ye=="string"?ye:ye.value||ye.answer,kn=P[S.id]===tn,on=D==="success"||D==="failure"||D==="partial",vt=tn===S.content.correctAnswer,$=on&&kn&&!vt;let ee="border-slate-200 hover:bg-slate-50";return kn&&(ee="border-blue-500 bg-blue-50 text-blue-700 shadow-md ring-2 ring-blue-500/20"),on&&(vt?ee="border-green-500 bg-green-100 text-green-800":$?ee="border-orange-400 bg-orange-50 text-orange-800":ee="opacity-50 grayscale"),d.jsx("button",{disabled:on,onClick:()=>wn(tn),className:`w-full p-5 rounded-2xl text-right font-bold text-lg border-2 transition-all active:scale-95 ${ee}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{children:tn}),on&&vt&&d.jsx(br,{className:"w-6 h-6 text-green-600"}),on&&$&&d.jsx(ED,{className:"w-6 h-6 text-orange-500"})]})},Jt)})})]});case"open-question":const jt=ce[S.id]||0;return d.jsxs("div",{className:"space-y-6 w-full max-w-4xl mx-auto",children:[d.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-slate-800 leading-relaxed text-center",dir:"auto",dangerouslySetInnerHTML:{__html:Jy(S.content.question||"")}}),d.jsx("textarea",{className:`w-full p-4 rounded-2xl border-2 focus:ring-4 min-h-[200px] text-lg resize-none transition-all ${D==="success"?"border-green-400 bg-green-50 focus:border-green-500 focus:ring-green-500/10":J&&D==="ready_to_check"?"border-amber-400 bg-amber-50 focus:border-amber-500 focus:ring-amber-500/10":"border-slate-200 focus:border-blue-500 focus:ring-blue-500/10"}`,placeholder:"   ...",dir:"auto",disabled:D==="success",onChange:ye=>wn(ye.target.value),value:P[S.id]||""}),J&&D!=="failure"&&d.jsx("div",{className:`animate-in slide-in-from-top-2 border-2 rounded-2xl p-4 ${D==="success"?"bg-green-50 border-green-200 text-green-900":"bg-amber-50 border-amber-200 text-amber-900"}`,children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("span",{className:"text-2xl",children:D==="success"?"":""}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"font-bold text-lg mb-1",children:D==="success"?" !":" :"}),d.jsx("p",{className:"whitespace-pre-line",children:J}),jt>0&&D!=="success"&&d.jsxs("p",{className:"text-sm mt-2 text-amber-700",children:[" ",jt,'         ""']})]})]})}),te&&d.jsxs("div",{className:"flex items-center justify-center gap-3 text-blue-600",children:[d.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),d.jsx("span",{className:"font-bold",children:"  ..."})]})]});case"fill_in_blanks":return d.jsx(rJ,{block:S,onComplete:mn});case"ordering":return d.jsx(sJ,{block:S,onComplete:mn});case"categorization":return d.jsx(iJ,{block:S,onComplete:mn});case"memory_game":return d.jsx(oJ,{block:S,onComplete:mn});case"true_false_speed":return d.jsx(Y6e,{block:S,onComplete:mn});case"matching":return d.jsx(X6e,{block:S,onComplete:mn});case"text":return d.jsx("div",{className:"space-y-8 text-right w-full max-w-4xl mx-auto",dir:"rtl",children:d.jsx("div",{className:"text-slate-800 prose prose-lg md:prose-2xl max-w-none prose-headings:text-indigo-600 prose-headings:font-black prose-p:text-slate-700 prose-p:font-bold prose-p:leading-relaxed prose-strong:text-indigo-700",dangerouslySetInnerHTML:{__html:Jy(S.content)}})});case"video":let Le=S.content;return Le.includes("v=")&&(Le=(Ne=Le.split("v=")[1])==null?void 0:Ne.split("&")[0]),Le.includes("youtu.be/")&&(Le=(Qe=Le.split("youtu.be/")[1])==null?void 0:Qe.split("?")[0]),d.jsx("div",{className:"aspect-video w-full rounded-2xl overflow-hidden shadow-lg bg-black",children:d.jsx("iframe",{width:"100%",height:"100%",src:`https://www.youtube.com/embed/${Le}`,title:"Video Lesson",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"border-0"})});case"image":return!S.content||S.content.trim()===""?d.jsxs("div",{className:"flex flex-col items-center gap-6 p-8 text-center bg-gradient-to-br from-green-50 to-emerald-100 rounded-3xl border-2 border-green-200",children:[d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"w-20 h-20 bg-green-500 rounded-full flex items-center justify-center shadow-lg",children:d.jsx(br,{className:"w-10 h-10 text-white"})}),d.jsx(q6,{className:"absolute -top-1 -right-1 w-6 h-6 text-yellow-400 animate-bounce"})]}),d.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"  !"}),d.jsx("p",{className:"text-lg text-slate-600 max-w-md",children:" !     ."}),d.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-2xl p-4 mt-2",children:d.jsxs("p",{className:"text-blue-800 font-bold flex items-center gap-2 justify-center",children:[d.jsx(ID,{className:"w-5 h-5"}),'   " "   ']})})]}):d.jsx("div",{className:"flex flex-col items-center gap-4",children:d.jsx("img",{src:S.content,alt:" ",className:"rounded-2xl shadow-md max-h-[50vh] object-contain",loading:"lazy",decoding:"async"})});case"pdf":return d.jsx("div",{className:"w-full h-[600px] rounded-2xl overflow-hidden shadow-lg border border-slate-200",children:d.jsx("iframe",{src:`${S.content}#toolbar=0`,width:"100%",height:"100%",title:"PDF Viewer",className:"border-0"})});case"gem-link":return d.jsxs("div",{className:"flex flex-col items-center gap-6 p-8 text-center bg-blue-50 rounded-3xl border-4 border-blue-100 border-dashed",children:[d.jsx("div",{className:"text-6xl animate-bounce",children:""}),d.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:" !"}),d.jsx("p",{className:"text-lg text-slate-600 max-w-md",children:"         ."}),d.jsxs("a",{href:S.content,target:"_blank",rel:"noopener noreferrer",className:"bg-blue-600 text-white px-8 py-4 rounded-full font-bold text-xl shadow-lg hover:bg-blue-700 transition transform hover:scale-105 active:scale-95 flex items-center gap-2",children:["  ",d.jsx(I_,{className:"w-5 h-5"})]})]});case"podcast":return d.jsx(eCe,{script:S.content.script,initialAudioUrl:S.content.audioUrl,title:S.content.title});case"infographic":const yt=typeof S.content=="string"?S.content:((it=S.content)==null?void 0:it.imageUrl)||((Nt=S.metadata)==null?void 0:Nt.uploadedFileUrl)||"",Xe=typeof S.content=="object"?(we=S.content)==null?void 0:we.title:void 0,It=typeof S.content=="object"?(Y=S.content)==null?void 0:Y.caption:(le=S.metadata)==null?void 0:le.caption,pt=((he=S.metadata)==null?void 0:he.infographicType)||(typeof S.content=="object"?(qe=S.content)==null?void 0:qe.visualType:void 0);return yt?d.jsx(rCe,{src:yt,title:Xe,caption:It,infographicType:pt}):d.jsx("div",{className:"p-10 text-center text-gray-500",children:"  "});case"activity-intro":{const ye=S.content;return ye!=null&&ye.imageUrl?d.jsx("div",{className:"mb-4",children:d.jsx("div",{className:"rounded-2xl overflow-hidden shadow-lg",children:d.jsx("img",{src:ye.imageUrl,alt:ye.title||" ",className:"w-full h-56 md:h-72 object-cover",loading:"lazy"})})}):d.jsx("div",{className:"p-10 text-center text-gray-500",children:"   "})}case"scenario-image":{const ye=S.content;return ye!=null&&ye.imageUrl?d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 shadow-sm",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3 text-amber-700",children:[d.jsx("span",{className:"text-xl",children:""}),d.jsx("span",{className:"font-medium",children:" :"})]}),d.jsx("img",{src:ye.imageUrl,alt:ye.caption||" ",className:"w-full max-h-64 object-contain rounded-xl bg-white",loading:"lazy"}),ye.caption&&d.jsx("p",{className:"mt-3 text-center text-amber-800 font-medium",children:ye.caption})]})}):d.jsx("div",{className:"p-10 text-center text-gray-500",children:"  "})}case"audio-response":return d.jsx(tCe,{block:S,onAnswer:ye=>mn(100)});default:return d.jsxs("div",{className:"p-10 text-center text-gray-500",children:["Feature coming soon: ",S.type]})}},Oo=async()=>{if(console.log(" handleSubmitActivity called!",{isSubmitting:Sr,hasSubmitted:Yn,courseId:s==null?void 0:s.id}),Sr||Yn){console.log(" Submission blocked - isSubmitting:",Sr,"hasSubmitted:",Yn);return}const ve=s==null?void 0:s.id;if(!ve){console.log(" No courseId found!"),alert(":    ");return}const Ne=l.length,Qe=Object.keys(Me).length,it=Object.values(Me).filter(he=>he==="success").length,Nt=Object.values(Me).filter(he=>he==="failure").length;let we=0,Y=0;l.forEach(he=>{["text","video","image","pdf","gem-link","podcast","activity-intro","scenario-image"].includes(he.type)?(Y+=50,Me[he.id]==="viewed"&&(we+=50)):(Y+=100,Me[he.id]==="success"?we+=100:Me[he.id]==="failure"&&(we+=0))});const le=Y>0?Math.round(we/Y*100):0;ri(!0);try{const he={assignmentId:ve,courseId:ve,studentName:(a==null?void 0:a.displayName)||(a==null?void 0:a.email)||"",answers:P,score:le,maxScore:100,courseTopic:(s==null?void 0:s.title)||" ",telemetry:{stepResults:Me,hintsUsed:Ae,totalBlocks:Ne,completedBlocks:Qe,successBlocks:it,failureBlocks:Nt,gamificationProfile:{xp:sn.xp,gems:sn.gems,streak:sn.currentStreak},completedAt:new Date().toISOString()}};console.log(" Submitting data:",he);const qe=await K6e(he);console.log(" Submission result:",qe),qe.success&&(Or(!0),o("success"),alert(`  ! : ${le}%`))}catch(he){console.error(" Submission error:",he),alert("  .  .")}finally{ri(!1)}},Ri=(vs=(Tr=s==null?void 0:s.wizardData)==null?void 0:Tr.settings)==null?void 0:vs.productType,Kc=!s||s.id==="loading";if(console.log(" SequentialCoursePlayer: courseId:",s==null?void 0:s.id,"productType:",Ri,"isCourseLoading:",Kc),Kc)return console.log(" SequentialCoursePlayer: Course still loading from Firestore..."),d.jsx("div",{className:"h-screen w-full bg-blue-600 flex items-center justify-center text-white font-bold text-2xl animate-pulse",children:" ..."});if((Ri==="lesson"||Ri==="podcast")&&!f&&!u){const ve=(Sa=(Os=(Yc=s==null?void 0:s.syllabus)==null?void 0:Yc[0])==null?void 0:Os.learningUnits)==null?void 0:Sa[0];if(ve){const Ne=()=>{console.log(" SequentialCoursePlayer TeacherCockpit onExit called"),e?e():window.history.length>1?window.history.back():window.location.href="/"};return d.jsx(W6e,{unit:ve,courseId:s==null?void 0:s.id,onExit:Ne,onEdit:t})}}return S?d.jsxs("div",{className:"fixed inset-0 bg-[#3565e3] flex flex-col font-sans overflow-hidden",dir:"rtl",children:[d.jsx("div",{className:"flex-none p-4 pt-20 md:pt-32 pb-2 z-10",children:d.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between text-white bg-[#3565e3] pb-4 border-b border-white/10",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:Oo,disabled:Sr||Yn,className:`flex items-center gap-2 px-5 py-2.5 rounded-2xl font-bold transition-all shadow-lg transform hover:scale-105 active:scale-95 ${Yn?"bg-green-500 text-white cursor-default":Sr?"bg-white/30 text-white/70 cursor-wait":"bg-gradient-to-r from-green-400 to-emerald-500 text-white hover:from-green-500 hover:to-emerald-600 border border-green-300/30"}`,title:" ",children:Yn?d.jsxs(d.Fragment,{children:[d.jsx(br,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:""})]}):Sr?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"}),d.jsx("span",{className:"hidden md:inline",children:"..."})]}):d.jsxs(d.Fragment,{children:[d.jsx(ND,{className:"w-5 h-5"}),d.jsx("span",{className:"hidden md:inline",children:" "})]})}),d.jsxs("button",{onClick:()=>{e?e():window.history.length>1?window.history.back():window.location.hash="#/"},className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-xl transition text-white border border-white/20",title:" ",children:[d.jsx(G6,{className:"w-5 h-5"}),d.jsx("span",{className:"font-bold text-sm hidden sm:inline",children:""})]}),w&&d.jsxs("button",{onClick:()=>v(!y),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition border ${y?"bg-white text-blue-600 border-white":"bg-white/10 hover:bg-white/20 text-white border-white/20"}`,title:y?" ":" ",children:[d.jsx(I1,{className:"w-5 h-5"}),d.jsx("span",{className:"font-bold text-sm hidden sm:inline",children:y?" ":" "})]}),d.jsxs("div",{className:"flex flex-col text-right",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-sm font-bold opacity-80 uppercase tracking-widest",children:(a==null?void 0:a.displayName)||""}),d.jsx(ID,{className:"w-4 h-4 opacity-70"})]}),d.jsxs("span",{className:"text-xl font-black font-mono",dir:"ltr",children:[k+1," / ",l.length]})]})]}),d.jsx("div",{className:"flex-1 mx-4 max-w-lg hidden md:flex items-center gap-4",children:d.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[d.jsx("div",{className:"flex items-center justify-center gap-1",children:l.map((ve,Ne)=>{const Qe=Ne<k,it=Ne===k,Nt=Me[ve.id];let we="bg-white/30";return it?we="bg-yellow-400 ring-2 ring-yellow-300 ring-offset-1 ring-offset-blue-600":Qe&&(Nt==="success"?we="bg-green-400":Nt==="failure"?we="bg-red-400":we="bg-green-400"),d.jsx("div",{className:`w-2.5 h-2.5 rounded-full transition-all duration-300 ${we} ${it?"scale-125":""}`},`dot-${ve.id}`)})}),d.jsxs("div",{className:"text-center text-white/80 text-sm font-medium",children:[" ",k+1,"  ",l.length]})]})}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2 bg-black/20 px-4 py-2 rounded-2xl border border-white/5 backdrop-blur-md shadow-lg transform hover:scale-105 transition-all",children:[d.jsx(iCe,{count:sn.currentStreak}),d.jsx("span",{className:"text-xs font-bold text-white/70 uppercase tracking-wider",children:""})]}),d.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-br from-yellow-400/20 to-orange-500/20 px-4 py-2 rounded-2xl border border-yellow-400/30 backdrop-blur-md shadow-lg transform hover:scale-105 transition-all",children:[d.jsx(q6,{className:"w-5 h-5 text-yellow-300 drop-shadow-md"}),d.jsx("span",{className:"font-black text-yellow-300 font-mono text-xl drop-shadow-sm",children:sn.xp}),d.jsx("span",{className:"text-xs font-bold text-yellow-200 uppercase tracking-wider",children:""})]}),d.jsxs("button",{onClick:()=>$t(!0),className:"flex items-center gap-2 bg-gradient-to-br from-blue-400/20 to-cyan-500/20 px-4 py-2 rounded-2xl border border-cyan-400/30 backdrop-blur-md shadow-lg transform hover:scale-105 transition-all outline-none focus:ring-2 focus:ring-cyan-400",children:[d.jsx("span",{className:"text-xl",children:""}),d.jsx("span",{className:"font-black text-cyan-300 font-mono text-xl drop-shadow-sm",children:sn.gems})]})]})]})}),d.jsxs("div",{className:`flex-1 overflow-hidden flex transition-all duration-300 ${D==="success"||D==="failure"||D==="partial"?"pb-48":"pb-32"}`,children:[y&&w&&d.jsxs("div",{className:"w-1/2 h-full bg-white/95 backdrop-blur border-l border-white/20 flex flex-col animate-in slide-in-from-right duration-300 z-10",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50 shrink-0",children:[d.jsxs("h3",{className:"font-bold text-gray-700 flex items-center gap-2",children:[d.jsx(I1,{className:"w-5 h-5 text-blue-500"})," "]}),d.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:d.jsx(No,{className:"w-5 h-5 text-gray-500"})})]}),d.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:s!=null&&s.pdfSource?d.jsxs("div",{className:"h-full flex flex-col",children:[d.jsx("iframe",{src:s.pdfSource,className:"w-full flex-1 border-none",title:" "}),d.jsx("div",{className:"p-3 bg-white border-t text-center",children:d.jsx("a",{href:s.pdfSource,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:"     "})})]}):null})]}),d.jsx("div",{className:`${y&&w?"w-1/2":"w-full"} overflow-y-auto p-4 pt-4 md:pt-12 scrollbar-none [&::-webkit-scrollbar]:hidden`,children:d.jsxs("div",{className:`${y&&w?"max-w-2xl":"max-w-6xl"} mx-auto`,children:[Gt&&d.jsx(sCe,{amount:Gt.amount,onComplete:()=>Dn(null)}),(()=>{const ve=l[k-1],Ne=!["text","video","image","pdf","gem-link","podcast"].includes(S.type);return ve&&["text","pdf"].includes(ve.type)&&Ne&&!y?d.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6 lg:min-h-[500px]",children:[d.jsx("div",{className:"lg:flex-1 lg:w-1/2 bg-white/90 backdrop-blur rounded-[32px] shadow-xl p-4 md:p-6 lg:p-8 overflow-y-auto border-4 border-white/50 max-h-[40vh] lg:max-h-[70vh] lg:min-h-[400px]",children:ve.type==="pdf"?d.jsx("iframe",{src:`${ve.content}#toolbar=0`,width:"100%",height:"100%",title:"PDF Context",className:"border-0 rounded-xl min-h-[250px] lg:min-h-[350px]"}):d.jsx("div",{className:"prose prose-lg lg:prose-xl prose-indigo max-w-none text-slate-800 dir-rtl",dangerouslySetInnerHTML:{__html:Jy(ve.content)}})}),d.jsx("div",{className:"lg:flex-1 lg:w-1/2 bg-white rounded-[32px] shadow-2xl p-4 md:p-6 lg:p-8 flex flex-col justify-center animate-in slide-in-from-right-8 duration-500",children:Vn()})]}):d.jsx("div",{className:`bg-white rounded-[32px] shadow-2xl overflow-hidden min-h-[500px] flex flex-col relative animate-in zoom-in-95 duration-300 ${y?"max-w-full":"max-w-5xl"} mx-auto w-full`,children:d.jsx("div",{className:"p-8 md:p-12 flex-1 flex flex-col justify-center",children:Vn()})})})()]})})]}),uo&&d.jsx(Sme,{onContinue:async()=>{var ve,Ne,Qe,it;if(a!=null&&a.uid&&!r)try{const Nt=js.getSessionSummary(),we=((it=(Qe=(Ne=(ve=s==null?void 0:s.syllabus)==null?void 0:ve[0])==null?void 0:Ne.learningUnits)==null?void 0:Qe[0])==null?void 0:it.title)||(s==null?void 0:s.title)||"general";console.log(" Saving session to profile:",{userId:a.uid,lessonId:er,questions:Nt.summary.total_questions,correct:Nt.summary.correct_answers,hintsUsed:Nt.summary.total_hints_used,errorTags:co.length}),await Hpe(a.uid,Nt,we,co),console.log(" Profile updated successfully")}catch(Nt){console.error(" Failed to save session to profile:",Nt)}jo(!1),e&&e()},onReview:()=>{jo(!1)},xpGained:sn.xp,gemsGained:sn.gems}),d.jsx("div",{className:`fixed bottom-0 left-0 right-0 p-4 transition-transform duration-300 z-20 ${D==="success"?"bg-[#d7ffb8] translate-y-0":D==="partial"?"bg-amber-100 translate-y-0":D==="failure"?"bg-orange-100 translate-y-0":"bg-[#3565e3] border-t border-white/10 backdrop-blur-lg translate-y-0"}`,children:d.jsxs("div",{className:"max-w-4xl mx-auto flex flex-row items-end justify-between gap-4",children:[d.jsx("div",{className:"flex items-center gap-2 order-1",children:k>0&&d.jsx("button",{onClick:wa,className:"p-4 rounded-full bg-white/95 hover:bg-white text-blue-600 transition-all active:scale-95 shadow-lg border-2 border-white/50",children:d.jsx(G6,{className:"w-8 h-8"})})}),d.jsxs("div",{className:"flex-1 w-full flex items-center justify-center gap-4 order-2",children:[D==="success"||D==="failure"||D==="partial"?d.jsxs("div",{className:"flex-1 animate-in slide-in-from-bottom-5 fade-in",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[d.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${D==="success"?"bg-green-500":D==="partial"?"bg-amber-500":"bg-orange-500"}`,children:D==="success"?d.jsx(br,{className:"w-6 h-6 text-white"}):D==="partial"?d.jsx(Hi,{className:"w-6 h-6 text-white"}):d.jsx(ED,{className:"w-6 h-6 text-white"})}),d.jsx("h3",{className:`text-3xl font-black ${D==="success"?"text-green-800":D==="partial"?"text-amber-800":"text-orange-800"}`,children:D==="success"?"!":D==="partial"?"!":" "})]}),J&&d.jsx("p",{className:`text-lg font-medium whitespace-pre-line break-words max-w-prose ${D==="success"?"text-green-700":D==="partial"?"text-amber-700":"text-orange-700"}`,children:J}),d.jsx("div",{className:"mt-2 text-right",children:d.jsx(Mpe,{courseId:s.id,unitId:((is=(ll=s.syllabus[0])==null?void 0:ll.learningUnits[0])==null?void 0:is.id)||"unknown",blockId:S.id,blockType:S.type,userId:(a==null?void 0:a.uid)||"anonymous"})})]}):d.jsx("div",{className:"flex-1"}),d.jsx("div",{className:"w-full",children:ol()})]}),d.jsx("div",{className:"flex items-center gap-2 order-3",children:!N&&d.jsx("button",{onClick:lr,className:"p-4 rounded-full bg-white/95 hover:bg-white text-blue-600 transition-all active:scale-95 shadow-lg border-2 border-white/50",children:d.jsx(ND,{className:"w-8 h-8"})})})]})}),re&&d.jsx(Lpe,{}),(Ct==null?void 0:Ct.show)&&d.jsx("div",{className:"fixed top-24 left-1/2 transform -translate-x-1/2 z-50 animate-in slide-in-from-top-5 fade-in duration-500",children:d.jsxs("div",{className:`px-6 py-4 rounded-2xl shadow-2xl border-2 flex items-center gap-4 min-w-[300px] ${Ct.type==="challenge"?"bg-gradient-to-r from-purple-500 to-indigo-600 border-purple-300 text-white":Ct.type==="success"?"bg-gradient-to-r from-green-500 to-emerald-600 border-green-300 text-white":"bg-gradient-to-r from-blue-500 to-cyan-600 border-blue-300 text-white"}`,children:[d.jsx("span",{className:"text-3xl",children:Ct.type==="challenge"?"":Ct.type==="success"?"":""}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"font-black text-lg",children:Ct.title}),d.jsx("p",{className:"text-sm opacity-90",children:Ct.description})]})]})}),d.jsx(l0e,{isOpen:bt,onClose:()=>$t(!1),currentGems:sn.gems,frozenDays:sn.frozenDays,onPurchaseComplete:ve=>{un(Ne=>({...Ne,gems:ve,frozenDays:Ne.frozenDays+1}))}})]}):d.jsx("div",{className:"h-screen w-full bg-blue-600 flex items-center justify-center text-white font-bold text-2xl animate-pulse",children:" ..."})},xz={tool:{label:" ",icon:"",color:"bg-blue-100 text-blue-700"},research:{label:"",icon:"",color:"bg-purple-100 text-purple-700"},tip:{label:" ",icon:"",color:"bg-amber-100 text-amber-700"},trend:{label:"",icon:"",color:"bg-green-100 text-green-700"}};async function bz(n=5){try{const e=Zs(Kt,"aiBlog"),t=Uh(e,Ow("createdAt","desc"),q3(n)),r=await Hh(t),s=[];return r.forEach(i=>{s.push({id:i.id,...i.data()})}),s}catch(e){return console.error("Error fetching blog articles:",e),[]}}async function vz(){try{const n=Zs(Kt,"aiBlog"),e=Uh(n,Ow("createdAt","desc"),q3(1)),t=await Hh(e);if(t.empty)return null;const r=t.docs[0];return{id:r.id,...r.data()}}catch(n){return console.error("Error fetching featured article:",n),null}}async function aCe(n=!1){try{return(await zc(af,"triggerBlogArticleGeneration")({forceRegenerate:n})).data}catch(e){throw console.error("Error triggering blog generation:",e),e}}const lCe=({maxItems:n=3,showFeatured:e=!0,compact:t=!1})=>{const[r,s]=V.useState([]),[i,o]=V.useState(null),[a,l]=V.useState(!0),[c,u]=V.useState(null),[h,f]=V.useState(!1),p=async()=>{f(!0);try{const b=await aCe(!0);console.log("Blog generation result:",b);const w=await bz(n);if(s(w),e){const k=await vz();o(k)}}catch(b){console.error("Error generating articles:",b)}finally{f(!1)}};V.useEffect(()=>{(async()=>{l(!0);try{if(e){const T=await vz();o(T)}const w=await bz(n),k=e&&i?w.filter(T=>T.id!==(i==null?void 0:i.id)):w;s(k.slice(0,n))}catch(w){console.error("Error fetching blog articles:",w)}finally{l(!1)}})()},[n,e]);const g=b=>b?(b.toDate?b.toDate():new Date(b)).toLocaleDateString("he-IL",{day:"numeric",month:"short"}):"",y=b=>xz[b]||xz.tip;if(a)return d.jsx("div",{className:"card-glass rounded-3xl p-6 h-full",children:d.jsxs("div",{className:"animate-pulse space-y-4",children:[d.jsx("div",{className:"h-6 bg-slate-200 rounded w-1/3"}),d.jsx("div",{className:"h-32 bg-slate-100 rounded-xl"}),d.jsx("div",{className:"h-20 bg-slate-100 rounded-xl"})]})});if(!i&&r.length===0)return d.jsxs("div",{className:"card-glass rounded-3xl p-6 h-full",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-teal-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg",children:d.jsx(q4,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:" AI"}),d.jsx("p",{className:"text-xs text-slate-400",children:" "})]})]}),d.jsxs("div",{className:"text-center py-8",children:[d.jsx(x0e,{className:"w-12 h-12 text-slate-300 mx-auto mb-3"}),d.jsx("p",{className:"text-slate-500 text-sm",children:" "}),d.jsx("p",{className:"text-slate-400 text-xs mb-4",children:"   "}),d.jsxs("button",{onClick:p,disabled:h,className:"px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-xl hover:bg-purple-700 transition-colors disabled:opacity-50 flex items-center gap-2 mx-auto",children:[d.jsx(tG,{className:`w-4 h-4 ${h?"animate-spin":""}`}),h?" ...":"  "]})]})]});const v=i||r[0];return t?d.jsxs("div",{className:"card-glass rounded-2xl p-5",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-teal-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg",children:d.jsx(q4,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:" AI"}),d.jsx("p",{className:"text-xs text-slate-400",children:" "})]})]}),v&&d.jsxs("div",{className:"space-y-3",children:[v.imageUrl&&d.jsxs("div",{className:"relative rounded-xl overflow-hidden",children:[d.jsx("img",{src:v.imageUrl,alt:v.title,className:"w-full h-32 object-cover"}),d.jsx("div",{className:"absolute top-2 right-2",children:d.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y(v.category).color}`,children:[y(v.category).icon," ",v.categoryLabel]})})]}),!v.imageUrl&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y(v.category).color}`,children:[y(v.category).icon," ",v.categoryLabel]}),d.jsxs("span",{className:"flex items-center gap-1 text-xs text-slate-400",children:[d.jsx(tS,{className:"w-3 h-3"}),v.readingTime," "]})]}),d.jsx("h4",{className:"font-bold text-slate-800 text-base leading-snug",children:v.title}),v.keyPoints&&v.keyPoints.length>0&&d.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 border border-slate-100",children:[d.jsx("h5",{className:"font-semibold text-slate-600 text-xs mb-2",children:" "}),d.jsx("ul",{className:"space-y-1.5",children:v.keyPoints.slice(0,3).map((b,w)=>d.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-700",children:[d.jsx("span",{className:"flex-shrink-0 w-5 h-5 bg-slate-200 text-slate-600 rounded-full flex items-center justify-center font-medium text-xs",children:w+1}),d.jsx("span",{className:"leading-snug",children:b})]},w))})]}),d.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:v.summary}),v.classroomTips&&v.classroomTips.length>0&&d.jsxs("div",{className:"bg-blue-50/50 rounded-xl p-3 border border-blue-100",children:[d.jsx("h5",{className:"font-semibold text-blue-700 text-xs mb-2",children:" "}),d.jsx("ul",{className:"space-y-1",children:v.classroomTips.slice(0,2).map((b,w)=>d.jsxs("li",{className:"text-sm text-slate-600",children:[w+1,". ",b]},w))})]}),d.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100",children:[d.jsx("span",{className:"text-xs text-slate-400",children:v.sourceName}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("a",{href:`https://translate.google.com/translate?sl=en&tl=he&u=${encodeURIComponent(v.originalUrl)}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-slate-500 hover:text-slate-700 text-xs",title:" ",children:d.jsx(Y6,{className:"w-4 h-4"})}),d.jsxs("a",{href:v.originalUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 bg-slate-700 hover:bg-slate-800 text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",children:[" ",d.jsx(BD,{className:"w-3 h-3"})]})]})]})]})]}):d.jsxs("div",{className:"card-glass rounded-2xl p-5 h-full",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-wizdi-royal to-wizdi-cyan rounded-2xl flex items-center justify-center shadow-lg",children:d.jsx(q4,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"font-bold text-slate-800 dark:text-white",children:" AI"}),d.jsx("p",{className:"text-xs text-slate-400",children:" "})]})]}),v&&d.jsxs("div",{className:`bg-slate-50 rounded-xl overflow-hidden mb-3 cursor-pointer transition-all ${c===v.id?"ring-1 ring-slate-300":"hover:bg-slate-100"}`,onClick:()=>u(c===v.id?null:v.id),children:[v.imageUrl&&d.jsxs("div",{className:"relative",children:[d.jsx("img",{src:v.imageUrl,alt:v.title,className:"w-full h-28 object-cover"}),d.jsx("div",{className:"absolute top-2 right-2",children:d.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y(v.category).color}`,children:[y(v.category).icon," ",v.categoryLabel]})})]}),d.jsxs("div",{className:"p-3",children:[!v.imageUrl&&d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y(v.category).color}`,children:[y(v.category).icon," ",v.categoryLabel]}),d.jsx("span",{className:"text-xs text-slate-400",children:g(v.createdAt)})]}),d.jsx("h3",{className:"font-bold text-sm text-slate-800 mb-2 leading-snug",children:v.title}),v.keyPoints&&v.keyPoints.length>0&&d.jsx("div",{className:"bg-white rounded-lg p-2 mb-2 border border-slate-100",children:d.jsx("ul",{className:"space-y-1",children:v.keyPoints.slice(0,2).map((b,w)=>d.jsxs("li",{className:"flex items-start gap-2 text-xs text-slate-600",children:[d.jsx("span",{className:"flex-shrink-0 w-4 h-4 bg-slate-200 text-slate-500 rounded-full flex items-center justify-center font-medium text-[10px]",children:w+1}),d.jsx("span",{className:"leading-snug",children:b})]},w))})}),c===v.id&&d.jsxs("div",{className:"space-y-2 animate-fadeIn",children:[d.jsx("p",{className:"text-slate-500 text-xs leading-relaxed",children:v.summary}),v.keyPoints&&v.keyPoints.length>2&&d.jsx("ul",{className:"space-y-1",children:v.keyPoints.slice(2).map((b,w)=>d.jsxs("li",{className:"flex items-start gap-2 text-xs text-slate-600",children:[d.jsx(M_,{className:"w-3 h-3 text-green-500 flex-shrink-0 mt-0.5"}),b]},w))}),v.classroomTips&&v.classroomTips.length>0&&d.jsxs("div",{className:"bg-blue-50/50 rounded-lg p-2 border border-blue-100",children:[d.jsx("h4",{className:"font-semibold text-blue-700 text-xs mb-1",children:" "}),d.jsx("ul",{className:"space-y-0.5",children:v.classroomTips.slice(0,2).map((b,w)=>d.jsxs("li",{className:"text-xs text-slate-600",children:[w+1,". ",b]},w))})]}),d.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-100",children:[d.jsx("span",{className:"text-xs text-slate-400",children:v.sourceName}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("a",{href:`https://translate.google.com/translate?sl=en&tl=he&u=${encodeURIComponent(v.originalUrl)}`,target:"_blank",rel:"noopener noreferrer",className:"text-slate-400 hover:text-slate-600",onClick:b=>b.stopPropagation(),children:d.jsx(Y6,{className:"w-4 h-4"})}),d.jsxs("a",{href:v.originalUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 bg-slate-700 text-white px-2 py-1 rounded text-xs font-medium hover:bg-slate-800",onClick:b=>b.stopPropagation(),children:[" ",d.jsx(BD,{className:"w-3 h-3"})]})]})]})]}),c!==v.id&&d.jsxs("div",{className:"flex items-center justify-center text-slate-400 text-xs mt-1",children:[d.jsx("span",{children:" "}),d.jsx(wc,{className:"w-3 h-3 rotate-90"})]})]})]}),r.length>1&&d.jsx("div",{className:"space-y-2",children:r.slice(1).map(b=>d.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors cursor-pointer",onClick:()=>u(c===b.id?null:b.id),children:[b.imageUrl?d.jsx("img",{src:b.imageUrl,alt:"",className:"w-10 h-10 rounded object-cover flex-shrink-0"}):d.jsx("span",{className:`w-8 h-8 rounded flex items-center justify-center text-sm ${y(b.category).color}`,children:y(b.category).icon}),d.jsxs("div",{className:"flex-grow min-w-0",children:[d.jsx("p",{className:"text-xs font-medium text-slate-700 truncate",children:b.title}),d.jsx("p",{className:"text-[10px] text-slate-400",children:b.sourceName})]}),d.jsx(wc,{className:"w-3 h-3 text-slate-300"})]},b.id))})]})},cCe=`       Wizdi.         .

##   -  :
-  (lesson):       (Hook),  (Direct Instruction),   (Guided Practice),   (Independent Practice),  
-  (activity):       
-  (exam):       
-  (podcast):      ( )      

##   :
-   (topic):        + AI
-  (file):    PDF//    
-   (text):       
-   (textbook):      (  )
- YouTube (youtube):       

##  :
-   (includeBot):       
-    (custom):      

##     ( ):
    -3   :

###  1:  -  
-    -   ( 10 )
-   -    
-   ,   
-   
-  : Remember, Understand
-  :    / ,  ,  

###  2:  -  
-    -   15 
-   -    
-    
-  : Understand, Apply, Analyze
-  :   

###  3:  -  
-   
-   - , 
-    
-  "" "",   ""
-  : Analyze, Evaluate, Create
-  : ,  ,   

##   :
- : memory_game ( ), matching (), ordering ()
- : multiple_choice ( ), true_false (/ ), fill_in_blanks (), open_question ( )
- : categorization ( ), sentence_builder ( ), table_completion ( )

## :
- balanced:      
- educational:      ( )
- game:   ,   

##  :
- short: 3  (~10 )
- medium: 5  (~15-20 )
- long: 7  (~25-30 )

## : -, , 

##  :
1.    :  (create),   (advise),    (question)
2. ** **:        (//) -     
3.     -     
4.    ( +  +  + ) -  2-3  
5.     ,   
6.  ,   -  2-3   
7.     -    
8.  :    " " -  grade,   "" -  subject
9.    " ", " ", " " -    1 ()
10.    "", "", "" -    3 ()
11.    "   ?" -       

##   :
12.    "  ", " ", "  PDF" -  sourceMode: "file" -hasFileToUpload: true
13.    "  ", " " -  sourceMode: "text"
14.    "  ", " ..." -  sourceMode: "textbook"
15.        "  " -  sourceMode: "youtube"

##   :
16.    " ", " ", "  " -  includeBot: true
17.       ("  ", " ", "  ") -  customQuestionTypes
18.    ""  " " -  productType: "podcast"

##   (JSON):
{
  "type": "question" | "options" | "info",
  "message": "  ",
  "quickReplies": [" 1", " 2", " 3"],  //   type=question
  "options": [...],  //   type=options
  "collectedData": {  //  -   
    "intent": "create" | "advise" | "question" | null,
    "productType": "lesson" | "exam" | "activity" | "podcast" | null,
    "topic": "" | null,
    "grade": " X" | null,
    "subject": "" | null,
    "activityLength": "short" | "medium" | "long" | null,
    "profile": "balanced" | "educational" | "game" | "custom" | null,
    "difficultyLevel": "support" | "core" | "enrichment" | "all" | null,
    "sourceMode": "topic" | "file" | "text" | "textbook" | "youtube" | null,
    "includeBot": true | false | null,
    "hasFileToUpload": true | false | null,
    "customQuestionTypes": ["multiple_choice", "open_question", ...] | null,
    "youtubeUrl": "https://..." | null
  }
}

## :

: "    "
:
{
  "type": "question",
  "message": "!    ?",
  "quickReplies": ["  - ", "  - ", "  - ", " "],
  "collectedData": {
    "intent": "create",
    "productType": "activity",
    "topic": " "
  }
}

: "       "
:
{
  "type": "question",
  "message": " -     .  ?",
  "quickReplies": [" ", " ", " "],
  "collectedData": {
    "intent": "create",
    "productType": "activity",
    "topic": " ",
    "difficultyLevel": "support"
  }
}

: "   ?"
:
{
  "type": "info",
  "message": " 3 :\\n\\n **** -  ,  ,  -  \\n **** -  ,   -  \\n **** - ,   - \\n\\n   ?",
  "quickReplies": ["", "", "", " "],
  "collectedData": {
    "intent": "question"
  }
}

: " ,  "
 (     ):
{
  "type": "options",
  "message": " 3        :",
  "options": [
    {
      "id": 1,
      "title": " 7 ",
      "description": "  7      - ,  ",
      "productType": "activity",
      "profile": "educational",
      "activityLength": "medium",
      "difficultyLevel": "core",
      "questionCount": 5,
      "estimatedTime": "15 ",
      "questionTypes": ["multiple_choice", "true_false", "matching"]
    },
    {
      "id": 2,
      "title": "  -  ",
      "description": "  ,      ",
      "productType": "activity",
      "profile": "game",
      "activityLength": "medium",
      "difficultyLevel": "core",
      "questionCount": 5,
      "estimatedTime": "15 ",
      "questionTypes": ["matching", "categorization", "memory_game"]
    },
    {
      "id": 3,
      "title": "  -  ",
      "description": "   ,       ",
      "productType": "activity",
      "profile": "balanced",
      "activityLength": "medium",
      "difficultyLevel": "core",
      "questionCount": 5,
      "estimatedTime": "20 ",
      "questionTypes": ["ordering", "multiple_choice", "fill_in_blanks"]
    }
  ],
  "collectedData": {
    "intent": "create",
    "productType": "activity",
    "topic": " ",
    "grade": " ",
    "difficultyLevel": "core",
    "profile": "balanced"
  }
}

: " " (   )
:
{
  "type": "info",
  "message": "!     3     -   .       .     ?",
  "quickReplies": [" ", " ", "   "],
  "collectedData": {
    "intent": "create",
    "difficultyLevel": "all"
  }
}

: "    "
:
{
  "type": "question",
  "message": " !       .  ?",
  "quickReplies": [" ", " ", " "],
  "collectedData": {
    "intent": "create",
    "productType": "podcast",
    "topic": " ",
    "subject": ""
  }
}

: "   PDF   "
:
{
  "type": "question",
  "message": "!    .     ?",
  "quickReplies": ["  -  ", "  - ", "  - "],
  "collectedData": {
    "intent": "create",
    "sourceMode": "file",
    "hasFileToUpload": true
  }
}

: "     "
:
{
  "type": "question",
  "message": " !      .     ?",
  "quickReplies": [" ", " ", " "],
  "collectedData": {
    "intent": "create",
    "productType": "exam",
    "includeBot": true
  }
}

: "       "
:
{
  "type": "question",
  "message": " -       .   ?",
  "quickReplies": ["", "", ""],
  "collectedData": {
    "intent": "create",
    "productType": "activity",
    "profile": "custom",
    "customQuestionTypes": ["open_question", "multiple_choice"]
  }
}

: "      "
:
{
  "type": "question",
  "message": "!         .",
  "quickReplies": [],
  "collectedData": {
    "intent": "create",
    "productType": "lesson",
    "sourceMode": "youtube"
  }
}

: "     "
:
{
  "type": "question",
  "message": "    .     ?",
  "quickReplies": ["  - ", "  - ", "  - "],
  "collectedData": {
    "intent": "create",
    "sourceMode": "textbook",
    "subject": "",
    "textbookInfo": " "
  }
}`;async function uCe(n,e,t){const r=e.slice(-6).map(o=>`${o.role==="user"?"":""}: ${o.content}`).join(`
`),s=Object.entries(t).filter(([o,a])=>a!==null&&(Array.isArray(a)?a.length>0:!0)).map(([o,a])=>`${o}: ${Array.isArray(a)?a.join(", "):a}`).join(", "),i=[{role:"system",content:cCe},{role:"user",content:` :
${r||"( )"}

   : ${s||"( )"}

  : "${n}"

  JSON .`}];try{const o=await yfe(i,{temperature:.7});return dCe(o)}catch(o){return console.error("Smart creation AI error:",o),{type:"question",message:",  .     - ,   ?",quickReplies:[""," ",""],collectedData:{}}}}function dCe(n){const t=["question","options","info","ready"].includes(n.type)?n.type:"question",r=n.message||"  ?",s={};n.collectedData&&(n.collectedData.intent&&(s.intent=n.collectedData.intent),n.collectedData.productType&&(s.productType=n.collectedData.productType),n.collectedData.topic&&(s.topic=n.collectedData.topic),n.collectedData.grade&&(s.grade=n.collectedData.grade),n.collectedData.subject&&(s.subject=n.collectedData.subject),n.collectedData.activityLength&&(s.activityLength=n.collectedData.activityLength),n.collectedData.profile&&(s.profile=n.collectedData.profile),n.collectedData.difficultyLevel&&(s.difficultyLevel=n.collectedData.difficultyLevel),n.collectedData.sourceMode&&(s.sourceMode=n.collectedData.sourceMode),n.collectedData.includeBot!==void 0&&(s.includeBot=n.collectedData.includeBot),n.collectedData.hasFileToUpload!==void 0&&(s.hasFileToUpload=n.collectedData.hasFileToUpload),n.collectedData.customQuestionTypes&&(s.customQuestionTypes=n.collectedData.customQuestionTypes),n.collectedData.textbookInfo&&(s.textbookInfo=n.collectedData.textbookInfo),n.collectedData.youtubeUrl&&(s.youtubeUrl=n.collectedData.youtubeUrl));const i={type:t,message:r,collectedData:s};return n.quickReplies&&Array.isArray(n.quickReplies)&&(i.quickReplies=n.quickReplies.slice(0,4)),n.options&&Array.isArray(n.options)&&(i.options=n.options.map((o,a)=>({id:o.id||a+1,title:o.title||` ${a+1}`,description:o.description||"",productType:o.productType||"activity",profile:o.profile||"balanced",activityLength:o.activityLength||"medium",difficultyLevel:o.difficultyLevel||"core",questionCount:o.questionCount||5,estimatedTime:o.estimatedTime||"15 ",questionTypes:o.questionTypes||["multiple_choice"]}))),i}function wz(n,e){const t=(l,c,u)=>{if(l==="custom"&&u&&u.length>0)return{profile:"custom",allowedTypes:u,priorityTypes:u.slice(0,3)};switch(l){case"educational":return{profile:"educational",allowedTypes:["multiple_choice","true_false","fill_in_blanks","ordering","categorization","open_question","matching","table_completion"],priorityTypes:["multiple_choice","open_question","fill_in_blanks"]};case"game":return{profile:"game",allowedTypes:["memory_game","ordering","categorization","matching","sentence_builder","true_false"],priorityTypes:["memory_game","categorization","matching"]};case"balanced":default:return{profile:"balanced",allowedTypes:c.length>0?c:["multiple_choice","true_false","fill_in_blanks","ordering","categorization","memory_game","matching"],priorityTypes:c.length>0?c.slice(0,3):["multiple_choice","fill_in_blanks","categorization"]}}},r=l=>{switch(l){case"support":return{knowledge:60,application:30,evaluation:10};case"enrichment":return{knowledge:15,application:35,evaluation:50};case"core":default:return{knowledge:30,application:50,evaluation:20}}},s=t(n.profile,n.questionTypes,e.customQuestionTypes),i=e.difficultyLevel==="all"||n.difficultyLevel==="all",o=r(i?"core":n.difficultyLevel);return{mode:(()=>{switch(e.sourceMode){case"file":return"upload";case"text":return"text";case"textbook":return"textbook";case"youtube":return"multimodal";default:return"topic"}})(),file:null,pastedText:"",title:e.topic||n.title,originalTopic:e.topic||n.title,textbookSelection:e.textbookInfo?{info:e.textbookInfo}:null,youtubeUrl:e.youtubeUrl||null,settings:{subject:e.subject||"",grade:e.grade||" ",targetAudience:e.grade||" ",activityLength:n.activityLength,taxonomy:o,includeBot:e.includeBot||!1,botPersona:e.includeBot?"socratic":null,courseMode:n.productType==="exam"?"exam":"learning",productType:n.productType,isDifferentiated:i,difficultyLevel:i?null:n.difficultyLevel,questionPreferences:s},targetAudience:e.grade||" ",requiresFileUpload:e.hasFileToUpload||!1,requiresTextPaste:e.sourceMode==="text",requiresTextbookSelection:e.sourceMode==="textbook",requiresYoutubeUrl:e.sourceMode==="youtube"&&!e.youtubeUrl}}function hCe(n,e){return{intent:e.intent??n.intent,productType:e.productType??n.productType,topic:e.topic??n.topic,grade:e.grade??n.grade,subject:e.subject??n.subject,activityLength:e.activityLength??n.activityLength,profile:e.profile??n.profile,difficultyLevel:e.difficultyLevel??n.difficultyLevel,constraints:[...n.constraints,...e.constraints||[]],sourceMode:e.sourceMode??n.sourceMode,includeBot:e.includeBot??n.includeBot,customQuestionTypes:e.customQuestionTypes??n.customQuestionTypes,hasFileToUpload:e.hasFileToUpload??n.hasFileToUpload,textbookInfo:e.textbookInfo??n.textbookInfo,youtubeUrl:e.youtubeUrl??n.youtubeUrl}}function kz(){return{intent:null,productType:null,topic:null,grade:null,subject:null,activityLength:null,profile:null,difficultyLevel:null,constraints:[],sourceMode:null,includeBot:null,customQuestionTypes:null,hasFileToUpload:null,textbookInfo:null,youtubeUrl:null}}const fCe={support:{key:"support",label:"",description:" "},core:{key:"core",label:"",description:" "},enrichment:{key:"enrichment",label:"",description:" "}},pCe=({onCreateContent:n,onCancel:e})=>{const[t,r]=V.useState([{id:"1",role:"assistant",content:"!    ?    ,     .",quickReplies:[""," ","","","  "],timestamp:Date.now()}]),[s,i]=V.useState(""),[o,a]=V.useState(!1),[l,c]=V.useState(kz()),[u,h]=V.useState(null),[f,p]=V.useState(!1),g=V.useRef(null),y=V.useRef(null),v=V.useRef(null);V.useEffect(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[t]),V.useEffect(()=>{var P;(P=v.current)==null||P.focus()},[]);const b=V.useCallback(()=>t.map(P=>({role:P.role,content:P.content})),[t]),w=V.useCallback(async P=>{const O=P||s.trim();if(!O||o)return;const D={id:`user-${Date.now()}`,role:"user",content:O,timestamp:Date.now()};r(G=>[...G,D]),i(""),a(!0);try{const G=await uCe(O,b(),l);G.collectedData&&c(Q=>hCe(Q,G.collectedData));const J={id:`assistant-${Date.now()}`,role:"assistant",content:G.message,quickReplies:G.quickReplies,options:G.options,timestamp:Date.now()};r(Q=>[...Q,J])}catch(G){console.error("Chat error:",G),r(J=>[...J,{id:`error-${Date.now()}`,role:"assistant",content:",  .   ?",quickReplies:[" "," "],timestamp:Date.now()}])}finally{a(!1)}},[s,o,l,b]),k=P=>{if(P===" "){R();return}w(P)},T=async P=>{h(P),p(!0),r(D=>[...D,{id:`confirm-${Date.now()}`,role:"assistant",content:`!  "${P.title}"... `,timestamp:Date.now()}]);const O=wz(P,l);await new Promise(D=>setTimeout(D,800)),n(O)},R=()=>{r([{id:"1",role:"assistant",content:",  !   ?",quickReplies:[""," ","","","  "],timestamp:Date.now()}]),c(kz()),h(null),p(!1),i("")},M=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),w())},E=P=>{switch(P){case"lesson":return d.jsx(Zq,{className:"w-5 h-5"});case"exam":return d.jsx(M1,{className:"w-5 h-5"});case"activity":return d.jsx(eG,{className:"w-5 h-5"});case"podcast":return d.jsx(K0e,{className:"w-5 h-5"});default:return d.jsx(ng,{className:"w-5 h-5"})}},I=P=>{switch(P){case"file":return d.jsx(G4,{className:"w-4 h-4"});case"textbook":return d.jsx(R1,{className:"w-4 h-4"});case"youtube":return d.jsx(v0e,{className:"w-4 h-4"});default:return null}},S=P=>{switch(P){case"educational":return"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300";case"game":return"bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-300";default:return"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}},N=P=>{const O={support:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",enrichment:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",core:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"},D=P==="support"||P==="enrichment"?P:"core";return{label:fCe[D].label,color:O[D]}};return d.jsxs("div",{className:"flex flex-col h-full max-h-[500px] bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[d.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-l from-wizdi-royal/5 to-transparent",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-wizdi-royal to-wizdi-cyan rounded-lg flex items-center justify-center",children:d.jsx(ng,{className:"w-4 h-4 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm",children:"  "}),d.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:" ,    "})]})]}),d.jsx("button",{onClick:R,className:"p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:" ",children:d.jsx(tG,{className:"w-4 h-4"})})]}),d.jsxs("div",{ref:y,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.map(P=>d.jsx("div",{className:`flex ${P.role==="user"?"justify-start":"justify-end"}`,children:d.jsxs("div",{className:`max-w-[85%] ${P.role==="user"?"order-1":"order-2"}`,children:[d.jsx("div",{className:`px-4 py-2.5 rounded-2xl ${P.role==="user"?"bg-wizdi-royal text-white rounded-tr-md":"bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-white rounded-tl-md"}`,children:d.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:P.content})}),P.quickReplies&&P.quickReplies.length>0&&d.jsxs("div",{className:"mt-3",children:[d.jsxs("p",{className:"text-[11px] text-slate-400 dark:text-slate-500 mb-2 text-left flex items-center gap-1",children:[d.jsx("span",{children:""}),d.jsx("span",{children:"  :"})]}),d.jsx("div",{className:"flex flex-wrap gap-2 justify-end",children:P.quickReplies.map((O,D)=>d.jsx("button",{onClick:()=>k(O),disabled:o||f,className:"px-3 py-1.5 text-xs font-medium bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 border border-dashed border-slate-300 dark:border-slate-500 rounded-lg hover:bg-wizdi-royal/10 hover:border-wizdi-royal/50 hover:text-wizdi-royal dark:hover:bg-wizdi-cyan/10 dark:hover:border-wizdi-cyan/50 dark:hover:text-wizdi-cyan transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:O},D))})]}),P.options&&P.options.length>0&&d.jsx("div",{className:"mt-3 space-y-2",children:P.options.map(O=>d.jsx("button",{onClick:()=>T(O),disabled:o||f,className:"w-full text-right p-3 bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl hover:border-wizdi-royal dark:hover:border-wizdi-cyan hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed group",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-wizdi-royal/10 dark:bg-wizdi-royal/20 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:bg-wizdi-royal group-hover:text-white transition-colors text-wizdi-royal",children:E(O.productType)}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h4",{className:"font-bold text-slate-800 dark:text-white text-sm mb-1",children:O.title}),d.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mb-2",children:O.description}),d.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[O.difficultyLevel&&O.difficultyLevel!=="all"&&d.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded-full ${N(O.difficultyLevel).color}`,children:N(O.difficultyLevel).label}),O.difficultyLevel==="all"&&d.jsx("span",{className:"px-2 py-0.5 text-[10px] font-medium rounded-full bg-gradient-to-r from-green-100 via-blue-100 to-purple-100 text-slate-700 dark:from-green-900/30 dark:via-blue-900/30 dark:to-purple-900/30 dark:text-slate-300",children:"3 "}),d.jsx("span",{className:`px-2 py-0.5 text-[10px] font-medium rounded-full ${S(O.profile)}`,children:O.profile==="educational"?"":O.profile==="game"?"":O.profile==="custom"?"":""}),l.sourceMode&&l.sourceMode!=="topic"&&d.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300",children:[I(l.sourceMode),l.sourceMode==="file"?"":l.sourceMode==="textbook"?"":l.sourceMode==="youtube"?"":""]}),l.includeBot&&d.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300",children:[d.jsx(X6,{className:"w-3 h-3"})," "]}),d.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-slate-500",children:[d.jsx(j0e,{className:"w-3 h-3"}),O.questionCount," "]}),d.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 dark:text-slate-500",children:[d.jsx(tS,{className:"w-3 h-3"}),O.estimatedTime]})]})]}),d.jsx(wc,{className:"w-5 h-5 text-slate-300 dark:text-slate-500 group-hover:text-wizdi-royal dark:group-hover:text-wizdi-cyan transition-colors flex-shrink-0"})]})},O.id))})]})},P.id)),o&&d.jsx("div",{className:"flex justify-end",children:d.jsx("div",{className:"bg-slate-100 dark:bg-slate-700 px-4 py-2.5 rounded-2xl rounded-tl-md",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(VD,{className:"w-4 h-4 animate-spin text-wizdi-royal"}),d.jsx("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:"..."})]})})}),f&&d.jsx("div",{className:"flex justify-end",children:d.jsx("div",{className:"bg-gradient-to-r from-wizdi-royal/10 to-wizdi-cyan/10 dark:from-wizdi-royal/20 dark:to-wizdi-cyan/20 px-4 py-3 rounded-2xl rounded-tl-md border border-wizdi-royal/20",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"relative",children:[d.jsx(ng,{className:"w-5 h-5 text-wizdi-royal animate-pulse"}),d.jsx("div",{className:"absolute inset-0 w-5 h-5 bg-wizdi-cyan/50 rounded-full animate-ping"})]}),d.jsx("span",{className:"text-sm font-medium text-wizdi-royal dark:text-wizdi-cyan",children:"   ..."})]})})}),d.jsx("div",{ref:g})]}),l.hasFileToUpload&&d.jsx("div",{className:"px-3 py-2 bg-amber-50 dark:bg-amber-900/20 border-t border-amber-200 dark:border-amber-800",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[d.jsx(G4,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"  "})]}),d.jsxs("button",{onClick:()=>{const P=wz({title:l.topic||" ",productType:l.productType||"activity",profile:l.profile||"balanced",activityLength:l.activityLength||"medium",difficultyLevel:l.difficultyLevel||"core",questionTypes:[]},l);n(P)},className:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-lg flex items-center gap-1.5 transition-colors",children:[d.jsx(G4,{className:"w-4 h-4"})," "]})]})}),d.jsx("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50",children:d.jsxs("div",{className:"flex items-end gap-2",children:[d.jsx("textarea",{ref:v,value:s,onChange:P=>i(P.target.value),onKeyDown:M,placeholder:"  ,      ...",disabled:o||f,className:"flex-1 px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-sm text-slate-800 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 resize-none focus:outline-none focus:ring-2 focus:ring-wizdi-royal/50 focus:border-wizdi-royal disabled:opacity-50 disabled:cursor-not-allowed",dir:"rtl",rows:1,style:{minHeight:"42px",maxHeight:"100px"}}),d.jsx("button",{onClick:()=>w(),disabled:!s.trim()||o||f,className:"w-10 h-10 bg-wizdi-royal hover:bg-wizdi-royal/90 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl flex items-center justify-center transition-colors disabled:cursor-not-allowed",children:o?d.jsx(VD,{className:"w-5 h-5 animate-spin"}):d.jsx(ame,{className:"w-5 h-5 rotate-180"})})]})})]})},mCe=({onCreateNew:n,onCreateWithWizardData:e,onNavigateToDashboard:t,onEditCourse:r,onNavigateToPrompts:s,onNavigateToQA:i,onNavigateToKnowledgeBase:o,onNavigateToAgents:a,onNavigateToUsage:l,onNavigateToSpeedAnalytics:c})=>{var k;const{currentUser:u,isAdmin:h}=kf(),[f,p]=V.useState([]),[g,y]=V.useState(!0),v=((k=u==null?void 0:u.email)==null?void 0:k.split("@")[0])||"";V.useEffect(()=>{(async()=>{if(!u){y(!1);return}try{let R;try{const N=Uh(Zs(Kt,"courses"),$m("teacherId","==",u.uid),Ow("createdAt","desc"),q3(10));R=await Hh(N)}catch(N){console.warn(" Missing Firestore index, using client-side sort. Create index for better performance:",N==null?void 0:N.message);const P=Uh(Zs(Kt,"courses"),$m("teacherId","==",u.uid));R=await Hh(P)}const M=[],E=[];R.forEach(N=>{const P=N.data();E.push(N.id);let O="activity";P.mode==="exam"?O="test":P.mode==="lesson"?O="lesson":P.syllabus&&P.syllabus.some(D=>{var G;return((G=D.questions)==null?void 0:G.length)>0})&&(O="test"),M.push({id:N.id,title:P.title||" ",type:O,mode:P.mode,createdAt:P.createdAt,submissionCount:0})});const I=M.filter(N=>{var O,D;return((O=N.createdAt)==null?void 0:O.seconds)||((D=N.createdAt)==null?void 0:D.toMillis)});I.sort((N,P)=>{var G,J,Q,re,ne,te;const O=((J=(G=N.createdAt)==null?void 0:G.toMillis)==null?void 0:J.call(G))||((Q=N.createdAt)==null?void 0:Q.seconds)*1e3||0;return(((ne=(re=P.createdAt)==null?void 0:re.toMillis)==null?void 0:ne.call(re))||((te=P.createdAt)==null?void 0:te.seconds)*1e3||0)-O});const S=I.slice(0,5).map(N=>N.id);if(S.length>0){const N=Uh(Zs(Kt,"submissions"),$m("teacherId","==",u.uid),$m("courseId","in",S)),P=await Hh(N),O={};P.forEach(D=>{const G=D.data().courseId;O[G]=(O[G]||0)+1}),I.forEach(D=>{D.submissionCount=O[D.id]||0})}p(I.slice(0,3))}catch(R){console.error(" Error fetching recent activities:",R),console.error("Error code:",R==null?void 0:R.code),console.error("Error message:",R==null?void 0:R.message)}finally{y(!1)}})()},[u]);const b=()=>{const T=new Date().getHours();return T>=5&&T<12?" ":T>=12&&T<18?" ":T>=18&&T<22?" ":" "},w=(T,R)=>{console.log(` Clicked card: ${T}`),R()};return d.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8 font-sans",children:[d.jsxs("section",{className:"relative mb-12","aria-labelledby":"hero-title",children:[d.jsx("div",{className:"absolute -top-20 -right-20 w-72 h-72 bg-wizdi-cyan/20 rounded-full blur-3xl animate-blob pointer-events-none motion-reduce:animate-none"}),d.jsx("div",{className:"absolute -bottom-10 -left-20 w-64 h-64 bg-wizdi-action/20 rounded-full blur-3xl animate-blob animation-delay-2000 pointer-events-none motion-reduce:animate-none"}),d.jsxs("div",{className:"relative z-10 flex flex-col lg:flex-row items-center gap-8 lg:gap-16",children:[d.jsxs("div",{className:"flex-1 text-center lg:text-right animate-slideUp motion-reduce:animate-none",children:[d.jsxs("p",{className:"text-base text-slate-500 dark:text-slate-400 mb-3",children:[b(),", ",v]}),d.jsxs("h1",{id:"hero-title",className:"text-4xl lg:text-6xl font-black bg-gradient-to-l from-wizdi-royal via-violet-600 to-wizdi-cyan bg-clip-text text-transparent mb-4 leading-tight",children:[d.jsx(cpe,{className:"w-8 h-8 lg:w-12 lg:h-12 text-wizdi-royal inline-block align-middle ml-2"}),"  "]}),d.jsx("p",{className:"text-xl lg:text-2xl text-slate-600 dark:text-slate-300 font-medium max-w-lg mx-auto lg:mx-0",children:"     AI - ,   "})]}),d.jsx("div",{className:"flex-1 max-w-2xl hidden lg:block","aria-hidden":"true",children:d.jsxs("div",{className:"relative",children:[d.jsx("svg",{className:"absolute -top-2 -right-6 w-6 h-6 text-wizdi-cyan animate-pulse motion-reduce:animate-none",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"})}),d.jsx("svg",{className:"absolute top-1/4 -right-8 w-4 h-4 text-wizdi-lime animate-pulse animation-delay-2000 motion-reduce:animate-none",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"})}),d.jsx("svg",{className:"absolute -bottom-2 -left-4 w-5 h-5 text-wizdi-action animate-pulse animation-delay-4000 motion-reduce:animate-none",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"})}),d.jsx("svg",{className:"absolute top-1/2 -left-8 w-3 h-3 text-wizdi-royal animate-pulse motion-reduce:animate-none",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"})}),d.jsx("svg",{className:"absolute bottom-1/4 -right-4 w-4 h-4 text-amber-400 animate-pulse animation-delay-2000 motion-reduce:animate-none",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M12 0L14.59 9.41L24 12L14.59 14.59L12 24L9.41 14.59L0 12L9.41 9.41L12 0Z"})}),d.jsx("img",{src:"/images/hero-illustration.png",alt:"AI Education Illustration",className:"relative z-10 w-full max-w-2xl h-auto object-contain drop-shadow-xl"})]})})]})]}),d.jsx("section",{className:"mb-12","aria-label":"  ",children:d.jsxs("div",{className:"flex flex-wrap gap-3 justify-center lg:justify-start",children:[d.jsxs("div",{className:"flex items-center gap-2 px-6 py-3.5 rounded-full font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 text-base",children:[d.jsx(HD,{className:"w-5 h-5 text-wizdi-cyan","aria-hidden":"true"}),""]}),d.jsxs("div",{className:"flex items-center gap-2 px-6 py-3.5 rounded-full font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 text-base",children:[d.jsx(R0e,{className:"w-5 h-5 text-wizdi-royal","aria-hidden":"true"}),""]}),d.jsxs("div",{className:"flex items-center gap-2 px-6 py-3.5 rounded-full font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 text-base",children:[d.jsx(J0e,{className:"w-5 h-5 text-wizdi-action","aria-hidden":"true"}),""]}),d.jsxs("div",{className:"flex items-center gap-2 px-6 py-3.5 rounded-full font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 text-base",children:[d.jsx(L0e,{className:"w-5 h-5 text-amber-500","aria-hidden":"true"}),""]}),d.jsxs("div",{className:"flex items-center gap-2 px-6 py-3.5 rounded-full font-semibold text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 text-base",children:[d.jsx(R1,{className:"w-5 h-5 text-emerald-500","aria-hidden":"true"})," "]})]})}),d.jsx("section",{className:"mb-8","aria-label":"  ",children:d.jsx("div",{className:"card-glass rounded-3xl p-8 border border-slate-200/80 dark:border-slate-700 dark:bg-slate-800/80 bg-gradient-to-br from-white to-slate-50/30",children:d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsxs("div",{className:"flex items-start justify-between mb-4",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-wizdi-royal to-wizdi-cyan rounded-2xl flex items-center justify-center shadow-lg","aria-hidden":"true",children:d.jsx(Hi,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-2xl font-black text-wizdi-royal dark:text-wizdi-cyan",children:"  "}),d.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-base font-medium",children:"     "})]})]}),d.jsx("span",{className:"bg-wizdi-action-light text-wizdi-action-dark text-xs px-3 py-1.5 rounded-full font-bold",children:""})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx(pCe,{onCreateContent:T=>{var R;e?e(T):n("learning",((R=T.settings)==null?void 0:R.productType)||"activity")}}),d.jsx("p",{className:"text-center text-sm text-slate-500 dark:text-slate-400 mt-3",children:"    "})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4",role:"group","aria-label":"  ",children:[d.jsxs("button",{onClick:()=>w("Lesson Plan",()=>n("learning","lesson")),className:"sub-btn group/btn bg-white dark:bg-slate-700 hover:bg-wizdi-cloud dark:hover:bg-slate-600 border-2 border-slate-100 dark:border-slate-600 hover:border-wizdi-royal rounded-2xl p-4 text-right transition-all duration-300 hover:-translate-y-1 hover:shadow-lg min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal focus-visible:ring-offset-2 motion-reduce:hover:transform-none","aria-label":"   -    ",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"icon-container w-12 h-12 bg-wizdi-royal/10 dark:bg-wizdi-royal/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover/btn:bg-wizdi-royal transition-colors","aria-hidden":"true",children:d.jsx(Zq,{className:"w-6 h-6 text-wizdi-royal group-hover/btn:text-white"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-1",children:" "}),d.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed",children:"    , ,  "})]})]}),d.jsxs("div",{className:"flex items-center gap-1 text-wizdi-royal text-sm font-medium mt-3 group-hover/btn:translate-x-[-4px] transition-transform motion-reduce:group-hover/btn:transform-none","aria-hidden":"true",children:["",d.jsx(wc,{className:"w-4 h-4"})]})]}),d.jsxs("div",{className:"sub-btn bg-white dark:bg-slate-700 border-2 border-slate-100 dark:border-slate-600 rounded-2xl p-4 text-right opacity-60 cursor-not-allowed","aria-label":"  - ",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"icon-container w-12 h-12 bg-slate-200 dark:bg-slate-600 rounded-xl flex items-center justify-center flex-shrink-0","aria-hidden":"true",children:d.jsx(X6,{className:"w-6 h-6 text-slate-400"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("h3",{className:"font-bold text-slate-500 dark:text-slate-400",children:" "}),d.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-[10px] font-bold rounded-full",children:""})]}),d.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 leading-relaxed",children:"        ,     "})]})]}),d.jsx("div",{className:"flex items-center gap-1 text-slate-400 text-sm font-medium mt-3","aria-hidden":"true",children:"..."})]}),d.jsxs("button",{onClick:()=>w("Activity",()=>n("learning","activity")),className:"sub-btn group/btn bg-white dark:bg-slate-700 hover:bg-wizdi-cloud dark:hover:bg-slate-600 border-2 border-slate-100 dark:border-slate-600 hover:border-wizdi-royal rounded-2xl p-4 text-right transition-all duration-300 hover:-translate-y-1 hover:shadow-lg min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal focus-visible:ring-offset-2 motion-reduce:hover:transform-none","aria-label":"   -  ",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"icon-container w-12 h-12 bg-wizdi-royal/10 dark:bg-wizdi-royal/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover/btn:bg-wizdi-royal transition-colors","aria-hidden":"true",children:d.jsx(eG,{className:"w-6 h-6 text-wizdi-royal group-hover/btn:text-white"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-1",children:" "}),d.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed",children:"     "})]})]}),d.jsxs("div",{className:"flex items-center gap-1 text-wizdi-royal text-sm font-medium mt-3 group-hover/btn:translate-x-[-4px] transition-transform motion-reduce:group-hover/btn:transform-none","aria-hidden":"true",children:["",d.jsx(wc,{className:"w-4 h-4"})]})]}),d.jsxs("button",{onClick:()=>w("Exam",()=>n("learning","exam")),className:"sub-btn group/btn bg-white dark:bg-slate-700 hover:bg-wizdi-cloud dark:hover:bg-slate-600 border-2 border-slate-100 dark:border-slate-600 hover:border-wizdi-royal rounded-2xl p-4 text-right transition-all duration-300 hover:-translate-y-1 hover:shadow-lg min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal focus-visible:ring-offset-2 motion-reduce:hover:transform-none","aria-label":"    -    ",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"icon-container w-12 h-12 bg-wizdi-royal/10 dark:bg-wizdi-royal/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover/btn:bg-wizdi-royal transition-colors","aria-hidden":"true",children:d.jsx(M1,{className:"w-6 h-6 text-wizdi-royal group-hover/btn:text-white"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-1",children:" / "}),d.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed",children:"    ,   "})]})]}),d.jsxs("div",{className:"flex items-center gap-1 text-wizdi-royal text-sm font-medium mt-3 group-hover/btn:translate-x-[-4px] transition-transform motion-reduce:group-hover/btn:transform-none","aria-hidden":"true",children:["",d.jsx(wc,{className:"w-4 h-4"})]})]})]})]})})}),d.jsx("section",{className:"mb-8","aria-labelledby":"how-it-works-title",children:d.jsxs("div",{className:"max-w-4xl mx-auto",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h2",{id:"how-it-works-title",className:"text-xl font-bold text-slate-800 dark:text-white mb-1",children:"  ?"}),d.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"     "})]}),d.jsxs("ol",{className:"grid grid-cols-2 md:grid-cols-4 gap-3","aria-label":"  ",children:[d.jsxs("li",{className:"text-center p-4 bg-gradient-to-br from-white to-slate-50/80 dark:from-slate-800 dark:to-slate-700/50 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100 dark:border-slate-700",children:[d.jsxs("div",{className:"w-12 h-12 bg-wizdi-royal/8 dark:bg-wizdi-royal/15 rounded-xl flex items-center justify-center mx-auto mb-3 relative","aria-hidden":"true",children:[d.jsx(G4,{className:"w-6 h-6 text-wizdi-royal"}),d.jsx("span",{className:"absolute -top-1.5 -left-1.5 w-5 h-5 bg-wizdi-royal text-white rounded-full text-[10px] font-bold flex items-center justify-center shadow",children:"1"})]}),d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm mb-0.5",children:""}),d.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:" ,   "})]}),d.jsxs("li",{className:"text-center p-4 bg-gradient-to-br from-white to-slate-50/80 dark:from-slate-800 dark:to-slate-700/50 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100 dark:border-slate-700",children:[d.jsxs("div",{className:"w-12 h-12 bg-wizdi-royal/8 dark:bg-wizdi-royal/15 rounded-xl flex items-center justify-center mx-auto mb-3 relative","aria-hidden":"true",children:[d.jsx(Hi,{className:"w-6 h-6 text-wizdi-royal"}),d.jsx("span",{className:"absolute -top-1.5 -left-1.5 w-5 h-5 bg-wizdi-royal text-white rounded-full text-[10px] font-bold flex items-center justify-center shadow",children:"2"})]}),d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm mb-0.5",children:""}),d.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"-AI   "})]}),d.jsxs("li",{className:"text-center p-4 bg-gradient-to-br from-white to-slate-50/80 dark:from-slate-800 dark:to-slate-700/50 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100 dark:border-slate-700",children:[d.jsxs("div",{className:"w-12 h-12 bg-wizdi-royal/8 dark:bg-wizdi-royal/15 rounded-xl flex items-center justify-center mx-auto mb-3 relative","aria-hidden":"true",children:[d.jsx(cme,{className:"w-6 h-6 text-wizdi-royal"}),d.jsx("span",{className:"absolute -top-1.5 -left-1.5 w-5 h-5 bg-wizdi-royal text-white rounded-full text-[10px] font-bold flex items-center justify-center shadow",children:"3"})]}),d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm mb-0.5",children:""}),d.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:" "})]}),d.jsxs("li",{className:"text-center p-4 bg-gradient-to-br from-white to-slate-50/80 dark:from-slate-800 dark:to-slate-700/50 rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100 dark:border-slate-700",children:[d.jsxs("div",{className:"w-12 h-12 bg-wizdi-royal/8 dark:bg-wizdi-royal/15 rounded-xl flex items-center justify-center mx-auto mb-3 relative","aria-hidden":"true",children:[d.jsx(wD,{className:"w-6 h-6 text-wizdi-royal"}),d.jsx("span",{className:"absolute -top-1.5 -left-1.5 w-5 h-5 bg-wizdi-royal text-white rounded-full text-[10px] font-bold flex items-center justify-center shadow",children:"4"})]}),d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm mb-0.5",children:""}),d.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"  "})]})]})]})}),d.jsxs("section",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8","aria-label":"  ",children:[d.jsx("div",{className:"group w-full text-right rounded-3xl opacity-60 cursor-not-allowed","aria-label":"   - ",children:d.jsx("div",{className:"card-glass rounded-3xl p-6 border border-slate-200 dark:border-slate-700 h-full relative overflow-hidden",children:d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-slate-400 to-slate-500 rounded-2xl flex items-center justify-center shadow-lg","aria-hidden":"true",children:d.jsx(X6,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("div",{className:"flex items-center gap-2 mb-1",children:d.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-xs font-bold rounded-full",children:""})}),d.jsx("h2",{className:"text-xl font-black text-slate-500 dark:text-slate-400",children:"  "}),d.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-base",children:" AI "})]})]}),d.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-sm mb-4",children:" AI   .  ,     ."}),d.jsx("div",{className:"flex-grow",children:d.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-slate-200 dark:bg-slate-600 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(UD,{className:"w-4 h-4 text-slate-400"})}),d.jsx("span",{className:"text-sm font-medium text-slate-400 dark:text-slate-500",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-slate-200 dark:bg-slate-600 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(Y6,{className:"w-4 h-4 text-slate-400"})}),d.jsx("span",{className:"text-sm font-medium text-slate-400 dark:text-slate-500",children:"English Buddy"})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-slate-200 dark:bg-slate-600 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(UD,{className:"w-4 h-4 text-slate-400"})}),d.jsx("span",{className:"text-sm font-medium text-slate-400 dark:text-slate-500",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-slate-200 dark:bg-slate-600 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(R1,{className:"w-4 h-4 text-slate-400"})}),d.jsx("span",{className:"text-sm font-medium text-slate-400 dark:text-slate-500",children:' "'})]})]})}),d.jsx("div",{className:"flex items-center gap-2 font-bold text-slate-400 dark:text-slate-500 text-sm",children:"..."})]})})}),d.jsx("button",{onClick:()=>w("Prompts Library",()=>s==null?void 0:s()),className:"group cursor-pointer w-full text-right focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-violet-400 focus-visible:ring-offset-2 rounded-3xl","aria-label":"   AI",children:d.jsx("div",{className:"card-glass rounded-3xl p-6 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border border-slate-200/80 dark:border-slate-700 motion-reduce:hover:transform-none h-full bg-gradient-to-br from-white to-slate-50/50 dark:from-slate-800 dark:to-slate-700/30",children:d.jsxs("div",{className:"flex flex-col h-full",children:[d.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-violet-500 to-purple-600 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg motion-reduce:group-hover:transform-none","aria-hidden":"true",children:d.jsx(q4,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h2",{className:"text-xl font-black text-violet-600 dark:text-violet-400",children:" "}),d.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-base",children:"    "})]})]}),d.jsxs("div",{className:"flex-grow",children:[d.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mb-2",children:":"}),d.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-50 dark:bg-slate-700 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-wizdi-royal/20 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(ime,{className:"w-4 h-4 text-wizdi-royal"})}),d.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-50 dark:bg-slate-700 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-pink-500/20 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(G0e,{className:"w-4 h-4 text-pink-500"})}),d.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-50 dark:bg-slate-700 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-wizdi-cyan/20 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(M1,{className:"w-4 h-4 text-wizdi-cyan"})}),d.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:" "})]}),d.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-50 dark:bg-slate-700 rounded-xl",children:[d.jsx("div",{className:"w-6 h-6 bg-wizdi-lime/30 rounded-lg flex items-center justify-center","aria-hidden":"true",children:d.jsx(E0e,{className:"w-4 h-4 text-wizdi-lime"})}),d.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:""})]})]})]}),d.jsxs("div",{className:"flex items-center gap-2 font-bold text-violet-600 dark:text-violet-400 text-sm group-hover:translate-x-[-4px] transition-transform motion-reduce:group-hover:transform-none",children:[" ",d.jsx(wc,{className:"w-4 h-4"})]})]})})})]}),d.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8","aria-label":"  ",children:[d.jsxs("div",{className:"card-glass rounded-2xl p-5 dark:bg-slate-800/80 bg-gradient-to-br from-white to-slate-50/50 border border-slate-200/80 dark:border-slate-700",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-wizdi-royal to-wizdi-cyan rounded-2xl flex items-center justify-center shadow-lg","aria-hidden":"true",children:d.jsx(F0e,{className:"w-7 h-7 text-white"})}),d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:" "})]}),d.jsx("button",{onClick:t,className:"text-wizdi-royal dark:text-wizdi-cyan text-xs font-medium hover:underline min-h-[44px] px-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal rounded","aria-label":"  ",children:""})]}),d.jsx("div",{className:"space-y-2",role:"list","aria-label":"  ",children:g?d.jsx("div",{className:"flex items-center justify-center py-4",role:"status","aria-label":" ",children:d.jsx(Yw,{size:"md",color:"primary",label:" ..."})}):f.length===0?d.jsxs("div",{className:"text-center py-4 text-slate-400 dark:text-slate-500",children:[d.jsx(Hi,{className:"w-8 h-8 mx-auto mb-2 opacity-50","aria-hidden":"true"}),d.jsx("p",{className:"text-sm",children:"  "})]}):f.slice(0,3).map(T=>{const R=()=>T.type==="test"?d.jsx(p0,{className:"w-4 h-4 text-wizdi-cyan"}):T.type==="lesson"?d.jsx(HD,{className:"w-4 h-4 text-wizdi-action"}):d.jsx(Hi,{className:"w-4 h-4 text-wizdi-royal"}),M=()=>T.type==="test"?"bg-wizdi-cyan/10 dark:bg-wizdi-cyan/20":T.type==="lesson"?"bg-wizdi-action-light dark:bg-wizdi-action/20":"bg-wizdi-royal/10 dark:bg-wizdi-royal/20",E=()=>T.type==="test"?"":T.type==="lesson"?"":"";return d.jsxs("button",{onClick:()=>r==null?void 0:r(T.id),className:"flex items-center gap-3 p-2 min-h-[44px] w-full bg-slate-50 dark:bg-slate-700/50 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors cursor-pointer group text-right focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal focus-visible:ring-offset-2",role:"listitem","aria-label":`${E()}: ${T.title}${T.submissionCount&&T.submissionCount>0?`, ${T.submissionCount} `:""}`,children:[d.jsx("div",{className:`w-8 h-8 ${M()} rounded-lg flex items-center justify-center flex-shrink-0`,"aria-hidden":"true",children:R()}),d.jsx("div",{className:"flex-grow min-w-0",children:d.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 truncate",children:T.title})}),T.submissionCount&&T.submissionCount>0&&d.jsx("span",{className:"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300 text-[10px] px-1.5 py-0.5 rounded-full font-medium","aria-hidden":"true",children:T.submissionCount}),d.jsx(wc,{className:"w-4 h-4 text-slate-400 dark:text-slate-500 group-hover:text-wizdi-royal dark:group-hover:text-wizdi-cyan transition-colors","aria-hidden":"true"})]},T.id)})})]}),d.jsx("button",{onClick:()=>w("Dashboard",t),className:"group cursor-pointer text-right focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 rounded-2xl","aria-label":"  ",children:d.jsxs("div",{className:"card-glass rounded-2xl p-5 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 relative overflow-hidden h-full border border-slate-200 dark:border-slate-700 motion-reduce:hover:transform-none",children:[d.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 opacity-30","aria-hidden":"true",children:d.jsxs("svg",{viewBox:"0 0 200 50",preserveAspectRatio:"none",className:"w-full h-full",children:[d.jsx("defs",{children:d.jsxs("linearGradient",{id:"chartGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[d.jsx("stop",{offset:"0%",style:{stopColor:"#2B59C3",stopOpacity:1}}),d.jsx("stop",{offset:"100%",style:{stopColor:"#2B59C3",stopOpacity:0}})]})}),d.jsx("path",{d:"M0,50 L20,35 L40,42 L60,28 L80,38 L100,22 L120,30 L140,18 L160,25 L180,12 L200,20 L200,50 Z",fill:"url(#chartGradient)"})]})}),d.jsxs("div",{className:"relative z-10 flex items-center gap-4",children:[d.jsx("div",{className:"w-14 h-14 min-w-[56px] min-h-[56px] bg-gradient-to-br from-slate-600 to-slate-800 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg motion-reduce:group-hover:transform-none","aria-hidden":"true",children:d.jsx(wD,{className:"w-7 h-7 text-white"})}),d.jsxs("div",{className:"flex-grow",children:[d.jsx("h2",{className:"text-lg font-black text-slate-800 dark:text-white",children:" "}),d.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"   "})]}),d.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-600 dark:text-slate-400 text-sm group-hover:translate-x-[-8px] transition-transform motion-reduce:group-hover:transform-none","aria-hidden":"true",children:["",d.jsx(wc,{className:"w-4 h-4"})]})]})]})})]}),d.jsx("section",{className:"mb-8",children:d.jsx(lCe,{compact:!0,showFeatured:!0,maxItems:1})}),d.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 lg:hidden z-fixed","aria-label":" ",children:d.jsxs("button",{onClick:()=>n("learning"),className:"btn-lip-action px-8 py-4 min-h-[44px] shadow-xl flex items-center gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-wizdi-action","aria-label":"   ",children:[d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})," "]})}),d.jsxs("nav",{className:"text-center py-4 flex justify-center gap-4","aria-label":" ",children:[i&&d.jsx("button",{onClick:()=>i(),className:"text-slate-400 dark:text-slate-500 text-xs hover:text-wizdi-royal dark:hover:text-wizdi-cyan transition-colors px-3 py-2 min-h-[44px] rounded hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":"  QA Admin",children:"QA Admin"}),o&&d.jsx("button",{onClick:()=>o(),className:"text-slate-400 dark:text-slate-500 text-xs hover:text-wizdi-royal dark:hover:text-wizdi-cyan transition-colors px-3 py-2 min-h-[44px] rounded hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":"   ",children:" "}),l&&d.jsx("button",{onClick:()=>l(),className:"text-slate-400 dark:text-slate-500 text-xs hover:text-wizdi-royal dark:hover:text-wizdi-cyan transition-colors px-3 py-2 min-h-[44px] rounded hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":" ",children:" AI"}),c&&d.jsx("button",{onClick:()=>c(),className:"text-slate-400 dark:text-slate-500 text-xs hover:text-wizdi-royal dark:hover:text-wizdi-cyan transition-colors px-3 py-2 min-h-[44px] rounded hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":" ",children:" "})]}),d.jsx("style",{children:`
                @keyframes blob {
                    0% { transform: translate(0px, 0px) scale(1); }
                    33% { transform: translate(30px, -50px) scale(1.1); }
                    66% { transform: translate(-20px, 20px) scale(0.9); }
                    100% { transform: translate(0px, 0px) scale(1); }
                }
                .animate-blob { animation: blob 7s infinite; }
                .animation-delay-2000 { animation-delay: 2s; }

                /* Respect reduced motion preference */
                @media (prefers-reduced-motion: reduce) {
                    .animate-blob,
                    .animate-float,
                    .animate-pulse {
                        animation: none;
                    }
                }

                /* Gradient border for main card - now with violet */
                .gradient-border {
                    position: relative;
                }
                .gradient-border::before {
                    content: '';
                    position: absolute;
                    inset: 0;
                    border-radius: inherit;
                    padding: 3px;
                    background: linear-gradient(135deg, #00C2FF, #8B5CF6, #FFD500);
                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
                    -webkit-mask-composite: xor;
                    mask-composite: exclude;
                    pointer-events: none;
                }

            `})]})},gCe=n=>{const[e,t]=V.useState({new:[],inProgress:[],completed:[]}),[r,s]=V.useState(!0),[i,o]=V.useState(null),[a,l]=V.useState(0);return V.useEffect(()=>{if(!n){s(!1);return}const c=Uh(Zs(Kt,"student_tasks"),Ow("assignedAt","desc")),u=Uh(Zs(Kt,"task_submissions"),$m("studentId","==",n));let h=[],f=[];const p=()=>{const v=new Map;f.forEach(T=>{v.set(T.taskId,T)});const w=h.filter(T=>{var R;return T.assignedTo==="all"||((R=T.studentIds)==null?void 0:R.includes(n))||T.assignedTo==="group"}).map(T=>{var O,D;const R=v.get(T.id),M=new Date,E=(O=T.dueDate)!=null&&O.toDate?T.dueDate.toDate():T.dueDate?new Date(T.dueDate):null,I=E?M>E:!1;let S="new";R&&(R.status==="graded"?S="graded":R.status==="submitted"?S="submitted":R.progress>0&&(S="in_progress"));const N=(D=T.assignedAt)!=null&&D.toDate?T.assignedAt.toDate():new Date,P=S==="new"&&M.getTime()-N.getTime()<24*60*60*1e3;return{id:T.id,taskId:T.id,submissionId:R==null?void 0:R.id,courseId:T.courseId,courseTitle:T.courseTitle,unitId:T.unitId,unitTitle:T.unitTitle,title:T.title,instructions:T.instructions,teacherName:T.teacherName,status:S,progress:(R==null?void 0:R.progress)||0,assignedDate:T.assignedAt,dueDate:T.dueDate,submittedAt:R==null?void 0:R.submittedAt,maxPoints:T.maxPoints,score:R==null?void 0:R.score,percentage:R==null?void 0:R.percentage,taskType:T.taskType,isOverdue:I,isNew:P}});w.sort((T,R)=>{var N,P;const M=T.status==="submitted"||T.status==="graded",E=R.status==="submitted"||R.status==="graded";if(M!==E)return M?1:-1;if(T.isNew!==R.isNew)return T.isNew?-1:1;const I=((N=T.dueDate)==null?void 0:N.seconds)||0,S=((P=R.dueDate)==null?void 0:P.seconds)||0;return I-S});const k={new:[],inProgress:[],completed:[]};w.forEach(T=>{T.status==="submitted"||T.status==="graded"?k.completed.push(T):T.status==="in_progress"?k.inProgress.push(T):k.new.push(T)}),t(k),l(k.new.filter(T=>T.isNew).length),s(!1)},g=Ab(c,v=>{h=[],v.forEach(b=>{h.push({id:b.id,...b.data()})}),p()},v=>{console.error("Error fetching tasks:",v),o(v.message),s(!1)}),y=Ab(u,v=>{f=[],v.forEach(b=>{f.push({id:b.id,...b.data()})}),p()},v=>{console.error("Error fetching submissions:",v)});return()=>{g(),y()}},[n]),{assignments:e,loading:r,error:i,newTasksCount:a}},yCe="student_tasks",xCe="task_submissions";async function e8e(n){var r;const e={teacherId:n.teacherId,teacherName:n.teacherName,courseId:n.courseId,courseTitle:n.courseTitle,unitId:n.unitId,unitTitle:n.unitTitle,title:n.title,instructions:n.instructions||"",assignedTo:n.assignedTo,classId:n.classId,className:n.className,studentIds:n.studentIds,groupType:n.groupType,assignedAt:rd(),dueDate:n.dueDate?Gn.fromDate(n.dueDate):null,maxPoints:n.maxPoints||100,taskType:n.taskType||"activity",emailReportEnabled:n.emailReportEnabled??!1},t=await Fw(Zs(Kt,yCe),e);return n.assignedTo==="individual"&&((r=n.studentIds)!=null&&r.length)&&await bCe(t.id,n.studentIds),t.id}async function bCe(n,e){const t=Cae(Kt);for(const r of e){const s=or(Zs(Kt,xCe));t.set(s,{taskId:n,studentId:r,status:"new",progress:0,createdAt:rd()})}await t.commit()}function lJ(n){if(!n)return"";const e=n.toDate?n.toDate():new Date(n),t=new Date,r=e.getTime()-t.getTime(),s=Math.ceil(r/(1e3*60*60*24));return s<0?`  ${Math.abs(s)} `:s===0?"":s===1?"":s<=7?` ${s} `:e.toLocaleDateString("he-IL",{day:"numeric",month:"short"})}const vCe=()=>({xp:1450,level:12,streak:{current:14,isFrozen:!1,freezesAvailable:2,history:[!0,!0,!1,!0,!0,!0,!0]},currency:{gems:450},league:{name:"Ruby League",rank:4,isPromotionZone:!0,totalParticipants:30},dailyGoal:{targetXp:50,currentXp:35}}),wCe=({task:n,onClick:e})=>{const t=n.status==="submitted"||n.status==="graded",r=n.isOverdue&&!t,s=n.isNew,i=()=>n.status==="graded"?d.jsxs("span",{className:"px-2.5 py-1 bg-wizdi-action-light text-wizdi-action-dark text-xs font-bold rounded-full flex items-center gap-1","aria-label":"",children:[d.jsx(M_,{size:12,"aria-hidden":"true"})," "]}):n.status==="submitted"?d.jsxs("span",{className:"px-2.5 py-1 bg-wizdi-cyan/20 text-wizdi-cyan text-xs font-bold rounded-full flex items-center gap-1","aria-label":"",children:[d.jsx(M1,{size:12,"aria-hidden":"true"})," "]}):r?d.jsxs("span",{className:"px-2.5 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full flex items-center gap-1","aria-label":"",children:[d.jsx(d0e,{size:12,"aria-hidden":"true"})," "]}):s?d.jsxs("span",{className:"px-2.5 py-1 bg-wizdi-royal/10 text-wizdi-royal text-xs font-bold rounded-full flex items-center gap-1 animate-pulse motion-reduce:animate-none","aria-label":" ",children:[d.jsx(ng,{size:12,"aria-hidden":"true"})," "]}):n.progress>0?d.jsx("span",{className:"px-2.5 py-1 bg-wizdi-gold/20 text-wizdi-gold text-xs font-bold rounded-full","aria-label":"",children:""}):null,o=()=>n.taskType==="exam"?d.jsx(M1,{size:20,"aria-hidden":"true"}):n.taskType==="practice"?d.jsx(P_,{size:20,"aria-hidden":"true"}):d.jsx(R1,{size:20,"aria-hidden":"true"}),a=()=>n.taskType==="exam"?"":n.taskType==="practice"?"":"",l=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),e())};return d.jsxs("article",{onClick:e,onKeyDown:l,role:"button",tabIndex:0,"aria-label":`${a()}: ${n.title}. ${t?"":r?"":s?"":""}`,className:`
                card-glass rounded-3xl p-6 cursor-pointer transition-all duration-300
                hover:shadow-xl hover:-translate-y-2 hover:border-wizdi-cyan active:scale-[0.98]
                focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2
                motion-reduce:hover:transform-none motion-reduce:active:transform-none
                dark:bg-slate-800/80
                ${t?"opacity-75":r?"ring-2 ring-red-200":s?"ring-2 ring-wizdi-cyan/30 shadow-lg shadow-wizdi-cyan/10":""}
            `,children:[d.jsxs("div",{className:"flex items-start justify-between mb-3",children:[d.jsx("div",{className:`p-2.5 rounded-xl ${t?"bg-wizdi-action-light text-wizdi-action":r?"bg-red-100 text-red-600":"bg-wizdi-royal/10 text-wizdi-royal"}`,"aria-hidden":"true",children:o()}),i()]}),d.jsx("h3",{className:`font-bold text-lg mb-1 line-clamp-2 ${t?"text-slate-400 dark:text-slate-500":"text-slate-800 dark:text-white"}`,children:n.title}),d.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:[n.courseTitle," ",n.teacherName&&` ${n.teacherName}`]}),n.progress>0&&n.progress<100&&d.jsxs("div",{className:"mb-3",role:"progressbar","aria-valuenow":n.progress,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`: ${n.progress}%`,children:[d.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400 mb-1",children:[d.jsx("span",{children:""}),d.jsxs("span",{children:[n.progress,"%"]})]}),d.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-gradient-to-l from-wizdi-royal to-wizdi-cyan rounded-full transition-all",style:{width:`${n.progress}%`}})})]}),n.status==="graded"&&n.score!==void 0&&d.jsxs("div",{className:"mb-3 bg-wizdi-action-light dark:bg-wizdi-action/20 rounded-xl p-3 text-center border border-wizdi-action/20","aria-label":`: ${n.percentage}%, ${n.score}  ${n.maxPoints} `,children:[d.jsxs("div",{className:"text-2xl font-black text-wizdi-action",children:[n.percentage,"%"]}),d.jsxs("div",{className:"text-xs text-wizdi-action/80",children:[n.score,"/",n.maxPoints," "]})]}),d.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 dark:border-slate-700",children:[n.dueDate&&!t&&d.jsxs("div",{className:`flex items-center gap-1.5 text-sm ${r?"text-red-600 font-medium":"text-slate-500 dark:text-slate-400"}`,children:[d.jsx(tS,{size:14,"aria-hidden":"true"}),d.jsx("span",{children:lJ(n.dueDate)})]}),t&&n.submittedAt&&d.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-slate-400 dark:text-slate-500",children:[d.jsx(M_,{size:14,"aria-hidden":"true"}),d.jsx("span",{children:""})]}),!n.dueDate&&!t&&d.jsx("div",{}),d.jsxs("div",{className:"flex items-center gap-1 text-sm text-wizdi-gold font-medium",children:[d.jsx(rg,{size:14,className:"fill-wizdi-gold","aria-hidden":"true"}),d.jsxs("span",{children:[n.maxPoints," "]})]})]}),!t&&d.jsx("div",{className:"mt-4 flex items-center justify-center","aria-hidden":"true",children:d.jsxs("span",{className:"btn-lip-action px-6 py-2 min-h-[36px] text-sm",children:[n.progress>0?"":""," ",d.jsx(wc,{size:16,className:"inline mr-1"})]})})]})},kCe=({type:n})=>{const t={"no-tasks":{icon:d.jsx(ng,{size:48,className:"text-wizdi-cyan"}),title:"  !",description:"     . ,      ."},"no-pending":{icon:d.jsx(M_,{size:48,className:"text-wizdi-lime"}),title:" !",description:"    .    ."},"no-completed":{icon:d.jsx(P_,{size:48,className:"text-slate-400"}),title:"   ",description:"       ."}}[n];return d.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[d.jsx("div",{className:"p-4 bg-wizdi-cloud rounded-3xl mb-4 shadow-lg",children:t.icon}),d.jsx("h3",{className:"text-xl font-bold text-wizdi-royal mb-2",children:t.title}),d.jsx("p",{className:"text-slate-500 max-w-xs",children:t.description})]})},cJ=({onSelectAssignment:n,highlightCourseId:e})=>{var w;const{currentUser:t}=kf(),{assignments:r,loading:s,newTasksCount:i}=gCe(t==null?void 0:t.uid),o=vCe(),[a,l]=V.useState("all"),[c,u]=V.useState(null),[h,f]=V.useState(!1),g=(()=>{const k=[...r.new,...r.inProgress,...r.completed];switch(a){case"pending":return[...r.new,...r.inProgress];case"completed":return r.completed;default:return k}})(),y=r.new.length+r.inProgress.length,v=k=>{u(k)},b=()=>{c&&(n(c.courseId,c.unitId),u(null))};return s?d.jsxs("div",{className:"h-screen flex flex-col items-center justify-center",children:[d.jsx(Yw,{size:"xl",color:"primary",className:"mb-4"}),d.jsx("p",{className:"text-wizdi-royal font-bold animate-pulse",children:"   ..."})]}):d.jsxs("div",{className:"min-h-screen pb-32 font-sans text-slate-900 overflow-x-hidden",dir:"rtl",children:[d.jsx("header",{className:"sticky top-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-b border-wizdi-cloud dark:border-slate-800 z-sticky",role:"banner",children:d.jsxs("div",{className:"max-w-7xl mx-auto px-4 h-16 flex items-center justify-between",children:[d.jsx("button",{onClick:()=>f(!0),className:"hover:bg-wizdi-cloud dark:hover:bg-slate-800 p-2 min-h-[44px] min-w-[44px] rounded-xl cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":" -   ",children:d.jsx(B0e,{className:"w-6 h-6 text-slate-400 dark:text-slate-500","aria-hidden":"true"})}),d.jsxs("button",{className:"flex items-center gap-2 hover:bg-wizdi-cloud dark:hover:bg-slate-800 p-2 min-h-[44px] rounded-xl cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-gold","aria-label":`: ${o.league.name},  ${o.league.rank}  ${o.league.totalParticipants}`,children:[d.jsx(J6,{className:"text-wizdi-gold fill-wizdi-gold w-6 h-6","aria-hidden":"true"}),d.jsxs("div",{className:"hidden sm:block text-right",children:[d.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase",children:""}),d.jsx("div",{className:"text-sm font-bold text-wizdi-gold",children:o.league.name})]})]}),d.jsxs("button",{className:"flex items-center gap-2 hover:bg-wizdi-cloud dark:hover:bg-slate-800 p-2 min-h-[44px] rounded-xl cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500","aria-label":`: ${o.streak.current}  `,children:[d.jsxs("div",{className:"relative",children:[d.jsx($D,{className:"text-orange-500 fill-orange-500 w-6 h-6 animate-pulse motion-reduce:animate-none","aria-hidden":"true"}),d.jsx("div",{className:"absolute -bottom-1 -right-1 bg-orange-500 text-white text-[9px] font-black px-1 rounded-full","aria-hidden":"true",children:o.streak.current})]}),d.jsxs("span",{className:"hidden sm:block text-sm font-bold text-orange-600",children:[o.streak.current," "]})]}),d.jsxs("button",{className:"flex items-center gap-2 hover:bg-wizdi-cloud dark:hover:bg-slate-800 p-2 min-h-[44px] rounded-xl cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan","aria-label":`${o.currency.gems} `,children:[d.jsx(K6,{className:"text-wizdi-cyan fill-wizdi-cyan w-6 h-6","aria-hidden":"true"}),d.jsx("span",{className:"text-sm font-bold text-wizdi-cyan",children:o.currency.gems})]}),d.jsxs("button",{className:"relative hover:bg-wizdi-cloud dark:hover:bg-slate-800 p-2 min-h-[44px] min-w-[44px] rounded-xl cursor-pointer transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal","aria-label":i>0?`${i}  `:"  ",children:[d.jsx(m0e,{className:"w-6 h-6 text-slate-400 dark:text-slate-500","aria-hidden":"true"}),i>0&&d.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center animate-bounce motion-reduce:animate-none","aria-hidden":"true",children:i})]})]})}),h&&d.jsxs("div",{className:"fixed inset-0 z-modal flex items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"stats-legend-title",children:[d.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>f(!1),"aria-hidden":"true"}),d.jsxs("div",{className:"bg-white dark:bg-slate-800 w-[90%] max-w-md rounded-3xl relative z-10 shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200",children:[d.jsxs("div",{className:"bg-gradient-to-l from-wizdi-royal to-wizdi-cyan p-4 text-white flex items-center justify-between",children:[d.jsx("h2",{id:"stats-legend-title",className:"text-lg font-bold",children:"   ?"}),d.jsx("button",{onClick:()=>f(!1),className:"p-2 hover:bg-white/20 rounded-full transition-colors","aria-label":"",children:d.jsx(wme,{size:20})})]}),d.jsxs("div",{className:"p-5 space-y-4",children:[d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-2.5 bg-wizdi-gold/10 rounded-xl flex-shrink-0",children:d.jsx(J6,{className:"text-wizdi-gold fill-wizdi-gold w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:""}),d.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"      !"})]})]}),d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex-shrink-0",children:d.jsx($D,{className:"text-orange-500 fill-orange-500 w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:""}),d.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"   .     !"})]})]}),d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-2.5 bg-wizdi-cyan/10 rounded-xl flex-shrink-0",children:d.jsx(K6,{className:"text-wizdi-cyan fill-wizdi-cyan w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:""}),d.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"        !"})]})]}),d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-2.5 bg-wizdi-gold/10 rounded-xl flex-shrink-0",children:d.jsx(rg,{className:"text-wizdi-gold fill-wizdi-gold w-6 h-6"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:" (XP)"}),d.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"     .     !"})]})]})]}),d.jsx("div",{className:"p-4 border-t border-slate-100 dark:border-slate-700",children:d.jsx("button",{onClick:()=>f(!1),className:"w-full btn-lip-primary py-3 rounded-xl font-bold",children:"!"})})]})]}),d.jsxs("div",{className:"max-w-7xl mx-auto px-4 pt-6",children:[d.jsxs("div",{className:"mb-6",children:[d.jsxs("h1",{className:"text-2xl font-black text-wizdi-royal",children:[" ",((w=t==null?void 0:t.displayName)==null?void 0:w.split(" ")[0])||"/","!"]}),d.jsx("p",{className:"text-slate-500 mt-1",children:y>0?`  ${y}  `:"   - !"})]}),d.jsxs("div",{className:"mb-6 card-glass p-4 rounded-3xl shadow-xl",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(P_,{className:"text-wizdi-royal",size:20}),d.jsx("span",{className:"font-bold text-wizdi-royal",children:" "})]}),d.jsxs("span",{className:"text-sm text-slate-500",children:[o.dailyGoal.currentXp,"/",o.dailyGoal.targetXp," XP"]})]}),d.jsx("div",{className:"h-3 bg-slate-100 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-gradient-to-l from-wizdi-royal to-wizdi-cyan rounded-full transition-all duration-500",style:{width:`${Math.min(o.dailyGoal.currentXp/o.dailyGoal.targetXp*100,100)}%`}})}),o.dailyGoal.currentXp>=o.dailyGoal.targetXp]}),d.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",role:"tablist","aria-label":" ",children:[d.jsx("button",{onClick:()=>l("all"),role:"tab","aria-selected":a==="all","aria-controls":"tasks-panel",className:`px-4 py-2 min-h-[44px] rounded-full font-bold text-sm whitespace-nowrap transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 ${a==="all"?"btn-lip-primary shadow-lg":"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:border-wizdi-cyan"}`,children:" "}),d.jsxs("button",{onClick:()=>l("pending"),role:"tab","aria-selected":a==="pending","aria-controls":"tasks-panel",className:`px-4 py-2 min-h-[44px] rounded-full font-bold text-sm whitespace-nowrap transition-all flex items-center gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 ${a==="pending"?"btn-lip-primary shadow-lg":"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:border-wizdi-cyan"}`,children:["",y>0&&d.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs font-bold ${a==="pending"?"bg-white/20":"bg-wizdi-royal/10 text-wizdi-royal dark:bg-wizdi-royal/20"}`,"aria-label":`${y} `,children:y})]}),d.jsx("button",{onClick:()=>l("completed"),role:"tab","aria-selected":a==="completed","aria-controls":"tasks-panel",className:`px-4 py-2 min-h-[44px] rounded-full font-bold text-sm whitespace-nowrap transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan focus-visible:ring-offset-2 ${a==="completed"?"btn-lip-primary shadow-lg":"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:border-wizdi-cyan"}`,children:""})]}),d.jsx("div",{id:"tasks-panel",role:"tabpanel","aria-label":`: ${a==="all"?" ":a==="pending"?"":""}`,children:g.length===0?d.jsx(kCe,{type:a==="completed"?"no-completed":a==="pending"?"no-pending":"no-tasks"}):d.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",role:"list","aria-label":" ",children:g.map(k=>d.jsx(wCe,{task:k,onClick:()=>v(k)},k.id))})})]}),c&&d.jsxs("div",{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center",role:"dialog","aria-modal":"true","aria-labelledby":"task-modal-title",children:[d.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>u(null),"aria-hidden":"true"}),d.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full sm:w-[480px] sm:rounded-3xl rounded-t-3xl relative z-10 animate-in slide-in-from-bottom-10 duration-300 shadow-2xl overflow-hidden motion-reduce:animate-none",children:[d.jsx("div",{className:`p-6 text-white ${c.status==="graded"?"bg-gradient-to-l from-wizdi-action to-wizdi-action-dark":c.isOverdue?"bg-gradient-to-l from-red-500 to-orange-500":"bg-gradient-to-l from-wizdi-royal to-wizdi-cyan"}`,children:d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsx("div",{className:"p-3 bg-white/20 rounded-xl","aria-hidden":"true",children:c.taskType==="exam"?d.jsx(M1,{size:28}):c.taskType==="practice"?d.jsx(P_,{size:28}):d.jsx(R1,{size:28})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{id:"task-modal-title",className:"text-xl font-bold mb-1",children:c.title}),d.jsx("p",{className:"text-white/80 text-sm",children:c.courseTitle})]})]})}),d.jsxs("div",{className:"p-6",children:[c.instructions&&d.jsxs("div",{className:"mb-4 p-4 bg-wizdi-cloud dark:bg-slate-700 rounded-xl",children:[d.jsx("h4",{className:"font-bold text-wizdi-royal dark:text-wizdi-cyan mb-2",children:" :"}),d.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm",children:c.instructions})]}),d.jsxs("dl",{className:"space-y-3 mb-6",children:[c.dueDate&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("dt",{className:"text-slate-500 dark:text-slate-400 flex items-center gap-2",children:[d.jsx(tS,{size:18,"aria-hidden":"true"})," "]}),d.jsx("dd",{className:`font-medium ${c.isOverdue?"text-red-600":"text-slate-800 dark:text-slate-200"}`,children:lJ(c.dueDate)})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("dt",{className:"text-slate-500 dark:text-slate-400 flex items-center gap-2",children:[d.jsx(rg,{size:18,className:"text-wizdi-gold","aria-hidden":"true"})," "]}),d.jsxs("dd",{className:"font-medium text-slate-800 dark:text-slate-200",children:[c.maxPoints," "]})]}),c.teacherName&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("dt",{className:"text-slate-500 dark:text-slate-400",children:""}),d.jsx("dd",{className:"font-medium text-slate-800 dark:text-slate-200",children:c.teacherName})]})]}),c.status==="graded"&&c.score!==void 0&&d.jsxs("div",{className:"mb-6 bg-wizdi-action-light dark:bg-wizdi-action/20 rounded-xl p-4 text-center border border-wizdi-action/20","aria-label":`: ${c.percentage}%`,children:[d.jsxs("div",{className:"text-4xl font-black text-wizdi-action mb-1",children:[c.percentage,"%"]}),d.jsxs("div",{className:"text-wizdi-action/80",children:[c.score,"/",c.maxPoints," "]})]}),c.progress>0&&c.progress<100&&d.jsxs("div",{className:"mb-6",role:"progressbar","aria-valuenow":c.progress,"aria-valuemin":0,"aria-valuemax":100,children:[d.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-500 dark:text-slate-400 mb-2",children:[d.jsx("span",{children:" "}),d.jsxs("span",{children:[c.progress,"%"]})]}),d.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-gradient-to-l from-wizdi-royal to-wizdi-cyan rounded-full",style:{width:`${c.progress}%`}})})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsx("button",{onClick:()=>u(null),className:"px-4 py-3 min-h-[44px] rounded-full font-bold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",children:""}),d.jsxs("button",{onClick:b,disabled:c.status==="graded"||c.status==="submitted","aria-disabled":c.status==="graded"||c.status==="submitted",className:`flex items-center justify-center gap-2 min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-cyan ${c.status==="graded"||c.status==="submitted"?"px-4 py-3 rounded-full font-bold bg-slate-300 dark:bg-slate-600 text-slate-500 dark:text-slate-400 cursor-not-allowed":"btn-lip-action px-4 py-3"}`,children:[d.jsx(_me,{size:18,"aria-hidden":"true"}),c.progress>0?"":""]})]})]})]})]}),d.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-t border-wizdi-cloud dark:border-slate-800 p-4 pb-6 flex justify-around md:hidden z-fixed",role:"navigation","aria-label":" ",children:[d.jsxs("button",{className:"flex flex-col items-center gap-1 text-wizdi-royal min-w-[44px] min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal rounded-lg p-1","aria-current":"page","aria-label":" -  ",children:[d.jsx(R1,{className:"w-6 h-6","aria-hidden":"true"}),d.jsx("span",{className:"text-[10px] font-bold",children:""})]}),d.jsxs("button",{className:"flex flex-col items-center gap-1 text-slate-400 dark:text-slate-500 hover:text-wizdi-royal dark:hover:text-wizdi-cyan min-w-[44px] min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal rounded-lg p-1","aria-label":"",children:[d.jsx(fme,{className:"w-6 h-6","aria-hidden":"true"}),d.jsx("span",{className:"text-[10px] font-bold",children:""})]}),d.jsxs("button",{className:"flex flex-col items-center gap-1 text-slate-400 dark:text-slate-500 hover:text-wizdi-royal dark:hover:text-wizdi-cyan min-w-[44px] min-h-[44px] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-wizdi-royal rounded-lg p-1","aria-label":"",children:[d.jsx(dme,{className:"w-6 h-6","aria-hidden":"true"}),d.jsx("span",{className:"text-[10px] font-bold",children:""})]})]})]})},t8e=Object.freeze(Object.defineProperty({__proto__:null,default:cJ},Symbol.toStringTag,{value:"Module"})),_Ce=({onLogin:n})=>{const[e,t]=V.useState("profile");return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-wizdi-cloud via-white to-blue-50 text-wizdi-royal font-sans overflow-x-hidden",dir:"rtl",children:[d.jsxs("nav",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-white/40 px-6 py-4 flex justify-between items-center shadow-glass",children:[d.jsx("div",{className:"flex items-center gap-2",children:d.jsx("img",{src:"/WizdiLogo.png",alt:"Wizdi",className:"h-20 w-auto",loading:"eager",decoding:"async"})}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:n,className:"text-wizdi-royal hover:text-wizdi-royal/80 font-bold transition-colors",children:" "}),d.jsx("button",{onClick:n,className:"btn-lip-action px-6 py-2.5 text-wizdi-royal shadow-3d hover:shadow-lg transition-all transform hover:-translate-y-0.5",children:" "})]})]}),d.jsx("section",{className:"relative pt-20 pb-48 px-6 overflow-hidden",children:d.jsxs("div",{className:"container mx-auto grid lg:grid-cols-2 gap-16 items-center",children:[d.jsxs("div",{className:"text-right space-y-8 z-20 relative",children:[d.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/60 border border-white/50 rounded-full text-wizdi-royal font-bold text-sm animate-fade-in-up shadow-sm backdrop-blur-sm",children:[d.jsx(Hi,{className:"w-4 h-4 text-wizdi-cyan"}),d.jsx("span",{children:"    "})]}),d.jsxs("h1",{className:"text-5xl lg:text-7xl font-black leading-[1.1] tracking-tight text-wizdi-royal pb-2 drop-shadow-sm",children:["   ",d.jsx("br",{}),d.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-wizdi-cyan to-wizdi-royal",children:"  "})]}),d.jsx("p",{className:"text-xl text-slate-600 font-medium max-w-xl leading-relaxed",children:"  ,    ,     -    ."}),d.jsxs("div",{className:"flex flex-col sm:flex-row gap-5 pt-4",children:[d.jsxs("button",{onClick:n,className:"btn-lip-action px-10 py-4 text-lg text-wizdi-royal flex items-center justify-center gap-2 shadow-xl shadow-lime-300/30",children:[d.jsx(RD,{className:"w-6 h-6"}),"  "]}),d.jsxs("button",{className:"btn-lip-primary px-10 py-4 text-lg flex items-center justify-center gap-2 shadow-xl shadow-blue-900/10",children:[d.jsx(VT,{className:"w-6 h-6 fill-white"}),"  ?"]})]}),d.jsxs("div",{className:"pt-8 flex items-center gap-4 text-sm text-slate-500 font-medium",children:[d.jsx("div",{className:"flex -space-x-2 space-x-reverse",children:[1,2,3,4].map(r=>d.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 border-2 border-white flex items-center justify-center text-xs font-bold text-indigo-700",children:String.fromCharCode(64+r)},r))}),d.jsx("span",{children:"    "})]})]}),d.jsxs("div",{className:"relative z-10 lg:h-[700px] flex items-center justify-center",children:[d.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"}),d.jsx("div",{className:"absolute -bottom-8 left-0 w-96 h-96 bg-wizdi-lime/30 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"}),d.jsx("div",{className:"absolute top-1/2 left-1/2 w-96 h-96 bg-wizdi-cyan/30 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"}),d.jsx("img",{src:"/images/hero-illustration.png",alt:"AI Education Illustration",className:"relative z-10 w-full max-w-3xl h-auto object-contain drop-shadow-2xl"})]})]})}),d.jsxs("section",{className:"py-24 bg-gradient-to-b from-white to-wizdi-cloud relative border-b border-indigo-50",children:[d.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"}),d.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[d.jsxs("div",{className:"text-center mb-16",children:[d.jsx("div",{className:"inline-block px-4 py-1.5 rounded-full bg-indigo-50 text-wizdi-royal font-bold text-sm mb-4 border border-indigo-100",children:" "}),d.jsx("h2",{className:"text-4xl font-black text-wizdi-royal mb-4",children:"  ?"}),d.jsx("p",{className:"text-xl text-slate-500",children:"      "})]}),d.jsxs("div",{className:"grid md:grid-cols-3 gap-12 relative",children:[d.jsx("div",{className:"hidden md:block absolute top-[3.5rem] right-1/6 left-1/6 h-1 bg-gradient-to-l from-transparent via-slate-200 to-transparent -z-10 bg-[length:20px_100%]"}),[{icon:R_,title:"1.  ",desc:"  ,   PDF   ",color:"text-wizdi-royal",bg:"bg-white",border:"border-indigo-100"},{icon:bpe,title:"2.  ",desc:"      (,   )",color:"text-wizdi-royal",bg:"bg-white",border:"border-indigo-100"},{icon:RD,title:"3.  ",desc:"   ,   ",color:"text-wizdi-lime",bg:"bg-wizdi-royal text-white",border:"border-transparent"}].map((r,s)=>d.jsxs("div",{className:"relative flex flex-col items-center text-center group cursor-pointer",children:[d.jsxs("div",{className:`w-28 h-28 ${r.bg} rounded-[2rem] flex items-center justify-center mb-8 shadow-xl shadow-indigo-900/5 group-hover:scale-110 group-hover:shadow-indigo-900/10 transition-all duration-300 border ${r.border} z-10`,children:[d.jsx(r.icon,{className:`w-12 h-12 ${s===2?"text-wizdi-lime":r.color}`}),d.jsx("div",{className:"absolute -top-3 -right-3 w-8 h-8 rounded-full bg-wizdi-cyan text-white font-black flex items-center justify-center border-4 border-white shadow-sm",children:s+1})]}),d.jsx("h3",{className:"text-2xl font-black text-wizdi-royal mb-3",children:r.title}),d.jsx("p",{className:"text-slate-500 text-lg leading-relaxed max-w-xs",children:r.desc})]},s))]})]})]}),d.jsx("section",{className:"py-24 px-6 bg-slate-50",children:d.jsxs("div",{className:"container mx-auto max-w-6xl",children:[d.jsxs("div",{className:"text-center mb-16",children:[d.jsx("div",{className:"inline-block px-4 py-1.5 rounded-full bg-white text-wizdi-royal font-bold text-sm mb-4 border border-indigo-100 shadow-sm",children:" "}),d.jsx("h2",{className:"text-4xl font-black text-wizdi-royal mb-4",children:"   "}),d.jsx("p",{className:"text-xl text-slate-500",children:"     "})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 grid-rows-[auto_auto] gap-6",children:[d.jsxs("div",{className:"md:col-span-2 bg-white p-8 rounded-[2.5rem] relative overflow-hidden group hover:shadow-2xl transition-all border border-slate-100 shadow-sm",children:[d.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-br from-wizdi-cloud/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),d.jsxs("div",{className:"relative z-10 max-w-md",children:[d.jsx("div",{className:"w-14 h-14 bg-wizdi-royal rounded-2xl flex items-center justify-center text-white mb-6 shadow-indigo-300/50 shadow-lg transform rotate-3 group-hover:rotate-6 transition-transform",children:d.jsx(Mx,{className:"w-8 h-8"})}),d.jsx("h3",{className:"text-3xl font-bold text-wizdi-royal mb-3",children:" "}),d.jsx("p",{className:"text-slate-500 text-lg leading-relaxed mb-8",children:"      ,        :  ,  ,  ."})]}),d.jsx("div",{className:"absolute top-1/4 -left-12 opacity-80 group-hover:opacity-100 group-hover:-translate-x-2 transition-all duration-500",children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"w-72 h-14 bg-white rounded-2xl shadow-md flex items-center px-4 gap-3 border border-slate-100 z-30 relative",children:[d.jsx("span",{className:"w-3 h-3 rounded-full bg-green-400"}),d.jsx("div",{className:"h-2 bg-slate-100 rounded-full w-24"}),d.jsx("span",{className:"text-sm font-bold text-wizdi-royal mr-auto",children:""})]}),d.jsxs("div",{className:"w-72 h-14 bg-slate-50 rounded-2xl shadow-sm flex items-center px-4 gap-3 translate-x-6 border border-slate-100 z-20 relative opacity-90",children:[d.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-400"}),d.jsx("div",{className:"h-2 bg-slate-200 rounded-full w-24"}),d.jsx("span",{className:"text-sm font-bold text-wizdi-royal mr-auto",children:""})]}),d.jsxs("div",{className:"w-72 h-14 bg-slate-100 rounded-2xl shadow-sm flex items-center px-4 gap-3 translate-x-12 border border-slate-100 z-10 relative opacity-80",children:[d.jsx("span",{className:"w-3 h-3 rounded-full bg-purple-400"}),d.jsx("div",{className:"h-2 bg-slate-200 rounded-full w-24"}),d.jsx("span",{className:"text-sm font-bold text-wizdi-royal mr-auto",children:""})]})]})})]}),d.jsxs("div",{className:"md:col-span-1 bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all group overflow-hidden relative",children:[d.jsx("div",{className:"absolute inset-0 bg-teal-50/50 opacity-0 group-hover:opacity-100 transition-opacity"}),d.jsxs("div",{className:"relative z-10 h-full flex flex-col",children:[d.jsx("div",{className:"w-14 h-14 bg-teal-500 rounded-2xl flex items-center justify-center text-white mb-6 shadow-teal-200 shadow-lg transform -rotate-3 group-hover:scale-110 transition-transform",children:d.jsx(MD,{className:"w-8 h-8"})}),d.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-3",children:"  "}),d.jsx("p",{className:"text-slate-500 mb-6 flex-1",children:"     ,  ,   ."}),d.jsxs("div",{className:"mt-auto bg-white p-4 rounded-2xl shadow-sm border border-slate-200",children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsx("span",{className:"text-xs font-bold text-teal-700",children:" "}),d.jsx("span",{className:"text-lg font-black text-teal-600",children:"88%"})]}),d.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:d.jsx("div",{className:"h-full bg-teal-500 w-[88%]"})})]})]})]}),d.jsxs("div",{className:"md:col-span-1 bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all group overflow-hidden relative",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-50/50 opacity-0 group-hover:opacity-100 transition-opacity"}),d.jsxs("div",{className:"relative z-10",children:[d.jsx("div",{className:"w-12 h-12 bg-orange-500 rounded-2xl flex items-center justify-center text-white mb-4 shadow-orange-200 shadow-md transform rotate-1 group-hover:rotate-0 transition-transform",children:d.jsx(I1,{className:"w-6 h-6"})}),d.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:"  "}),d.jsx("p",{className:"text-slate-500 text-sm",children:" PDF      ."})]})]}),d.jsxs("div",{className:"md:col-span-2 bg-wizdi-royal p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden group hover:shadow-2xl transition-all flex flex-col md:flex-row items-center gap-8 text-white",children:[d.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-tr from-white/10 to-transparent pointer-events-none"}),d.jsxs("div",{className:"relative z-10 flex-1",children:[d.jsx("div",{className:"inline-block px-3 py-1 bg-white/20 rounded-lg text-xs font-bold mb-4 backdrop-blur-sm border border-white/20",children:""}),d.jsx("h3",{className:"text-2xl font-bold mb-2",children:"  "}),d.jsx("p",{className:"text-blue-100",children:'   ""  "". ,      .'})]}),d.jsxs("div",{className:"relative z-10 flex-1 bg-white text-slate-800 rounded-2xl p-6 w-full shadow-lg transform translate-y-4 group-hover:translate-y-2 transition-transform",children:[d.jsxs("div",{className:"flex gap-2 mb-3",children:[d.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded text-[10px] font-bold text-slate-500",children:""}),d.jsx("span",{className:"px-2 py-1 bg-slate-100 rounded text-[10px] font-bold text-slate-500",children:""})]}),d.jsx("div",{className:"text-xl font-serif text-slate-800 leading-tight",children:'"    "'}),d.jsx("div",{className:"text-xs text-slate-400 mt-2 text-left",children:'-  "'})]})]})]})]})}),d.jsxs("section",{className:"py-24 bg-gradient-to-b from-white via-blue-50 to-white relative overflow-hidden",children:[d.jsx("div",{className:"absolute top-0 right-0 w-[800px] h-[800px] bg-wizdi-cyan/10 rounded-full mix-blend-multiply filter blur-3xl opacity-50 animate-blob pointer-events-none"}),d.jsx("div",{className:"absolute bottom-0 left-0 w-[600px] h-[600px] bg-wizdi-lime/10 rounded-full mix-blend-multiply filter blur-3xl opacity-50 animate-blob animation-delay-2000 pointer-events-none"}),d.jsxs("div",{className:"container mx-auto px-6 relative z-10",children:[d.jsxs("div",{className:"text-center mb-20",children:[d.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-blue-100 rounded-full text-wizdi-royal font-bold text-sm mb-6 shadow-sm",children:[d.jsx(Mx,{className:"w-4 h-4 text-wizdi-cyan"}),d.jsx("span",{children:" "})]}),d.jsxs("h2",{className:"text-4xl lg:text-5xl font-black text-wizdi-royal mb-6",children:['  "",  ',d.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-wizdi-cyan to-wizdi-royal",children:" "})]}),d.jsx("p",{className:"text-xl text-slate-500 max-w-2xl mx-auto",children:"       .     ,     ."})]}),d.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 items-start",children:[d.jsxs("div",{className:"card-glass p-8 relative group hover:-translate-y-2 transition-transform duration-300",children:[d.jsx("div",{className:"absolute -top-6 -right-6 w-24 h-24 bg-blue-500/10 rounded-full blur-2xl group-hover:bg-blue-500/20 transition-colors"}),d.jsx("div",{className:"mb-8 relative",children:d.jsxs("div",{className:"relative bg-white/50 backdrop-blur-sm rounded-2xl p-4 shadow-inner border border-white",children:[d.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[d.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-300",children:d.jsx(H6,{className:"w-6 h-6"})}),d.jsxs("div",{className:"space-y-2 flex-1",children:[d.jsx("div",{className:"h-2 bg-indigo-50 rounded-full w-3/4"}),d.jsx("div",{className:"h-2 bg-indigo-50 rounded-full w-1/2"})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.jsxs("div",{className:"bg-blue-50/80 p-2 rounded-xl text-center border border-blue-100",children:[d.jsx("div",{className:"text-xs text-blue-400 font-bold",children:" "}),d.jsx("div",{className:"text-lg font-black text-blue-600",children:"8m"})]}),d.jsxs("div",{className:"bg-purple-50/80 p-2 rounded-xl text-center border border-purple-100",children:[d.jsx("div",{className:"text-xs text-purple-400 font-bold",children:" "}),d.jsx("div",{className:"text-lg font-black text-purple-600",children:""})]})]})]})}),d.jsx("h3",{className:"text-2xl font-bold text-wizdi-royal mb-3",children:" "}),d.jsx("p",{className:"text-slate-600 text-lg leading-relaxed",children:"    ,    ,     ."})]}),d.jsxs("div",{className:"bg-wizdi-royal rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl shadow-blue-900/20 scale-105 z-10 ring-4 ring-white/50",children:[d.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),d.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-wizdi-cyan/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"}),d.jsxs("div",{className:"mb-8 bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 relative",children:[d.jsx("div",{className:"absolute -top-3 -right-3",children:d.jsxs("span",{className:"relative flex h-4 w-4",children:[d.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-wizdi-lime opacity-75"}),d.jsx("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-wizdi-lime"})]})}),d.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/80 flex items-center justify-center font-bold shadow-lg text-xs backdrop-blur-sm",children:""}),d.jsx("div",{className:"h-0.5 flex-1 bg-white/20 relative",children:d.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-wizdi-royal px-3 py-1 rounded-full text-xs border border-white/20 whitespace-nowrap shadow-xl",children:"AI  "})}),d.jsx("div",{className:"w-8 h-8 rounded-full bg-wizdi-lime text-green-900 flex items-center justify-center font-bold shadow-lg text-xs",children:""})]}),d.jsx("div",{className:"text-center text-blue-100 text-sm font-medium bg-blue-950/30 p-3 rounded-xl border border-white/10",children:'"  .   ..."'})]}),d.jsx("h3",{className:"text-2xl font-bold mb-3",children:"   (BKT)"}),d.jsx("p",{className:"text-blue-100 text-lg leading-relaxed",children:"    ,  .          * * ."})]}),d.jsxs("div",{className:"card-glass p-8 relative group hover:-translate-y-2 transition-transform duration-300",children:[d.jsx("div",{className:"absolute -top-6 -left-6 w-24 h-24 bg-amber-500/10 rounded-full blur-2xl group-hover:bg-amber-500/20 transition-colors"}),d.jsx("div",{className:"mb-8 relative flex justify-center",children:d.jsx("div",{className:"relative w-full",children:d.jsxs("div",{className:"bg-white/50 backdrop-blur-sm p-4 rounded-2xl shadow-inner border border-white flex flex-col items-center",children:[d.jsxs("div",{className:"w-full flex items-center gap-3 mb-3 border-b border-gray-100/50 pb-3",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100/80 flex items-center justify-center text-red-500 font-bold text-xs",children:"!"}),d.jsx("div",{className:"text-xs text-slate-600 font-bold flex-1 text-right",children:"3  "})]}),d.jsxs("div",{className:"w-full flex items-center gap-3",children:[d.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100/80 flex items-center justify-center text-green-600 font-bold text-xs",children:""}),d.jsx("div",{className:"text-xs text-slate-600 font-bold flex-1 text-right",children:"85%  "})]})]})})}),d.jsx("h3",{className:"text-2xl font-bold text-wizdi-royal mb-3",children:" "}),d.jsx("p",{className:"text-slate-600 text-lg leading-relaxed",children:'    ,       : "   X", "   Y", "    Z".'})]})]})]})]}),d.jsxs("section",{className:"py-24 px-6 bg-gradient-to-b from-[#FDFCF8] via-white to-wizdi-cloud relative overflow-hidden",children:[d.jsx("div",{className:"absolute top-1/2 left-1/3 w-[500px] h-[500px] bg-wizdi-cyan/5 rounded-full filter blur-[100px] pointer-events-none"}),d.jsx("div",{className:"absolute bottom-0 right-1/4 w-[400px] h-[400px] bg-wizdi-lime/5 rounded-full filter blur-[80px] pointer-events-none"}),d.jsxs("div",{className:"container mx-auto relative z-10",children:[d.jsxs("div",{className:"flex items-end justify-between mb-16",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-white border border-blue-100 rounded-full text-wizdi-royal font-bold text-xs mb-4 shadow-sm",children:[d.jsx(Gy,{className:"w-3 h-3 text-wizdi-cyan"}),d.jsx("span",{children:"  "})]}),d.jsx("h2",{className:"text-4xl font-black text-wizdi-royal mb-2",children:"  "}),d.jsx("p",{className:"text-slate-500 text-lg",children:"    -   "})]}),d.jsxs("button",{onClick:n,className:"hidden md:flex items-center gap-2 text-wizdi-royal font-bold hover:bg-white px-6 py-3 rounded-full transition-all border border-blue-100 hover:shadow-glass hover:scale-105 bg-white/50 backdrop-blur-sm",children:[d.jsx("span",{children:"  "}),d.jsx(VT,{className:"w-5 h-5"})]})]}),d.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[{name:"YouTube ",icon:R_,color:"text-red-500",bg:"bg-red-50",border:"group-hover:border-red-200"},{name:" ",icon:R8,color:"text-purple-500",bg:"bg-purple-50",border:"group-hover:border-purple-200"},{name:" ",icon:p0,color:"text-blue-500",bg:"bg-blue-50",border:"group-hover:border-blue-200"},{name:" ",icon:MD,color:"text-green-500",bg:"bg-green-50",border:"group-hover:border-green-200"},{name:" ",icon:Wq,color:"text-orange-500",bg:"bg-orange-50",border:"group-hover:border-orange-200"},{name:" ",icon:I1,color:"text-teal-500",bg:"bg-teal-50",border:"group-hover:border-teal-200"},{name:" ",icon:Mx,color:"text-pink-500",bg:"bg-pink-50",border:"group-hover:border-pink-200"},{name:" PDF",icon:Yl,color:"text-indigo-500",bg:"bg-indigo-50",border:"group-hover:border-indigo-200"}].map((r,s)=>d.jsxs("div",{className:"card-glass p-8 rounded-[2rem] hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col items-center text-center gap-6 group relative overflow-hidden border border-white/60",children:[d.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),d.jsx("div",{className:`w-20 h-20 ${r.bg} rounded-2xl flex items-center justify-center transition-all duration-500 group-hover:scale-110 group-hover:rotate-6 shadow-sm ring-1 ring-black/5 relative z-10`,children:d.jsx(r.icon,{className:`w-10 h-10 ${r.color}`})}),d.jsx("span",{className:"font-bold text-slate-700 text-lg group-hover:text-wizdi-royal transition-colors relative z-10",children:r.name})]},s))})]})]}),d.jsxs("section",{className:"py-24 bg-[#0F172A] relative overflow-hidden text-white border-t border-slate-800",children:[d.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none",children:[d.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[800px] h-[800px] bg-wizdi-royal/30 rounded-full blur-[120px] mix-blend-screen"}),d.jsx("div",{className:"absolute bottom-[-20%] left-[-10%] w-[800px] h-[800px] bg-purple-600/20 rounded-full blur-[120px] mix-blend-screen"}),d.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 animate-pulse"})]}),d.jsx("div",{className:"container mx-auto px-6 relative z-10",children:d.jsxs("div",{className:"grid lg:grid-cols-2 gap-16 items-center",children:[d.jsxs("div",{className:"text-right space-y-8 order-2 lg:order-1",children:[d.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-wizdi-lime/10 border border-wizdi-lime/20 rounded-full text-wizdi-lime font-bold text-sm shadow-glow-lime",children:[d.jsx(gpe,{className:"w-4 h-4"}),d.jsx("span",{children:"   "})]}),d.jsxs("h2",{className:"text-4xl lg:text-6xl font-black leading-tight",children:["    ",d.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-wizdi-lime to-wizdi-cyan",children:" "})]}),d.jsx("p",{className:"text-xl text-slate-300 leading-relaxed max-w-lg",children:'    "",   XP,  ,   " " (Streak)    .'}),d.jsxs("div",{className:"grid grid-cols-2 gap-6 pt-4",children:[d.jsxs("div",{className:"bg-slate-800/40 backdrop-blur-md p-5 rounded-3xl border border-slate-700/50 hover:bg-slate-800/60 transition-colors group",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx("div",{className:"w-12 h-12 rounded-2xl bg-orange-500/20 flex items-center justify-center text-orange-400 group-hover:scale-110 transition-transform",children:d.jsx(PD,{className:"w-7 h-7"})}),d.jsx("div",{className:"font-bold text-xl",children:"Streaks"})]}),d.jsx("p",{className:"text-slate-400 text-sm font-medium",children:"    "})]}),d.jsxs("div",{className:"bg-slate-800/40 backdrop-blur-md p-5 rounded-3xl border border-slate-700/50 hover:bg-slate-800/60 transition-colors group",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[d.jsx("div",{className:"w-12 h-12 rounded-2xl bg-yellow-500/20 flex items-center justify-center text-yellow-400 group-hover:scale-110 transition-transform",children:d.jsx(UT,{className:"w-7 h-7"})}),d.jsx("div",{className:"font-bold text-xl",children:" "})]}),d.jsx("p",{className:"text-slate-400 text-sm font-medium",children:"  ,   "})]})]})]}),d.jsxs("div",{className:"relative order-1 lg:order-2",children:[d.jsx("div",{className:"absolute inset-0 bg-wizdi-royal/20 blur-3xl rounded-full"}),d.jsx("div",{className:"bg-slate-900/90 backdrop-blur-xl rounded-[3rem] p-3 border border-slate-700 shadow-2xl relative z-10 overflow-hidden transform hover:scale-[1.01] transition-transform duration-700 shadow-purple-900/40",children:d.jsxs("div",{className:"bg-slate-950 rounded-[2.5rem] p-8 text-white border border-slate-800 h-[600px] flex flex-col items-center relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px]"}),d.jsxs("div",{className:"relative z-10 text-center mb-10 mt-6 w-full",children:[d.jsxs("div",{className:"w-28 h-28 rounded-full bg-gradient-to-tr from-wizdi-royal to-purple-600 p-1 mx-auto mb-5 shadow-lg shadow-purple-600/30 relative",children:[d.jsx("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",alt:"Avatar",className:"w-full h-full rounded-full bg-slate-900",loading:"lazy",decoding:"async"}),d.jsx("div",{className:"absolute -bottom-3 left-1/2 -translate-x-1/2 bg-wizdi-lime text-slate-900 font-black px-4 py-1 rounded-full border-[3px] border-slate-900 text-sm shadow-lg whitespace-nowrap z-20",children:"LVL 5"})]}),d.jsx("h3",{className:"text-3xl font-bold mb-1",children:" "}),d.jsx("div",{className:"text-slate-400 font-medium",children:"   2,450 XP"})]}),d.jsxs("div",{className:"grid grid-cols-3 gap-4 w-full max-w-sm mb-10 relative z-10 px-4",children:[d.jsxs("div",{className:"bg-slate-800/80 p-4 rounded-3xl text-center border border-slate-700 hover:bg-slate-800 transition-colors",children:[d.jsx(PD,{className:"w-7 h-7 text-orange-500 mx-auto mb-2"}),d.jsx("div",{className:"font-black text-xl mb-1",children:"12"}),d.jsx("div",{className:"text-[11px] text-slate-500 font-bold uppercase tracking-wider",children:""})]}),d.jsxs("div",{className:"bg-slate-800/80 p-4 rounded-3xl text-center border border-slate-700 hover:bg-slate-800 transition-colors",children:[d.jsx(UT,{className:"w-7 h-7 text-yellow-400 mx-auto mb-2"}),d.jsx("div",{className:"font-black text-xl mb-1",children:"450"}),d.jsx("div",{className:"text-[11px] text-slate-500 font-bold uppercase tracking-wider",children:""})]}),d.jsxs("div",{className:"bg-slate-800/80 p-4 rounded-3xl text-center border border-slate-700 hover:bg-slate-800 transition-colors",children:[d.jsx(q6,{className:"w-7 h-7 text-wizdi-cyan mx-auto mb-2"}),d.jsx("div",{className:"font-black text-xl mb-1",children:"Top 5"}),d.jsx("div",{className:"text-[11px] text-slate-500 font-bold uppercase tracking-wider",children:""})]})]}),d.jsxs("div",{className:"w-full bg-slate-800/50 rounded-t-[2.5rem] p-6 border-t border-r border-l border-slate-700 backdrop-blur-md flex-1 relative z-10 -mb-8",children:[d.jsxs("div",{className:"flex justify-between items-center mb-6",children:[d.jsx("span",{className:"font-bold text-base text-slate-200",children:" "}),d.jsx("div",{className:"bg-slate-700/50 p-2 rounded-xl",children:d.jsx(p0,{className:"w-4 h-4 text-slate-400"})})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-center gap-4 bg-slate-700/60 p-4 rounded-2xl border border-slate-600/50 hover:bg-slate-700 transition-colors cursor-pointer group",children:[d.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center text-green-400 group-hover:bg-green-500 group-hover:text-white transition-all",children:d.jsx(br,{className:"w-6 h-6"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("div",{className:"text-base font-bold text-slate-200",children:" "}),d.jsx("div",{className:"text-xs text-slate-400 font-medium mt-0.5",children:"  +100 XP"})]})]}),d.jsxs("div",{className:"flex items-center gap-4 bg-wizdi-royal/20 p-4 rounded-2xl border border-wizdi-royal/40 cursor-pointer relative overflow-hidden group",children:[d.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 bg-wizdi-royal"}),d.jsx("div",{className:"w-12 h-12 rounded-xl bg-wizdi-royal flex items-center justify-center text-white animate-pulse shadow-lg shadow-blue-500/20",children:d.jsx(VT,{className:"w-6 h-6 fill-current"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("div",{className:"text-base font-bold text-white group-hover:text-blue-200 transition-colors",children:" "}),d.jsx("div",{className:"text-xs text-blue-300 font-medium mt-0.5",children:"   5 '"})]})]})]})]})]})}),d.jsxs("div",{className:"absolute top-20 -right-16 bg-white text-slate-900 px-5 py-3 rounded-2xl font-bold text-sm shadow-2xl rotate-12 animate-float z-20 flex items-center gap-3 border-4 border-slate-900/10",children:[d.jsx("span",{className:"text-2xl",children:""}),d.jsxs("div",{children:[d.jsx("div",{className:"leading-none",children:" !"}),d.jsx("div",{className:"text-[10px] text-slate-500 font-medium",children:" "})]})]}),d.jsxs("div",{className:"absolute bottom-32 -left-12 bg-slate-950/90 backdrop-blur text-white px-5 py-3 rounded-2xl font-bold text-sm shadow-2xl -rotate-6 animate-float animation-delay-2000 z-20 flex items-center gap-3 border border-slate-700/50",children:[d.jsx("div",{className:"bg-yellow-400/20 p-1.5 rounded-lg",children:d.jsx(UT,{className:"text-yellow-400 w-5 h-5"})}),d.jsxs("div",{children:[d.jsx("div",{className:"leading-none text-yellow-100",children:"+50 "}),d.jsx("div",{className:"text-[10px] text-slate-500 font-medium",children:" "})]})]})]})]})})]}),d.jsxs("section",{className:"bg-wizdi-royal py-20 px-6 text-center text-white relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"}),d.jsxs("div",{className:"container mx-auto relative z-10",children:[d.jsx("h2",{className:"text-4xl lg:text-5xl font-black mb-8",children:"   ?"}),d.jsx("button",{onClick:n,className:"btn-lip-action px-12 py-5 text-xl text-green-900 bg-[#A3E635] shadow-2xl hover:scale-105 transition-all",children:"  "}),d.jsx("p",{className:"mt-6 text-blue-200",children:"     "})]})]})]})},SCe=V.lazy(()=>Ln(()=>import("./SequentialCoursePlayerMobile-D_B-IH36.js"),[])),TCe=V.lazy(()=>Ln(()=>import("./HomePageRedesignMobile-BfUQLeUG.js"),__vite__mapDeps([5,6,7,8]))),ACe=V.lazy(()=>Ln(()=>import("./StudentHomeMobile-DwRh8Vxq.js"),__vite__mapDeps([9,8]))),ECe=V.lazy(()=>Ln(()=>import("./LandingPageMobile-C2sSw7Of.js"),[])),RS=()=>d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900",children:d.jsxs("div",{className:"text-center",children:[d.jsx(Yw,{size:"lg",color:"primary",className:"mx-auto mb-3"}),d.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"..."})]})}),_z=n=>Z3()?d.jsx(V.Suspense,{fallback:d.jsx(RS,{}),children:d.jsx(SCe,{assignment:n.assignment,onExit:n.onExit,simulateGuest:n.simulateGuest})}):d.jsx(oCe,{...n}),CCe=n=>Z3()?d.jsx(V.Suspense,{fallback:d.jsx(RS,{}),children:d.jsx(TCe,{...n})}):d.jsx(mCe,{...n}),NCe=n=>Z3()?d.jsx(V.Suspense,{fallback:d.jsx(RS,{}),children:d.jsx(ACe,{...n})}):d.jsx(cJ,{...n}),ICe=n=>Z3()?d.jsx(V.Suspense,{fallback:d.jsx(RS,{}),children:d.jsx(ECe,{...n})}):d.jsx(_Ce,{...n}),R5="ai_lms_geo_check_v2",RCe=60*60*1e3;function Sz(){try{const n=sessionStorage.getItem(R5);if(!n)return null;const{result:e,timestamp:t}=JSON.parse(n);return Date.now()-t<RCe?e:(sessionStorage.removeItem(R5),null)}catch{return null}}function MCe(n){try{sessionStorage.setItem(R5,JSON.stringify({result:n,timestamp:Date.now()}))}catch{}}async function PCe(){const n=[{name:"ipwho.is",url:"https://ipwho.is/",extractCountry:e=>e.success!==!1?e.country_code:null},{name:"ipapi.co",url:"https://ipapi.co/json/",extractCountry:e=>e.country_code||e.country},{name:"ipinfo.io",url:"https://ipinfo.io/json",extractCountry:e=>e.country},{name:"freeipapi.com",url:"https://freeipapi.com/api/json/",extractCountry:e=>e.countryCode},{name:"ipdata.co",url:"https://api.ipdata.co/?api-key=test",extractCountry:e=>e.country_code}];for(const e of n)try{const t=new AbortController,r=setTimeout(()=>t.abort(),5e3),s=await fetch(e.url,{signal:t.signal,headers:{Accept:"application/json"}});if(clearTimeout(r),!s.ok){console.warn(`[GeoGuard] ${e.name} returned ${s.status}`);continue}const i=await s.json(),o=e.extractCountry(i);if(o){const a=o.toUpperCase(),l=a==="IL";return console.log(`[GeoGuard] ${e.name}: country=${a}, allowed=${l}`),{allowed:l,country:a,method:e.name}}}catch(t){t.name==="AbortError"?console.warn(`[GeoGuard] ${e.name} timeout`):console.warn(`[GeoGuard] ${e.name} error:`,t.message)}return{allowed:!0,country:null,method:"fallback",error:"All geo APIs failed"}}async function LCe(n,e){try{const{logSecurityEvent:t}=await Ln(async()=>{const{logSecurityEvent:r}=await import("./loggerService-Cqt-Jc9o.js");return{logSecurityEvent:r}},[]);t("GEO_BLOCK",{country:n,method:e,timestamp:new Date().toISOString(),url:window.location.href})}catch{console.warn("[GeoGuard] Failed to log geo block event")}}const DCe=({children:n,bypassInDev:e=!0,failOpen:t=!0})=>{const[r,s]=V.useState(()=>Sz()),[i,o]=V.useState(!r),a=V.useCallback(async()=>{const l=Sz();if(l){s(l),o(!1);return}o(!0);try{const c=await PCe();c.error&&!t&&(c.allowed=!1),MCe(c),s(c),c.allowed||await LCe(c.country,c.method)}catch(c){console.error("[GeoGuard] Unexpected error:",c),s({allowed:t,country:null,method:"error-fallback",error:"Unexpected error during geo check"})}finally{o(!1)}},[e,t]);return V.useEffect(()=>{r||a()},[r,a]),i||r===null?d.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50 flex-col gap-4",children:[d.jsx(Kq,{className:"w-10 h-10 text-indigo-600 animate-spin"}),d.jsx("p",{className:"text-gray-500 font-medium",children:"  ..."}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Security verification in progress..."})]}):r.allowed?d.jsx(d.Fragment,{children:n}):d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-orange-50 p-4",children:d.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md text-center border-t-4 border-red-500",children:[d.jsx("div",{className:"text-5xl mb-4",children:""}),d.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",dir:"rtl",children:"   "}),d.jsxs("p",{className:"text-gray-600 mb-6",dir:"rtl",children:["     .",d.jsx("br",{}),"      ,   VPN  ."]}),d.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[d.jsx("h2",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Access Restricted to Israel"}),d.jsxs("p",{className:"text-gray-500 text-sm",children:["This system is only available for users in Israel.",d.jsx("br",{}),"If you are in Israel and seeing this message, try disabling your VPN or proxy."]})]}),r.country&&r.country!=="UNKNOWN"&&d.jsx("div",{className:"mt-6 p-3 bg-gray-100 rounded-lg",children:d.jsxs("p",{className:"text-xs text-gray-500",children:["Detected location: ",d.jsx("span",{className:"font-mono font-bold",children:r.country})]})}),d.jsxs("div",{className:"mt-6 text-xs text-gray-400",children:["Event ID: GEO_",Date.now().toString(36).toUpperCase()]}),d.jsx("div",{className:"mt-6",children:d.jsx("button",{onClick:()=>{sessionStorage.removeItem(R5),s(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"  / Retry"})})]})})};class Tz extends V.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("LazyLoadErrorBoundary caught error:",e,t),(e.message.includes("Failed to fetch dynamically imported module")||e.name==="ChunkLoadError")&&console.log("Chunk load error detected. Reloading page to fetch new version...")}render(){return this.state.hasError?d.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 text-gray-800 p-4 text-center",children:[d.jsx("div",{className:"text-6xl mb-4",children:""}),d.jsx("h1",{className:"text-2xl font-bold mb-2",children:"!     "}),d.jsx("p",{className:"text-gray-600 mb-6",children:"        ..."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-colors shadow-lg",children:" "})]}):this.props.children}}var Kx={};Kx.d=(n,e)=>{for(var t in e)Kx.o(e,t)&&!Kx.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};Kx.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var St=globalThis.pdfjsLib={};Kx.d(St,{AbortException:()=>ff,AnnotationEditorLayer:()=>hI,AnnotationEditorParamsType:()=>rn,AnnotationEditorType:()=>Pt,AnnotationEditorUIManager:()=>F0,AnnotationLayer:()=>IIe,AnnotationMode:()=>Gd,ColorPicker:()=>O5,DOMSVGFactory:()=>mM,DrawLayer:()=>mI,FeatureTest:()=>Qi,GlobalWorkerOptions:()=>ju,ImageKind:()=>rk,InvalidPDFException:()=>iN,MissingPDFException:()=>Hb,OPS:()=>fl,OutputScale:()=>aN,PDFDataRangeTransport:()=>dQ,PDFDateString:()=>dM,PDFWorker:()=>cg,PasswordResponses:()=>zCe,PermissionFlag:()=>FCe,PixelsPerInch:()=>pf,RenderingCancelledException:()=>cM,TextLayer:()=>qb,TouchManager:()=>D5,UnexpectedResponseException:()=>M5,Util:()=>Je,VerbosityLevel:()=>MS,XfaLayer:()=>fQ,build:()=>uIe,createValidAbsoluteUrl:()=>UCe,fetchData:()=>jS,getDocument:()=>tIe,getFilenameFromUrl:()=>QCe,getPdfFilenameFromUrl:()=>ZCe,getXfaPageViewport:()=>eNe,isDataScheme:()=>OS,isPdfFile:()=>uM,noContextMenu:()=>Bl,normalizeUnicode:()=>YCe,setLayerDimensions:()=>O0,shadow:()=>Ht,stopEvent:()=>sa,version:()=>cIe});const ki=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),uJ=[1,0,0,1,0,0],sN=[.001,0,0,.001,0,0],jCe=1e7,oE=1.35,Zo={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Gd={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},OCe="pdfjs_internal_editor_",Pt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},rn={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},FCe={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ci={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},rk={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},us={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},Ry={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},MS={ERRORS:0,WARNINGS:1,INFOS:5},fl={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},zCe={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let PS=MS.WARNINGS;function BCe(n){Number.isInteger(n)&&(PS=n)}function $Ce(){return PS}function LS(n){PS>=MS.INFOS&&console.log(`Info: ${n}`)}function Lt(n){PS>=MS.WARNINGS&&console.log(`Warning: ${n}`)}function zn(n){throw new Error(n)}function Xr(n,e){n||zn(e)}function VCe(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function UCe(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const s=n.match(/\./g);(s==null?void 0:s.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=KCe(n)}catch{}}const r=e?new URL(n,e):new URL(n);if(VCe(r))return r}catch{}return null}function Ht(n,e,t,r=!1){return Object.defineProperty(n,e,{value:t,enumerable:!r,configurable:!0,writable:!1}),t}const Cf=function(){function e(t,r){this.message=t,this.name=r}return e.prototype=new Error,e.constructor=e,e}();class Az extends Cf{constructor(e,t){super(e,"PasswordException"),this.code=t}}class aE extends Cf{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class iN extends Cf{constructor(e){super(e,"InvalidPDFException")}}class Hb extends Cf{constructor(e){super(e,"MissingPDFException")}}class M5 extends Cf{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class HCe extends Cf{constructor(e){super(e,"FormatError")}}class ff extends Cf{constructor(e){super(e,"AbortException")}}function dJ(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&zn("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const r=[];for(let s=0;s<e;s+=t){const i=Math.min(s+t,e),o=n.subarray(s,i);r.push(String.fromCharCode.apply(null,o))}return r.join("")}function DS(n){typeof n!="string"&&zn("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let r=0;r<e;++r)t[r]=n.charCodeAt(r)&255;return t}function qCe(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function aM(n){const e=Object.create(null);for(const[t,r]of n)e[t]=r;return e}function GCe(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function WCe(){try{return new Function(""),!0}catch{return!1}}class Qi{static get isLittleEndian(){return Ht(this,"isLittleEndian",GCe())}static get isEvalSupported(){return Ht(this,"isEvalSupported",WCe())}static get isOffscreenCanvasSupported(){return Ht(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Ht(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Ht(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Ht(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return Ht(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const lE=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Ku,sk,oN;class Je{static makeHexColor(e,t,r){return`#${lE[e]}${lE[t]}${lE[r]}`}static scaleMinMax(e,t){let r;e[0]?(e[0]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[3],t[3]*=e[3]):(r=t[0],t[0]=t[1],t[1]=r,r=t[2],t[2]=t[3],t[3]=r,e[1]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const r=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[r,s]}static applyInverseTransform(e,t){const r=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,i=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r;return[s,i]}static getAxialAlignedBoundingBox(e,t){const r=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),i=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(r+o)/2,l=Math.sqrt((r+o)**2-4*(r*o-i*s))/2,c=a+l||1,u=a-l||1;return[Math.sqrt(c),Math.sqrt(u)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const r=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(r>s)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>o?null:[r,i,s,o]}static bezierBoundingBox(e,t,r,s,i,o,a,l,c){return c?(c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l)):c=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],B(this,Ku,oN).call(this,e,r,i,a,t,s,o,l,3*(-e+3*(r-i)+a),6*(e-2*r+i),3*(r-e),c),B(this,Ku,oN).call(this,e,r,i,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),c),c}}Ku=new WeakSet,sk=function(e,t,r,s,i,o,a,l,c,u){if(c<=0||c>=1)return;const h=1-c,f=c*c,p=f*c,g=h*(h*(h*e+3*c*t)+3*f*r)+p*s,y=h*(h*(h*i+3*c*o)+3*f*a)+p*l;u[0]=Math.min(u[0],g),u[1]=Math.min(u[1],y),u[2]=Math.max(u[2],g),u[3]=Math.max(u[3],y)},oN=function(e,t,r,s,i,o,a,l,c,u,h,f){if(Math.abs(c)<1e-12){Math.abs(u)>=1e-12&&B(this,Ku,sk).call(this,e,t,r,s,i,o,a,l,-h/u,f);return}const p=u**2-4*h*c;if(p<0)return;const g=Math.sqrt(p),y=2*c;B(this,Ku,sk).call(this,e,t,r,s,i,o,a,l,(-u+g)/y,f),B(this,Ku,sk).call(this,e,t,r,s,i,o,a,l,(-u-g)/y,f)},z(Je,Ku);function KCe(n){return decodeURIComponent(escape(n))}let cE=null,Ez=null;function YCe(n){return cE||(cE=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ez=new Map([["","t"]])),n.replaceAll(cE,(e,t,r)=>t?t.normalize("NFKC"):Ez.get(r))}function XCe(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),dJ(n)}const lM="pdfjs_internal_id_";function JCe(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(dJ(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const nu="http://www.w3.org/2000/svg",Gf=class Gf{};ct(Gf,"CSS",96),ct(Gf,"PDF",72),ct(Gf,"PDF_TO_CSS_UNITS",Gf.CSS/Gf.PDF);let pf=Gf;async function jS(n,e="text"){if(Zy(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,r)=>{const s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}r(new Error(s.statusText))}},s.send(null)})}class c2{constructor({viewBox:e,userUnit:t,scale:r,rotation:s,offsetX:i=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=r,this.rotation=s,this.offsetX=i,this.offsetY=o,r*=t;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let u,h,f,p;switch(s%=360,s<0&&(s+=360),s){case 180:u=-1,h=0,f=0,p=1;break;case 90:u=0,h=1,f=1,p=0;break;case 270:u=0,h=-1,f=-1,p=0;break;case 0:u=1,h=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let g,y,v,b;u===0?(g=Math.abs(c-e[1])*r+i,y=Math.abs(l-e[0])*r+o,v=(e[3]-e[1])*r,b=(e[2]-e[0])*r):(g=Math.abs(l-e[0])*r+i,y=Math.abs(c-e[1])*r+o,v=(e[2]-e[0])*r,b=(e[3]-e[1])*r),this.transform=[u*r,h*r,f*r,p*r,g-u*r*l-f*r*c,y-h*r*l-p*r*c],this.width=v,this.height=b}get rawDims(){const{userUnit:e,viewBox:t}=this,r=t.map(s=>s*e);return Ht(this,"rawDims",{pageWidth:r[2]-r[0],pageHeight:r[3]-r[1],pageX:r[0],pageY:r[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:s=this.offsetY,dontFlip:i=!1}={}){return new c2({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:s,dontFlip:i})}convertToViewportPoint(e,t){return Je.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Je.applyTransform([e[0],e[1]],this.transform),r=Je.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){return Je.applyInverseTransform([e,t],this.transform)}}class cM extends Cf{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function OS(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function uM(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function QCe(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function ZCe(n,e="document.pdf"){if(typeof n!="string")return e;if(OS(n))return Lt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,r=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(n);let i=r.exec(s[1])||r.exec(s[2])||r.exec(s[3]);if(i&&(i=i[0],i.includes("%")))try{i=r.exec(decodeURIComponent(i))[0]}catch{}return i||e}class Cz{constructor(){ct(this,"started",Object.create(null));ct(this,"times",[])}time(e){e in this.started&&Lt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Lt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:r}of this.times)t=Math.max(r.length,t);for(const{name:r,start:s,end:i}of this.times)e.push(`${r.padEnd(t)} ${i-s}ms
`);return e.join("")}}function Zy(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function Bl(n){n.preventDefault()}function sa(n){n.preventDefault(),n.stopPropagation()}var Wb;class dM{static toDateObject(e){if(!e||typeof e!="string")return null;m(this,Wb)||L(this,Wb,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=m(this,Wb).exec(e);if(!t)return null;const r=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=u,a+=h):c==="+"&&(o-=u,a-=h),new Date(Date.UTC(r,s,i,o,a,l))}}Wb=new WeakMap,z(dM,Wb);function eNe(n,{scale:e=1,rotation:t=0}){const{width:r,height:s}=n.attributes.style,i=[0,0,parseInt(r),parseInt(s)];return new c2({viewBox:i,userUnit:1,scale:e,rotation:t})}function hM(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Lt(`Not a valid color format: "${n}"`),[0,0,0])}function tNe(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const r=window.getComputedStyle(e).color;n.set(t,hM(r))}e.remove()}function rr(n){const{a:e,b:t,c:r,d:s,e:i,f:o}=n.getTransform();return[e,t,r,s,i,o]}function Wl(n){const{a:e,b:t,c:r,d:s,e:i,f:o}=n.getTransform().invertSelf();return[e,t,r,s,i,o]}function O0(n,e,t=!1,r=!0){if(e instanceof c2){const{pageWidth:s,pageHeight:i}=e.rawDims,{style:o}=n,a=Qi.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${i}px`,u=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=u,o.height=h):(o.width=h,o.height=u)}r&&n.setAttribute("data-main-rotation",e.rotation)}class aN{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Wd,sp,pl,ip,Kb,Yb,B5,hJ,Zi,fJ,pJ,ik,mJ,cN;const au=class au{constructor(e){z(this,Zi);z(this,Wd,null);z(this,sp,null);z(this,pl);z(this,ip,null);z(this,Kb,null);L(this,pl,e),m(au,Yb)||L(au,Yb,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=L(this,Wd,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=m(this,pl)._uiManager._signal;e.addEventListener("contextmenu",Bl,{signal:t}),e.addEventListener("pointerdown",B(au,B5,hJ),{signal:t});const r=L(this,ip,document.createElement("div"));r.className="buttons",e.append(r);const s=m(this,pl).toolbarPosition;if(s){const{style:i}=e,o=m(this,pl)._uiManager.direction==="ltr"?1-s[0]:s[0];i.insetInlineEnd=`${100*o}%`,i.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return B(this,Zi,mJ).call(this),e}get div(){return m(this,Wd)}hide(){var e;m(this,Wd).classList.add("hidden"),(e=m(this,sp))==null||e.hideDropdown()}show(){var e;m(this,Wd).classList.remove("hidden"),(e=m(this,Kb))==null||e.shown()}async addAltText(e){const t=await e.render();B(this,Zi,ik).call(this,t),m(this,ip).prepend(t,m(this,Zi,cN)),L(this,Kb,e)}addColorPicker(e){L(this,sp,e);const t=e.renderButton();B(this,Zi,ik).call(this,t),m(this,ip).prepend(t,m(this,Zi,cN))}remove(){var e;m(this,Wd).remove(),(e=m(this,sp))==null||e.destroy(),L(this,sp,null)}};Wd=new WeakMap,sp=new WeakMap,pl=new WeakMap,ip=new WeakMap,Kb=new WeakMap,Yb=new WeakMap,B5=new WeakSet,hJ=function(e){e.stopPropagation()},Zi=new WeakSet,fJ=function(e){m(this,pl)._focusEventsAllowed=!1,sa(e)},pJ=function(e){m(this,pl)._focusEventsAllowed=!0,sa(e)},ik=function(e){const t=m(this,pl)._uiManager._signal;e.addEventListener("focusin",B(this,Zi,fJ).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",B(this,Zi,pJ).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Bl,{signal:t})},mJ=function(){const{editorType:e,_uiManager:t}=m(this,pl),r=document.createElement("button");r.className="delete",r.tabIndex=0,r.setAttribute("data-l10n-id",m(au,Yb)[e]),B(this,Zi,ik).call(this,r),r.addEventListener("click",s=>{t.delete()},{signal:t._signal}),m(this,ip).append(r)},cN=function(){const e=document.createElement("div");return e.className="divider",e},z(au,B5),z(au,Yb,null);let lN=au;var Xb,op,ap,mf,gJ,yJ,xJ;class nNe{constructor(e){z(this,mf);z(this,Xb,null);z(this,op,null);z(this,ap);L(this,ap,e)}show(e,t,r){const[s,i]=B(this,mf,yJ).call(this,t,r),{style:o}=m(this,op)||L(this,op,B(this,mf,gJ).call(this));e.append(m(this,op)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){m(this,op).remove()}}Xb=new WeakMap,op=new WeakMap,ap=new WeakMap,mf=new WeakSet,gJ=function(){const e=L(this,op,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Bl,{signal:m(this,ap)._signal});const t=L(this,Xb,document.createElement("div"));return t.className="buttons",e.append(t),B(this,mf,xJ).call(this),e},yJ=function(e,t){let r=0,s=0;for(const i of e){const o=i.y+i.height;if(o<r)continue;const a=i.x+(t?i.width:0);if(o>r){s=a,r=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,r]},xJ=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const r=m(this,ap)._signal;e.addEventListener("contextmenu",Bl,{signal:r}),e.addEventListener("click",()=>{m(this,ap).highlightSelection("floating_button")},{signal:r}),m(this,Xb).append(e)};function P5(n,e,t){for(const r of t)e.addEventListener(r,n[r].bind(n))}var $5;class rNe{constructor(){z(this,$5,0)}get id(){return`${OCe}${Pi(this,$5)._++}`}}$5=new WeakMap;var ug,Jb,hi,dg,ok;const yM=class yM{constructor(){z(this,dg);z(this,ug,XCe());z(this,Jb,0);z(this,hi,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',r=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const i=s.decode().then(()=>(r.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(r.getImageData(0,0,1,1).data.buffer)[0]===0));return Ht(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:r,size:s,type:i}=e;return B(this,dg,ok).call(this,`${t}_${r}_${s}_${i}`,e)}async getFromUrl(e){return B(this,dg,ok).call(this,e,e)}async getFromBlob(e,t){const r=await t;return B(this,dg,ok).call(this,e,r)}async getFromId(e){m(this,hi)||L(this,hi,new Map);const t=m(this,hi).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:r}=t;return delete t.blobPromise,this.getFromBlob(t.id,r)}return this.getFromUrl(t.url)}getFromCanvas(e,t){m(this,hi)||L(this,hi,new Map);let r=m(this,hi).get(e);if(r!=null&&r.bitmap)return r.refCounter+=1,r;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),r={bitmap:s.transferToImageBitmap(),id:`image_${m(this,ug)}_${Pi(this,Jb)._++}`,refCounter:1,isSvg:!1},m(this,hi).set(e,r),m(this,hi).set(r.id,r),r}getSvgUrl(e){const t=m(this,hi).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;m(this,hi)||L(this,hi,new Map);const t=m(this,hi).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:r}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(r.width,r.height);i.getContext("bitmaprenderer").transferFromImageBitmap(r),t.blobPromise=i.convertToBlob()}(s=r.close)==null||s.call(r),t.bitmap=null}isValidId(e){return e.startsWith(`image_${m(this,ug)}_`)}};ug=new WeakMap,Jb=new WeakMap,hi=new WeakMap,dg=new WeakSet,ok=async function(e,t){m(this,hi)||L(this,hi,new Map);let r=m(this,hi).get(e);if(r===null)return null;if(r!=null&&r.bitmap)return r.refCounter+=1,r;try{r||(r={bitmap:null,id:`image_${m(this,ug)}_${Pi(this,Jb)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(r.url=t,s=await jS(t,"blob")):t instanceof File?s=r.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const i=yM._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,u)=>{a.onload=()=>{r.bitmap=a,r.isSvg=!0,c()},o.onload=async()=>{const h=r.svgUrl=o.result;a.src=await i?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=u});o.readAsDataURL(s),await l}else r.bitmap=await createImageBitmap(s);r.refCounter=1}catch(s){Lt(s),r=null}return m(this,hi).set(e,r),r&&m(this,hi).set(r.id,r),r};let uN=yM;var zr,Kd,Qb,hr;class sNe{constructor(e=128){z(this,zr,[]);z(this,Kd,!1);z(this,Qb);z(this,hr,-1);L(this,Qb,e)}add({cmd:e,undo:t,post:r,mustExec:s,type:i=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),m(this,Kd))return;const l={cmd:e,undo:t,post:r,type:i};if(m(this,hr)===-1){m(this,zr).length>0&&(m(this,zr).length=0),L(this,hr,0),m(this,zr).push(l);return}if(o&&m(this,zr)[m(this,hr)].type===i){a&&(l.undo=m(this,zr)[m(this,hr)].undo),m(this,zr)[m(this,hr)]=l;return}const c=m(this,hr)+1;c===m(this,Qb)?m(this,zr).splice(0,1):(L(this,hr,c),c<m(this,zr).length&&m(this,zr).splice(c)),m(this,zr).push(l)}undo(){if(m(this,hr)===-1)return;L(this,Kd,!0);const{undo:e,post:t}=m(this,zr)[m(this,hr)];e(),t==null||t(),L(this,Kd,!1),L(this,hr,m(this,hr)-1)}redo(){if(m(this,hr)<m(this,zr).length-1){L(this,hr,m(this,hr)+1),L(this,Kd,!0);const{cmd:e,post:t}=m(this,zr)[m(this,hr)];e(),t==null||t(),L(this,Kd,!1)}}hasSomethingToUndo(){return m(this,hr)!==-1}hasSomethingToRedo(){return m(this,hr)<m(this,zr).length-1}cleanType(e){if(m(this,hr)!==-1){for(let t=m(this,hr);t>=0;t--)if(m(this,zr)[t].type!==e){m(this,zr).splice(t+1,m(this,hr)-t),L(this,hr,t);return}m(this,zr).length=0,L(this,hr,-1)}}destroy(){L(this,zr,null)}}zr=new WeakMap,Kd=new WeakMap,Qb=new WeakMap,hr=new WeakMap;var V5,bJ;class u2{constructor(e){z(this,V5);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Qi.platform;for(const[r,s,i={}]of e)for(const o of r){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:i}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:i}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const r=this.callbacks.get(B(this,V5,bJ).call(this,t));if(!r)return;const{callback:s,options:{bubbles:i=!1,args:o=[],checker:a=null}}=r;a&&!a(e,t)||(s.bind(e,...o,t)(),i||sa(t))}}V5=new WeakSet,bJ=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const U5=class U5{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return tNe(e),Ht(this,"_colors",e)}convert(e){const t=hM(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[r,s]of this._colors)if(s.every((i,o)=>i===t[o]))return U5._colorsMapping.get(r);return t}getHexCode(e){const t=this._colors.get(e);return t?Je.makeHexColor(...t):e}};ct(U5,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let dN=U5;var hg,$o,hs,Bs,fg,du,pg,Ia,Yd,lp,mg,cp,sc,ml,up,Zb,ev,gg,tv,ic,Xd,yg,Jd,oc,H5,Qd,nv,Zd,dp,rv,sv,_s,En,hu,hp,iv,ov,eh,ac,fu,av,Ra,Ie,ak,hN,vJ,wJ,lk,kJ,_J,SJ,fN,TJ,pN,mN,AJ,Oi,ru,EJ,CJ,gN,NJ,ex,yN;const Um=class Um{constructor(e,t,r,s,i,o,a,l,c,u,h,f,p){z(this,Ie);z(this,hg,new AbortController);z(this,$o,null);z(this,hs,new Map);z(this,Bs,new Map);z(this,fg,null);z(this,du,null);z(this,pg,null);z(this,Ia,new sNe);z(this,Yd,null);z(this,lp,null);z(this,mg,0);z(this,cp,new Set);z(this,sc,null);z(this,ml,null);z(this,up,new Set);ct(this,"_editorUndoBar",null);z(this,Zb,!1);z(this,ev,!1);z(this,gg,!1);z(this,tv,null);z(this,ic,null);z(this,Xd,null);z(this,yg,null);z(this,Jd,!1);z(this,oc,null);z(this,H5,new rNe);z(this,Qd,!1);z(this,nv,!1);z(this,Zd,null);z(this,dp,null);z(this,rv,null);z(this,sv,null);z(this,_s,Pt.NONE);z(this,En,new Set);z(this,hu,null);z(this,hp,null);z(this,iv,null);z(this,ov,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});z(this,eh,[0,0]);z(this,ac,null);z(this,fu,null);z(this,av,null);z(this,Ra,null);const g=this._signal=m(this,hg).signal;L(this,fu,e),L(this,av,t),L(this,fg,r),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:g}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),s._on("setpreference",this.onSetPreference.bind(this),{signal:g}),s._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:g}),B(this,Ie,kJ).call(this),B(this,Ie,AJ).call(this),B(this,Ie,fN).call(this),L(this,du,i.annotationStorage),L(this,tv,i.filterFactory),L(this,hp,o),L(this,yg,a||null),L(this,Zb,l),L(this,ev,c),L(this,gg,u),L(this,sv,h||null),this.viewParameters={realScale:pf.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=p!==!1}static get _keyboardManager(){const e=Um.prototype,t=o=>m(o,fu).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),r=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new u2([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:r}],[["ctrl+z","mac+meta+z"],e.undo,{checker:r}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:r}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:r}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&m(o,fu).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&m(o,fu).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,r,s,i;(e=m(this,Ra))==null||e.resolve(),L(this,Ra,null),(t=m(this,hg))==null||t.abort(),L(this,hg,null),this._signal=null;for(const o of m(this,Bs).values())o.destroy();m(this,Bs).clear(),m(this,hs).clear(),m(this,up).clear(),L(this,$o,null),m(this,En).clear(),m(this,Ia).destroy(),(r=m(this,fg))==null||r.destroy(),(s=m(this,oc))==null||s.hide(),L(this,oc,null),m(this,ic)&&(clearTimeout(m(this,ic)),L(this,ic,null)),m(this,ac)&&(clearTimeout(m(this,ac)),L(this,ac,null)),(i=this._editorUndoBar)==null||i.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return m(this,sv)}get useNewAltTextFlow(){return m(this,ev)}get useNewAltTextWhenAddingImage(){return m(this,gg)}get hcmFilter(){return Ht(this,"hcmFilter",m(this,hp)?m(this,tv).addHCMFilter(m(this,hp).foreground,m(this,hp).background):"none")}get direction(){return Ht(this,"direction",getComputedStyle(m(this,fu)).direction)}get highlightColors(){return Ht(this,"highlightColors",m(this,yg)?new Map(m(this,yg).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Ht(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),L(this,lp,e)}setMainHighlightColorPicker(e){L(this,rv,e)}editAltText(e,t=!1){var r;(r=m(this,fg))==null||r.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":L(this,gg,t);break}}onPageChanging({pageNumber:e}){L(this,mg,e-1)}focusMainContainer(){m(this,fu).focus()}findParent(e,t){for(const r of m(this,Bs).values()){const{x:s,y:i,width:o,height:a}=r.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=i&&t<=i+a)return r}return null}disableUserSelect(e=!1){m(this,av).classList.toggle("noUserSelect",e)}addShouldRescale(e){m(this,up).add(e)}removeShouldRescale(e){m(this,up).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*pf.PDF_TO_CSS_UNITS;for(const r of m(this,up))r.onScaleChanging();(t=m(this,lp))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:r,anchorOffset:s,focusNode:i,focusOffset:o}=t,a=t.toString(),c=B(this,Ie,ak).call(this,t).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;t.empty();const h=B(this,Ie,hN).call(this,c),f=m(this,_s)===Pt.NONE,p=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:r,anchorOffset:s,focusNode:i,focusOffset:o,text:a}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(Pt.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&m(this,du)&&!m(this,du).has(e.id)&&m(this,du).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,m(this,Jd)&&(L(this,Jd,!1),B(this,Ie,lk).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of m(this,En))if(t.div.contains(e)){L(this,dp,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!m(this,dp))return;const[e,t]=m(this,dp);L(this,dp,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){B(this,Ie,fN).call(this),B(this,Ie,pN).call(this)}removeEditListeners(){B(this,Ie,TJ).call(this),B(this,Ie,mN).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const r of m(this,ml))if(r.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const r of m(this,ml))if(r.isHandlingMimeForPasting(t.type)){r.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var r;if(e.preventDefault(),(r=m(this,$o))==null||r.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of m(this,En)){const i=s.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const o of m(this,ml))if(o.isHandlingMimeForPasting(i.type)){o.paste(i,this.currentLayer);return}let r=t.getData("application/pdfjs");if(!r)return;try{r=JSON.parse(r)}catch(i){Lt(`paste: "${i.message}".`);return}if(!Array.isArray(r))return;this.unselectAll();const s=this.currentLayer;try{const i=[];for(const l of r){const c=await s.deserialize(l);if(!c)return;i.push(c)}const o=()=>{for(const l of i)B(this,Ie,gN).call(this,l);B(this,Ie,yN).call(this,i)},a=()=>{for(const l of i)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(i){Lt(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),m(this,_s)!==Pt.NONE&&!this.isEditorHandlingKeyboard&&Um._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,m(this,Jd)&&(L(this,Jd,!1),B(this,Ie,lk).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(B(this,Ie,_J).call(this),B(this,Ie,pN).call(this),B(this,Ie,Oi).call(this,{isEditing:m(this,_s)!==Pt.NONE,isEmpty:B(this,Ie,ex).call(this),hasSomethingToUndo:m(this,Ia).hasSomethingToUndo(),hasSomethingToRedo:m(this,Ia).hasSomethingToRedo(),hasSelectedEditor:!1})):(B(this,Ie,SJ).call(this),B(this,Ie,mN).call(this),B(this,Ie,Oi).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!m(this,ml)){L(this,ml,e);for(const t of m(this,ml))B(this,Ie,ru).call(this,t.defaultPropertiesToUpdate)}}getId(){return m(this,H5).id}get currentLayer(){return m(this,Bs).get(m(this,mg))}getLayer(e){return m(this,Bs).get(e)}get currentPageIndex(){return m(this,mg)}addLayer(e){m(this,Bs).set(e.pageIndex,e),m(this,Qd)?e.enable():e.disable()}removeLayer(e){m(this,Bs).delete(e.pageIndex)}async updateMode(e,t=null,r=!1){var s;if(m(this,_s)!==e&&!(m(this,Ra)&&(await m(this,Ra).promise,!m(this,Ra)))){if(L(this,Ra,Promise.withResolvers()),L(this,_s,e),e===Pt.NONE){this.setEditingState(!1),B(this,Ie,CJ).call(this),(s=this._editorUndoBar)==null||s.hide(),m(this,Ra).resolve();return}this.setEditingState(!0),await B(this,Ie,EJ).call(this),this.unselectAll();for(const i of m(this,Bs).values())i.updateMode(e);if(!t){r&&this.addNewEditorFromKeyboard(),m(this,Ra).resolve();return}for(const i of m(this,hs).values())i.annotationElementId===t?(this.setSelected(i),i.enterInEditMode()):i.unselect();m(this,Ra).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==m(this,_s)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var r;if(m(this,ml)){switch(e){case rn.CREATE:this.currentLayer.addNewEditor();return;case rn.HIGHLIGHT_DEFAULT_COLOR:(r=m(this,rv))==null||r.updateColor(t);break;case rn.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(m(this,iv)||L(this,iv,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const s of m(this,En))s.updateParams(e,t);for(const s of m(this,ml))s.updateDefaultParams(e,t)}}showAllEditors(e,t,r=!1){var i;for(const o of m(this,hs).values())o.editorType===e&&o.show(t);(((i=m(this,iv))==null?void 0:i.get(rn.HIGHLIGHT_SHOW_ALL))??!0)!==t&&B(this,Ie,ru).call(this,[[rn.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(m(this,nv)!==e){L(this,nv,e);for(const t of m(this,Bs).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const r of m(this,hs).values())r.pageIndex===e&&t.push(r);return t}getEditor(e){return m(this,hs).get(e)}addEditor(e){m(this,hs).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(m(this,ic)&&clearTimeout(m(this,ic)),L(this,ic,setTimeout(()=>{this.focusMainContainer(),L(this,ic,null)},0))),m(this,hs).delete(e.id),this.unselect(e),(!e.annotationElementId||!m(this,cp).has(e.annotationElementId))&&((t=m(this,du))==null||t.remove(e.id))}addDeletedAnnotationElement(e){m(this,cp).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return m(this,cp).has(e)}removeDeletedAnnotationElement(e){m(this,cp).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){m(this,$o)!==e&&(L(this,$o,e),e&&B(this,Ie,ru).call(this,e.propertiesToUpdate))}updateUI(e){m(this,Ie,NJ)===e&&B(this,Ie,ru).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){B(this,Ie,ru).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(m(this,En).has(e)){m(this,En).delete(e),e.unselect(),B(this,Ie,Oi).call(this,{hasSelectedEditor:this.hasSelection});return}m(this,En).add(e),e.select(),B(this,Ie,ru).call(this,e.propertiesToUpdate),B(this,Ie,Oi).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=m(this,lp))==null||t.commitOrRemove();for(const r of m(this,En))r!==e&&r.unselect();m(this,En).clear(),m(this,En).add(e),e.select(),B(this,Ie,ru).call(this,e.propertiesToUpdate),B(this,Ie,Oi).call(this,{hasSelectedEditor:!0})}isSelected(e){return m(this,En).has(e)}get firstSelectedEditor(){return m(this,En).values().next().value}unselect(e){e.unselect(),m(this,En).delete(e),B(this,Ie,Oi).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return m(this,En).size!==0}get isEnterHandled(){return m(this,En).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;m(this,Ia).undo(),B(this,Ie,Oi).call(this,{hasSomethingToUndo:m(this,Ia).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:B(this,Ie,ex).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){m(this,Ia).redo(),B(this,Ie,Oi).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:m(this,Ia).hasSomethingToRedo(),isEmpty:B(this,Ie,ex).call(this)})}addCommands(e){m(this,Ia).add(e),B(this,Ie,Oi).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:B(this,Ie,ex).call(this)})}cleanUndoStack(e){m(this,Ia).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...m(this,En)],r=()=>{var o;(o=this._editorUndoBar)==null||o.show(s,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},s=()=>{for(const o of t)B(this,Ie,gN).call(this,o)};this.addCommands({cmd:r,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=m(this,$o))==null||e.commitOrRemove()}hasSomethingToControl(){return m(this,$o)||this.hasSelection}selectAll(){for(const e of m(this,En))e.commit();B(this,Ie,yN).call(this,m(this,hs).values())}unselectAll(){var e;if(!(m(this,$o)&&(m(this,$o).commitOrRemove(),m(this,_s)!==Pt.NONE))&&!((e=m(this,lp))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of m(this,En))t.unselect();m(this,En).clear(),B(this,Ie,Oi).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,r=!1){if(r||this.commitOrRemove(),!this.hasSelection)return;m(this,eh)[0]+=e,m(this,eh)[1]+=t;const[s,i]=m(this,eh),o=[...m(this,En)],a=1e3;m(this,ac)&&clearTimeout(m(this,ac)),L(this,ac,setTimeout(()=>{L(this,ac,null),m(this,eh)[0]=m(this,eh)[1]=0,this.addCommands({cmd:()=>{for(const l of o)m(this,hs).has(l.id)&&l.translateInPage(s,i)},undo:()=>{for(const l of o)m(this,hs).has(l.id)&&l.translateInPage(-s,-i)},mustExec:!1})},a));for(const l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),L(this,sc,new Map);for(const e of m(this,En))m(this,sc).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!m(this,sc))return!1;this.disableUserSelect(!1);const e=m(this,sc);L(this,sc,null);let t=!1;for(const[{x:s,y:i,pageIndex:o},a]of e)a.newX=s,a.newY=i,a.newPageIndex=o,t||(t=s!==a.savedX||i!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;const r=(s,i,o,a)=>{if(m(this,hs).has(s.id)){const l=m(this,Bs).get(a);l?s._setParentAndPosition(l,i,o):(s.pageIndex=a,s.x=i,s.y=o)}};return this.addCommands({cmd:()=>{for(const[s,{newX:i,newY:o,newPageIndex:a}]of e)r(s,i,o,a)},undo:()=>{for(const[s,{savedX:i,savedY:o,savedPageIndex:a}]of e)r(s,i,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(m(this,sc))for(const r of m(this,sc).keys())r.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||m(this,En).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return m(this,$o)===e}getActive(){return m(this,$o)}getMode(){return m(this,_s)}get imageManager(){return Ht(this,"imageManager",new uN)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let c=0,u=t.rangeCount;c<u;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;const{x:r,y:s,width:i,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,u,h,f)=>({x:(u-s)/o,y:1-(c+h-r)/i,width:f/o,height:h/i});break;case"180":a=(c,u,h,f)=>({x:1-(c+h-r)/i,y:1-(u+f-s)/o,width:h/i,height:f/o});break;case"270":a=(c,u,h,f)=>({x:1-(u+f-s)/o,y:(c-r)/i,width:f/o,height:h/i});break;default:a=(c,u,h,f)=>({x:(c-r)/i,y:(u-s)/o,width:h/i,height:f/o});break}const l=[];for(let c=0,u=t.rangeCount;c<u;c++){const h=t.getRangeAt(c);if(!h.collapsed)for(const{x:f,y:p,width:g,height:y}of h.getClientRects())g===0||y===0||l.push(a(f,p,g,y))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(m(this,pg)||L(this,pg,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=m(this,pg))==null||t.delete(e)}renderAnnotationElement(e){var s;const t=(s=m(this,pg))==null?void 0:s.get(e.data.id);if(!t)return;const r=m(this,du).getRawValue(t);r&&(m(this,_s)===Pt.NONE&&!r.hasBeenModified||r.renderAnnotationElement(e))}};hg=new WeakMap,$o=new WeakMap,hs=new WeakMap,Bs=new WeakMap,fg=new WeakMap,du=new WeakMap,pg=new WeakMap,Ia=new WeakMap,Yd=new WeakMap,lp=new WeakMap,mg=new WeakMap,cp=new WeakMap,sc=new WeakMap,ml=new WeakMap,up=new WeakMap,Zb=new WeakMap,ev=new WeakMap,gg=new WeakMap,tv=new WeakMap,ic=new WeakMap,Xd=new WeakMap,yg=new WeakMap,Jd=new WeakMap,oc=new WeakMap,H5=new WeakMap,Qd=new WeakMap,nv=new WeakMap,Zd=new WeakMap,dp=new WeakMap,rv=new WeakMap,sv=new WeakMap,_s=new WeakMap,En=new WeakMap,hu=new WeakMap,hp=new WeakMap,iv=new WeakMap,ov=new WeakMap,eh=new WeakMap,ac=new WeakMap,fu=new WeakMap,av=new WeakMap,Ra=new WeakMap,Ie=new WeakSet,ak=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},hN=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const r of m(this,Bs).values())if(r.hasTextLayer(e))return r;return null},vJ=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const r=B(this,Ie,ak).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(r);s&&(m(this,oc)||L(this,oc,new nNe(this)),m(this,oc).show(r,s,this.direction==="ltr"))},wJ=function(){var i,o,a;const e=document.getSelection();if(!e||e.isCollapsed){m(this,hu)&&((i=m(this,oc))==null||i.hide(),L(this,hu,null),B(this,Ie,Oi).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===m(this,hu))return;const s=B(this,Ie,ak).call(this,e).closest(".textLayer");if(!s){m(this,hu)&&((o=m(this,oc))==null||o.hide(),L(this,hu,null),B(this,Ie,Oi).call(this,{hasSelectedText:!1}));return}if((a=m(this,oc))==null||a.hide(),L(this,hu,t),B(this,Ie,Oi).call(this,{hasSelectedText:!0}),!(m(this,_s)!==Pt.HIGHLIGHT&&m(this,_s)!==Pt.NONE)&&(m(this,_s)===Pt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),L(this,Jd,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=m(this,_s)===Pt.HIGHLIGHT?B(this,Ie,hN).call(this,s):null;l==null||l.toggleDrawing();const c=new AbortController,u=this.combinedSignal(c),h=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&B(this,Ie,lk).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:u}),window.addEventListener("blur",h,{signal:u})}},lk=function(e=""){m(this,_s)===Pt.HIGHLIGHT?this.highlightSelection(e):m(this,Zb)&&B(this,Ie,vJ).call(this)},kJ=function(){document.addEventListener("selectionchange",B(this,Ie,wJ).bind(this),{signal:this._signal})},_J=function(){if(m(this,Xd))return;L(this,Xd,new AbortController);const e=this.combinedSignal(m(this,Xd));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},SJ=function(){var e;(e=m(this,Xd))==null||e.abort(),L(this,Xd,null)},fN=function(){if(m(this,Zd))return;L(this,Zd,new AbortController);const e=this.combinedSignal(m(this,Zd));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},TJ=function(){var e;(e=m(this,Zd))==null||e.abort(),L(this,Zd,null)},pN=function(){if(m(this,Yd))return;L(this,Yd,new AbortController);const e=this.combinedSignal(m(this,Yd));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},mN=function(){var e;(e=m(this,Yd))==null||e.abort(),L(this,Yd,null)},AJ=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Oi=function(e){Object.entries(e).some(([r,s])=>m(this,ov)[r]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(m(this,ov),e)}),m(this,_s)===Pt.HIGHLIGHT&&e.hasSelectedEditor===!1&&B(this,Ie,ru).call(this,[[rn.HIGHLIGHT_FREE,!0]]))},ru=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},EJ=async function(){if(!m(this,Qd)){L(this,Qd,!0);const e=[];for(const t of m(this,Bs).values())e.push(t.enable());await Promise.all(e);for(const t of m(this,hs).values())t.enable()}},CJ=function(){if(this.unselectAll(),m(this,Qd)){L(this,Qd,!1);for(const e of m(this,Bs).values())e.disable();for(const e of m(this,hs).values())e.disable()}},gN=function(e){const t=m(this,Bs).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},NJ=function(){let e=null;for(e of m(this,En));return e},ex=function(){if(m(this,hs).size===0)return!0;if(m(this,hs).size===1)for(const e of m(this,hs).values())return e.isEmpty();return!1},yN=function(e){for(const t of m(this,En))t.unselect();m(this,En).clear();for(const t of e)t.isEmpty()||(m(this,En).add(t),t.select());B(this,Ie,Oi).call(this,{hasSelectedEditor:this.hasSelection})},ct(Um,"TRANSLATE_SMALL",1),ct(Um,"TRANSLATE_BIG",10);let F0=Um;var Ss,lc,gl,xg,cc,Vo,bg,uc,go,pu,fp,dc,th,Pl,tx,ck;const Fi=class Fi{constructor(e){z(this,Pl);z(this,Ss,null);z(this,lc,!1);z(this,gl,null);z(this,xg,null);z(this,cc,null);z(this,Vo,null);z(this,bg,!1);z(this,uc,null);z(this,go,null);z(this,pu,null);z(this,fp,null);z(this,dc,!1);L(this,go,e),L(this,dc,e._uiManager.useNewAltTextFlow),m(Fi,th)||L(Fi,th,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Fi._l10n??(Fi._l10n=e)}async render(){const e=L(this,gl,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=L(this,xg,document.createElement("span"));e.append(t),m(this,dc)?(e.classList.add("new"),e.setAttribute("data-l10n-id",m(Fi,th).missing),t.setAttribute("data-l10n-id",m(Fi,th)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const r=m(this,go)._uiManager._signal;e.addEventListener("contextmenu",Bl,{signal:r}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:r});const s=i=>{i.preventDefault(),m(this,go)._uiManager.editAltText(m(this,go)),m(this,dc)&&m(this,go)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:m(this,Pl,tx)}})};return e.addEventListener("click",s,{capture:!0,signal:r}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(L(this,bg,!0),s(i))},{signal:r}),await B(this,Pl,ck).call(this),e}finish(){m(this,gl)&&(m(this,gl).focus({focusVisible:m(this,bg)}),L(this,bg,!1))}isEmpty(){return m(this,dc)?m(this,Ss)===null:!m(this,Ss)&&!m(this,lc)}hasData(){return m(this,dc)?m(this,Ss)!==null||!!m(this,pu):this.isEmpty()}get guessedText(){return m(this,pu)}async setGuessedText(e){m(this,Ss)===null&&(L(this,pu,e),L(this,fp,await Fi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),B(this,Pl,ck).call(this))}toggleAltTextBadge(e=!1){var t;if(!m(this,dc)||m(this,Ss)){(t=m(this,uc))==null||t.remove(),L(this,uc,null);return}if(!m(this,uc)){const r=L(this,uc,document.createElement("div"));r.className="noAltTextBadge",m(this,go).div.append(r)}m(this,uc).classList.toggle("hidden",!e)}serialize(e){let t=m(this,Ss);return!e&&m(this,pu)===t&&(t=m(this,fp)),{altText:t,decorative:m(this,lc),guessedText:m(this,pu),textWithDisclaimer:m(this,fp)}}get data(){return{altText:m(this,Ss),decorative:m(this,lc)}}set data({altText:e,decorative:t,guessedText:r,textWithDisclaimer:s,cancel:i=!1}){r&&(L(this,pu,r),L(this,fp,s)),!(m(this,Ss)===e&&m(this,lc)===t)&&(i||(L(this,Ss,e),L(this,lc,t)),B(this,Pl,ck).call(this))}toggle(e=!1){m(this,gl)&&(!e&&m(this,Vo)&&(clearTimeout(m(this,Vo)),L(this,Vo,null)),m(this,gl).disabled=!e)}shown(){m(this,go)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:m(this,Pl,tx)}})}destroy(){var e,t;(e=m(this,gl))==null||e.remove(),L(this,gl,null),L(this,xg,null),L(this,cc,null),(t=m(this,uc))==null||t.remove(),L(this,uc,null)}};Ss=new WeakMap,lc=new WeakMap,gl=new WeakMap,xg=new WeakMap,cc=new WeakMap,Vo=new WeakMap,bg=new WeakMap,uc=new WeakMap,go=new WeakMap,pu=new WeakMap,fp=new WeakMap,dc=new WeakMap,th=new WeakMap,Pl=new WeakSet,tx=function(){return m(this,Ss)&&"added"||m(this,Ss)===null&&this.guessedText&&"review"||"missing"},ck=async function(){var s,i,o;const e=m(this,gl);if(!e)return;if(m(this,dc)){if(e.classList.toggle("done",!!m(this,Ss)),e.setAttribute("data-l10n-id",m(Fi,th)[m(this,Pl,tx)]),(s=m(this,xg))==null||s.setAttribute("data-l10n-id",m(Fi,th)[`${m(this,Pl,tx)}-label`]),!m(this,Ss)){(i=m(this,cc))==null||i.remove();return}}else{if(!m(this,Ss)&&!m(this,lc)){e.classList.remove("done"),(o=m(this,cc))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=m(this,cc);if(!t){L(this,cc,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${m(this,go).id}`;const a=100,l=m(this,go)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(m(this,Vo)),L(this,Vo,null)},{once:!0}),e.addEventListener("mouseenter",()=>{L(this,Vo,setTimeout(()=>{L(this,Vo,null),m(this,cc).classList.add("show"),m(this,go)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;m(this,Vo)&&(clearTimeout(m(this,Vo)),L(this,Vo,null)),(c=m(this,cc))==null||c.classList.remove("show")},{signal:l})}m(this,lc)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=m(this,Ss)),t.parentNode||e.append(t);const r=m(this,go).getImageForAltText();r==null||r.setAttribute("aria-describedby",t.id)},z(Fi,th,null),ct(Fi,"_l10n",null);let L5=Fi;var lv,pp,cv,uv,dv,hv,fv,vg,mu,mp,nh,cd,IJ,RJ,xN;const xM=class xM{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:r=null,onPinchStart:s=null,onPinching:i=null,onPinchEnd:o=null,signal:a}){z(this,cd);z(this,lv);z(this,pp,!1);z(this,cv,null);z(this,uv);z(this,dv);z(this,hv);z(this,fv);z(this,vg);z(this,mu,null);z(this,mp);z(this,nh,null);L(this,lv,e),L(this,cv,r),L(this,uv,t),L(this,dv,s),L(this,hv,i),L(this,fv,o),L(this,mp,new AbortController),L(this,vg,AbortSignal.any([a,m(this,mp).signal])),e.addEventListener("touchstart",B(this,cd,IJ).bind(this),{passive:!1,signal:m(this,vg)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Ht(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=m(this,mp))==null||e.abort(),L(this,mp,null)}};lv=new WeakMap,pp=new WeakMap,cv=new WeakMap,uv=new WeakMap,dv=new WeakMap,hv=new WeakMap,fv=new WeakMap,vg=new WeakMap,mu=new WeakMap,mp=new WeakMap,nh=new WeakMap,cd=new WeakSet,IJ=function(e){var s,i,o;if((s=m(this,uv))!=null&&s.call(this)||e.touches.length<2)return;if(!m(this,nh)){L(this,nh,new AbortController);const a=AbortSignal.any([m(this,vg),m(this,nh).signal]),l=m(this,lv),c={signal:a,passive:!1};l.addEventListener("touchmove",B(this,cd,RJ).bind(this),c),l.addEventListener("touchend",B(this,cd,xN).bind(this),c),l.addEventListener("touchcancel",B(this,cd,xN).bind(this),c),(i=m(this,dv))==null||i.call(this)}if(sa(e),e.touches.length!==2||(o=m(this,cv))!=null&&o.call(this)){L(this,mu,null);return}let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]),L(this,mu,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:r.screenX,touch1Y:r.screenY})},RJ=function(e){var T;if(!m(this,mu)||e.touches.length!==2)return;let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]);const{screenX:s,screenY:i}=t,{screenX:o,screenY:a}=r,l=m(this,mu),{touch0X:c,touch0Y:u,touch1X:h,touch1Y:f}=l,p=h-c,g=f-u,y=o-s,v=a-i,b=Math.hypot(y,v)||1,w=Math.hypot(p,g)||1;if(!m(this,pp)&&Math.abs(w-b)<=xM.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=i,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!m(this,pp)){L(this,pp,!0);return}const k=[(s+o)/2,(i+a)/2];(T=m(this,hv))==null||T.call(this,k,w,b)},xN=function(e){var t;m(this,nh).abort(),L(this,nh,null),(t=m(this,fv))==null||t.call(this),m(this,mu)&&(e.preventDefault(),L(this,mu,null),L(this,pp,!1))};let D5=xM;var gp,yl,Jn,wg,rh,pv,yp,$s,xp,gu,sh,mv,bp,Uo,gv,vp,yu,hc,kg,_g,Ma,wp,yv,q5,ut,bN,xv,vN,uk,MJ,PJ,wN,dk,kN,LJ,DJ,jJ,_N,OJ,SN,FJ,zJ,BJ,TN,nx;const zt=class zt{constructor(e){z(this,ut);z(this,gp,null);z(this,yl,null);z(this,Jn,null);z(this,wg,!1);z(this,rh,null);z(this,pv,"");z(this,yp,!1);z(this,$s,null);z(this,xp,null);z(this,gu,null);z(this,sh,null);z(this,mv,"");z(this,bp,!1);z(this,Uo,null);z(this,gv,!1);z(this,vp,!1);z(this,yu,!1);z(this,hc,null);z(this,kg,0);z(this,_g,0);z(this,Ma,null);z(this,wp,null);ct(this,"_editToolbar",null);ct(this,"_initialOptions",Object.create(null));ct(this,"_initialData",null);ct(this,"_isVisible",!0);ct(this,"_uiManager",null);ct(this,"_focusEventsAllowed",!0);z(this,yv,!1);z(this,q5,zt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:r,pageHeight:s,pageX:i,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,s],this.pageTranslation=[i,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=zt.prototype._resizeWithKeyboard,t=F0.TRANSLATE_SMALL,r=F0.TRANSLATE_BIG;return Ht(this,"_resizerKeyboardManager",new u2([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-r,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[r,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-r]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,r]}],[["Escape","mac+Escape"],zt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Ht(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new iNe({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(zt._l10n??(zt._l10n=e),zt._l10nResizer||(zt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),zt._borderLineWidth!==-1)return;const r=getComputedStyle(document.documentElement);zt._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){zn("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return m(this,yv)}set _isDraggable(e){var t;L(this,yv,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=m(this,q5)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):B(this,ut,nx).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(m(this,bp)?L(this,bp,!1):this.parent.setSelected(this))}focusout(e){var r;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(r=this.parent)!=null&&r.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,r,s){const[i,o]=this.parentDimensions;[r,s]=this.screenToPageTranslation(r,s),this.x=(e+r)/i,this.y=(t+s)/o,this.fixAndSetPosition()}translate(e,t){B(this,ut,bN).call(this,this.parentDimensions,e,t)}translateInPage(e,t){m(this,Uo)||L(this,Uo,[this.x,this.y,this.width,this.height]),B(this,ut,bN).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){m(this,Uo)||L(this,Uo,[this.x,this.y,this.width,this.height]);const{div:r,parentDimensions:[s,i]}=this;if(this.x+=e/s,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,c]=this.getBaseTranslation();o+=l,a+=c;const{style:u}=r;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),r.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!m(this,Uo)&&(m(this,Uo)[0]!==this.x||m(this,Uo)[1]!==this.y)}get _hasBeenResized(){return!!m(this,Uo)&&(m(this,Uo)[2]!==this.width||m(this,Uo)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:r}=zt,s=r/e,i=r/t;switch(this.rotation){case 90:return[-s,i];case 180:return[s,i];case 270:return[s,-i];default:return[-s,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[r,s]}=this;let{x:i,y:o,width:a,height:l}=this;if(a*=r,l*=s,i*=r,o*=s,this._mustFixPosition)switch(e){case 0:i=Math.max(0,Math.min(r-a,i)),o=Math.max(0,Math.min(s-l,o));break;case 90:i=Math.max(0,Math.min(r-l,i)),o=Math.min(s,Math.max(a,o));break;case 180:i=Math.min(r,Math.max(a,i)),o=Math.min(s,Math.max(l,o));break;case 270:i=Math.min(r,Math.max(l,i)),o=Math.max(0,Math.min(s-a,o));break}this.x=i/=r,this.y=o/=s;const[c,u]=this.getBaseTranslation();i+=c,o+=u,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var r;return B(r=zt,xv,vN).call(r,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var r;return B(r=zt,xv,vN).call(r,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,r]}=this;return[t*e,r*e]}setDims(e,t){const[r,s]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/r).toFixed(2)}%`,m(this,yp)||(i.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:r}=e,s=r.endsWith("%"),i=!m(this,yp)&&t.endsWith("%");if(s&&i)return;const[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(r)/o).toFixed(2)}%`),!m(this,yp)&&!i&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=m(this,Jn))==null||e.finish()}async addEditToolbar(){return this._editToolbar||m(this,vp)?this._editToolbar:(this._editToolbar=new lN(this),this.div.append(this._editToolbar.render()),m(this,Jn)&&await this._editToolbar.addAltText(m(this,Jn)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=m(this,Jn))==null||e.destroy())}addContainer(e){var r;const t=(r=this._editToolbar)==null?void 0:r.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){m(this,Jn)||(L5.initialize(zt._l10n),L(this,Jn,new L5(this)),m(this,gp)&&(m(this,Jn).data=m(this,gp),L(this,gp,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=m(this,Jn))==null?void 0:e.data}set altTextData(e){m(this,Jn)&&(m(this,Jn).data=e)}get guessedAltText(){var e;return(e=m(this,Jn))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=m(this,Jn))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=m(this,Jn))==null?void 0:t.serialize(e)}hasAltText(){return!!m(this,Jn)&&!m(this,Jn).isEmpty()}hasAltTextData(){var e;return((e=m(this,Jn))==null?void 0:e.hasData())??!1}render(){var i;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=m(this,wg)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),B(this,ut,SN).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[r,s]=this.getInitialTranslation();return this.translate(r,s),P5(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(m(this,wp)||L(this,wp,new D5({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:B(this,ut,LJ).bind(this),onPinching:B(this,ut,DJ).bind(this),onPinchEnd:B(this,ut,jJ).bind(this),signal:this._uiManager._signal}))),(i=this._uiManager._editorUndoBar)==null||i.hide(),this.div}pointerdown(e){const{isMac:t}=Qi.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(L(this,bp,!0),this._isDraggable){B(this,ut,OJ).call(this,e);return}B(this,ut,_N).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){m(this,hc)&&clearTimeout(m(this,hc)),L(this,hc,setTimeout(()=>{var e;L(this,hc,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,r){e.changeParent(this),this.x=t,this.y=r,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,r=this.rotation){const s=this.parentScale,[i,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/s,u=t/s,h=this.x*i,f=this.y*o,p=this.width*i,g=this.height*o;switch(r){case 0:return[h+c+a,o-f-u-g+l,h+c+p+a,o-f-u+l];case 90:return[h+u+a,o-f+c+l,h+u+g+a,o-f+c+p+l];case 180:return[h-c-p+a,o-f+u+l,h-c+a,o-f+u+g+l];case 270:return[h-u-g+a,o-f-c-p+l,h-u+a,o-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[r,s,i,o]=e,a=i-r,l=o-s;switch(this.rotation){case 0:return[r,t-o,a,l];case 90:return[r,t-s,l,a];case 180:return[i,t-s,a,l];case 270:return[i,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){L(this,vp,!0)}disableEditMode(){L(this,vp,!1)}isInEditMode(){return m(this,vp)}shouldGetKeyboardEvents(){return m(this,yu)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:r,right:s}=this.getClientDimensions(),{innerHeight:i,innerWidth:o}=window;return t<o&&s>0&&e<i&&r>0}rebuild(){B(this,ut,SN).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){zn("An editor must be serializable")}static async deserialize(e,t,r){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r});s.rotation=e.rotation,L(s,gp,e.accessibilityData);const[i,o]=s.pageDimensions,[a,l,c,u]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/i,s.y=l/o,s.width=c/i,s.height=u/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=m(this,sh))==null||e.abort(),L(this,sh,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),m(this,hc)&&(clearTimeout(m(this,hc)),L(this,hc,null)),B(this,ut,nx).call(this),this.removeEditToolbar(),m(this,Ma)){for(const r of m(this,Ma).values())clearTimeout(r);L(this,Ma,null)}this.parent=null,(t=m(this,wp))==null||t.destroy(),L(this,wp,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(B(this,ut,MJ).call(this),m(this,$s).classList.remove("hidden"),P5(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),L(this,gu,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=m(this,$s).children;if(!m(this,yl)){L(this,yl,Array.from(t));const o=B(this,ut,FJ).bind(this),a=B(this,ut,zJ).bind(this),l=this._uiManager._signal;for(const c of m(this,yl)){const u=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",B(this,ut,BJ).bind(this,u),{signal:l}),c.setAttribute("data-l10n-id",zt._l10nResizer[u])}}const r=m(this,yl)[0];let s=0;for(const o of t){if(o===r)break;s++}const i=(360-this.rotation+this.parentRotation)%360/90*(m(this,yl).length/4);if(i!==s){if(i<s)for(let a=0;a<s-i;a++)m(this,$s).append(m(this,$s).firstChild);else if(i>s)for(let a=0;a<i-s;a++)m(this,$s).firstChild.before(m(this,$s).lastChild);let o=0;for(const a of t){const c=m(this,yl)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",zt._l10nResizer[c])}}B(this,ut,TN).call(this,0),L(this,yu,!0),m(this,$s).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){m(this,yu)&&B(this,ut,kN).call(this,m(this,mv),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){B(this,ut,nx).call(this),this.div.focus()}select(){var e,t,r;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,i;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(r=m(this,Jn))==null||r.toggleAltTextBadge(!1)}unselect(){var e,t,r,s,i;(e=m(this,$s))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(r=this.div)!=null&&r.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(i=m(this,Jn))==null||i.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return m(this,gv)}set isEditing(e){L(this,gv,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){L(this,yp,!0);const r=e/t,{style:s}=this.div;s.aspectRatio=r,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){m(this,Ma)||L(this,Ma,new Map);const{action:r}=e;let s=m(this,Ma).get(r);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),m(this,Ma).delete(r),m(this,Ma).size===0&&L(this,Ma,null)},zt._telemetryTimeout),m(this,Ma).set(r,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),L(this,wg,!1)}disable(){this.div&&(this.div.tabIndex=-1),L(this,wg,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const r=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),r.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};gp=new WeakMap,yl=new WeakMap,Jn=new WeakMap,wg=new WeakMap,rh=new WeakMap,pv=new WeakMap,yp=new WeakMap,$s=new WeakMap,xp=new WeakMap,gu=new WeakMap,sh=new WeakMap,mv=new WeakMap,bp=new WeakMap,Uo=new WeakMap,gv=new WeakMap,vp=new WeakMap,yu=new WeakMap,hc=new WeakMap,kg=new WeakMap,_g=new WeakMap,Ma=new WeakMap,wp=new WeakMap,yv=new WeakMap,q5=new WeakMap,ut=new WeakSet,bN=function([e,t],r,s){[r,s]=this.screenToPageTranslation(r,s),this.x+=r/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},xv=new WeakSet,vN=function(e,t,r){switch(r){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},uk=function(e){switch(e){case 90:{const[t,r]=this.pageDimensions;return[0,-t/r,r/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,r]=this.pageDimensions;return[0,t/r,-r/t,0]}default:return[1,0,0,1]}},MJ=function(){if(m(this,$s))return;L(this,$s,document.createElement("div")),m(this,$s).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const r of e){const s=document.createElement("div");m(this,$s).append(s),s.classList.add("resizer",r),s.setAttribute("data-resizer-name",r),s.addEventListener("pointerdown",B(this,ut,PJ).bind(this,r),{signal:t}),s.addEventListener("contextmenu",Bl,{signal:t}),s.tabIndex=-1}this.div.prepend(m(this,$s))},PJ=function(e,t){var u;t.preventDefault();const{isMac:r}=Qi.platform;if(t.button!==0||t.ctrlKey&&r)return;(u=m(this,Jn))==null||u.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,L(this,xp,[t.screenX,t.screenY]);const i=new AbortController,o=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",B(this,ut,kN).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",sa,{passive:!1,signal:o}),window.addEventListener("contextmenu",Bl,{signal:o}),L(this,gu,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{var h;i.abort(),this.parent.togglePointerEvents(!0),(h=m(this,Jn))==null||h.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,B(this,ut,dk).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},wN=function(e,t,r,s){this.width=r,this.height=s,this.x=e,this.y=t;const[i,o]=this.parentDimensions;this.setDims(i*r,o*s),this.fixAndSetPosition(),this._onResized()},dk=function(){if(!m(this,gu))return;const{savedX:e,savedY:t,savedWidth:r,savedHeight:s}=m(this,gu);L(this,gu,null);const i=this.x,o=this.y,a=this.width,l=this.height;i===e&&o===t&&a===r&&l===s||this.addCommands({cmd:B(this,ut,wN).bind(this,i,o,a,l),undo:B(this,ut,wN).bind(this,e,t,r,s),mustExec:!0})},kN=function(e,t){const[r,s]=this.parentDimensions,i=this.x,o=this.y,a=this.width,l=this.height,c=zt.MIN_SIZE/r,u=zt.MIN_SIZE/s,h=B(this,ut,uk).call(this,this.rotation),f=(Q,re)=>[h[0]*Q+h[2]*re,h[1]*Q+h[3]*re],p=B(this,ut,uk).call(this,360-this.rotation),g=(Q,re)=>[p[0]*Q+p[2]*re,p[1]*Q+p[3]*re];let y,v,b=!1,w=!1;switch(e){case"topLeft":b=!0,y=(Q,re)=>[0,0],v=(Q,re)=>[Q,re];break;case"topMiddle":y=(Q,re)=>[Q/2,0],v=(Q,re)=>[Q/2,re];break;case"topRight":b=!0,y=(Q,re)=>[Q,0],v=(Q,re)=>[0,re];break;case"middleRight":w=!0,y=(Q,re)=>[Q,re/2],v=(Q,re)=>[0,re/2];break;case"bottomRight":b=!0,y=(Q,re)=>[Q,re],v=(Q,re)=>[0,0];break;case"bottomMiddle":y=(Q,re)=>[Q/2,re],v=(Q,re)=>[Q/2,0];break;case"bottomLeft":b=!0,y=(Q,re)=>[0,re],v=(Q,re)=>[Q,0];break;case"middleLeft":w=!0,y=(Q,re)=>[0,re/2],v=(Q,re)=>[Q,re/2];break}const k=y(a,l),T=v(a,l);let R=f(...T);const M=zt._round(i+R[0]),E=zt._round(o+R[1]);let I=1,S=1,N,P;if(t.fromKeyboard)({deltaX:N,deltaY:P}=t);else{const{screenX:Q,screenY:re}=t,[ne,te]=m(this,xp);[N,P]=this.screenToPageTranslation(Q-ne,re-te),m(this,xp)[0]=Q,m(this,xp)[1]=re}if([N,P]=g(N/r,P/s),b){const Q=Math.hypot(a,l);I=S=Math.max(Math.min(Math.hypot(T[0]-k[0]-N,T[1]-k[1]-P)/Q,1/a,1/l),c/a,u/l)}else w?I=Math.max(c,Math.min(1,Math.abs(T[0]-k[0]-N)))/a:S=Math.max(u,Math.min(1,Math.abs(T[1]-k[1]-P)))/l;const O=zt._round(a*I),D=zt._round(l*S);R=f(...v(O,D));const G=M-R[0],J=E-R[1];m(this,Uo)||L(this,Uo,[this.x,this.y,this.width,this.height]),this.width=O,this.height=D,this.x=G,this.y=J,this.setDims(r*O,s*D),this.fixAndSetPosition(),this._onResizing()},LJ=function(){var e;L(this,gu,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=m(this,Jn))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},DJ=function(e,t,r){let i=.7*(r/t)+1-.7;if(i===1)return;const o=B(this,ut,uk).call(this,this.rotation),a=(M,E)=>[o[0]*M+o[2]*E,o[1]*M+o[3]*E],[l,c]=this.parentDimensions,u=this.x,h=this.y,f=this.width,p=this.height,g=zt.MIN_SIZE/l,y=zt.MIN_SIZE/c;i=Math.max(Math.min(i,1/f,1/p),g/f,y/p);const v=zt._round(f*i),b=zt._round(p*i);if(v===f&&b===p)return;m(this,Uo)||L(this,Uo,[u,h,f,p]);const w=a(f/2,p/2),k=zt._round(u+w[0]),T=zt._round(h+w[1]),R=a(v/2,b/2);this.x=k-R[0],this.y=T-R[1],this.width=v,this.height=b,this.setDims(l*v,c*b),this.fixAndSetPosition(),this._onResizing()},jJ=function(){var e;(e=m(this,Jn))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),B(this,ut,dk).call(this)},_N=function(e){const{isMac:t}=Qi.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},OJ=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let r=!1;const s=new AbortController,i=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:i},a=c=>{s.abort(),L(this,rh,null),L(this,bp,!1),this._uiManager.endDragSession()||B(this,ut,_N).call(this,c),r&&this._onStopDragging()};t&&(L(this,kg,e.clientX),L(this,_g,e.clientY),L(this,rh,e.pointerId),L(this,pv,e.pointerType),window.addEventListener("pointermove",c=>{r||(r=!0,this._onStartDragging());const{clientX:u,clientY:h,pointerId:f}=c;if(f!==m(this,rh)){sa(c);return}const[p,g]=this.screenToPageTranslation(u-m(this,kg),h-m(this,_g));L(this,kg,u),L(this,_g,h),this._uiManager.dragSelectedEditors(p,g)},o),window.addEventListener("touchmove",sa,o),window.addEventListener("pointerdown",c=>{c.pointerType===m(this,pv)&&(m(this,wp)||c.isPrimary)&&a(c),sa(c)},o));const l=c=>{if(!m(this,rh)||m(this,rh)===c.pointerId){a(c);return}sa(c)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})},SN=function(){if(m(this,sh)||!this.div)return;L(this,sh,new AbortController);const e=this._uiManager.combinedSignal(m(this,sh));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},FJ=function(e){zt._resizerKeyboardManager.exec(this,e)},zJ=function(e){var t;m(this,yu)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==m(this,$s)&&B(this,ut,nx).call(this)},BJ=function(e){L(this,mv,m(this,yu)?e:"")},TN=function(e){if(m(this,yl))for(const t of m(this,yl))t.tabIndex=e},nx=function(){L(this,yu,!1),B(this,ut,TN).call(this,-1),B(this,ut,dk).call(this)},z(zt,xv),ct(zt,"_l10n",null),ct(zt,"_l10nResizer",null),ct(zt,"_borderLineWidth",-1),ct(zt,"_colorManager",new dN),ct(zt,"_zIndex",1),ct(zt,"_telemetryTimeout",1e3);let xr=zt;class iNe extends xr{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Nz=3285377520,Ca=4294901760,Kl=65535;class $J{constructor(e){this.h1=e?e&4294967295:Nz,this.h2=e?e&4294967295:Nz}update(e){let t,r;if(typeof e=="string"){t=new Uint8Array(e.length*2),r=0;for(let y=0,v=e.length;y<v;y++){const b=e.charCodeAt(y);b<=255?t[r++]=b:(t[r++]=b>>>8,t[r++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),r=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=r>>2,i=r-s*4,o=new Uint32Array(t.buffer,0,s);let a=0,l=0,c=this.h1,u=this.h2;const h=3432918353,f=461845907,p=h&Kl,g=f&Kl;for(let y=0;y<s;y++)y&1?(a=o[y],a=a*h&Ca|a*p&Kl,a=a<<15|a>>>17,a=a*f&Ca|a*g&Kl,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[y],l=l*h&Ca|l*p&Kl,l=l<<15|l>>>17,l=l*f&Ca|l*g&Kl,u^=l,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,i){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*h&Ca|a*p&Kl,a=a<<15|a>>>17,a=a*f&Ca|a*g&Kl,s&1?c^=a:u^=a}this.h1=c,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ca|e*36045&Kl,t=t*4283543511&Ca|((t<<16|e>>>16)*2950163797&Ca)>>>16,e^=t>>>1,e=e*444984403&Ca|e*60499&Kl,t=t*3301882366&Ca|((t<<16|e>>>16)*3120437893&Ca)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const AN=Object.freeze({map:null,hash:"",transfer:void 0});var kp,_p,Ts,G5,VJ;class fM{constructor(){z(this,G5);z(this,kp,!1);z(this,_p,null);z(this,Ts,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const r=m(this,Ts).get(e);return r===void 0?t:Object.assign(t,r)}getRawValue(e){return m(this,Ts).get(e)}remove(e){if(m(this,Ts).delete(e),m(this,Ts).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of m(this,Ts).values())if(t instanceof xr)return;this.onAnnotationEditor(null)}}setValue(e,t){const r=m(this,Ts).get(e);let s=!1;if(r!==void 0)for(const[i,o]of Object.entries(t))r[i]!==o&&(s=!0,r[i]=o);else s=!0,m(this,Ts).set(e,t);s&&B(this,G5,VJ).call(this),t instanceof xr&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return m(this,Ts).has(e)}getAll(){return m(this,Ts).size>0?aM(m(this,Ts)):null}setAll(e){for(const[t,r]of Object.entries(e))this.setValue(t,r)}get size(){return m(this,Ts).size}resetModified(){m(this,kp)&&(L(this,kp,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new UJ(this)}get serializable(){if(m(this,Ts).size===0)return AN;const e=new Map,t=new $J,r=[],s=Object.create(null);let i=!1;for(const[o,a]of m(this,Ts)){const l=a instanceof xr?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),i||(i=!!l.bitmap))}if(i)for(const o of e.values())o.bitmap&&r.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:r}:AN}get editorStats(){let e=null;const t=new Map;for(const r of m(this,Ts).values()){if(!(r instanceof xr))continue;const s=r.telemetryFinalData;if(!s)continue;const{type:i}=s;t.has(i)||t.set(i,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const o=e[i]||(e[i]=new Map);for(const[a,l]of Object.entries(s)){if(a==="type")continue;let c=o.get(a);c||(c=new Map,o.set(a,c));const u=c.get(l)??0;c.set(l,u+1)}}for(const[r,s]of t)e[r]=s.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){L(this,_p,null)}get modifiedIds(){if(m(this,_p))return m(this,_p);const e=[];for(const t of m(this,Ts).values())!(t instanceof xr)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return L(this,_p,{ids:new Set(e),hash:e.join(",")})}}kp=new WeakMap,_p=new WeakMap,Ts=new WeakMap,G5=new WeakSet,VJ=function(){m(this,kp)||(L(this,kp,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var bv;class UJ extends fM{constructor(t){super();z(this,bv);const{map:r,hash:s,transfer:i}=t.serializable,o=structuredClone(r,i?{transfer:i}:null);L(this,bv,{map:o,hash:s,transfer:i})}get print(){zn("Should not call PrintAnnotationStorage.print")}get serializable(){return m(this,bv)}get modifiedIds(){return Ht(this,"modifiedIds",{ids:new Set,hash:""})}}bv=new WeakMap;var Sg;class oNe{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){z(this,Sg,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),m(this,Sg).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||m(this,Sg).has(e.loadedName))){if(Xr(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:s,style:i}=e,o=new FontFace(r,s,i);this.addNativeFontFace(o);try{await o.load(),m(this,Sg).add(r),t==null||t(e)}catch{Lt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}zn("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const r=e.createNativeFontFace();if(r){this.addNativeFontFace(r);try{await r.loaded}catch(s){throw Lt(`Failed to load font '${r.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(r=>{const s=this._queueLoadingCallback(r);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Ht(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(ki||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Ht(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Xr(!s.done,"completeRequest() cannot be called twice."),s.done=!0;r.length>0&&r[0].done;){const i=r.shift();setTimeout(i.callback,0)}}const{loadingRequests:r}=this,s={done:!1,complete:t,callback:e};return r.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Ht(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function r(T,R){return T.charCodeAt(R)<<24|T.charCodeAt(R+1)<<16|T.charCodeAt(R+2)<<8|T.charCodeAt(R+3)&255}function s(T,R,M,E){const I=T.substring(0,R),S=T.substring(R+M);return I+E+S}let i,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function u(T,R){if(++c>30){Lt("Load test font never loaded."),R();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){R();return}setTimeout(u.bind(null,T,R))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=s(f,976,h.length,h);const g=16,y=1482184792;let v=r(f,g);for(i=0,o=h.length-3;i<o;i+=4)v=v-y+r(h,i)|0;i<h.length&&(v=v-y+r(h+"XXX",i)|0),f=s(f,g,4,qCe(v));const b=`url(data:font/opentype;base64,${btoa(f)});`,w=`@font-face {font-family:"${h}";src:${b}}`;this.insertRule(w);const k=this._document.createElement("div");k.style.visibility="hidden",k.style.width=k.style.height="10px",k.style.position="absolute",k.style.top=k.style.left="0px";for(const T of[e.loadedName,h]){const R=this._document.createElement("span");R.textContent="Hi",R.style.fontFamily=T,k.append(R)}this._document.body.append(k),u(h,()=>{k.remove(),t.complete()})}}Sg=new WeakMap;class aNe{constructor(e,{disableFontFace:t=!1,fontExtraProperties:r=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this.disableFontFace=t===!0,this.fontExtraProperties=r===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const r={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(r.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,r)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var r;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${JCe(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(r=this._inspectFont)==null||r.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const r=this.loadedName+"_path_"+t;let s;try{s=e.get(r)}catch(o){Lt(`getPathGenerator - ignoring character: "${o}".`)}const i=new Path2D(s||"");return this.fontExtraProperties||e.delete(r),this.compiledGlyphs[t]=i}}const b4={DATA:1,ERROR:2},qr={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Iz(){}function po(n){if(n instanceof ff||n instanceof iN||n instanceof Hb||n instanceof Az||n instanceof M5||n instanceof aE)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||zn('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new ff(n.message);case"InvalidPDFException":return new iN(n.message);case"MissingPDFException":return new Hb(n.message);case"PasswordException":return new Az(n.message,n.code);case"UnexpectedResponseException":return new M5(n.message,n.status);case"UnknownErrorException":return new aE(n.message,n.details)}return new aE(n.message,n.toString())}var Tg,Ja,HJ,qJ,GJ,hk;class rx{constructor(e,t,r){z(this,Ja);z(this,Tg,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),r.addEventListener("message",B(this,Ja,HJ).bind(this),{signal:m(this,Tg).signal})}on(e,t){const r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){const s=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[s]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},r)}catch(o){i.reject(o)}return i.promise}sendWithStream(e,t,r,s){const i=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const u=Promise.withResolvers();return this.streamControllers[i]={controller:c,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:i,data:t,desiredSize:c.desiredSize},s),u.promise},pull:c=>{const u=Promise.withResolvers();return this.streamControllers[i].pullCall=u,l.postMessage({sourceName:o,targetName:a,stream:qr.PULL,streamId:i,desiredSize:c.desiredSize}),u.promise},cancel:c=>{Xr(c instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[i].cancelCall=u,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:qr.CANCEL,streamId:i,reason:po(c)}),u.promise}},r)}destroy(){var e;(e=m(this,Tg))==null||e.abort(),L(this,Tg,null)}}Tg=new WeakMap,Ja=new WeakSet,HJ=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){B(this,Ja,GJ).call(this,e);return}if(e.callback){const r=e.callbackId,s=this.callbackCapabilities[r];if(!s)throw new Error(`Cannot resolve callback ${r}`);if(delete this.callbackCapabilities[r],e.callback===b4.DATA)s.resolve(e.data);else if(e.callback===b4.ERROR)s.reject(po(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const r=this.sourceName,s=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(o){i.postMessage({sourceName:r,targetName:s,callback:b4.DATA,callbackId:e.callbackId,data:o})},function(o){i.postMessage({sourceName:r,targetName:s,callback:b4.ERROR,callbackId:e.callbackId,reason:po(o)})});return}if(e.streamId){B(this,Ja,qJ).call(this,e);return}t(e.data)},qJ=function(e){const t=e.streamId,r=this.sourceName,s=e.sourceName,i=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,u=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:r,targetName:s,stream:qr.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:r,targetName:s,stream:qr.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){Xr(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:r,targetName:s,stream:qr.ERROR,streamId:t,reason:po(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){i.postMessage({sourceName:r,targetName:s,stream:qr.START_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:r,targetName:s,stream:qr.START_COMPLETE,streamId:t,reason:po(c)})})},GJ=function(e){const t=e.streamId,r=this.sourceName,s=e.sourceName,i=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case qr.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(po(e.reason));break;case qr.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(po(e.reason));break;case qr.PULL:if(!a){i.postMessage({sourceName:r,targetName:s,stream:qr.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||Iz).then(function(){i.postMessage({sourceName:r,targetName:s,stream:qr.PULL_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:r,targetName:s,stream:qr.PULL_COMPLETE,streamId:t,reason:po(c)})});break;case qr.ENQUEUE:if(Xr(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case qr.CLOSE:if(Xr(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),B(this,Ja,hk).call(this,o,t);break;case qr.ERROR:Xr(o,"error should have stream controller"),o.controller.error(po(e.reason)),B(this,Ja,hk).call(this,o,t);break;case qr.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(po(e.reason)),B(this,Ja,hk).call(this,o,t);break;case qr.CANCEL:if(!a)break;const l=po(e.reason);Promise.try(a.onCancel||Iz,l).then(function(){i.postMessage({sourceName:r,targetName:s,stream:qr.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:r,targetName:s,stream:qr.CANCEL_COMPLETE,streamId:t,reason:po(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},hk=async function(e,t){var r,s,i;await Promise.allSettled([(r=e.startCall)==null?void 0:r.promise,(s=e.pullCall)==null?void 0:s.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var vv;class WJ{constructor({enableHWA:e=!1}){z(this,vv,!1);L(this,vv,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!m(this,vv)})}}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){zn("Abstract method `_createCanvas` called.")}}vv=new WeakMap;class lNe extends WJ{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const r=this._document.createElement("canvas");return r.width=e,r.height=t,r}}class KJ{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(r=>({cMapData:r,isCompressed:this.isCompressed})).catch(r=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){zn("Abstract method `_fetch` called.")}}class YJ extends KJ{async _fetch(e){const t=await jS(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):DS(t)}}class XJ{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,r,s,i){return"none"}destroy(e=!1){}}var Sp,Ag,xu,bu,fi,Tp,Ap,$e,ui,sx,km,fk,_m,JJ,EN,Sm,ix,ox,CN,ax;class cNe extends XJ{constructor({docId:t,ownerDocument:r=globalThis.document}){super();z(this,$e);z(this,Sp);z(this,Ag);z(this,xu);z(this,bu);z(this,fi);z(this,Tp);z(this,Ap,0);L(this,bu,t),L(this,fi,r)}addFilter(t){if(!t)return"none";let r=m(this,$e,ui).get(t);if(r)return r;const[s,i,o]=B(this,$e,fk).call(this,t),a=t.length===1?s:`${s}${i}${o}`;if(r=m(this,$e,ui).get(a),r)return m(this,$e,ui).set(t,r),r;const l=`g_${m(this,bu)}_transfer_map_${Pi(this,Ap)._++}`,c=B(this,$e,_m).call(this,l);m(this,$e,ui).set(t,c),m(this,$e,ui).set(a,c);const u=B(this,$e,Sm).call(this,l);return B(this,$e,ox).call(this,s,i,o,u),c}addHCMFilter(t,r){var g;const s=`${t}-${r}`,i="base";let o=m(this,$e,sx).get(i);if((o==null?void 0:o.key)===s||(o?((g=o.filter)==null||g.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},m(this,$e,sx).set(i,o)),!t||!r))return o.url;const a=B(this,$e,ax).call(this,t);t=Je.makeHexColor(...a);const l=B(this,$e,ax).call(this,r);if(r=Je.makeHexColor(...l),m(this,$e,km).style.color="",t==="#000000"&&r==="#ffffff"||t===r)return o.url;const c=new Array(256);for(let y=0;y<=255;y++){const v=y/255;c[y]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const u=c.join(","),h=`g_${m(this,bu)}_hcm_filter`,f=o.filter=B(this,$e,Sm).call(this,h);B(this,$e,ox).call(this,u,u,u,f),B(this,$e,EN).call(this,f);const p=(y,v)=>{const b=a[y]/255,w=l[y]/255,k=new Array(v+1);for(let T=0;T<=v;T++)k[T]=b+T/v*(w-b);return k.join(",")};return B(this,$e,ox).call(this,p(0,5),p(1,5),p(2,5),f),o.url=B(this,$e,_m).call(this,h),o.url}addAlphaFilter(t){let r=m(this,$e,ui).get(t);if(r)return r;const[s]=B(this,$e,fk).call(this,[t]),i=`alpha_${s}`;if(r=m(this,$e,ui).get(i),r)return m(this,$e,ui).set(t,r),r;const o=`g_${m(this,bu)}_alpha_map_${Pi(this,Ap)._++}`,a=B(this,$e,_m).call(this,o);m(this,$e,ui).set(t,a),m(this,$e,ui).set(i,a);const l=B(this,$e,Sm).call(this,o);return B(this,$e,CN).call(this,s,l),a}addLuminosityFilter(t){let r=m(this,$e,ui).get(t||"luminosity");if(r)return r;let s,i;if(t?([s]=B(this,$e,fk).call(this,[t]),i=`luminosity_${s}`):i="luminosity",r=m(this,$e,ui).get(i),r)return m(this,$e,ui).set(t,r),r;const o=`g_${m(this,bu)}_luminosity_map_${Pi(this,Ap)._++}`,a=B(this,$e,_m).call(this,o);m(this,$e,ui).set(t,a),m(this,$e,ui).set(i,a);const l=B(this,$e,Sm).call(this,o);return B(this,$e,JJ).call(this,l),t&&B(this,$e,CN).call(this,s,l),a}addHighlightHCMFilter(t,r,s,i,o){var w;const a=`${r}-${s}-${i}-${o}`;let l=m(this,$e,sx).get(t);if((l==null?void 0:l.key)===a||(l?((w=l.filter)==null||w.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},m(this,$e,sx).set(t,l)),!r||!s))return l.url;const[c,u]=[r,s].map(B(this,$e,ax).bind(this));let h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[p,g]=[i,o].map(B(this,$e,ax).bind(this));f<h&&([h,f,p,g]=[f,h,g,p]),m(this,$e,km).style.color="";const y=(k,T,R)=>{const M=new Array(256),E=(f-h)/R,I=k/255,S=(T-k)/(255*R);let N=0;for(let P=0;P<=R;P++){const O=Math.round(h+P*E),D=I+P*S;for(let G=N;G<=O;G++)M[G]=D;N=O+1}for(let P=N;P<256;P++)M[P]=M[N-1];return M.join(",")},v=`g_${m(this,bu)}_hcm_${t}_filter`,b=l.filter=B(this,$e,Sm).call(this,v);return B(this,$e,EN).call(this,b),B(this,$e,ox).call(this,y(p[0],g[0],5),y(p[1],g[1],5),y(p[2],g[2],5),b),l.url=B(this,$e,_m).call(this,v),l.url}destroy(t=!1){var r,s,i,o;t&&((r=m(this,Tp))!=null&&r.size)||((s=m(this,xu))==null||s.parentNode.parentNode.remove(),L(this,xu,null),(i=m(this,Ag))==null||i.clear(),L(this,Ag,null),(o=m(this,Tp))==null||o.clear(),L(this,Tp,null),L(this,Ap,0))}}Sp=new WeakMap,Ag=new WeakMap,xu=new WeakMap,bu=new WeakMap,fi=new WeakMap,Tp=new WeakMap,Ap=new WeakMap,$e=new WeakSet,ui=function(){return m(this,Ag)||L(this,Ag,new Map)},sx=function(){return m(this,Tp)||L(this,Tp,new Map)},km=function(){if(!m(this,xu)){const t=m(this,fi).createElement("div"),{style:r}=t;r.visibility="hidden",r.contain="strict",r.width=r.height=0,r.position="absolute",r.top=r.left=0,r.zIndex=-1;const s=m(this,fi).createElementNS(nu,"svg");s.setAttribute("width",0),s.setAttribute("height",0),L(this,xu,m(this,fi).createElementNS(nu,"defs")),t.append(s),s.append(m(this,xu)),m(this,fi).body.append(t)}return m(this,xu)},fk=function(t){if(t.length===1){const c=t[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=c[f]/255;const h=u.join(",");return[h,h,h]}const[r,s,i]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=r[c]/255,a[c]=s[c]/255,l[c]=i[c]/255;return[o.join(","),a.join(","),l.join(",")]},_m=function(t){if(m(this,Sp)===void 0){L(this,Sp,"");const r=m(this,fi).URL;r!==m(this,fi).baseURI&&(OS(r)?Lt('#createUrl: ignore "data:"-URL for performance reasons.'):L(this,Sp,r.split("#",1)[0]))}return`url(${m(this,Sp)}#${t})`},JJ=function(t){const r=m(this,fi).createElementNS(nu,"feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(r)},EN=function(t){const r=m(this,fi).createElementNS(nu,"feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(r)},Sm=function(t){const r=m(this,fi).createElementNS(nu,"filter");return r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("id",t),m(this,$e,km).append(r),r},ix=function(t,r,s){const i=m(this,fi).createElementNS(nu,r);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)},ox=function(t,r,s,i){const o=m(this,fi).createElementNS(nu,"feComponentTransfer");i.append(o),B(this,$e,ix).call(this,o,"feFuncR",t),B(this,$e,ix).call(this,o,"feFuncG",r),B(this,$e,ix).call(this,o,"feFuncB",s)},CN=function(t,r){const s=m(this,fi).createElementNS(nu,"feComponentTransfer");r.append(s),B(this,$e,ix).call(this,s,"feFuncA",t)},ax=function(t){return m(this,$e,km).style.color=t,hM(getComputedStyle(m(this,$e,km)).getPropertyValue("color"))};class QJ{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(r=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){zn("Abstract method `_fetch` called.")}}class ZJ extends QJ{async _fetch(e){const t=await jS(e,"arraybuffer");return new Uint8Array(t)}}ki&&Lt("Please use the `legacy` build in Node.js environments.");async function eQ(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class uNe extends XJ{}class dNe extends WJ{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class hNe extends KJ{async _fetch(e){return eQ(e)}}class fNe extends QJ{async _fetch(e){return eQ(e)}}const xi={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function NN(n,e){if(!e)return;const t=e[2]-e[0],r=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,r),n.clip(s)}class pM{getPattern(){zn("Abstract method `getPattern` called.")}}class pNe extends pM{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const r of this._colorStops)t.addColorStop(r[0],r[1]);return t}getPattern(e,t,r,s){let i;if(s===xi.STROKE||s===xi.FILL){const o=t.current.getClippedPathBoundingBox(s,rr(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),u=c.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),r=Je.transform(r,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),NN(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),i=e.createPattern(c.canvas,"no-repeat");const h=new DOMMatrix(r);i.setTransform(h)}else NN(e,this._bbox),i=this._createGradient(e);return i}}function uE(n,e,t,r,s,i,o,a){const l=e.coords,c=e.colors,u=n.data,h=n.width*4;let f;l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=i,i=o,o=f),l[r+1]>l[s+1]&&(f=r,r=s,s=f,f=o,o=a,a=f),l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=i,i=o,o=f);const p=(l[t]+e.offsetX)*e.scaleX,g=(l[t+1]+e.offsetY)*e.scaleY,y=(l[r]+e.offsetX)*e.scaleX,v=(l[r+1]+e.offsetY)*e.scaleY,b=(l[s]+e.offsetX)*e.scaleX,w=(l[s+1]+e.offsetY)*e.scaleY;if(g>=w)return;const k=c[i],T=c[i+1],R=c[i+2],M=c[o],E=c[o+1],I=c[o+2],S=c[a],N=c[a+1],P=c[a+2],O=Math.round(g),D=Math.round(w);let G,J,Q,re,ne,te,H,ce;for(let xe=O;xe<=D;xe++){if(xe<v){const Ae=xe<g?0:(g-xe)/(g-v);G=p-(p-y)*Ae,J=k-(k-M)*Ae,Q=T-(T-E)*Ae,re=R-(R-I)*Ae}else{let Ae;xe>w?Ae=1:v===w?Ae=0:Ae=(v-xe)/(v-w),G=y-(y-b)*Ae,J=M-(M-S)*Ae,Q=E-(E-N)*Ae,re=I-(I-P)*Ae}let W;xe<g?W=0:xe>w?W=1:W=(g-xe)/(g-w),ne=p-(p-b)*W,te=k-(k-S)*W,H=T-(T-N)*W,ce=R-(R-P)*W;const dt=Math.round(Math.min(G,ne)),Me=Math.round(Math.max(G,ne));let Fe=h*xe+dt*4;for(let Ae=dt;Ae<=Me;Ae++)W=(G-Ae)/(G-ne),W<0?W=0:W>1&&(W=1),u[Fe++]=J-(J-te)*W|0,u[Fe++]=Q-(Q-H)*W|0,u[Fe++]=re-(re-ce)*W|0,u[Fe++]=255}}function mNe(n,e,t){const r=e.coords,s=e.colors;let i,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(r.length/a)-1,c=a-1;for(i=0;i<l;i++){let u=i*a;for(let h=0;h<c;h++,u++)uE(n,t,r[u],r[u+1],r[u+a],s[u],s[u+1],s[u+a]),uE(n,t,r[u+a+1],r[u+1],r[u+a],s[u+a+1],s[u+1],s[u+a])}break;case"triangles":for(i=0,o=r.length;i<o;i+=3)uE(n,t,r[i],r[i+1],r[i+2],s[i],s[i+1],s[i+2]);break;default:throw new Error("illegal figure")}}class gNe extends pM{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,r){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),p=c/h,g=u/f,y={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/g},v=h+2*2,b=f+2*2,w=r.getCanvas("mesh",v,b),k=w.context,T=k.createImageData(h,f);if(t){const M=T.data;for(let E=0,I=M.length;E<I;E+=4)M[E]=t[0],M[E+1]=t[1],M[E+2]=t[2],M[E+3]=255}for(const M of this._figures)mNe(T,M,y);return k.putImageData(T,2,2),{canvas:w.canvas,offsetX:a-2*p,offsetY:l-2*g,scaleX:p,scaleY:g}}getPattern(e,t,r,s){NN(e,this._bbox);let i;if(s===xi.SHADING)i=Je.singularValueDecompose2dScale(rr(e));else if(i=Je.singularValueDecompose2dScale(t.baseTransform),this.matrix){const a=Je.singularValueDecompose2dScale(this.matrix);i=[i[0]*a[0],i[1]*a[1]]}const o=this._createMeshCanvas(i,s===xi.SHADING?null:this._background,t.cachedCanvases);return s!==xi.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class yNe extends pM{getPattern(){return"hotpink"}}function xNe(n){switch(n[0]){case"RadialAxial":return new pNe(n);case"Mesh":return new gNe(n);case"Dummy":return new yNe}throw new Error(`Unknown IR type: ${n[0]}`)}const Rz={COLORED:1,UNCOLORED:2},W5=class W5{constructor(e,t,r,s,i){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=r,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:r,paintType:s,tilingType:i,color:o,canvasGraphicsFactory:a}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),LS("TilingType: "+i);const u=t[0],h=t[1],f=t[2],p=t[3],g=f-u,y=p-h,v=Je.singularValueDecompose2dScale(this.matrix),b=Je.singularValueDecompose2dScale(this.baseTransform),w=v[0]*b[0],k=v[1]*b[1];let T=g,R=y,M=!1,E=!1;const I=Math.ceil(l*w),S=Math.ceil(c*k),N=Math.ceil(g*w),P=Math.ceil(y*k);I>=N?T=l:M=!0,S>=P?R=c:E=!0;const O=this.getSizeAndScale(T,this.ctx.canvas.width,w),D=this.getSizeAndScale(R,this.ctx.canvas.height,k),G=e.cachedCanvases.getCanvas("pattern",O.size,D.size),J=G.context,Q=a.createCanvasGraphics(J);if(Q.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(Q,s,o),J.translate(-O.scale*u,-D.scale*h),Q.transform(O.scale,0,0,D.scale,0,0),J.save(),this.clipBbox(Q,u,h,f,p),Q.baseTransform=rr(Q.ctx),Q.executeOperatorList(r),Q.endDrawing(),J.restore(),M||E){const re=G.canvas;M&&(T=l),E&&(R=c);const ne=this.getSizeAndScale(T,this.ctx.canvas.width,w),te=this.getSizeAndScale(R,this.ctx.canvas.height,k),H=ne.size,ce=te.size,xe=e.cachedCanvases.getCanvas("pattern-workaround",H,ce),W=xe.context,dt=M?Math.floor(g/l):0,Me=E?Math.floor(y/c):0;for(let Fe=0;Fe<=dt;Fe++)for(let Ae=0;Ae<=Me;Ae++)W.drawImage(re,H*Fe,ce*Ae,H,ce,0,0,H,ce);return{canvas:xe.canvas,scaleX:ne.scale,scaleY:te.scale,offsetX:u,offsetY:h}}return{canvas:G.canvas,scaleX:O.scale,scaleY:D.scale,offsetX:u,offsetY:h}}getSizeAndScale(e,t,r){const s=Math.max(W5.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*r);return i>=s?i=s:r=i/e,{scale:r,size:i}}clipBbox(e,t,r,s,i){const o=s-t,a=i-r;e.ctx.rect(t,r,o,a),e.current.updateRectMinMax(rr(e.ctx),[t,r,s,i]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,r){const s=e.ctx,i=e.current;switch(t){case Rz.COLORED:const o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,i.fillColor=o.fillStyle,i.strokeColor=o.strokeStyle;break;case Rz.UNCOLORED:const a=Je.makeHexColor(r[0],r[1],r[2]);s.fillStyle=a,s.strokeStyle=a,i.fillColor=a,i.strokeColor=a;break;default:throw new HCe(`Unsupported paint type: ${t}`)}}getPattern(e,t,r,s){let i=r;s!==xi.SHADING&&(i=Je.transform(i,t.baseTransform),this.matrix&&(i=Je.transform(i,this.matrix)));const o=this.createPatternCanvas(t);let a=new DOMMatrix(i);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};ct(W5,"MAX_PATTERN_SIZE",3e3);let IN=W5;function bNe({src:n,srcPos:e=0,dest:t,width:r,height:s,nonBlackColor:i=4294967295,inverseDecode:o=!1}){const a=Qi.isLittleEndian?4278190080:255,[l,c]=o?[i,a]:[a,i],u=r>>3,h=r&7,f=n.length;t=new Uint32Array(t.buffer);let p=0;for(let g=0;g<s;g++){for(const v=e+u;e<v;e++){const b=e<f?n[e]:255;t[p++]=b&128?c:l,t[p++]=b&64?c:l,t[p++]=b&32?c:l,t[p++]=b&16?c:l,t[p++]=b&8?c:l,t[p++]=b&4?c:l,t[p++]=b&2?c:l,t[p++]=b&1?c:l}if(h===0)continue;const y=e<f?n[e++]:255;for(let v=0;v<h;v++)t[p++]=y&1<<7-v?c:l}return{srcPos:e,destPos:p}}const Mz=16,Pz=100,vNe=15,Lz=10,Dz=1e3,vo=16;function wNe(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(r,s){e.translate(r,s),this.__originalTranslate(r,s)},n.scale=function(r,s){e.scale(r,s),this.__originalScale(r,s)},n.transform=function(r,s,i,o,a,l){e.transform(r,s,i,o,a,l),this.__originalTransform(r,s,i,o,a,l)},n.setTransform=function(r,s,i,o,a,l){e.setTransform(r,s,i,o,a,l),this.__originalSetTransform(r,s,i,o,a,l)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(r){e.rotate(r),this.__originalRotate(r)},n.clip=function(r){e.clip(r),this.__originalClip(r)},n.moveTo=function(t,r){e.moveTo(t,r),this.__originalMoveTo(t,r)},n.lineTo=function(t,r){e.lineTo(t,r),this.__originalLineTo(t,r)},n.bezierCurveTo=function(t,r,s,i,o,a){e.bezierCurveTo(t,r,s,i,o,a),this.__originalBezierCurveTo(t,r,s,i,o,a)},n.rect=function(t,r,s,i){e.rect(t,r,s,i),this.__originalRect(t,r,s,i)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class kNe{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,r){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,r)):(s=this.canvasFactory.create(t,r),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function v4(n,e,t,r,s,i,o,a,l,c){const[u,h,f,p,g,y]=rr(n);if(h===0&&f===0){const w=o*u+g,k=Math.round(w),T=a*p+y,R=Math.round(T),M=(o+l)*u+g,E=Math.abs(Math.round(M)-k)||1,I=(a+c)*p+y,S=Math.abs(Math.round(I)-R)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(p),k,R),n.drawImage(e,t,r,s,i,0,0,E,S),n.setTransform(u,h,f,p,g,y),[E,S]}if(u===0&&p===0){const w=a*f+g,k=Math.round(w),T=o*h+y,R=Math.round(T),M=(a+c)*f+g,E=Math.abs(Math.round(M)-k)||1,I=(o+l)*h+y,S=Math.abs(Math.round(I)-R)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,k,R),n.drawImage(e,t,r,s,i,0,0,S,E),n.setTransform(u,h,f,p,g,y),[S,E]}n.drawImage(e,t,r,s,i,o,a,l,c);const v=Math.hypot(u,h),b=Math.hypot(f,p);return[v*l,b*c]}function _Ne(n){const{width:e,height:t}=n;if(e>Dz||t>Dz)return null;const r=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),i=e+1;let o=new Uint8Array(i*(t+1)),a,l,c;const u=e+7&-8;let h=new Uint8Array(u*t),f=0;for(const b of n.data){let w=128;for(;w>0;)h[f++]=b&w?0:255,w>>=1}let p=0;for(f=0,h[f]!==0&&(o[0]=1,++p),l=1;l<e;l++)h[f]!==h[f+1]&&(o[l]=h[f]?2:1,++p),f++;for(h[f]!==0&&(o[l]=2,++p),a=1;a<t;a++){f=a*u,c=a*i,h[f-u]!==h[f]&&(o[c]=h[f]?1:8,++p);let b=(h[f]?4:0)+(h[f-u]?8:0);for(l=1;l<e;l++)b=(b>>2)+(h[f+1]?4:0)+(h[f-u+1]?8:0),s[b]&&(o[c+l]=s[b],++p),f++;if(h[f-u]!==h[f]&&(o[c+l]=h[f]?2:4,++p),p>r)return null}for(f=u*(t-1),c=a*i,h[f]!==0&&(o[c]=8,++p),l=1;l<e;l++)h[f]!==h[f+1]&&(o[c+l]=h[f]?4:8,++p),f++;if(h[f]!==0&&(o[c+l]=4,++p),p>r)return null;const g=new Int32Array([0,i,-1,0,-i,0,0,0,1]),y=new Path2D;for(a=0;p&&a<=t;a++){let b=a*i;const w=b+e;for(;b<w&&!o[b];)b++;if(b===w)continue;y.moveTo(b%i,a);const k=b;let T=o[b];do{const R=g[T];do b+=R;while(!o[b]);const M=o[b];M!==5&&M!==10?(T=M,o[b]=0):(T=M&51*T>>4,o[b]&=T>>2|T<<2),y.lineTo(b%i,b/i|0),o[b]||--p}while(k!==b);--a}return h=null,o=null,function(b){b.save(),b.scale(1/e,-1/t),b.translate(0,-t),b.fill(y),b.beginPath(),b.restore()}}class jz{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=uJ,this.textMatrixScale=1,this.fontMatrix=sN,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ci.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,r){[t,r]=Je.applyTransform([t,r],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,r),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,r)}updateRectMinMax(e,t){const r=Je.applyTransform(t,e),s=Je.applyTransform(t.slice(2),e),i=Je.applyTransform([t[0],t[3]],e),o=Je.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,r[0],s[0],i[0],o[0]),this.minY=Math.min(this.minY,r[1],s[1],i[1],o[1]),this.maxX=Math.max(this.maxX,r[0],s[0],i[0],o[0]),this.maxY=Math.max(this.maxY,r[1],s[1],i[1],o[1])}updateScalingPathMinMax(e,t){Je.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,r,s,i,o,a,l,c,u){const h=Je.bezierBoundingBox(t,r,s,i,o,a,l,c,u);u||this.updateRectMinMax(e,h)}getPathBoundingBox(e=xi.FILL,t=null){const r=[this.minX,this.minY,this.maxX,this.maxY];if(e===xi.STROKE){t||zn("Stroke bounding box must include transform.");const s=Je.singularValueDecompose2dScale(t),i=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;r[0]-=i,r[1]-=o,r[2]+=i,r[3]+=o}return r}updateClipFromPath(){const e=Je.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=xi.FILL,t=null){return Je.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Oz(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,r=e.width,s=t%vo,i=(t-s)/vo,o=s===0?i:i+1,a=n.createImageData(r,vo);let l=0,c;const u=e.data,h=a.data;let f,p,g,y;if(e.kind===rk.GRAYSCALE_1BPP){const v=u.byteLength,b=new Uint32Array(h.buffer,0,h.byteLength>>2),w=b.length,k=r+7>>3,T=4294967295,R=Qi.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(g=f<i?vo:s,c=0,p=0;p<g;p++){const M=v-l;let E=0;const I=M>k?r:M*8-7,S=I&-8;let N=0,P=0;for(;E<S;E+=8)P=u[l++],b[c++]=P&128?T:R,b[c++]=P&64?T:R,b[c++]=P&32?T:R,b[c++]=P&16?T:R,b[c++]=P&8?T:R,b[c++]=P&4?T:R,b[c++]=P&2?T:R,b[c++]=P&1?T:R;for(;E<I;E++)N===0&&(P=u[l++],N=128),b[c++]=P&N?T:R,N>>=1}for(;c<w;)b[c++]=0;n.putImageData(a,0,f*vo)}}else if(e.kind===rk.RGBA_32BPP){for(p=0,y=r*vo*4,f=0;f<i;f++)h.set(u.subarray(l,l+y)),l+=y,n.putImageData(a,0,p),p+=vo;f<o&&(y=r*s*4,h.set(u.subarray(l,l+y)),n.putImageData(a,0,p))}else if(e.kind===rk.RGB_24BPP)for(g=vo,y=r*g,f=0;f<o;f++){for(f>=i&&(g=s,y=r*g),c=0,p=y;p--;)h[c++]=u[l++],h[c++]=u[l++],h[c++]=u[l++],h[c++]=255;n.putImageData(a,0,f*vo)}else throw new Error(`bad image kind: ${e.kind}`)}function Fz(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,r=e.width,s=t%vo,i=(t-s)/vo,o=s===0?i:i+1,a=n.createImageData(r,vo);let l=0;const c=e.data,u=a.data;for(let h=0;h<o;h++){const f=h<i?vo:s;({srcPos:l}=bNe({src:c,srcPos:l,dest:u,width:r,height:f,nonBlackColor:0})),n.putImageData(a,0,h*vo)}}function My(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const r of t)n[r]!==void 0&&(e[r]=n[r]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function w4(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!ki){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function zz(n,e){if(e)return!0;const t=Je.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const r=Math.fround((globalThis.devicePixelRatio||1)*pf.PDF_TO_CSS_UNITS);return t[0]<=r&&t[1]<=r}const SNe=["butt","round","square"],TNe=["miter","round","bevel"],ANe={},Bz={};var $l,RN,MN,PN;const bM=class bM{constructor(e,t,r,s,i,{optionalContentConfig:o,markedContentStack:a=null},l,c){z(this,$l);this.ctx=e,this.current=new jz(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=s,this.filterFactory=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new kNe(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:r=!1,background:s=null}){const i=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,i,o),this.ctx.fillStyle=a,r){const l=this.cachedCanvases.getCanvas("transparent",i,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...rr(this.compositeCtx))}this.ctx.save(),w4(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=rr(this.ctx)}executeOperatorList(e,t,r,s){const i=e.argsArray,o=e.fnArray;let a=t||0;const l=i.length;if(l===a)return a;const c=l-a>Lz&&typeof r=="function",u=c?Date.now()+vNe:0;let h=0;const f=this.commonObjs,p=this.objs;let g;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,r),a;if(g=o[a],g!==fl.dependency)this[g].apply(this,i[a]);else for(const y of i[a]){const v=y.startsWith("g_")?f:p;if(!v.has(y))return v.get(y,r),a}if(a++,a===l)return a;if(c&&++h>Lz){if(Date.now()>u)return r(),a;h=0}}}endDrawing(){B(this,$l,RN).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),B(this,$l,MN).call(this)}_scaleImage(e,t){const r=e.width??e.displayWidth,s=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=r,l=s,c="prescale1",u,h;for(;i>2&&a>1||o>2&&l>1;){let f=a,p=l;i>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),i/=a/f),o>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/p),u=this.cachedCanvases.getCanvas(c,f,p),h=u.context,h.clearRect(0,0,f,p),h.drawImage(e,0,0,a,l,0,0,f,p),e=u.canvas,a=f,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:r,height:s}=e,i=this.current.fillColor,o=this.current.patternFill,a=rr(t);let l,c,u,h;if((e.bitmap||e.data)&&e.count>1){const I=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),i]),l=this._cachedBitmapsMap.get(I),l||(l=new Map,this._cachedBitmapsMap.set(I,l));const S=l.get(c);if(S&&!o){const N=Math.round(Math.min(a[0],a[2])+a[4]),P=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:S,offsetX:N,offsetY:P}}u=S}u||(h=this.cachedCanvases.getCanvas("maskCanvas",r,s),Fz(h.context,e));let f=Je.transform(a,[1/r,0,0,-1/s,0,0]);f=Je.transform(f,[1,0,0,1,0,-s]);const[p,g,y,v]=Je.getAxialAlignedBoundingBox([0,0,r,s],f),b=Math.round(y-p)||1,w=Math.round(v-g)||1,k=this.cachedCanvases.getCanvas("fillCanvas",b,w),T=k.context,R=p,M=g;T.translate(-R,-M),T.transform(...f),u||(u=this._scaleImage(h.canvas,Wl(T)),u=u.img,l&&o&&l.set(c,u)),T.imageSmoothingEnabled=zz(rr(T),e.interpolate),v4(T,u,0,0,u.width,u.height,0,0,r,s),T.globalCompositeOperation="source-in";const E=Je.transform(Wl(T),[1,0,0,1,-R,-M]);return T.fillStyle=o?i.getPattern(t,this,E,xi.FILL):i,T.fillRect(0,0,r,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,k.canvas)),{canvas:k.canvas,offsetX:Math.round(R),offsetY:Math.round(M)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=SNe[e]}setLineJoin(e){this.ctx.lineJoin=TNe[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(e),r.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(r,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;const i=this.ctx;i.setTransform(...rr(this.suspendedCtx)),My(this.suspendedCtx,i),wNe(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),My(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,r=this.suspendedCtx;this.composeSMask(r,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,r,s){const i=s[0],o=s[1],a=s[2]-i,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,r,a,l,t.subtype,t.backdrop,t.transferMap,i,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}genericComposeSMask(e,t,r,s,i,o,a,l,c,u,h){let f=e.canvas,p=l-u,g=c-h;if(o){const v=Je.makeHexColor(...o);if(p<0||g<0||p+r>f.width||g+s>f.height){const b=this.cachedCanvases.getCanvas("maskExtension",r,s),w=b.context;w.drawImage(f,-p,-g),w.globalCompositeOperation="destination-atop",w.fillStyle=v,w.fillRect(0,0,r,s),w.globalCompositeOperation="source-over",f=b.canvas,p=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(p,g,r,s),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=v,e.fillRect(p,g,r,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const y=new Path2D;y.rect(l,c,r,s),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(f,p,g,r,s,l,c,r,s),t.restore()}save(){this.inSMaskMode?(My(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),My(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,r,s,i,o){this.ctx.transform(e,t,r,s,i,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,r){const s=this.ctx,i=this.current;let o=i.x,a=i.y,l,c;const u=rr(s),h=u[0]===0&&u[3]===0||u[1]===0&&u[2]===0,f=h?r.slice(0):null;for(let p=0,g=0,y=e.length;p<y;p++)switch(e[p]|0){case fl.rectangle:o=t[g++],a=t[g++];const v=t[g++],b=t[g++],w=o+v,k=a+b;s.moveTo(o,a),v===0||b===0?s.lineTo(w,k):(s.lineTo(w,a),s.lineTo(w,k),s.lineTo(o,k)),h||i.updateRectMinMax(u,[o,a,w,k]),s.closePath();break;case fl.moveTo:o=t[g++],a=t[g++],s.moveTo(o,a),h||i.updatePathMinMax(u,o,a);break;case fl.lineTo:o=t[g++],a=t[g++],s.lineTo(o,a),h||i.updatePathMinMax(u,o,a);break;case fl.curveTo:l=o,c=a,o=t[g+4],a=t[g+5],s.bezierCurveTo(t[g],t[g+1],t[g+2],t[g+3],o,a),i.updateCurvePathMinMax(u,l,c,t[g],t[g+1],t[g+2],t[g+3],o,a,f),g+=6;break;case fl.curveTo2:l=o,c=a,s.bezierCurveTo(o,a,t[g],t[g+1],t[g+2],t[g+3]),i.updateCurvePathMinMax(u,l,c,o,a,t[g],t[g+1],t[g+2],t[g+3],f),o=t[g+2],a=t[g+3],g+=4;break;case fl.curveTo3:l=o,c=a,o=t[g+2],a=t[g+3],s.bezierCurveTo(t[g],t[g+1],o,a,o,a),i.updateCurvePathMinMax(u,l,c,t[g],t[g+1],o,a,o,a,f),g+=4;break;case fl.closePath:s.closePath();break}h&&i.updateScalingPathMinMax(u,f),i.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,r=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof r=="object"&&(r!=null&&r.getPattern)?(t.save(),t.strokeStyle=r.getPattern(t,this,Wl(t),xi.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,r=this.current.fillColor,s=this.current.patternFill;let i=!1;s&&(t.save(),t.fillStyle=r.getPattern(t,this,Wl(t),xi.FILL),i=!0);const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ANe}eoClip(){this.pendingClip=Bz}beginText(){this.current.textMatrix=uJ,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const r=new Path2D,s=t.getTransform().invertSelf();for(const{transform:i,x:o,y:a,fontSize:l,path:c}of e)r.addPath(c,new DOMMatrix(i).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(r),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var u;const r=this.commonObjs.get(e),s=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=r.fontMatrix||sN,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Lt("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;const i=r.loadedName||"sans-serif",o=((u=r.systemFontInfo)==null?void 0:u.css)||`"${i}", ${r.fallbackName}`;let a="normal";r.black?a="900":r.bold&&(a="bold");const l=r.italic?"italic":"normal";let c=t;t<Mz?c=Mz:t>Pz&&(c=Pz),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,r,s,i,o){this.current.textMatrix=[e,t,r,s,i,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,r,s,i){const o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,u=a.fontSize/a.fontSizeScale,h=c&ci.FILL_STROKE_MASK,f=!!(c&ci.ADD_TO_PATH_FLAG),p=a.patternFill&&!l.missingFile,g=a.patternStroke&&!l.missingFile;let y;if((l.disableFontFace||f||p||g)&&(y=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p||g){if(o.save(),o.translate(t,r),o.scale(u,-u),h===ci.FILL||h===ci.FILL_STROKE)if(s){const v=o.getTransform();o.setTransform(...s),o.fill(B(this,$l,PN).call(this,y,v,s))}else o.fill(y);if(h===ci.STROKE||h===ci.FILL_STROKE)if(i){const v=o.getTransform();o.setTransform(...i),o.stroke(B(this,$l,PN).call(this,y,v,i))}else o.lineWidth/=u,o.stroke(y);o.restore()}else(h===ci.FILL||h===ci.FILL_STROKE)&&o.fillText(e,t,r),(h===ci.STROKE||h===ci.FILL_STROKE)&&o.strokeText(e,t,r);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:rr(o),x:t,y:r,fontSize:u,path:y})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){r=!0;break}return Ht(this,"isFontSubpixelAAEnabled",r)}showText(e){const t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(s===0)return;const i=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,u=t.textHScale*c,h=e.length,f=r.vertical,p=f?1:-1,g=r.defaultVMetrics,y=s*t.fontMatrix[0],v=t.textRenderingMode===ci.FILL&&!r.disableFontFace&&!t.patternFill;i.save(),i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),c>0?i.scale(u,-1):i.scale(u,1);let b,w;if(t.patternFill){i.save();const E=t.fillColor.getPattern(i,this,Wl(i),xi.FILL);b=rr(i),i.restore(),i.fillStyle=E}if(t.patternStroke){i.save();const E=t.strokeColor.getPattern(i,this,Wl(i),xi.STROKE);w=rr(i),i.restore(),i.strokeStyle=E}let k=t.lineWidth;const T=t.textMatrixScale;if(T===0||k===0){const E=t.textRenderingMode&ci.FILL_STROKE_MASK;(E===ci.STROKE||E===ci.FILL_STROKE)&&(k=this.getSinglePixelWidth())}else k/=T;if(o!==1&&(i.scale(o,o),k/=o),i.lineWidth=k,r.isInvalidPDFjsFont){const E=[];let I=0;for(const S of e)E.push(S.unicode),I+=S.width;i.fillText(E.join(""),0,0),t.x+=I*y*u,i.restore(),this.compose();return}let R=0,M;for(M=0;M<h;++M){const E=e[M];if(typeof E=="number"){R+=p*E*s/1e3;continue}let I=!1;const S=(E.isSpace?l:0)+a,N=E.fontChar,P=E.accent;let O,D,G=E.width;if(f){const Q=E.vmetric||g,re=-(E.vmetric?Q[1]:G*.5)*y,ne=Q[2]*y;G=Q?-Q[0]:G,O=re/o,D=(R+ne)/o}else O=R/o,D=0;if(r.remeasure&&G>0){const Q=i.measureText(N).width*1e3/s*o;if(G<Q&&this.isFontSubpixelAAEnabled){const re=G/Q;I=!0,i.save(),i.scale(re,1),O/=re}else G!==Q&&(O+=(G-Q)/2e3*s/o)}if(this.contentVisible&&(E.isInFont||r.missingFile)){if(v&&!P)i.fillText(N,O,D);else if(this.paintChar(N,O,D,b,w),P){const Q=O+s*P.offset.x/o,re=D-s*P.offset.y/o;this.paintChar(P.fontChar,Q,re,b,w)}}const J=f?G*y-S*c:G*y+S*c;R+=J,I&&i.restore()}f?t.y-=R:t.x+=R*u,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,r=this.current,s=r.font,i=r.fontSize,o=r.fontDirection,a=s.vertical?1:-1,l=r.charSpacing,c=r.wordSpacing,u=r.textHScale*o,h=r.fontMatrix||sN,f=e.length,p=r.textRenderingMode===ci.INVISIBLE;let g,y,v,b;if(!(p||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...r.textMatrix),t.translate(r.x,r.y),t.scale(u,o),g=0;g<f;++g){if(y=e[g],typeof y=="number"){b=a*y*i/1e3,this.ctx.translate(b,0),r.x+=b*u;continue}const w=(y.isSpace?c:0)+l,k=s.charProcOperatorList[y.operatorListId];if(!k){Lt(`Type3 character "${y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=y,this.save(),t.scale(i,i),t.transform(...h),this.executeOperatorList(k),this.restore()),v=Je.applyTransform([y.width,0],h)[0]*i+w,t.translate(v,0),r.x+=v*u}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,r,s,i,o){this.ctx.rect(r,s,i-r,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const r=e[1],s=this.baseTransform||rr(this.ctx),i={createCanvasGraphics:o=>new bM(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new IN(e,r,this.ctx,i,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,r){this.ctx.strokeStyle=this.current.strokeColor=Je.makeHexColor(e,t,r),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,r){this.ctx.fillStyle=this.current.fillColor=Je.makeHexColor(e,t,r),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let r;return this.cachedPatterns.has(e)?r=this.cachedPatterns.get(e):(r=xNe(this.getObject(e)),this.cachedPatterns.set(e,r)),t&&(r.matrix=t),r}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const r=this._getPattern(e);t.fillStyle=r.getPattern(t,this,Wl(t),xi.SHADING);const s=Wl(t);if(s){const{width:i,height:o}=t.canvas,[a,l,c,u]=Je.getAxialAlignedBoundingBox([0,0,i,o],s);this.ctx.fillRect(a,l,c-a,u-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){zn("Should not call beginInlineImage")}beginImageData(){zn("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=rr(this.ctx),t)){const r=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],r,s),this.current.updateRectMinMax(rr(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||LS("TODO: Support non-isolated groups."),e.knockout&&Lt("Knockout groups not supported.");const r=rr(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=Je.getAxialAlignedBoundingBox(e.bbox,rr(t));const i=[0,0,t.canvas.width,t.canvas.height];s=Je.intersect(s,i)||[0,0,0,0];const o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),c=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(u,l,c),f=h.context;f.translate(-o,-a),f.transform(...r),e.smask?this.smaskStack.push({canvas:h.canvas,context:f,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),My(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=rr(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const i=Je.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,r,s,i){if(B(this,$l,RN).call(this),w4(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],a=t[3]-t[1];if(i&&this.annotationCanvasMap){r=r.slice(),r[4]-=t[0],r[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;const[l,c]=Je.singularValueDecompose2dScale(rr(this.ctx)),{viewportScale:u}=this,h=Math.ceil(o*this.outputScaleX*u),f=Math.ceil(a*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(h,f);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,a*c),w4(this.ctx)}else w4(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new jz(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...r),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),B(this,$l,MN).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const r=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=_Ne(e)),s.compiled)){s.compiled(r);return}const i=this._createMaskCanvas(e),o=i.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,i.offsetX,i.offsetY),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,r=0,s=0,i,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=rr(a);a.transform(t,r,s,i,0,0);const c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let u=0,h=o.length;u<h;u+=2){const f=Je.transform(l,[t,r,s,i,o[u],o[u+1]]),[p,g]=Je.applyTransform([0,0],f);a.drawImage(c.canvas,p,g)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,r=this.current.fillColor,s=this.current.patternFill;for(const i of e){const{data:o,width:a,height:l,transform:c}=i,u=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=u.context;h.save();const f=this.getObject(o,i);Fz(h,f),h.globalCompositeOperation="source-in",h.fillStyle=s?r.getPattern(h,this,Wl(t),xi.FILL):r,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),v4(t,u.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Lt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,r,s){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){Lt("Dependent image isn't ready yet");return}const o=i.width,a=i.height,l=[];for(let c=0,u=s.length;c<u;c+=2)l.push({transform:[t,0,0,r,s[c],s[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:r,height:s}=e,i=this.cachedCanvases.getCanvas("inlineImage",r,s),o=i.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,r=e.height,s=this.ctx;if(this.save(),!ki){const{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/r);let i;if(e.bitmap)i=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)i=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,r).context;Oz(l,e),i=this.applyTransferMapsToCanvas(l)}const o=this._scaleImage(i,Wl(s));s.imageSmoothingEnabled=zz(rr(s),e.interpolate),v4(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-r,t,r),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const r=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const i=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",i,o).context;Oz(l,e),s=this.applyTransferMapsToCanvas(l)}for(const i of t)r.save(),r.transform(...i.transform),r.scale(1,-1),v4(r,s,i.x,i.y,i.w,i.h,0,-1,1,1),r.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const r=this.ctx;this.pendingClip&&(t||(this.pendingClip===Bz?r.clip("evenodd"):r.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),r.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=rr(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:r,c:s,d:i}=this.ctx.getTransform();let o,a;if(r===0&&s===0){const l=Math.abs(t),c=Math.abs(i);if(l===c)if(e===0)o=a=1/l;else{const u=l*e;o=a=u<1?1/u:1}else if(e===0)o=1/l,a=1/c;else{const u=l*e,h=c*e;o=u<1?1/u:1,a=h<1?1/h:1}}else{const l=Math.abs(t*i-r*s),c=Math.hypot(t,r),u=Math.hypot(s,i);if(e===0)o=u/l,a=c/l;else{const h=e*l;o=u>h?u/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:r}=this.current,[s,i]=this.getScaleForStroking();if(t.lineWidth=r||1,s===1&&i===1){t.stroke();return}const o=t.getLineDash();if(e&&t.save(),t.scale(s,i),o.length>0){const a=Math.max(s,i);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};$l=new WeakSet,RN=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},MN=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},PN=function(e,t,r){const s=new Path2D;return s.addPath(e,new DOMMatrix(r).invertSelf().multiplySelf(t)),s};let lg=bM;for(const n in fl)lg.prototype[n]!==void 0&&(lg.prototype[fl[n]]=lg.prototype[n]);var wv,kv;class ju{static get workerPort(){return m(this,wv)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");L(this,wv,e)}static get workerSrc(){return m(this,kv)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");L(this,kv,e)}}wv=new WeakMap,kv=new WeakMap,z(ju,wv,null),z(ju,kv,"");var Ep,_v;class ENe{constructor({parsedData:e,rawData:t}){z(this,Ep);z(this,_v);L(this,Ep,e),L(this,_v,t)}getRaw(){return m(this,_v)}get(e){return m(this,Ep).get(e)??null}getAll(){return aM(m(this,Ep))}has(e){return m(this,Ep).has(e)}}Ep=new WeakMap,_v=new WeakMap;const Tm=Symbol("INTERNAL");var Sv,Tv,Av,Eg;class CNe{constructor(e,{name:t,intent:r,usage:s,rbGroups:i}){z(this,Sv,!1);z(this,Tv,!1);z(this,Av,!1);z(this,Eg,!0);L(this,Sv,!!(e&Zo.DISPLAY)),L(this,Tv,!!(e&Zo.PRINT)),this.name=t,this.intent=r,this.usage=s,this.rbGroups=i}get visible(){if(m(this,Av))return m(this,Eg);if(!m(this,Eg))return!1;const{print:e,view:t}=this.usage;return m(this,Sv)?(t==null?void 0:t.viewState)!=="OFF":m(this,Tv)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,r=!1){e!==Tm&&zn("Internal method `_setVisible` called."),L(this,Av,r),L(this,Eg,t)}}Sv=new WeakMap,Tv=new WeakMap,Av=new WeakMap,Eg=new WeakMap;var ih,Cn,Cg,Ng,Ev,LN;class NNe{constructor(e,t=Zo.DISPLAY){z(this,Ev);z(this,ih,null);z(this,Cn,new Map);z(this,Cg,null);z(this,Ng,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,L(this,Ng,e.order);for(const r of e.groups)m(this,Cn).set(r.id,new CNe(t,r));if(e.baseState==="OFF")for(const r of m(this,Cn).values())r._setVisible(Tm,!1);for(const r of e.on)m(this,Cn).get(r)._setVisible(Tm,!0);for(const r of e.off)m(this,Cn).get(r)._setVisible(Tm,!1);L(this,Cg,this.getHash())}}isVisible(e){if(m(this,Cn).size===0)return!0;if(!e)return LS("Optional content group not defined."),!0;if(e.type==="OCG")return m(this,Cn).has(e.id)?m(this,Cn).get(e.id).visible:(Lt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return B(this,Ev,LN).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!m(this,Cn).has(t))return Lt(`Optional content group not found: ${t}`),!0;if(m(this,Cn).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!m(this,Cn).has(t))return Lt(`Optional content group not found: ${t}`),!0;if(!m(this,Cn).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!m(this,Cn).has(t))return Lt(`Optional content group not found: ${t}`),!0;if(!m(this,Cn).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!m(this,Cn).has(t))return Lt(`Optional content group not found: ${t}`),!0;if(m(this,Cn).get(t).visible)return!1}return!0}return Lt(`Unknown optional content policy ${e.policy}.`),!0}return Lt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,r=!0){var i;const s=m(this,Cn).get(e);if(!s){Lt(`Optional content group not found: ${e}`);return}if(r&&t&&s.rbGroups.length)for(const o of s.rbGroups)for(const a of o)a!==e&&((i=m(this,Cn).get(a))==null||i._setVisible(Tm,!1,!0));s._setVisible(Tm,!!t,!0),L(this,ih,null)}setOCGState({state:e,preserveRB:t}){let r;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":r=s;continue}const i=m(this,Cn).get(s);if(i)switch(r){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!i.visible,t);break}}L(this,ih,null)}get hasInitialVisibility(){return m(this,Cg)===null||this.getHash()===m(this,Cg)}getOrder(){return m(this,Cn).size?m(this,Ng)?m(this,Ng).slice():[...m(this,Cn).keys()]:null}getGroups(){return m(this,Cn).size>0?aM(m(this,Cn)):null}getGroup(e){return m(this,Cn).get(e)||null}getHash(){if(m(this,ih)!==null)return m(this,ih);const e=new $J;for(const[t,r]of m(this,Cn))e.update(`${t}:${r.visible}`);return L(this,ih,e.hexdigest())}}ih=new WeakMap,Cn=new WeakMap,Cg=new WeakMap,Ng=new WeakMap,Ev=new WeakSet,LN=function(e){const t=e.length;if(t<2)return!0;const r=e[0];for(let s=1;s<t;s++){const i=e[s];let o;if(Array.isArray(i))o=B(this,Ev,LN).call(this,i);else if(m(this,Cn).has(i))o=m(this,Cn).get(i).visible;else return Lt(`Optional content group not found: ${i}`),!0;switch(r){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return r==="And"};class INe{constructor(e,{disableRange:t=!1,disableStream:r=!1}){Xr(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:i,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(i==null?void 0:i.length)>0){const l=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!r,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const s=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(r),!0)});Xr(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,r,s,i;e.total===void 0?(r=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||r.call(t,{loaded:e.loaded}):(i=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||i.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Xr(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new RNe(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new MNe(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeReaders.slice(0))r.cancel(e);this._pdfDataRangeTransport.abort()}}class RNe{constructor(e,t,r=!1,s=null){this._stream=e,this._done=r||!1,this._filename=uM(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class MNe{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function PNe(n){let e=!0,t=r("filename\\*","i").exec(n);if(t){t=t[1];let u=a(t);return u=unescape(u),u=l(u),u=c(u),i(u)}if(t=o(n),t){const u=c(t);return i(u)}if(t=r("filename","i").exec(n),t){t=t[1];let u=a(t);return u=c(u),i(u)}function r(u,h){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(u,h){if(u){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(u,{fatal:!0}),p=DS(h);h=f.decode(p),e=!1}catch{}}return h}function i(u){return e&&/[\x80-\xff]/.test(u)&&(u=s("utf-8",u),e&&(u=s("iso-8859-1",u))),u}function o(u){const h=[];let f;const p=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(u))!==null;){let[,y,v,b]=f;if(y=parseInt(y,10),y in h){if(y===0)break;continue}h[y]=[v,b]}const g=[];for(let y=0;y<h.length&&y in h;++y){let[v,b]=h[y];b=a(b),v&&(b=unescape(b),y===0&&(b=l(b))),g.push(b)}return g.join("")}function a(u){if(u.startsWith('"')){const h=u.slice(1).split('\\"');for(let f=0;f<h.length;++f){const p=h[f].indexOf('"');p!==-1&&(h[f]=h[f].slice(0,p),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}u=h.join('"')}return u}function l(u){const h=u.indexOf("'");if(h===-1)return u;const f=u.slice(0,h),g=u.slice(h+1).replace(/^[^']*'/,"");return s(f,g)}function c(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,p,g){if(p==="q"||p==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,v){return String.fromCharCode(parseInt(v,16))}),s(f,g);try{g=atob(g)}catch{}return s(f,g)})}return""}function tQ(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const r in e){const s=e[r];s!==void 0&&t.append(r,s)}return t}function FS(n){try{return new URL(n).origin}catch{}return null}function nQ({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:r}){const s={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(n.get("Content-Length"),10);return!Number.isInteger(i)||(s.suggestedLength=i,i<=2*t)||r||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function rQ(n){const e=n.get("Content-Disposition");if(e){let t=PNe(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(uM(t))return t}return null}function zS(n,e){return n===404||n===0&&e.startsWith("file:")?new Hb('Missing PDF "'+e+'".'):new M5(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function sQ(n){return n===200||n===206}function iQ(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function oQ(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(Lt(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class $z{constructor(e){ct(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=tQ(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Xr(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new LNe(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new DNe(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class LNe{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const r=new Headers(e.headers),s=t.url;fetch(s,iQ(r,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=FS(i.url),!sQ(i.status))throw zS(i.status,s);this._reader=i.body.getReader(),this._headersCapability.resolve();const o=i.headers,{allowRangeRequests:a,suggestedLength:l}=nQ({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=rQ(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ff("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded,total:this._contentLength}),{value:oQ(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class DNe{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${r-1}`);const o=s.url;fetch(o,iQ(i,this._withCredentials,this._abortController)).then(a=>{const l=FS(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!sQ(a.status))throw zS(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded}),{value:oQ(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const dE=200,hE=206;function jNe(n){const e=n.response;return typeof e!="string"?e:DS(e).buffer}class ONe{constructor({url:e,httpHeaders:t,withCredentials:r}){ct(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=tQ(this.isHttp,t),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,r=this.currXhrId++,s=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,o]of this.headers)t.setRequestHeader(i,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=hE):s.expectedStatus=dE,t.responseType="arraybuffer",Xr(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){var s;const r=this.pendingRequests[e];r&&((s=r.onProgress)==null||s.call(r,t))}onStateChange(e,t){const r=this.pendingRequests[e];if(!r)return;const s=r.xhr;if(s.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){r.onError(s.status);return}const i=s.status||dE;if(!(i===dE&&r.expectedStatus===hE)&&i!==r.expectedStatus){r.onError(s.status);return}const a=jNe(s);if(i===hE){const l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?r.onDone({begin:parseInt(c[1],10),chunk:a}):(Lt('Missing or invalid "Content-Range" header.'),r.onError(0))}else a?r.onDone({begin:0,chunk:a}):r.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class FNe{constructor(e){this._source=e,this._manager=new ONe(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Xr(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new zNe(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const r=new BNe(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class zNe{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=FS(t.responseURL);const r=t.getAllResponseHeaders(),s=new Headers(r?r.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:o}=nQ({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=rQ(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=zS(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class BNe{constructor(e,t,r){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:r,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=FS((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=zS(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const $Ne=/^[a-z][a-z0-9\-+.]+:/i;function VNe(n){if($Ne.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class UNe{constructor(e){this.source=e,this.url=VNe(e.url),Xr(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Xr(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new HNe(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new qNe(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class HNe{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(r.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new Hb(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ff("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class qNe{constructor(e,t,r){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:r-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const GNe=1e5,ho=30,WNe=.8;var Wz,oh,yo,Cv,Nv,Cp,vu,Iv,Rv,Np,Ig,Rg,ah,Mg,Mv,Pg,Ip,Pv,Lv,Rp,Mp,Dv,lh,Lg,ud,aQ,lQ,DN,fa,pk,jN,cQ,uQ;const ds=class ds{constructor({textContentSource:e,container:t,viewport:r}){z(this,ud);z(this,oh,Promise.withResolvers());z(this,yo,null);z(this,Cv,!1);z(this,Nv,!!((Wz=globalThis.FontInspector)!=null&&Wz.enabled));z(this,Cp,null);z(this,vu,null);z(this,Iv,0);z(this,Rv,0);z(this,Np,null);z(this,Ig,null);z(this,Rg,0);z(this,ah,0);z(this,Mg,Object.create(null));z(this,Mv,[]);z(this,Pg,null);z(this,Ip,[]);z(this,Pv,new WeakMap);z(this,Lv,null);var l;if(e instanceof ReadableStream)L(this,Pg,e);else if(typeof e=="object")L(this,Pg,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');L(this,yo,L(this,Ig,t)),L(this,ah,r.scale*(globalThis.devicePixelRatio||1)),L(this,Rg,r.rotation),L(this,vu,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:i,pageX:o,pageY:a}=r.rawDims;L(this,Lv,[1,0,0,-1,-o,a+i]),L(this,Rv,s),L(this,Iv,i),B(l=ds,fa,cQ).call(l),O0(t,r),m(this,oh).promise.finally(()=>{m(ds,Lg).delete(this),L(this,vu,null),L(this,Mg,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Qi.platform;return Ht(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{m(this,Np).read().then(({value:t,done:r})=>{if(r){m(this,oh).resolve();return}m(this,Cp)??L(this,Cp,t.lang),Object.assign(m(this,Mg),t.styles),B(this,ud,aQ).call(this,t.items),e()},m(this,oh).reject)};return L(this,Np,m(this,Pg).getReader()),m(ds,Lg).add(this),e(),m(this,oh).promise}update({viewport:e,onBefore:t=null}){var i;const r=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==m(this,Rg)&&(t==null||t(),L(this,Rg,s),O0(m(this,Ig),{rotation:s})),r!==m(this,ah)){t==null||t(),L(this,ah,r);const o={div:null,properties:null,ctx:B(i=ds,fa,pk).call(i,m(this,Cp))};for(const a of m(this,Ip))o.properties=m(this,Pv).get(a),o.div=a,B(this,ud,DN).call(this,o)}}cancel(){var t;const e=new ff("TextLayer task cancelled.");(t=m(this,Np))==null||t.cancel(e).catch(()=>{}),L(this,Np,null),m(this,oh).reject(e)}get textDivs(){return m(this,Ip)}get textContentItemsStr(){return m(this,Mv)}static cleanup(){if(!(m(this,Lg).size>0)){m(this,Rp).clear();for(const{canvas:e}of m(this,Mp).values())e.remove();m(this,Mp).clear()}}};oh=new WeakMap,yo=new WeakMap,Cv=new WeakMap,Nv=new WeakMap,Cp=new WeakMap,vu=new WeakMap,Iv=new WeakMap,Rv=new WeakMap,Np=new WeakMap,Ig=new WeakMap,Rg=new WeakMap,ah=new WeakMap,Mg=new WeakMap,Mv=new WeakMap,Pg=new WeakMap,Ip=new WeakMap,Pv=new WeakMap,Lv=new WeakMap,Rp=new WeakMap,Mp=new WeakMap,Dv=new WeakMap,lh=new WeakMap,Lg=new WeakMap,ud=new WeakSet,aQ=function(e){var s,i;if(m(this,Cv))return;(i=m(this,vu)).ctx??(i.ctx=B(s=ds,fa,pk).call(s,m(this,Cp)));const t=m(this,Ip),r=m(this,Mv);for(const o of e){if(t.length>GNe){Lt("Ignoring additional textDivs for performance reasons."),L(this,Cv,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const a=m(this,yo);L(this,yo,document.createElement("span")),m(this,yo).classList.add("markedContent"),o.id!==null&&m(this,yo).setAttribute("id",`${o.id}`),a.append(m(this,yo))}else o.type==="endMarkedContent"&&L(this,yo,m(this,yo).parentNode);continue}r.push(o.str),B(this,ud,lQ).call(this,o)}},lQ=function(e){var y;const t=document.createElement("span"),r={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};m(this,Ip).push(t);const s=Je.transform(m(this,Lv),e.transform);let i=Math.atan2(s[1],s[0]);const o=m(this,Mg)[e.fontName];o.vertical&&(i+=Math.PI/2);let a=m(this,Nv)&&o.fontSubstitution||o.fontFamily;a=ds.fontFamilyMap.get(a)||a;const l=Math.hypot(s[2],s[3]),c=l*B(y=ds,fa,uQ).call(y,a,m(this,Cp));let u,h;i===0?(u=s[4],h=s[5]-c):(u=s[4]+c*Math.sin(i),h=s[5]-c*Math.cos(i));const f="calc(var(--scale-factor)*",p=t.style;m(this,yo)===m(this,Ig)?(p.left=`${(100*u/m(this,Rv)).toFixed(2)}%`,p.top=`${(100*h/m(this,Iv)).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${h.toFixed(2)}px)`),p.fontSize=`${f}${(m(ds,lh)*l).toFixed(2)}px)`,p.fontFamily=a,r.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,m(this,Nv)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),i!==0&&(r.angle=i*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const v=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);v!==b&&Math.max(v,b)/Math.min(v,b)>1.5&&(g=!0)}if(g&&(r.canvasWidth=o.vertical?e.height:e.width),m(this,Pv).set(t,r),m(this,vu).div=t,m(this,vu).properties=r,B(this,ud,DN).call(this,m(this,vu)),r.hasText&&m(this,yo).append(t),r.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),m(this,yo).append(v)}},DN=function(e){var a;const{div:t,properties:r,ctx:s}=e,{style:i}=t;let o="";if(m(ds,lh)>1&&(o=`scale(${1/m(ds,lh)})`),r.canvasWidth!==0&&r.hasText){const{fontFamily:l}=i,{canvasWidth:c,fontSize:u}=r;B(a=ds,fa,jN).call(a,s,u*m(this,ah),l);const{width:h}=s.measureText(t.textContent);h>0&&(o=`scaleX(${c*m(this,ah)/h}) ${o}`)}r.angle!==0&&(o=`rotate(${r.angle}deg) ${o}`),o.length>0&&(i.transform=o)},fa=new WeakSet,pk=function(e=null){let t=m(this,Mp).get(e||(e=""));if(!t){const r=document.createElement("canvas");r.className="hiddenCanvasElement",r.lang=e,document.body.append(r),t=r.getContext("2d",{alpha:!1,willReadFrequently:!0}),m(this,Mp).set(e,t),m(this,Dv).set(t,{size:0,family:""})}return t},jN=function(e,t,r){const s=m(this,Dv).get(e);t===s.size&&r===s.family||(e.font=`${t}px ${r}`,s.size=t,s.family=r)},cQ=function(){if(m(this,lh)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),L(this,lh,e.getBoundingClientRect().height),e.remove()},uQ=function(e,t){const r=m(this,Rp).get(e);if(r)return r;const s=B(this,fa,pk).call(this,t);s.canvas.width=s.canvas.height=ho,B(this,fa,jN).call(this,s,ho,e);const i=s.measureText("");let o=i.fontBoundingBoxAscent,a=Math.abs(i.fontBoundingBoxDescent);if(o){const u=o/(o+a);return m(this,Rp).set(e,u),s.canvas.width=s.canvas.height=0,u}s.strokeStyle="red",s.clearRect(0,0,ho,ho),s.strokeText("g",0,0);let l=s.getImageData(0,0,ho,ho).data;a=0;for(let u=l.length-1-3;u>=0;u-=4)if(l[u]>0){a=Math.ceil(u/4/ho);break}s.clearRect(0,0,ho,ho),s.strokeText("A",0,ho),l=s.getImageData(0,0,ho,ho).data,o=0;for(let u=0,h=l.length;u<h;u+=4)if(l[u]>0){o=ho-Math.floor(u/4/ho);break}s.canvas.width=s.canvas.height=0;const c=o?o/(o+a):WNe;return m(this,Rp).set(e,c),c},z(ds,fa),z(ds,Rp,new Map),z(ds,Mp,new Map),z(ds,Dv,new WeakMap),z(ds,lh,null),z(ds,Lg,new Set);let qb=ds;class Gb{static textContent(e){const t=[],r={items:t,styles:Object.create(null)};function s(i){var l;if(!i)return;let o=null;const a=i.name;if(a==="#text")o=i.value;else if(Gb.shouldBuildText(a))(l=i==null?void 0:i.attributes)!=null&&l.textContent?o=i.attributes.textContent:i.value&&(o=i.value);else return;if(o!==null&&t.push({str:o}),!!i.children)for(const c of i.children)s(c)}return s(e),r}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const KNe=65536,YNe=100,XNe=5e3,JNe=ki?dNe:lNe,QNe=ki?hNe:YJ,ZNe=ki?uNe:cNe,eIe=ki?fNe:ZJ;function tIe(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new ON,{docId:t}=e,r=n.url?nIe(n.url):null,s=n.data?rIe(n.data):null,i=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof dQ?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:KNe;let u=n.worker instanceof cg?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!OS(n.docBaseUrl)?n.docBaseUrl:null,p=typeof n.cMapUrl=="string"?n.cMapUrl:null,g=n.cMapPacked!==!1,y=n.CMapReaderFactory||QNe,v=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,b=n.StandardFontDataFactory||eIe,w=n.stopAtErrors!==!0,k=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,T=n.isEvalSupported!==!1,R=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!ki,M=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!ki&&(Qi.platform.isFirefox||!globalThis.chrome),E=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,I=typeof n.disableFontFace=="boolean"?n.disableFontFace:ki,S=n.fontExtraProperties===!0,N=n.enableXfa===!0,P=n.ownerDocument||globalThis.document,O=n.disableRange===!0,D=n.disableStream===!0,G=n.disableAutoFetch===!0,J=n.pdfBug===!0,Q=n.CanvasFactory||JNe,re=n.FilterFactory||ZNe,ne=n.enableHWA===!0,te=l?l.length:n.length??NaN,H=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!ki&&!I,ce=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:y===YJ&&b===ZJ&&p&&v&&Zy(p,document.baseURI)&&Zy(v,document.baseURI),xe=null;BCe(h);const W={canvasFactory:new Q({ownerDocument:P,enableHWA:ne}),filterFactory:new re({docId:t,ownerDocument:P}),cMapReaderFactory:ce?null:new y({baseUrl:p,isCompressed:g}),standardFontDataFactory:ce?null:new b({baseUrl:v})};if(!u){const Fe={verbosity:h,port:ju.workerPort};u=Fe.port?cg.fromPort(Fe):new cg(Fe),e._worker=u}const dt={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:G,rangeChunkSize:c,length:te,docBaseUrl:f,enableXfa:N,evaluatorOptions:{maxImageSize:k,disableFontFace:I,ignoreErrors:w,isEvalSupported:T,isOffscreenCanvasSupported:R,isImageDecoderSupported:M,canvasMaxAreaInBytes:E,fontExtraProperties:S,useSystemFonts:H,cMapUrl:ce?p:null,standardFontDataUrl:ce?v:null}},Me={disableFontFace:I,fontExtraProperties:S,ownerDocument:P,pdfBug:J,styleElement:xe,loadingParams:{disableAutoFetch:G,enableXfa:N}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Fe=u.messageHandler.sendWithPromise("GetDocRequest",dt,s?[s.buffer]:null);let Ae;if(l)Ae=new INe(l,{disableRange:O,disableStream:D});else if(!s){if(!r)throw new Error("getDocument - no `url` parameter provided.");let lt;if(ki)if(Zy(r)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");lt=$z}else lt=UNe;else lt=Zy(r)?$z:FNe;Ae=new lt({url:r,length:te,httpHeaders:i,withCredentials:o,rangeChunkSize:c,disableRange:O,disableStream:D})}return Fe.then(lt=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const sn=new rx(t,lt,u.port),un=new aIe(sn,e,Ae,Me,W);e._transport=un,sn.send("Ready",null)})}).catch(e._capability.reject),e}function nIe(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(ki&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function rIe(n){if(ki&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return DS(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Vz(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var K5;const Y5=class Y5{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Pi(Y5,K5)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,r,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(r=this._worker)!=null&&r.port&&delete this._worker._pendingDestroy,i}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}};K5=new WeakMap,z(Y5,K5,0);let ON=Y5;class dQ{constructor(e,t,r=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const r of this._rangeListeners)r(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const r of this._progressListeners)r(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){zn("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class sIe{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var ch,wu,Ua,Am,mk;class iIe{constructor(e,t,r,s=!1){z(this,Ua);z(this,ch,null);z(this,wu,!1);this._pageIndex=e,this._pageInfo=t,this._transport=r,this._stats=s?new Cz:null,this._pdfBug=s,this.commonObjs=r.commonObjs,this.objs=new hQ,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:s=0,dontFlip:i=!1}={}){return new c2({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:s,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Ht(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:r="display",annotationMode:s=Gd.ENABLE,transform:i=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:h=!1}){var T,R;(T=this._stats)==null||T.time("Overall");const f=this._transport.getRenderingIntent(r,s,u,h),{renderingIntent:p,cacheKey:g}=f;L(this,wu,!1),B(this,Ua,mk).call(this),a||(a=this._transport.getOptionalContentConfig(p));let y=this._intentStates.get(g);y||(y=Object.create(null),this._intentStates.set(g,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const v=!!(p&Zo.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(R=this._stats)==null||R.time("Page Request"),this._pumpOperatorList(f));const b=M=>{var E;y.renderTasks.delete(w),(this._maybeCleanupAfterRender||v)&&L(this,wu,!0),B(this,Ua,Am).call(this,!v),M?(w.capability.reject(M),this._abortOperatorList({intentState:y,reason:M instanceof Error?M:new Error(M)})):w.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(E=globalThis.Stats)!=null&&E.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},w=new zN({callback:b,params:{canvasContext:e,viewport:t,transform:i,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:c});(y.renderTasks||(y.renderTasks=new Set)).add(w);const k=w.task;return Promise.all([y.displayReadyCapability.promise,a]).then(([M,E])=>{var I;if(this.destroyed){b();return}if((I=this._stats)==null||I.time("Rendering"),!(E.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");w.initializeGraphics({transparency:M,optionalContentConfig:E}),w.operatorListChanged()}).catch(b),k}getOperatorList({intent:e="display",annotationMode:t=Gd.ENABLE,printAnnotationStorage:r=null,isEditing:s=!1}={}){var c;function i(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(e,t,r,s,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>Gb.textContent(r));const t=this.streamTextContent(e);return new Promise(function(r,s){function i(){o.read().then(function({value:l,done:c}){if(c){r(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),i()},s)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const r of t.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),L(this,wu,!1),B(this,Ua,mk).call(this),Promise.all(e)}cleanup(e=!1){L(this,wu,!0);const t=B(this,Ua,Am).call(this,!1);return e&&t&&this._stats&&(this._stats=new Cz),t}_startRenderPage(e,t){var s,i;const r=this._intentStates.get(t);r&&((s=this._stats)==null||s.timeEnd("Page Request"),(i=r.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let r=0,s=e.length;r<s;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const r of t.renderTasks)r.operatorListChanged();e.lastChunk&&B(this,Ua,Am).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:r,modifiedIds:s}){const{map:i,transfer:o}=r,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:s},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;const u=()=>{l.read().then(({value:h,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),u())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();B(this,Ua,Am).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};u()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(t instanceof cM){let s=YNe;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new ff(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,i]of this._intentStates)if(i===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}ch=new WeakMap,wu=new WeakMap,Ua=new WeakSet,Am=function(e=!1){if(B(this,Ua,mk).call(this),!m(this,wu)||this.destroyed)return!1;if(e)return L(this,ch,setTimeout(()=>{L(this,ch,null),B(this,Ua,Am).call(this,!1)},XNe)),!1;for(const{renderTasks:t,operatorList:r}of this._intentStates.values())if(t.size>0||!r.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),L(this,wu,!1),!0},mk=function(){m(this,ch)&&(clearTimeout(m(this,ch)),L(this,ch,null))};var ku,X5;class oIe{constructor(){z(this,ku,new Map);z(this,X5,Promise.resolve())}postMessage(e,t){const r={data:structuredClone(e,t?{transfer:t}:null)};m(this,X5).then(()=>{for(const[s]of m(this,ku))s.call(this,r)})}addEventListener(e,t,r=null){let s=null;if((r==null?void 0:r.signal)instanceof AbortSignal){const{signal:i}=r;if(i.aborted){Lt("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);s=()=>i.removeEventListener("abort",o),i.addEventListener("abort",o)}m(this,ku).set(t,s)}removeEventListener(e,t){const r=m(this,ku).get(t);r==null||r(),m(this,ku).delete(t)}terminate(){for(const[,e]of m(this,ku))e==null||e();m(this,ku).clear()}}ku=new WeakMap,X5=new WeakMap;var J5,Pp,Lp,Dg,gk,jg,yk;const nr=class nr{constructor({name:e=null,port:t=null,verbosity:r=$Ce()}={}){z(this,Dg);var s;if(this.name=e,this.destroyed=!1,this.verbosity=r,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=m(nr,Lp))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(m(nr,Lp)||L(nr,Lp,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new rx("main","worker",e),this._messageHandler.on("ready",function(){}),B(this,Dg,gk).call(this)}_initialize(){if(m(nr,Pp)||m(nr,jg,yk)){this._setupFakeWorker();return}let{workerSrc:e}=nr;try{nr._isSameOrigin(window.location.href,e)||(e=nr._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),r=new rx("main","worker",t),s=()=>{i.abort(),r.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:i.signal}),r.on("test",a=>{if(i.abort(),this.destroyed||!a){s();return}this._messageHandler=r,this._port=t,this._webWorker=t,B(this,Dg,gk).call(this)}),r.on("ready",a=>{if(i.abort(),this.destroyed){s();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const a=new Uint8Array;r.send("test",a,[a.buffer])};o();return}catch{LS("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){m(nr,Pp)||(Lt("Setting up fake worker."),L(nr,Pp,!0)),nr._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new oIe;this._port=t;const r=`fake${Pi(nr,J5)._++}`,s=new rx(r+"_worker",r,t);e.setup(s,t),this._messageHandler=new rx(r,r+"_worker",t),B(this,Dg,gk).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,r;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=m(nr,Lp))==null||t.delete(this._port),this._port=null,(r=this._messageHandler)==null||r.destroy(),this._messageHandler=null}static fromPort(e){var r;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(r=m(this,Lp))==null?void 0:r.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new nr(e)}static get workerSrc(){if(ju.workerSrc)return ju.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Ht(this,"_setupFakeWorkerGlobal",(async()=>m(this,jg,yk)?m(this,jg,yk):(await import(this.workerSrc)).WorkerMessageHandler)())}};J5=new WeakMap,Pp=new WeakMap,Lp=new WeakMap,Dg=new WeakSet,gk=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},jg=new WeakSet,yk=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},z(nr,jg),z(nr,J5,0),z(nr,Pp,!1),z(nr,Lp),ki&&(L(nr,Pp,!0),ju.workerSrc||(ju.workerSrc="./pdf.worker.mjs")),nr._isSameOrigin=(e,t)=>{let r;try{if(r=new URL(e),!r.origin||r.origin==="null")return!1}catch{return!1}const s=new URL(t,r);return r.origin===s.origin},nr._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let cg=nr;var _u,fc,Og,Fg,Su,Dp,lx;class aIe{constructor(e,t,r,s,i){z(this,Dp);z(this,_u,new Map);z(this,fc,new Map);z(this,Og,new Map);z(this,Fg,new Map);z(this,Su,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new hQ,this.fontLoader=new oNe({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Ht(this,"annotationStorage",new fM)}getRenderingIntent(e,t=Gd.ENABLE,r=null,s=!1,i=!1){let o=Zo.DISPLAY,a=AN;switch(e){case"any":o=Zo.ANY;break;case"display":break;case"print":o=Zo.PRINT;break;default:Lt(`getRenderingIntent - invalid intent: ${e}`)}const l=o&Zo.PRINT&&r instanceof UJ?r:this.annotationStorage;switch(t){case Gd.DISABLE:o+=Zo.ANNOTATIONS_DISABLE;break;case Gd.ENABLE:break;case Gd.ENABLE_FORMS:o+=Zo.ANNOTATIONS_FORMS;break;case Gd.ENABLE_STORAGE:o+=Zo.ANNOTATIONS_STORAGE,a=l.serializable;break;default:Lt(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=Zo.IS_EDITING),i&&(o+=Zo.OPLIST);const{ids:c,hash:u}=l.modifiedIds,h=[o,a.hash,u];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var r;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(r=m(this,Su))==null||r.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of m(this,fc).values())e.push(s._destroy());m(this,fc).clear(),m(this,Og).clear(),m(this,Fg).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,i;this.commonObjs.clear(),this.fontLoader.clear(),m(this,_u).clear(),this.filterFactory.destroy(),qb.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new ff("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(r,s)=>{Xr(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},s.onPull=()=>{this._fullReader.read().then(function({value:i,done:o}){if(o){s.close();return}Xr(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{s.error(i)})},s.onCancel=i=>{this._fullReader.cancel(i),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async r=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:i,contentLength:o}=this._fullReader;return(!s||!i)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:i,contentLength:o}}),e.on("GetRangeReader",(r,s)=>{Xr(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(r.begin,r.end);if(!i){s.close();return}s.onPull=()=>{i.read().then(function({value:o,done:a}){if(a){s.close();return}Xr(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{i.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,t._capability.resolve(new sIe(r,this))}),e.on("DocException",r=>{t._capability.reject(po(r))}),e.on("PasswordRequest",r=>{L(this,Su,Promise.withResolvers());try{if(!t.onPassword)throw po(r);const s=i=>{i instanceof Error?m(this,Su).reject(i):m(this,Su).resolve({password:i})};t.onPassword(s,r.code)}catch(s){m(this,Su).reject(s)}return m(this,Su).promise}),e.on("DataLoaded",r=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),e.on("StartRenderPage",r=>{if(this.destroyed)return;m(this,fc).get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),e.on("commonobj",([r,s,i])=>{var o;if(this.destroyed||this.commonObjs.has(r))return null;switch(s){case"Font":const{disableFontFace:a,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in i){const p=i.error;Lt(`Error during font loading: ${p}`),this.commonObjs.resolve(r,p);break}const u=c&&((o=globalThis.FontInspector)!=null&&o.enabled)?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,h=new aNe(i,{disableFontFace:a,fontExtraProperties:l,inspectFont:u});this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:r})).finally(()=>{!l&&h.data&&(h.data=null),this.commonObjs.resolve(r,h)});break;case"CopyLocalImage":const{imageRef:f}=i;Xr(f,"The imageRef must be defined.");for(const p of m(this,fc).values())for(const[,g]of p.objs)if((g==null?void 0:g.ref)===f)return g.dataLen?(this.commonObjs.resolve(r,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(r,i);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([r,s,i,o])=>{var l;if(this.destroyed)return;const a=m(this,fc).get(s);if(!a.objs.has(r)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(i){case"Image":a.objs.resolve(r,o),(o==null?void 0:o.dataLen)>jCe&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(r,o);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",r=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:r.loaded,total:r.total})}),e.on("FetchBuiltInCMap",async r=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(r)}),e.on("FetchStandardFontData",async r=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(r)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var r;this.annotationStorage.size<=0&&Lt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((r=this._fullReader)==null?void 0:r.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,r=m(this,Og).get(t);if(r)return r;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&m(this,Fg).set(i.refStr,e);const o=new iIe(t,i,this,this._params.pdfBug);return m(this,fc).set(t,o),o});return m(this,Og).set(t,s),s}getPageIndex(e){return Vz(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return B(this,Dp,lx).call(this,"GetFieldObjects")}hasJSActions(){return B(this,Dp,lx).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return B(this,Dp,lx).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return B(this,Dp,lx).call(this,"GetOptionalContentConfig").then(t=>new NNe(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=m(this,_u).get(e);if(t)return t;const r=this.messageHandler.sendWithPromise(e,null).then(s=>{var i,o;return{info:s[0],metadata:s[1]?new ENe(s[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return m(this,_u).set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of m(this,fc).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),m(this,_u).clear(),this.filterFactory.destroy(!0),qb.cleanup()}}cachedPageNumber(e){if(!Vz(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return m(this,Fg).get(t)??null}}_u=new WeakMap,fc=new WeakMap,Og=new WeakMap,Fg=new WeakMap,Su=new WeakMap,Dp=new WeakSet,lx=function(e,t=null){const r=m(this,_u).get(e);if(r)return r;const s=this.messageHandler.sendWithPromise(e,t);return m(this,_u).set(e,s),s};const Py=Symbol("INITIAL_DATA");var Ho,jv,FN;class hQ{constructor(){z(this,jv);z(this,Ho,Object.create(null))}get(e,t=null){if(t){const s=B(this,jv,FN).call(this,e);return s.promise.then(()=>t(s.data)),null}const r=m(this,Ho)[e];if(!r||r.data===Py)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){const t=m(this,Ho)[e];return!!t&&t.data!==Py}delete(e){const t=m(this,Ho)[e];return!t||t.data===Py?!1:(delete m(this,Ho)[e],!0)}resolve(e,t=null){const r=B(this,jv,FN).call(this,e);r.data=t,r.resolve()}clear(){var e;for(const t in m(this,Ho)){const{data:r}=m(this,Ho)[t];(e=r==null?void 0:r.bitmap)==null||e.close()}L(this,Ho,Object.create(null))}*[Symbol.iterator](){for(const e in m(this,Ho)){const{data:t}=m(this,Ho)[e];t!==Py&&(yield[e,t])}}}Ho=new WeakMap,jv=new WeakSet,FN=function(e){var t;return(t=m(this,Ho))[e]||(t[e]={...Promise.withResolvers(),data:Py})};var uh;class lIe{constructor(e){z(this,uh,null);L(this,uh,e),this.onContinue=null}get promise(){return m(this,uh).capability.promise}cancel(e=0){m(this,uh).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=m(this,uh).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=m(this,uh);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}uh=new WeakMap;var dh,jp;const Wf=class Wf{constructor({callback:e,params:t,objs:r,commonObjs:s,annotationCanvasMap:i,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:u=!1,pdfBug:h=!1,pageColors:f=null}){z(this,dh,null);this.callback=e,this.params=t,this.objs=r,this.commonObjs=s,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new lIe(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(m(Wf,jp).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");m(Wf,jp).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:s,transform:i,background:o}=this.params;this.gfx=new lg(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var r;this.running=!1,this.cancelled=!0,(r=this.gfx)==null||r.endDrawing(),m(this,dh)&&(window.cancelAnimationFrame(m(this,dh)),L(this,dh,null)),m(Wf,jp).delete(this._canvas),this.callback(e||new cM(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?L(this,dh,window.requestAnimationFrame(()=>{L(this,dh,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),m(Wf,jp).delete(this._canvas),this.callback())))}};dh=new WeakMap,jp=new WeakMap,z(Wf,jp,new WeakSet);let zN=Wf;const cIe="4.10.38",uIe="f9bea397f";function Uz(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Ly(n){return Math.max(0,Math.min(255,255*n))}class Hz{static CMYK_G([e,t,r,s]){return["G",1-Math.min(1,.3*e+.59*r+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Ly(e),[e,e,e]}static G_HTML([e]){const t=Uz(e);return`#${t}${t}${t}`}static RGB_G([e,t,r]){return["G",.3*e+.59*t+.11*r]}static RGB_rgb(e){return e.map(Ly)}static RGB_HTML(e){return`#${e.map(Uz).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,r,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,r+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,r,s]){return[Ly(1-Math.min(1,e+s)),Ly(1-Math.min(1,r+s)),Ly(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,r]){const s=1-e,i=1-t,o=1-r,a=Math.min(s,i,o);return["CMYK",s,i,o,a]}}class dIe{create(e,t,r=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),r||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){zn("Abstract method `_createSVG` called.")}}class mM extends dIe{_createSVG(e){return document.createElementNS(nu,e)}}class fQ{static setupStorage(e,t,r,s,i){const o=s.getValue(t,{value:null});switch(r.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),i==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(r.attributes.type==="radio"||r.attributes.type==="checkbox"){if(o.value===r.attributes.xfaOn?e.setAttribute("checked",!0):o.value===r.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),i==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of r.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:r=null,intent:s,linkService:i}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(const[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&i.addLinkAttributes(e,o.href,o.newWindow),r&&o.dataId&&this.setupStorage(e,o.dataId,t,r)}static render(e){var h,f;const t=e.annotationStorage,r=e.linkService,s=e.xfaHtml,i=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:i,linkService:r});const a=i!=="richText",l=e.div;if(l.append(o),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=p}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(s.children.length===0){if(s.value){const p=document.createTextNode(s.value);o.append(p),a&&Gb.shouldBuildText(s.name)&&c.push(p)}return{textDivs:c}}const u=[[s,-1,o]];for(;u.length>0;){const[p,g,y]=u.at(-1);if(g+1===p.children.length){u.pop();continue}const v=p.children[++u.at(-1)[1]];if(v===null)continue;const{name:b}=v;if(b==="#text"){const k=document.createTextNode(v.value);c.push(k),y.append(k);continue}const w=(h=v==null?void 0:v.attributes)!=null&&h.xmlns?document.createElementNS(v.attributes.xmlns,b):document.createElement(b);if(y.append(w),v.attributes&&this.setAttributes({html:w,element:v,storage:t,intent:i,linkService:r}),((f=v.children)==null?void 0:f.length)>0)u.push([v,-1,w]);else if(v.value){const k=document.createTextNode(v.value);a&&Gb.shouldBuildText(b)&&c.push(k),w.append(k)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const d2=1e3,hIe=9,z0=new WeakSet;function Xh(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class fIe{static create(e){switch(e.data.annotationType){case us.LINK:return new pQ(e);case us.TEXT:return new pIe(e);case us.WIDGET:switch(e.data.fieldType){case"Tx":return new mIe(e);case"Btn":return e.data.radioButton?new yQ(e):e.data.checkBox?new yIe(e):new xIe(e);case"Ch":return new bIe(e);case"Sig":return new gIe(e)}return new rm(e);case us.POPUP:return new $N(e);case us.FREETEXT:return new kQ(e);case us.LINE:return new wIe(e);case us.SQUARE:return new kIe(e);case us.CIRCLE:return new _Ie(e);case us.POLYLINE:return new _Q(e);case us.CARET:return new TIe(e);case us.INK:return new gM(e);case us.POLYGON:return new SIe(e);case us.HIGHLIGHT:return new SQ(e);case us.UNDERLINE:return new AIe(e);case us.SQUIGGLY:return new EIe(e);case us.STRIKEOUT:return new CIe(e);case us.STAMP:return new TQ(e);case us.FILEATTACHMENT:return new NIe(e);default:return new Hr(e)}}}var Op,zg,Bg,Ov,BN;const vM=class vM{constructor(e,{isRenderable:t=!1,ignoreBorder:r=!1,createQuadrilaterals:s=!1}={}){z(this,Ov);z(this,Op,null);z(this,zg,!1);z(this,Bg,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(r)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:r}){return!!(e!=null&&e.str||t!=null&&t.str||r!=null&&r.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return vM._hasPopupData(this.data)}updateEdited(e){var r;if(!this.container)return;m(this,Op)||L(this,Op,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&B(this,Ov,BN).call(this,t),(r=m(this,Bg))==null||r.popup.updateEdited(e)}resetEdited(){var e;m(this,Op)&&(B(this,Ov,BN).call(this,m(this,Op).rect),(e=m(this,Bg))==null||e.popup.resetEdited(),L(this,Op,null))}_createContainer(e){const{data:t,parent:{page:r,viewport:s}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof rm||(i.tabIndex=d2);const{style:o}=i;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof $N){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,i),i}const{width:a,height:l}=Xh(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,v=t.borderStyle.verticalCornerRadius;if(y>0||v>0){const w=`calc(${y}px * var(--scale-factor)) / calc(${v}px * var(--scale-factor))`;o.borderRadius=w}else if(this instanceof yQ){const w=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=w}switch(t.borderStyle.style){case Ry.SOLID:o.borderStyle="solid";break;case Ry.DASHED:o.borderStyle="dashed";break;case Ry.BEVELED:Lt("Unimplemented border style: beveled");break;case Ry.INSET:Lt("Unimplemented border style: inset");break;case Ry.UNDERLINE:o.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(L(this,zg,!0),o.borderColor=Je.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):o.borderWidth=0}const c=Je.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]),{pageWidth:u,pageHeight:h,pageX:f,pageY:p}=s.rawDims;o.left=`${100*(c[0]-f)/u}%`,o.top=`${100*(c[1]-p)/h}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(o.width=`${100*a/u}%`,o.height=`${100*l/h}%`):this.setRotation(g,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:r,pageHeight:s}=this.parent.viewport.rawDims,{width:i,height:o}=Xh(this.data.rect);let a,l;e%180===0?(a=100*i/r,l=100*o/s):(a=100*o/r,l=100*i/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,r,s)=>{const i=s.detail[t],o=i[0],a=i.slice(1);s.target.style[r]=Hz[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[r]:Hz[`${o}_rgb`](a)})};return Ht(this,"_commonActions",{display:t=>{const{display:r}=t.detail,s=r%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:r===1||r===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:r}=t.detail;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:r,noView:r})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const r=t.detail.rotation;this.setRotation(r),this.annotationStorage.setValue(this.data.id,{rotation:r})}})}_dispatchEventFromSandbox(e,t){const r=this._commonActions;for(const s of Object.keys(t.detail)){const i=e[s]||r[s];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const r=this._commonActions;for(const[s,i]of Object.entries(t)){const o=r[s];if(o){const a={detail:{[s]:i},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,r,s,i]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,v,b,w]=e.subarray(2,6);if(s===y&&i===v&&t===b&&r===w)return}const{style:o}=this.container;let a;if(m(this,zg)){const{borderColor:y,borderWidth:v}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const l=s-t,c=i-r,{svgFactory:u}=this,h=u.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0);const f=u.createElement("defs");h.append(f);const p=u.createElement("clipPath"),g=`clippath_${this.data.id}`;p.setAttribute("id",g),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let y=2,v=e.length;y<v;y+=8){const b=e[y],w=e[y+1],k=e[y+2],T=e[y+3],R=u.createElement("rect"),M=(k-t)/l,E=(i-w)/c,I=(b-k)/l,S=(w-T)/c;R.setAttribute("x",M),R.setAttribute("y",E),R.setAttribute("width",I),R.setAttribute("height",S),p.append(R),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${E}" width="${I}" height="${S}"/>`)}m(this,zg)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=L(this,Bg,new $N({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){zn("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const r=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:i,id:o,exportValues:a}of s){if(i===-1||o===t)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!z0.has(c)){Lt(`_getElementsByName - element not allowed: ${o}`);continue}r.push({id:o,exportValue:l,domElement:c})}return r}for(const s of document.getElementsByName(e)){const{exportValue:i}=s,o=s.getAttribute("data-element-id");o!==t&&z0.has(s)&&r.push({id:o,exportValue:i,domElement:s})}return r}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var r;(r=this.linkService.eventBus)==null||r.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};Op=new WeakMap,zg=new WeakMap,Bg=new WeakMap,Ov=new WeakSet,BN=function(e){const{container:{style:t},data:{rect:r,rotation:s},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:o,pageX:a,pageY:l}}}}=this;r==null||r.splice(0,4,...e);const{width:c,height:u}=Xh(e);t.left=`${100*(e[0]-a)/i}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*c/i}%`,t.height=`${100*u/o}%`):this.setRotation(s)};let Hr=vM;var ta,$f,mQ,gQ;class pQ extends Hr{constructor(t,r=null){super(t,{isRenderable:!0,ignoreBorder:!!(r!=null&&r.ignoreBorder),createQuadrilaterals:!0});z(this,ta);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:r}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(r.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action),i=!0):t.attachment?(B(this,ta,mQ).call(this,s,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(B(this,ta,gQ).call(this,s,t.setOCGState),i=!0):t.dest?(this._bindLink(s,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}_bindLink(t,r){t.href=this.linkService.getDestinationHash(r),t.onclick=()=>(r&&this.linkService.goToDestination(r),!1),(r||r==="")&&B(this,ta,$f).call(this)}_bindNamedAction(t,r){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(r),!1),B(this,ta,$f).call(this)}_bindJSAction(t,r){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(r.actions)){const o=s.get(i);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),B(this,ta,$f).call(this)}_bindResetFormAction(t,r){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),B(this,ta,$f).call(this),!this._fieldObjects){Lt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var h;s==null||s();const{fields:i,refs:o,include:a}=r,l=[];if(i.length!==0||o.length!==0){const f=new Set(o);for(const p of i){const g=this._fieldObjects[p]||[];for(const{id:y}of g)f.add(y)}for(const p of Object.values(this._fieldObjects))for(const g of p)f.has(g.id)===a&&l.push(g)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const c=this.annotationStorage,u=[];for(const f of l){const{id:p}=f;switch(u.push(p),f.type){case"text":{const y=f.defaultValue||"";c.setValue(p,{value:y});break}case"checkbox":case"radiobutton":{const y=f.defaultValue===f.exportValues;c.setValue(p,{value:y});break}case"combobox":case"listbox":{const y=f.defaultValue||"";c.setValue(p,{value:y});break}default:continue}const g=document.querySelector(`[data-element-id="${p}"]`);if(g){if(!z0.has(g)){Lt(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}ta=new WeakSet,$f=function(){this.container.setAttribute("data-internal-link","")},mQ=function(t,r,s=null){t.href=this.linkService.getAnchorUrl(""),r.description&&(t.title=r.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(r.content,r.filename,s),!1},B(this,ta,$f).call(this)},gQ=function(t,r){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(r),!1),B(this,ta,$f).call(this)};class pIe extends Hr{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class rm extends Hr{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Qi.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,r,s,i){r.includes("mouse")?e.addEventListener(r,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:i(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(r,o=>{var a;if(r==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(r==="focus"){if(t.focused)return;t.focused=!0}i&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:i(o)}}))})}_setEventListeners(e,t,r,s){var i,o,a;for(const[l,c]of r)(c==="Action"||(i=this.data.actions)!=null&&i[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,s),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Je.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:r}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||hIe,i=e.style;let o;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(c/(oE*s))||1,h=c/u;o=Math.min(s,l(h/oE))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(c/oE))}i.fontSize=`calc(${o}px * var(--scale-factor))`,i.color=Je.makeHexColor(r[0],r[1],r[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class mIe extends rm{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,r,s){const i=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=r),i.setValue(o.id,{[s]:r})}render(){var s,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let a=o.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const u={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(r=document.createElement("textarea"),r.textContent=c??a,this.data.doNotScroll&&(r.style.overflowY="hidden")):(r=document.createElement("input"),r.type="text",r.setAttribute("value",c??a),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),z0.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,r.name=this.data.fieldName,r.tabIndex=d2,this._setRequired(r,this.data.required),l&&(r.maxLength=l),r.addEventListener("input",f=>{e.setValue(t,{value:f.target.value}),this.setPropertyOnSiblings(r,"value",f.target.value,"value"),u.formattedValue=null}),r.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";r.value=u.userValue=p,u.formattedValue=null});let h=f=>{const{formattedValue:p}=u;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",p=>{var y;if(u.focused)return;const{target:g}=p;u.userValue&&(g.value=u.userValue),u.lastCommittedValue=g.value,u.commitKey=1,(y=this.data.actions)!=null&&y.Focus||(u.focused=!0)}),r.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const g={value(y){u.userValue=y.detail.value??"",e.setValue(t,{value:u.userValue.toString()}),y.target.value=u.userValue},formattedValue(y){const{formattedValue:v}=y.detail;u.formattedValue=v,v!=null&&y.target!==document.activeElement&&(y.target.value=v),e.setValue(t,{formattedValue:v})},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{var k;const{charLimit:v}=y.detail,{target:b}=y;if(v===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",v);let w=u.userValue;!w||w.length<=v||(w=w.slice(0,v),b.value=u.userValue=w,e.setValue(t,{value:w}),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(g,p)}),r.addEventListener("keydown",p=>{var v;u.commitKey=1;let g=-1;if(p.key==="Escape"?g=0:p.key==="Enter"&&!this.data.multiLine?g=2:p.key==="Tab"&&(u.commitKey=3),g===-1)return;const{value:y}=p.target;u.lastCommittedValue!==y&&(u.lastCommittedValue=y,u.userValue=y,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:g,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=h;h=null,r.addEventListener("blur",p=>{var y,v;if(!u.focused||!p.relatedTarget)return;(y=this.data.actions)!=null&&y.Blur||(u.focused=!1);const{value:g}=p.target;u.userValue=g,u.lastCommittedValue!==g&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:u.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(i=this.data.actions)!=null&&i.Keystroke&&r.addEventListener("beforeinput",p=>{var R;u.lastCommittedValue=null;const{data:g,target:y}=p,{value:v,selectionStart:b,selectionEnd:w}=y;let k=b,T=w;switch(p.inputType){case"deleteWordBackward":{const M=v.substring(0,b).match(/\w*[^\w]*$/);M&&(k-=M[0].length);break}case"deleteWordForward":{const M=v.substring(b).match(/^[^\w]*\w*/);M&&(T+=M[0].length);break}case"deleteContentBackward":b===w&&(k-=1);break;case"deleteContentForward":b===w&&(T+=1);break}p.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,change:g||"",willCommit:!1,selStart:k,selEnd:T}})}),this._setEventListeners(r,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(h&&r.addEventListener("blur",h),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/l;r.classList.add("comb"),r.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell",this.data.hasOwnCanvas&&(r.hidden=!0);return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class gIe extends rm{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class yIe extends rm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,r=t.id;let s=e.getValue(r,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(r,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return z0.add(i),i.setAttribute("data-element-id",r),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,s&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=d2,i.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r)){const u=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=u),e.setValue(c.id,{value:u})}e.setValue(r,{value:l})}),i.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(r,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class yQ extends rm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,r=t.id;let s=e.getValue(r,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(r,{value:s})),s)for(const o of this._getElementsByName(t.fieldName,r))e.setValue(o.id,{value:!1});const i=document.createElement("input");if(z0.add(i),i.setAttribute("data-element-id",r),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,s&&i.setAttribute("checked",!0),i.tabIndex=d2,i.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r))e.setValue(c.id,{value:!1});e.setValue(r,{value:l})}),i.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;i.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const u=o===c.detail.value;for(const h of this._getElementsByName(c.target.name)){const f=u&&h.id===r;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class xIe extends pQ{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({},r)})),e}}class bIe extends rm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,r=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");z0.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=d2;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",u=>{const h=this.data.defaultFieldValue;for(const f of s.options)f.selected=f.value===h});for(const u of this.data.options){const h=document.createElement("option");h.textContent=u.displayValue,h.value=u.exportValue,r.value.includes(u.exportValue)&&(h.setAttribute("selected",!0),i=!1),s.append(h)}let o=null;if(i){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),s.prepend(u),o=()=>{u.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}const a=u=>{const h=u?"value":"textContent",{options:f,multiple:p}=s;return p?Array.prototype.filter.call(f,g=>g.selected).map(g=>g[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=a(!1);const c=u=>{const h=u.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",u=>{const h={value(f){o==null||o();const p=f.detail.value,g=new Set(Array.isArray(p)?p:[p]);for(const y of s.options)y.selected=g.has(y.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(f){s.multiple=!0},remove(f){const p=s.options,g=f.detail.remove;p[g].selected=!1,s.remove(g),p.length>0&&Array.prototype.findIndex.call(p,v=>v.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(f){const{index:p,displayValue:g,exportValue:y}=f.detail.insert,v=s.children[p],b=document.createElement("option");b.textContent=g,b.value=y,v?v.before(b):s.append(b),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:p}=f.detail;for(;s.length!==0;)s.remove(0);for(const g of p){const{displayValue:y,exportValue:v}=g,b=document.createElement("option");b.textContent=y,b.value=v,s.append(b)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const g of f.target.options)g.selected=p.has(g.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,u)}),s.addEventListener("input",u=>{var p;const h=a(!0),f=a(!1);e.setValue(t,{value:h}),u.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):s.addEventListener("input",function(u){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class $N extends Hr{constructor(e){const{data:t,elements:r}=e;super(e,{isRenderable:Hr._hasPopupData(t)}),this.elements=r,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new vIe({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const r of this.elements)r.popup=e,r.container.ariaHasPopup="dialog",t.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(r=>`${lM}${r}`).join(",")),this.container}}var $g,Q5,Z5,Vg,Fp,Ir,Tu,Ug,Fv,zv,Hg,Au,xl,Eu,Bv,Cu,$v,zp,Bp,Pn,xk,VN,xQ,bQ,vQ,wQ,bk,vk,UN;class vIe{constructor({container:e,color:t,elements:r,titleObj:s,modificationDate:i,contentsObj:o,richText:a,parent:l,rect:c,parentRect:u,open:h}){z(this,Pn);z(this,$g,B(this,Pn,vQ).bind(this));z(this,Q5,B(this,Pn,UN).bind(this));z(this,Z5,B(this,Pn,vk).bind(this));z(this,Vg,B(this,Pn,bk).bind(this));z(this,Fp,null);z(this,Ir,null);z(this,Tu,null);z(this,Ug,null);z(this,Fv,null);z(this,zv,null);z(this,Hg,null);z(this,Au,!1);z(this,xl,null);z(this,Eu,null);z(this,Bv,null);z(this,Cu,null);z(this,$v,null);z(this,zp,null);z(this,Bp,!1);var f;L(this,Ir,e),L(this,$v,s),L(this,Tu,o),L(this,Cu,a),L(this,zv,l),L(this,Fp,t),L(this,Bv,c),L(this,Hg,u),L(this,Fv,r),L(this,Ug,dM.toDateObject(i)),this.trigger=r.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",m(this,Vg)),p.addEventListener("mouseenter",m(this,Z5)),p.addEventListener("mouseleave",m(this,Q5)),p.classList.add("popupTriggerArea");for(const p of r)(f=p.container)==null||f.addEventListener("keydown",m(this,$g));m(this,Ir).hidden=!0,h&&B(this,Pn,bk).call(this)}render(){if(m(this,xl))return;const e=L(this,xl,document.createElement("div"));if(e.className="popup",m(this,Fp)){const i=e.style.outlineColor=Je.makeHexColor(...m(this,Fp));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`:e.style.backgroundColor=Je.makeHexColor(...m(this,Fp).map(a=>Math.floor(.7*(255-a)+a)))}const t=document.createElement("span");t.className="header";const r=document.createElement("h1");if(t.append(r),{dir:r.dir,str:r.textContent}=m(this,$v),e.append(t),m(this,Ug)){const i=document.createElement("span");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:m(this,Ug).valueOf()})),t.append(i)}const s=m(this,Pn,xk);if(s)fQ.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(m(this,Tu));e.append(i)}m(this,Ir).append(e)}_formatContents({str:e,dir:t}){const r=document.createElement("p");r.classList.add("popupContent"),r.dir=t;const s=e.split(/(?:\r\n?|\n)/);for(let i=0,o=s.length;i<o;++i){const a=s[i];r.append(document.createTextNode(a)),i<o-1&&r.append(document.createElement("br"))}return r}updateEdited({rect:e,popupContent:t}){var r;m(this,zp)||L(this,zp,{contentsObj:m(this,Tu),richText:m(this,Cu)}),e&&L(this,Eu,null),t&&(L(this,Cu,B(this,Pn,bQ).call(this,t)),L(this,Tu,null)),(r=m(this,xl))==null||r.remove(),L(this,xl,null)}resetEdited(){var e;m(this,zp)&&({contentsObj:Pi(this,Tu)._,richText:Pi(this,Cu)._}=m(this,zp),L(this,zp,null),(e=m(this,xl))==null||e.remove(),L(this,xl,null),L(this,Eu,null))}forceHide(){L(this,Bp,this.isVisible),m(this,Bp)&&(m(this,Ir).hidden=!0)}maybeShow(){m(this,Bp)&&(m(this,xl)||B(this,Pn,vk).call(this),L(this,Bp,!1),m(this,Ir).hidden=!1)}get isVisible(){return m(this,Ir).hidden===!1}}$g=new WeakMap,Q5=new WeakMap,Z5=new WeakMap,Vg=new WeakMap,Fp=new WeakMap,Ir=new WeakMap,Tu=new WeakMap,Ug=new WeakMap,Fv=new WeakMap,zv=new WeakMap,Hg=new WeakMap,Au=new WeakMap,xl=new WeakMap,Eu=new WeakMap,Bv=new WeakMap,Cu=new WeakMap,$v=new WeakMap,zp=new WeakMap,Bp=new WeakMap,Pn=new WeakSet,xk=function(){const e=m(this,Cu),t=m(this,Tu);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&m(this,Cu).html||null},VN=function(){var e,t,r;return((r=(t=(e=m(this,Pn,xk))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:r.fontSize)||0},xQ=function(){var e,t,r;return((r=(t=(e=m(this,Pn,xk))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:r.color)||null},bQ=function(e){const t=[],r={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:m(this,Pn,xQ),fontSize:m(this,Pn,VN)?`calc(${m(this,Pn,VN)}px * var(--scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:s});return r},vQ=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&m(this,Au))&&B(this,Pn,bk).call(this)},wQ=function(){if(m(this,Eu)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:r,pageX:s,pageY:i}}}=m(this,zv);let o=!!m(this,Hg),a=o?m(this,Hg):m(this,Bv);for(const g of m(this,Fv))if(!a||Je.intersect(g.data.rect,a)!==null){a=g.data.rect,o=!0;break}const l=Je.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),u=o?a[2]-a[0]+5:0,h=l[0]+u,f=l[1];L(this,Eu,[100*(h-s)/t,100*(f-i)/r]);const{style:p}=m(this,Ir);p.left=`${m(this,Eu)[0]}%`,p.top=`${m(this,Eu)[1]}%`},bk=function(){L(this,Au,!m(this,Au)),m(this,Au)?(B(this,Pn,vk).call(this),m(this,Ir).addEventListener("click",m(this,Vg)),m(this,Ir).addEventListener("keydown",m(this,$g))):(B(this,Pn,UN).call(this),m(this,Ir).removeEventListener("click",m(this,Vg)),m(this,Ir).removeEventListener("keydown",m(this,$g)))},vk=function(){m(this,xl)||this.render(),this.isVisible?m(this,Au)&&m(this,Ir).classList.add("focused"):(B(this,Pn,wQ).call(this),m(this,Ir).hidden=!1,m(this,Ir).style.zIndex=parseInt(m(this,Ir).style.zIndex)+1e3)},UN=function(){m(this,Ir).classList.remove("focused"),!(m(this,Au)||!this.isVisible)&&(m(this,Ir).hidden=!0,m(this,Ir).style.zIndex=parseInt(m(this,Ir).style.zIndex)-1e3)};class kQ extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Pt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const r=document.createElement("span");r.textContent=t,e.append(r)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Vv;class wIe extends Hr{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});z(this,Vv,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:r,height:s}=Xh(t.rect),i=this.svgFactory.create(r,s,!0),o=L(this,Vv,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return m(this,Vv)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vv=new WeakMap;var Uv;class kIe extends Hr{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});z(this,Uv,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:r,height:s}=Xh(t.rect),i=this.svgFactory.create(r,s,!0),o=t.borderStyle.width,a=L(this,Uv,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",r-o),a.setAttribute("height",s-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return m(this,Uv)}addHighlightArea(){this.container.classList.add("highlightArea")}}Uv=new WeakMap;var Hv;class _Ie extends Hr{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});z(this,Hv,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:r,height:s}=Xh(t.rect),i=this.svgFactory.create(r,s,!0),o=t.borderStyle.width,a=L(this,Hv,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",r/2),a.setAttribute("cy",s/2),a.setAttribute("rx",r/2-o/2),a.setAttribute("ry",s/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return m(this,Hv)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hv=new WeakMap;var qv;class _Q extends Hr{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});z(this,qv,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:r,borderStyle:s,popupRef:i}}=this;if(!r)return this.container;const{width:o,height:a}=Xh(t),l=this.svgFactory.create(o,a,!0);let c=[];for(let h=0,f=r.length;h<f;h+=2){const p=r[h]-t[0],g=t[3]-r[h+1];c.push(`${p},${g}`)}c=c.join(" ");const u=L(this,qv,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",c),u.setAttribute("stroke-width",s.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),l.append(u),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return m(this,qv)}addHighlightArea(){this.container.classList.add("highlightArea")}}qv=new WeakMap;class SIe extends _Q{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class TIe extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Gv,$p,Wv,HN;class gM extends Hr{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});z(this,Wv);z(this,Gv,null);z(this,$p,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Pt.HIGHLIGHT:Pt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:r,inkLists:s,borderStyle:i,popupRef:o}}=this,{transform:a,width:l,height:c}=B(this,Wv,HN).call(this,r,t),u=this.svgFactory.create(l,c,!0),h=L(this,Gv,this.svgFactory.createElement("svg:g"));u.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let f=0,p=s.length;f<p;f++){const g=this.svgFactory.createElement(this.svgElementName);m(this,$p).push(g),g.setAttribute("points",s[f].join(",")),h.append(g)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:r,points:s,rect:i}=t,o=m(this,Gv);if(r>=0&&o.setAttribute("stroke-width",r||1),s)for(let a=0,l=m(this,$p).length;a<l;a++)m(this,$p)[a].setAttribute("points",s[a].join(","));if(i){const{transform:a,width:l,height:c}=B(this,Wv,HN).call(this,this.data.rotation,i);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return m(this,$p)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gv=new WeakMap,$p=new WeakMap,Wv=new WeakSet,HN=function(t,r){switch(t){case 90:return{transform:`rotate(90) translate(${-r[0]},${r[1]}) scale(1,-1)`,width:r[3]-r[1],height:r[2]-r[0]};case 180:return{transform:`rotate(180) translate(${-r[2]},${r[1]}) scale(1,-1)`,width:r[2]-r[0],height:r[3]-r[1]};case 270:return{transform:`rotate(270) translate(${-r[2]},${r[3]}) scale(1,-1)`,width:r[3]-r[1],height:r[2]-r[0]};default:return{transform:`translate(${-r[0]},${r[3]}) scale(1,-1)`,width:r[2]-r[0],height:r[3]-r[1]}}};class SQ extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Pt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class AIe extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class EIe extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class CIe extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class TQ extends Hr{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Pt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Kv,Yv,qN;class NIe extends Hr{constructor(t){var s;super(t,{isRenderable:!0});z(this,Yv);z(this,Kv,null);const{file:r}=this.data;this.filename=r.filename,this.content=r.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...r})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:r}=this;let s;r.hasAppearance||r.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(r.name)?"paperclip":"pushpin"}.svg`,r.fillAlpha&&r.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(r.fillAlpha*100)}%);`)),s.addEventListener("dblclick",B(this,Yv,qN).bind(this)),L(this,Kv,s);const{isMac:i}=Qi.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(i?o.metaKey:o.ctrlKey)&&B(this,Yv,qN).call(this)}),!r.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return m(this,Kv)}addHighlightArea(){this.container.classList.add("highlightArea")}}Kv=new WeakMap,Yv=new WeakSet,qN=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Xv,Vp,Up,Jv,B0,AQ,GN;class IIe{constructor({div:e,accessibilityManager:t,annotationCanvasMap:r,annotationEditorUIManager:s,page:i,viewport:o,structTreeLayer:a}){z(this,B0);z(this,Xv,null);z(this,Vp,null);z(this,Up,new Map);z(this,Jv,null);this.div=e,L(this,Xv,t),L(this,Vp,r),L(this,Jv,a||null),this.page=i,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return m(this,Up).size>0}async render(e){var o;const{annotations:t}=e,r=this.div;O0(r,this.viewport);const s=new Map,i={data:null,layer:r,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new mM,annotationStorage:e.annotationStorage||new fM,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===us.POPUP;if(l){const h=s.get(a.id);if(!h)continue;i.elements=h}else{const{width:h,height:f}=Xh(a.rect);if(h<=0||f<=0)continue}i.data=a;const c=fIe.create(i);if(!c.isRenderable)continue;if(!l&&a.popupRef){const h=s.get(a.popupRef);h?h.push(c):s.set(a.popupRef,[c])}const u=c.render();a.hidden&&(u.style.visibility="hidden"),await B(this,B0,AQ).call(this,u,a.id),c._isEditable&&(m(this,Up).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}B(this,B0,GN).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,O0(t,{rotation:e.rotation}),B(this,B0,GN).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(m(this,Up).values())}getEditableAnnotation(e){return m(this,Up).get(e)}}Xv=new WeakMap,Vp=new WeakMap,Up=new WeakMap,Jv=new WeakMap,B0=new WeakSet,AQ=async function(e,t){var o,a;const r=e.firstChild||e,s=r.id=`${lM}${t}`,i=await((o=m(this,Jv))==null?void 0:o.getAriaAttributes(s));if(i)for(const[l,c]of i)r.setAttribute(l,c);this.div.append(e),(a=m(this,Xv))==null||a.moveElementInDOM(this.div,e,r,!1)},GN=function(){if(!m(this,Vp))return;const e=this.div;for(const[t,r]of m(this,Vp)){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;r.className="annotationContent";const{firstChild:i}=s;i?i.nodeName==="CANVAS"?i.replaceWith(r):i.classList.contains("annotationContent")?i.after(r):i.before(r):s.append(r)}m(this,Vp).clear()};const k4=/\r\n?|\n/g;var bl,qo,Qv,Hp,Go,es,EQ,CQ,NQ,wk,Yu,kk,_k,IQ,KN,RQ;const Un=class Un extends xr{constructor(t){super({...t,name:"freeTextEditor"});z(this,es);z(this,bl);z(this,qo,"");z(this,Qv,`${this.id}-editor`);z(this,Hp,null);z(this,Go);L(this,bl,t.color||Un._defaultColor||xr._defaultLineColor),L(this,Go,t.fontSize||Un._defaultFontSize)}static get _keyboardManager(){const t=Un.prototype,r=o=>o.isEmpty(),s=F0.TRANSLATE_SMALL,i=F0.TRANSLATE_BIG;return Ht(this,"_keyboardManager",new u2([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:r}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:r}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:r}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:r}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:r}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:r}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:r}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:r}]]))}static initialize(t,r){xr.initialize(t,r);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,r){switch(t){case rn.FREETEXT_SIZE:Un._defaultFontSize=r;break;case rn.FREETEXT_COLOR:Un._defaultColor=r;break}}updateParams(t,r){switch(t){case rn.FREETEXT_SIZE:B(this,es,EQ).call(this,r);break;case rn.FREETEXT_COLOR:B(this,es,CQ).call(this,r);break}}static get defaultPropertiesToUpdate(){return[[rn.FREETEXT_SIZE,Un._defaultFontSize],[rn.FREETEXT_COLOR,Un._defaultColor||xr._defaultLineColor]]}get propertiesToUpdate(){return[[rn.FREETEXT_SIZE,m(this,Go)],[rn.FREETEXT_COLOR,m(this,bl)]]}_translateEmpty(t,r){this._uiManager.translateSelectedEditors(t,r,!0)}getInitialTranslation(){const t=this.parentScale;return[-Un._internalPadding*t,-(Un._internalPadding+m(this,Go))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Pt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),L(this,Hp,new AbortController);const t=this._uiManager.combinedSignal(m(this,Hp));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",m(this,Qv)),this._isDraggable=!0,(t=m(this,Hp))==null||t.abort(),L(this,Hp,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var r;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(r=this._initialOptions)!=null&&r.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=m(this,qo),r=L(this,qo,B(this,es,NQ).call(this).trimEnd());if(t===r)return;const s=i=>{if(L(this,qo,i),!i){this.remove();return}B(this,es,_k).call(this),this._uiManager.rebuild(this),B(this,es,wk).call(this)};this.addCommands({cmd:()=>{s(r)},undo:()=>{s(t)},mustExec:!1}),B(this,es,wk).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Un._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,r;this.width&&(t=this.x,r=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",m(this,Qv)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${m(this,Go)}px * var(--scale-factor))`,s.color=m(this,bl),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),P5(this,this.div,["dblclick","keydown"]),this.width){const[i,o]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[u,h]=this.pageDimensions,[f,p]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(a[0]-f)/u,y=r+this.height-(a[1]-p)/h;break;case 90:g=t+(a[0]-f)/u,y=r-(a[1]-p)/h,[l,c]=[c,-l];break;case 180:g=t-this.width+(a[0]-f)/u,y=r-(a[1]-p)/h,[l,c]=[-l,-c];break;case 270:g=t+(a[0]-f-this.height*h)/u,y=r+(a[1]-p-this.width*u)/h,[l,c]=[-c,l];break}this.setAt(g*i,y*o,l,c)}else this.setAt(t*i,r*o,this.width*i,this.height*o);B(this,es,_k).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var g,y,v;const r=t.clipboardData||window.clipboardData,{types:s}=r;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=B(g=Un,Yu,KN).call(g,r.getData("text")||"").replaceAll(k4,`
`);if(!i)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const a=o.getRangeAt(0);if(!i.includes(`
`)){a.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:l,startOffset:c}=a,u=[],h=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(h.push(l.nodeValue.slice(c).replaceAll(k4,"")),b!==this.editorDiv){let w=u;for(const k of this.editorDiv.childNodes){if(k===b){w=h;continue}w.push(B(y=Un,Yu,kk).call(y,k))}}u.push(l.nodeValue.slice(0,c).replaceAll(k4,""))}else if(l===this.editorDiv){let b=u,w=0;for(const k of this.editorDiv.childNodes)w++===c&&(b=h),b.push(B(v=Un,Yu,kk).call(v,k))}L(this,qo,`${u.join(`
`)}${i}${h.join(`
`)}`),B(this,es,_k).call(this);const f=new Range;let p=u.reduce((b,w)=>b+w.length,0);for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const w=b.nodeValue.length;if(p<=w){f.setStart(b,p),f.setEnd(b,p);break}p-=w}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,r,s){var a;let i=null;if(t instanceof kQ){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:u,rotation:h,id:f,popupRef:p},textContent:g,textPosition:y,parent:{page:{pageNumber:v}}}=t;if(!g||g.length===0)return null;i=t={annotationType:Pt.FREETEXT,color:Array.from(c),fontSize:l,value:g.join(`
`),position:y,pageIndex:v-1,rect:u.slice(0),rotation:h,id:f,deleted:!1,popupRef:p}}const o=await super.deserialize(t,r,s);return L(o,Go,t.fontSize),L(o,bl,Je.makeHexColor(...t.color)),L(o,qo,B(a=Un,Yu,KN).call(a,t.value)),o.annotationElementId=t.id||null,o._initialData=i,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r=Un._internalPadding*this.parentScale,s=this.getRect(r,r),i=xr._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:m(this,bl)),o={annotationType:Pt.FREETEXT,color:i,fontSize:m(this,Go),value:B(this,es,IQ).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?o:this.annotationElementId&&!B(this,es,RQ).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){const r=super.renderAnnotationElement(t);if(this.deleted)return r;const{style:s}=r;s.fontSize=`calc(${m(this,Go)}px * var(--scale-factor))`,s.color=m(this,bl),r.replaceChildren();for(const o of m(this,qo).split(`
`)){const a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),r.append(a)}const i=Un._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:m(this,qo)}),r}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};bl=new WeakMap,qo=new WeakMap,Qv=new WeakMap,Hp=new WeakMap,Go=new WeakMap,es=new WeakSet,EQ=function(t){const r=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-m(this,Go))*this.parentScale),L(this,Go,i),B(this,es,wk).call(this)},s=m(this,Go);this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rn.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},CQ=function(t){const r=i=>{L(this,bl,this.editorDiv.style.color=i)},s=m(this,bl);this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rn.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},NQ=function(){var s;const t=[];this.editorDiv.normalize();let r=null;for(const i of this.editorDiv.childNodes)(r==null?void 0:r.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(B(s=Un,Yu,kk).call(s,i)),r=i);return t.join(`
`)},wk=function(){const[t,r]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",i.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/r):(this.width=s.height/t,this.height=s.width/r),this.fixAndSetPosition()},Yu=new WeakSet,kk=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(k4,"")},_k=function(){if(this.editorDiv.replaceChildren(),!!m(this,qo))for(const t of m(this,qo).split(`
`)){const r=document.createElement("div");r.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(r)}},IQ=function(){return m(this,qo).replaceAll(""," ")},KN=function(t){return t.replaceAll(" ","")},RQ=function(t){const{value:r,fontSize:s,color:i,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==r||t.fontSize!==s||t.color.some((a,l)=>a!==i[l])||t.pageIndex!==o},z(Un,Yu),ct(Un,"_freeTextDefaultContent",""),ct(Un,"_internalPadding",0),ct(Un,"_defaultColor",null),ct(Un,"_defaultFontSize",10),ct(Un,"_type","freetext"),ct(Un,"_editorType",Pt.FREETEXT);let WN=Un;class Ve{toSVGPath(){zn("Abstract method `toSVGPath` must be implemented.")}get box(){zn("Abstract getter `box` must be implemented.")}serialize(e,t){zn("Abstract method `serialize` must be implemented.")}static _rescale(e,t,r,s,i,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=r+e[a+1]*i;return o}static _rescaleAndSwap(e,t,r,s,i,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=r+e[a]*i;return o}static _translate(e,t,r,s){s||(s=new Float32Array(e.length));for(let i=0,o=e.length;i<o;i+=2)s[i]=t+e[i],s[i+1]=r+e[i+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,r,s,i){switch(i){case 90:return[1-t/r,e/s];case 180:return[1-e/r,1-t/s];case 270:return[t/r,1-e/s];default:return[e/r,t/s]}}static _normalizePagePoint(e,t,r){switch(r){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,r,s,i,o){return[(e+5*r)/6,(t+5*s)/6,(5*r+i)/6,(5*s+o)/6,(r+i)/2,(s+o)/2]}}ct(Ve,"PRECISION",1e-4);var Wo,vl,qg,Gg,pc,Ut,qp,Gp,Zv,ew,Wg,Kg,hh,tw,e3,t3,gs,cx,MQ,PQ,LQ,DQ,jQ,OQ;const lu=class lu{constructor({x:e,y:t},r,s,i,o,a=0){z(this,gs);z(this,Wo);z(this,vl,[]);z(this,qg);z(this,Gg);z(this,pc,[]);z(this,Ut,new Float32Array(18));z(this,qp);z(this,Gp);z(this,Zv);z(this,ew);z(this,Wg);z(this,Kg);z(this,hh,[]);L(this,Wo,r),L(this,Kg,i*s),L(this,Gg,o),m(this,Ut).set([NaN,NaN,NaN,NaN,e,t],6),L(this,qg,a),L(this,ew,m(lu,tw)*s),L(this,Zv,m(lu,t3)*s),L(this,Wg,s),m(this,hh).push(e,t)}isEmpty(){return isNaN(m(this,Ut)[8])}add({x:e,y:t}){var S;L(this,qp,e),L(this,Gp,t);const[r,s,i,o]=m(this,Wo);let[a,l,c,u]=m(this,Ut).subarray(8,12);const h=e-c,f=t-u,p=Math.hypot(h,f);if(p<m(this,Zv))return!1;const g=p-m(this,ew),y=g/p,v=y*h,b=y*f;let w=a,k=l;a=c,l=u,c+=v,u+=b,(S=m(this,hh))==null||S.push(e,t);const T=-b/g,R=v/g,M=T*m(this,Kg),E=R*m(this,Kg);return m(this,Ut).set(m(this,Ut).subarray(2,8),0),m(this,Ut).set([c+M,u+E],4),m(this,Ut).set(m(this,Ut).subarray(14,18),12),m(this,Ut).set([c-M,u-E],16),isNaN(m(this,Ut)[6])?(m(this,pc).length===0&&(m(this,Ut).set([a+M,l+E],2),m(this,pc).push(NaN,NaN,NaN,NaN,(a+M-r)/i,(l+E-s)/o),m(this,Ut).set([a-M,l-E],14),m(this,vl).push(NaN,NaN,NaN,NaN,(a-M-r)/i,(l-E-s)/o)),m(this,Ut).set([w,k,a,l,c,u],6),!this.isEmpty()):(m(this,Ut).set([w,k,a,l,c,u],6),Math.abs(Math.atan2(k-l,w-a)-Math.atan2(b,v))<Math.PI/2?([a,l,c,u]=m(this,Ut).subarray(2,6),m(this,pc).push(NaN,NaN,NaN,NaN,((a+c)/2-r)/i,((l+u)/2-s)/o),[a,l,w,k]=m(this,Ut).subarray(14,18),m(this,vl).push(NaN,NaN,NaN,NaN,((w+a)/2-r)/i,((k+l)/2-s)/o),!0):([w,k,a,l,c,u]=m(this,Ut).subarray(0,6),m(this,pc).push(((w+5*a)/6-r)/i,((k+5*l)/6-s)/o,((5*a+c)/6-r)/i,((5*l+u)/6-s)/o,((a+c)/2-r)/i,((l+u)/2-s)/o),[c,u,a,l,w,k]=m(this,Ut).subarray(12,18),m(this,vl).push(((w+5*a)/6-r)/i,((k+5*l)/6-s)/o,((5*a+c)/6-r)/i,((5*l+u)/6-s)/o,((a+c)/2-r)/i,((l+u)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=m(this,pc),t=m(this,vl);if(isNaN(m(this,Ut)[6])&&!this.isEmpty())return B(this,gs,MQ).call(this);const r=[];r.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?r.push(`L${e[s+4]} ${e[s+5]}`):r.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);B(this,gs,LQ).call(this,r);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?r.push(`L${t[s+4]} ${t[s+5]}`):r.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return B(this,gs,PQ).call(this,r),r.join(" ")}newFreeDrawOutline(e,t,r,s,i,o){return new FQ(e,t,r,s,i,o)}getOutlines(){var h;const e=m(this,pc),t=m(this,vl),r=m(this,Ut),[s,i,o,a]=m(this,Wo),l=new Float32Array((((h=m(this,hh))==null?void 0:h.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(m(this,hh)[f]-s)/o,l[f+1]=(m(this,hh)[f+1]-i)/a;if(l[l.length-2]=(m(this,qp)-s)/o,l[l.length-1]=(m(this,Gp)-i)/a,isNaN(r[6])&&!this.isEmpty())return B(this,gs,DQ).call(this,l);const c=new Float32Array(m(this,pc).length+24+m(this,vl).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){c[f]=c[f+1]=NaN;continue}c[f]=e[f],c[f+1]=e[f+1]}u=B(this,gs,OQ).call(this,c,u);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){c[u]=c[u+1]=NaN,u+=2;continue}c[u]=t[f+p],c[u+1]=t[f+p+1],u+=2}return B(this,gs,jQ).call(this,c,u),this.newFreeDrawOutline(c,l,m(this,Wo),m(this,Wg),m(this,qg),m(this,Gg))}};Wo=new WeakMap,vl=new WeakMap,qg=new WeakMap,Gg=new WeakMap,pc=new WeakMap,Ut=new WeakMap,qp=new WeakMap,Gp=new WeakMap,Zv=new WeakMap,ew=new WeakMap,Wg=new WeakMap,Kg=new WeakMap,hh=new WeakMap,tw=new WeakMap,e3=new WeakMap,t3=new WeakMap,gs=new WeakSet,cx=function(){const e=m(this,Ut).subarray(4,6),t=m(this,Ut).subarray(16,18),[r,s,i,o]=m(this,Wo);return[(m(this,qp)+(e[0]-t[0])/2-r)/i,(m(this,Gp)+(e[1]-t[1])/2-s)/o,(m(this,qp)+(t[0]-e[0])/2-r)/i,(m(this,Gp)+(t[1]-e[1])/2-s)/o]},MQ=function(){const[e,t,r,s]=m(this,Wo),[i,o,a,l]=B(this,gs,cx).call(this);return`M${(m(this,Ut)[2]-e)/r} ${(m(this,Ut)[3]-t)/s} L${(m(this,Ut)[4]-e)/r} ${(m(this,Ut)[5]-t)/s} L${i} ${o} L${a} ${l} L${(m(this,Ut)[16]-e)/r} ${(m(this,Ut)[17]-t)/s} L${(m(this,Ut)[14]-e)/r} ${(m(this,Ut)[15]-t)/s} Z`},PQ=function(e){const t=m(this,vl);e.push(`L${t[4]} ${t[5]} Z`)},LQ=function(e){const[t,r,s,i]=m(this,Wo),o=m(this,Ut).subarray(4,6),a=m(this,Ut).subarray(16,18),[l,c,u,h]=B(this,gs,cx).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-r)/i} L${l} ${c} L${u} ${h} L${(a[0]-t)/s} ${(a[1]-r)/i}`)},DQ=function(e){const t=m(this,Ut),[r,s,i,o]=m(this,Wo),[a,l,c,u]=B(this,gs,cx).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-r)/i,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-r)/i,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,(t[16]-r)/i,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-r)/i,(t[15]-s)/o],0),this.newFreeDrawOutline(h,e,m(this,Wo),m(this,Wg),m(this,qg),m(this,Gg))},jQ=function(e,t){const r=m(this,vl);return e.set([NaN,NaN,NaN,NaN,r[4],r[5]],t),t+=6},OQ=function(e,t){const r=m(this,Ut).subarray(4,6),s=m(this,Ut).subarray(16,18),[i,o,a,l]=m(this,Wo),[c,u,h,f]=B(this,gs,cx).call(this);return e.set([NaN,NaN,NaN,NaN,(r[0]-i)/a,(r[1]-o)/l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(s[0]-i)/a,(s[1]-o)/l],t),t+=24},z(lu,tw,8),z(lu,e3,2),z(lu,t3,m(lu,tw)+m(lu,e3));let j5=lu;var Yg,Wp,Nu,nw,Ko,rw,Br,n3,zQ;class FQ extends Ve{constructor(t,r,s,i,o,a){super();z(this,n3);z(this,Yg);z(this,Wp,new Float32Array(4));z(this,Nu);z(this,nw);z(this,Ko);z(this,rw);z(this,Br);L(this,Br,t),L(this,Ko,r),L(this,Yg,s),L(this,rw,i),L(this,Nu,o),L(this,nw,a),this.lastPoint=[NaN,NaN],B(this,n3,zQ).call(this,a);const[l,c,u,h]=m(this,Wp);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-l)/u,t[f+1]=(t[f+1]-c)/h;for(let f=0,p=r.length;f<p;f+=2)r[f]=(r[f]-l)/u,r[f+1]=(r[f+1]-c)/h}toSVGPath(){const t=[`M${m(this,Br)[4]} ${m(this,Br)[5]}`];for(let r=6,s=m(this,Br).length;r<s;r+=6){if(isNaN(m(this,Br)[r])){t.push(`L${m(this,Br)[r+4]} ${m(this,Br)[r+5]}`);continue}t.push(`C${m(this,Br)[r]} ${m(this,Br)[r+1]} ${m(this,Br)[r+2]} ${m(this,Br)[r+3]} ${m(this,Br)[r+4]} ${m(this,Br)[r+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,r,s,i],o){const a=s-t,l=i-r;let c,u;switch(o){case 0:c=Ve._rescale(m(this,Br),t,i,a,-l),u=Ve._rescale(m(this,Ko),t,i,a,-l);break;case 90:c=Ve._rescaleAndSwap(m(this,Br),t,r,a,l),u=Ve._rescaleAndSwap(m(this,Ko),t,r,a,l);break;case 180:c=Ve._rescale(m(this,Br),s,r,-a,l),u=Ve._rescale(m(this,Ko),s,r,-a,l);break;case 270:c=Ve._rescaleAndSwap(m(this,Br),s,i,-a,-l),u=Ve._rescaleAndSwap(m(this,Ko),s,i,-a,-l);break}return{outline:Array.from(c),points:[Array.from(u)]}}get box(){return m(this,Wp)}newOutliner(t,r,s,i,o,a=0){return new j5(t,r,s,i,o,a)}getNewOutline(t,r){const[s,i,o,a]=m(this,Wp),[l,c,u,h]=m(this,Yg),f=o*u,p=a*h,g=s*u+l,y=i*h+c,v=this.newOutliner({x:m(this,Ko)[0]*f+g,y:m(this,Ko)[1]*p+y},m(this,Yg),m(this,rw),t,m(this,nw),r??m(this,Nu));for(let b=2;b<m(this,Ko).length;b+=2)v.add({x:m(this,Ko)[b]*f+g,y:m(this,Ko)[b+1]*p+y});return v.getOutlines()}}Yg=new WeakMap,Wp=new WeakMap,Nu=new WeakMap,nw=new WeakMap,Ko=new WeakMap,rw=new WeakMap,Br=new WeakMap,n3=new WeakSet,zQ=function(t){const r=m(this,Br);let s=r[4],i=r[5],o=s,a=i,l=s,c=i,u=s,h=i;const f=t?Math.max:Math.min;for(let g=6,y=r.length;g<y;g+=6){if(isNaN(r[g]))o=Math.min(o,r[g+4]),a=Math.min(a,r[g+5]),l=Math.max(l,r[g+4]),c=Math.max(c,r[g+5]),h<r[g+5]?(u=r[g+4],h=r[g+5]):h===r[g+5]&&(u=f(u,r[g+4]));else{const v=Je.bezierBoundingBox(s,i,...r.slice(g,g+6));o=Math.min(o,v[0]),a=Math.min(a,v[1]),l=Math.max(l,v[2]),c=Math.max(c,v[3]),h<v[3]?(u=v[2],h=v[3]):h===v[3]&&(u=f(u,v[2]))}s=r[g+4],i=r[g+5]}const p=m(this,Wp);p[0]=o-m(this,Nu),p[1]=a-m(this,Nu),p[2]=l-o+2*m(this,Nu),p[3]=c-a+2*m(this,Nu),this.lastPoint=[u,h]};var sw,iw,fh,wl,eo,BQ,Sk,$Q,VQ,XN;class YN{constructor(e,t=0,r=0,s=!0){z(this,eo);z(this,sw);z(this,iw);z(this,fh,[]);z(this,wl,[]);let i=1/0,o=-1/0,a=1/0,l=-1/0;const c=10**-4;for(const{x:v,y:b,width:w,height:k}of e){const T=Math.floor((v-t)/c)*c,R=Math.ceil((v+w+t)/c)*c,M=Math.floor((b-t)/c)*c,E=Math.ceil((b+k+t)/c)*c,I=[T,M,E,!0],S=[R,M,E,!1];m(this,fh).push(I,S),i=Math.min(i,T),o=Math.max(o,R),a=Math.min(a,M),l=Math.max(l,E)}const u=o-i+2*r,h=l-a+2*r,f=i-r,p=a-r,g=m(this,fh).at(s?-1:-2),y=[g[0],g[2]];for(const v of m(this,fh)){const[b,w,k]=v;v[0]=(b-f)/u,v[1]=(w-p)/h,v[2]=(k-p)/h}L(this,sw,new Float32Array([f,p,u,h])),L(this,iw,y)}getOutlines(){m(this,fh).sort((t,r)=>t[0]-r[0]||t[1]-r[1]||t[2]-r[2]);const e=[];for(const t of m(this,fh))t[3]?(e.push(...B(this,eo,XN).call(this,t)),B(this,eo,$Q).call(this,t)):(B(this,eo,VQ).call(this,t),e.push(...B(this,eo,XN).call(this,t)));return B(this,eo,BQ).call(this,e)}}sw=new WeakMap,iw=new WeakMap,fh=new WeakMap,wl=new WeakMap,eo=new WeakSet,BQ=function(e){const t=[],r=new Set;for(const o of e){const[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),r.add(l),r.add(c)}const s=[];let i;for(;r.size>0;){const o=r.values().next().value;let[a,l,c,u,h]=o;r.delete(o);let f=a,p=l;for(i=[a,c],s.push(i);;){let g;if(r.has(u))g=u;else if(r.has(h))g=h;else break;r.delete(g),[a,l,c,u,h]=g,f!==a&&(i.push(f,p,a,p===l?l:c),f=a),p=p===l?c:l}i.push(f,p)}return new RIe(s,m(this,sw),m(this,iw))},Sk=function(e){const t=m(this,wl);let r=0,s=t.length-1;for(;r<=s;){const i=r+s>>1,o=t[i][0];if(o===e)return i;o<e?r=i+1:s=i-1}return s+1},$Q=function([,e,t]){const r=B(this,eo,Sk).call(this,e);m(this,wl).splice(r,0,[e,t])},VQ=function([,e,t]){const r=B(this,eo,Sk).call(this,e);for(let s=r;s<m(this,wl).length;s++){const[i,o]=m(this,wl)[s];if(i!==e)break;if(i===e&&o===t){m(this,wl).splice(s,1);return}}for(let s=r-1;s>=0;s--){const[i,o]=m(this,wl)[s];if(i!==e)break;if(i===e&&o===t){m(this,wl).splice(s,1);return}}},XN=function(e){const[t,r,s]=e,i=[[t,r,s]],o=B(this,eo,Sk).call(this,s);for(let a=0;a<o;a++){const[l,c]=m(this,wl)[a];for(let u=0,h=i.length;u<h;u++){const[,f,p]=i[u];if(!(c<=f||p<=l)){if(f>=l){if(p>c)i[u][1]=c;else{if(h===1)return[];i.splice(u,1),u--,h--}continue}i[u][2]=l,p>c&&i.push([t,c,p])}}}return i};var ow,Xg;class RIe extends Ve{constructor(t,r,s){super();z(this,ow);z(this,Xg);L(this,Xg,t),L(this,ow,r),this.lastPoint=s}toSVGPath(){const t=[];for(const r of m(this,Xg)){let[s,i]=r;t.push(`M${s} ${i}`);for(let o=2;o<r.length;o+=2){const a=r[o],l=r[o+1];a===s?(t.push(`V${l}`),i=l):l===i&&(t.push(`H${a}`),s=a)}t.push("Z")}return t.join(" ")}serialize([t,r,s,i],o){const a=[],l=s-t,c=i-r;for(const u of m(this,Xg)){const h=new Array(u.length);for(let f=0;f<u.length;f+=2)h[f]=t+u[f]*l,h[f+1]=i-u[f+1]*c;a.push(h)}return a}get box(){return m(this,ow)}get classNamesForOutlining(){return["highlightOutline"]}}ow=new WeakMap,Xg=new WeakMap;class JN extends j5{newFreeDrawOutline(e,t,r,s,i,o){return new MIe(e,t,r,s,i,o)}}class MIe extends FQ{newOutliner(e,t,r,s,i,o=0){return new JN(e,t,r,s,i,o)}}var kl,Kp,Jg,fs,aw,Qg,lw,cw,ph,_l,Zg,uw,Mn,QN,ZN,eI,Vf,UQ,Md;const mo=class mo{constructor({editor:e=null,uiManager:t=null}){z(this,Mn);z(this,kl,null);z(this,Kp,null);z(this,Jg);z(this,fs,null);z(this,aw,!1);z(this,Qg,!1);z(this,lw,null);z(this,cw);z(this,ph,null);z(this,_l,null);z(this,Zg);var r;e?(L(this,Qg,!1),L(this,Zg,rn.HIGHLIGHT_COLOR),L(this,lw,e)):(L(this,Qg,!0),L(this,Zg,rn.HIGHLIGHT_DEFAULT_COLOR)),L(this,_l,(e==null?void 0:e._uiManager)||t),L(this,cw,m(this,_l)._eventBus),L(this,Jg,(e==null?void 0:e.color)||((r=m(this,_l))==null?void 0:r.highlightColors.values().next().value)||"#FFFF98"),m(mo,uw)||L(mo,uw,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Ht(this,"_keyboardManager",new u2([[["Escape","mac+Escape"],mo.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],mo.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],mo.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],mo.prototype._moveToPrevious],[["Home","mac+Home"],mo.prototype._moveToBeginning],[["End","mac+End"],mo.prototype._moveToEnd]]))}renderButton(){const e=L(this,kl,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=m(this,_l)._signal;e.addEventListener("click",B(this,Mn,Vf).bind(this),{signal:t}),e.addEventListener("keydown",B(this,Mn,eI).bind(this),{signal:t});const r=L(this,Kp,document.createElement("span"));return r.className="swatch",r.setAttribute("aria-hidden",!0),r.style.backgroundColor=m(this,Jg),e.append(r),e}renderMainDropdown(){const e=L(this,fs,B(this,Mn,QN).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===m(this,kl)){B(this,Mn,Vf).call(this,e);return}const t=e.target.getAttribute("data-color");t&&B(this,Mn,ZN).call(this,t,e)}_moveToNext(e){var t,r;if(!m(this,Mn,Md)){B(this,Mn,Vf).call(this,e);return}if(e.target===m(this,kl)){(t=m(this,fs).firstChild)==null||t.focus();return}(r=e.target.nextSibling)==null||r.focus()}_moveToPrevious(e){var t,r;if(e.target===((t=m(this,fs))==null?void 0:t.firstChild)||e.target===m(this,kl)){m(this,Mn,Md)&&this._hideDropdownFromKeyboard();return}m(this,Mn,Md)||B(this,Mn,Vf).call(this,e),(r=e.target.previousSibling)==null||r.focus()}_moveToBeginning(e){var t;if(!m(this,Mn,Md)){B(this,Mn,Vf).call(this,e);return}(t=m(this,fs).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!m(this,Mn,Md)){B(this,Mn,Vf).call(this,e);return}(t=m(this,fs).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=m(this,fs))==null||e.classList.add("hidden"),(t=m(this,ph))==null||t.abort(),L(this,ph,null)}_hideDropdownFromKeyboard(){var e;if(!m(this,Qg)){if(!m(this,Mn,Md)){(e=m(this,lw))==null||e.unselect();return}this.hideDropdown(),m(this,kl).focus({preventScroll:!0,focusVisible:m(this,aw)})}}updateColor(e){if(m(this,Kp)&&(m(this,Kp).style.backgroundColor=e),!m(this,fs))return;const t=m(this,_l).highlightColors.values();for(const r of m(this,fs).children)r.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=m(this,kl))==null||e.remove(),L(this,kl,null),L(this,Kp,null),(t=m(this,fs))==null||t.remove(),L(this,fs,null)}};kl=new WeakMap,Kp=new WeakMap,Jg=new WeakMap,fs=new WeakMap,aw=new WeakMap,Qg=new WeakMap,lw=new WeakMap,cw=new WeakMap,ph=new WeakMap,_l=new WeakMap,Zg=new WeakMap,uw=new WeakMap,Mn=new WeakSet,QN=function(){const e=document.createElement("div"),t=m(this,_l)._signal;e.addEventListener("contextmenu",Bl,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[r,s]of m(this,_l).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",s),i.title=r,i.setAttribute("data-l10n-id",m(mo,uw)[r]);const o=document.createElement("span");i.append(o),o.className="swatch",o.style.backgroundColor=s,i.setAttribute("aria-selected",s===m(this,Jg)),i.addEventListener("click",B(this,Mn,ZN).bind(this,s),{signal:t}),e.append(i)}return e.addEventListener("keydown",B(this,Mn,eI).bind(this),{signal:t}),e},ZN=function(e,t){t.stopPropagation(),m(this,cw).dispatch("switchannotationeditorparams",{source:this,type:m(this,Zg),value:e})},eI=function(e){mo._keyboardManager.exec(this,e)},Vf=function(e){if(m(this,Mn,Md)){this.hideDropdown();return}if(L(this,aw,e.detail===0),m(this,ph)||(L(this,ph,new AbortController),window.addEventListener("pointerdown",B(this,Mn,UQ).bind(this),{signal:m(this,_l).combinedSignal(m(this,ph))})),m(this,fs)){m(this,fs).classList.remove("hidden");return}const t=L(this,fs,B(this,Mn,QN).call(this));m(this,kl).append(t)},UQ=function(e){var t;(t=m(this,fs))!=null&&t.contains(e.target)||this.hideDropdown()},Md=function(){return m(this,fs)&&!m(this,fs).classList.contains("hidden")},z(mo,uw,null);let O5=mo;var e1,dw,Iu,Yp,t1,xo,hw,fw,Xp,Pa,Yo,Vs,n1,Ru,pi,r1,La,pw,Rt,tI,Tk,HQ,qQ,GQ,nI,Uf,Ha,Em,WQ,Ak,ux,KQ,YQ,XQ,JQ,QQ;const xn=class xn extends xr{constructor(t){super({...t,name:"highlightEditor"});z(this,Rt);z(this,e1,null);z(this,dw,0);z(this,Iu);z(this,Yp,null);z(this,t1,null);z(this,xo,null);z(this,hw,null);z(this,fw,0);z(this,Xp,null);z(this,Pa,null);z(this,Yo,null);z(this,Vs,!1);z(this,n1,null);z(this,Ru);z(this,pi,null);z(this,r1,"");z(this,La);z(this,pw,"");this.color=t.color||xn._defaultColor,L(this,La,t.thickness||xn._defaultThickness),L(this,Ru,t.opacity||xn._defaultOpacity),L(this,Iu,t.boxes||null),L(this,pw,t.methodOfCreation||""),L(this,r1,t.text||""),this._isDraggable=!1,t.highlightId>-1?(L(this,Vs,!0),B(this,Rt,Tk).call(this,t),B(this,Rt,Uf).call(this)):m(this,Iu)&&(L(this,e1,t.anchorNode),L(this,dw,t.anchorOffset),L(this,hw,t.focusNode),L(this,fw,t.focusOffset),B(this,Rt,tI).call(this),B(this,Rt,Uf).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=xn.prototype;return Ht(this,"_keyboardManager",new u2([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:m(this,Vs)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:m(this,La),methodOfCreation:m(this,pw)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,r){var s;xr.initialize(t,r),xn._defaultColor||(xn._defaultColor=((s=r.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,r){switch(t){case rn.HIGHLIGHT_DEFAULT_COLOR:xn._defaultColor=r;break;case rn.HIGHLIGHT_THICKNESS:xn._defaultThickness=r;break}}translateInPage(t,r){}get toolbarPosition(){return m(this,n1)}updateParams(t,r){switch(t){case rn.HIGHLIGHT_COLOR:B(this,Rt,HQ).call(this,r);break;case rn.HIGHLIGHT_THICKNESS:B(this,Rt,qQ).call(this,r);break}}static get defaultPropertiesToUpdate(){return[[rn.HIGHLIGHT_DEFAULT_COLOR,xn._defaultColor],[rn.HIGHLIGHT_THICKNESS,xn._defaultThickness]]}get propertiesToUpdate(){return[[rn.HIGHLIGHT_COLOR,this.color||xn._defaultColor],[rn.HIGHLIGHT_THICKNESS,m(this,La)||xn._defaultThickness],[rn.HIGHLIGHT_FREE,m(this,Vs)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(L(this,t1,new O5({editor:this})),t.addColorPicker(m(this,t1))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(B(this,Rt,ux).call(this))}getBaseTranslation(){return[0,0]}getRect(t,r){return super.getRect(t,r,B(this,Rt,ux).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){B(this,Rt,nI).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(B(this,Rt,Uf).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let r=!1;this.parent&&!t?B(this,Rt,nI).call(this):t&&(B(this,Rt,Uf).call(this,t),r=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),r&&this.select()}rotate(t){var i,o,a;const{drawLayer:r}=this.parent;let s;m(this,Vs)?(t=(t-this.rotation+360)%360,s=B(i=xn,Ha,Em).call(i,m(this,Pa).box,t)):s=B(o=xn,Ha,Em).call(o,[this.x,this.y,this.width,this.height],t),r.updateProperties(m(this,Yo),{bbox:s,root:{"data-main-rotation":t}}),r.updateProperties(m(this,pi),{bbox:B(a=xn,Ha,Em).call(a,m(this,xo).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();m(this,r1)&&(t.setAttribute("aria-label",m(this,r1)),t.setAttribute("role","mark")),m(this,Vs)?t.classList.add("free"):this.div.addEventListener("keydown",B(this,Rt,WQ).bind(this),{signal:this._uiManager._signal});const r=L(this,Xp,document.createElement("div"));t.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",r.style.clipPath=m(this,Yp);const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),P5(this,m(this,Xp),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(m(this,pi),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(m(this,pi),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:B(this,Rt,Ak).call(this,!0);break;case 1:case 3:B(this,Rt,Ak).call(this,!1);break}}select(){var t;super.select(),m(this,pi)&&((t=this.parent)==null||t.drawLayer.updateProperties(m(this,pi),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),m(this,pi)&&((t=this.parent)==null||t.drawLayer.updateProperties(m(this,pi),{rootClass:{selected:!1}}),m(this,Vs)||B(this,Rt,Ak).call(this,!1))}get _mustFixPosition(){return!m(this,Vs)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(m(this,Yo),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(m(this,pi),{rootClass:{hidden:!t}}))}static startHighlighting(t,r,{target:s,x:i,y:o}){const{x:a,y:l,width:c,height:u}=s.getBoundingClientRect(),h=new AbortController,f=t.combinedSignal(h),p=g=>{h.abort(),B(this,Ha,JQ).call(this,t,g)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",sa,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Bl,{signal:f}),s.addEventListener("pointermove",B(this,Ha,XQ).bind(this,t),{signal:f}),this._freeHighlight=new JN({x:i,y:o},[a,l,c,u],t.scale,this._defaultThickness/2,r,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,r,s){var y,v,b,w;let i=null;if(t instanceof SQ){const{data:{quadPoints:k,rect:T,rotation:R,id:M,color:E,opacity:I,popupRef:S},parent:{page:{pageNumber:N}}}=t;i=t={annotationType:Pt.HIGHLIGHT,color:Array.from(E),opacity:I,quadPoints:k,boxes:null,pageIndex:N-1,rect:T.slice(0),rotation:R,id:M,deleted:!1,popupRef:S}}else if(t instanceof gM){const{data:{inkLists:k,rect:T,rotation:R,id:M,color:E,borderStyle:{rawWidth:I},popupRef:S},parent:{page:{pageNumber:N}}}=t;i=t={annotationType:Pt.HIGHLIGHT,color:Array.from(E),thickness:I,inkLists:k,boxes:null,pageIndex:N-1,rect:T.slice(0),rotation:R,id:M,deleted:!1,popupRef:S}}const{color:o,quadPoints:a,inkLists:l,opacity:c}=t,u=await super.deserialize(t,r,s);u.color=Je.makeHexColor(...o),L(u,Ru,c||1),l&&L(u,La,t.thickness),u.annotationElementId=t.id||null,u._initialData=i;const[h,f]=u.pageDimensions,[p,g]=u.pageTranslation;if(a){const k=L(u,Iu,[]);for(let T=0;T<a.length;T+=8)k.push({x:(a[T]-p)/h,y:1-(a[T+1]-g)/f,width:(a[T+2]-a[T])/h,height:(a[T+1]-a[T+5])/f});B(y=u,Rt,tI).call(y),B(v=u,Rt,Uf).call(v),u.rotate(u.rotation)}else if(l){L(u,Vs,!0);const k=l[0],T={x:k[0]-p,y:f-(k[1]-g)},R=new JN(T,[0,0,h,f],1,m(u,La)/2,!0,.001);for(let I=0,S=k.length;I<S;I+=2)T.x=k[I]-p,T.y=f-(k[I+1]-g),R.add(T);const{id:M,clipPathId:E}=r.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:R.toSVGPath()}},!0,!0);B(b=u,Rt,Tk).call(b,{highlightOutlines:R.getOutlines(),highlightId:M,clipPathId:E}),B(w=u,Rt,Uf).call(w)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const r=this.getRect(0,0),s=xr._colorManager.convert(this.color),i={annotationType:Pt.HIGHLIGHT,color:s,opacity:m(this,Ru),thickness:m(this,La),quadPoints:B(this,Rt,KQ).call(this),outlines:B(this,Rt,YQ).call(this,r),pageIndex:this.pageIndex,rect:r,rotation:B(this,Rt,ux).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!B(this,Rt,QQ).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};e1=new WeakMap,dw=new WeakMap,Iu=new WeakMap,Yp=new WeakMap,t1=new WeakMap,xo=new WeakMap,hw=new WeakMap,fw=new WeakMap,Xp=new WeakMap,Pa=new WeakMap,Yo=new WeakMap,Vs=new WeakMap,n1=new WeakMap,Ru=new WeakMap,pi=new WeakMap,r1=new WeakMap,La=new WeakMap,pw=new WeakMap,Rt=new WeakSet,tI=function(){const t=new YN(m(this,Iu),.001);L(this,Pa,t.getOutlines()),[this.x,this.y,this.width,this.height]=m(this,Pa).box;const r=new YN(m(this,Iu),.0025,.001,this._uiManager.direction==="ltr");L(this,xo,r.getOutlines());const{lastPoint:s}=m(this,xo);L(this,n1,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Tk=function({highlightOutlines:t,highlightId:r,clipPathId:s}){var h,f;if(L(this,Pa,t),L(this,xo,t.getNewOutline(m(this,La)/2+1.5,.0025)),r>=0)L(this,Yo,r),L(this,Yp,s),this.parent.drawLayer.finalizeDraw(r,{bbox:t.box,path:{d:t.toSVGPath()}}),L(this,pi,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:m(this,xo).box,path:{d:m(this,xo).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(m(this,Yo),{bbox:B(h=xn,Ha,Em).call(h,m(this,Pa).box,(p-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(m(this,pi),{bbox:B(f=xn,Ha,Em).call(f,m(this,xo).box,p),path:{d:m(this,xo).toSVGPath()}})}const[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{const[p,g]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*g/p,this.height=c*p/g;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{const[p,g]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*g/p,this.height=c*p/g;break}}const{lastPoint:u}=m(this,xo);L(this,n1,[(u[0]-o)/l,(u[1]-a)/c])},HQ=function(t){const r=(o,a)=>{var l,c;this.color=o,L(this,Ru,a),(l=this.parent)==null||l.drawLayer.updateProperties(m(this,Yo),{root:{fill:o,"fill-opacity":a}}),(c=m(this,t1))==null||c.updateColor(o)},s=this.color,i=m(this,Ru);this.addCommands({cmd:r.bind(this,t,xn._defaultOpacity),undo:r.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rn.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},qQ=function(t){const r=m(this,La),s=i=>{L(this,La,i),B(this,Rt,GQ).call(this,i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:rn.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},GQ=function(t){if(!m(this,Vs))return;B(this,Rt,Tk).call(this,{highlightOutlines:m(this,Pa).getNewOutline(t/2)}),this.fixAndSetPosition();const[r,s]=this.parentDimensions;this.setDims(this.width*r,this.height*s)},nI=function(){m(this,Yo)===null||!this.parent||(this.parent.drawLayer.remove(m(this,Yo)),L(this,Yo,null),this.parent.drawLayer.remove(m(this,pi)),L(this,pi,null))},Uf=function(t=this.parent){m(this,Yo)===null&&({id:Pi(this,Yo)._,clipPathId:Pi(this,Yp)._}=t.drawLayer.draw({bbox:m(this,Pa).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":m(this,Ru)},rootClass:{highlight:!0,free:m(this,Vs)},path:{d:m(this,Pa).toSVGPath()}},!1,!0),L(this,pi,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:m(this,Vs)},bbox:m(this,xo).box,path:{d:m(this,xo).toSVGPath()}},m(this,Vs))),m(this,Xp)&&(m(this,Xp).style.clipPath=m(this,Yp)))},Ha=new WeakSet,Em=function([t,r,s,i],o){switch(o){case 90:return[1-r-i,t,i,s];case 180:return[1-t-s,1-r-i,s,i];case 270:return[r,1-t-s,i,s]}return[t,r,s,i]},WQ=function(t){xn._keyboardManager.exec(this,t)},Ak=function(t){if(!m(this,e1))return;const r=window.getSelection();t?r.setPosition(m(this,e1),m(this,dw)):r.setPosition(m(this,hw),m(this,fw))},ux=function(){return m(this,Vs)?this.rotation:0},KQ=function(){if(m(this,Vs))return null;const[t,r]=this.pageDimensions,[s,i]=this.pageTranslation,o=m(this,Iu),a=new Float32Array(o.length*8);let l=0;for(const{x:c,y:u,width:h,height:f}of o){const p=c*t+s,g=(1-u)*r+i;a[l]=a[l+4]=p,a[l+1]=a[l+3]=g,a[l+2]=a[l+6]=p+h*t,a[l+5]=a[l+7]=g-f*r,l+=8}return a},YQ=function(t){return m(this,Pa).serialize(t,B(this,Rt,ux).call(this))},XQ=function(t,r){this._freeHighlight.add(r)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},JQ=function(t,r){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(r,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},QQ=function(t){const{color:r}=this._initialData;return t.color.some((s,i)=>s!==r[i])},z(xn,Ha),ct(xn,"_defaultColor",null),ct(xn,"_defaultOpacity",1),ct(xn,"_defaultThickness",12),ct(xn,"_type","highlight"),ct(xn,"_editorType",Pt.HIGHLIGHT),ct(xn,"_freeHighlightId",-1),ct(xn,"_freeHighlight",null),ct(xn,"_freeHighlightClipId","");let F5=xn;var Jp;class PIe{constructor(){z(this,Jp,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,r]of Object.entries(e))this.updateProperty(t,r)}updateSVGProperty(e,t){m(this,Jp)[e]=t}toSVGProperties(){const e=m(this,Jp);return L(this,Jp,Object.create(null)),{root:e}}reset(){L(this,Jp,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){zn("Not implemented")}}Jp=new WeakMap;var Xo,s1,As,Qp,Zp,mh,gh,yh,e0,fn,sI,iI,oI,dx,ZQ,Ek,hx,Cm;const He=class He extends xr{constructor(t){super(t);z(this,fn);z(this,Xo,null);z(this,s1);ct(this,"_drawId",null);L(this,s1,t.mustBeCommitted||!1),t.drawOutlines&&(B(this,fn,sI).call(this,t),B(this,fn,dx).call(this))}static _mergeSVGProperties(t,r){const s=new Set(Object.keys(t));for(const[i,o]of Object.entries(r))s.has(i)?Object.assign(t[i],o):t[i]=o;return t}static getDefaultDrawingOptions(t){zn("Not implemented")}static get typesMap(){zn("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,r){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,r),this._currentParent&&(m(He,As).updateProperty(s,r),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,r){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,r)}static get defaultPropertiesToUpdate(){const t=[],r=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,r[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:r}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,r[i]]);return t}_updateProperty(t,r,s){const i=this._drawingOptions,o=i[r],a=l=>{var u;i.updateProperty(r,l);const c=m(this,Xo).updateProperty(r,l);c&&B(this,fn,hx).call(this,c),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:a.bind(this,s),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,He._mergeSVGProperties(m(this,Xo).getPathResizingSVGProperties(B(this,fn,Ek).call(this)),{bbox:B(this,fn,Cm).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,He._mergeSVGProperties(m(this,Xo).getPathResizedSVGProperties(B(this,fn,Ek).call(this)),{bbox:B(this,fn,Cm).call(this)}))}_onTranslating(t,r){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:B(this,fn,Cm).call(this,t,r)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,He._mergeSVGProperties(m(this,Xo).getPathTranslatedSVGProperties(B(this,fn,Ek).call(this),this.parentDimensions),{bbox:B(this,fn,Cm).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,m(this,s1)&&(L(this,s1,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){B(this,fn,oI).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(B(this,fn,dx).call(this),B(this,fn,hx).call(this,m(this,Xo).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let r=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),B(this,fn,oI).call(this)):t&&(this._uiManager.addShouldRescale(this),B(this,fn,dx).call(this,t),r=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),r&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,He._mergeSVGProperties({bbox:B(this,fn,Cm).call(this)},m(this,Xo).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&B(this,fn,hx).call(this,m(this,Xo).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const r=document.createElement("div");t.append(r),r.setAttribute("aria-hidden","true"),r.className="internal";const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,r,s,i,o){zn("Not implemented")}static startDrawing(t,r,s,i){var v;const{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:u}=i;if(m(He,gh)&&m(He,gh)!==u)return;const{viewport:{rotation:h}}=t,{width:f,height:p}=o.getBoundingClientRect(),g=L(He,Qp,new AbortController),y=t.combinedSignal(g);if(m(He,mh)||L(He,mh,c),m(He,gh)??L(He,gh,u),window.addEventListener("pointerup",b=>{var w;m(He,mh)===b.pointerId?this._endDraw(b):(w=m(He,yh))==null||w.delete(b.pointerId)},{signal:y}),window.addEventListener("pointercancel",b=>{var w;m(He,mh)===b.pointerId?this._currentParent.endDrawingSession():(w=m(He,yh))==null||w.delete(b.pointerId)},{signal:y}),window.addEventListener("pointerdown",b=>{m(He,gh)===b.pointerType&&((m(He,yh)||L(He,yh,new Set)).add(b.pointerId),m(He,As).isCancellable()&&(m(He,As).removeLastElement(),m(He,As).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Bl,{signal:y}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),o.addEventListener("touchmove",b=>{b.timeStamp===m(He,e0)&&sa(b)},{signal:y}),t.toggleDrawing(),(v=r._editorUndoBar)==null||v.hide(),m(He,As)){t.drawLayer.updateProperties(this._currentDrawId,m(He,As).startNew(a,l,f,p,h));return}r.updateUIForDefaultProperties(this),L(He,As,this.createDrawerInstance(a,l,f,p,h)),L(He,Zp,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(m(He,Zp).toSVGProperties(),m(He,As).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(L(He,e0,-1),!m(He,As))return;const{offsetX:r,offsetY:s,pointerId:i}=t;if(m(He,mh)===i){if(((o=m(He,yh))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,m(He,As).add(r,s)),L(He,e0,t.timeStamp),sa(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,L(He,As,null),L(He,Zp,null),L(He,gh,null),L(He,e0,NaN)),m(He,Qp)&&(m(He,Qp).abort(),L(He,Qp,null),L(He,mh,NaN),L(He,yh,null))}static _endDraw(t){const r=this._currentParent;if(r){if(r.toggleDrawing(!0),this._cleanup(!1),t&&r.drawLayer.updateProperties(this._currentDrawId,m(He,As).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=m(He,As),i=this._currentDrawId,o=s.getLastElement();r.addCommands({cmd:()=>{r.drawLayer.updateProperties(i,s.setLastElement(o))},undo:()=>{r.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:rn.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const r=this._currentParent;if(!r)return null;if(r.toggleDrawing(!0),r.cleanUndoStack(rn.DRAW_STEP),!m(He,As).isEmpty()){const{pageDimensions:[s,i],scale:o}=r,a=r.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:m(He,As).getOutlines(s*o,i*o,o,this._INNER_MARGIN),drawingOptions:m(He,Zp),mustBeCommitted:!t});return this._cleanup(!0),a}return r.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,r,s,i,o,a){zn("Not implemented")}static async deserialize(t,r,s){var h,f;const{rawDims:{pageWidth:i,pageHeight:o,pageX:a,pageY:l}}=r.viewport,c=this.deserializeDraw(a,l,i,o,this._INNER_MARGIN,t),u=await super.deserialize(t,r,s);return u.createDrawingOptions(t),B(h=u,fn,sI).call(h,{drawOutlines:c}),B(f=u,fn,dx).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[r,s]=this.pageTranslation,[i,o]=this.pageDimensions;return m(this,Xo).serialize([r,s,i,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Xo=new WeakMap,s1=new WeakMap,As=new WeakMap,Qp=new WeakMap,Zp=new WeakMap,mh=new WeakMap,gh=new WeakMap,yh=new WeakMap,e0=new WeakMap,fn=new WeakSet,sI=function({drawOutlines:t,drawId:r,drawingOptions:s}){L(this,Xo,t),this._drawingOptions||(this._drawingOptions=s),r>=0?(this._drawId=r,this.parent.drawLayer.finalizeDraw(r,t.defaultProperties)):this._drawId=B(this,fn,iI).call(this,t,this.parent),B(this,fn,hx).call(this,t.box)},iI=function(t,r){const{id:s}=r.drawLayer.draw(He._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},oI=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},dx=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=B(this,fn,iI).call(this,m(this,Xo),t)}},ZQ=function([t,r,s,i]){const{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[r,1-t,s*(a/o),i*(o/a)];case 180:return[1-t,1-r,s,i];case 270:return[1-r,t,s*(a/o),i*(o/a)];default:return[t,r,s,i]}},Ek=function(){const{x:t,y:r,width:s,height:i,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-r,t,s*(o/a),i*(a/o)];case 180:return[1-t,1-r,s,i];case 270:return[r,1-t,s*(o/a),i*(a/o)];default:return[t,r,s,i]}},hx=function(t){if([this.x,this.y,this.width,this.height]=B(this,fn,ZQ).call(this,t),this.div){this.fixAndSetPosition();const[r,s]=this.parentDimensions;this.setDims(this.width*r,this.height*s)}this._onResized()},Cm=function(){const{x:t,y:r,width:s,height:i,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-r-i,t,i,s];case 2:return[1-t-s,1-r-i,s,i];case 3:return[r,1-t-s,i,s];case 4:return[t,r-s*(l/c),i*(c/l),s*(l/c)];case 5:return[1-r,t,s*(l/c),i*(c/l)];case 6:return[1-t-i*(c/l),1-r,i*(c/l),s*(l/c)];case 7:return[r-s*(l/c),1-t-i*(c/l),s*(l/c),i*(c/l)];case 8:return[t-s,r-i,s,i];case 9:return[1-r,t-s,i,s];case 10:return[1-t,1-r,s,i];case 11:return[r-i,1-t,i,s];case 12:return[t-i*(c/l),r,i*(c/l),s*(l/c)];case 13:return[1-r-s*(l/c),t-i*(c/l),s*(l/c),i*(c/l)];case 14:return[1-t,1-r-s*(l/c),i*(c/l),s*(l/c)];case 15:return[r,1-t,s*(l/c),i*(c/l)];default:return[t,r,s,i]}},ct(He,"_currentDrawId",-1),ct(He,"_currentParent",null),z(He,As,null),z(He,Qp,null),z(He,Zp,null),z(He,mh,NaN),z(He,gh,null),z(He,yh,null),z(He,e0,NaN),ct(He,"_INNER_MARGIN",3);let rI=He;var mc,Es,Cs,t0,i1,zi,Us,Da,n0,r0,s0,o1,Ck;class LIe{constructor(e,t,r,s,i,o){z(this,o1);z(this,mc,new Float64Array(6));z(this,Es);z(this,Cs);z(this,t0);z(this,i1);z(this,zi);z(this,Us,"");z(this,Da,0);z(this,n0,new z5);z(this,r0);z(this,s0);L(this,r0,r),L(this,s0,s),L(this,t0,i),L(this,i1,o),[e,t]=B(this,o1,Ck).call(this,e,t);const a=L(this,Es,[NaN,NaN,NaN,NaN,e,t]);L(this,zi,[e,t]),L(this,Cs,[{line:a,points:m(this,zi)}]),m(this,mc).set(a,0)}updateProperty(e,t){e==="stroke-width"&&L(this,i1,t)}isEmpty(){return!m(this,Cs)||m(this,Cs).length===0}isCancellable(){return m(this,zi).length<=10}add(e,t){[e,t]=B(this,o1,Ck).call(this,e,t);const[r,s,i,o]=m(this,mc).subarray(2,6),a=e-i,l=t-o;return Math.hypot(m(this,r0)*a,m(this,s0)*l)<=2?null:(m(this,zi).push(e,t),isNaN(r)?(m(this,mc).set([i,o,e,t],2),m(this,Es).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(m(this,mc)[0])&&m(this,Es).splice(6,6),m(this,mc).set([r,s,i,o,e,t],0),m(this,Es).push(...Ve.createBezierPoints(r,s,i,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const r=this.add(e,t);return r||(m(this,zi).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,r,s,i){L(this,r0,r),L(this,s0,s),L(this,t0,i),[e,t]=B(this,o1,Ck).call(this,e,t);const o=L(this,Es,[NaN,NaN,NaN,NaN,e,t]);L(this,zi,[e,t]);const a=m(this,Cs).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),m(this,Cs).push({line:o,points:m(this,zi)}),m(this,mc).set(o,0),L(this,Da,0),this.toSVGPath(),null}getLastElement(){return m(this,Cs).at(-1)}setLastElement(e){return m(this,Cs)?(m(this,Cs).push(e),L(this,Es,e.line),L(this,zi,e.points),L(this,Da,0),{path:{d:this.toSVGPath()}}):m(this,n0).setLastElement(e)}removeLastElement(){if(!m(this,Cs))return m(this,n0).removeLastElement();m(this,Cs).pop(),L(this,Us,"");for(let e=0,t=m(this,Cs).length;e<t;e++){const{line:r,points:s}=m(this,Cs)[e];L(this,Es,r),L(this,zi,s),L(this,Da,0),this.toSVGPath()}return{path:{d:m(this,Us)}}}toSVGPath(){const e=Ve.svgRound(m(this,Es)[4]),t=Ve.svgRound(m(this,Es)[5]);if(m(this,zi).length===2)return L(this,Us,`${m(this,Us)} M ${e} ${t} Z`),m(this,Us);if(m(this,zi).length<=6){const s=m(this,Us).lastIndexOf("M");L(this,Us,`${m(this,Us).slice(0,s)} M ${e} ${t}`),L(this,Da,6)}if(m(this,zi).length===4){const s=Ve.svgRound(m(this,Es)[10]),i=Ve.svgRound(m(this,Es)[11]);return L(this,Us,`${m(this,Us)} L ${s} ${i}`),L(this,Da,12),m(this,Us)}const r=[];m(this,Da)===0&&(r.push(`M ${e} ${t}`),L(this,Da,6));for(let s=m(this,Da),i=m(this,Es).length;s<i;s+=6){const[o,a,l,c,u,h]=m(this,Es).slice(s,s+6).map(Ve.svgRound);r.push(`C${o} ${a} ${l} ${c} ${u} ${h}`)}return L(this,Us,m(this,Us)+r.join(" ")),L(this,Da,m(this,Es).length),m(this,Us)}getOutlines(e,t,r,s){const i=m(this,Cs).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),m(this,n0).build(m(this,Cs),e,t,r,m(this,t0),m(this,i1),s),L(this,mc,null),L(this,Es,null),L(this,Cs,null),L(this,Us,null),m(this,n0)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}mc=new WeakMap,Es=new WeakMap,Cs=new WeakMap,t0=new WeakMap,i1=new WeakMap,zi=new WeakMap,Us=new WeakMap,Da=new WeakMap,n0=new WeakMap,r0=new WeakMap,s0=new WeakMap,o1=new WeakSet,Ck=function(e,t){return Ve._normalizePoint(e,t,m(this,r0),m(this,s0),m(this,t0))};var Bi,mw,gw,Jo,gc,yc,a1,l1,c1,Ks,su,eZ,tZ,nZ;const wM=class wM extends Ve{constructor(){super(...arguments);z(this,Ks);z(this,Bi);z(this,mw,0);z(this,gw);z(this,Jo);z(this,gc);z(this,yc);z(this,a1);z(this,l1);z(this,c1)}build(t,r,s,i,o,a,l){L(this,gc,r),L(this,yc,s),L(this,a1,i),L(this,l1,o),L(this,c1,a),L(this,gw,l??0),L(this,Jo,t),B(this,Ks,tZ).call(this)}setLastElement(t){return m(this,Jo).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return m(this,Jo).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:r}of m(this,Jo)){if(t.push(`M${Ve.svgRound(r[4])} ${Ve.svgRound(r[5])}`),r.length===6){t.push("Z");continue}if(r.length===12){t.push(`L${Ve.svgRound(r[10])} ${Ve.svgRound(r[11])}`);continue}for(let s=6,i=r.length;s<i;s+=6){const[o,a,l,c,u,h]=r.subarray(s,s+6).map(Ve.svgRound);t.push(`C${o} ${a} ${l} ${c} ${u} ${h}`)}}return t.join("")}serialize([t,r,s,i],o){const a=[],l=[],[c,u,h,f]=B(this,Ks,eZ).call(this);let p,g,y,v,b,w,k,T,R;switch(m(this,l1)){case 0:R=Ve._rescale,p=t,g=r+i,y=s,v=-i,b=t+c*s,w=r+(1-u-f)*i,k=t+(c+h)*s,T=r+(1-u)*i;break;case 90:R=Ve._rescaleAndSwap,p=t,g=r,y=s,v=i,b=t+u*s,w=r+c*i,k=t+(u+f)*s,T=r+(c+h)*i;break;case 180:R=Ve._rescale,p=t+s,g=r,y=-s,v=i,b=t+(1-c-h)*s,w=r+u*i,k=t+(1-c)*s,T=r+(u+f)*i;break;case 270:R=Ve._rescaleAndSwap,p=t+s,g=r+i,y=-s,v=-i,b=t+(1-u-f)*s,w=r+(1-c-h)*i,k=t+(1-u)*s,T=r+(1-c)*i;break}for(const{line:M,points:E}of m(this,Jo))a.push(R(M,p,g,y,v,o?new Array(M.length):null)),l.push(R(E,p,g,y,v,o?new Array(E.length):null));return{lines:a,points:l,rect:[b,w,k,T]}}static deserialize(t,r,s,i,o,{paths:{lines:a,points:l},rotation:c,thickness:u}){const h=[];let f,p,g,y,v;switch(c){case 0:v=Ve._rescale,f=-t/s,p=r/i+1,g=1/s,y=-1/i;break;case 90:v=Ve._rescaleAndSwap,f=-r/i,p=-t/s,g=1/i,y=1/s;break;case 180:v=Ve._rescale,f=t/s+1,p=-r/i,g=-1/s,y=1/i;break;case 270:v=Ve._rescaleAndSwap,f=r/i+1,p=t/s+1,g=-1/i,y=-1/s;break}if(!a){a=[];for(const w of l){const k=w.length;if(k===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1]]));continue}if(k===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,w[0],w[1],NaN,NaN,NaN,NaN,w[2],w[3]]));continue}const T=new Float32Array(3*(k-2));a.push(T);let[R,M,E,I]=w.subarray(0,4);T.set([NaN,NaN,NaN,NaN,R,M],0);for(let S=4;S<k;S+=2){const N=w[S],P=w[S+1];T.set(Ve.createBezierPoints(R,M,E,I,N,P),(S-2)*3),[R,M,E,I]=[E,I,N,P]}}}for(let w=0,k=a.length;w<k;w++)h.push({line:v(a[w].map(T=>T??NaN),f,p,g,y),points:v(l[w].map(T=>T??NaN),f,p,g,y)});const b=new wM;return b.build(h,s,i,1,c,u,o),b}get box(){return m(this,Bi)}updateProperty(t,r){return t==="stroke-width"?B(this,Ks,nZ).call(this,r):null}updateParentDimensions([t,r],s){const[i,o]=B(this,Ks,su).call(this);L(this,gc,t),L(this,yc,r),L(this,a1,s);const[a,l]=B(this,Ks,su).call(this),c=a-i,u=l-o,h=m(this,Bi);return h[0]-=c,h[1]-=u,h[2]+=2*c,h[3]+=2*u,h}updateRotation(t){return L(this,mw,t),{path:{transform:this.rotationTransform}}}get viewBox(){return m(this,Bi).map(Ve.svgRound).join(" ")}get defaultProperties(){const[t,r]=m(this,Bi);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ve.svgRound(t)} ${Ve.svgRound(r)}`}}}get rotationTransform(){const[,,t,r]=m(this,Bi);let s=0,i=0,o=0,a=0,l=0,c=0;switch(m(this,mw)){case 90:i=r/t,o=-t/r,l=t;break;case 180:s=-1,a=-1,l=t,c=r;break;case 270:i=-r/t,o=t/r,c=r;break;default:return""}return`matrix(${s} ${i} ${o} ${a} ${Ve.svgRound(l)} ${Ve.svgRound(c)})`}getPathResizingSVGProperties([t,r,s,i]){const[o,a]=B(this,Ks,su).call(this),[l,c,u,h]=m(this,Bi);if(Math.abs(u-o)<=Ve.PRECISION||Math.abs(h-a)<=Ve.PRECISION){const v=t+s/2-(l+u/2),b=r+i/2-(c+h/2);return{path:{"transform-origin":`${Ve.svgRound(t)} ${Ve.svgRound(r)}`,transform:`${this.rotationTransform} translate(${v} ${b})`}}}const f=(s-2*o)/(u-2*o),p=(i-2*a)/(h-2*a),g=u/s,y=h/i;return{path:{"transform-origin":`${Ve.svgRound(l)} ${Ve.svgRound(c)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${Ve.svgRound(o)} ${Ve.svgRound(a)}) scale(${f} ${p}) translate(${Ve.svgRound(-o)} ${Ve.svgRound(-a)})`}}}getPathResizedSVGProperties([t,r,s,i]){const[o,a]=B(this,Ks,su).call(this),l=m(this,Bi),[c,u,h,f]=l;if(l[0]=t,l[1]=r,l[2]=s,l[3]=i,Math.abs(h-o)<=Ve.PRECISION||Math.abs(f-a)<=Ve.PRECISION){const b=t+s/2-(c+h/2),w=r+i/2-(u+f/2);for(const{line:k,points:T}of m(this,Jo))Ve._translate(k,b,w,k),Ve._translate(T,b,w,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ve.svgRound(t)} ${Ve.svgRound(r)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(s-2*o)/(h-2*o),g=(i-2*a)/(f-2*a),y=-p*(c+o)+t+o,v=-g*(u+a)+r+a;if(p!==1||g!==1||y!==0||v!==0)for(const{line:b,points:w}of m(this,Jo))Ve._rescale(b,y,v,p,g,b),Ve._rescale(w,y,v,p,g,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ve.svgRound(t)} ${Ve.svgRound(r)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,r],s){const[i,o]=s,a=m(this,Bi),l=t-a[0],c=r-a[1];if(m(this,gc)===i&&m(this,yc)===o)for(const{line:u,points:h}of m(this,Jo))Ve._translate(u,l,c,u),Ve._translate(h,l,c,h);else{const u=m(this,gc)/i,h=m(this,yc)/o;L(this,gc,i),L(this,yc,o);for(const{line:f,points:p}of m(this,Jo))Ve._rescale(f,l,c,u,h,f),Ve._rescale(p,l,c,u,h,p);a[2]*=u,a[3]*=h}return a[0]=t,a[1]=r,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Ve.svgRound(t)} ${Ve.svgRound(r)}`}}}get defaultSVGProperties(){const t=m(this,Bi);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Ve.svgRound(t[0])} ${Ve.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Bi=new WeakMap,mw=new WeakMap,gw=new WeakMap,Jo=new WeakMap,gc=new WeakMap,yc=new WeakMap,a1=new WeakMap,l1=new WeakMap,c1=new WeakMap,Ks=new WeakSet,su=function(t=m(this,c1)){const r=m(this,gw)+t/2*m(this,a1);return m(this,l1)%180===0?[r/m(this,gc),r/m(this,yc)]:[r/m(this,yc),r/m(this,gc)]},eZ=function(){const[t,r,s,i]=m(this,Bi),[o,a]=B(this,Ks,su).call(this,0);return[t+o,r+a,s-2*o,i-2*a]},tZ=function(){const t=L(this,Bi,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of m(this,Jo)){if(i.length<=12){for(let l=4,c=i.length;l<c;l+=6){const[u,h]=i.subarray(l,l+2);t[0]=Math.min(t[0],u),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],u),t[3]=Math.max(t[3],h)}continue}let o=i[4],a=i[5];for(let l=6,c=i.length;l<c;l+=6){const[u,h,f,p,g,y]=i.subarray(l,l+6);Je.bezierBoundingBox(o,a,u,h,f,p,g,y,t),o=g,a=y}}const[r,s]=B(this,Ks,su).call(this);t[0]=Math.min(1,Math.max(0,t[0]-r)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+r)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},nZ=function(t){const[r,s]=B(this,Ks,su).call(this);L(this,c1,t);const[i,o]=B(this,Ks,su).call(this),[a,l]=[i-r,o-s],c=m(this,Bi);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};let z5=wM;var u1;const kM=class kM extends PIe{constructor(t){super();z(this,u1);L(this,u1,t),super.updateProperties({fill:"none",stroke:xr._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,r){t==="stroke-width"&&(r??(r=this["stroke-width"]),r*=m(this,u1).realScale),super.updateSVGProperty(t,r)}clone(){const t=new kM(m(this,u1));return t.updateAll(this),t}};u1=new WeakMap;let aI=kM;var r3,rZ;const Hm=class Hm extends rI{constructor(t){super({...t,name:"inkEditor"});z(this,r3);this._willKeepAspectRatio=!0}static initialize(t,r){xr.initialize(t,r),this._defaultDrawingOptions=new aI(r.viewParameters)}static getDefaultDrawingOptions(t){const r=this._defaultDrawingOptions.clone();return r.updateProperties(t),r}static get supportMultipleDrawings(){return!0}static get typesMap(){return Ht(this,"typesMap",new Map([[rn.INK_THICKNESS,"stroke-width"],[rn.INK_COLOR,"stroke"],[rn.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,r,s,i,o){return new LIe(t,r,s,i,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,r,s,i,o,a){return z5.deserialize(t,r,s,i,o,a)}static async deserialize(t,r,s){let i=null;if(t instanceof gM){const{data:{inkLists:a,rect:l,rotation:c,id:u,color:h,opacity:f,borderStyle:{rawWidth:p},popupRef:g},parent:{page:{pageNumber:y}}}=t;i=t={annotationType:Pt.INK,color:Array.from(h),thickness:p,opacity:f,paths:{points:a},boxes:null,pageIndex:y-1,rect:l.slice(0),rotation:c,id:u,deleted:!1,popupRef:g}}const o=await super.deserialize(t,r,s);return o.annotationElementId=t.id||null,o._initialData=i,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:r,parent:s}=this;r.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,r.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:r,opacity:s}){this._drawingOptions=Hm.getDefaultDrawingOptions({stroke:Je.makeHexColor(...t),"stroke-width":r,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:r,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:Pt.INK,color:xr._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:r,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?c:this.annotationElementId&&!B(this,r3,rZ).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){const{points:r,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:r}),null}};r3=new WeakSet,rZ=function(t){const{color:r,thickness:s,opacity:i,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==r[l])||t.thickness!==s||t.opacity!==i||t.pageIndex!==o},ct(Hm,"_type","ink"),ct(Hm,"_editorType",Pt.INK),ct(Hm,"_defaultDrawingOptions",null);let lI=Hm;var fr,Hs,xh,Mu,bh,d1,xc,bc,Qo,h1,yn,fx,px,Nk,uI,Ik,dI,Rk,sZ;const Yx=class Yx extends xr{constructor(t){super({...t,name:"stampEditor"});z(this,yn);z(this,fr,null);z(this,Hs,null);z(this,xh,null);z(this,Mu,null);z(this,bh,null);z(this,d1,"");z(this,xc,null);z(this,bc,null);z(this,Qo,!1);z(this,h1,!1);L(this,Mu,t.bitmapUrl),L(this,bh,t.bitmapFile)}static initialize(t,r){xr.initialize(t,r)}static get supportedTypes(){return Ht(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(r=>`image/${r}`))}static get supportedTypesStr(){return Ht(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,r){r.pasteEditor(Pt.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const r=t.get("hasAltText");return{hasAltText:r.get(!0)??0,hasNoAltText:r.get(!1)??0}}async mlGuessAltText(t=null,r=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:i,width:o,height:a,channels:i.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),r&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;m(this,Hs)&&(L(this,fr,null),this._uiManager.imageManager.deleteId(m(this,Hs)),(t=m(this,xc))==null||t.remove(),L(this,xc,null),m(this,bc)&&(clearTimeout(m(this,bc)),L(this,bc,null))),super.remove()}rebuild(){if(!this.parent){m(this,Hs)&&B(this,yn,Nk).call(this);return}super.rebuild(),this.div!==null&&(m(this,Hs)&&m(this,xc)===null&&B(this,yn,Nk).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(m(this,xh)||m(this,fr)||m(this,Mu)||m(this,bh)||m(this,Hs))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,r;if(this.width&&(t=this.x,r=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),m(this,fr)?B(this,yn,uI).call(this):B(this,yn,Nk).call(this),this.width&&!this.annotationElementId){const[s,i]=this.parentDimensions;this.setAt(t*s,r*i,this.width*s,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;m(this,bc)!==null&&clearTimeout(m(this,bc)),L(this,bc,setTimeout(()=>{L(this,bc,null),B(this,yn,dI).call(this)},200))}copyCanvas(t,r,s=!1){var p;t||(t=224);const{width:i,height:o}=m(this,fr),a=new aN;let l=m(this,fr),c=i,u=o,h=null;if(r){if(i>r||o>r){const I=Math.min(r/i,r/o);c=Math.floor(i*I),u=Math.floor(o*I)}h=document.createElement("canvas");const g=h.width=Math.ceil(c*a.sx),y=h.height=Math.ceil(u*a.sy);m(this,Qo)||(l=B(this,yn,Ik).call(this,g,y));const v=h.getContext("2d");v.filter=this._uiManager.hcmFilter;let b="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",w="#42414d");const k=15,T=k*a.sx,R=k*a.sy,M=new OffscreenCanvas(T*2,R*2),E=M.getContext("2d");E.fillStyle=b,E.fillRect(0,0,T*2,R*2),E.fillStyle=w,E.fillRect(0,0,T,R),E.fillRect(T,R,T,R),v.fillStyle=v.createPattern(M,"repeat"),v.fillRect(0,0,g,y),v.drawImage(l,0,0,l.width,l.height,0,0,g,y)}let f=null;if(s){let g,y;if(a.symmetric&&l.width<t&&l.height<t)g=l.width,y=l.height;else if(l=m(this,fr),i>t||o>t){const w=Math.min(t/i,t/o);g=Math.floor(i*w),y=Math.floor(o*w),m(this,Qo)||(l=B(this,yn,Ik).call(this,g,y))}const b=new OffscreenCanvas(g,y).getContext("2d",{willReadFrequently:!0});b.drawImage(l,0,0,l.width,l.height,0,0,g,y),f={width:g,height:y,data:b.getImageData(0,0,g,y).data}}return{canvas:h,width:c,height:u,imageData:f}}getImageForAltText(){return m(this,xc)}static async deserialize(t,r,s){var y;let i=null;if(t instanceof TQ){const{data:{rect:v,rotation:b,id:w,structParent:k,popupRef:T},container:R,parent:{page:{pageNumber:M}}}=t,E=R.querySelector("canvas"),I=s.imageManager.getFromCanvas(R.id,E);E.remove();const S=((y=await r._structTree.getAriaAttributes(`${lM}${w}`))==null?void 0:y.get("aria-label"))||"";i=t={annotationType:Pt.STAMP,bitmapId:I.id,bitmap:I.bitmap,pageIndex:M-1,rect:v.slice(0),rotation:b,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:S},isSvg:!1,structParent:k,popupRef:T}}const o=await super.deserialize(t,r,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:u,isSvg:h,accessibilityData:f}=t;u&&s.imageManager.isValidId(u)?(L(o,Hs,u),l&&L(o,fr,l)):L(o,Mu,c),L(o,Qo,h);const[p,g]=o.pageDimensions;return o.width=(a[2]-a[0])/p,o.height=(a[3]-a[1])/g,o.annotationElementId=t.id||null,f&&(o.altTextData=f),o._initialData=i,L(o,h1,!!i),o}serialize(t=!1,r=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:Pt.STAMP,bitmapId:m(this,Hs),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:m(this,Qo),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=B(this,yn,Rk).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;const{decorative:i,altText:o}=this.serializeAltText(!1);if(!i&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const l=B(this,yn,sZ).call(this,s);if(l.isSame)return null;l.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,r===null)return s;r.stamps||(r.stamps=new Map);const a=m(this,Qo)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!r.stamps.has(m(this,Hs)))r.stamps.set(m(this,Hs),{area:a,serialized:s}),s.bitmap=B(this,yn,Rk).call(this,!1);else if(m(this,Qo)){const l=r.stamps.get(m(this,Hs));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=B(this,yn,Rk).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};fr=new WeakMap,Hs=new WeakMap,xh=new WeakMap,Mu=new WeakMap,bh=new WeakMap,d1=new WeakMap,xc=new WeakMap,bc=new WeakMap,Qo=new WeakMap,h1=new WeakMap,yn=new WeakSet,fx=function(t,r=!1){if(!t){this.remove();return}L(this,fr,t.bitmap),r||(L(this,Hs,t.id),L(this,Qo,t.isSvg)),t.file&&L(this,d1,t.file.name),B(this,yn,uI).call(this)},px=function(){if(L(this,xh,null),this._uiManager.enableWaiting(!1),!!m(this,xc)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&m(this,fr)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&m(this,fr)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Nk=function(){if(m(this,Hs)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(m(this,Hs)).then(s=>B(this,yn,fx).call(this,s,!0)).finally(()=>B(this,yn,px).call(this));return}if(m(this,Mu)){const s=m(this,Mu);L(this,Mu,null),this._uiManager.enableWaiting(!0),L(this,xh,this._uiManager.imageManager.getFromUrl(s).then(i=>B(this,yn,fx).call(this,i)).finally(()=>B(this,yn,px).call(this)));return}if(m(this,bh)){const s=m(this,bh);L(this,bh,null),this._uiManager.enableWaiting(!0),L(this,xh,this._uiManager.imageManager.getFromFile(s).then(i=>B(this,yn,fx).call(this,i)).finally(()=>B(this,yn,px).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Yx.supportedTypesStr;const r=this._uiManager._signal;L(this,xh,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),B(this,yn,fx).call(this,i)}s()},{signal:r}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:r})}).finally(()=>B(this,yn,px).call(this))),t.click()},uI=function(){var h;const{div:t}=this;let{width:r,height:s}=m(this,fr);const[i,o]=this.pageDimensions,a=.75;if(this.width)r=this.width*i,s=this.height*o;else if(r>a*i||s>a*o){const f=Math.min(a*i/r,a*o/s);r*=f,s*=f}const[l,c]=this.parentDimensions;this.setDims(r*l/i,s*c/o),this._uiManager.enableWaiting(!1);const u=L(this,xc,document.createElement("canvas"));u.setAttribute("role","img"),this.addContainer(u),this.width=r/i,this.height=s/o,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),B(this,yn,dI).call(this),m(this,h1)||(this.parent.addUndoableEditor(this),L(this,h1,!0)),this._reportTelemetry({action:"inserted_image"}),m(this,d1)&&u.setAttribute("aria-label",m(this,d1))},Ik=function(t,r){const{width:s,height:i}=m(this,fr);let o=s,a=i,l=m(this,fr);for(;o>2*t||a>2*r;){const c=o,u=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*r&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const h=new OffscreenCanvas(o,a);h.getContext("2d").drawImage(l,0,0,c,u,0,0,o,a),l=h.transferToImageBitmap()}return l},dI=function(){const[t,r]=this.parentDimensions,{width:s,height:i}=this,o=new aN,a=Math.ceil(s*t*o.sx),l=Math.ceil(i*r*o.sy),c=m(this,xc);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;const u=m(this,Qo)?m(this,fr):B(this,yn,Ik).call(this,a,l),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(u,0,0,u.width,u.height,0,0,a,l)},Rk=function(t){if(t){if(m(this,Qo)){const i=this._uiManager.imageManager.getSvgUrl(m(this,Hs));if(i)return i}const r=document.createElement("canvas");return{width:r.width,height:r.height}=m(this,fr),r.getContext("2d").drawImage(m(this,fr),0,0),r.toDataURL()}if(m(this,Qo)){const[r,s]=this.pageDimensions,i=Math.round(this.width*r*pf.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*pf.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(i,o);return a.getContext("2d").drawImage(m(this,fr),0,0,m(this,fr).width,m(this,fr).height,0,0,i,o),a.transferToImageBitmap()}return structuredClone(m(this,fr))},sZ=function(t){var a;const{pageIndex:r,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===r,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&o,isSameAltText:o}},ct(Yx,"_type","stamp"),ct(Yx,"_editorType",Pt.STAMP);let cI=Yx;var i0,f1,vc,vh,Pu,ja,wh,p1,o0,Sl,Lu,mi,Du,We,kh,sr,iZ,Jl,fI,pI,Mk;const dl=class dl{constructor({uiManager:e,pageIndex:t,div:r,structTreeLayer:s,accessibilityManager:i,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:u}){z(this,sr);z(this,i0);z(this,f1,!1);z(this,vc,null);z(this,vh,null);z(this,Pu,null);z(this,ja,new Map);z(this,wh,!1);z(this,p1,!1);z(this,o0,!1);z(this,Sl,null);z(this,Lu,null);z(this,mi,null);z(this,Du,null);z(this,We);const h=[...m(dl,kh).values()];if(!dl._initialized){dl._initialized=!0;for(const f of h)f.initialize(u,e)}e.registerEditorTypes(h),L(this,We,e),this.pageIndex=t,this.div=r,L(this,i0,i),L(this,vc,o),this.viewport=c,L(this,mi,l),this.drawLayer=a,this._structTree=s,m(this,We).addLayer(this)}get isEmpty(){return m(this,ja).size===0}get isInvisible(){return this.isEmpty&&m(this,We).getMode()===Pt.NONE}updateToolbar(e){m(this,We).updateToolbar(e)}updateMode(e=m(this,We).getMode()){switch(B(this,sr,Mk).call(this),e){case Pt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Pt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Pt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const r of m(dl,kh).values())t.toggle(`${r._type}Editing`,e===r._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=m(this,mi))==null?void 0:t.div)}setEditingState(e){m(this,We).setEditingState(e)}addCommands(e){m(this,We).addCommands(e)}cleanUndoStack(e){m(this,We).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=m(this,vc))==null||t.div.classList.toggle("disabled",!e)}async enable(){L(this,o0,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const r of m(this,ja).values())r.enableEditing(),r.show(!0),r.annotationElementId&&(m(this,We).removeChangedExistingAnnotation(r),e.add(r.annotationElementId));if(!m(this,vc)){L(this,o0,!1);return}const t=m(this,vc).getEditableAnnotations();for(const r of t){if(r.hide(),m(this,We).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const s=await this.deserialize(r);s&&(this.addOrRebuild(s),s.enableEditing())}L(this,o0,!1)}disable(){var s;L(this,p1,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of m(this,ja).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(s=this.getEditableAnnotation(i.annotationElementId))==null||s.show(),i.remove()}if(m(this,vc)){const i=m(this,vc).getEditableAnnotations();for(const o of i){const{id:a}=o.data;if(m(this,We).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(m(this,We).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}B(this,sr,Mk).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:r}=this.div;for(const i of m(dl,kh).values())r.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),L(this,p1,!1)}getEditableAnnotation(e){var t;return((t=m(this,vc))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){m(this,We).getActive()!==e&&m(this,We).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=m(this,mi))!=null&&e.div&&!m(this,Du)){L(this,Du,new AbortController);const t=m(this,We).combinedSignal(m(this,Du));m(this,mi).div.addEventListener("pointerdown",B(this,sr,iZ).bind(this),{signal:t}),m(this,mi).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=m(this,mi))!=null&&e.div&&m(this,Du)&&(m(this,Du).abort(),L(this,Du,null),m(this,mi).div.classList.remove("highlighting"))}enableClick(){if(m(this,vh))return;L(this,vh,new AbortController);const e=m(this,We).combinedSignal(m(this,vh));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=m(this,vh))==null||e.abort(),L(this,vh,null)}attach(e){m(this,ja).set(e.id,e);const{annotationElementId:t}=e;t&&m(this,We).isDeletedAnnotationElement(t)&&m(this,We).removeDeletedAnnotationElement(e)}detach(e){var t;m(this,ja).delete(e.id),(t=m(this,i0))==null||t.removePointerInTextLayer(e.contentDiv),!m(this,p1)&&e.annotationElementId&&m(this,We).addDeletedAnnotationElement(e)}remove(e){this.detach(e),m(this,We).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(m(this,We).addDeletedAnnotationElement(e.annotationElementId),xr.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),m(this,We).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!m(this,o0)),m(this,We).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var r;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!m(this,Pu)&&(e._focusEventsAllowed=!1,L(this,Pu,setTimeout(()=>{L(this,Pu,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:m(this,We)._signal}),t.focus())},0))),e._structTreeParentId=(r=m(this,i0))==null?void 0:r.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),r=()=>{e.remove()};this.addCommands({cmd:t,undo:r,mustExec:!1})}getNextId(){return m(this,We).getId()}combinedSignal(e){return m(this,We).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=m(this,sr,Jl))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){m(this,We).updateToolbar(e),m(this,We).updateMode(e);const{offsetX:r,offsetY:s}=B(this,sr,pI).call(this),i=this.getNextId(),o=B(this,sr,fI).call(this,{parent:this,id:i,x:r,y:s,uiManager:m(this,We),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=m(dl,kh).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,m(this,We)))||null}createAndAddNewEditor(e,t,r={}){const s=this.getNextId(),i=B(this,sr,fI).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:m(this,We),isCentered:t,...r});return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(B(this,sr,pI).call(this),!0)}setSelected(e){m(this,We).setSelected(e)}toggleSelected(e){m(this,We).toggleSelected(e)}unselect(e){m(this,We).unselect(e)}pointerup(e){var r;const{isMac:t}=Qi.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&m(this,wh)&&(L(this,wh,!1),!((r=m(this,sr,Jl))!=null&&r.isDrawer&&m(this,sr,Jl).supportMultipleDrawings))){if(!m(this,f1)){L(this,f1,!0);return}if(m(this,We).getMode()===Pt.STAMP){m(this,We).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var s;if(m(this,We).getMode()===Pt.HIGHLIGHT&&this.enableTextSelection(),m(this,wh)){L(this,wh,!1);return}const{isMac:t}=Qi.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(L(this,wh,!0),(s=m(this,sr,Jl))!=null&&s.isDrawer){this.startDrawingSession(e);return}const r=m(this,We).getActive();L(this,f1,!r||r.isEmpty())}startDrawingSession(e){if(this.div.focus(),m(this,Sl)){m(this,sr,Jl).startDrawing(this,m(this,We),!1,e);return}m(this,We).setCurrentDrawingSession(this),L(this,Sl,new AbortController);const t=m(this,We).combinedSignal(m(this,Sl));this.div.addEventListener("blur",({relatedTarget:r})=>{r&&!this.div.contains(r)&&(L(this,Lu,null),this.commitOrRemove())},{signal:t}),m(this,sr,Jl).startDrawing(this,m(this,We),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&L(this,Lu,t);return}m(this,Lu)&&setTimeout(()=>{var t;(t=m(this,Lu))==null||t.focus(),L(this,Lu,null)},0)}endDrawingSession(e=!1){return m(this,Sl)?(m(this,We).setCurrentDrawingSession(null),m(this,Sl).abort(),L(this,Sl,null),L(this,Lu,null),m(this,sr,Jl).endDrawing(e)):null}findNewParent(e,t,r){const s=m(this,We).findParent(t,r);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return m(this,Sl)?(this.endDrawingSession(),!0):!1}onScaleChanging(){m(this,Sl)&&m(this,sr,Jl).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=m(this,We).getActive())==null?void 0:e.parent)===this&&(m(this,We).commitOrRemove(),m(this,We).setActiveEditor(null)),m(this,Pu)&&(clearTimeout(m(this,Pu)),L(this,Pu,null));for(const r of m(this,ja).values())(t=m(this,i0))==null||t.removePointerInTextLayer(r.contentDiv),r.setParent(null),r.isAttachedToDOM=!1,r.div.remove();this.div=null,m(this,ja).clear(),m(this,We).removeLayer(this)}render({viewport:e}){this.viewport=e,O0(this.div,e);for(const t of m(this,We).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){m(this,We).commitOrRemove(),B(this,sr,Mk).call(this);const t=this.viewport.rotation,r=e.rotation;if(this.viewport=e,O0(this.div,{rotation:r}),t!==r)for(const s of m(this,ja).values())s.rotate(r)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return m(this,We).viewParameters.realScale}};i0=new WeakMap,f1=new WeakMap,vc=new WeakMap,vh=new WeakMap,Pu=new WeakMap,ja=new WeakMap,wh=new WeakMap,p1=new WeakMap,o0=new WeakMap,Sl=new WeakMap,Lu=new WeakMap,mi=new WeakMap,Du=new WeakMap,We=new WeakMap,kh=new WeakMap,sr=new WeakSet,iZ=function(e){m(this,We).unselectAll();const{target:t}=e;if(t===m(this,mi).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&m(this,mi).div.contains(t)){const{isMac:r}=Qi.platform;if(e.button!==0||e.ctrlKey&&r)return;m(this,We).showAllEditors("highlight",!0,!0),m(this,mi).div.classList.add("free"),this.toggleDrawing(),F5.startHighlighting(this,m(this,We).direction==="ltr",{target:m(this,mi).div,x:e.x,y:e.y}),m(this,mi).div.addEventListener("pointerup",()=>{m(this,mi).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:m(this,We)._signal}),e.preventDefault()}},Jl=function(){return m(dl,kh).get(m(this,We).getMode())},fI=function(e){const t=m(this,sr,Jl);return t?new t.prototype.constructor(e):null},pI=function(){const{x:e,y:t,width:r,height:s}=this.div.getBoundingClientRect(),i=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+r),l=Math.min(window.innerHeight,t+s),c=(i+a)/2-e,u=(o+l)/2-t,[h,f]=this.viewport.rotation%180===0?[c,u]:[u,c];return{offsetX:h,offsetY:f}},Mk=function(){for(const e of m(this,ja).values())e.isEmpty()&&e.remove()},ct(dl,"_initialized",!1),z(dl,kh,new Map([WN,lI,cI,F5].map(e=>[e._editorType,e])));let hI=dl;var Tl,yw,$i,a0,s3,oZ,Vc,gI,aZ,yI;const di=class di{constructor({pageIndex:e}){z(this,Vc);z(this,Tl,null);z(this,yw,0);z(this,$i,new Map);z(this,a0,new Map);this.pageIndex=e}setParent(e){if(!m(this,Tl)){L(this,Tl,e);return}if(m(this,Tl)!==e){if(m(this,$i).size>0)for(const t of m(this,$i).values())t.remove(),e.append(t);L(this,Tl,e)}}static get _svgFactory(){return Ht(this,"_svgFactory",new mM)}draw(e,t=!1,r=!1){const s=Pi(this,yw)._++,i=B(this,Vc,gI).call(this),o=di._svgFactory.createElement("defs");i.append(o);const a=di._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&m(this,a0).set(s,a);const c=r?B(this,Vc,aZ).call(this,o,l):null,u=di._svgFactory.createElement("use");return i.append(u),u.setAttribute("href",`#${l}`),this.updateProperties(i,e),m(this,$i).set(s,i),{id:s,clipPathId:`url(#${c})`}}drawOutline(e,t){const r=Pi(this,yw)._++,s=B(this,Vc,gI).call(this),i=di._svgFactory.createElement("defs");s.append(i);const o=di._svgFactory.createElement("path");i.append(o);const a=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=di._svgFactory.createElement("mask");i.append(h),l=`mask_p${this.pageIndex}_${r}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=di._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=di._svgFactory.createElement("use");h.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=di._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const u=c.cloneNode();return s.append(u),c.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(s,e),m(this,$i).set(r,s),r}finalizeDraw(e,t){m(this,a0).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:r,bbox:s,rootClass:i,path:o}=t,a=typeof e=="number"?m(this,$i).get(e):e;if(a){if(r&&B(this,Vc,yI).call(this,a,r),s&&B(l=di,s3,oZ).call(l,a,s),i){const{classList:c}=a;for(const[u,h]of Object.entries(i))c.toggle(u,h)}if(o){const u=a.firstChild.firstChild;B(this,Vc,yI).call(this,u,o)}}}updateParent(e,t){if(t===this)return;const r=m(this,$i).get(e);r&&(m(t,Tl).append(r),m(this,$i).delete(e),m(t,$i).set(e,r))}remove(e){m(this,a0).delete(e),m(this,Tl)!==null&&(m(this,$i).get(e).remove(),m(this,$i).delete(e))}destroy(){L(this,Tl,null);for(const e of m(this,$i).values())e.remove();m(this,$i).clear(),m(this,a0).clear()}};Tl=new WeakMap,yw=new WeakMap,$i=new WeakMap,a0=new WeakMap,s3=new WeakSet,oZ=function(e,[t,r,s,i]){const{style:o}=e;o.top=`${100*r}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*i}%`},Vc=new WeakSet,gI=function(){const e=di._svgFactory.create(1,1,!0);return m(this,Tl).append(e),e.setAttribute("aria-hidden",!0),e},aZ=function(e,t){const r=di._svgFactory.createElement("clipPath");e.append(r);const s=`clip_${t}`;r.setAttribute("id",s),r.setAttribute("clipPathUnits","objectBoundingBox");const i=di._svgFactory.createElement("use");return r.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),s},yI=function(e,t){for(const[r,s]of Object.entries(t))s===null?e.removeAttribute(r):e.setAttribute(r,s)},z(di,s3);let mI=di;globalThis.pdfjsTestingUtils={HighlightOutliner:YN};St.AbortException;St.AnnotationEditorLayer;St.AnnotationEditorParamsType;St.AnnotationEditorType;St.AnnotationEditorUIManager;St.AnnotationLayer;St.AnnotationMode;St.ColorPicker;St.DOMSVGFactory;St.DrawLayer;St.FeatureTest;var DIe=St.GlobalWorkerOptions;St.ImageKind;St.InvalidPDFException;St.MissingPDFException;St.OPS;St.OutputScale;St.PDFDataRangeTransport;St.PDFDateString;St.PDFWorker;St.PasswordResponses;St.PermissionFlag;St.PixelsPerInch;St.RenderingCancelledException;St.TextLayer;St.TouchManager;St.UnexpectedResponseException;St.Util;St.VerbosityLevel;St.XfaLayer;St.build;St.createValidAbsoluteUrl;St.fetchData;var jIe=St.getDocument;St.getFilenameFromUrl;St.getPdfFilenameFromUrl;St.getXfaPageViewport;St.isDataScheme;St.isPdfFile;St.noContextMenu;St.normalizeUnicode;St.setLayerDimensions;St.shadow;St.stopEvent;St.version;const OIe=({isLoading:n,onContinue:e,sourceMode:t,productType:r})=>{const[s,i]=V.useState(Array(9).fill(null)),[o,a]=V.useState(!0),[l,c]=V.useState(null),[u,h]=V.useState(""),[f,p]=V.useState({player:0,cpu:0,draws:0}),g=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],y=V.useCallback(S=>{for(let N=0;N<g.length;N++){const[P,O,D]=g[N];if(S[P]&&S[P]===S[O]&&S[P]===S[D])return S[P]}return S.includes(null)?null:"Draw"},[]),v=V.useCallback(()=>{i(Array(9).fill(null)),a(Math.random()<.5),c(null),h("")},[]),b=V.useCallback(()=>{if(l||!n)return;const S=s.map((G,J)=>G===null?J:null).filter(G=>G!==null);if(S.length===0)return;let N=-1;const P=G=>{for(let J=0;J<g.length;J++){const[Q,re,ne]=g[J],te=[s[Q],s[re],s[ne]],H=te.filter(xe=>xe===G).length,ce=te.filter(xe=>xe===null).length;if(H===2&&ce===1){if(s[Q]===null)return Q;if(s[re]===null)return re;if(s[ne]===null)return ne}}return-1};if(N=P("O"),N===-1&&(N=P("X")),N===-1&&s[4]===null&&(N=4),N===-1){const G=[0,2,6,8].filter(J=>s[J]===null);G.length>0&&(N=G[Math.floor(Math.random()*G.length)])}N===-1&&(N=S[Math.floor(Math.random()*S.length)]);const O=[...s];O[N]="O",i(O),a(!0);let D=!1;for(let G=0;G<g.length;G++){const[J,Q,re]=g[G];if(O[J]&&O[J]===O[Q]&&O[J]===O[re]){w(O[J]),D=!0;break}}!D&&!O.includes(null)&&w("Draw")},[s,l,n,y]),w=S=>{c(S),p(N=>({...N,player:S==="X"?N.player+1:N.player,cpu:S==="O"?N.cpu+1:N.cpu,draws:S==="Draw"?N.draws+1:N.draws})),h(S==="Draw"?"!":S==="X"?"!":"!"),setTimeout(()=>{n&&v()},1500)};V.useEffect(()=>{if(!o&&!l&&n){const S=setTimeout(b,500);return()=>clearTimeout(S)}},[o,l,n,b]);const k=S=>{if(s[S]||l||!o)return;const N=[...s];N[S]="X",i(N),a(!1);const P=y(N);P&&w(P)};V.useEffect(()=>{console.log("isLoading prop changed:",n)},[n]);const T={lesson:" ",activity:" ",exam:"",podcast:""}[r||"lesson"]||"",R={upload:" ",text:" ",multimodal:" ",topic:"  "}[t||"topic"]||"",M=`${T} ${R} `,I={lesson:"lesson",activity:"activity",exam:"exam",podcast:"general"}[r||"lesson"]||"general";return d.jsxs("div",{className:"fixed inset-0 z-[200] bg-white/95 backdrop-blur-md flex flex-col items-center justify-center font-sans animate-fade-in",dir:"ltr",children:[d.jsxs("div",{className:"flex flex-col items-center animate-fade-in shrink-0",dir:"rtl",children:[d.jsx("img",{src:"/WizdiLogo.png",alt:"Wizdi",className:"h-20 w-auto mb-4 object-contain",loading:"eager",decoding:"async"}),d.jsxs("h2",{className:"text-2xl md:text-3xl font-bold text-center px-4 leading-relaxed",style:{color:"#0ea5e9"},children:[M,d.jsx("br",{}),"  ..."]}),d.jsx("div",{className:"mt-4 min-h-[1.5rem]",children:d.jsx(h4e,{contentType:I,isVisible:n,className:"text-sm text-indigo-600 font-medium"})}),d.jsx("p",{className:"text-sm text-gray-400 mt-2 font-medium bg-white/50 px-3 py-1 rounded-full backdrop-blur-sm",children:"       "})]}),n?d.jsxs("div",{className:"relative mt-8 animate-fade-in-up flex flex-col items-center gap-6",dir:"ltr",children:[d.jsxs("div",{className:"flex items-center gap-8 bg-gray-100 px-6 py-3 rounded-2xl shadow-inner text-gray-600 font-bold",children:[d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("span",{className:"text-xs uppercase tracking-widest mb-1 text-indigo-500",children:"You"}),d.jsx("span",{className:"text-2xl",children:f.player})]}),d.jsx("div",{className:"h-8 w-px bg-gray-300"}),d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("span",{className:"text-xs uppercase tracking-widest mb-1 text-gray-400",children:"Draws"}),d.jsx("span",{className:"text-2xl",children:f.draws})]}),d.jsx("div",{className:"h-8 w-px bg-gray-300"}),d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("span",{className:"text-xs uppercase tracking-widest mb-1 text-rose-500",children:"CPU"}),d.jsx("span",{className:"text-2xl",children:f.cpu})]})]}),u&&d.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none w-full flex justify-center",children:d.jsx("span",{className:`
                                text-5xl font-black animate-bounce-short drop-shadow-xl px-8 py-6 rounded-3xl border-4 bg-white/95 backdrop-blur shadow-2xl
                                ${u.includes("")?"text-green-500 border-green-200":u.includes("")?"text-red-500 border-red-200":"text-gray-500 border-gray-200"}
                            `,children:u})}),d.jsx("div",{className:"grid grid-cols-3 gap-3 p-4 bg-gray-100/50 rounded-3xl border border-gray-200 shadow-xl",children:s.map((S,N)=>d.jsx("button",{onClick:()=>k(N),disabled:!!S||!!l||!o,className:`
                                    w-20 h-20 md:w-24 md:h-24 bg-white rounded-2xl shadow-sm text-5xl font-bold flex items-center justify-center
                                    transition-all duration-200
                                    ${!S&&o&&!l?"hover:scale-105 hover:bg-sky-50 cursor-pointer shadow-md":""}
                                    ${S==="X"?"text-indigo-500":"text-rose-400"}
                                    ${S?"cursor-default":""}
                                `,children:S},N))})]}):d.jsxs("div",{className:"mt-0 pt-20 text-center animate-bounce-in z-50 flex flex-col items-center h-full justify-start",dir:"rtl",children:[d.jsx("h2",{className:"text-5xl font-black text-gray-800 mb-12 drop-shadow-sm leading-tight",children:" !"}),d.jsxs("button",{onClick:e,className:"bg-[#0ea5e9] text-white px-12 py-5 rounded-full text-2xl font-bold shadow-2xl hover:bg-sky-600 hover:scale-105 active:scale-95 transition-all ring-4 ring-sky-100 cursor-pointer flex items-center gap-4",children:[d.jsx("span",{children:" "}),d.jsx("span",{className:"text-3xl",children:""})]})]}),n&&d.jsx("p",{className:"fixed bottom-8 text-gray-400 text-sm font-medium opacity-60",children:"Human (X) vs CPU (O)"})]})},FIe=nt.lazy(()=>Ln(()=>import("./CourseEditor-DgLQTIpt.js"),__vite__mapDeps([10,0,1,11,12,7,13,14,15,16,17,18,19,3])));nt.lazy(()=>Ln(()=>import("./CoursePlayer-Bq7ZKb2I.js").then(n=>n.j),__vite__mapDeps([0,1])));const zIe=nt.lazy(()=>Ln(()=>import("./TeacherDashboard-NaKQzVKi.js"),__vite__mapDeps([20,14,21,22,17,18,19,3,4]))),BIe=nt.lazy(()=>Ln(()=>import("./PedagogicalInsights-CgB1JRC6.js"),__vite__mapDeps([23,24]))),$Ie=nt.lazy(()=>Ln(()=>import("./IngestionWizard-C4rhXKDf.js").then(n=>n.b),__vite__mapDeps([15,11]))),VIe=nt.lazy(()=>Ln(()=>import("./AdaptiveDashboard-fDA1_U-J.js"),__vite__mapDeps([25,26,27])).then(n=>({default:n.AdaptiveDashboard})));nt.lazy(()=>Ln(()=>import("./TeacherControlCenter-D8q0RWs-.js"),__vite__mapDeps([28,29,30,19,21,22,27,4,14])).then(n=>({default:n.TeacherControlCenter})));const UIe=nt.lazy(()=>Ln(()=>import("./PromptsLibrary-ClpZ_wwd.js"),__vite__mapDeps([31,32,33,34,3,7,13,16,29,35,36,21,19,6]))),HIe=nt.lazy(()=>Ln(()=>import("./QADashboard-BkCVd0t5.js"),__vite__mapDeps([37,11]))),qIe=nt.lazy(()=>Ln(()=>import("./WizdiRouter-CAcOvrr7.js"),[])),GIe=nt.lazy(()=>Ln(()=>import("./KnowledgeBaseAdmin-t8HBLg16.js"),[])),WIe=nt.lazy(()=>Ln(()=>import("./ExtractionReviewPage-DEUMoBsX.js"),[])),KIe=nt.lazy(()=>Ln(()=>import("./TeachingAgentsLibrary-BSCv6770.js"),__vite__mapDeps([38,29,14,7,35,33,19,39]))),YIe=nt.lazy(()=>Ln(()=>import("./UsageDashboard-vI6NjYLJ.js"),__vite__mapDeps([40,19,21,34,33]))),XIe=nt.lazy(()=>Ln(()=>import("./GenerationSpeedAnalytics-CHWIbMga.js"),__vite__mapDeps([41,21,36,18,33,34]))),JIe=nt.lazy(()=>Ln(()=>import("./ThreeLevelsTest-CQjIipDB.js"),[]));DIe.workerSrc=new URL("/assets/pdf.worker.min-yatZIOMy.mjs",import.meta.url).toString();const QIe=async n=>{const e=await n.arrayBuffer(),t=await jIe({data:e}).promise,r=Math.min(t.numPages,5),s=Array.from({length:r},(l,c)=>c+1),i=await Promise.all(s.map(async l=>{const c=await t.getPage(l),h=(await c.getTextContent()).items.map(g=>g.str).join(" "),f=h.trim().length;let p=null;if(f<100||l===1)try{const y=c.getViewport({scale:1.5}),v=document.createElement("canvas"),b=v.getContext("2d");if(b){v.height=y.height,v.width=y.width,await c.render({canvasContext:b,viewport:y}).promise;const w=v.toDataURL("image/jpeg",.8).split(",")[1];p={pageNum:l,base64:w,mimeType:"image/jpeg"},console.log(` Rendered page ${l} as image (text length: ${f})`)}}catch(g){console.warn(`Failed to render page ${l} as image:`,g)}return{pageNum:l,text:`--- Page ${l} ---
${h}

`,imageData:p}}));i.sort((l,c)=>l.pageNum-c.pageNum);const o=i.map(l=>l.text).join(""),a=i.filter(l=>l.imageData!==null).map(l=>l.imageData);return{text:o,pageImages:a,hasImages:a.length>0}},ZIe=()=>d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),e7e=()=>d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),d.jsx("polyline",{points:"16 17 21 12 16 7"}),d.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),t7e=()=>d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),d.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),qz=["   ...","   ...","   ...","   ...","   ...","  ...","  ...","  ...","    ...","  ...","  ..."," ..."],fE=()=>{const[n,e]=V.useState(0),[t,r]=V.useState(!0);return V.useEffect(()=>{const s=setInterval(()=>{r(!1),setTimeout(()=>{e(i=>(i+1)%qz.length),r(!0)},300)},2e3);return()=>clearInterval(s)},[]),d.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[d.jsx(Yw,{size:"lg",color:"gradient",className:"mb-6"}),d.jsx("h2",{className:"text-2xl font-bold text-indigo-600 mb-3",children:" ..."}),d.jsx("p",{className:`text-indigo-500 font-medium transition-opacity duration-300 ${t?"opacity-100":"opacity-0"}`,children:qz[n]})]})},n7e=()=>{const[n,e]=V.useState("list"),[t,r]=V.useState(!1),[s,i]=V.useState(!1),[o,a]=V.useState(null),[l,c]=V.useState(null),[u,h]=V.useState(!1),[f,p]=V.useState(!1),[g,y]=V.useState(!1),[v,b]=V.useState({}),[w,k]=V.useState(null),{loadCourse:T}=I8(),{currentUser:R,isAdmin:M}=kf();V.useEffect(()=>{},[o]),V.useEffect(()=>{const G=new URLSearchParams(window.location.search),J=G.get("studentCourseId"),Q=G.get("assignmentId");(async()=>{if(Q){r(!0);try{const ne=await Ka(or(Kt,"assignments",Q));if(ne.exists()){const te={id:ne.id,...ne.data()};k(te),T(te.courseId),e("student")}else console.warn("Assignment not found or expired"),alert("     ."),e("list")}catch(ne){console.error("Error loading assignment",ne),alert("  ")}}else J&&(r(!0),T(J),e("student"))})()},[T]);const E=G=>{console.log("[App] handleCourseSelect called with courseId:",G),T(G),e("editor")},I=()=>{e("list"),window.history.pushState({},"","/")},S=()=>{e(n==="editor"?"student":"editor")},N=async G=>{try{const J=await Ka(or(Kt,"assignments",G));if(J.exists()){const Q={id:J.id,...J.data()};k(Q),T(Q.courseId),i(!0),e("student")}}catch(J){console.error("Error selecting assignment:",J),alert("  ")}},P=G=>new Promise((J,Q)=>{const re=new FileReader;re.onloadend=()=>{const ne=re.result;if(typeof ne=="string"){const te=ne.split(",")[1];J({base64:te,mimeType:G.type})}else Q(new Error("Failed to read file"))},re.onerror=Q,re.readAsDataURL(G)}),O=async G=>{var J,Q,re,ne,te,H,ce,xe;if(R){if(a(null),b({sourceMode:G.mode,productType:(J=G.settings)==null?void 0:J.productType}),y(!1),!R){alert(":   ");return}try{h(!0);let W=null,dt=null,Me=null,Fe,Ae;if(G.file){const Rn=G.file;dt=Rn.type,Me=Rn.name;try{const Ct=Hw(Gw,`uploads/${R.uid}/${Date.now()}_${Rn.name}`),oe=await Y3(Ct,Rn);W=await Uw(oe.ref)}catch(Ct){console.error("Storage upload failed",Ct)}try{if(Rn.type==="application/pdf"){console.log(" Processing PDF with enhanced extraction...");const Ct=await QIe(Rn);if(Ae=Ct.text,Ct.hasImages&&Ct.pageImages.length>0){console.log(` PDF has ${Ct.pageImages.length} image pages - sending to Vision API...`);try{const oe=zc(af,"analyzeImageWithVision"),pe=Ct.pageImages.slice(0,3),ft=(await Promise.all(pe.map(async Ye=>{try{const tt=await oe({imageBase64:Ye.base64,mimeType:Ye.mimeType,context:`PDF Page ${Ye.pageNum} - ${G.topic||G.title||Me}`});return{pageNum:Ye.pageNum,data:tt.data}}catch(tt){return console.warn(`Vision failed for page ${Ye.pageNum}:`,tt),null}}))).filter(Ye=>{var tt;return Ye&&((tt=Ye.data)==null?void 0:tt.success)});if(ft.length>0){let Ye=`

---   (Vision AI) ---
`;const tt=[];ft.forEach(bn=>{var vn;bn&&bn.data&&(Ye+=`
[ ${bn.pageNum}]
`,Ye+=bn.data.sourceText||((vn=bn.data.analysis)==null?void 0:vn.educational_summary)||"",Ye+=`
`,bn.data.analysis&&tt.push({page:bn.pageNum,...bn.data.analysis}))}),Ae+=Ye,G.pdfImageAnalysis=tt,console.log(` Vision analysis added from ${ft.length} pages. Total text: ${Ae.length} chars`)}}catch(oe){console.warn(" PDF Vision analysis failed, using text only:",oe)}}}else if(Rn.type.startsWith("image/")){console.log(" Analyzing image with Vision API..."),Fe=await P(Rn);try{const pe=(await zc(af,"analyzeImageWithVision")({imageBase64:Fe.base64,mimeType:Fe.mimeType,context:G.topic||G.title})).data;pe.success&&pe.sourceText&&(Ae=pe.sourceText,console.log(" Image analyzed successfully. Extracted text length:",Ae.length),G.imageAnalysis=pe.analysis)}catch(Ct){console.warn(" Vision API failed, falling back to basic image handling:",Ct)}}else Rn.type==="text/plain"&&(Ae=await Rn.text())}catch(Ct){console.error("Error processing file for AI",Ct)}}else G.pastedText&&(Ae=G.pastedText);let lt=(Array.isArray(G.targetAudience)?G.targetAudience[0]:G.targetAudience)||(Array.isArray(G.grade)?G.grade[0]:G.grade)||(Array.isArray(G.gradeLevel)?G.gradeLevel[0]:G.gradeLevel)||((Q=G.settings)==null?void 0:Q.targetAudience)||((re=G.settings)==null?void 0:re.grade)||((ne=G.settings)==null?void 0:ne.gradeLevel)||"";const sn=G.originalTopic||G.topic||Me||" ",un=G.title||G.topic||Me||" ",Sr=((te=G.settings)==null?void 0:te.courseMode)||"learning",ri=((H=G.settings)==null?void 0:H.activityLength)||"medium",Yn=((ce=G.settings)==null?void 0:ce.subject)||"";let Or=[];try{Or=[{id:crypto.randomUUID(),title:" ",learningUnits:[{id:crypto.randomUUID(),title:un,type:"practice",activityBlocks:[]}]}]}catch(Rn){console.error("AI Init Failed (Non-fatal):",Rn),Or=[{id:"fallback-"+Date.now(),title:" ",learningUnits:[]}]}const{file:ht,...Tn}=G,Gt={title:un,teacherId:R.uid,targetAudience:lt,subject:Yn,gradeLevel:lt,syllabus:Or,mode:Sr,activityLength:ri,showSourceToStudent:((xe=G.settings)==null?void 0:xe.showSourceToStudent)??!0,fullBookContent:Ae||"",pdfSource:W||null,wizardData:{...Tn,fileUrl:W,fileName:Me,fileType:dt}},bt={...JSON.parse(JSON.stringify(Gt)),createdAt:rd()},$t=or(Zs(Kt,"courses"));await Pc($t,bt,{merge:!0});const er=$t;let js=0,co=!1;for(;js<5&&!co;){try{(await Ka(or(Kt,"courses",er.id))).exists()?co=!0:await new Promise(Ct=>setTimeout(Ct,500))}catch(Rn){console.warn("Verify error",Rn)}js++}T(er.id),setTimeout(()=>{e("editor"),h(!1)},100)}catch(W){console.error("CRITICAL ERROR in handleWizardComplete:",W),alert("  : "+((W==null?void 0:W.message)||"  ")),h(!1)}}},D=n==="student"&&!t?"sticky top-0 z-50 bg-indigo-50/90 backdrop-blur-md border-b border-indigo-100 shadow-sm px-6 py-4 flex justify-between items-center transition-all":"sticky top-0 z-50 glass border-b border-white/40 shadow-sm px-6 py-4 flex justify-between items-center transition-all";return d.jsxs("div",{className:"min-h-screen bg-gray-50 text-right font-sans",dir:"rtl",children:[d.jsxs("header",{className:D,children:[d.jsx("div",{className:"flex items-center gap-3 cursor-pointer",onClick:t?void 0:I,children:d.jsx("img",{src:"/WizdiLogo.png",alt:"Wizdi AI",className:"h-20 w-auto object-contain hover:opacity-90 transition-opacity",loading:"lazy",decoding:"async"})}),d.jsxs("div",{className:"flex items-center gap-4",children:[n!=="list"&&!t&&d.jsxs("button",{onClick:I,className:"bg-white hover:bg-gray-50 text-indigo-600 border border-indigo-200 px-4 py-2 rounded-xl transition-all shadow-sm hover:shadow flex items-center gap-2 font-bold cursor-pointer text-sm",children:[d.jsx(ZIe,{})," ",d.jsx("span",{children:""})]}),n==="student"&&!t&&d.jsxs("button",{onClick:S,className:"bg-white text-indigo-600 border border-indigo-200 hover:bg-indigo-50 px-4 py-2 rounded-xl transition-all shadow-sm hover:shadow flex items-center gap-2 font-bold cursor-pointer text-sm",children:[d.jsx(t7e,{})," ",d.jsx("span",{children:" "})]}),n==="student"&&t&&d.jsxs("button",{onClick:()=>e("student-dashboard"),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl transition-all shadow-md hover:shadow-lg flex items-center gap-2 font-bold cursor-pointer text-sm animate-pulse-slow",children:[d.jsx("span",{children:""})," ",d.jsx("span",{children:" "})]}),d.jsx("div",{className:"h-6 w-px bg-gray-300 mx-1"}),n==="list"&&d.jsx("button",{onClick:()=>e("student-dashboard"),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-xl transition-colors font-bold text-sm shadow-md",children:"  "}),n==="student"&&!t&&d.jsx("button",{onClick:()=>p(!f),className:`px-4 py-2 rounded-xl transition-colors font-bold text-sm border flex items-center gap-2 ${f?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-purple-600 border-purple-200 hover:bg-purple-50"}`,title:"    (  )",children:f?"   ":"  "}),n==="student-dashboard"&&!t&&d.jsx("button",{onClick:()=>e("list"),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-xl transition-colors font-bold text-sm",children:"  "}),d.jsxs("button",{onClick:()=>jc.signOut(),className:"bg-red-50 hover:bg-red-100 text-red-500 px-4 py-2 rounded-xl transition-colors flex items-center gap-2 font-bold text-sm",title:"",children:[d.jsx(e7e,{}),d.jsx("span",{children:""})]})]})]}),d.jsx("main",{className:"container mx-auto px-4 py-8",children:d.jsx(Tz,{children:d.jsx(V.Suspense,{fallback:d.jsx(fE,{}),children:u?d.jsx("div",{className:"flex flex-col items-center justify-center min-h-[50vh]",children:d.jsx(fE,{})}):t?d.jsx(_z,{assignment:w||void 0,onExit:()=>e("student-dashboard")}):d.jsxs(d.Fragment,{children:[n==="list"&&d.jsx(CCe,{onCreateNew:(G,J)=>{a(G),c(J||null)},onCreateWithWizardData:O,onNavigateToDashboard:()=>e("dashboard"),onEditCourse:E,onNavigateToPrompts:()=>e("prompts"),onNavigateToQA:M?()=>e("qa-admin"):void 0,onNavigateToKnowledgeBase:M?()=>e("knowledge-base"):void 0,onNavigateToAgents:()=>e("agents"),onNavigateToUsage:M?()=>e("usage-admin"):void 0,onNavigateToSpeedAnalytics:M?()=>e("speed-analytics"):void 0}),n==="editor"&&d.jsx(FIe,{onBack:I}),n==="student"&&(console.log(" App: Rendering SequentialCoursePlayer in STUDENT mode"),d.jsx(_z,{assignment:w||void 0,simulateGuest:f,onExit:()=>{console.log(" App: onExit called from SequentialCoursePlayer"),s?(i(!1),e("student-dashboard")):e("editor")},onEdit:()=>e("editor")})),n==="dashboard"&&d.jsx(zIe,{onEditCourse:E,onViewInsights:()=>e("insights"),onNavigateToAnalytics:()=>e("analytics")}),n==="prompts"&&d.jsx(UIe,{onBack:()=>e("list")}),n==="agents"&&d.jsx(KIe,{onBack:()=>e("list")}),n==="student-dashboard"&&d.jsx(NCe,{onSelectAssignment:N,highlightCourseId:(w==null?void 0:w.courseId)||(t&&!w?new URLSearchParams(window.location.search).get("studentCourseId"):void 0)}),n==="insights"&&d.jsx(BIe,{onBack:()=>e("dashboard")}),n==="analytics"&&d.jsx(VIe,{}),n==="qa-admin"&&d.jsx(HIe,{onBack:()=>e("list")}),n==="knowledge-base"&&d.jsx(GIe,{onNavigateToReview:()=>e("extraction-review")}),n==="extraction-review"&&d.jsx(WIe,{}),n==="usage-admin"&&d.jsx(YIe,{}),n==="speed-analytics"&&d.jsx(XIe,{})]})})})}),o&&d.jsx("div",{className:"fixed inset-0 z-[100] overflow-y-auto bg-gray-900/50 backdrop-blur-sm",children:d.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:d.jsx(V.Suspense,{fallback:d.jsx("div",{className:"bg-white p-6 rounded-2xl",children:d.jsx(fE,{})}),children:d.jsx(Tz,{children:d.jsx($Ie,{initialMode:o,initialProduct:l||void 0,initialTopic:"",title:"  ",onComplete:O,onCancel:()=>{a(null),c(null)}})})})})}),g&&d.jsx(OIe,{isLoading:u,onContinue:()=>y(!1),sourceMode:v.sourceMode,productType:v.productType})]})},r7e=()=>{const{currentUser:n,loading:e}=kf(),[t,r]=V.useState(!1),s=new URLSearchParams(window.location.search),i=s.has("studentCourseId")||s.has("assignmentId");return e?d.jsx("div",{className:"h-screen flex items-center justify-center text-gray-500 font-bold bg-gray-50",children:" ..."}):n||i?d.jsx(DCe,{bypassInDev:!0,failOpen:!0,children:d.jsx(n7e,{})}):t?d.jsx(efe,{}):d.jsx(ICe,{onLogin:()=>r(!0)})};function s7e(){const n=k3(),e=n.pathname.startsWith("/wizdi"),t=n.pathname.startsWith("/dev");return e?d.jsx(V.Suspense,{fallback:d.jsx("div",{className:"h-screen flex items-center justify-center",children:"..."}),children:d.jsx(iP,{children:d.jsx(l6,{path:"/wizdi/*",element:d.jsx(qIe,{})})})}):t?d.jsx(oD,{children:d.jsx(V.Suspense,{fallback:d.jsx("div",{className:"h-screen flex items-center justify-center",children:"..."}),children:d.jsx(iP,{children:d.jsx(l6,{path:"/dev/three-levels-test",element:d.jsx(JIe,{})})})})}):d.jsx(oD,{children:d.jsx(hfe,{children:d.jsx(r7e,{})})})}console.log(" Main:   App...");const Gz=document.getElementById("root");Gz?pE.createRoot(Gz).render(d.jsx(nt.StrictMode,{children:d.jsx(One,{children:d.jsx(s7e,{})})})):console.error("  :  root ");export{_y as $,zc as A,af as B,oV as C,wme as D,M_ as E,VD as F,ng as G,tG as H,I1 as I,I8 as J,yz as K,spe as L,Vl as M,ipe as N,Yw as O,H6 as P,M7e as Q,nt as R,K7e as S,DC as T,upe as U,I_ as V,D7e as W,U2 as X,vD as Y,lm as Z,Ln as _,ty as a,tAe as a$,CO as a0,SD as a1,TD as a2,R8 as a3,eCe as a4,Yl as a5,Mx as a6,c4e as a7,$T as a8,V6 as a9,qq as aA,I7e as aB,xne as aC,L7e as aD,xpe as aE,z7e as aF,VT as aG,W6e as aH,dpe as aI,q7e as aJ,fpe as aK,T7e as aL,Tb as aM,S7e as aN,A7e as aO,_7e as aP,h4e as aQ,jIe as aR,w7e as aS,v7e as aT,k7e as aU,DIe as aV,C7e as aW,Q7e as aX,Jy as aY,PAe as aZ,$6e as a_,R7e as aa,fD as ab,x7e as ac,bD as ad,b7e as ae,Ufe as af,_D as ag,kD as ah,R_ as ai,p0 as aj,Wq as ak,AD as al,hpe as am,H2 as an,CD as ao,N7e as ap,E7e as aq,npe as ar,tpe as as,epe as at,rpe as au,Fw as av,Zs as aw,rd as ax,qD as ay,Hq as az,Hi as b,G0e as b$,kf as b0,Ipe as b1,ED as b2,V7e as b3,P7e as b4,tCe as b5,X6e as b6,oJ as b7,ko as b8,iJ as b9,$m as bA,Ab as bB,B7e as bC,cme as bD,j7e as bE,G7e as bF,m7e as bG,Z0e as bH,K0e as bI,Hh as bJ,p7e as bK,l7e as bL,ame as bM,R0e as bN,J6 as bO,e8e as bP,ime as bQ,xw as bR,F7e as bS,U7e as bT,W7e as bU,O7e as bV,Yq as bW,H7e as bX,M1 as bY,q3 as bZ,rg as b_,Mpe as ba,sJ as bb,rJ as bc,rCe as bd,Z7e as be,K6e as bf,g7e as bg,Dfe as bh,d7e as bi,Ui as bj,Ww as bk,Ka as bl,y_ as bm,HT as bn,qT as bo,GT as bp,d0e as bq,P_ as br,tS as bs,q4 as bt,R1 as bu,HD as bv,E0e as bw,Y7e as bx,W6 as by,Uh as bz,At as c,$D as c0,Ow as c1,Gn as c2,Rx as c3,Vq as c4,Uq as c5,c7e as c6,iP as c7,l6 as c8,o7e as c9,V6e as cA,F0e as cB,f7e as cC,X6 as cD,t8e as cE,h7e as ca,N1 as cb,lfe as cc,$7e as cd,q6 as ce,lD as cf,Y6e as cg,Zq as ch,eG as ci,wc as cj,wD as ck,J0e as cl,L0e as cm,gCe as cn,B0e as co,K6 as cp,m0e as cq,lJ as cr,_me as cs,RD as ct,bpe as cu,MD as cv,gpe as cw,PD as cx,UT as cy,ape as cz,No as d,Kq as e,$3e as f,G6 as g,ND as h,Gy as i,d as j,br as k,y7e as l,Ofe as m,or as n,Kw as o,Kt as p,Hw as q,V as r,Pc as s,Gw as t,Y3 as u,Uw as v,Cae as w,cn as x,Q6 as y,jc as z};
//# sourceMappingURL=index-1x3sw4DL.js.map
